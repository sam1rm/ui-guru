(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.AnimationFrame=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){/**
 * An even better animation frame.
 *
 * @copyright Oleg Slobodskoi 2015
 * @website https://github.com/kof/animationFrame
 * @license MIT
 */
module.exports=require("./lib/animation-frame")},{"./lib/animation-frame":2}],2:[function(require,module,exports){"use strict";var nativeImpl=require("./native");var now=require("./now");var performance=require("./performance");var root=require("./root");var nativeRequest=nativeImpl.request;var nativeCancel=nativeImpl.cancel;function AnimationFrame(options){if(!(this instanceof AnimationFrame))return new AnimationFrame(options);options||(options={});if(typeof options=="number")options={frameRate:options};options.useNative!=null||(options.useNative=true);this.options=options;this.frameRate=options.frameRate||AnimationFrame.FRAME_RATE;this._frameLength=1e3/this.frameRate;this._isCustomFrameRate=this.frameRate!==AnimationFrame.FRAME_RATE;this._timeoutId=null;this._callbacks={};this._lastTickTime=0;this._tickCounter=0}module.exports=AnimationFrame;AnimationFrame.FRAME_RATE=60;AnimationFrame.shim=function(options){var animationFrame=new AnimationFrame(options);root.requestAnimationFrame=function(callback){return animationFrame.request(callback)};root.cancelAnimationFrame=function(id){return animationFrame.cancel(id)};return animationFrame};AnimationFrame.prototype.request=function(callback){var self=this;++this._tickCounter;if(nativeImpl.supported&&this.options.useNative&&!this._isCustomFrameRate){return nativeRequest(callback)}if(!callback)throw new TypeError("Not enough arguments");if(this._timeoutId==null){var delay=this._frameLength+this._lastTickTime-now();if(delay<0)delay=0;this._timeoutId=setTimeout(function(){self._lastTickTime=now();self._timeoutId=null;++self._tickCounter;var callbacks=self._callbacks;self._callbacks={};for(var id in callbacks){if(callbacks[id]){if(nativeImpl.supported&&self.options.useNative){nativeRequest(callbacks[id])}else{callbacks[id](performance.now())}}}},delay)}this._callbacks[this._tickCounter]=callback;return this._tickCounter};AnimationFrame.prototype.cancel=function(id){if(nativeImpl.supported&&this.options.useNative)nativeCancel(id);delete this._callbacks[id]}},{"./native":3,"./now":4,"./performance":6,"./root":7}],3:[function(require,module,exports){"use strict";var root=require("./root");try{root.top.name;root=root.top}catch(e){}exports.request=root.requestAnimationFrame;exports.cancel=root.cancelAnimationFrame||root.cancelRequestAnimationFrame;exports.supported=false;var vendors=["Webkit","Moz","ms","O"];for(var i=0;i<vendors.length&&!exports.request;i++){exports.request=root[vendors[i]+"RequestAnimationFrame"];exports.cancel=root[vendors[i]+"CancelAnimationFrame"]||root[vendors[i]+"CancelRequestAnimationFrame"]}if(exports.request){exports.request.call(null,function(){exports.supported=true})}},{"./root":7}],4:[function(require,module,exports){"use strict";module.exports=Date.now||function(){return(new Date).getTime()}},{}],5:[function(require,module,exports){"use strict";var now=require("./now");exports.navigationStart=now()},{"./now":4}],6:[function(require,module,exports){"use strict";var now=require("./now");var PerformanceTiming=require("./performance-timing");var root=require("./root");exports.now=function(){if(root.performance&&root.performance.now)return root.performance.now();return now()-PerformanceTiming.navigationStart}},{"./now":4,"./performance-timing":5,"./root":7}],7:[function(require,module,exports){var root;if(typeof window!=="undefined"){root=window}else if(typeof self!=="undefined"){root=self}else{root=this}module.exports=root},{}]},{},[1])(1)});
// will detect and apply the prefix to these properties on these platforms
// to verify if its required...
// -     [This one is the best since it just real-time checks caniuse.html and then compiles]
// - [See Second Section titled ""] https://developer.mozilla.org/en-US/docs/Web/CSS/Webkit_Extensions
// - Try typing in opacity to see something ie related
var cssPrefixedProperties = {
        "align-content": ["webkit", "moz"],
        "animation": ["webkit", "moz"],
        "animation-delay": ["webkit", "moz"],
        "animation-direction": ["webkit", "moz"],
        "animation-duration": ["webkit", "moz"],
        "animation-fill-mode": ["webkit", "moz"],
        "animation-iteration-count": ["webkit", "moz"],
        "animation-name": ["webkit", "moz"],
        "animation-play-state": ["webkit", "moz"],
        "animation-timing-function": ["webkit", "moz"],
        "backface-visibility": ["webkit", "moz"],
        "background-clip": ["webkit", "moz"],
        "background-origin": ["webkit", "moz"],
        "background-size": ["webkit", "moz"],
        "border-bottom-left-radius": ["webkit", "moz"],
        "border-bottom-right-radius": ["webkit", "moz"],
        "border-image": ["webkit", "moz"],
        "border-radius": ["webkit", "moz"],
        "border-top-left-radius": ["webkit", "moz"],
        "border-top-right-radius": ["webkit", "moz"],
        "box-sizing": ["webkit"],
        "column-count": ["moz", "webkit"],
        "column-gap": ["moz", "webkit"],

        "order": ["ms-flex", "webkit|box-orginal-group"],
        "filter": ["webkit"],
        "flex-direction": ["ms"],
        "flex-grow": ["ms|flex-positive"],
        "flex-shrink": ["ms|flex-negative"],
        "flex-wrap": ["ms", "webkit"],
        "flex-flow": ["ms", "webkit"],
        "flex-basis": ["ms", "webkit"],
        "transform": ["ms", "webkit"],
        "transform-origin": ["ms", "webkit"],
        "transition": ["webkit", "moz"],
        "transition-delay": ["webkit", "moz"],
        "transition-duration": ["webkit", "moz"],
        "transition-property": ["webkit", "moz"],
        "transition-timing-function": ["webkit", "moz"]
}

var cssPrefixedPropertyValues = {
    "background": {
        "linear-gradient": ["webkit"]
    },
    "display": {
      "flex": ["webkit", "moz", "ms"]
    }
}

/*!
 * Bowser - a browser detector
 * https://github.com/ded/bowser
 * MIT License | (c) Dustin Diaz 2015
 */
!function(e,t){typeof module!="undefined"&&module.exports?module.exports=t():typeof define=="function"&&define.amd?define(e,t):this[e]=t()}("bowser",function(){function t(t){function n(e){var n=t.match(e);return n&&n.length>1&&n[1]||""}function r(e){var n=t.match(e);return n&&n.length>1&&n[2]||""}var i=n(/(ipod|iphone|ipad)/i).toLowerCase(),s=/like android/i.test(t),o=!s&&/android/i.test(t),u=/nexus\s*[0-6]\s*/i.test(t),a=!u&&/nexus\s*[0-9]+/i.test(t),f=/CrOS/.test(t),l=/silk/i.test(t),c=/sailfish/i.test(t),h=/tizen/i.test(t),p=/(web|hpw)os/i.test(t),d=/windows phone/i.test(t),v=/SamsungBrowser/i.test(t),m=!d&&/windows/i.test(t),g=!i&&!l&&/macintosh/i.test(t),y=!o&&!c&&!h&&!p&&/linux/i.test(t),b=n(/edge\/(\d+(\.\d+)?)/i),w=n(/version\/(\d+(\.\d+)?)/i),E=/tablet/i.test(t),S=!E&&/[^-]mobi/i.test(t),x=/xbox/i.test(t),T;/opera/i.test(t)?T={name:"Opera",opera:e,version:w||n(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr|opios/i.test(t)?T={name:"Opera",opera:e,version:n(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||w}:/SamsungBrowser/i.test(t)?T={name:"Samsung Internet for Android",samsungBrowser:e,version:w||n(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?T={name:"Opera Coast",coast:e,version:w||n(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?T={name:"Yandex Browser",yandexbrowser:e,version:w||n(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?T={name:"UC Browser",ucbrowser:e,version:n(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?T={name:"Maxthon",maxthon:e,version:n(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?T={name:"Epiphany",epiphany:e,version:n(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?T={name:"Puffin",puffin:e,version:n(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?T={name:"Sleipnir",sleipnir:e,version:n(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?T={name:"K-Meleon",kMeleon:e,version:n(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:d?(T={name:"Windows Phone",windowsphone:e},b?(T.msedge=e,T.version=b):(T.msie=e,T.version=n(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?T={name:"Internet Explorer",msie:e,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:f?T={name:"Chrome",chromeos:e,chromeBook:e,chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(t)?T={name:"Microsoft Edge",msedge:e,version:b}:/vivaldi/i.test(t)?T={name:"Vivaldi",vivaldi:e,version:n(/vivaldi\/(\d+(\.\d+)?)/i)||w}:c?T={name:"Sailfish",sailfish:e,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?T={name:"SeaMonkey",seamonkey:e,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(T={name:"Firefox",firefox:e,version:n(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(T.firefoxos=e)):l?T={name:"Amazon Silk",silk:e,version:n(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?T={name:"PhantomJS",phantom:e,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?T={name:"SlimerJS",slimer:e,version:n(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?T={name:"BlackBerry",blackberry:e,version:w||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:p?(T={name:"WebOS",webos:e,version:w||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(T.touchpad=e)):/bada/i.test(t)?T={name:"Bada",bada:e,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:h?T={name:"Tizen",tizen:e,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||w}:/qupzilla/i.test(t)?T={name:"QupZilla",qupzilla:e,version:n(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||w}:/chromium/i.test(t)?T={name:"Chromium",chromium:e,version:n(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||w}:/chrome|crios|crmo/i.test(t)?T={name:"Chrome",chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:o?T={name:"Android",version:w}:/safari|applewebkit/i.test(t)?(T={name:"Safari",safari:e},w&&(T.version=w)):i?(T={name:i=="iphone"?"iPhone":i=="ipad"?"iPad":"iPod"},w&&(T.version=w)):/googlebot/i.test(t)?T={name:"Googlebot",googlebot:e,version:n(/googlebot\/(\d+(\.\d+))/i)||w}:T={name:n(/^(.*)\/(.*) /),version:r(/^(.*)\/(.*) /)},!T.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(T.name=T.name||"Blink",T.blink=e):(T.name=T.name||"Webkit",T.webkit=e),!T.version&&w&&(T.version=w)):!T.opera&&/gecko\//i.test(t)&&(T.name=T.name||"Gecko",T.gecko=e,T.version=T.version||n(/gecko\/(\d+(\.\d+)?)/i)),!T.windowsphone&&!T.msedge&&(o||T.silk)?T.android=e:!T.windowsphone&&!T.msedge&&i?(T[i]=e,T.ios=e):g?T.mac=e:x?T.xbox=e:m?T.windows=e:y&&(T.linux=e);var N="";T.windowsphone?N=n(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):i?(N=n(/os (\d+([_\s]\d+)*) like mac os x/i),N=N.replace(/[_\s]/g,".")):o?N=n(/android[ \/-](\d+(\.\d+)*)/i):T.webos?N=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):T.blackberry?N=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):T.bada?N=n(/bada\/(\d+(\.\d+)*)/i):T.tizen&&(N=n(/tizen[\/\s](\d+(\.\d+)*)/i)),N&&(T.osversion=N);var C=N.split(".")[0];if(E||a||i=="ipad"||o&&(C==3||C>=4&&!S)||T.silk)T.tablet=e;else if(S||i=="iphone"||i=="ipod"||o||u||T.blackberry||T.webos||T.bada)T.mobile=e;return T.msedge||T.msie&&T.version>=10||T.yandexbrowser&&T.version>=15||T.vivaldi&&T.version>=1||T.chrome&&T.version>=20||T.samsungBrowser&&T.version>=4||T.firefox&&T.version>=20||T.safari&&T.version>=6||T.opera&&T.version>=10||T.ios&&T.osversion&&T.osversion.split(".")[0]>=6||T.blackberry&&T.version>=10.1||T.chromium&&T.version>=20?T.a=e:T.msie&&T.version<10||T.chrome&&T.version<20||T.firefox&&T.version<20||T.safari&&T.version<6||T.opera&&T.version<10||T.ios&&T.osversion&&T.osversion.split(".")[0]<6||T.chromium&&T.version<20?T.c=e:T.x=e,T}function r(e){return e.split(".").length}function i(e,t){var n=[],r;if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function s(e){var t=Math.max(r(e[0]),r(e[1])),n=i(e,function(e){var n=t-r(e);return e+=(new Array(n+1)).join(".0"),i(e.split("."),function(e){return(new Array(20-e.length)).join("0")+e}).reverse()});while(--t>=0){if(n[0][t]>n[1][t])return 1;if(n[0][t]!==n[1][t])return-1;if(t===0)return 0}}function o(e,r,i){var o=n;typeof r=="string"&&(i=r,r=void 0),r===void 0&&(r=!1),i&&(o=t(i));var u=""+o.version;for(var a in e)if(e.hasOwnProperty(a)&&o[a]){if(typeof e[a]!="string")throw new Error("Browser version in the minVersion map should be a string: "+a+": "+String(e));return s([u,e[a]])<0}return r}function u(e,t,n){return!o(e,t,n)}var e=!0,n=t(typeof navigator!="undefined"?navigator.userAgent||"":"");return n.test=function(e){for(var t=0;t<e.length;++t){var r=e[t];if(typeof r=="string"&&r in n)return!0}return!1},n.isUnsupportedBrowser=o,n.compareVersions=s,n.check=u,n._detect=t,n})


var _window = getBodyDimensions(window)
var _browser = {
  name: bowser.name.toLowerCase(),
  os: getBrowserOS(),
  version: bowser.version,
  supported: !bowser.isUnsupportedBrowser() || bowser.a,
  size: getBrowserSize(_window)
}
_browser.size.orientation = _browser.size.height > _browser.size.width && "portrait" || "landscape"

getBrowserPlatform(_browser)

function getBodyDimensions(window_obj) {
    var desktopHeightLimit = 690;
    var desktopWidthLimit= 767;
    var bodyRect = document.body.getBoundingClientRect();
    var isDesktop = (bodyRect.height >= desktopHeightLimit && bodyRect.width >= desktopWidthLimit);
    return {height:bodyRect.height, width: bodyRect.width, desktop: isDesktop, mobile: !isDesktop, open: openWindowFunc(window_obj)}

    function openWindowFunc(window_obj) {
      return function(url, is_external) {
        window_obj.open(url, is_external && '_blank');
      }
    }
};

function getBrowserSize(_window) {
  var browserTypes =['mobile', 'desktop'];
  var browserType = (bowser.mobile && 'mobile') || (bowser.tablet && 'tablet') || 'desktop'
  var resultType = {
    width: _window.width,
    height: _window.height,
    type: browserType || 'desktop'
  }
  resultType[browserType] = true;
  return resultType
}


function getBrowserOS(_window) {
  var osType =['mac', 'windows', 'linux', 'chromeos', 'android', 'ios', 'blackberry', 'firefoxos', 'webos', 'bada', 'tizen', 'sailfish'];
  var osTypes = osType.filter(function(os) {return os in bowser && os})
  osType = osTypes.length && osTypes[0] || 'unknown';
  var result = {type: osType, version: 'osversion' in bowser && bowser.osversion};
  osTypes.forEach(function(os) {
    result[os] = true
  })
  return result;
}

function getBrowserPlatform(browser_obj) {
  var browserTypes = ["chrome", "firefox", "msie", "msedge", "safari", "android", "ios", "opera", "samsungBrowser", "phantom", "blackberry", "webos", ]
  var engines = ["webkit", "blink", "gecko"];
  var result = {};
  result.name = browserTypes.filter(function(platform) {return platform in bowser && platform}) || 'unknown'
  result.engine = engines.filter(function(e) {return e in bowser && e})
  browser_obj.platform = result;
  browser_obj.engine = result.engine.length && result.engine[0] || 'unknown';
  browser_obj[result.engine[0]] = true;
  result.name.forEach(function(name) {
    browser_obj[name] = true;
  })
}



// Snap.svg 0.4.1
//
// Copyright (c) 2013 – 2015 Adobe Systems Incorporated. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
// build: 2015-04-13

!function(a){var b,c,d="0.4.2",e="hasOwnProperty",f=/[\.\/]/,g=/\s*,\s*/,h="*",i=function(a,b){return a-b},j={n:{}},k=function(){for(var a=0,b=this.length;b>a;a++)if("undefined"!=typeof this[a])return this[a]},l=function(){for(var a=this.length;--a;)if("undefined"!=typeof this[a])return this[a]},m=function(a,d){a=String(a);var e,f=c,g=Array.prototype.slice.call(arguments,2),h=m.listeners(a),j=0,n=[],o={},p=[],q=b;p.firstDefined=k,p.lastDefined=l,b=a,c=0;for(var r=0,s=h.length;s>r;r++)"zIndex"in h[r]&&(n.push(h[r].zIndex),h[r].zIndex<0&&(o[h[r].zIndex]=h[r]));for(n.sort(i);n[j]<0;)if(e=o[n[j++]],p.push(e.apply(d,g)),c)return c=f,p;for(r=0;s>r;r++)if(e=h[r],"zIndex"in e)if(e.zIndex==n[j]){if(p.push(e.apply(d,g)),c)break;do if(j++,e=o[n[j]],e&&p.push(e.apply(d,g)),c)break;while(e)}else o[e.zIndex]=e;else if(p.push(e.apply(d,g)),c)break;return c=f,b=q,p};m._events=j,m.listeners=function(a){var b,c,d,e,g,i,k,l,m=a.split(f),n=j,o=[n],p=[];for(e=0,g=m.length;g>e;e++){for(l=[],i=0,k=o.length;k>i;i++)for(n=o[i].n,c=[n[m[e]],n[h]],d=2;d--;)b=c[d],b&&(l.push(b),p=p.concat(b.f||[]));o=l}return p},m.on=function(a,b){if(a=String(a),"function"!=typeof b)return function(){};for(var c=a.split(g),d=0,e=c.length;e>d;d++)!function(a){for(var c,d=a.split(f),e=j,g=0,h=d.length;h>g;g++)e=e.n,e=e.hasOwnProperty(d[g])&&e[d[g]]||(e[d[g]]={n:{}});for(e.f=e.f||[],g=0,h=e.f.length;h>g;g++)if(e.f[g]==b){c=!0;break}!c&&e.f.push(b)}(c[d]);return function(a){+a==+a&&(b.zIndex=+a)}},m.f=function(a){var b=[].slice.call(arguments,1);return function(){m.apply(null,[a,null].concat(b).concat([].slice.call(arguments,0)))}},m.stop=function(){c=1},m.nt=function(a){return a?new RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(b):b},m.nts=function(){return b.split(f)},m.off=m.unbind=function(a,b){if(!a)return void(m._events=j={n:{}});var c=a.split(g);if(c.length>1)for(var d=0,i=c.length;i>d;d++)m.off(c[d],b);else{c=a.split(f);var k,l,n,d,i,o,p,q=[j];for(d=0,i=c.length;i>d;d++)for(o=0;o<q.length;o+=n.length-2){if(n=[o,1],k=q[o].n,c[d]!=h)k[c[d]]&&n.push(k[c[d]]);else for(l in k)k[e](l)&&n.push(k[l]);q.splice.apply(q,n)}for(d=0,i=q.length;i>d;d++)for(k=q[d];k.n;){if(b){if(k.f){for(o=0,p=k.f.length;p>o;o++)if(k.f[o]==b){k.f.splice(o,1);break}!k.f.length&&delete k.f}for(l in k.n)if(k.n[e](l)&&k.n[l].f){var r=k.n[l].f;for(o=0,p=r.length;p>o;o++)if(r[o]==b){r.splice(o,1);break}!r.length&&delete k.n[l].f}}else{delete k.f;for(l in k.n)k.n[e](l)&&k.n[l].f&&delete k.n[l].f}k=k.n}}},m.once=function(a,b){var c=function(){return m.unbind(a,c),b.apply(this,arguments)};return m.on(a,c)},m.version=d,m.toString=function(){return"You are running Eve "+d},"undefined"!=typeof module&&module.exports?module.exports=m:"function"==typeof define&&define.amd?define("eve",[],function(){return m}):a.eve=m}(this),function(a,b){if("function"==typeof define&&define.amd)define(["eve"],function(c){return b(a,c)});else if("undefined"!=typeof exports){var c=require("eve");module.exports=b(a,c)}else b(a,a.eve)}(window||this,function(a,b){var c=function(b){var c={},d=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){setTimeout(a,16)},e=Array.isArray||function(a){return a instanceof Array||"[object Array]"==Object.prototype.toString.call(a)},f=0,g="M"+(+new Date).toString(36),h=function(){return g+(f++).toString(36)},i=Date.now||function(){return+new Date},j=function(a){var b=this;if(null==a)return b.s;var c=b.s-a;b.b+=b.dur*c,b.B+=b.dur*c,b.s=a},k=function(a){var b=this;return null==a?b.spd:void(b.spd=a)},l=function(a){var b=this;return null==a?b.dur:(b.s=b.s*a/b.dur,void(b.dur=a))},m=function(){var a=this;delete c[a.id],a.update(),b("mina.stop."+a.id,a)},n=function(){var a=this;a.pdif||(delete c[a.id],a.update(),a.pdif=a.get()-a.b)},o=function(){var a=this;a.pdif&&(a.b=a.get()-a.pdif,delete a.pdif,c[a.id]=a)},p=function(){var a,b=this;if(e(b.start)){a=[];for(var c=0,d=b.start.length;d>c;c++)a[c]=+b.start[c]+(b.end[c]-b.start[c])*b.easing(b.s)}else a=+b.start+(b.end-b.start)*b.easing(b.s);b.set(a)},q=function(){var a=0;for(var e in c)if(c.hasOwnProperty(e)){var f=c[e],g=f.get();a++,f.s=(g-f.b)/(f.dur/f.spd),f.s>=1&&(delete c[e],f.s=1,a--,function(a){setTimeout(function(){b("mina.finish."+a.id,a)})}(f)),f.update()}a&&d(q)},r=function(a,b,e,f,g,i,s){var t={id:h(),start:a,end:b,b:e,s:0,dur:f-e,spd:1,get:g,set:i,easing:s||r.linear,status:j,speed:k,duration:l,stop:m,pause:n,resume:o,update:p};c[t.id]=t;var u,v=0;for(u in c)if(c.hasOwnProperty(u)&&(v++,2==v))break;return 1==v&&d(q),t};return r.time=i,r.getById=function(a){return c[a]||null},r.linear=function(a){return a},r.easeout=function(a){return Math.pow(a,1.7)},r.easein=function(a){return Math.pow(a,.48)},r.easeinout=function(a){if(1==a)return 1;if(0==a)return 0;var b=.48-a/1.04,c=Math.sqrt(.1734+b*b),d=c-b,e=Math.pow(Math.abs(d),1/3)*(0>d?-1:1),f=-c-b,g=Math.pow(Math.abs(f),1/3)*(0>f?-1:1),h=e+g+.5;return 3*(1-h)*h*h+h*h*h},r.backin=function(a){if(1==a)return 1;var b=1.70158;return a*a*((b+1)*a-b)},r.backout=function(a){if(0==a)return 0;a-=1;var b=1.70158;return a*a*((b+1)*a+b)+1},r.elastic=function(a){return a==!!a?a:Math.pow(2,-10*a)*Math.sin(2*(a-.075)*Math.PI/.3)+1},r.bounce=function(a){var b,c=7.5625,d=2.75;return 1/d>a?b=c*a*a:2/d>a?(a-=1.5/d,b=c*a*a+.75):2.5/d>a?(a-=2.25/d,b=c*a*a+.9375):(a-=2.625/d,b=c*a*a+.984375),b},a.mina=r,r}("undefined"==typeof b?function(){}:b),d=function(a){function c(a,b){if(a){if(a.nodeType)return w(a);if(e(a,"array")&&c.set)return c.set.apply(c,a);if(a instanceof s)return a;if(null==b)return a=y.doc.querySelector(String(a)),w(a)}return a=null==a?"100%":a,b=null==b?"100%":b,new v(a,b)}function d(a,b){if(b){if("#text"==a&&(a=y.doc.createTextNode(b.text||b["#text"]||"")),"#comment"==a&&(a=y.doc.createComment(b.text||b["#text"]||"")),"string"==typeof a&&(a=d(a)),"string"==typeof b)return 1==a.nodeType?"xlink:"==b.substring(0,6)?a.getAttributeNS(T,b.substring(6)):"xml:"==b.substring(0,4)?a.getAttributeNS(U,b.substring(4)):a.getAttribute(b):"text"==b?a.nodeValue:null;if(1==a.nodeType){for(var c in b)if(b[z](c)){var e=A(b[c]);e?"xlink:"==c.substring(0,6)?a.setAttributeNS(T,c.substring(6),e):"xml:"==c.substring(0,4)?a.setAttributeNS(U,c.substring(4),e):a.setAttribute(c,e):a.removeAttribute(c)}}else"text"in b&&(a.nodeValue=b.text)}else a=y.doc.createElementNS(U,a);return a}function e(a,b){return b=A.prototype.toLowerCase.call(b),"finite"==b?isFinite(a):"array"==b&&(a instanceof Array||Array.isArray&&Array.isArray(a))?!0:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||J.call(a).slice(8,-1).toLowerCase()==b}function f(a){if("function"==typeof a||Object(a)!==a)return a;var b=new a.constructor;for(var c in a)a[z](c)&&(b[c]=f(a[c]));return b}function h(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return a.push(a.splice(c,1)[0])}function i(a,b,c){function d(){var e=Array.prototype.slice.call(arguments,0),f=e.join("␀"),g=d.cache=d.cache||{},i=d.count=d.count||[];return g[z](f)?(h(i,f),c?c(g[f]):g[f]):(i.length>=1e3&&delete g[i.shift()],i.push(f),g[f]=a.apply(b,e),c?c(g[f]):g[f])}return d}function j(a,b,c,d,e,f){if(null==e){var g=a-c,h=b-d;return g||h?(180+180*D.atan2(-h,-g)/H+360)%360:0}return j(a,b,e,f)-j(c,d,e,f)}function k(a){return a%360*H/180}function l(a){return 180*a/H%360}function m(a){var b=[];return a=a.replace(/(?:^|\s)(\w+)\(([^)]+)\)/g,function(a,c,d){return d=d.split(/\s*,\s*|\s+/),"rotate"==c&&1==d.length&&d.push(0,0),"scale"==c&&(d.length>2?d=d.slice(0,2):2==d.length&&d.push(0,0),1==d.length&&d.push(d[0],0,0)),b.push("skewX"==c?["m",1,0,D.tan(k(d[0])),1,0,0]:"skewY"==c?["m",1,D.tan(k(d[0])),0,1,0,0]:[c.charAt(0)].concat(d)),a}),b}function n(a,b){var d=ab(a),e=new c.Matrix;if(d)for(var f=0,g=d.length;g>f;f++){var h,i,j,k,l,m=d[f],n=m.length,o=A(m[0]).toLowerCase(),p=m[0]!=o,q=p?e.invert():0;"t"==o&&2==n?e.translate(m[1],0):"t"==o&&3==n?p?(h=q.x(0,0),i=q.y(0,0),j=q.x(m[1],m[2]),k=q.y(m[1],m[2]),e.translate(j-h,k-i)):e.translate(m[1],m[2]):"r"==o?2==n?(l=l||b,e.rotate(m[1],l.x+l.width/2,l.y+l.height/2)):4==n&&(p?(j=q.x(m[2],m[3]),k=q.y(m[2],m[3]),e.rotate(m[1],j,k)):e.rotate(m[1],m[2],m[3])):"s"==o?2==n||3==n?(l=l||b,e.scale(m[1],m[n-1],l.x+l.width/2,l.y+l.height/2)):4==n?p?(j=q.x(m[2],m[3]),k=q.y(m[2],m[3]),e.scale(m[1],m[1],j,k)):e.scale(m[1],m[1],m[2],m[3]):5==n&&(p?(j=q.x(m[3],m[4]),k=q.y(m[3],m[4]),e.scale(m[1],m[2],j,k)):e.scale(m[1],m[2],m[3],m[4])):"m"==o&&7==n&&e.add(m[1],m[2],m[3],m[4],m[5],m[6])}return e}function o(a){var b=a.node.ownerSVGElement&&w(a.node.ownerSVGElement)||a.node.parentNode&&w(a.node.parentNode)||c.select("svg")||c(0,0),d=b.select("defs"),e=null==d?!1:d.node;return e||(e=u("defs",b.node).node),e}function p(a){return a.node.ownerSVGElement&&w(a.node.ownerSVGElement)||c.select("svg")}function q(a,b,c){function e(a){if(null==a)return I;if(a==+a)return a;d(j,{width:a});try{return j.getBBox().width}catch(b){return 0}}function f(a){if(null==a)return I;if(a==+a)return a;d(j,{height:a});try{return j.getBBox().height}catch(b){return 0}}function g(d,e){null==b?i[d]=e(a.attr(d)||0):d==b&&(i=e(null==c?a.attr(d)||0:c))}var h=p(a).node,i={},j=h.querySelector(".svg---mgr");switch(j||(j=d("rect"),d(j,{x:-9e9,y:-9e9,width:10,height:10,"class":"svg---mgr",fill:"none"}),h.appendChild(j)),a.type){case"rect":g("rx",e),g("ry",f);case"image":g("width",e),g("height",f);case"text":g("x",e),g("y",f);break;case"circle":g("cx",e),g("cy",f),g("r",e);break;case"ellipse":g("cx",e),g("cy",f),g("rx",e),g("ry",f);break;case"line":g("x1",e),g("x2",e),g("y1",f),g("y2",f);break;case"marker":g("refX",e),g("markerWidth",e),g("refY",f),g("markerHeight",f);break;case"radialGradient":g("fx",e),g("fy",f);break;case"tspan":g("dx",e),g("dy",f);break;default:g(b,e)}return h.removeChild(j),i}function r(a){e(a,"array")||(a=Array.prototype.slice.call(arguments,0));for(var b=0,c=0,d=this.node;this[b];)delete this[b++];for(b=0;b<a.length;b++)"set"==a[b].type?a[b].forEach(function(a){d.appendChild(a.node)}):d.appendChild(a[b].node);var f=d.childNodes;for(b=0;b<f.length;b++)this[c++]=w(f[b]);return this}function s(a){if(a.snap in V)return V[a.snap];var b;try{b=a.ownerSVGElement}catch(c){}this.node=a,b&&(this.paper=new v(b)),this.type=a.tagName||a.nodeName;var d=this.id=S(this);if(this.anims={},this._={transform:[]},a.snap=d,V[d]=this,"g"==this.type&&(this.add=r),this.type in{g:1,mask:1,pattern:1,symbol:1})for(var e in v.prototype)v.prototype[z](e)&&(this[e]=v.prototype[e])}function t(a){this.node=a}function u(a,b){var c=d(a);b.appendChild(c);var e=w(c);return e}function v(a,b){var c,e,f,g=v.prototype;if(a&&"svg"==a.tagName){if(a.snap in V)return V[a.snap];var h=a.ownerDocument;c=new s(a),e=a.getElementsByTagName("desc")[0],f=a.getElementsByTagName("defs")[0],e||(e=d("desc"),e.appendChild(h.createTextNode("Created with Snap")),c.node.appendChild(e)),f||(f=d("defs"),c.node.appendChild(f)),c.defs=f;for(var i in g)g[z](i)&&(c[i]=g[i]);c.paper=c.root=c}else c=u("svg",y.doc.body),d(c.node,{height:b,version:1.1,width:a,xmlns:U});return c}function w(a){return a?a instanceof s||a instanceof t?a:a.tagName&&"svg"==a.tagName.toLowerCase()?new v(a):a.tagName&&"object"==a.tagName.toLowerCase()&&"image/svg+xml"==a.type?new v(a.contentDocument.getElementsByTagName("svg")[0]):new s(a):a}function x(a,b){for(var c=0,d=a.length;d>c;c++){var e={type:a[c].type,attr:a[c].attr()},f=a[c].children();b.push(e),f.length&&x(f,e.childNodes=[])}}c.version="0.4.0",c.toString=function(){return"Snap v"+this.version},c._={};var y={win:a.window,doc:a.window.document};c._.glob=y;{var z="hasOwnProperty",A=String,B=parseFloat,C=parseInt,D=Math,E=D.max,F=D.min,G=D.abs,H=(D.pow,D.PI),I=(D.round,""),J=Object.prototype.toString,K=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\))\s*$/i,L=(c._.separator=/[,\s]+/,/[\s]*,[\s]*/),M={hs:1,rg:1},N=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,O=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,P=/(-?\d*\.?\d*(?:e[\-+]?\\d+)?)[\s]*,?[\s]*/gi,Q=0,R="S"+(+new Date).toString(36),S=function(a){return(a&&a.type?a.type:I)+R+(Q++).toString(36)},T="http://www.w3.org/1999/xlink",U="http://www.w3.org/2000/svg",V={};c.url=function(a){return"url('#"+a+"')"}}c._.$=d,c._.id=S,c.format=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;return c.replace(b,function(a,b,c,d,f){b=b||d,e&&(b in e&&(e=e[b]),"function"==typeof e&&f&&(e=e()))}),e=(null==e||e==d?a:e)+""};return function(b,d){return A(b).replace(a,function(a,b){return c(a,b,d)})}}(),c._.clone=f,c._.cacher=i,c.rad=k,c.deg=l,c.sin=function(a){return D.sin(c.rad(a))},c.tan=function(a){return D.tan(c.rad(a))},c.cos=function(a){return D.cos(c.rad(a))},c.asin=function(a){return c.deg(D.asin(a))},c.acos=function(a){return c.deg(D.acos(a))},c.atan=function(a){return c.deg(D.atan(a))},c.atan2=function(a){return c.deg(D.atan2(a))},c.angle=j,c.len=function(a,b,d,e){return Math.sqrt(c.len2(a,b,d,e))},c.len2=function(a,b,c,d){return(a-c)*(a-c)+(b-d)*(b-d)},c.closestPoint=function(a,b,c){function d(a){var d=a.x-b,e=a.y-c;return d*d+e*e}for(var e,f,g,h,i=a.node,j=i.getTotalLength(),k=j/i.pathSegList.numberOfItems*.125,l=1/0,m=0;j>=m;m+=k)(h=d(g=i.getPointAtLength(m)))<l&&(e=g,f=m,l=h);for(k*=.5;k>.5;){var n,o,p,q,r,s;(p=f-k)>=0&&(r=d(n=i.getPointAtLength(p)))<l?(e=n,f=p,l=r):(q=f+k)<=j&&(s=d(o=i.getPointAtLength(q)))<l?(e=o,f=q,l=s):k*=.5}return e={x:e.x,y:e.y,length:f,distance:Math.sqrt(l)}},c.is=e,c.snapTo=function(a,b,c){if(c=e(c,"finite")?c:10,e(a,"array")){for(var d=a.length;d--;)if(G(a[d]-b)<=c)return a[d]}else{a=+a;var f=b%a;if(c>f)return b-f;if(f>a-c)return b-f+a}return b},c.getRGB=i(function(a){if(!a||(a=A(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Z};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:Z};if(!(M[z](a.toLowerCase().substring(0,2))||"#"==a.charAt())&&(a=W(a)),!a)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Z};var b,d,f,g,h,i,j=a.match(K);return j?(j[2]&&(f=C(j[2].substring(5),16),d=C(j[2].substring(3,5),16),b=C(j[2].substring(1,3),16)),j[3]&&(f=C((h=j[3].charAt(3))+h,16),d=C((h=j[3].charAt(2))+h,16),b=C((h=j[3].charAt(1))+h,16)),j[4]&&(i=j[4].split(L),b=B(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=B(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),f=B(i[2]),"%"==i[2].slice(-1)&&(f*=2.55),"rgba"==j[1].toLowerCase().slice(0,4)&&(g=B(i[3])),i[3]&&"%"==i[3].slice(-1)&&(g/=100)),j[5]?(i=j[5].split(L),b=B(i[0]),"%"==i[0].slice(-1)&&(b/=100),d=B(i[1]),"%"==i[1].slice(-1)&&(d/=100),f=B(i[2]),"%"==i[2].slice(-1)&&(f/=100),("deg"==i[0].slice(-3)||"°"==i[0].slice(-1))&&(b/=360),"hsba"==j[1].toLowerCase().slice(0,4)&&(g=B(i[3])),i[3]&&"%"==i[3].slice(-1)&&(g/=100),c.hsb2rgb(b,d,f,g)):j[6]?(i=j[6].split(L),b=B(i[0]),"%"==i[0].slice(-1)&&(b/=100),d=B(i[1]),"%"==i[1].slice(-1)&&(d/=100),f=B(i[2]),"%"==i[2].slice(-1)&&(f/=100),("deg"==i[0].slice(-3)||"°"==i[0].slice(-1))&&(b/=360),"hsla"==j[1].toLowerCase().slice(0,4)&&(g=B(i[3])),i[3]&&"%"==i[3].slice(-1)&&(g/=100),c.hsl2rgb(b,d,f,g)):(b=F(D.round(b),255),d=F(D.round(d),255),f=F(D.round(f),255),g=F(E(g,0),1),j={r:b,g:d,b:f,toString:Z},j.hex="#"+(16777216|f|d<<8|b<<16).toString(16).slice(1),j.opacity=e(g,"finite")?g:1,j)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Z}},c),c.hsb=i(function(a,b,d){return c.hsb2rgb(a,b,d).hex}),c.hsl=i(function(a,b,d){return c.hsl2rgb(a,b,d).hex}),c.rgb=i(function(a,b,c,d){if(e(d,"finite")){var f=D.round;return"rgba("+[f(a),f(b),f(c),+d.toFixed(2)]+")"}return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)});var W=function(a){var b=y.doc.getElementsByTagName("head")[0]||y.doc.getElementsByTagName("svg")[0],c="rgb(255, 0, 0)";return(W=i(function(a){if("red"==a.toLowerCase())return c;b.style.color=c,b.style.color=a;var d=y.doc.defaultView.getComputedStyle(b,I).getPropertyValue("color");return d==c?null:d}))(a)},X=function(){return"hsb("+[this.h,this.s,this.b]+")"},Y=function(){return"hsl("+[this.h,this.s,this.l]+")"},Z=function(){return 1==this.opacity||null==this.opacity?this.hex:"rgba("+[this.r,this.g,this.b,this.opacity]+")"},$=function(a,b,d){if(null==b&&e(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(d=a.b,b=a.g,a=a.r),null==b&&e(a,string)){var f=c.getRGB(a);a=f.r,b=f.g,d=f.b}return(a>1||b>1||d>1)&&(a/=255,b/=255,d/=255),[a,b,d]},_=function(a,b,d,f){a=D.round(255*a),b=D.round(255*b),d=D.round(255*d);var g={r:a,g:b,b:d,opacity:e(f,"finite")?f:1,hex:c.rgb(a,b,d),toString:Z};return e(f,"finite")&&(g.opacity=f),g};c.color=function(a){var b;return e(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=c.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.opacity=1,a.hex=b.hex):e(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=c.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.opacity=1,a.hex=b.hex):(e(a,"string")&&(a=c.getRGB(a)),e(a,"object")&&"r"in a&&"g"in a&&"b"in a&&!("error"in a)?(b=c.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=c.rgb2hsb(a),a.v=b.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1,a.error=1)),a.toString=Z,a},c.hsb2rgb=function(a,b,c,d){e(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,d=a.o,a=a.h),a*=360;var f,g,h,i,j;return a=a%360/60,j=c*b,i=j*(1-G(a%2-1)),f=g=h=c-j,a=~~a,f+=[j,i,0,0,i,j][a],g+=[i,j,j,i,0,0][a],h+=[0,0,i,j,j,i][a],_(f,g,h,d)},c.hsl2rgb=function(a,b,c,d){e(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h),(a>1||b>1||c>1)&&(a/=360,b/=100,c/=100),a*=360;var f,g,h,i,j;return a=a%360/60,j=2*b*(.5>c?c:1-c),i=j*(1-G(a%2-1)),f=g=h=c-j/2,a=~~a,f+=[j,i,0,0,i,j][a],g+=[i,j,j,i,0,0][a],h+=[0,0,i,j,j,i][a],_(f,g,h,d)},c.rgb2hsb=function(a,b,c){c=$(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g;return f=E(a,b,c),g=f-F(a,b,c),d=0==g?null:f==a?(b-c)/g:f==b?(c-a)/g+2:(a-b)/g+4,d=(d+360)%6*60/360,e=0==g?0:g/f,{h:d,s:e,b:f,toString:X}},c.rgb2hsl=function(a,b,c){c=$(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g,h,i;return g=E(a,b,c),h=F(a,b,c),i=g-h,d=0==i?null:g==a?(b-c)/i:g==b?(c-a)/i+2:(a-b)/i+4,d=(d+360)%6*60/360,f=(g+h)/2,e=0==i?0:.5>f?i/(2*f):i/(2-2*f),{h:d,s:e,l:f,toString:Y}},c.parsePathString=function(a){if(!a)return null;var b=c.path(a);if(b.arr)return c.path.clone(b.arr);var d={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},f=[];return e(a,"array")&&e(a[0],"array")&&(f=c.path.clone(a)),f.length||A(a).replace(N,function(a,b,c){var e=[],g=b.toLowerCase();if(c.replace(P,function(a,b){b&&e.push(+b)}),"m"==g&&e.length>2&&(f.push([b].concat(e.splice(0,2))),g="l",b="m"==b?"l":"L"),"o"==g&&1==e.length&&f.push([b,e[0]]),"r"==g)f.push([b].concat(e));else for(;e.length>=d[g]&&(f.push([b].concat(e.splice(0,d[g]))),d[g]););}),f.toString=c.path.toString,b.arr=c.path.clone(f),f};var ab=c.parseTransformString=function(a){if(!a)return null;var b=[];return e(a,"array")&&e(a[0],"array")&&(b=c.path.clone(a)),b.length||A(a).replace(O,function(a,c,d){{var e=[];c.toLowerCase()}d.replace(P,function(a,b){b&&e.push(+b)}),b.push([c].concat(e))}),b.toString=c.path.toString,b};c._.svgTransform2string=m,c._.rgTransform=/^[a-z][\s]*-?\.?\d/i,c._.transform2matrix=n,c._unit2px=q;y.doc.contains||y.doc.compareDocumentPosition?function(a,b){var c=9==a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a==d||!(!d||1!=d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b;)if(b=b.parentNode,b==a)return!0;return!1};c._.getSomeDefs=o,c._.getSomeSVG=p,c.select=function(a){return a=A(a).replace(/([^\\]):/g,"$1\\:"),w(y.doc.querySelector(a))},c.selectAll=function(a){for(var b=y.doc.querySelectorAll(a),d=(c.set||Array)(),e=0;e<b.length;e++)d.push(w(b[e]));return d},setInterval(function(){for(var a in V)if(V[z](a)){var b=V[a],c=b.node;("svg"!=b.type&&!c.ownerSVGElement||"svg"==b.type&&(!c.parentNode||"ownerSVGElement"in c.parentNode&&!c.ownerSVGElement))&&delete V[a]}},1e4),s.prototype.attr=function(a,c){var d=this,f=d.node;if(!a){if(1!=f.nodeType)return{text:f.nodeValue};for(var g=f.attributes,h={},i=0,j=g.length;j>i;i++)h[g[i].nodeName]=g[i].nodeValue;return h}if(e(a,"string")){if(!(arguments.length>1))return b("snap.util.getattr."+a,d).firstDefined();var k={};k[a]=c,a=k}for(var l in a)a[z](l)&&b("snap.util.attr."+l,d,a[l]);return d},c.parse=function(a){var b=y.doc.createDocumentFragment(),c=!0,d=y.doc.createElement("div");if(a=A(a),a.match(/^\s*<\s*svg(?:\s|>)/)||(a="<svg>"+a+"</svg>",c=!1),d.innerHTML=a,a=d.getElementsByTagName("svg")[0])if(c)b=a;else for(;a.firstChild;)b.appendChild(a.firstChild);return new t(b)},c.fragment=function(){for(var a=Array.prototype.slice.call(arguments,0),b=y.doc.createDocumentFragment(),d=0,e=a.length;e>d;d++){var f=a[d];f.node&&f.node.nodeType&&b.appendChild(f.node),f.nodeType&&b.appendChild(f),"string"==typeof f&&b.appendChild(c.parse(f).node)}return new t(b)},c._.make=u,c._.wrap=w,v.prototype.el=function(a,b){var c=u(a,this.node);return b&&c.attr(b),c},s.prototype.children=function(){for(var a=[],b=this.node.childNodes,d=0,e=b.length;e>d;d++)a[d]=c(b[d]);return a},s.prototype.toJSON=function(){var a=[];return x([this],a),a[0]},b.on("snap.util.getattr",function(){var a=b.nt();a=a.substring(a.lastIndexOf(".")+1);var c=a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()});return bb[z](c)?this.node.ownerDocument.defaultView.getComputedStyle(this.node,null).getPropertyValue(c):d(this.node,a)});var bb={"alignment-baseline":0,"baseline-shift":0,clip:0,"clip-path":0,"clip-rule":0,color:0,"color-interpolation":0,"color-interpolation-filters":0,"color-profile":0,"color-rendering":0,cursor:0,direction:0,display:0,"dominant-baseline":0,"enable-background":0,fill:0,"fill-opacity":0,"fill-rule":0,filter:0,"flood-color":0,"flood-opacity":0,font:0,"font-family":0,"font-size":0,"font-size-adjust":0,"font-stretch":0,"font-style":0,"font-variant":0,"font-weight":0,"glyph-orientation-horizontal":0,"glyph-orientation-vertical":0,"image-rendering":0,kerning:0,"letter-spacing":0,"lighting-color":0,marker:0,"marker-end":0,"marker-mid":0,"marker-start":0,mask:0,opacity:0,overflow:0,"pointer-events":0,"shape-rendering":0,"stop-color":0,"stop-opacity":0,stroke:0,"stroke-dasharray":0,"stroke-dashoffset":0,"stroke-linecap":0,"stroke-linejoin":0,"stroke-miterlimit":0,"stroke-opacity":0,"stroke-width":0,"text-anchor":0,"text-decoration":0,"text-rendering":0,"unicode-bidi":0,visibility:0,"word-spacing":0,"writing-mode":0};b.on("snap.util.attr",function(a){var c=b.nt(),e={};c=c.substring(c.lastIndexOf(".")+1),e[c]=a;var f=c.replace(/-(\w)/gi,function(a,b){return b.toUpperCase()}),g=c.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()});bb[z](g)?this.node.style[f]=null==a?I:a:d(this.node,e)}),function(){}(v.prototype),c.ajax=function(a,c,d,f){var g=new XMLHttpRequest,h=S();if(g){if(e(c,"function"))f=d,d=c,c=null;else if(e(c,"object")){var i=[];for(var j in c)c.hasOwnProperty(j)&&i.push(encodeURIComponent(j)+"="+encodeURIComponent(c[j]));c=i.join("&")}return g.open(c?"POST":"GET",a,!0),c&&(g.setRequestHeader("X-Requested-With","XMLHttpRequest"),g.setRequestHeader("Content-type","application/x-www-form-urlencoded")),d&&(b.once("snap.ajax."+h+".0",d),b.once("snap.ajax."+h+".200",d),b.once("snap.ajax."+h+".304",d)),g.onreadystatechange=function(){4==g.readyState&&b("snap.ajax."+h+"."+g.status,f,g)},4==g.readyState?g:(g.send(c),g)}},c.load=function(a,b,d){c.ajax(a,function(a){var e=c.parse(a.responseText);d?b.call(d,e):b(e)})};var cb=function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,h=e.clientLeft||d.clientLeft||0,i=b.top+(g.win.pageYOffset||e.scrollTop||d.scrollTop)-f,j=b.left+(g.win.pageXOffset||e.scrollLeft||d.scrollLeft)-h;return{y:i,x:j}};return c.getElementByPoint=function(a,b){var c=this,d=(c.canvas,y.doc.elementFromPoint(a,b));if(y.win.opera&&"svg"==d.tagName){var e=cb(d),f=d.createSVGRect();f.x=a-e.x,f.y=b-e.y,f.width=f.height=1;var g=d.getIntersectionList(f,null);g.length&&(d=g[g.length-1])}return d?w(d):null},c.plugin=function(a){a(c,s,v,y,t)},y.win.Snap=c,c}(a||this);return d.plugin(function(d,e,f,g,h){function i(a,b){if(null==b){var c=!0;if(b=a.node.getAttribute("linearGradient"==a.type||"radialGradient"==a.type?"gradientTransform":"pattern"==a.type?"patternTransform":"transform"),!b)return new d.Matrix;b=d._.svgTransform2string(b)}else b=d._.rgTransform.test(b)?o(b).replace(/\.{3}|\u2026/g,a._.transform||""):d._.svgTransform2string(b),n(b,"array")&&(b=d.path?d.path.toString.call(b):o(b)),a._.transform=b;var e=d._.transform2matrix(b,a.getBBox(1));return c?e:void(a.matrix=e)}function j(a){function b(a,b){var c=q(a.node,b);c=c&&c.match(f),c=c&&c[2],c&&"#"==c.charAt()&&(c=c.substring(1),c&&(h[c]=(h[c]||[]).concat(function(c){var d={};d[b]=URL(c),q(a.node,d)})))}function c(a){var b=q(a.node,"xlink:href");b&&"#"==b.charAt()&&(b=b.substring(1),b&&(h[b]=(h[b]||[]).concat(function(b){a.attr("xlink:href","#"+b)})))}for(var d,e=a.selectAll("*"),f=/^\s*url\(("|'|)(.*)\1\)\s*$/,g=[],h={},i=0,j=e.length;j>i;i++){d=e[i],b(d,"fill"),b(d,"stroke"),b(d,"filter"),b(d,"mask"),b(d,"clip-path"),c(d);var k=q(d.node,"id");k&&(q(d.node,{id:d.id}),g.push({old:k,id:d.id}))}for(i=0,j=g.length;j>i;i++){var l=h[g[i].old];if(l)for(var m=0,n=l.length;n>m;m++)l[m](g[i].id)}}function k(a,b,c){return function(d){var e=d.slice(a,b);return 1==e.length&&(e=e[0]),c?c(e):e}}function l(a){return function(){var b=a?"<"+this.type:"",c=this.node.attributes,d=this.node.childNodes;if(a)for(var e=0,f=c.length;f>e;e++)b+=" "+c[e].name+'="'+c[e].value.replace(/"/g,'\\"')+'"';if(d.length){for(a&&(b+=">"),e=0,f=d.length;f>e;e++)3==d[e].nodeType?b+=d[e].nodeValue:1==d[e].nodeType&&(b+=u(d[e]).toString());a&&(b+="</"+this.type+">")}else a&&(b+="/>");return b}}var m=e.prototype,n=d.is,o=String,p=d._unit2px,q=d._.$,r=d._.make,s=d._.getSomeDefs,t="hasOwnProperty",u=d._.wrap;m.getBBox=function(a){if(!d.Matrix||!d.path)return this.node.getBBox();var b=this,c=new d.Matrix;if(b.removed)return d._.box();for(;"use"==b.type;)if(a||(c=c.add(b.transform().localMatrix.translate(b.attr("x")||0,b.attr("y")||0))),b.original)b=b.original;else{var e=b.attr("xlink:href");b=b.original=b.node.ownerDocument.getElementById(e.substring(e.indexOf("#")+1))}var f=b._,g=d.path.get[b.type]||d.path.get.deflt;try{return a?(f.bboxwt=g?d.path.getBBox(b.realPath=g(b)):d._.box(b.node.getBBox()),d._.box(f.bboxwt)):(b.realPath=g(b),b.matrix=b.transform().localMatrix,f.bbox=d.path.getBBox(d.path.map(b.realPath,c.add(b.matrix))),d._.box(f.bbox))}catch(h){return d._.box()}};var v=function(){return this.string};m.transform=function(a){var b=this._;if(null==a){for(var c,e=this,f=new d.Matrix(this.node.getCTM()),g=i(this),h=[g],j=new d.Matrix,k=g.toTransformString(),l=o(g)==o(this.matrix)?o(b.transform):k;"svg"!=e.type&&(e=e.parent());)h.push(i(e));for(c=h.length;c--;)j.add(h[c]);return{string:l,globalMatrix:f,totalMatrix:j,localMatrix:g,diffMatrix:f.clone().add(g.invert()),global:f.toTransformString(),total:j.toTransformString(),local:k,toString:v}}return a instanceof d.Matrix?(this.matrix=a,this._.transform=a.toTransformString()):i(this,a),this.node&&("linearGradient"==this.type||"radialGradient"==this.type?q(this.node,{gradientTransform:this.matrix}):"pattern"==this.type?q(this.node,{patternTransform:this.matrix}):q(this.node,{transform:this.matrix})),this},m.parent=function(){return u(this.node.parentNode)},m.append=m.add=function(a){if(a){if("set"==a.type){var b=this;return a.forEach(function(a){b.add(a)}),this}a=u(a),this.node.appendChild(a.node),a.paper=this.paper}return this},m.appendTo=function(a){return a&&(a=u(a),a.append(this)),this},m.prepend=function(a){if(a){if("set"==a.type){var b,c=this;return a.forEach(function(a){b?b.after(a):c.prepend(a),b=a}),this}a=u(a);var d=a.parent();this.node.insertBefore(a.node,this.node.firstChild),this.add&&this.add(),a.paper=this.paper,this.parent()&&this.parent().add(),d&&d.add()}return this},m.prependTo=function(a){return a=u(a),a.prepend(this),this},m.before=function(a){if("set"==a.type){var b=this;return a.forEach(function(a){var c=a.parent();b.node.parentNode.insertBefore(a.node,b.node),c&&c.add()}),this.parent().add(),this}a=u(a);var c=a.parent();return this.node.parentNode.insertBefore(a.node,this.node),this.parent()&&this.parent().add(),c&&c.add(),a.paper=this.paper,this},m.after=function(a){a=u(a);var b=a.parent();return this.node.nextSibling?this.node.parentNode.insertBefore(a.node,this.node.nextSibling):this.node.parentNode.appendChild(a.node),this.parent()&&this.parent().add(),b&&b.add(),a.paper=this.paper,this},m.insertBefore=function(a){a=u(a);var b=this.parent();return a.node.parentNode.insertBefore(this.node,a.node),this.paper=a.paper,b&&b.add(),a.parent()&&a.parent().add(),this},m.insertAfter=function(a){a=u(a);var b=this.parent();return a.node.parentNode.insertBefore(this.node,a.node.nextSibling),this.paper=a.paper,b&&b.add(),a.parent()&&a.parent().add(),this},m.remove=function(){var a=this.parent();return this.node.parentNode&&this.node.parentNode.removeChild(this.node),delete this.paper,this.removed=!0,a&&a.add(),this},m.select=function(a){return u(this.node.querySelector(a))},m.selectAll=function(a){for(var b=this.node.querySelectorAll(a),c=(d.set||Array)(),e=0;e<b.length;e++)c.push(u(b[e]));return c},m.asPX=function(a,b){return null==b&&(b=this.attr(a)),+p(this,a,b)},m.use=function(){var a,b=this.node.id;return b||(b=this.id,q(this.node,{id:b})),a="linearGradient"==this.type||"radialGradient"==this.type||"pattern"==this.type?r(this.type,this.node.parentNode):r("use",this.node.parentNode),q(a.node,{"xlink:href":"#"+b}),a.original=this,a},m.clone=function(){var a=u(this.node.cloneNode(!0));return q(a.node,"id")&&q(a.node,{id:a.id}),j(a),a.insertAfter(this),a},m.toDefs=function(){var a=s(this);return a.appendChild(this.node),this},m.pattern=m.toPattern=function(a,b,c,d){var e=r("pattern",s(this));return null==a&&(a=this.getBBox()),n(a,"object")&&"x"in a&&(b=a.y,c=a.width,d=a.height,a=a.x),q(e.node,{x:a,y:b,width:c,height:d,patternUnits:"userSpaceOnUse",id:e.id,viewBox:[a,b,c,d].join(" ")}),e.node.appendChild(this.node),e},m.marker=function(a,b,c,d,e,f){var g=r("marker",s(this));return null==a&&(a=this.getBBox()),n(a,"object")&&"x"in a&&(b=a.y,c=a.width,d=a.height,e=a.refX||a.cx,f=a.refY||a.cy,a=a.x),q(g.node,{viewBox:[a,b,c,d].join(" "),markerWidth:c,markerHeight:d,orient:"auto",refX:e||0,refY:f||0,id:g.id}),g.node.appendChild(this.node),g};var w=function(a,b,d,e){"function"!=typeof d||d.length||(e=d,d=c.linear),this.attr=a,this.dur=b,d&&(this.easing=d),e&&(this.callback=e)};d._.Animation=w,d.animation=function(a,b,c,d){return new w(a,b,c,d)},m.inAnim=function(){var a=this,b=[];for(var c in a.anims)a.anims[t](c)&&!function(a){b.push({anim:new w(a._attrs,a.dur,a.easing,a._callback),mina:a,curStatus:a.status(),status:function(b){return a.status(b)},stop:function(){a.stop()}})}(a.anims[c]);return b},d.animate=function(a,d,e,f,g,h){"function"!=typeof g||g.length||(h=g,g=c.linear);var i=c.time(),j=c(a,d,i,i+f,c.time,e,g);return h&&b.once("mina.finish."+j.id,h),j},m.stop=function(){for(var a=this.inAnim(),b=0,c=a.length;c>b;b++)a[b].stop();return this},m.animate=function(a,d,e,f){"function"!=typeof e||e.length||(f=e,e=c.linear),a instanceof w&&(f=a.callback,e=a.easing,d=a.dur,a=a.attr);var g,h,i,j,l=[],m=[],p={},q=this;for(var r in a)if(a[t](r)){q.equal?(j=q.equal(r,o(a[r])),g=j.from,h=j.to,i=j.f):(g=+q.attr(r),h=+a[r]);var s=n(g,"array")?g.length:1;p[r]=k(l.length,l.length+s,i),l=l.concat(g),m=m.concat(h)}var u=c.time(),v=c(l,m,u,u+d,c.time,function(a){var b={};for(var c in p)p[t](c)&&(b[c]=p[c](a));q.attr(b)},e);return q.anims[v.id]=v,v._attrs=a,v._callback=f,b("snap.animcreated."+q.id,v),b.once("mina.finish."+v.id,function(){delete q.anims[v.id],f&&f.call(q)}),b.once("mina.stop."+v.id,function(){delete q.anims[v.id]}),q};var x={};m.data=function(a,c){var e=x[this.id]=x[this.id]||{};if(0==arguments.length)return b("snap.data.get."+this.id,this,e,null),e;
if(1==arguments.length){if(d.is(a,"object")){for(var f in a)a[t](f)&&this.data(f,a[f]);return this}return b("snap.data.get."+this.id,this,e[a],a),e[a]}return e[a]=c,b("snap.data.set."+this.id,this,c,a),this},m.removeData=function(a){return null==a?x[this.id]={}:x[this.id]&&delete x[this.id][a],this},m.outerSVG=m.toString=l(1),m.innerSVG=l(),m.toDataURL=function(){if(a&&a.btoa){var b=this.getBBox(),c=d.format('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="{width}" height="{height}" viewBox="{x} {y} {width} {height}">{contents}</svg>',{x:+b.x.toFixed(3),y:+b.y.toFixed(3),width:+b.width.toFixed(3),height:+b.height.toFixed(3),contents:this.outerSVG()});return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(c)))}},h.prototype.select=m.select,h.prototype.selectAll=m.selectAll}),d.plugin(function(a){function b(a,b,d,e,f,g){return null==b&&"[object SVGMatrix]"==c.call(a)?(this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.e=a.e,void(this.f=a.f)):void(null!=a?(this.a=+a,this.b=+b,this.c=+d,this.d=+e,this.e=+f,this.f=+g):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0))}var c=Object.prototype.toString,d=String,e=Math,f="";!function(c){function g(a){return a[0]*a[0]+a[1]*a[1]}function h(a){var b=e.sqrt(g(a));a[0]&&(a[0]/=b),a[1]&&(a[1]/=b)}c.add=function(a,c,d,e,f,g){var h,i,j,k,l=[[],[],[]],m=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],n=[[a,d,f],[c,e,g],[0,0,1]];for(a&&a instanceof b&&(n=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]),h=0;3>h;h++)for(i=0;3>i;i++){for(k=0,j=0;3>j;j++)k+=m[h][j]*n[j][i];l[h][i]=k}return this.a=l[0][0],this.b=l[1][0],this.c=l[0][1],this.d=l[1][1],this.e=l[0][2],this.f=l[1][2],this},c.invert=function(){var a=this,c=a.a*a.d-a.b*a.c;return new b(a.d/c,-a.b/c,-a.c/c,a.a/c,(a.c*a.f-a.d*a.e)/c,(a.b*a.e-a.a*a.f)/c)},c.clone=function(){return new b(this.a,this.b,this.c,this.d,this.e,this.f)},c.translate=function(a,b){return this.add(1,0,0,1,a,b)},c.scale=function(a,b,c,d){return null==b&&(b=a),(c||d)&&this.add(1,0,0,1,c,d),this.add(a,0,0,b,0,0),(c||d)&&this.add(1,0,0,1,-c,-d),this},c.rotate=function(b,c,d){b=a.rad(b),c=c||0,d=d||0;var f=+e.cos(b).toFixed(9),g=+e.sin(b).toFixed(9);return this.add(f,g,-g,f,c,d),this.add(1,0,0,1,-c,-d)},c.x=function(a,b){return a*this.a+b*this.c+this.e},c.y=function(a,b){return a*this.b+b*this.d+this.f},c.get=function(a){return+this[d.fromCharCode(97+a)].toFixed(4)},c.toString=function(){return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")"},c.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},c.determinant=function(){return this.a*this.d-this.b*this.c},c.split=function(){var b={};b.dx=this.e,b.dy=this.f;var c=[[this.a,this.c],[this.b,this.d]];b.scalex=e.sqrt(g(c[0])),h(c[0]),b.shear=c[0][0]*c[1][0]+c[0][1]*c[1][1],c[1]=[c[1][0]-c[0][0]*b.shear,c[1][1]-c[0][1]*b.shear],b.scaley=e.sqrt(g(c[1])),h(c[1]),b.shear/=b.scaley,this.determinant()<0&&(b.scalex=-b.scalex);var d=-c[0][1],f=c[1][1];return 0>f?(b.rotate=a.deg(e.acos(f)),0>d&&(b.rotate=360-b.rotate)):b.rotate=a.deg(e.asin(d)),b.isSimple=!(+b.shear.toFixed(9)||b.scalex.toFixed(9)!=b.scaley.toFixed(9)&&b.rotate),b.isSuperSimple=!+b.shear.toFixed(9)&&b.scalex.toFixed(9)==b.scaley.toFixed(9)&&!b.rotate,b.noRotation=!+b.shear.toFixed(9)&&!b.rotate,b},c.toTransformString=function(a){var b=a||this.split();return+b.shear.toFixed(9)?"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]:(b.scalex=+b.scalex.toFixed(4),b.scaley=+b.scaley.toFixed(4),b.rotate=+b.rotate.toFixed(4),(b.dx||b.dy?"t"+[+b.dx.toFixed(4),+b.dy.toFixed(4)]:f)+(1!=b.scalex||1!=b.scaley?"s"+[b.scalex,b.scaley,0,0]:f)+(b.rotate?"r"+[+b.rotate.toFixed(4),0,0]:f))}}(b.prototype),a.Matrix=b,a.matrix=function(a,c,d,e,f,g){return new b(a,c,d,e,f,g)}}),d.plugin(function(a,c,d,e,f){function g(d){return function(e){if(b.stop(),e instanceof f&&1==e.node.childNodes.length&&("radialGradient"==e.node.firstChild.tagName||"linearGradient"==e.node.firstChild.tagName||"pattern"==e.node.firstChild.tagName)&&(e=e.node.firstChild,n(this).appendChild(e),e=l(e)),e instanceof c)if("radialGradient"==e.type||"linearGradient"==e.type||"pattern"==e.type){e.node.id||p(e.node,{id:e.id});var g=q(e.node.id)}else g=e.attr(d);else if(g=a.color(e),g.error){var h=a(n(this).ownerSVGElement).gradient(e);h?(h.node.id||p(h.node,{id:h.id}),g=q(h.node.id)):g=e}else g=r(g);var i={};i[d]=g,p(this.node,i),this.node.style[d]=t}}function h(a){b.stop(),a==+a&&(a+="px"),this.node.style.fontSize=a}function i(a){for(var b=[],c=a.childNodes,d=0,e=c.length;e>d;d++){var f=c[d];3==f.nodeType&&b.push(f.nodeValue),"tspan"==f.tagName&&b.push(1==f.childNodes.length&&3==f.firstChild.nodeType?f.firstChild.nodeValue:i(f))}return b}function j(){return b.stop(),this.node.style.fontSize}var k=a._.make,l=a._.wrap,m=a.is,n=a._.getSomeDefs,o=/^url\(#?([^)]+)\)$/,p=a._.$,q=a.url,r=String,s=a._.separator,t="";b.on("snap.util.attr.mask",function(a){if(a instanceof c||a instanceof f){if(b.stop(),a instanceof f&&1==a.node.childNodes.length&&(a=a.node.firstChild,n(this).appendChild(a),a=l(a)),"mask"==a.type)var d=a;else d=k("mask",n(this)),d.node.appendChild(a.node);!d.node.id&&p(d.node,{id:d.id}),p(this.node,{mask:q(d.id)})}}),function(a){b.on("snap.util.attr.clip",a),b.on("snap.util.attr.clip-path",a),b.on("snap.util.attr.clipPath",a)}(function(a){if(a instanceof c||a instanceof f){if(b.stop(),"clipPath"==a.type)var d=a;else d=k("clipPath",n(this)),d.node.appendChild(a.node),!d.node.id&&p(d.node,{id:d.id});p(this.node,{"clip-path":q(d.node.id||d.id)})}}),b.on("snap.util.attr.fill",g("fill")),b.on("snap.util.attr.stroke",g("stroke"));var u=/^([lr])(?:\(([^)]*)\))?(.*)$/i;b.on("snap.util.grad.parse",function(a){a=r(a);var b=a.match(u);if(!b)return null;var c=b[1],d=b[2],e=b[3];return d=d.split(/\s*,\s*/).map(function(a){return+a==a?+a:a}),1==d.length&&0==d[0]&&(d=[]),e=e.split("-"),e=e.map(function(a){a=a.split(":");var b={color:a[0]};return a[1]&&(b.offset=parseFloat(a[1])),b}),{type:c,params:d,stops:e}}),b.on("snap.util.attr.d",function(c){b.stop(),m(c,"array")&&m(c[0],"array")&&(c=a.path.toString.call(c)),c=r(c),c.match(/[ruo]/i)&&(c=a.path.toAbsolute(c)),p(this.node,{d:c})})(-1),b.on("snap.util.attr.#text",function(a){b.stop(),a=r(a);for(var c=e.doc.createTextNode(a);this.node.firstChild;)this.node.removeChild(this.node.firstChild);this.node.appendChild(c)})(-1),b.on("snap.util.attr.path",function(a){b.stop(),this.attr({d:a})})(-1),b.on("snap.util.attr.class",function(a){b.stop(),this.node.className.baseVal=a})(-1),b.on("snap.util.attr.viewBox",function(a){var c;c=m(a,"object")&&"x"in a?[a.x,a.y,a.width,a.height].join(" "):m(a,"array")?a.join(" "):a,p(this.node,{viewBox:c}),b.stop()})(-1),b.on("snap.util.attr.transform",function(a){this.transform(a),b.stop()})(-1),b.on("snap.util.attr.r",function(a){"rect"==this.type&&(b.stop(),p(this.node,{rx:a,ry:a}))})(-1),b.on("snap.util.attr.textpath",function(a){if(b.stop(),"text"==this.type){var d,e,f;if(!a&&this.textPath){for(e=this.textPath;e.node.firstChild;)this.node.appendChild(e.node.firstChild);return e.remove(),void delete this.textPath}if(m(a,"string")){var g=n(this),h=l(g.parentNode).path(a);g.appendChild(h.node),d=h.id,h.attr({id:d})}else a=l(a),a instanceof c&&(d=a.attr("id"),d||(d=a.id,a.attr({id:d})));if(d)if(e=this.textPath,f=this.node,e)e.attr({"xlink:href":"#"+d});else{for(e=p("textPath",{"xlink:href":"#"+d});f.firstChild;)e.appendChild(f.firstChild);f.appendChild(e),this.textPath=l(e)}}})(-1),b.on("snap.util.attr.text",function(a){if("text"==this.type){for(var c=this.node,d=function(a){var b=p("tspan");if(m(a,"array"))for(var c=0;c<a.length;c++)b.appendChild(d(a[c]));else b.appendChild(e.doc.createTextNode(a));return b.normalize&&b.normalize(),b};c.firstChild;)c.removeChild(c.firstChild);for(var f=d(a);f.firstChild;)c.appendChild(f.firstChild)}b.stop()})(-1),b.on("snap.util.attr.fontSize",h)(-1),b.on("snap.util.attr.font-size",h)(-1),b.on("snap.util.getattr.transform",function(){return b.stop(),this.transform()})(-1),b.on("snap.util.getattr.textpath",function(){return b.stop(),this.textPath})(-1),function(){function c(c){return function(){b.stop();var d=e.doc.defaultView.getComputedStyle(this.node,null).getPropertyValue("marker-"+c);return"none"==d?d:a(e.doc.getElementById(d.match(o)[1]))}}function d(a){return function(c){b.stop();var d="marker"+a.charAt(0).toUpperCase()+a.substring(1);if(""==c||!c)return void(this.node.style[d]="none");if("marker"==c.type){var e=c.node.id;return e||p(c.node,{id:c.id}),void(this.node.style[d]=q(e))}}}b.on("snap.util.getattr.marker-end",c("end"))(-1),b.on("snap.util.getattr.markerEnd",c("end"))(-1),b.on("snap.util.getattr.marker-start",c("start"))(-1),b.on("snap.util.getattr.markerStart",c("start"))(-1),b.on("snap.util.getattr.marker-mid",c("mid"))(-1),b.on("snap.util.getattr.markerMid",c("mid"))(-1),b.on("snap.util.attr.marker-end",d("end"))(-1),b.on("snap.util.attr.markerEnd",d("end"))(-1),b.on("snap.util.attr.marker-start",d("start"))(-1),b.on("snap.util.attr.markerStart",d("start"))(-1),b.on("snap.util.attr.marker-mid",d("mid"))(-1),b.on("snap.util.attr.markerMid",d("mid"))(-1)}(),b.on("snap.util.getattr.r",function(){return"rect"==this.type&&p(this.node,"rx")==p(this.node,"ry")?(b.stop(),p(this.node,"rx")):void 0})(-1),b.on("snap.util.getattr.text",function(){if("text"==this.type||"tspan"==this.type){b.stop();var a=i(this.node);return 1==a.length?a[0]:a}})(-1),b.on("snap.util.getattr.#text",function(){return this.node.textContent})(-1),b.on("snap.util.getattr.viewBox",function(){b.stop();var c=p(this.node,"viewBox");return c?(c=c.split(s),a._.box(+c[0],+c[1],+c[2],+c[3])):void 0})(-1),b.on("snap.util.getattr.points",function(){var a=p(this.node,"points");return b.stop(),a?a.split(s):void 0})(-1),b.on("snap.util.getattr.path",function(){var a=p(this.node,"d");return b.stop(),a})(-1),b.on("snap.util.getattr.class",function(){return this.node.className.baseVal})(-1),b.on("snap.util.getattr.fontSize",j)(-1),b.on("snap.util.getattr.font-size",j)(-1)}),d.plugin(function(a,b){var c=/\S+/g,d=String,e=b.prototype;e.addClass=function(a){var b,e,f,g,h=d(a||"").match(c)||[],i=this.node,j=i.className.baseVal,k=j.match(c)||[];if(h.length){for(b=0;f=h[b++];)e=k.indexOf(f),~e||k.push(f);g=k.join(" "),j!=g&&(i.className.baseVal=g)}return this},e.removeClass=function(a){var b,e,f,g,h=d(a||"").match(c)||[],i=this.node,j=i.className.baseVal,k=j.match(c)||[];if(k.length){for(b=0;f=h[b++];)e=k.indexOf(f),~e&&k.splice(e,1);g=k.join(" "),j!=g&&(i.className.baseVal=g)}return this},e.hasClass=function(a){var b=this.node,d=b.className.baseVal,e=d.match(c)||[];return!!~e.indexOf(a)},e.toggleClass=function(a,b){if(null!=b)return b?this.addClass(a):this.removeClass(a);var d,e,f,g,h=(a||"").match(c)||[],i=this.node,j=i.className.baseVal,k=j.match(c)||[];for(d=0;f=h[d++];)e=k.indexOf(f),~e?k.splice(e,1):k.push(f);return g=k.join(" "),j!=g&&(i.className.baseVal=g),this}}),d.plugin(function(){function a(a){return a}function c(a){return function(b){return+b.toFixed(3)+a}}var d={"+":function(a,b){return a+b},"-":function(a,b){return a-b},"/":function(a,b){return a/b},"*":function(a,b){return a*b}},e=String,f=/[a-z]+$/i,g=/^\s*([+\-\/*])\s*=\s*([\d.eE+\-]+)\s*([^\d\s]+)?\s*$/;b.on("snap.util.attr",function(a){var c=e(a).match(g);if(c){var h=b.nt(),i=h.substring(h.lastIndexOf(".")+1),j=this.attr(i),k={};b.stop();var l=c[3]||"",m=j.match(f),n=d[c[1]];if(m&&m==l?a=n(parseFloat(j),+c[2]):(j=this.asPX(i),a=n(this.asPX(i),this.asPX(i,c[2]+l))),isNaN(j)||isNaN(a))return;k[i]=a,this.attr(k)}})(-10),b.on("snap.util.equal",function(h,i){var j=e(this.attr(h)||""),k=e(i).match(g);if(k){b.stop();var l=k[3]||"",m=j.match(f),n=d[k[1]];return m&&m==l?{from:parseFloat(j),to:n(parseFloat(j),+k[2]),f:c(m)}:(j=this.asPX(h),{from:j,to:n(j,this.asPX(h,k[2]+l)),f:a})}})(-10)}),d.plugin(function(c,d,e,f){var g=e.prototype,h=c.is;g.rect=function(a,b,c,d,e,f){var g;return null==f&&(f=e),h(a,"object")&&"[object Object]"==a?g=a:null!=a&&(g={x:a,y:b,width:c,height:d},null!=e&&(g.rx=e,g.ry=f)),this.el("rect",g)},g.circle=function(a,b,c){var d;return h(a,"object")&&"[object Object]"==a?d=a:null!=a&&(d={cx:a,cy:b,r:c}),this.el("circle",d)};var i=function(){function a(){this.parentNode.removeChild(this)}return function(b,c){var d=f.doc.createElement("img"),e=f.doc.body;d.style.cssText="position:absolute;left:-9999em;top:-9999em",d.onload=function(){c.call(d),d.onload=d.onerror=null,e.removeChild(d)},d.onerror=a,e.appendChild(d),d.src=b}}();g.image=function(a,b,d,e,f){var g=this.el("image");if(h(a,"object")&&"src"in a)g.attr(a);else if(null!=a){var j={"xlink:href":a,preserveAspectRatio:"none"};null!=b&&null!=d&&(j.x=b,j.y=d),null!=e&&null!=f?(j.width=e,j.height=f):i(a,function(){c._.$(g.node,{width:this.offsetWidth,height:this.offsetHeight})}),c._.$(g.node,j)}return g},g.ellipse=function(a,b,c,d){var e;return h(a,"object")&&"[object Object]"==a?e=a:null!=a&&(e={cx:a,cy:b,rx:c,ry:d}),this.el("ellipse",e)},g.path=function(a){var b;return h(a,"object")&&!h(a,"array")?b=a:a&&(b={d:a}),this.el("path",b)},g.group=g.g=function(a){var b=this.el("g");return 1==arguments.length&&a&&!a.type?b.attr(a):arguments.length&&b.add(Array.prototype.slice.call(arguments,0)),b},g.svg=function(a,b,c,d,e,f,g,i){var j={};return h(a,"object")&&null==b?j=a:(null!=a&&(j.x=a),null!=b&&(j.y=b),null!=c&&(j.width=c),null!=d&&(j.height=d),null!=e&&null!=f&&null!=g&&null!=i&&(j.viewBox=[e,f,g,i])),this.el("svg",j)},g.mask=function(a){var b=this.el("mask");return 1==arguments.length&&a&&!a.type?b.attr(a):arguments.length&&b.add(Array.prototype.slice.call(arguments,0)),b},g.ptrn=function(a,b,c,d,e,f,g,i){if(h(a,"object"))var j=a;else j={patternUnits:"userSpaceOnUse"},a&&(j.x=a),b&&(j.y=b),null!=c&&(j.width=c),null!=d&&(j.height=d),j.viewBox=null!=e&&null!=f&&null!=g&&null!=i?[e,f,g,i]:[a||0,b||0,c||0,d||0];return this.el("pattern",j)},g.use=function(a){return null!=a?(a instanceof d&&(a.attr("id")||a.attr({id:c._.id(a)}),a=a.attr("id")),"#"==String(a).charAt()&&(a=a.substring(1)),this.el("use",{"xlink:href":"#"+a})):d.prototype.use.call(this)},g.symbol=function(a,b,c,d){var e={};return null!=a&&null!=b&&null!=c&&null!=d&&(e.viewBox=[a,b,c,d]),this.el("symbol",e)},g.text=function(a,b,c){var d={};return h(a,"object")?d=a:null!=a&&(d={x:a,y:b,text:c||""}),this.el("text",d)},g.line=function(a,b,c,d){var e={};return h(a,"object")?e=a:null!=a&&(e={x1:a,x2:c,y1:b,y2:d}),this.el("line",e)},g.polyline=function(a){arguments.length>1&&(a=Array.prototype.slice.call(arguments,0));var b={};return h(a,"object")&&!h(a,"array")?b=a:null!=a&&(b={points:a}),this.el("polyline",b)},g.polygon=function(a){arguments.length>1&&(a=Array.prototype.slice.call(arguments,0));var b={};return h(a,"object")&&!h(a,"array")?b=a:null!=a&&(b={points:a}),this.el("polygon",b)},function(){function d(){return this.selectAll("stop")}function e(a,b){var d=k("stop"),e={offset:+b+"%"};return a=c.color(a),e["stop-color"]=a.hex,a.opacity<1&&(e["stop-opacity"]=a.opacity),k(d,e),this.node.appendChild(d),this}function f(){if("linearGradient"==this.type){var a=k(this.node,"x1")||0,b=k(this.node,"x2")||1,d=k(this.node,"y1")||0,e=k(this.node,"y2")||0;return c._.box(a,d,math.abs(b-a),math.abs(e-d))}var f=this.node.cx||.5,g=this.node.cy||.5,h=this.node.r||0;return c._.box(f-h,g-h,2*h,2*h)}function h(a,c){function d(a,b){for(var c=(b-l)/(a-m),d=m;a>d;d++)g[d].offset=+(+l+c*(d-m)).toFixed(2);m=a,l=b}var e,f=b("snap.util.grad.parse",null,c).firstDefined();if(!f)return null;f.params.unshift(a),e="l"==f.type.toLowerCase()?i.apply(0,f.params):j.apply(0,f.params),f.type!=f.type.toLowerCase()&&k(e.node,{gradientUnits:"userSpaceOnUse"});var g=f.stops,h=g.length,l=0,m=0;h--;for(var n=0;h>n;n++)"offset"in g[n]&&d(n,g[n].offset);for(g[h].offset=g[h].offset||100,d(h,g[h].offset),n=0;h>=n;n++){var o=g[n];e.addStop(o.color,o.offset)}return e}function i(a,b,g,h,i){var j=c._.make("linearGradient",a);return j.stops=d,j.addStop=e,j.getBBox=f,null!=b&&k(j.node,{x1:b,y1:g,x2:h,y2:i}),j}function j(a,b,g,h,i,j){var l=c._.make("radialGradient",a);return l.stops=d,l.addStop=e,l.getBBox=f,null!=b&&k(l.node,{cx:b,cy:g,r:h}),null!=i&&null!=j&&k(l.node,{fx:i,fy:j}),l}var k=c._.$;g.gradient=function(a){return h(this.defs,a)},g.gradientLinear=function(a,b,c,d){return i(this.defs,a,b,c,d)},g.gradientRadial=function(a,b,c,d,e){return j(this.defs,a,b,c,d,e)},g.toString=function(){var a,b=this.node.ownerDocument,d=b.createDocumentFragment(),e=b.createElement("div"),f=this.node.cloneNode(!0);return d.appendChild(e),e.appendChild(f),c._.$(f,{xmlns:"http://www.w3.org/2000/svg"}),a=e.innerHTML,d.removeChild(d.firstChild),a},g.toDataURL=function(){return a&&a.btoa?"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(this))):void 0},g.clear=function(){for(var a,b=this.node.firstChild;b;)a=b.nextSibling,"defs"!=b.tagName?b.parentNode.removeChild(b):g.clear.call({node:b}),b=a}}()}),d.plugin(function(a,b){function c(a){var b=c.ps=c.ps||{};return b[a]?b[a].sleep=100:b[a]={sleep:100},setTimeout(function(){for(var c in b)b[K](c)&&c!=a&&(b[c].sleep--,!b[c].sleep&&delete b[c])}),b[a]}function d(a,b,c,d){return null==a&&(a=b=c=d=0),null==b&&(b=a.y,c=a.width,d=a.height,a=a.x),{x:a,y:b,width:c,w:c,height:d,h:d,x2:a+c,y2:b+d,cx:a+c/2,cy:b+d/2,r1:N.min(c,d)/2,r2:N.max(c,d)/2,r0:N.sqrt(c*c+d*d)/2,path:w(a,b,c,d),vb:[a,b,c,d].join(" ")}}function e(){return this.join(",").replace(L,"$1")}function f(a){var b=J(a);return b.toString=e,b}function g(a,b,c,d,e,f,g,h,j){return null==j?n(a,b,c,d,e,f,g,h):i(a,b,c,d,e,f,g,h,o(a,b,c,d,e,f,g,h,j))}function h(c,d){function e(a){return+(+a).toFixed(3)}return a._.cacher(function(a,f,h){a instanceof b&&(a=a.attr("d")),a=E(a);for(var j,k,l,m,n,o="",p={},q=0,r=0,s=a.length;s>r;r++){if(l=a[r],"M"==l[0])j=+l[1],k=+l[2];else{if(m=g(j,k,l[1],l[2],l[3],l[4],l[5],l[6]),q+m>f){if(d&&!p.start){if(n=g(j,k,l[1],l[2],l[3],l[4],l[5],l[6],f-q),o+=["C"+e(n.start.x),e(n.start.y),e(n.m.x),e(n.m.y),e(n.x),e(n.y)],h)return o;p.start=o,o=["M"+e(n.x),e(n.y)+"C"+e(n.n.x),e(n.n.y),e(n.end.x),e(n.end.y),e(l[5]),e(l[6])].join(),q+=m,j=+l[5],k=+l[6];continue}if(!c&&!d)return n=g(j,k,l[1],l[2],l[3],l[4],l[5],l[6],f-q)}q+=m,j=+l[5],k=+l[6]}o+=l.shift()+l}return p.end=o,n=c?q:d?p:i(j,k,l[0],l[1],l[2],l[3],l[4],l[5],1)},null,a._.clone)}function i(a,b,c,d,e,f,g,h,i){var j=1-i,k=R(j,3),l=R(j,2),m=i*i,n=m*i,o=k*a+3*l*i*c+3*j*i*i*e+n*g,p=k*b+3*l*i*d+3*j*i*i*f+n*h,q=a+2*i*(c-a)+m*(e-2*c+a),r=b+2*i*(d-b)+m*(f-2*d+b),s=c+2*i*(e-c)+m*(g-2*e+c),t=d+2*i*(f-d)+m*(h-2*f+d),u=j*a+i*c,v=j*b+i*d,w=j*e+i*g,x=j*f+i*h,y=90-180*N.atan2(q-s,r-t)/O;return{x:o,y:p,m:{x:q,y:r},n:{x:s,y:t},start:{x:u,y:v},end:{x:w,y:x},alpha:y}}function j(b,c,e,f,g,h,i,j){a.is(b,"array")||(b=[b,c,e,f,g,h,i,j]);var k=D.apply(null,b);return d(k.min.x,k.min.y,k.max.x-k.min.x,k.max.y-k.min.y)}function k(a,b,c){return b>=a.x&&b<=a.x+a.width&&c>=a.y&&c<=a.y+a.height}function l(a,b){return a=d(a),b=d(b),k(b,a.x,a.y)||k(b,a.x2,a.y)||k(b,a.x,a.y2)||k(b,a.x2,a.y2)||k(a,b.x,b.y)||k(a,b.x2,b.y)||k(a,b.x,b.y2)||k(a,b.x2,b.y2)||(a.x<b.x2&&a.x>b.x||b.x<a.x2&&b.x>a.x)&&(a.y<b.y2&&a.y>b.y||b.y<a.y2&&b.y>a.y)}function m(a,b,c,d,e){var f=-3*b+9*c-9*d+3*e,g=a*f+6*b-12*c+6*d;return a*g-3*b+3*c}function n(a,b,c,d,e,f,g,h,i){null==i&&(i=1),i=i>1?1:0>i?0:i;for(var j=i/2,k=12,l=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],n=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],o=0,p=0;k>p;p++){var q=j*l[p]+j,r=m(q,a,c,e,g),s=m(q,b,d,f,h),t=r*r+s*s;o+=n[p]*N.sqrt(t)}return j*o}function o(a,b,c,d,e,f,g,h,i){if(!(0>i||n(a,b,c,d,e,f,g,h)<i)){var j,k=1,l=k/2,m=k-l,o=.01;for(j=n(a,b,c,d,e,f,g,h,m);S(j-i)>o;)l/=2,m+=(i>j?1:-1)*l,j=n(a,b,c,d,e,f,g,h,m);return m}}function p(a,b,c,d,e,f,g,h){if(!(Q(a,c)<P(e,g)||P(a,c)>Q(e,g)||Q(b,d)<P(f,h)||P(b,d)>Q(f,h))){var i=(a*d-b*c)*(e-g)-(a-c)*(e*h-f*g),j=(a*d-b*c)*(f-h)-(b-d)*(e*h-f*g),k=(a-c)*(f-h)-(b-d)*(e-g);if(k){var l=i/k,m=j/k,n=+l.toFixed(2),o=+m.toFixed(2);if(!(n<+P(a,c).toFixed(2)||n>+Q(a,c).toFixed(2)||n<+P(e,g).toFixed(2)||n>+Q(e,g).toFixed(2)||o<+P(b,d).toFixed(2)||o>+Q(b,d).toFixed(2)||o<+P(f,h).toFixed(2)||o>+Q(f,h).toFixed(2)))return{x:l,y:m}}}}function q(a,b,c){var d=j(a),e=j(b);if(!l(d,e))return c?0:[];for(var f=n.apply(0,a),g=n.apply(0,b),h=~~(f/8),k=~~(g/8),m=[],o=[],q={},r=c?0:[],s=0;h+1>s;s++){var t=i.apply(0,a.concat(s/h));m.push({x:t.x,y:t.y,t:s/h})}for(s=0;k+1>s;s++)t=i.apply(0,b.concat(s/k)),o.push({x:t.x,y:t.y,t:s/k});for(s=0;h>s;s++)for(var u=0;k>u;u++){var v=m[s],w=m[s+1],x=o[u],y=o[u+1],z=S(w.x-v.x)<.001?"y":"x",A=S(y.x-x.x)<.001?"y":"x",B=p(v.x,v.y,w.x,w.y,x.x,x.y,y.x,y.y);if(B){if(q[B.x.toFixed(4)]==B.y.toFixed(4))continue;q[B.x.toFixed(4)]=B.y.toFixed(4);var C=v.t+S((B[z]-v[z])/(w[z]-v[z]))*(w.t-v.t),D=x.t+S((B[A]-x[A])/(y[A]-x[A]))*(y.t-x.t);C>=0&&1>=C&&D>=0&&1>=D&&(c?r++:r.push({x:B.x,y:B.y,t1:C,t2:D}))}}return r}function r(a,b){return t(a,b)}function s(a,b){return t(a,b,1)}function t(a,b,c){a=E(a),b=E(b);for(var d,e,f,g,h,i,j,k,l,m,n=c?0:[],o=0,p=a.length;p>o;o++){var r=a[o];if("M"==r[0])d=h=r[1],e=i=r[2];else{"C"==r[0]?(l=[d,e].concat(r.slice(1)),d=l[6],e=l[7]):(l=[d,e,d,e,h,i,h,i],d=h,e=i);for(var s=0,t=b.length;t>s;s++){var u=b[s];if("M"==u[0])f=j=u[1],g=k=u[2];else{"C"==u[0]?(m=[f,g].concat(u.slice(1)),f=m[6],g=m[7]):(m=[f,g,f,g,j,k,j,k],f=j,g=k);var v=q(l,m,c);if(c)n+=v;else{for(var w=0,x=v.length;x>w;w++)v[w].segment1=o,v[w].segment2=s,v[w].bez1=l,v[w].bez2=m;n=n.concat(v)}}}}}return n}function u(a,b,c){var d=v(a);return k(d,b,c)&&t(a,[["M",b,c],["H",d.x2+10]],1)%2==1}function v(a){var b=c(a);if(b.bbox)return J(b.bbox);if(!a)return d();a=E(a);for(var e,f=0,g=0,h=[],i=[],j=0,k=a.length;k>j;j++)if(e=a[j],"M"==e[0])f=e[1],g=e[2],h.push(f),i.push(g);else{var l=D(f,g,e[1],e[2],e[3],e[4],e[5],e[6]);h=h.concat(l.min.x,l.max.x),i=i.concat(l.min.y,l.max.y),f=e[5],g=e[6]}var m=P.apply(0,h),n=P.apply(0,i),o=Q.apply(0,h),p=Q.apply(0,i),q=d(m,n,o-m,p-n);return b.bbox=J(q),q}function w(a,b,c,d,f){if(f)return[["M",+a+ +f,b],["l",c-2*f,0],["a",f,f,0,0,1,f,f],["l",0,d-2*f],["a",f,f,0,0,1,-f,f],["l",2*f-c,0],["a",f,f,0,0,1,-f,-f],["l",0,2*f-d],["a",f,f,0,0,1,f,-f],["z"]];var g=[["M",a,b],["l",c,0],["l",0,d],["l",-c,0],["z"]];return g.toString=e,g}function x(a,b,c,d,f){if(null==f&&null==d&&(d=c),a=+a,b=+b,c=+c,d=+d,null!=f)var g=Math.PI/180,h=a+c*Math.cos(-d*g),i=a+c*Math.cos(-f*g),j=b+c*Math.sin(-d*g),k=b+c*Math.sin(-f*g),l=[["M",h,j],["A",c,c,0,+(f-d>180),0,i,k]];else l=[["M",a,b],["m",0,-d],["a",c,d,0,1,1,0,2*d],["a",c,d,0,1,1,0,-2*d],["z"]];return l.toString=e,l}function y(b){var d=c(b),g=String.prototype.toLowerCase;if(d.rel)return f(d.rel);a.is(b,"array")&&a.is(b&&b[0],"array")||(b=a.parsePathString(b));var h=[],i=0,j=0,k=0,l=0,m=0;"M"==b[0][0]&&(i=b[0][1],j=b[0][2],k=i,l=j,m++,h.push(["M",i,j]));for(var n=m,o=b.length;o>n;n++){var p=h[n]=[],q=b[n];if(q[0]!=g.call(q[0]))switch(p[0]=g.call(q[0]),p[0]){case"a":p[1]=q[1],p[2]=q[2],p[3]=q[3],p[4]=q[4],p[5]=q[5],p[6]=+(q[6]-i).toFixed(3),p[7]=+(q[7]-j).toFixed(3);break;case"v":p[1]=+(q[1]-j).toFixed(3);break;case"m":k=q[1],l=q[2];default:for(var r=1,s=q.length;s>r;r++)p[r]=+(q[r]-(r%2?i:j)).toFixed(3)}else{p=h[n]=[],"m"==q[0]&&(k=q[1]+i,l=q[2]+j);for(var t=0,u=q.length;u>t;t++)h[n][t]=q[t]}var v=h[n].length;switch(h[n][0]){case"z":i=k,j=l;break;case"h":i+=+h[n][v-1];break;case"v":j+=+h[n][v-1];break;default:i+=+h[n][v-2],j+=+h[n][v-1]}}return h.toString=e,d.rel=f(h),h}function z(b){var d=c(b);if(d.abs)return f(d.abs);if(I(b,"array")&&I(b&&b[0],"array")||(b=a.parsePathString(b)),!b||!b.length)return[["M",0,0]];var g,h=[],i=0,j=0,k=0,l=0,m=0;"M"==b[0][0]&&(i=+b[0][1],j=+b[0][2],k=i,l=j,m++,h[0]=["M",i,j]);for(var n,o,p=3==b.length&&"M"==b[0][0]&&"R"==b[1][0].toUpperCase()&&"Z"==b[2][0].toUpperCase(),q=m,r=b.length;r>q;q++){if(h.push(n=[]),o=b[q],g=o[0],g!=g.toUpperCase())switch(n[0]=g.toUpperCase(),n[0]){case"A":n[1]=o[1],n[2]=o[2],n[3]=o[3],n[4]=o[4],n[5]=o[5],n[6]=+o[6]+i,n[7]=+o[7]+j;break;case"V":n[1]=+o[1]+j;break;case"H":n[1]=+o[1]+i;break;case"R":for(var s=[i,j].concat(o.slice(1)),t=2,u=s.length;u>t;t++)s[t]=+s[t]+i,s[++t]=+s[t]+j;h.pop(),h=h.concat(G(s,p));break;case"O":h.pop(),s=x(i,j,o[1],o[2]),s.push(s[0]),h=h.concat(s);break;case"U":h.pop(),h=h.concat(x(i,j,o[1],o[2],o[3])),n=["U"].concat(h[h.length-1].slice(-2));break;case"M":k=+o[1]+i,l=+o[2]+j;default:for(t=1,u=o.length;u>t;t++)n[t]=+o[t]+(t%2?i:j)}else if("R"==g)s=[i,j].concat(o.slice(1)),h.pop(),h=h.concat(G(s,p)),n=["R"].concat(o.slice(-2));else if("O"==g)h.pop(),s=x(i,j,o[1],o[2]),s.push(s[0]),h=h.concat(s);else if("U"==g)h.pop(),h=h.concat(x(i,j,o[1],o[2],o[3])),n=["U"].concat(h[h.length-1].slice(-2));else for(var v=0,w=o.length;w>v;v++)n[v]=o[v];if(g=g.toUpperCase(),"O"!=g)switch(n[0]){case"Z":i=+k,j=+l;break;case"H":i=n[1];break;case"V":j=n[1];break;case"M":k=n[n.length-2],l=n[n.length-1];default:i=n[n.length-2],j=n[n.length-1]}}return h.toString=e,d.abs=f(h),h}function A(a,b,c,d){return[a,b,c,d,c,d]}function B(a,b,c,d,e,f){var g=1/3,h=2/3;return[g*a+h*c,g*b+h*d,g*e+h*c,g*f+h*d,e,f]}function C(b,c,d,e,f,g,h,i,j,k){var l,m=120*O/180,n=O/180*(+f||0),o=[],p=a._.cacher(function(a,b,c){var d=a*N.cos(c)-b*N.sin(c),e=a*N.sin(c)+b*N.cos(c);return{x:d,y:e}});if(k)y=k[0],z=k[1],w=k[2],x=k[3];else{l=p(b,c,-n),b=l.x,c=l.y,l=p(i,j,-n),i=l.x,j=l.y;var q=(N.cos(O/180*f),N.sin(O/180*f),(b-i)/2),r=(c-j)/2,s=q*q/(d*d)+r*r/(e*e);s>1&&(s=N.sqrt(s),d=s*d,e=s*e);var t=d*d,u=e*e,v=(g==h?-1:1)*N.sqrt(S((t*u-t*r*r-u*q*q)/(t*r*r+u*q*q))),w=v*d*r/e+(b+i)/2,x=v*-e*q/d+(c+j)/2,y=N.asin(((c-x)/e).toFixed(9)),z=N.asin(((j-x)/e).toFixed(9));y=w>b?O-y:y,z=w>i?O-z:z,0>y&&(y=2*O+y),0>z&&(z=2*O+z),h&&y>z&&(y-=2*O),!h&&z>y&&(z-=2*O)}var A=z-y;if(S(A)>m){var B=z,D=i,E=j;z=y+m*(h&&z>y?1:-1),i=w+d*N.cos(z),j=x+e*N.sin(z),o=C(i,j,d,e,f,0,h,D,E,[z,B,w,x])}A=z-y;var F=N.cos(y),G=N.sin(y),H=N.cos(z),I=N.sin(z),J=N.tan(A/4),K=4/3*d*J,L=4/3*e*J,M=[b,c],P=[b+K*G,c-L*F],Q=[i+K*I,j-L*H],R=[i,j];if(P[0]=2*M[0]-P[0],P[1]=2*M[1]-P[1],k)return[P,Q,R].concat(o);o=[P,Q,R].concat(o).join().split(",");for(var T=[],U=0,V=o.length;V>U;U++)T[U]=U%2?p(o[U-1],o[U],n).y:p(o[U],o[U+1],n).x;return T}function D(a,b,c,d,e,f,g,h){for(var i,j,k,l,m,n,o,p,q=[],r=[[],[]],s=0;2>s;++s)if(0==s?(j=6*a-12*c+6*e,i=-3*a+9*c-9*e+3*g,k=3*c-3*a):(j=6*b-12*d+6*f,i=-3*b+9*d-9*f+3*h,k=3*d-3*b),S(i)<1e-12){if(S(j)<1e-12)continue;l=-k/j,l>0&&1>l&&q.push(l)}else o=j*j-4*k*i,p=N.sqrt(o),0>o||(m=(-j+p)/(2*i),m>0&&1>m&&q.push(m),n=(-j-p)/(2*i),n>0&&1>n&&q.push(n));for(var t,u=q.length,v=u;u--;)l=q[u],t=1-l,r[0][u]=t*t*t*a+3*t*t*l*c+3*t*l*l*e+l*l*l*g,r[1][u]=t*t*t*b+3*t*t*l*d+3*t*l*l*f+l*l*l*h;return r[0][v]=a,r[1][v]=b,r[0][v+1]=g,r[1][v+1]=h,r[0].length=r[1].length=v+2,{min:{x:P.apply(0,r[0]),y:P.apply(0,r[1])},max:{x:Q.apply(0,r[0]),y:Q.apply(0,r[1])}}}function E(a,b){var d=!b&&c(a);if(!b&&d.curve)return f(d.curve);for(var e=z(a),g=b&&z(b),h={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},i={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},j=(function(a,b,c){var d,e;if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];switch(!(a[0]in{T:1,Q:1})&&(b.qx=b.qy=null),a[0]){case"M":b.X=a[1],b.Y=a[2];break;case"A":a=["C"].concat(C.apply(0,[b.x,b.y].concat(a.slice(1))));break;case"S":"C"==c||"S"==c?(d=2*b.x-b.bx,e=2*b.y-b.by):(d=b.x,e=b.y),a=["C",d,e].concat(a.slice(1));break;case"T":"Q"==c||"T"==c?(b.qx=2*b.x-b.qx,b.qy=2*b.y-b.qy):(b.qx=b.x,b.qy=b.y),a=["C"].concat(B(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case"Q":b.qx=a[1],b.qy=a[2],a=["C"].concat(B(b.x,b.y,a[1],a[2],a[3],a[4]));break;case"L":a=["C"].concat(A(b.x,b.y,a[1],a[2]));break;case"H":a=["C"].concat(A(b.x,b.y,a[1],b.y));break;case"V":a=["C"].concat(A(b.x,b.y,b.x,a[1]));break;case"Z":a=["C"].concat(A(b.x,b.y,b.X,b.Y))}return a}),k=function(a,b){if(a[b].length>7){a[b].shift();for(var c=a[b];c.length;)m[b]="A",g&&(n[b]="A"),a.splice(b++,0,["C"].concat(c.splice(0,6)));a.splice(b,1),r=Q(e.length,g&&g.length||0)}},l=function(a,b,c,d,f){a&&b&&"M"==a[f][0]&&"M"!=b[f][0]&&(b.splice(f,0,["M",d.x,d.y]),c.bx=0,c.by=0,c.x=a[f][1],c.y=a[f][2],r=Q(e.length,g&&g.length||0))},m=[],n=[],o="",p="",q=0,r=Q(e.length,g&&g.length||0);r>q;q++){e[q]&&(o=e[q][0]),"C"!=o&&(m[q]=o,q&&(p=m[q-1])),e[q]=j(e[q],h,p),"A"!=m[q]&&"C"==o&&(m[q]="C"),k(e,q),g&&(g[q]&&(o=g[q][0]),"C"!=o&&(n[q]=o,q&&(p=n[q-1])),g[q]=j(g[q],i,p),"A"!=n[q]&&"C"==o&&(n[q]="C"),k(g,q)),l(e,g,h,i,q),l(g,e,i,h,q);var s=e[q],t=g&&g[q],u=s.length,v=g&&t.length;h.x=s[u-2],h.y=s[u-1],h.bx=M(s[u-4])||h.x,h.by=M(s[u-3])||h.y,i.bx=g&&(M(t[v-4])||i.x),i.by=g&&(M(t[v-3])||i.y),i.x=g&&t[v-2],i.y=g&&t[v-1]}return g||(d.curve=f(e)),g?[e,g]:e}function F(a,b){if(!b)return a;var c,d,e,f,g,h,i;for(a=E(a),e=0,g=a.length;g>e;e++)for(i=a[e],f=1,h=i.length;h>f;f+=2)c=b.x(i[f],i[f+1]),d=b.y(i[f],i[f+1]),i[f]=c,i[f+1]=d;return a}function G(a,b){for(var c=[],d=0,e=a.length;e-2*!b>d;d+=2){var f=[{x:+a[d-2],y:+a[d-1]},{x:+a[d],y:+a[d+1]},{x:+a[d+2],y:+a[d+3]},{x:+a[d+4],y:+a[d+5]}];b?d?e-4==d?f[3]={x:+a[0],y:+a[1]}:e-2==d&&(f[2]={x:+a[0],y:+a[1]},f[3]={x:+a[2],y:+a[3]}):f[0]={x:+a[e-2],y:+a[e-1]}:e-4==d?f[3]=f[2]:d||(f[0]={x:+a[d],y:+a[d+1]}),c.push(["C",(-f[0].x+6*f[1].x+f[2].x)/6,(-f[0].y+6*f[1].y+f[2].y)/6,(f[1].x+6*f[2].x-f[3].x)/6,(f[1].y+6*f[2].y-f[3].y)/6,f[2].x,f[2].y])}return c}var H=b.prototype,I=a.is,J=a._.clone,K="hasOwnProperty",L=/,?([a-z]),?/gi,M=parseFloat,N=Math,O=N.PI,P=N.min,Q=N.max,R=N.pow,S=N.abs,T=h(1),U=h(),V=h(0,1),W=a._unit2px,X={path:function(a){return a.attr("path")},circle:function(a){var b=W(a);return x(b.cx,b.cy,b.r)},ellipse:function(a){var b=W(a);return x(b.cx||0,b.cy||0,b.rx,b.ry)},rect:function(a){var b=W(a);return w(b.x||0,b.y||0,b.width,b.height,b.rx,b.ry)},image:function(a){var b=W(a);return w(b.x||0,b.y||0,b.width,b.height)},line:function(a){return"M"+[a.attr("x1")||0,a.attr("y1")||0,a.attr("x2"),a.attr("y2")]},polyline:function(a){return"M"+a.attr("points")},polygon:function(a){return"M"+a.attr("points")+"z"},deflt:function(a){var b=a.node.getBBox();return w(b.x,b.y,b.width,b.height)}};a.path=c,a.path.getTotalLength=T,a.path.getPointAtLength=U,a.path.getSubpath=function(a,b,c){if(this.getTotalLength(a)-c<1e-6)return V(a,b).end;var d=V(a,c,1);return b?V(d,b).end:d},H.getTotalLength=function(){return this.node.getTotalLength?this.node.getTotalLength():void 0},H.getPointAtLength=function(a){return U(this.attr("d"),a)},H.getSubpath=function(b,c){return a.path.getSubpath(this.attr("d"),b,c)},a._.box=d,a.path.findDotsAtSegment=i,a.path.bezierBBox=j,a.path.isPointInsideBBox=k,a.closest=function(b,c,e,f){for(var g=100,h=d(b-g/2,c-g/2,g,g),i=[],j=e[0].hasOwnProperty("x")?function(a){return{x:e[a].x,y:e[a].y}}:function(a){return{x:e[a],y:f[a]}},l=0;1e6>=g&&!l;){for(var m=0,n=e.length;n>m;m++){var o=j(m);if(k(h,o.x,o.y)){l++,i.push(o);break}}l||(g*=2,h=d(b-g/2,c-g/2,g,g))}if(1e6!=g){var p,q=1/0;for(m=0,n=i.length;n>m;m++){var r=a.len(b,c,i[m].x,i[m].y);q>r&&(q=r,i[m].len=r,p=i[m])}return p}},a.path.isBBoxIntersect=l,a.path.intersection=r,a.path.intersectionNumber=s,a.path.isPointInside=u,a.path.getBBox=v,a.path.get=X,a.path.toRelative=y,a.path.toAbsolute=z,a.path.toCubic=E,a.path.map=F,a.path.toString=e,a.path.clone=f}),d.plugin(function(a){var d=Math.max,e=Math.min,f=function(a){if(this.items=[],this.bindings={},this.length=0,this.type="set",a)for(var b=0,c=a.length;c>b;b++)a[b]&&(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},g=f.prototype;g.push=function(){for(var a,b,c=0,d=arguments.length;d>c;c++)a=arguments[c],a&&(b=this.items.length,this[b]=this.items[b]=a,this.length++);return this},g.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},g.forEach=function(a,b){for(var c=0,d=this.items.length;d>c;c++)if(a.call(b,this.items[c],c)===!1)return this;return this},g.animate=function(d,e,f,g){"function"!=typeof f||f.length||(g=f,f=c.linear),d instanceof a._.Animation&&(g=d.callback,f=d.easing,e=f.dur,d=d.attr);var h=arguments;if(a.is(d,"array")&&a.is(h[h.length-1],"array"))var i=!0;var j,k=function(){j?this.b=j:j=this.b},l=0,m=this,n=g&&function(){++l==m.length&&g.call(this)
};return this.forEach(function(a,c){b.once("snap.animcreated."+a.id,k),i?h[c]&&a.animate.apply(a,h[c]):a.animate(d,e,f,n)})},g.remove=function(){for(;this.length;)this.pop().remove();return this},g.bind=function(a,b,c){var d={};if("function"==typeof b)this.bindings[a]=b;else{var e=c||a;this.bindings[a]=function(a){d[e]=a,b.attr(d)}}return this},g.attr=function(a){var b={};for(var c in a)this.bindings[c]?this.bindings[c](a[c]):b[c]=a[c];for(var d=0,e=this.items.length;e>d;d++)this.items[d].attr(b);return this},g.clear=function(){for(;this.length;)this.pop()},g.splice=function(a,b){a=0>a?d(this.length+a,0):a,b=d(0,e(this.length-a,b));var c,g=[],h=[],i=[];for(c=2;c<arguments.length;c++)i.push(arguments[c]);for(c=0;b>c;c++)h.push(this[a+c]);for(;c<this.length-a;c++)g.push(this[a+c]);var j=i.length;for(c=0;c<j+g.length;c++)this.items[a+c]=this[a+c]=j>c?i[c]:g[c-j];for(c=this.items.length=this.length-=b-j;this[c];)delete this[c++];return new f(h)},g.exclude=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]==a)return this.splice(b,1),!0;return!1},g.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);return this},g.getBBox=function(){for(var a=[],b=[],c=[],f=[],g=this.items.length;g--;)if(!this.items[g].removed){var h=this.items[g].getBBox();a.push(h.x),b.push(h.y),c.push(h.x+h.width),f.push(h.y+h.height)}return a=e.apply(0,a),b=e.apply(0,b),c=d.apply(0,c),f=d.apply(0,f),{x:a,y:b,x2:c,y2:f,width:c-a,height:f-b,cx:a+(c-a)/2,cy:b+(f-b)/2}},g.clone=function(a){a=new f;for(var b=0,c=this.items.length;c>b;b++)a.push(this.items[b].clone());return a},g.toString=function(){return"Snap‘s set"},g.type="set",a.Set=f,a.set=function(){var a=new f;return arguments.length&&a.push.apply(a,Array.prototype.slice.call(arguments,0)),a}}),d.plugin(function(a,c){function d(a){var b=a[0];switch(b.toLowerCase()){case"t":return[b,0,0];case"m":return[b,1,0,0,1,0,0];case"r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case"s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}}function e(b,c,e){c=p(c).replace(/\.{3}|\u2026/g,b),b=a.parseTransformString(b)||[],c=a.parseTransformString(c)||[];for(var f,g,h,i,l=Math.max(b.length,c.length),m=[],n=[],o=0;l>o;o++){if(h=b[o]||d(c[o]),i=c[o]||d(h),h[0]!=i[0]||"r"==h[0].toLowerCase()&&(h[2]!=i[2]||h[3]!=i[3])||"s"==h[0].toLowerCase()&&(h[3]!=i[3]||h[4]!=i[4])){b=a._.transform2matrix(b,e()),c=a._.transform2matrix(c,e()),m=[["m",b.a,b.b,b.c,b.d,b.e,b.f]],n=[["m",c.a,c.b,c.c,c.d,c.e,c.f]];break}for(m[o]=[],n[o]=[],f=0,g=Math.max(h.length,i.length);g>f;f++)f in h&&(m[o][f]=h[f]),f in i&&(n[o][f]=i[f])}return{from:k(m),to:k(n),f:j(m)}}function f(a){return a}function g(a){return function(b){return+b.toFixed(3)+a}}function h(a){return a.join(" ")}function i(b){return a.rgb(b[0],b[1],b[2])}function j(a){var b,c,d,e,f,g,h=0,i=[];for(b=0,c=a.length;c>b;b++){for(f="[",g=['"'+a[b][0]+'"'],d=1,e=a[b].length;e>d;d++)g[d]="val["+h++ +"]";f+=g+"]",i[b]=f}return Function("val","return Snap.path.toString.call(["+i+"])")}function k(a){for(var b=[],c=0,d=a.length;d>c;c++)for(var e=1,f=a[c].length;f>e;e++)b.push(a[c][e]);return b}function l(a){return isFinite(parseFloat(a))}function m(b,c){return a.is(b,"array")&&a.is(c,"array")?b.toString()==c.toString():!1}var n={},o=/[a-z]+$/i,p=String;n.stroke=n.fill="colour",c.prototype.equal=function(a,c){return b("snap.util.equal",this,a,c).firstDefined()},b.on("snap.util.equal",function(b,c){var d,q,r=p(this.attr(b)||""),s=this;if(l(r)&&l(c))return{from:parseFloat(r),to:parseFloat(c),f:f};if("colour"==n[b])return d=a.color(r),q=a.color(c),{from:[d.r,d.g,d.b,d.opacity],to:[q.r,q.g,q.b,q.opacity],f:i};if("viewBox"==b)return d=this.attr(b).vb.split(" ").map(Number),q=c.split(" ").map(Number),{from:d,to:q,f:h};if("transform"==b||"gradientTransform"==b||"patternTransform"==b)return c instanceof a.Matrix&&(c=c.toTransformString()),a._.rgTransform.test(c)||(c=a._.svgTransform2string(c)),e(r,c,function(){return s.getBBox(1)});if("d"==b||"path"==b)return d=a.path.toCubic(r,c),{from:k(d[0]),to:k(d[1]),f:j(d[0])};if("points"==b)return d=p(r).split(a._.separator),q=p(c).split(a._.separator),{from:d,to:q,f:function(a){return a}};var t=r.match(o),u=p(c).match(o);return t&&m(t,u)?{from:parseFloat(r),to:parseFloat(c),f:g(t)}:{from:this.asPX(b),to:this.asPX(b,c),f:f}})}),d.plugin(function(a,c,d,e){for(var f=c.prototype,g="hasOwnProperty",h=("createTouch"in e.doc),i=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","touchstart","touchmove","touchend","touchcancel"],j={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},k=(function(a,b){var c="y"==a?"scrollTop":"scrollLeft",d=b&&b.node?b.node.ownerDocument:e.doc;return d[c in d.documentElement?"documentElement":"body"][c]}),l=function(){return this.originalEvent.preventDefault()},m=function(){return this.originalEvent.stopPropagation()},n=function(a,b,c,d){var e=h&&j[b]?j[b]:b,f=function(e){var f=k("y",d),i=k("x",d);if(h&&j[g](b))for(var n=0,o=e.targetTouches&&e.targetTouches.length;o>n;n++)if(e.targetTouches[n].target==a||a.contains(e.targetTouches[n].target)){var p=e;e=e.targetTouches[n],e.originalEvent=p,e.preventDefault=l,e.stopPropagation=m;break}var q=e.clientX+i,r=e.clientY+f;return c.call(d,e,q,r)};return b!==e&&a.addEventListener(b,f,!1),a.addEventListener(e,f,!1),function(){return b!==e&&a.removeEventListener(b,f,!1),a.removeEventListener(e,f,!1),!0}},o=[],p=function(a){for(var c,d=a.clientX,e=a.clientY,f=k("y"),g=k("x"),i=o.length;i--;){if(c=o[i],h){for(var j,l=a.touches&&a.touches.length;l--;)if(j=a.touches[l],j.identifier==c.el._drag.id||c.el.node.contains(j.target)){d=j.clientX,e=j.clientY,(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();{var m=c.el.node;m.nextSibling,m.parentNode,m.style.display}d+=g,e+=f,b("snap.drag.move."+c.el.id,c.move_scope||c.el,d-c.el._drag.x,e-c.el._drag.y,d,e,a)}},q=function(c){a.unmousemove(p).unmouseup(q);for(var d,e=o.length;e--;)d=o[e],d.el._drag={},b("snap.drag.end."+d.el.id,d.end_scope||d.start_scope||d.move_scope||d.el,c),b.off("snap.drag.*."+d.el.id);o=[]},r=i.length;r--;)!function(b){a[b]=f[b]=function(c,d){if(a.is(c,"function"))this.events=this.events||[],this.events.push({name:b,f:c,unbind:n(this.node||document,b,c,d||this)});else for(var e=0,f=this.events.length;f>e;e++)if(this.events[e].name==b)try{this.events[e].f.call(this)}catch(g){}return this},a["un"+b]=f["un"+b]=function(a){for(var c=this.events||[],d=c.length;d--;)if(c[d].name==b&&(c[d].f==a||!a))return c[d].unbind(),c.splice(d,1),!c.length&&delete this.events,this;return this}}(i[r]);f.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)},f.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};var s=[];f.drag=function(c,d,e,f,g,h){function i(i,j,l){(i.originalEvent||i).preventDefault(),k._drag.x=j,k._drag.y=l,k._drag.id=i.identifier,!o.length&&a.mousemove(p).mouseup(q),o.push({el:k,move_scope:f,start_scope:g,end_scope:h}),d&&b.on("snap.drag.start."+k.id,d),c&&b.on("snap.drag.move."+k.id,c),e&&b.on("snap.drag.end."+k.id,e),b("snap.drag.start."+k.id,g||f||k,j,l,i)}function j(a,c,d){b("snap.draginit."+k.id,k,a,c,d)}var k=this;if(!arguments.length){var l;return k.drag(function(a,b){this.attr({transform:l+(l?"T":"t")+[a,b]})},function(){l=this.transform().local})}return b.on("snap.draginit."+k.id,i),k._drag={},s.push({el:k,start:i,init:j}),k.mousedown(j),k},f.undrag=function(){for(var c=s.length;c--;)s[c].el==this&&(this.unmousedown(s[c].init),s.splice(c,1),b.unbind("snap.drag.*."+this.id),b.unbind("snap.draginit."+this.id));return!s.length&&a.unmousemove(p).unmouseup(q),this}}),d.plugin(function(a,c,d){var e=(c.prototype,d.prototype),f=/^\s*url\((.+)\)/,g=String,h=a._.$;a.filter={},e.filter=function(b){var d=this;"svg"!=d.type&&(d=d.paper);var e=a.parse(g(b)),f=a._.id(),i=(d.node.offsetWidth,d.node.offsetHeight,h("filter"));return h(i,{id:f,filterUnits:"userSpaceOnUse"}),i.appendChild(e.node),d.defs.appendChild(i),new c(i)},b.on("snap.util.getattr.filter",function(){b.stop();var c=h(this.node,"filter");if(c){var d=g(c).match(f);return d&&a.select(d[1])}}),b.on("snap.util.attr.filter",function(d){if(d instanceof c&&"filter"==d.type){b.stop();var e=d.node.id;e||(h(d.node,{id:d.id}),e=d.id),h(this.node,{filter:a.url(e)})}d&&"none"!=d||(b.stop(),this.node.removeAttribute("filter"))}),a.filter.blur=function(b,c){null==b&&(b=2);var d=null==c?b:[b,c];return a.format('<feGaussianBlur stdDeviation="{def}"/>',{def:d})},a.filter.blur.toString=function(){return this()},a.filter.shadow=function(b,c,d,e,f){return"string"==typeof d&&(e=d,f=e,d=4),"string"!=typeof e&&(f=e,e="#000"),e=e||"#000",null==d&&(d=4),null==f&&(f=1),null==b&&(b=0,c=2),null==c&&(c=b),e=a.color(e),a.format('<feGaussianBlur in="SourceAlpha" stdDeviation="{blur}"/><feOffset dx="{dx}" dy="{dy}" result="offsetblur"/><feFlood flood-color="{color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="{opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>',{color:e,dx:b,dy:c,blur:d,opacity:f})},a.filter.shadow.toString=function(){return this()},a.filter.grayscale=function(b){return null==b&&(b=1),a.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {b} {h} 0 0 0 0 0 1 0"/>',{a:.2126+.7874*(1-b),b:.7152-.7152*(1-b),c:.0722-.0722*(1-b),d:.2126-.2126*(1-b),e:.7152+.2848*(1-b),f:.0722-.0722*(1-b),g:.2126-.2126*(1-b),h:.0722+.9278*(1-b)})},a.filter.grayscale.toString=function(){return this()},a.filter.sepia=function(b){return null==b&&(b=1),a.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {h} {i} 0 0 0 0 0 1 0"/>',{a:.393+.607*(1-b),b:.769-.769*(1-b),c:.189-.189*(1-b),d:.349-.349*(1-b),e:.686+.314*(1-b),f:.168-.168*(1-b),g:.272-.272*(1-b),h:.534-.534*(1-b),i:.131+.869*(1-b)})},a.filter.sepia.toString=function(){return this()},a.filter.saturate=function(b){return null==b&&(b=1),a.format('<feColorMatrix type="saturate" values="{amount}"/>',{amount:1-b})},a.filter.saturate.toString=function(){return this()},a.filter.hueRotate=function(b){return b=b||0,a.format('<feColorMatrix type="hueRotate" values="{angle}"/>',{angle:b})},a.filter.hueRotate.toString=function(){return this()},a.filter.invert=function(b){return null==b&&(b=1),a.format('<feComponentTransfer><feFuncR type="table" tableValues="{amount} {amount2}"/><feFuncG type="table" tableValues="{amount} {amount2}"/><feFuncB type="table" tableValues="{amount} {amount2}"/></feComponentTransfer>',{amount:b,amount2:1-b})},a.filter.invert.toString=function(){return this()},a.filter.brightness=function(b){return null==b&&(b=1),a.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}"/><feFuncG type="linear" slope="{amount}"/><feFuncB type="linear" slope="{amount}"/></feComponentTransfer>',{amount:b})},a.filter.brightness.toString=function(){return this()},a.filter.contrast=function(b){return null==b&&(b=1),a.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}" intercept="{amount2}"/><feFuncG type="linear" slope="{amount}" intercept="{amount2}"/><feFuncB type="linear" slope="{amount}" intercept="{amount2}"/></feComponentTransfer>',{amount:b,amount2:.5-b/2})},a.filter.contrast.toString=function(){return this()}}),d.plugin(function(a,b){var c=a._.box,d=a.is,e=/^[^a-z]*([tbmlrc])/i,f=function(){return"T"+this.dx+","+this.dy};b.prototype.getAlign=function(a,b){null==b&&d(a,"string")&&(b=a,a=null),a=a||this.paper;var g=a.getBBox?a.getBBox():c(a),h=this.getBBox(),i={};switch(b=b&&b.match(e),b=b?b[1].toLowerCase():"c"){case"t":i.dx=0,i.dy=g.y-h.y;break;case"b":i.dx=0,i.dy=g.y2-h.y2;break;case"m":i.dx=0,i.dy=g.cy-h.cy;break;case"l":i.dx=g.x-h.x,i.dy=0;break;case"r":i.dx=g.x2-h.x2,i.dy=0;break;default:i.dx=g.cx-h.cx,i.dy=0}return i.toString=f,i},b.prototype.align=function(a,b){return this.transform("..."+this.getAlign(a,b))}}),d});


( function( window ) {

'use strict';

// class helper functions from bonzo https://github.com/ded/bonzo

function classReg( className ) {
  return new RegExp("(^|\\s+)" + className + "(\\s+|$)");
}

// classList support for class management
// altho to be fair, the api sucks because it won't accept multiple classes at once
var hasClass, addClass, removeClass;

if ( 'classList' in document.documentElement ) {
  hasClass = function( elem, c ) {
    return elem.classList.contains( c );
  };
  addClass = function( elem, c ) {
    elem.classList.add( c );
  };
  removeClass = function( elem, c ) {
    elem.classList.remove( c );
  };
}
else {
  hasClass = function( elem, c ) {
    return classReg( c ).test( elem.className );
  };
  addClass = function( elem, c ) {
    if ( !hasClass( elem, c ) ) {
      elem.className = elem.className + ' ' + c;
    }
  };
  removeClass = function( elem, c ) {
    elem.className = elem.className.replace( classReg( c ), ' ' );
  };
}

function toggleClass( elem, c ) {
  var fn = hasClass( elem, c ) ? removeClass : addClass;
  fn( elem, c );
}

var classie = {
  // full names
  hasClass: hasClass,
  addClass: addClass,
  removeClass: removeClass,
  toggleClass: toggleClass,
  // short names
  has: hasClass,
  add: addClass,
  remove: removeClass,
  toggle: toggleClass
};

// transport
if ( typeof define === 'function' && define.amd ) {
  // AMD
  define( classie );
} else {
  // browser global
  window.classie = classie;
}

})( window );


/**
 * svgLoader.js v1.0.0
 * http://www.codrops.com
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Copyright 2014, Codrops
 * http://www.codrops.com
 */
;( function( window ) {

    'use strict';

    function extend( a, b ) {
        for( var key in b ) {
            if( b.hasOwnProperty( key ) ) {
                a[key] = b[key];
            }
        }
        return a;
    }

    function SVGLoader( el, options ) {
        this.el = el;
        this.options = extend( {}, this.options );
        extend( this.options, options );
        this._init();
    }

    SVGLoader.prototype.options = {
        speedIn : 500,
        easingIn : mina.linear
    }

    SVGLoader.prototype._init = function() {
        var s = Snap( this.el.querySelector( 'svg.transition' ) );
        this.path = s.select( 'path' );
        this.initialPath = this.path.attr('d');

        var openingStepsStr = this.el.getAttribute( 'data-opening' );
        this.openingSteps = openingStepsStr ? openingStepsStr.split(';') : '';
        this.openingStepsTotal = openingStepsStr ? this.openingSteps.length : 0;
        if( this.openingStepsTotal === 0 ) return;

        // if data-closing is not defined then the path will animate to its original shape
        var closingStepsStr = this.el.getAttribute( 'data-closing' ) ? this.el.getAttribute( 'data-closing' ) : this.initialPath;
        this.closingSteps = closingStepsStr ? closingStepsStr.split(';') : '';
        this.closingStepsTotal = closingStepsStr ? this.closingSteps.length : 0;

        this.isAnimating = false;
        this.isHide = false
        if( !this.options.speedOut ) {
            this.options.speedOut = this.options.speedIn;
        }
        if( !this.options.easingOut ) {
            this.options.easingOut = this.options.easingIn;
        }
    }

    SVGLoader.prototype.show = function() {
        if( this.isAnimating ) return false;
        this.isAnimating = true;
        // animate svg
        var self = this,
            onEndAnimation = function() {
                classie.addClass( self.el, 'pageload-loading' );
            };
        this._animateSVG( 'in', onEndAnimation );
        classie.add( this.el, 'show' );
    }

    SVGLoader.prototype.hide = function() {
        var self = this;
        classie.removeClass( this.el, 'pageload-loading' );
        this._animateSVG( 'out', function() {
            // reset path
            self.path.attr( 'd', self.initialPath );
            classie.removeClass( self.el, 'show' );
            self.isAnimating = false;
        } );
    }

    SVGLoader.prototype._animateSVG = function( dir, callback ) {
        var self = this,
            pos = 0,
            steps = dir === 'out' ? this.closingSteps : this.openingSteps,
            stepsTotal = dir === 'out' ? this.closingStepsTotal : this.openingStepsTotal,
            speed = dir === 'out' ? self.options.speedOut : self.options.speedIn,
            easing = dir === 'out' ? self.options.easingOut : self.options.easingIn,
            nextStep = function( pos ) {
                if( pos > stepsTotal - 1 ) {
                    if( callback && typeof callback == 'function' ) {
                        callback();
                    }
                    return;
                }
                self.path.animate( { 'path' : steps[pos] }, speed, easing, function() { nextStep(pos); } );
                pos++;
            };

        nextStep(pos);
    }

    // add to global namespace
    window.SVGLoader = SVGLoader;

})( window );
/*!
 * ionic.bundle.js is a concatenation of:
 * ionic.js, angular.js, angular-animate.js,
 * angular-sanitize.js, angular-ui-router.js,
 * and ionic-angular.js
 * and browser.min.js
 */

/*!
 * Copyright 2015 Drifty Co.
 * http://drifty.com/
 *
 * Ionic, v1.3.0
 * A powerful HTML5 mobile app framework.
 * http://ionicframework.com/
 *
 * By @maxlynch, @benjsperry, @adamdbradley <3
 *
 * Licensed under the MIT license. Please see LICENSE for more information.
 *
 */

!function(){function e(e,t,n){t!==!1?X.addEventListener(e,J[e],n):X.removeEventListener(e,J[e])}function t(e){var t=w(e.target),i=T(t);if(ionic.tap.requiresNativeClick(i)||$)return!1;var r=ionic.tap.pointerCoord(e);n("click",i,r.x,r.y),h(i)}function n(e,t,n,i){var r=document.createEvent("MouseEvents");r.initMouseEvent(e,!0,!0,window,1,0,0,n,i,!1,!1,!1,!1,0,null),r.isIonicTap=!0,t.dispatchEvent(r)}function i(e){return"submit"==e.target.type&&0===e.detail?null:ionic.scroll.isScrolling&&ionic.tap.containsOrIsTextInput(e.target)||!e.isIonicTap&&!ionic.tap.requiresNativeClick(e.target)?(e.stopPropagation(),ionic.tap.isLabelWithTextInput(e.target)||e.preventDefault(),!1):void 0}function r(t){return t.isIonicTap||p(t)?null:B?(t.stopPropagation(),ionic.Platform.isEdge()||ionic.tap.isTextInput(t.target)&&K===t.target||b(t.target.tagName)||ionic.tap.isVideo(t.target)||t.preventDefault(),!1):($=!1,q=ionic.tap.pointerCoord(t),e("mousemove"),void ionic.activator.start(t))}function a(n){return B?(n.stopPropagation(),n.preventDefault(),!1):p(n)||b(n.target.tagName)?!1:(_(n)||t(n),e("mousemove",!1),ionic.activator.end(),void($=!1))}function o(t){return _(t)?(e("mousemove",!1),ionic.activator.end(),$=!0,!1):void 0}function s(t){if(!p(t)&&($=!1,u(),q=ionic.tap.pointerCoord(t),e(j),ionic.activator.start(t),ionic.Platform.isIOS()&&ionic.tap.isLabelWithTextInput(t.target))){var n=T(w(t.target));n!==F&&t.preventDefault()}}function l(e){p(e)||(u(),_(e)||(t(e),b(e.target.tagName)&&e.preventDefault()),K=e.target,d())}function c(t){return _(t)?($=!0,e(j,!1),ionic.activator.end(),!1):void 0}function d(){e(j,!1),ionic.activator.end(),$=!1}function u(){B=!0,clearTimeout(W),W=setTimeout(function(){B=!1},600)}function p(e){return e.isTapHandled?!0:(e.isTapHandled=!0,ionic.tap.isElementTapDisabled(e.target)?!0:ionic.scroll.isScrolling&&ionic.tap.containsOrIsTextInput(e.target)?(e.preventDefault(),!0):void 0)}function h(e){U=null;var t=!1;"SELECT"==e.tagName?(n("mousedown",e,0,0),e.focus&&e.focus(),t=!0):v()===e?t=!0:/^(input|textarea|ion-label)$/i.test(e.tagName)||e.isContentEditable?(t=!0,e.focus&&e.focus(),e.value=e.value,B&&(U=e)):f(),t&&(v(e),ionic.trigger("ionic.focusin",{target:e},!0))}function f(){var e=v();e&&(/^(input|textarea|select)$/i.test(e.tagName)||e.isContentEditable)&&e.blur(),v(null)}function m(e){B&&ionic.tap.isTextInput(v())&&ionic.tap.isTextInput(U)&&U!==e.target&&(U.focus(),U=null),ionic.scroll.isScrolling=!1}function g(){v(null)}function v(e){return arguments.length&&(F=e),F||document.activeElement}function _(e){if(!e||1!==e.target.nodeType||!q||0===q.x&&0===q.y)return!1;var t=ionic.tap.pointerCoord(e),n=!(!e.target.classList||!e.target.classList.contains||"function"!=typeof e.target.classList.contains),i=n&&e.target.classList.contains("button")?Q:Z;return Math.abs(q.x-t.x)>i||Math.abs(q.y-t.y)>i}function w(e,t){for(var n=e,i=0;6>i&&n;i++){if("LABEL"===n.tagName)return n;n=n.parentElement}return t!==!1?e:void 0}function T(e){if(e&&"LABEL"===e.tagName){if(e.control)return e.control;if(e.querySelector){var t=e.querySelector("input,textarea,select");if(t)return t}}return e}function b(e){return/^(select|option)$/i.test(e)}function S(){ionic.keyboard.isInitialized||(V()?(window.addEventListener("native.keyboardshow",pe),window.addEventListener("native.keyboardhide",x)):document.body.addEventListener("focusout",x),document.body.addEventListener("ionic.focusin",ue),document.body.addEventListener("focusin",ue),window.navigator.msPointerEnabled?document.removeEventListener("MSPointerDown",S):document.removeEventListener("touchstart",S),ionic.keyboard.isInitialized=!0)}function y(e){clearTimeout(re),(!ionic.keyboard.isOpen||ionic.keyboard.isClosing)&&(ionic.keyboard.isOpening=!0,ionic.keyboard.isClosing=!1),ionic.keyboard.height=e.keyboardHeight,le?C(O,!0):C(I,!0)}function E(e){return clearTimeout(re),e.target&&!e.target.readOnly&&ionic.tap.isKeyboardElement(e.target)&&(ne=ionic.DomUtil.getParentWithClass(e.target,de))?(ee=e.target,ne.classList.contains("overflow-scroll")||(document.body.scrollTop=0,ne.scrollTop=0,ionic.requestAnimationFrame(function(){document.body.scrollTop=0,ne.scrollTop=0}),window.navigator.msPointerEnabled?document.addEventListener("MSPointerMove",L,!1):document.addEventListener("touchmove",L,!1)),(!ionic.keyboard.isOpen||ionic.keyboard.isClosing)&&(ionic.keyboard.isOpening=!0,ionic.keyboard.isClosing=!1),document.addEventListener("keydown",M,!1),void(ionic.keyboard.isOpen||V()?ionic.keyboard.isOpen&&I():C(I,!0))):(ee&&(te=ee),void(ee=null))}function x(){clearTimeout(re),(ionic.keyboard.isOpen||ionic.keyboard.isOpening)&&(ionic.keyboard.isClosing=!0,ionic.keyboard.isOpening=!1),re=setTimeout(function(){ionic.requestAnimationFrame(function(){le?C(function(){O(),P()},!1):C(P,!1)})},50)}function D(){ionic.keyboard.isLandscape=!ionic.keyboard.isLandscape,ionic.Platform.isIOS()&&O(),ionic.Platform.isAndroid()&&(ionic.keyboard.isOpen&&V()?le=!0:C(O,!1))}function M(e){ionic.scroll.isScrolling&&L(e)}function L(e){"TEXTAREA"!==e.target.tagName&&e.preventDefault()}function C(e,t){clearInterval(ie);var n,i=0,r=G(),a=r;return n=ionic.Platform.isAndroid()&&ionic.Platform.version()<4.4?30:ionic.Platform.isAndroid()?10:1,ie=setInterval(function(){a=G(),(!(++i<n)||(N(a)||z(a))&&ionic.keyboard.height)&&(V()||(ionic.keyboard.height=Math.abs(r-window.innerHeight)),ionic.keyboard.isOpen=t,clearInterval(ie),e())},50),n}function P(){clearTimeout(re),ionic.keyboard.isOpen=!1,ionic.keyboard.isClosing=!1,(ee||te)&&ionic.trigger("resetScrollView",{target:ee||te},!0),ionic.requestAnimationFrame(function(){document.body.classList.remove(ce)}),window.navigator.msPointerEnabled?document.removeEventListener("MSPointerMove",L):document.removeEventListener("touchmove",L),document.removeEventListener("keydown",M),ionic.Platform.isAndroid()&&(V()&&cordova.plugins.Keyboard.close(),ee&&ee.blur()),ee=null,te=null}function I(){ionic.keyboard.isOpen=!0,ionic.keyboard.isOpening=!1;var e={keyboardHeight:k(),viewportHeight:ae};if(ee){e.target=ee;var t=ee.getBoundingClientRect();e.elementTop=Math.round(t.top),e.elementBottom=Math.round(t.bottom),e.windowHeight=e.viewportHeight-e.keyboardHeight,e.isElementUnderKeyboard=e.elementBottom>e.windowHeight,ionic.trigger("scrollChildIntoView",e,!0)}return setTimeout(function(){document.body.classList.add(ce)},400),e}function k(){if(ionic.keyboard.height)return ionic.keyboard.height;if(ionic.Platform.isAndroid()){if(ionic.Platform.isFullScreen)return 275;var e=window.innerHeight;return ae>e?ae-e:0}return ionic.Platform.isIOS()?ionic.keyboard.isLandscape?206:ionic.Platform.isWebView()?260:216:275}function N(e){return!!(!ionic.keyboard.isLandscape&&oe&&Math.abs(oe-e)<2)}function z(e){return!!(ionic.keyboard.isLandscape&&se&&Math.abs(se-e)<2)}function O(){le=!1,ae=G(),ionic.keyboard.isLandscape&&!se?se=ae:ionic.keyboard.isLandscape||oe||(oe=ae),ee&&ionic.trigger("resetScrollView",{target:ee},!0),ionic.keyboard.isOpen&&ionic.tap.isTextInput(ee)&&I()}function A(){var e=G();e/window.innerWidth<1&&(ionic.keyboard.isLandscape=!0),ae=e,ionic.keyboard.isLandscape&&!se?se=ae:ionic.keyboard.isLandscape||oe||(oe=ae)}function G(){var e=window.innerHeight;return ionic.Platform.isAndroid()&&ionic.Platform.isFullScreen||!ionic.keyboard.isOpen&&!ionic.keyboard.isOpening||ionic.keyboard.isClosing?e:e+k()}function V(){return!!(window.cordova&&cordova.plugins&&cordova.plugins.Keyboard)}function R(){var e;for(e=0;e<document.head.children.length;e++)if("viewport"==document.head.children[e].name){he=document.head.children[e];break}if(he){var t,n=he.content.toLowerCase().replace(/\s+/g,"").split(",");for(e=0;e<n.length;e++)n[e]&&(t=n[e].split("="),fe[t[0]]=t.length>1?t[1]:"_");H()}}function H(){var e=fe.width,t=fe.height,n=ionic.Platform,i=n.version(),r="device-width",a="device-height",o=ionic.viewport.orientation();delete fe.height,fe.width=r,n.isIPad()?i>7?delete fe.width:n.isWebView()?90==o?fe.height="0":7==i&&(fe.height=a):7>i&&(fe.height="0"):n.isIOS()&&(n.isWebView()?i>7?delete fe.width:7>i?t&&(fe.height="0"):7==i&&(fe.height=a):7>i&&t&&(fe.height="0")),(e!==fe.width||t!==fe.height)&&Y()}function Y(){var e,t=[];for(e in fe)fe[e]&&t.push(e+("_"==fe[e]?"":"="+fe[e]));he.content=t.join(", ")}window.ionic=window.ionic||{},window.ionic.views={},window.ionic.version="1.3.0",function(e){e.DelegateService=function(e){function t(){return!0}if(e.indexOf("$getByHandle")>-1)throw new Error("Method '$getByHandle' is implicitly added to each delegate service. Do not list it as a method.");return["$log",function(n){function i(e,t){this._instances=e,this.handle=t}function r(){this._instances=[]}function a(e){return function(){var t,i=this.handle,r=arguments,a=0;return this._instances.forEach(function(n){if((!i||i==n.$$delegateHandle)&&n.$$filterFn(n)){a++;var o=n[e].apply(n,r);1===a&&(t=o)}}),!a&&i?n.warn('Delegate for handle "'+i+'" could not find a corresponding element with delegate-handle="'+i+'"! '+e+"() was not called!\nPossible cause: If you are calling "+e+'() immediately, and your element with delegate-handle="'+i+'" is a child of your controller, then your element may not be compiled yet. Put a $timeout around your call to '+e+"() and try again."):t}}return e.forEach(function(e){i.prototype[e]=a(e)}),r.prototype=i.prototype,r.prototype._registerInstance=function(e,n,i){var r=this._instances;return e.$$delegateHandle=n,e.$$filterFn=i||t,r.push(e),function(){var t=r.indexOf(e);-1!==t&&r.splice(t,1)}},r.prototype.$getByHandle=function(e){return new i(this._instances,e)},new r}]}}(window.ionic),function(e,t,n){function i(){a=!0;for(var e=0;e<r.length;e++)n.requestAnimationFrame(r[e]);r=[],t.removeEventListener("DOMContentLoaded",i)}var r=[],a="complete"===t.readyState||"interactive"===t.readyState;a||t.addEventListener("DOMContentLoaded",i),e._rAF=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(t){e.setTimeout(t,16)}}();var o=e.cancelAnimationFrame||e.webkitCancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelRequestAnimationFrame;n.DomUtil={requestAnimationFrame:function(t){return e._rAF(t)},cancelAnimationFrame:function(e){o(e)},animationFrameThrottle:function(e){var t,i,r;return function(){t=arguments,r=this,i||(i=!0,n.requestAnimationFrame(function(){e.apply(r,t),i=!1}))}},contains:function(e,t){for(var n=t;n;){if(n===e)return!0;n=n.parentNode}},getPositionInParent:function(e){return{left:e.offsetLeft,top:e.offsetTop}},getOffsetTop:function(e){var t=0;if(e.offsetParent){do t+=e.offsetTop,e=e.offsetParent;while(e);return t}},ready:function(e){a?n.requestAnimationFrame(e):r.push(e)},getTextBounds:function(n){if(t.createRange){var i=t.createRange();if(i.selectNodeContents(n),i.getBoundingClientRect){var r=i.getBoundingClientRect();if(r){var a=e.scrollX,o=e.scrollY;return{top:r.top+o,left:r.left+a,right:r.left+a+r.width,bottom:r.top+o+r.height,width:r.width,height:r.height}}}}return null},getChildIndex:function(e,t){if(t)for(var n,i=e.parentNode.children,r=0,a=0,o=i.length;o>r;r++)if(n=i[r],n.nodeName&&n.nodeName.toLowerCase()==t){if(n==e)return a;a++}return Array.prototype.slice.call(e.parentNode.children).indexOf(e)},swapNodes:function(e,t){t.parentNode.insertBefore(e,t)},elementIsDescendant:function(e,t,n){var i=e;do{if(i===t)return!0;i=i.parentNode}while(i&&i!==n);return!1},getParentWithClass:function(e,t,n){for(n=n||10;e.parentNode&&n--;){if(e.parentNode.classList&&e.parentNode.classList.contains(t))return e.parentNode;e=e.parentNode}return null},getParentOrSelfWithClass:function(e,t,n){for(n=n||10;e&&n--;){if(e.classList&&e.classList.contains(t))return e;e=e.parentNode}return null},rectContains:function(e,t,n,i,r,a){return n>e||e>r?!1:i>t||t>a?!1:!0},blurAll:function(){return t.activeElement&&t.activeElement!=t.body?(t.activeElement.blur(),t.activeElement):null},cachedAttr:function(e,t,n){if(e=e&&e.length&&e[0]||e,e&&e.setAttribute){var i="$attr-"+t;return arguments.length>2?e[i]!==n&&(e.setAttribute(t,n),e[i]=n):"undefined"==typeof e[i]&&(e[i]=e.getAttribute(t)),e[i]}},cachedStyles:function(e,t){if(e=e&&e.length&&e[0]||e,e&&e.style)for(var n in t)e["$style-"+n]!==t[n]&&(e.style[n]=e["$style-"+n]=t[n])}},n.requestAnimationFrame=n.DomUtil.requestAnimationFrame,n.cancelAnimationFrame=n.DomUtil.cancelAnimationFrame,n.animationFrameThrottle=n.DomUtil.animationFrameThrottle}(window,document,ionic),function(e){e.CustomEvent=function(){if("function"==typeof window.CustomEvent)return CustomEvent;var e=function(e,t){var n;t=t||{bubbles:!1,cancelable:!1,detail:void 0};try{n=document.createEvent("CustomEvent"),n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail)}catch(i){n=document.createEvent("Event");for(var r in t)n[r]=t[r];n.initEvent(e,t.bubbles,t.cancelable)}return n};return e.prototype=window.Event.prototype,e}(),e.EventController={VIRTUALIZED_EVENTS:["tap","swipe","swiperight","swipeleft","drag","hold","release"],trigger:function(t,n,i,r){var a=new e.CustomEvent(t,{detail:n,bubbles:!!i,cancelable:!!r});n&&n.target&&n.target.dispatchEvent&&n.target.dispatchEvent(a)||window.dispatchEvent(a)},on:function(t,n,i){for(var r=i||window,a=0,o=this.VIRTUALIZED_EVENTS.length;o>a;a++)if(t==this.VIRTUALIZED_EVENTS[a]){var s=new e.Gesture(i);return s.on(t,n),s}r.addEventListener(t,n)},off:function(e,t,n){n.removeEventListener(e,t)},onGesture:function(t,n,i,r){var a=new e.Gesture(i,r);return a.on(t,n),a},offGesture:function(e,t,n){e&&e.off(t,n)},handlePopState:function(){}},e.on=function(){e.EventController.on.apply(e.EventController,arguments)},e.off=function(){e.EventController.off.apply(e.EventController,arguments)},e.trigger=e.EventController.trigger,e.onGesture=function(){return e.EventController.onGesture.apply(e.EventController.onGesture,arguments)},e.offGesture=function(){return e.EventController.offGesture.apply(e.EventController.offGesture,arguments)}}(window.ionic),function(e){function t(){if(!e.Gestures.READY){e.Gestures.event.determineEventTypes();for(var t in e.Gestures.gestures)e.Gestures.gestures.hasOwnProperty(t)&&e.Gestures.detection.register(e.Gestures.gestures[t]);e.Gestures.event.onTouch(e.Gestures.DOCUMENT,e.Gestures.EVENT_MOVE,e.Gestures.detection.detect),e.Gestures.event.onTouch(e.Gestures.DOCUMENT,e.Gestures.EVENT_END,e.Gestures.detection.detect),e.Gestures.READY=!0}}e.Gesture=function(t,n){return new e.Gestures.Instance(t,n||{})},e.Gestures={},e.Gestures.defaults={stop_browser_behavior:"disable-user-behavior"},e.Gestures.HAS_POINTEREVENTS=window.navigator.pointerEnabled||window.navigator.msPointerEnabled,e.Gestures.HAS_TOUCHEVENTS="ontouchstart"in window,e.Gestures.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,e.Gestures.NO_MOUSEEVENTS=e.Gestures.HAS_TOUCHEVENTS&&window.navigator.userAgent.match(e.Gestures.MOBILE_REGEX),e.Gestures.EVENT_TYPES={},e.Gestures.DIRECTION_DOWN="down",e.Gestures.DIRECTION_LEFT="left",e.Gestures.DIRECTION_UP="up",e.Gestures.DIRECTION_RIGHT="right",e.Gestures.POINTER_MOUSE="mouse",e.Gestures.POINTER_TOUCH="touch",e.Gestures.POINTER_PEN="pen",e.Gestures.EVENT_START="start",e.Gestures.EVENT_MOVE="move",e.Gestures.EVENT_END="end",e.Gestures.DOCUMENT=window.document,e.Gestures.plugins={},e.Gestures.READY=!1,e.Gestures.Instance=function(n,i){var r=this;return null===n?this:(t(),this.element=n,this.enabled=!0,this.options=e.Gestures.utils.extend(e.Gestures.utils.extend({},e.Gestures.defaults),i||{}),this.options.stop_browser_behavior&&e.Gestures.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),e.Gestures.event.onTouch(n,e.Gestures.EVENT_START,function(t){r.enabled&&e.Gestures.detection.startDetect(r,t)}),this)},e.Gestures.Instance.prototype={on:function(e,t){for(var n=e.split(" "),i=0;i<n.length;i++)this.element.addEventListener(n[i],t,!1);return this},off:function(e,t){for(var n=e.split(" "),i=0;i<n.length;i++)this.element.removeEventListener(n[i],t,!1);return this},trigger:function(t,n){var i=e.Gestures.DOCUMENT.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=n;var r=this.element;return e.Gestures.utils.hasParent(n.target,r)&&(r=n.target),r.dispatchEvent(i),this},enable:function(e){return this.enabled=e,this}};var n=null,i=!1,r=!1;e.Gestures.event={bindDom:function(e,t,n){for(var i=t.split(" "),r=0;r<i.length;r++)e.addEventListener(i[r],n,!1)},onTouch:function(t,a,o){var s=this;this.bindDom(t,e.Gestures.EVENT_TYPES[a],function(l){var c=l.type.toLowerCase();if(!c.match(/mouse/)||!r){c.match(/touch/)||c.match(/pointerdown/)||c.match(/mouse/)&&1===l.which?i=!0:c.match(/mouse/)&&1!==l.which&&(i=!1),c.match(/touch|pointer/)&&(r=!0);var d=0;i&&(e.Gestures.HAS_POINTEREVENTS&&a!=e.Gestures.EVENT_END?d=e.Gestures.PointerEvent.updatePointer(a,l):c.match(/touch/)?d=l.touches.length:r||(d=c.match(/up/)?0:1),d>0&&a==e.Gestures.EVENT_END?a=e.Gestures.EVENT_MOVE:d||(a=e.Gestures.EVENT_END),(d||null===n)&&(n=l),o.call(e.Gestures.detection,s.collectEventData(t,a,s.getTouchList(n,a),l)),e.Gestures.HAS_POINTEREVENTS&&a==e.Gestures.EVENT_END&&(d=e.Gestures.PointerEvent.updatePointer(a,l))),d||(n=null,i=!1,r=!1,e.Gestures.PointerEvent.reset())}})},determineEventTypes:function(){var t;t=e.Gestures.HAS_POINTEREVENTS?e.Gestures.PointerEvent.getEvents():e.Gestures.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],e.Gestures.EVENT_TYPES[e.Gestures.EVENT_START]=t[0],e.Gestures.EVENT_TYPES[e.Gestures.EVENT_MOVE]=t[1],e.Gestures.EVENT_TYPES[e.Gestures.EVENT_END]=t[2]},getTouchList:function(t){return e.Gestures.HAS_POINTEREVENTS?e.Gestures.PointerEvent.getTouchList():t.touches?t.touches:(t.identifier=1,[t])},collectEventData:function(t,n,i,r){var a=e.Gestures.POINTER_TOUCH;return(r.type.match(/mouse/)||e.Gestures.PointerEvent.matchType(e.Gestures.POINTER_MOUSE,r))&&(a=e.Gestures.POINTER_MOUSE),{center:e.Gestures.utils.getCenter(i),timeStamp:(new Date).getTime(),target:r.target,touches:i,eventType:n,pointerType:a,srcEvent:r,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return e.Gestures.detection.stopDetect()}}}},e.Gestures.PointerEvent={pointers:{},getTouchList:function(){var e=this,t=[];return Object.keys(e.pointers).sort().forEach(function(n){t.push(e.pointers[n])}),t},updatePointer:function(t,n){return t==e.Gestures.EVENT_END?this.pointers={}:(n.identifier=n.pointerId,this.pointers[n.pointerId]=n),Object.keys(this.pointers).length},matchType:function(t,n){if(!n.pointerType)return!1;var i={};return i[e.Gestures.POINTER_MOUSE]=n.pointerType==n.MSPOINTER_TYPE_MOUSE||n.pointerType==e.Gestures.POINTER_MOUSE,i[e.Gestures.POINTER_TOUCH]=n.pointerType==n.MSPOINTER_TYPE_TOUCH||n.pointerType==e.Gestures.POINTER_TOUCH,i[e.Gestures.POINTER_PEN]=n.pointerType==n.MSPOINTER_TYPE_PEN||n.pointerType==e.Gestures.POINTER_PEN,i[t]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},e.Gestures.utils={extend:function(e,t,n){for(var i in t)void 0!==e[i]&&n||(e[i]=t[i]);return e},hasParent:function(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(e){for(var t=[],n=[],i=0,r=e.length;r>i;i++)t.push(e[i].pageX),n.push(e[i].pageY);return{pageX:(Math.min.apply(Math,t)+Math.max.apply(Math,t))/2,pageY:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2}},getVelocity:function(e,t,n){return{x:Math.abs(t/e)||0,y:Math.abs(n/e)||0}},getAngle:function(e,t){var n=t.pageY-e.pageY,i=t.pageX-e.pageX;return 180*Math.atan2(n,i)/Math.PI},getDirection:function(t,n){var i=Math.abs(t.pageX-n.pageX),r=Math.abs(t.pageY-n.pageY);return i>=r?t.pageX-n.pageX>0?e.Gestures.DIRECTION_LEFT:e.Gestures.DIRECTION_RIGHT:t.pageY-n.pageY>0?e.Gestures.DIRECTION_UP:e.Gestures.DIRECTION_DOWN},getDistance:function(e,t){var n=t.pageX-e.pageX,i=t.pageY-e.pageY;return Math.sqrt(n*n+i*i)},getScale:function(e,t){return e.length>=2&&t.length>=2?this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1]):1},getRotation:function(e,t){return e.length>=2&&t.length>=2?this.getAngle(t[1],t[0])-this.getAngle(e[1],e[0]):0},isVertical:function(t){return t==e.Gestures.DIRECTION_UP||t==e.Gestures.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(e,t){e&&e.classList&&(e.classList.add(t),e.onselectstart=function(){return!1})}},e.Gestures.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,n){this.current||(this.stopped=!1,this.current={inst:t,startEvent:e.Gestures.utils.extend({},n),lastEvent:!1,name:""},this.detect(n))},detect:function(t){if(!this.current||this.stopped)return null;t=this.extendEventData(t);for(var n=this.current.inst.options,i=0,r=this.gestures.length;r>i;i++){var a=this.gestures[i];if(!this.stopped&&n[a.name]!==!1&&a.handler.call(a,t,this.current.inst)===!1){this.stopDetect();break}}return this.current&&(this.current.lastEvent=t),t.eventType==e.Gestures.EVENT_END&&!t.touches.length-1&&this.stopDetect(),t},stopDetect:function(){this.previous=e.Gestures.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(t){var n=this.current.startEvent;if(n&&(t.touches.length!=n.touches.length||t.touches===n.touches)){n.touches=[];for(var i=0,r=t.touches.length;r>i;i++)n.touches.push(e.Gestures.utils.extend({},t.touches[i]))}var a=t.timeStamp-n.timeStamp,o=t.center.pageX-n.center.pageX,s=t.center.pageY-n.center.pageY,l=e.Gestures.utils.getVelocity(a,o,s);return e.Gestures.utils.extend(t,{deltaTime:a,deltaX:o,deltaY:s,velocityX:l.x,velocityY:l.y,distance:e.Gestures.utils.getDistance(n.center,t.center),angle:e.Gestures.utils.getAngle(n.center,t.center),direction:e.Gestures.utils.getDirection(n.center,t.center),scale:e.Gestures.utils.getScale(n.touches,t.touches),rotation:e.Gestures.utils.getRotation(n.touches,t.touches),startEvent:n}),t},register:function(t){var n=t.defaults||{};return void 0===n[t.name]&&(n[t.name]=!0),e.Gestures.utils.extend(e.Gestures.defaults,n,!0),t.index=t.index||1e3,this.gestures.push(t),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}},e.Gestures.gestures=e.Gestures.gestures||{},e.Gestures.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:9},timer:null,handler:function(t,n){switch(t.eventType){case e.Gestures.EVENT_START:clearTimeout(this.timer),e.Gestures.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==e.Gestures.detection.current.name&&(e.tap.cancelClick(),n.trigger("hold",t))},n.options.hold_timeout);break;case e.Gestures.EVENT_MOVE:t.distance>n.options.hold_threshold&&clearTimeout(this.timer);break;case e.Gestures.EVENT_END:clearTimeout(this.timer)}}},e.Gestures.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(t,n){if(t.eventType==e.Gestures.EVENT_END&&"touchcancel"!=t.srcEvent.type){var i=e.Gestures.detection.previous,r=!1;if(t.deltaTime>n.options.tap_max_touchtime||t.distance>n.options.tap_max_distance)return;i&&"tap"==i.name&&t.timeStamp-i.lastEvent.timeStamp<n.options.doubletap_interval&&t.distance<n.options.doubletap_distance&&(n.trigger("doubletap",t),r=!0),(!r||n.options.tap_always)&&(e.Gestures.detection.current.name="tap",n.trigger("tap",t))}}},e.Gestures.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.4},handler:function(t,n){if(t.eventType==e.Gestures.EVENT_END){if(n.options.swipe_max_touches>0&&t.touches.length>n.options.swipe_max_touches)return;(t.velocityX>n.options.swipe_velocity||t.velocityY>n.options.swipe_velocity)&&(n.trigger(this.name,t),n.trigger(this.name+t.direction,t))}}},e.Gestures.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!0,drag_block_vertical:!0,drag_lock_to_axis:!1,drag_lock_min_distance:25,prevent_default_directions:[]},triggered:!1,handler:function(t,n){if("touchstart"==t.srcEvent.type||"touchend"==t.srcEvent.type?this.preventedFirstMove=!1:this.preventedFirstMove||"touchmove"!=t.srcEvent.type||(n.options.prevent_default_directions.length>0&&-1!=n.options.prevent_default_directions.indexOf(t.direction)&&t.srcEvent.preventDefault(),this.preventedFirstMove=!0),e.Gestures.detection.current.name!=this.name&&this.triggered)return n.trigger(this.name+"end",t),void(this.triggered=!1);if(!(n.options.drag_max_touches>0&&t.touches.length>n.options.drag_max_touches))switch(t.eventType){case e.Gestures.EVENT_START:this.triggered=!1;break;case e.Gestures.EVENT_MOVE:if(t.distance<n.options.drag_min_distance&&e.Gestures.detection.current.name!=this.name)return;if(e.Gestures.detection.current.name!=this.name&&(e.Gestures.detection.current.name=this.name,n.options.correct_for_drag_min_distance)){var i=Math.abs(n.options.drag_min_distance/t.distance);e.Gestures.detection.current.startEvent.center.pageX+=t.deltaX*i,e.Gestures.detection.current.startEvent.center.pageY+=t.deltaY*i,t=e.Gestures.detection.extendEventData(t)}(e.Gestures.detection.current.lastEvent.drag_locked_to_axis||n.options.drag_lock_to_axis&&n.options.drag_lock_min_distance<=t.distance)&&(t.drag_locked_to_axis=!0);var r=e.Gestures.detection.current.lastEvent.direction;t.drag_locked_to_axis&&r!==t.direction&&(e.Gestures.utils.isVertical(r)?t.direction=t.deltaY<0?e.Gestures.DIRECTION_UP:e.Gestures.DIRECTION_DOWN:t.direction=t.deltaX<0?e.Gestures.DIRECTION_LEFT:e.Gestures.DIRECTION_RIGHT),this.triggered||(n.trigger(this.name+"start",t),this.triggered=!0),n.trigger(this.name,t),n.trigger(this.name+t.direction,t),(n.options.drag_block_vertical&&e.Gestures.utils.isVertical(t.direction)||n.options.drag_block_horizontal&&!e.Gestures.utils.isVertical(t.direction))&&t.preventDefault();break;case e.Gestures.EVENT_END:this.triggered&&n.trigger(this.name+"end",t),this.triggered=!1}}},e.Gestures.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(t,n){if(e.Gestures.detection.current.name!=this.name&&this.triggered)return n.trigger(this.name+"end",t),void(this.triggered=!1);if(!(t.touches.length<2))switch(n.options.transform_always_block&&t.preventDefault(),t.eventType){case e.Gestures.EVENT_START:this.triggered=!1;break;case e.Gestures.EVENT_MOVE:var i=Math.abs(1-t.scale),r=Math.abs(t.rotation);if(i<n.options.transform_min_scale&&r<n.options.transform_min_rotation)return;e.Gestures.detection.current.name=this.name,this.triggered||(n.trigger(this.name+"start",t),this.triggered=!0),n.trigger(this.name,t),r>n.options.transform_min_rotation&&n.trigger("rotate",t),i>n.options.transform_min_scale&&(n.trigger("pinch",t),n.trigger("pinch"+(t.scale<1?"in":"out"),t));break;case e.Gestures.EVENT_END:this.triggered&&n.trigger(this.name+"end",t),this.triggered=!1}}},e.Gestures.gestures.Touch={name:"touch",index:-(1/0),defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(t,n){return n.options.prevent_mouseevents&&t.pointerType==e.Gestures.POINTER_MOUSE?void t.stopDetect():(n.options.prevent_default&&t.preventDefault(),void(t.eventType==e.Gestures.EVENT_START&&n.trigger(this.name,t)))}},e.Gestures.gestures.Release={name:"release",index:1/0,handler:function(t,n){t.eventType==e.Gestures.EVENT_END&&n.trigger(this.name,t)}}}(window.ionic),function(e,t,n){function i(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function r(){setTimeout(function(){!f.isReady&&f.isWebView()},_)}function a(){f.isWebView()?t.addEventListener("deviceready",o,!1):o(),s&&e.removeEventListener("load",a,!1)}function o(){f.isReady=!0,f.detect();for(var e=0;e<v.length;e++)v[e]();v=[],n.trigger("platformready",{target:t}),h(function(){t.body.classList.add("platform-ready")})}var s,l="ios",c="android",d="windowsphone",u="edge",p="crosswalk",h=n.requestAnimationFrame,f=n.Platform={navigator:e.navigator,isReady:!1,isFullScreen:!1,platforms:null,grade:null,ua:navigator.userAgent,ready:function(e){f.isReady?e():v.push(e)},detect:function(){f._checkPlatforms(),h(function(){for(var e=0;e<f.platforms.length;e++)t.body.classList.add("platform-"+f.platforms[e])})},setGrade:function(e){var n=f.grade;f.grade=e,h(function(){n&&t.body.classList.remove("grade-"+n),t.body.classList.add("grade-"+e)})},device:function(){return e.device||{}},_checkPlatforms:function(){f.platforms=[];var t="a";f.isWebView()?(f.platforms.push("webview"),e.cordova||e.PhoneGap||e.phonegap?f.platforms.push("cordova"):"object"==typeof e.forge&&f.platforms.push("trigger")):f.platforms.push("browser"),f.isIPad()&&f.platforms.push("ipad");var n=f.platform();if(n){f.platforms.push(n);var i=f.version();if(i){var r=i.toString();r.indexOf(".")>0?r=r.replace(".","_"):r+="_0",f.platforms.push(n+r.split("_")[0]),f.platforms.push(n+r),f.isAndroid()&&4.4>i?t=4>i?"c":"b":f.isWindowsPhone()&&(t="b")}}f.setGrade(t)},isWebView:function(){return!(!e.cordova&&!e.PhoneGap&&!e.phonegap&&"object"!==e.forge)},isIPad:function(){return/iPad/i.test(f.navigator.platform)?!0:/iPad/i.test(f.ua)},isIOS:function(){return f.is(l)},isAndroid:function(){return f.is(c)},isWindowsPhone:function(){return f.is(d)},isEdge:function(){return f.is(u)},isCrosswalk:function(){return f.is(p)},platform:function(){return null===m&&f.setPlatform(f.device().platform),m},setPlatform:function(e){m="undefined"!=typeof e&&null!==e&&e.length?e.toLowerCase():i("ionicplatform")?i("ionicplatform"):f.ua.indexOf("Edge")>-1?u:f.ua.indexOf("Windows Phone")>-1?d:f.ua.indexOf("Android")>0?c:/iPhone|iPad|iPod/.test(f.ua)?l:f.navigator.platform&&navigator.platform.toLowerCase().split(" ")[0]||""},version:function(){return null===g&&f.setVersion(f.device().version),g},setVersion:function(e){if("undefined"!=typeof e&&null!==e&&(e=e.split("."),e=parseFloat(e[0]+"."+(e.length>1?e[1]:0)),!isNaN(e)))return void(g=e);g=0;var t=f.platform(),n={android:/Android (\d+).(\d+)?/,ios:/OS (\d+)_(\d+)?/,windowsphone:/Windows Phone (\d+).(\d+)?/};n[t]&&(e=f.ua.match(n[t]),e&&e.length>2&&(g=parseFloat(e[1]+"."+e[2])))},is:function(e){if(e=e.toLowerCase(),f.platforms)for(var t=0;t<f.platforms.length;t++)if(f.platforms[t]===e)return!0;var n=f.platform();return n?n===e.toLowerCase():f.ua.toLowerCase().indexOf(e)>=0},exitApp:function(){f.ready(function(){navigator.app&&navigator.app.exitApp&&navigator.app.exitApp()})},showStatusBar:function(n){f._showStatusBar=n,f.ready(function(){h(function(){f._showStatusBar?(e.StatusBar&&e.StatusBar.show(),t.body.classList.remove("status-bar-hide")):(e.StatusBar&&e.StatusBar.hide(),t.body.classList.add("status-bar-hide"))})})},fullScreen:function(e,i){f.isFullScreen=e!==!1,n.DomUtil.ready(function(){h(function(){f.isFullScreen?t.body.classList.add("fullscreen"):t.body.classList.remove("fullscreen")}),f.showStatusBar(i===!0)})}},m=null,g=null,v=[],_=2e3;r(),"complete"===t.readyState?a():(s=!0,e.addEventListener("load",a,!1))}(window,document,ionic),function(e,t){"use strict";t.CSS={},t.CSS.TRANSITION=[],t.CSS.TRANSFORM=[],t.EVENTS={},function(){var n,i=["webkitTransform","transform","-webkit-transform","webkit-transform","-moz-transform","moz-transform","MozTransform","mozTransform","msTransform"];for(n=0;n<i.length;n++)if(void 0!==e.documentElement.style[i[n]]){t.CSS.TRANSFORM=i[n];break}for(i=["webkitTransition","mozTransition","msTransition","transition"],n=0;n<i.length;n++)if(void 0!==e.documentElement.style[i[n]]){t.CSS.TRANSITION=i[n];break}t.CSS.TRANSITION=t.CSS.TRANSITION||"transition";var r=t.CSS.TRANSITION.indexOf("webkit")>-1;t.CSS.TRANSITION_DURATION=(r?"-webkit-":"")+"transition-duration",t.CSS.TRANSITIONEND=(r?"webkitTransitionEnd ":"")+"transitionend"}(),function(){var e="touchstart",n="touchmove",i="touchend",r="touchcancel";window.navigator.pointerEnabled?(e="pointerdown",
n="pointermove",i="pointerup",r="pointercancel"):window.navigator.msPointerEnabled&&(e="MSPointerDown",n="MSPointerMove",i="MSPointerUp",r="MSPointerCancel"),t.EVENTS.touchstart=e,t.EVENTS.touchmove=n,t.EVENTS.touchend=i,t.EVENTS.touchcancel=r}(),"classList"in e.documentElement||!Object.defineProperty||"undefined"==typeof HTMLElement||Object.defineProperty(HTMLElement.prototype,"classList",{get:function(){function e(e){return function(){var n,i=t.className.split(/\s+/);for(n=0;n<arguments.length;n++)e(i,i.indexOf(arguments[n]),arguments[n]);t.className=i.join(" ")}}var t=this;return{add:e(function(e,t,n){~t||e.push(n)}),remove:e(function(e,t){~t&&e.splice(t,1)}),toggle:e(function(e,t,n){~t?e.splice(t,1):e.push(n)}),contains:function(e){return!!~t.className.split(/\s+/).indexOf(e)},item:function(e){return t.className.split(/\s+/)[e]||null}}}})}(document,ionic);var X,F,B,W,$,q,U,K,j="touchmove",Z=12,Q=50,J={click:i,mousedown:r,mouseup:a,mousemove:o,touchstart:s,touchend:l,touchcancel:d,touchmove:c,pointerdown:s,pointerup:l,pointercancel:d,pointermove:c,MSPointerDown:s,MSPointerUp:l,MSPointerCancel:d,MSPointerMove:c,focusin:m,focusout:g};ionic.tap={register:function(t){return X=t,e("click",!0,!0),e("mouseup"),e("mousedown"),window.navigator.pointerEnabled?(e("pointerdown"),e("pointerup"),e("pointercancel"),j="pointermove"):window.navigator.msPointerEnabled?(e("MSPointerDown"),e("MSPointerUp"),e("MSPointerCancel"),j="MSPointerMove"):(e("touchstart"),e("touchend"),e("touchcancel")),e("focusin"),e("focusout"),function(){for(var t in J)e(t,!1);X=null,F=null,B=!1,$=!1,q=null}},ignoreScrollStart:function(e){return e.defaultPrevented||/^(file|range)$/i.test(e.target.type)||"true"==(e.target.dataset?e.target.dataset.preventScroll:e.target.getAttribute("data-prevent-scroll"))||!!/^(object|embed)$/i.test(e.target.tagName)||ionic.tap.isElementTapDisabled(e.target)},isTextInput:function(e){return!!e&&("TEXTAREA"==e.tagName||"true"===e.contentEditable||"INPUT"==e.tagName&&!/^(radio|checkbox|range|file|submit|reset|color|image|button)$/i.test(e.type))},isDateInput:function(e){return!!e&&"INPUT"==e.tagName&&/^(date|time|datetime-local|month|week)$/i.test(e.type)},isVideo:function(e){return!!e&&"VIDEO"==e.tagName},isKeyboardElement:function(e){return!ionic.Platform.isIOS()||ionic.Platform.isIPad()?ionic.tap.isTextInput(e)&&!ionic.tap.isDateInput(e):ionic.tap.isTextInput(e)||!!e&&"SELECT"==e.tagName},isLabelWithTextInput:function(e){var t=w(e,!1);return!!t&&ionic.tap.isTextInput(T(t))},containsOrIsTextInput:function(e){return ionic.tap.isTextInput(e)||ionic.tap.isLabelWithTextInput(e)},cloneFocusedInput:function(e){ionic.tap.hasCheckedClone||(ionic.tap.hasCheckedClone=!0,ionic.requestAnimationFrame(function(){var t=e.querySelector(":focus");if(ionic.tap.isTextInput(t)&&!ionic.tap.isDateInput(t)){var n=t.cloneNode(!0);n.value=t.value,n.classList.add("cloned-text-input"),n.readOnly=!0,t.isContentEditable&&(n.contentEditable=t.contentEditable,n.innerHTML=t.innerHTML),t.parentElement.insertBefore(n,t),t.classList.add("previous-input-focus"),n.scrollTop=t.scrollTop}}))},hasCheckedClone:!1,removeClonedInputs:function(e){ionic.tap.hasCheckedClone=!1,ionic.requestAnimationFrame(function(){var t,n=e.querySelectorAll(".cloned-text-input"),i=e.querySelectorAll(".previous-input-focus");for(t=0;t<n.length;t++)n[t].parentElement.removeChild(n[t]);for(t=0;t<i.length;t++)i[t].classList.remove("previous-input-focus"),i[t].style.top="",ionic.keyboard.isOpen&&!ionic.keyboard.isClosing&&i[t].focus()})},requiresNativeClick:function(e){return ionic.Platform.isWindowsPhone()&&("A"==e.tagName||"BUTTON"==e.tagName||e.hasAttribute("ng-click")||"INPUT"==e.tagName&&("button"==e.type||"submit"==e.type))?!0:!e||e.disabled||/^(file|range)$/i.test(e.type)||/^(object|video)$/i.test(e.tagName)||ionic.tap.isLabelContainingFileInput(e)?!0:ionic.tap.isElementTapDisabled(e)},isLabelContainingFileInput:function(e){var t=w(e);if("LABEL"!==t.tagName)return!1;var n=t.querySelector("input[type=file]");return n&&n.disabled===!1?!0:!1},isElementTapDisabled:function(e){if(e&&1===e.nodeType)for(var t=e;t;){if("true"==(t.dataset?t.dataset.tapDisabled:t.getAttribute&&t.getAttribute("data-tap-disabled")))return!0;t=t.parentElement}return!1},setTolerance:function(e,t){Z=e,Q=t},cancelClick:function(){$=!0},pointerCoord:function(e){var t={x:0,y:0};if(e){var n=e.touches&&e.touches.length?e.touches:[e],i=e.changedTouches&&e.changedTouches[0]||n[0];i&&(t.x=i.clientX||i.pageX||0,t.y=i.clientY||i.pageY||0)}return t}},ionic.DomUtil.ready(function(){var e="undefined"!=typeof angular?angular:null;(!e||e&&!e.scenario)&&ionic.tap.register(document)}),function(e,t){"use strict";function n(){a={},t.requestAnimationFrame(r)}function i(){for(var e in a)a[e]&&(a[e].classList.add(l),o[e]=a[e]);a={}}function r(){if(t.transition&&t.transition.isActive)return void setTimeout(r,400);for(var e in o)o[e]&&(o[e].classList.remove(l),delete o[e])}var a={},o={},s=0,l="activated";t.activator={start:function(e){var n=t.tap.pointerCoord(e).x;n>0&&30>n||t.requestAnimationFrame(function(){if(!(t.scroll&&t.scroll.isScrolling||t.tap.requiresNativeClick(e.target))){for(var n,r=e.target,o=0;6>o&&(r&&1===r.nodeType);o++){if(n&&r.classList&&r.classList.contains("item")){n=r;break}if("A"==r.tagName||"BUTTON"==r.tagName||r.hasAttribute("ng-click")){n=r;break}if(r.classList&&r.classList.contains("button")){n=r;break}if("ION-CONTENT"==r.tagName||r.classList&&r.classList.contains("pane")||"BODY"==r.tagName)break;r=r.parentElement}n&&(a[s]=n,t.requestAnimationFrame(i),s=s>29?0:s+1)}})},end:function(){setTimeout(n,200)}}}(document,ionic),function(e){var t=0;e.Utils={arrayMove:function(e,t,n){if(n>=e.length)for(var i=n-e.length;i--+1;)e.push(void 0);return e.splice(n,0,e.splice(t,1)[0]),e},proxy:function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))}},debounce:function(e,t,n){var i,r,a,o,s;return function(){a=this,r=arguments,o=new Date;var l=function(){var c=new Date-o;t>c?i=setTimeout(l,t-c):(i=null,n||(s=e.apply(a,r)))},c=n&&!i;return i||(i=setTimeout(l,t)),c&&(s=e.apply(a,r)),s}},throttle:function(e,t,n){var i,r,a,o=null,s=0;n||(n={});var l=function(){s=n.leading===!1?0:Date.now(),o=null,a=e.apply(i,r)};return function(){var c=Date.now();s||n.leading!==!1||(s=c);var d=t-(c-s);return i=this,r=arguments,0>=d?(clearTimeout(o),o=null,s=c,a=e.apply(i,r)):o||n.trailing===!1||(o=setTimeout(l,d)),a}},inherit:function(t,n){var i,r=this;i=t&&t.hasOwnProperty("constructor")?t.constructor:function(){return r.apply(this,arguments)},e.extend(i,r,n);var a=function(){this.constructor=i};return a.prototype=r.prototype,i.prototype=new a,t&&e.extend(i.prototype,t),i.__super__=r.prototype,i},extend:function(e){for(var t=Array.prototype.slice.call(arguments,1),n=0;n<t.length;n++){var i=t[n];if(i)for(var r in i)e[r]=i[r]}return e},nextUid:function(){return"ion"+t++},disconnectScope:function(e){if(e&&e.$root!==e){var t=e.$parent;e.$$disconnected=!0,e.$broadcast("$ionic.disconnectScope",e),t.$$childHead===e&&(t.$$childHead=e.$$nextSibling),t.$$childTail===e&&(t.$$childTail=e.$$prevSibling),e.$$prevSibling&&(e.$$prevSibling.$$nextSibling=e.$$nextSibling),e.$$nextSibling&&(e.$$nextSibling.$$prevSibling=e.$$prevSibling),e.$$nextSibling=e.$$prevSibling=null}},reconnectScope:function(e){if(e&&e.$root!==e&&e.$$disconnected){var t=e.$parent;e.$$disconnected=!1,e.$broadcast("$ionic.reconnectScope",e),e.$$prevSibling=t.$$childTail,t.$$childHead?(t.$$childTail.$$nextSibling=e,t.$$childTail=e):t.$$childHead=t.$$childTail=e}},isScopeDisconnected:function(e){for(var t=e;t;){if(t.$$disconnected)return!0;t=t.$parent}return!1}},e.inherit=e.Utils.inherit,e.extend=e.Utils.extend,e.throttle=e.Utils.throttle,e.proxy=e.Utils.proxy,e.debounce=e.Utils.debounce}(window.ionic);var ee,te,ne,ie,re,ae=0,oe=0,se=0,le=!1,ce="keyboard-open",de="scroll-content",ue=ionic.debounce(E,200,!0),pe=ionic.debounce(y,100,!0);ionic.keyboard={isOpen:!1,isClosing:!1,isOpening:!1,height:0,isLandscape:!1,isInitialized:!1,hide:function(){V()&&cordova.plugins.Keyboard.close(),ee&&ee.blur()},show:function(){V()&&cordova.plugins.Keyboard.show()},disable:function(){V()?(window.removeEventListener("native.keyboardshow",pe),window.removeEventListener("native.keyboardhide",x)):document.body.removeEventListener("focusout",x),document.body.removeEventListener("ionic.focusin",ue),document.body.removeEventListener("focusin",ue),window.removeEventListener("orientationchange",D),window.navigator.msPointerEnabled?document.removeEventListener("MSPointerDown",S):document.removeEventListener("touchstart",S),ionic.keyboard.isInitialized=!1},enable:function(){S()}},ae=G(),ionic.Platform.ready(function(){A(),window.addEventListener("orientationchange",D),setTimeout(A,999),window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",S,!1):document.addEventListener("touchstart",S,!1)});var he,fe={};ionic.viewport={orientation:function(){return window.innerWidth>window.innerHeight?90:0}},ionic.Platform.ready(function(){R(),window.addEventListener("orientationchange",function(){setTimeout(H,1e3)},!1)}),function(e){"use strict";e.views.View=function(){this.initialize.apply(this,arguments)},e.views.View.inherit=e.inherit,e.extend(e.views.View.prototype,{initialize:function(){}})}(window.ionic);var me={effect:{}};!function(e){var t=Date.now||function(){return+new Date},n=60,i=1e3,r={},a=1;me.effect.Animate={requestAnimationFrame:function(){var t=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame,n=!!t;if(t&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(t.toString())&&(n=!1),n)return function(e,n){t(e,n)};var i=60,r={},a=0,o=1,s=null,l=+new Date;return function(e){var t=o++;return r[t]=e,a++,null===s&&(s=setInterval(function(){var e=+new Date,t=r;r={},a=0;for(var n in t)t.hasOwnProperty(n)&&(t[n](e),l=e);e-l>2500&&(clearInterval(s),s=null)},1e3/i)),t}}(),stop:function(e){var t=null!=r[e];return t&&(r[e]=null),t},isRunning:function(e){return null!=r[e]},start:function(e,o,s,l,c,d){var u=t(),p=u,h=0,f=0,m=a++;if(d||(d=document.body),m%20===0){var g={};for(var v in r)g[v]=!0;r=g}var _=function(a){var g=a!==!0,v=t();if(!r[m]||o&&!o(m))return r[m]=null,void(s&&s(n-f/((v-u)/i),m,!1));if(g)for(var w=Math.round((v-p)/(i/n))-1,T=0;T<Math.min(w,4);T++)_(!0),f++;l&&(h=(v-u)/l,h>1&&(h=1));var b=c?c(h):h;e(b,v,g)!==!1&&1!==h||!g?g&&(p=v,me.effect.Animate.requestAnimationFrame(_,d)):(r[m]=null,s&&s(n-f/((v-u)/i),m,1===h||null==l))};return r[m]=!0,me.effect.Animate.requestAnimationFrame(_,d),m}}}(window),function(e){var t=function(){},n=function(e){return Math.pow(e-1,3)+1},i=function(e){return(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2)};e.views.Scroll=e.views.View.inherit({initialize:function(n){var i=this;i.__container=n.el,i.__content=n.el.firstElementChild,setTimeout(function(){i.__container&&i.__content&&(i.__container.scrollTop=0,i.__content.scrollTop=0)}),i.options={scrollingX:!1,scrollbarX:!0,scrollingY:!0,scrollbarY:!0,startX:0,startY:0,wheelDampen:6,minScrollbarSizeX:5,minScrollbarSizeY:5,scrollbarsFade:!0,scrollbarFadeDelay:300,scrollbarResizeFadeDelay:1e3,animating:!0,animationDuration:250,decelVelocityThreshold:4,decelVelocityThresholdPaging:4,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:.5,maxZoom:3,speedMultiplier:1,deceleration:.97,preventDefault:!1,scrollingComplete:t,penetrationDeceleration:.03,penetrationAcceleration:.08,scrollEventInterval:10,freeze:!1,getContentWidth:function(){return Math.max(i.__content.scrollWidth,i.__content.offsetWidth)},getContentHeight:function(){return Math.max(i.__content.scrollHeight,i.__content.offsetHeight+2*i.__content.offsetTop)}};for(var r in n)i.options[r]=n[r];i.hintResize=e.debounce(function(){i.resize()},1e3,!0),i.onScroll=function(){e.scroll.isScrolling?(clearTimeout(i.scrollTimer),i.scrollTimer=setTimeout(i.setScrollStop,80)):setTimeout(i.setScrollStart,50)},i.freeze=function(e){return arguments.length&&(i.options.freeze=e),i.options.freeze},i.freezeShut=i.freeze,i.setScrollStart=function(){e.scroll.isScrolling=Math.abs(e.scroll.lastTop-i.__scrollTop)>1,clearTimeout(i.scrollTimer),i.scrollTimer=setTimeout(i.setScrollStop,80)},i.setScrollStop=function(){e.scroll.isScrolling=!1,e.scroll.lastTop=i.__scrollTop},i.triggerScrollEvent=e.throttle(function(){i.onScroll(),e.trigger("scroll",{scrollTop:i.__scrollTop,scrollLeft:i.__scrollLeft,target:i.__container})},i.options.scrollEventInterval),i.triggerScrollEndEvent=function(){e.trigger("scrollend",{scrollTop:i.__scrollTop,scrollLeft:i.__scrollLeft,target:i.__container})},i.__scrollLeft=i.options.startX,i.__scrollTop=i.options.startY,i.__callback=i.getRenderFn(),i.__initEventHandlers(),i.__createScrollbars()},run:function(){this.resize(),this.__fadeScrollbars("out",this.options.scrollbarResizeFadeDelay)},__isSingleTouch:!1,__isTracking:!1,__didDecelerationComplete:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__refreshHeight:null,__refreshActive:!1,__refreshActivate:null,__refreshDeactivate:null,__refreshStart:null,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,__transformProperty:null,__perspectiveProperty:null,__indicatorX:null,__indicatorY:null,__scrollbarFadeTimeout:null,__didWaitForSize:null,__sizerTimeout:null,__initEventHandlers:function(){function t(e){return e.touches&&e.touches.length?e.touches:[{pageX:e.pageX,pageY:e.pageY}]}var n,i=this,r=i.__container;if(i.scrollChildIntoView=function(t){var a=r.getBoundingClientRect().bottom;n=r.offsetHeight;var o=i.isShrunkForKeyboard,s=r.parentNode.classList.contains("modal"),l=s&&window.innerWidth>=680;if(!o){if(e.Platform.isIOS()||e.Platform.isFullScreen||l){var c=t.detail.viewportHeight-a,d=Math.max(0,t.detail.keyboardHeight-c);e.requestAnimationFrame(function(){n-=d,r.style.height=n+"px",r.style.overflow="visible",i.resize()})}i.isShrunkForKeyboard=!0}t.detail.isElementUnderKeyboard&&e.requestAnimationFrame(function(){r.scrollTop=0,i.isShrunkForKeyboard&&!o&&(a=r.getBoundingClientRect().bottom);var s=.5*n,l=(t.detail.elementBottom+t.detail.elementTop)/2,c=l-a,d=c+s;d>0&&(e.Platform.isIOS()&&e.tap.cloneFocusedInput(r,i),i.scrollBy(0,d,!0),i.onScroll())}),t.stopPropagation()},i.resetScrollView=function(){i.isShrunkForKeyboard&&(i.isShrunkForKeyboard=!1,r.style.height="",r.style.overflow=""),i.resize()},r.addEventListener("scrollChildIntoView",i.scrollChildIntoView),document.addEventListener("resetScrollView",i.resetScrollView),i.touchStart=function(n){if(i.startCoordinates=e.tap.pointerCoord(n),!e.tap.ignoreScrollStart(n)){if(i.__isDown=!0,e.tap.containsOrIsTextInput(n.target)||"SELECT"===n.target.tagName)return void(i.__hasStarted=!1);i.__isSelectable=!0,i.__enableScrollY=!0,i.__hasStarted=!0,i.doTouchStart(t(n),n.timeStamp),n.preventDefault()}},i.touchMove=function(n){if(!(i.options.freeze||!i.__isDown||!i.__isDown&&n.defaultPrevented||"TEXTAREA"===n.target.tagName&&n.target.parentElement.querySelector(":focus"))){if(!i.__hasStarted&&(e.tap.containsOrIsTextInput(n.target)||"SELECT"===n.target.tagName))return i.__hasStarted=!0,i.doTouchStart(t(n),n.timeStamp),void n.preventDefault();if(i.startCoordinates){var a=e.tap.pointerCoord(n);i.__isSelectable&&e.tap.isTextInput(n.target)&&Math.abs(i.startCoordinates.x-a.x)>20&&(i.__enableScrollY=!1,i.__isSelectable=!0),i.__enableScrollY&&Math.abs(i.startCoordinates.y-a.y)>10&&(i.__isSelectable=!1,e.tap.cloneFocusedInput(r,i))}i.doTouchMove(t(n),n.timeStamp,n.scale),i.__isDown=!0}},i.touchMoveBubble=function(e){i.__isDown&&i.options.preventDefault&&e.preventDefault()},i.touchEnd=function(t){i.__isDown&&(i.doTouchEnd(t,t.timeStamp),i.__isDown=!1,i.__hasStarted=!1,i.__isSelectable=!0,i.__enableScrollY=!0,i.__isDragging||i.__isDecelerating||i.__isAnimating||e.tap.removeClonedInputs(r,i))},i.mouseWheel=e.animationFrameThrottle(function(t){var n=e.DomUtil.getParentOrSelfWithClass(t.target,"ionic-scroll");i.options.freeze||n!==i.__container||(i.hintResize(),i.scrollBy((t.wheelDeltaX||t.deltaX||0)/i.options.wheelDampen,(-t.wheelDeltaY||t.deltaY||0)/i.options.wheelDampen),i.__fadeScrollbars("in"),clearTimeout(i.__wheelHideBarTimeout),i.__wheelHideBarTimeout=setTimeout(function(){i.__fadeScrollbars("out")},100))}),"ontouchstart"in window)r.addEventListener("touchstart",i.touchStart,!1),i.options.preventDefault&&r.addEventListener("touchmove",i.touchMoveBubble,!1),document.addEventListener("touchmove",i.touchMove,!1),document.addEventListener("touchend",i.touchEnd,!1),document.addEventListener("touchcancel",i.touchEnd,!1),document.addEventListener("wheel",i.mouseWheel,!1);else if(window.navigator.pointerEnabled)r.addEventListener("pointerdown",i.touchStart,!1),i.options.preventDefault&&r.addEventListener("pointermove",i.touchMoveBubble,!1),document.addEventListener("pointermove",i.touchMove,!1),document.addEventListener("pointerup",i.touchEnd,!1),document.addEventListener("pointercancel",i.touchEnd,!1),document.addEventListener("wheel",i.mouseWheel,!1);else if(window.navigator.msPointerEnabled)r.addEventListener("MSPointerDown",i.touchStart,!1),i.options.preventDefault&&r.addEventListener("MSPointerMove",i.touchMoveBubble,!1),document.addEventListener("MSPointerMove",i.touchMove,!1),document.addEventListener("MSPointerUp",i.touchEnd,!1),document.addEventListener("MSPointerCancel",i.touchEnd,!1),document.addEventListener("wheel",i.mouseWheel,!1);else{var a=!1;i.mouseDown=function(n){e.tap.ignoreScrollStart(n)||"SELECT"===n.target.tagName||(i.doTouchStart(t(n),n.timeStamp),e.tap.isTextInput(n.target)||n.preventDefault(),a=!0)},i.mouseMove=function(e){i.options.freeze||!a||!a&&e.defaultPrevented||(i.doTouchMove(t(e),e.timeStamp),a=!0)},i.mouseMoveBubble=function(e){a&&i.options.preventDefault&&e.preventDefault()},i.mouseUp=function(e){a&&(i.doTouchEnd(e,e.timeStamp),a=!1)},r.addEventListener("mousedown",i.mouseDown,!1),i.options.preventDefault&&r.addEventListener("mousemove",i.mouseMoveBubble,!1),document.addEventListener("mousemove",i.mouseMove,!1),document.addEventListener("mouseup",i.mouseUp,!1),document.addEventListener("mousewheel",i.mouseWheel,!1),document.addEventListener("wheel",i.mouseWheel,!1)}},__cleanup:function(){var n=this,i=n.__container;i.removeEventListener("touchstart",n.touchStart),i.removeEventListener("touchmove",n.touchMoveBubble),document.removeEventListener("touchmove",n.touchMove),document.removeEventListener("touchend",n.touchEnd),document.removeEventListener("touchcancel",n.touchEnd),i.removeEventListener("pointerdown",n.touchStart),i.removeEventListener("pointermove",n.touchMoveBubble),document.removeEventListener("pointermove",n.touchMove),document.removeEventListener("pointerup",n.touchEnd),document.removeEventListener("pointercancel",n.touchEnd),i.removeEventListener("MSPointerDown",n.touchStart),i.removeEventListener("MSPointerMove",n.touchMoveBubble),document.removeEventListener("MSPointerMove",n.touchMove),document.removeEventListener("MSPointerUp",n.touchEnd),document.removeEventListener("MSPointerCancel",n.touchEnd),i.removeEventListener("mousedown",n.mouseDown),i.removeEventListener("mousemove",n.mouseMoveBubble),document.removeEventListener("mousemove",n.mouseMove),document.removeEventListener("mouseup",n.mouseUp),document.removeEventListener("mousewheel",n.mouseWheel),document.removeEventListener("wheel",n.mouseWheel),i.removeEventListener("scrollChildIntoView",n.scrollChildIntoView),document.removeEventListener("resetScrollView",n.resetScrollView),e.tap.removeClonedInputs(i,n),delete n.__container,delete n.__content,delete n.__indicatorX,delete n.__indicatorY,delete n.options.el,n.__callback=n.scrollChildIntoView=n.resetScrollView=t,n.mouseMove=n.mouseDown=n.mouseUp=n.mouseWheel=n.touchStart=n.touchMove=n.touchEnd=n.touchCancel=t,n.resize=n.scrollTo=n.zoomTo=n.__scrollingComplete=t,i=null},__createScrollbar:function(e){var t=document.createElement("div"),n=document.createElement("div");return n.className="scroll-bar-indicator scroll-bar-fade-out","h"==e?t.className="scroll-bar scroll-bar-h":t.className="scroll-bar scroll-bar-v",t.appendChild(n),t},__createScrollbars:function(){var e,t,n=this;n.options.scrollingX&&(e={el:n.__createScrollbar("h"),sizeRatio:1},e.indicator=e.el.children[0],n.options.scrollbarX&&n.__container.appendChild(e.el),n.__indicatorX=e),n.options.scrollingY&&(t={el:n.__createScrollbar("v"),sizeRatio:1},t.indicator=t.el.children[0],n.options.scrollbarY&&n.__container.appendChild(t.el),n.__indicatorY=t)},__resizeScrollbars:function(){var t=this;if(t.__indicatorX){var n=Math.max(Math.round(t.__clientWidth*t.__clientWidth/t.__contentWidth),20);n>t.__contentWidth&&(n=0),n!==t.__indicatorX.size&&e.requestAnimationFrame(function(){t.__indicatorX.indicator.style.width=n+"px"}),t.__indicatorX.size=n,t.__indicatorX.minScale=t.options.minScrollbarSizeX/n,t.__indicatorX.maxPos=t.__clientWidth-n,t.__indicatorX.sizeRatio=t.__maxScrollLeft?t.__indicatorX.maxPos/t.__maxScrollLeft:1}if(t.__indicatorY){var i=Math.max(Math.round(t.__clientHeight*t.__clientHeight/t.__contentHeight),20);i>t.__contentHeight&&(i=0),i!==t.__indicatorY.size&&e.requestAnimationFrame(function(){t.__indicatorY&&(t.__indicatorY.indicator.style.height=i+"px")}),t.__indicatorY.size=i,t.__indicatorY.minScale=t.options.minScrollbarSizeY/i,t.__indicatorY.maxPos=t.__clientHeight-i,t.__indicatorY.sizeRatio=t.__maxScrollTop?t.__indicatorY.maxPos/t.__maxScrollTop:1}},__repositionScrollbars:function(){var e,t,n,i,r,a,o=this,s=0,l=0;if(o.__indicatorX){o.__indicatorY&&(s=10),r=Math.round(o.__indicatorX.sizeRatio*o.__scrollLeft)||0,n=o.__scrollLeft-(o.__maxScrollLeft-s),o.__scrollLeft<0?(t=Math.max(o.__indicatorX.minScale,(o.__indicatorX.size-Math.abs(o.__scrollLeft))/o.__indicatorX.size),r=0,o.__indicatorX.indicator.style[o.__transformOriginProperty]="left center"):n>0?(t=Math.max(o.__indicatorX.minScale,(o.__indicatorX.size-n)/o.__indicatorX.size),r=o.__indicatorX.maxPos-s,o.__indicatorX.indicator.style[o.__transformOriginProperty]="right center"):(r=Math.min(o.__maxScrollLeft,Math.max(0,r)),t=1);var c="translate3d("+r+"px, 0, 0) scaleX("+t+")";o.__indicatorX.transformProp!==c&&(o.__indicatorX.indicator.style[o.__transformProperty]=c,o.__indicatorX.transformProp=c)}if(o.__indicatorY){a=Math.round(o.__indicatorY.sizeRatio*o.__scrollTop)||0,o.__indicatorX&&(l=10),i=o.__scrollTop-(o.__maxScrollTop-l),o.__scrollTop<0?(e=Math.max(o.__indicatorY.minScale,(o.__indicatorY.size-Math.abs(o.__scrollTop))/o.__indicatorY.size),a=0,"center top"!==o.__indicatorY.originProp&&(o.__indicatorY.indicator.style[o.__transformOriginProperty]="center top",o.__indicatorY.originProp="center top")):i>0?(e=Math.max(o.__indicatorY.minScale,(o.__indicatorY.size-i)/o.__indicatorY.size),a=o.__indicatorY.maxPos-l,"center bottom"!==o.__indicatorY.originProp&&(o.__indicatorY.indicator.style[o.__transformOriginProperty]="center bottom",o.__indicatorY.originProp="center bottom")):(a=Math.min(o.__maxScrollTop,Math.max(0,a)),e=1);var d="translate3d(0,"+a+"px, 0) scaleY("+e+")";o.__indicatorY.transformProp!==d&&(o.__indicatorY.indicator.style[o.__transformProperty]=d,o.__indicatorY.transformProp=d)}},__fadeScrollbars:function(e,t){var n=this;if(n.options.scrollbarsFade){var i="scroll-bar-fade-out";n.options.scrollbarsFade===!0&&(clearTimeout(n.__scrollbarFadeTimeout),"in"==e?(n.__indicatorX&&n.__indicatorX.indicator.classList.remove(i),n.__indicatorY&&n.__indicatorY.indicator.classList.remove(i)):n.__scrollbarFadeTimeout=setTimeout(function(){n.__indicatorX&&n.__indicatorX.indicator.classList.add(i),n.__indicatorY&&n.__indicatorY.indicator.classList.add(i)},t||n.options.scrollbarFadeDelay))}},__scrollingComplete:function(){this.options.scrollingComplete(),e.tap.removeClonedInputs(this.__container,this),this.__fadeScrollbars("out")},resize:function(e){var t=this;t.__container&&t.options&&t.setDimensions(t.__container.clientWidth,t.__container.clientHeight,t.options.getContentWidth(),t.options.getContentHeight(),e)},getRenderFn:function(){var e,t=this,n=t.__content,i=document.documentElement.style;"MozAppearance"in i?e="gecko":"WebkitAppearance"in i?e="webkit":"string"==typeof navigator.cpuClass&&(e="trident");var r,a={trident:"ms",gecko:"Moz",webkit:"Webkit",presto:"O"}[e],o=document.createElement("div"),s=a+"Perspective",l=a+"Transform",c=a+"TransformOrigin";return t.__perspectiveProperty=l,t.__transformProperty=l,t.__transformOriginProperty=c,o.style[s]!==r?function(e,i,r,a){var o="translate3d("+-e+"px,"+-i+"px,0) scale("+r+")";o!==t.contentTransform&&(n.style[l]=o,t.contentTransform=o),t.__repositionScrollbars(),a||t.triggerScrollEvent()}:o.style[l]!==r?function(e,i,r,a){n.style[l]="translate("+-e+"px,"+-i+"px) scale("+r+")",t.__repositionScrollbars(),a||t.triggerScrollEvent()}:function(e,i,r,a){n.style.marginLeft=e?-e/r+"px":"",n.style.marginTop=i?-i/r+"px":"",n.style.zoom=r||"",t.__repositionScrollbars(),a||t.triggerScrollEvent()}},setDimensions:function(e,t,n,i,r){var a=this;(e||t||n||i)&&(e===+e&&(a.__clientWidth=e),t===+t&&(a.__clientHeight=t),n===+n&&(a.__contentWidth=n),i===+i&&(a.__contentHeight=i),a.__computeScrollMax(),a.__resizeScrollbars(),r||a.scrollTo(a.__scrollLeft,a.__scrollTop,!0,null,!0))},setPosition:function(e,t){this.__clientLeft=e||0,this.__clientTop=t||0},setSnapSize:function(e,t){this.__snapWidth=e,this.__snapHeight=t},activatePullToRefresh:function(t,n){var i=this;i.__refreshHeight=t,i.__refreshActivate=function(){e.requestAnimationFrame(n.activate)},i.__refreshDeactivate=function(){e.requestAnimationFrame(n.deactivate)},i.__refreshStart=function(){e.requestAnimationFrame(n.start)},i.__refreshShow=function(){e.requestAnimationFrame(n.show)},i.__refreshHide=function(){e.requestAnimationFrame(n.hide)},i.__refreshTail=function(){e.requestAnimationFrame(n.tail)},i.__refreshTailTime=100,i.__minSpinTime=600},triggerPullToRefresh:function(){this.__publish(this.__scrollLeft,-this.__refreshHeight,this.__zoomLevel,!0);var e=new Date;this.refreshStartTime=e.getTime(),this.__refreshStart&&this.__refreshStart()},finishPullToRefresh:function(){var e=this,t=new Date,n=0;e.refreshStartTime+e.__minSpinTime>t.getTime()&&(n=e.refreshStartTime+e.__minSpinTime-t.getTime()),setTimeout(function(){e.__refreshTail&&e.__refreshTail(),setTimeout(function(){e.__refreshActive=!1,e.__refreshDeactivate&&e.__refreshDeactivate(),e.__refreshHide&&e.__refreshHide(),e.scrollTo(e.__scrollLeft,e.__scrollTop,!0)},e.__refreshTailTime)},n)},getValues:function(){return{left:this.__scrollLeft,top:this.__scrollTop,zoom:this.__zoomLevel}},getScrollMax:function(){return{left:this.__maxScrollLeft,top:this.__maxScrollTop}},zoomTo:function(e,t,n,i){var r=this;if(!r.options.zooming)throw new Error("Zooming is not enabled!");r.__isDecelerating&&(me.effect.Animate.stop(r.__isDecelerating),r.__isDecelerating=!1);var a=r.__zoomLevel;null==n&&(n=r.__clientWidth/2),null==i&&(i=r.__clientHeight/2),e=Math.max(Math.min(e,r.options.maxZoom),r.options.minZoom),r.__computeScrollMax(e);var o=(n+r.__scrollLeft)*e/a-n,s=(i+r.__scrollTop)*e/a-i;o>r.__maxScrollLeft?o=r.__maxScrollLeft:0>o&&(o=0),s>r.__maxScrollTop?s=r.__maxScrollTop:0>s&&(s=0),r.__publish(o,s,e,t)},zoomBy:function(e,t,n,i){this.zoomTo(this.__zoomLevel*e,t,n,i)},scrollTo:function(e,t,n,i,r){var a=this;if(a.__isDecelerating&&(me.effect.Animate.stop(a.__isDecelerating),a.__isDecelerating=!1),null!=i&&i!==a.__zoomLevel){if(!a.options.zooming)throw new Error("Zooming is not enabled!");e*=i,t*=i,a.__computeScrollMax(i)}else i=a.__zoomLevel;a.options.scrollingX?a.options.paging?e=Math.round(e/a.__clientWidth)*a.__clientWidth:a.options.snapping&&(e=Math.round(e/a.__snapWidth)*a.__snapWidth):e=a.__scrollLeft,a.options.scrollingY?a.options.paging?t=Math.round(t/a.__clientHeight)*a.__clientHeight:a.options.snapping&&(t=Math.round(t/a.__snapHeight)*a.__snapHeight):t=a.__scrollTop,e=Math.max(Math.min(a.__maxScrollLeft,e),0),t=Math.max(Math.min(a.__maxScrollTop,t),0),e===a.__scrollLeft&&t===a.__scrollTop&&(n=!1),a.__publish(e,t,i,n,r)},scrollBy:function(e,t,n){var i=this,r=i.__isAnimating?i.__scheduledLeft:i.__scrollLeft,a=i.__isAnimating?i.__scheduledTop:i.__scrollTop;i.scrollTo(r+(e||0),a+(t||0),n)},doMouseZoom:function(e,t,n,i){var r=e>0?.97:1.03;return this.zoomTo(this.__zoomLevel*r,!1,n-this.__clientLeft,i-this.__clientTop)},doTouchStart:function(e,t){var n=this;n.__decStopped=!(!n.__isDecelerating&&!n.__isAnimating),n.hintResize(),t instanceof Date&&(t=t.valueOf()),"number"!=typeof t&&(t=Date.now()),n.__interruptedAnimation=!0,n.__isDecelerating&&(me.effect.Animate.stop(n.__isDecelerating),n.__isDecelerating=!1,n.__interruptedAnimation=!0),n.__isAnimating&&(me.effect.Animate.stop(n.__isAnimating),n.__isAnimating=!1,n.__interruptedAnimation=!0);var i,r,a=1===e.length;a?(i=e[0].pageX,r=e[0].pageY):(i=Math.abs(e[0].pageX+e[1].pageX)/2,r=Math.abs(e[0].pageY+e[1].pageY)/2),n.__initialTouchLeft=i,n.__initialTouchTop=r,n.__initialTouches=e,n.__zoomLevelStart=n.__zoomLevel,n.__lastTouchLeft=i,n.__lastTouchTop=r,n.__lastTouchMove=t,n.__lastScale=1,n.__enableScrollX=!a&&n.options.scrollingX,n.__enableScrollY=!a&&n.options.scrollingY,n.__isTracking=!0,n.__didDecelerationComplete=!1,n.__isDragging=!a,n.__isSingleTouch=a,n.__positions=[]},doTouchMove:function(e,t,n){t instanceof Date&&(t=t.valueOf()),"number"!=typeof t&&(t=Date.now());var i=this;if(i.__isTracking){var r,a;2===e.length?(r=Math.abs(e[0].pageX+e[1].pageX)/2,a=Math.abs(e[0].pageY+e[1].pageY)/2,!n&&i.options.zooming&&(n=i.__getScale(i.__initialTouches,e))):(r=e[0].pageX,a=e[0].pageY);var o=i.__positions;if(i.__isDragging){i.__decStopped=!1;var s=r-i.__lastTouchLeft,l=a-i.__lastTouchTop,c=i.__scrollLeft,d=i.__scrollTop,u=i.__zoomLevel;if(null!=n&&i.options.zooming){var p=u;if(u=u/i.__lastScale*n,u=Math.max(Math.min(u,i.options.maxZoom),i.options.minZoom),p!==u){var h=r-i.__clientLeft,f=a-i.__clientTop;c=(h+c)*u/p-h,d=(f+d)*u/p-f,i.__computeScrollMax(u)}}if(i.__enableScrollX){c-=s*i.options.speedMultiplier;var m=i.__maxScrollLeft;(c>m||0>c)&&(i.options.bouncing?c+=s/2*i.options.speedMultiplier:c=c>m?m:0)}if(i.__enableScrollY){d-=l*i.options.speedMultiplier;var g=i.__maxScrollTop;d>g||0>d?i.options.bouncing||i.__refreshHeight&&0>d?(d+=l/2*i.options.speedMultiplier,i.__enableScrollX||null==i.__refreshHeight||(0>d?(i.__refreshHidden=!1,i.__refreshShow()):(i.__refreshHide(),i.__refreshHidden=!0),!i.__refreshActive&&d<=-i.__refreshHeight?(i.__refreshActive=!0,i.__refreshActivate&&i.__refreshActivate()):i.__refreshActive&&d>-i.__refreshHeight&&(i.__refreshActive=!1,i.__refreshDeactivate&&i.__refreshDeactivate()))):d=d>g?g:0:i.__refreshHeight&&!i.__refreshHidden&&(i.__refreshHide(),i.__refreshHidden=!0)}o.length>60&&o.splice(0,30),o.push(c,d,t),i.__publish(c,d,u)}else{var v=i.options.locking?3:0,_=5,w=Math.abs(r-i.__initialTouchLeft),T=Math.abs(a-i.__initialTouchTop);i.__enableScrollX=i.options.scrollingX&&w>=v,i.__enableScrollY=i.options.scrollingY&&T>=v,o.push(i.__scrollLeft,i.__scrollTop,t),i.__isDragging=(i.__enableScrollX||i.__enableScrollY)&&(w>=_||T>=_),i.__isDragging&&(i.__interruptedAnimation=!1,i.__fadeScrollbars("in"))}i.__lastTouchLeft=r,i.__lastTouchTop=a,i.__lastTouchMove=t,i.__lastScale=n}},doTouchEnd:function(t,n){n instanceof Date&&(n=n.valueOf()),"number"!=typeof n&&(n=Date.now());var i=this;if(i.__isTracking){if(i.__isTracking=!1,i.__isDragging)if(i.__isDragging=!1,i.__isSingleTouch&&i.options.animating&&n-i.__lastTouchMove<=100){for(var r=i.__positions,a=r.length-1,o=a,s=a;s>0&&r[s]>i.__lastTouchMove-100;s-=3)o=s;
if(o!==a){var l=r[a]-r[o],c=i.__scrollLeft-r[o-2],d=i.__scrollTop-r[o-1];i.__decelerationVelocityX=c/l*(1e3/60),i.__decelerationVelocityY=d/l*(1e3/60);var u=i.options.paging||i.options.snapping?i.options.decelVelocityThresholdPaging:i.options.decelVelocityThreshold;(Math.abs(i.__decelerationVelocityX)>u||Math.abs(i.__decelerationVelocityY)>u)&&(i.__refreshActive||i.__startDeceleration(n))}else i.__scrollingComplete()}else n-i.__lastTouchMove>100&&i.__scrollingComplete();else i.__decStopped&&(t.isTapHandled=!0,i.__decStopped=!1);if(!i.__isDecelerating)if(i.__refreshActive&&i.__refreshStart){i.__publish(i.__scrollLeft,-i.__refreshHeight,i.__zoomLevel,!0);var p=new Date;i.refreshStartTime=p.getTime(),i.__refreshStart&&i.__refreshStart(),e.Platform.isAndroid()||i.__startDeceleration()}else(i.__interruptedAnimation||i.__isDragging)&&i.__scrollingComplete(),i.scrollTo(i.__scrollLeft,i.__scrollTop,!0,i.__zoomLevel),i.__refreshActive&&(i.__refreshActive=!1,i.__refreshDeactivate&&i.__refreshDeactivate());i.__positions.length=0}},__publish:function(e,t,r,a,o){var s=this,l=s.__isAnimating;if(l&&(me.effect.Animate.stop(l),s.__isAnimating=!1),a&&s.options.animating){s.__scheduledLeft=e,s.__scheduledTop=t,s.__scheduledZoom=r;var c=s.__scrollLeft,d=s.__scrollTop,u=s.__zoomLevel,p=e-c,h=t-d,f=r-u,m=function(e,t,n){n&&(s.__scrollLeft=c+p*e,s.__scrollTop=d+h*e,s.__zoomLevel=u+f*e,s.__callback&&s.__callback(s.__scrollLeft,s.__scrollTop,s.__zoomLevel,o))},g=function(e){return s.__isAnimating===e},v=function(e,t,n){t===s.__isAnimating&&(s.__isAnimating=!1),(s.__didDecelerationComplete||n)&&s.__scrollingComplete(),s.options.zooming&&s.__computeScrollMax()};s.__isAnimating=me.effect.Animate.start(m,g,v,s.options.animationDuration,l?n:i)}else s.__scheduledLeft=s.__scrollLeft=e,s.__scheduledTop=s.__scrollTop=t,s.__scheduledZoom=s.__zoomLevel=r,s.__callback&&s.__callback(e,t,r,o),s.options.zooming&&s.__computeScrollMax()},__computeScrollMax:function(e){var t=this;null==e&&(e=t.__zoomLevel),t.__maxScrollLeft=Math.max(t.__contentWidth*e-t.__clientWidth,0),t.__maxScrollTop=Math.max(t.__contentHeight*e-t.__clientHeight,0),t.__didWaitForSize||t.__maxScrollLeft||t.__maxScrollTop||(t.__didWaitForSize=!0,t.__waitForSize())},__waitForSize:function(){var e=this;clearTimeout(e.__sizerTimeout);var t=function(){e.resize(!0)};t(),e.__sizerTimeout=setTimeout(t,500)},__startDeceleration:function(){var e=this;if(e.options.paging){var t=Math.max(Math.min(e.__scrollLeft,e.__maxScrollLeft),0),n=Math.max(Math.min(e.__scrollTop,e.__maxScrollTop),0),i=e.__clientWidth,r=e.__clientHeight;e.__minDecelerationScrollLeft=Math.floor(t/i)*i,e.__minDecelerationScrollTop=Math.floor(n/r)*r,e.__maxDecelerationScrollLeft=Math.ceil(t/i)*i,e.__maxDecelerationScrollTop=Math.ceil(n/r)*r}else e.__minDecelerationScrollLeft=0,e.__minDecelerationScrollTop=0,e.__maxDecelerationScrollLeft=e.__maxScrollLeft,e.__maxDecelerationScrollTop=e.__maxScrollTop,e.__refreshActive&&(e.__minDecelerationScrollTop=-1*e.__refreshHeight);var a=function(t,n,i){e.__stepThroughDeceleration(i)};e.__minVelocityToKeepDecelerating=e.options.snapping?4:.1;var o=function(){var t=Math.abs(e.__decelerationVelocityX)>=e.__minVelocityToKeepDecelerating||Math.abs(e.__decelerationVelocityY)>=e.__minVelocityToKeepDecelerating;return t||(e.__didDecelerationComplete=!0,e.options.bouncing&&!e.__refreshActive&&e.scrollTo(Math.min(Math.max(e.__scrollLeft,0),e.__maxScrollLeft),Math.min(Math.max(e.__scrollTop,0),e.__maxScrollTop),e.__refreshActive)),t},s=function(){e.__isDecelerating=!1,e.__didDecelerationComplete&&e.__scrollingComplete(),e.options.paging&&e.scrollTo(e.__scrollLeft,e.__scrollTop,e.options.snapping)};e.__isDecelerating=me.effect.Animate.start(a,o,s)},__stepThroughDeceleration:function(e){var t=this,n=t.__scrollLeft+t.__decelerationVelocityX,i=t.__scrollTop+t.__decelerationVelocityY;if(!t.options.bouncing){var r=Math.max(Math.min(t.__maxDecelerationScrollLeft,n),t.__minDecelerationScrollLeft);r!==n&&(n=r,t.__decelerationVelocityX=0);var a=Math.max(Math.min(t.__maxDecelerationScrollTop,i),t.__minDecelerationScrollTop);a!==i&&(i=a,t.__decelerationVelocityY=0)}if(e?t.__publish(n,i,t.__zoomLevel):(t.__scrollLeft=n,t.__scrollTop=i),!t.options.paging){var o=t.options.deceleration;t.__decelerationVelocityX*=o,t.__decelerationVelocityY*=o}if(t.options.bouncing){var s=0,l=0,c=t.options.penetrationDeceleration,d=t.options.penetrationAcceleration;if(n<t.__minDecelerationScrollLeft?s=t.__minDecelerationScrollLeft-n:n>t.__maxDecelerationScrollLeft&&(s=t.__maxDecelerationScrollLeft-n),i<t.__minDecelerationScrollTop?l=t.__minDecelerationScrollTop-i:i>t.__maxDecelerationScrollTop&&(l=t.__maxDecelerationScrollTop-i),0!==s){var u=s*t.__decelerationVelocityX<=t.__minDecelerationScrollLeft;u&&(t.__decelerationVelocityX+=s*c);var p=Math.abs(t.__decelerationVelocityX)<=t.__minVelocityToKeepDecelerating;(!u||p)&&(t.__decelerationVelocityX=s*d)}if(0!==l){var h=l*t.__decelerationVelocityY<=t.__minDecelerationScrollTop;h&&(t.__decelerationVelocityY+=l*c);var f=Math.abs(t.__decelerationVelocityY)<=t.__minVelocityToKeepDecelerating;(!h||f)&&(t.__decelerationVelocityY=l*d)}}},__getDistance:function(e,t){var n=t.pageX-e.pageX,i=t.pageY-e.pageY;return Math.sqrt(n*n+i*i)},__getScale:function(e,t){return e.length>=2&&t.length>=2?this.__getDistance(t[0],t[1])/this.__getDistance(e[0],e[1]):1}}),e.scroll={isScrolling:!1,lastTop:0}}(ionic),function(e){var t=function(){},n=function(e){};e.views.ScrollNative=e.views.View.inherit({initialize:function(t){var n=this;n.__container=n.el=t.el,n.__content=t.el.firstElementChild,n.__frozen=!1,n.isNative=!0,n.__scrollTop=n.el.scrollTop,n.__scrollLeft=n.el.scrollLeft,n.__clientHeight=n.__content.clientHeight,n.__clientWidth=n.__content.clientWidth,n.__maxScrollTop=Math.max(n.__contentHeight-n.__clientHeight,0),n.__maxScrollLeft=Math.max(n.__contentWidth-n.__clientWidth,0),(t.startY>=0||t.startX>=0)&&e.requestAnimationFrame(function(){n.el.scrollTop=t.startY||0,n.el.scrollLeft=t.startX||0,n.__scrollTop=n.el.scrollTop,n.__scrollLeft=n.el.scrollLeft}),n.options={freeze:!1,getContentWidth:function(){return Math.max(n.__content.scrollWidth,n.__content.offsetWidth)},getContentHeight:function(){return Math.max(n.__content.scrollHeight,n.__content.offsetHeight+2*n.__content.offsetTop)}};for(var i in t)n.options[i]=t[i];n.onScroll=function(){e.scroll.isScrolling||(e.scroll.isScrolling=!0),clearTimeout(n.scrollTimer),n.scrollTimer=setTimeout(function(){e.scroll.isScrolling=!1},80)},n.freeze=function(e){n.__frozen=e},n.freezeShut=function(e){n.__frozenShut=e},n.__initEventHandlers()},__callback:function(){n("__callback")},zoomTo:function(){n("zoomTo")},zoomBy:function(){n("zoomBy")},activatePullToRefresh:function(){n("activatePullToRefresh")},resize:function(e){var t=this;t.__container&&t.options&&t.setDimensions(t.__container.clientWidth,t.__container.clientHeight,t.options.getContentWidth(),t.options.getContentHeight(),e)},run:function(){this.resize()},getValues:function(){var e=this;return e.update(),{left:e.__scrollLeft,top:e.__scrollTop,zoom:1}},update:function(){var e=this;e.__scrollLeft=e.el.scrollLeft,e.__scrollTop=e.el.scrollTop},setDimensions:function(e,t,n,i){var r=this;(e||t||n||i)&&(e===+e&&(r.__clientWidth=e),t===+t&&(r.__clientHeight=t),n===+n&&(r.__contentWidth=n),i===+i&&(r.__contentHeight=i),r.__computeScrollMax())},getScrollMax:function(){return{left:this.__maxScrollLeft,top:this.__maxScrollTop}},scrollBy:function(e,t,n){var i=this;i.update();var r=i.__isAnimating?i.__scheduledLeft:i.__scrollLeft,a=i.__isAnimating?i.__scheduledTop:i.__scrollTop;i.scrollTo(r+(e||0),a+(t||0),n)},scrollTo:function(t,n,i){function r(t,n){function i(e){return--e*e*e+1}function r(){var p=Date.now(),h=Math.min(1,(p-l)/c),f=i(h);d!=t&&(a.el.scrollTop=parseInt(f*(t-d)+d,10)),u!=n&&(a.el.scrollLeft=parseInt(f*(n-u)+u,10)),1>h?e.requestAnimationFrame(r):(e.tap.removeClonedInputs(a.__container,a),a.el.style.overflowX=o,a.el.style.overflowY=s,a.resize())}var l=Date.now(),c=250,d=a.el.scrollTop,u=a.el.scrollLeft;return d===t&&u===n?(a.el.style.overflowX=o,a.el.style.overflowY=s,void a.resize()):void e.requestAnimationFrame(r)}var a=this;if(!i)return a.el.scrollTop=n,a.el.scrollLeft=t,void a.resize();var o=a.el.style.overflowX,s=a.el.style.overflowY;clearTimeout(a.__scrollToCleanupTimeout),a.__scrollToCleanupTimeout=setTimeout(function(){a.el.style.overflowX=o,a.el.style.overflowY=s},500),a.el.style.overflowY="hidden",a.el.style.overflowX="hidden",r(n,t)},__waitForSize:function(){var e=this;clearTimeout(e.__sizerTimeout);var t=function(){e.resize(!0)};t(),e.__sizerTimeout=setTimeout(t,500)},__computeScrollMax:function(){var e=this;e.__maxScrollLeft=Math.max(e.__contentWidth-e.__clientWidth,0),e.__maxScrollTop=Math.max(e.__contentHeight-e.__clientHeight,0),e.__didWaitForSize||e.__maxScrollLeft||e.__maxScrollTop||(e.__didWaitForSize=!0,e.__waitForSize())},__initEventHandlers:function(){var t,n,i=this,r=i.__container;i.scrollChildIntoView=function(a){var o=r.getBoundingClientRect();i.__originalContainerHeight||(i.__originalContainerHeight=o.height),t=i.__originalContainerHeight;var s=i.isShrunkForKeyboard,l=r.parentNode.classList.contains("modal"),c=r.parentNode.classList.contains("popover"),d=l&&window.innerWidth>=680,u=n&&n!==a.detail.keyboardHeight;(!s||u)&&(!c&&(e.Platform.isIOS()||e.Platform.isFullScreen||d)&&e.requestAnimationFrame(function(){t=Math.max(0,Math.min(i.__originalContainerHeight,i.__originalContainerHeight-(a.detail.keyboardHeight-43))),r.style.height=t+"px",r.classList.add("keyboard-up"),i.resize()}),i.isShrunkForKeyboard=!0),n=a.detail.keyboardHeight,a.detail.isElementUnderKeyboard&&e.requestAnimationFrame(function(){var t=e.DomUtil.getOffsetTop(a.detail.target);setTimeout(function(){e.Platform.isIOS()&&e.tap.cloneFocusedInput(r,i),i.scrollTo(0,t-(o.top+100),!0),i.onScroll()},32)}),a.stopPropagation()},i.resetScrollView=function(){i.isShrunkForKeyboard&&(i.isShrunkForKeyboard=!1,r.style.height="",i.__originalContainerHeight=r.getBoundingClientRect().height,e.Platform.isIOS()&&e.requestAnimationFrame(function(){r.classList.remove("keyboard-up")})),i.resize()},i.handleTouchMove=function(e){return i.__frozenShut?(e.preventDefault(),e.stopPropagation(),!1):i.__frozen?(e.preventDefault(),!1):!0},r.addEventListener("scroll",i.onScroll),r.addEventListener("scrollChildIntoView",i.scrollChildIntoView),r.addEventListener(e.EVENTS.touchstart,i.handleTouchMove),r.addEventListener(e.EVENTS.touchmove,i.handleTouchMove),document.addEventListener("resetScrollView",i.resetScrollView)},__cleanup:function(){var n=this,i=n.__container;i.removeEventListener("resetScrollView",n.resetScrollView),i.removeEventListener("scroll",n.onScroll),i.removeEventListener("scrollChildIntoView",n.scrollChildIntoView),i.removeEventListener("resetScrollView",n.resetScrollView),i.removeEventListener(e.EVENTS.touchstart,n.handleTouchMove),i.removeEventListener(e.EVENTS.touchmove,n.handleTouchMove),e.tap.removeClonedInputs(i,n),delete n.__container,delete n.__content,delete n.__indicatorX,delete n.__indicatorY,delete n.options.el,n.resize=n.scrollTo=n.onScroll=n.resetScrollView=t,n.scrollChildIntoView=t,i=null}})}(ionic),function(e){"use strict";var t="item",n="item-content",i="item-sliding",r="item-options",a="item-placeholder",o="item-reordering",s="item-reorder",l=function(){};l.prototype={start:function(){},drag:function(){},end:function(){},isSameItem:function(){return!1}};var c=function(e){this.dragThresholdX=e.dragThresholdX||10,this.el=e.el,this.item=e.item,this.canSwipe=e.canSwipe};c.prototype=new l,c.prototype.start=function(a){var o,s,l,c;this.canSwipe()&&(o=a.target.classList.contains(n)?a.target:a.target.classList.contains(t)?a.target.querySelector("."+n):e.DomUtil.getParentWithClass(a.target,n),o&&(o.classList.remove(i),l=parseFloat(o.style[e.CSS.TRANSFORM].replace("translate3d(","").split(",")[0])||0,s=o.parentNode.querySelector("."+r),s&&(s.classList.remove("invisible"),c=s.offsetWidth,this._currentDrag={buttons:s,buttonsWidth:c,content:o,startOffsetX:l})))},c.prototype.isSameItem=function(e){return e._lastDrag&&this._currentDrag?this._currentDrag.content==e._lastDrag.content:!1},c.prototype.clean=function(t){function n(){i.buttons&&i.buttons.classList.add("invisible")}var i=this._lastDrag;i&&i.content&&(i.content.style[e.CSS.TRANSITION]="",i.content.style[e.CSS.TRANSFORM]="",t?(i.content.style[e.CSS.TRANSITION]="none",n(),e.requestAnimationFrame(function(){i.content.style[e.CSS.TRANSITION]=""})):e.requestAnimationFrame(function(){setTimeout(n,250)}))},c.prototype.drag=e.animationFrameThrottle(function(t){var n;if(this._currentDrag&&(!this._isDragging&&(Math.abs(t.gesture.deltaX)>this.dragThresholdX||Math.abs(this._currentDrag.startOffsetX)>0)&&(this._isDragging=!0),this._isDragging)){n=this._currentDrag.buttonsWidth;var i=Math.min(0,this._currentDrag.startOffsetX+t.gesture.deltaX);-n>i&&(i=Math.min(-n,-n+.4*(t.gesture.deltaX+n))),this._currentDrag.content.$$ionicOptionsOpen=0!==i,this._currentDrag.content.style[e.CSS.TRANSFORM]="translate3d("+i+"px, 0, 0)",this._currentDrag.content.style[e.CSS.TRANSITION]="none"}}),c.prototype.end=function(t,n){var i=this;if(!i._currentDrag)return void(n&&n());var r=-i._currentDrag.buttonsWidth;t.gesture.deltaX>-(i._currentDrag.buttonsWidth/2)&&("left"==t.gesture.direction&&Math.abs(t.gesture.velocityX)<.3?r=0:"right"==t.gesture.direction&&(r=0)),e.requestAnimationFrame(function(){if(0===r){i._currentDrag.content.style[e.CSS.TRANSFORM]="";var t=i._currentDrag.buttons;setTimeout(function(){t&&t.classList.add("invisible")},250)}else i._currentDrag.content.style[e.CSS.TRANSFORM]="translate3d("+r+"px,0,0)";i._currentDrag.content.style[e.CSS.TRANSITION]="",i._lastDrag||(i._lastDrag={}),e.extend(i._lastDrag,i._currentDrag),i._currentDrag&&(i._currentDrag.buttons=null,i._currentDrag.content=null),i._currentDrag=null,n&&n()})};var d=function(e){var t=this;if(t.dragThresholdY=e.dragThresholdY||0,t.onReorder=e.onReorder,t.listEl=e.listEl,t.el=t.item=e.el,t.scrollEl=e.scrollEl,t.scrollView=e.scrollView,t.listElTrueTop=0,t.listEl.offsetParent){var n=t.listEl;do t.listElTrueTop+=n.offsetTop,n=n.offsetParent;while(n)}};d.prototype=new l,d.prototype._moveElement=function(t){var n=t.gesture.center.pageY+this.scrollView.getValues().top-this._currentDrag.elementHeight/2-this.listElTrueTop;this.el.style[e.CSS.TRANSFORM]="translate3d(0, "+n+"px, 0)"},d.prototype.deregister=function(){this.listEl=this.el=this.scrollEl=this.scrollView=null},d.prototype.start=function(t){var n=e.DomUtil.getChildIndex(this.el,this.el.nodeName.toLowerCase()),i=this.el.scrollHeight,r=this.el.cloneNode(!0);r.classList.add(a),this.el.parentNode.insertBefore(r,this.el),this.el.classList.add(o),this._currentDrag={elementHeight:i,startIndex:n,placeholder:r,scrollHeight:scroll,list:r.parentNode},this._moveElement(t)},d.prototype.drag=e.animationFrameThrottle(function(t){var n=this;if(this._currentDrag){var i=0,r=t.gesture.center.pageY,a=this.listElTrueTop;if(this.scrollView){var o=this.scrollView.__container;i=this.scrollView.getValues().top;var s=o.offsetTop,l=s-r+this._currentDrag.elementHeight/2,c=r+this._currentDrag.elementHeight/2-s-o.offsetHeight;t.gesture.deltaY<0&&l>0&&i>0&&(this.scrollView.scrollBy(null,-l),e.requestAnimationFrame(function(){n.drag(t)})),t.gesture.deltaY>0&&c>0&&i<this.scrollView.getScrollMax().top&&(this.scrollView.scrollBy(null,c),e.requestAnimationFrame(function(){n.drag(t)}))}!this._isDragging&&Math.abs(t.gesture.deltaY)>this.dragThresholdY&&(this._isDragging=!0),this._isDragging&&(this._moveElement(t),this._currentDrag.currentY=i+r-a)}}),d.prototype._getReorderIndex=function(){for(var e,t=this,n=Array.prototype.slice.call(t._currentDrag.placeholder.parentNode.children).filter(function(e){return e.nodeName===t.el.nodeName&&e!==t.el}),i=t._currentDrag.currentY,r=0,a=n.length;a>r;r++)if(e=n[r],r===a-1){if(i>e.offsetTop)return r}else if(0===r){if(i<e.offsetTop+e.offsetHeight)return r}else if(i>e.offsetTop-e.offsetHeight/2&&i<e.offsetTop+e.offsetHeight)return r;return t._currentDrag.startIndex},d.prototype.end=function(t,n){if(!this._currentDrag)return void(n&&n());var i=this._currentDrag.placeholder,r=this._getReorderIndex();this.el.classList.remove(o),this.el.style[e.CSS.TRANSFORM]="",i.parentNode.insertBefore(this.el,i),i.parentNode.removeChild(i),this.onReorder&&this.onReorder(this.el,this._currentDrag.startIndex,r),this._currentDrag={placeholder:null,content:null},this._currentDrag=null,n&&n()},e.views.ListView=e.views.View.inherit({initialize:function(t){var n=this;t=e.extend({onReorder:function(){},virtualRemoveThreshold:-200,virtualAddThreshold:200,canSwipe:function(){return!0}},t),e.extend(n,t),!n.itemHeight&&n.listEl&&(n.itemHeight=n.listEl.children[0]&&parseInt(n.listEl.children[0].style.height,10)),n.onRefresh=t.onRefresh||function(){},n.onRefreshOpening=t.onRefreshOpening||function(){},n.onRefreshHolding=t.onRefreshHolding||function(){};var i={};e.DomUtil.getParentOrSelfWithClass(n.el,"overflow-scroll")&&(i.prevent_default_directions=["left","right"]),window.ionic.onGesture("release",function(e){n._handleEndDrag(e)},n.el,i),window.ionic.onGesture("drag",function(e){n._handleDrag(e)},n.el,i),n._initDrag()},deregister:function(){this.el=this.listEl=this.scrollEl=this.scrollView=null,this.isScrollFreeze&&self.scrollView.freeze(!1)},stopRefreshing:function(){var e=this.el.querySelector(".list-refresher");e.style.height="0"},didScroll:function(e){var t=this;if(t.isVirtual){var n=t.itemHeight,i=e.target.scrollHeight,r=t.el.parentNode.offsetHeight,a=Math.max(0,e.scrollTop+t.virtualRemoveThreshold),o=Math.min(i,Math.abs(e.scrollTop)+r+t.virtualAddThreshold),s=parseInt(Math.abs(a/n),10),l=parseInt(Math.abs(o/n),10);t._virtualItemsToRemove=Array.prototype.slice.call(t.listEl.children,0,s),t.renderViewport&&t.renderViewport(a,o,s,l)}},didStopScrolling:function(){if(this.isVirtual)for(var e=0;e<this._virtualItemsToRemove.length;e++)this.didHideItem&&this.didHideItem(e)},clearDragEffects:function(e){this._lastDragOp&&(this._lastDragOp.clean&&this._lastDragOp.clean(e),this._lastDragOp.deregister&&this._lastDragOp.deregister(),this._lastDragOp=null)},_initDrag:function(){this._lastDragOp&&this._lastDragOp.deregister&&this._lastDragOp.deregister(),this._lastDragOp=this._dragOp,this._dragOp=null},_getItem:function(e){for(;e;){if(e.classList&&e.classList.contains(t))return e;e=e.parentNode}return null},_startDrag:function(t){var n=this;n._isDragging=!1;var i,r=n._lastDragOp;n._didDragUpOrDown&&r instanceof c&&r.clean&&r.clean(),!e.DomUtil.getParentOrSelfWithClass(t.target,s)||"up"!=t.gesture.direction&&"down"!=t.gesture.direction?!n._didDragUpOrDown&&("left"==t.gesture.direction||"right"==t.gesture.direction)&&Math.abs(t.gesture.deltaX)>5&&(i=n._getItem(t.target),i&&i.querySelector(".item-options")&&(n._dragOp=new c({el:n.el,item:i,canSwipe:n.canSwipe}),n._dragOp.start(t),t.preventDefault(),n.isScrollFreeze=n.scrollView.freeze(!0))):(i=n._getItem(t.target),i&&(n._dragOp=new d({listEl:n.el,el:i,scrollEl:n.scrollEl,scrollView:n.scrollView,onReorder:function(e,t,i){n.onReorder&&n.onReorder(e,t,i)}}),n._dragOp.start(t),t.preventDefault())),r&&n._dragOp&&!n._dragOp.isSameItem(r)&&t.defaultPrevented&&r.clean&&r.clean()},_handleEndDrag:function(e){var t=this;t.scrollView&&(t.isScrollFreeze=t.scrollView.freeze(!1)),t._didDragUpOrDown=!1,t._dragOp&&t._dragOp.end(e,function(){t._initDrag()})},_handleDrag:function(e){var t=this;Math.abs(e.gesture.deltaY)>5&&(t._didDragUpOrDown=!0),t.isDragging||t._dragOp||t._startDrag(e),t._dragOp&&(e.gesture.srcEvent.preventDefault(),t._dragOp.drag(e))}})}(ionic),function(e){"use strict";e.views.Modal=e.views.View.inherit({initialize:function(t){t=e.extend({focusFirstInput:!1,unfocusOnHide:!0,focusFirstDelay:600,backdropClickToClose:!0,hardwareBackButtonClose:!0},t),e.extend(this,t),this.el=t.el},show:function(){var e=this;e.focusFirstInput&&window.setTimeout(function(){var t=e.el.querySelector("input, textarea");t&&t.focus&&t.focus()},e.focusFirstDelay)},hide:function(){if(this.unfocusOnHide){var e=this.el.querySelectorAll("input, textarea");window.setTimeout(function(){for(var t=0;t<e.length;t++)e[t].blur&&e[t].blur()})}}})}(ionic),function(e){"use strict";e.views.SideMenu=e.views.View.inherit({initialize:function(e){this.el=e.el,this.isEnabled="undefined"==typeof e.isEnabled?!0:e.isEnabled,this.setWidth(e.width)},getFullWidth:function(){return this.width},setWidth:function(e){this.width=e,this.el.style.width=e+"px"},setIsEnabled:function(e){this.isEnabled=e},bringUp:function(){"0"!==this.el.style.zIndex&&(this.el.style.zIndex="0")},pushDown:function(){"-1"!==this.el.style.zIndex&&(this.el.style.zIndex="-1")}}),e.views.SideMenuContent=e.views.View.inherit({initialize:function(t){e.extend(this,{animationClass:"menu-animated",onDrag:function(){},onEndDrag:function(){}},t),e.onGesture("drag",e.proxy(this._onDrag,this),this.el),e.onGesture("release",e.proxy(this._onEndDrag,this),this.el)},_onDrag:function(e){this.onDrag&&this.onDrag(e)},_onEndDrag:function(e){this.onEndDrag&&this.onEndDrag(e)},disableAnimation:function(){this.el.classList.remove(this.animationClass)},enableAnimation:function(){this.el.classList.add(this.animationClass)},getTranslateX:function(){return parseFloat(this.el.style[e.CSS.TRANSFORM].replace("translate3d(","").split(",")[0])},setTranslateX:e.animationFrameThrottle(function(t){this.el.style[e.CSS.TRANSFORM]="translate3d("+t+"px, 0, 0)"})})}(ionic),function(e){"use strict";e.views.Slider=e.views.View.inherit({initialize:function(e){function t(){if(b.offsetWidth){S=D.children,x=S.length,S.length<2&&(e.continuous=!1),T.transitions&&e.continuous&&S.length<3&&(D.appendChild(S[0].cloneNode(!0)),D.appendChild(D.children[1].cloneNode(!0)),S=D.children),y=new Array(S.length),E=b.offsetWidth||b.getBoundingClientRect().width,D.style.width=S.length*E+"px";for(var t=S.length;t--;){var n=S[t];n.style.width=E+"px",n.setAttribute("data-index",t),T.transitions&&(n.style.left=t*-E+"px",o(t,M>t?-E:t>M?E:0,0))}e.continuous&&T.transitions&&(o(r(M-1),-E,0),o(r(M+1),E,0)),T.transitions||(D.style.left=M*-E+"px"),b.style.visibility="visible",e.slidesChanged&&e.slidesChanged()}}function n(t){e.continuous?a(M-1,t):M&&a(M-1,t)}function i(t){e.continuous?a(M+1,t):M<S.length-1&&a(M+1,t)}function r(e){return(S.length+e%S.length)%S.length}function a(t,n){if(M!=t){if(!S)return void(M=t);if(T.transitions){var i=Math.abs(M-t)/(M-t);if(e.continuous){var a=i;i=-y[r(t)]/E,i!==a&&(t=-i*S.length+t)}for(var s=Math.abs(M-t)-1;s--;)o(r((t>M?t:M)-s-1),E*i,0);t=r(t),o(M,E*i,n||L),o(t,0,n||L),e.continuous&&o(r(t-i),-(E*i),0)}else t=r(t),l(M*-E,t*-E,n||L);M=t,w(e.callback&&e.callback(M,S[M]))}}function o(e,t,n){s(e,t,n),y[e]=t}function s(e,t,n){var i=S[e],r=i&&i.style;r&&(r.webkitTransitionDuration=r.MozTransitionDuration=r.msTransitionDuration=r.OTransitionDuration=r.transitionDuration=n+"ms",r.webkitTransform="translate("+t+"px,0)translateZ(0)",r.msTransform=r.MozTransform=r.OTransform="translateX("+t+"px)")}function l(t,n,i){if(!i)return void(D.style.left=n+"px");var r=+new Date,a=setInterval(function(){var o=+new Date-r;return o>i?(D.style.left=n+"px",I&&c(),e.transitionEnd&&e.transitionEnd.call(event,M,S[M]),void clearInterval(a)):void(D.style.left=(n-t)*(Math.floor(o/i*100)/100)+t+"px")},4)}function c(){C=setTimeout(i,I)}function d(){I=e.auto||0,clearTimeout(C)}var u,p,h,f=this;window.navigator.pointerEnabled?(u="pointerdown",p="pointermove",h="pointerup"):window.navigator.msPointerEnabled?(u="MSPointerDown",p="MSPointerMove",h="MSPointerUp"):(u="touchstart",p="touchmove",h="touchend");var m="mousedown",g="mousemove",v="mouseup",_=function(){},w=function(e){setTimeout(e||_,0)},T={addEventListener:!!window.addEventListener,transitions:function(e){var t=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var n in t)if(void 0!==e.style[t[n]])return!0;return!1}(document.createElement("swipe"))},b=e.el;if(b){var S,y,E,x,D=b.children[0];e=e||{};var M=parseInt(e.startSlide,10)||0,L=e.speed||300;e.continuous=void 0!==e.continuous?e.continuous:!0;var C,P,I=e.auto||0,k={},N={},z={handleEvent:function(n){switch(!n.touches&&n.pageX&&n.pageY&&(n.touches=[{pageX:n.pageX,pageY:n.pageY}]),n.type){case u:this.start(n);break;case m:this.start(n);break;case p:this.touchmove(n);break;case g:this.touchmove(n);break;case h:w(this.end(n));break;case v:w(this.end(n));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":w(this.transitionEnd(n));break;case"resize":w(t)}e.stopPropagation&&n.stopPropagation()},start:function(e){if(e.touches){var t=e.touches[0];k={x:t.pageX,y:t.pageY,time:+new Date},P=void 0,N={},D.addEventListener(p,this,!1),D.addEventListener(g,this,!1),D.addEventListener(h,this,!1),D.addEventListener(v,this,!1),document.addEventListener(h,this,!1),document.addEventListener(v,this,!1)}},touchmove:function(t){if(!(!t.touches||t.touches.length>1||t.scale&&1!==t.scale||f.slideIsDisabled)){e.disableScroll&&t.preventDefault();var n=t.touches[0];N={x:n.pageX-k.x,y:n.pageY-k.y},"undefined"==typeof P&&(P=!!(P||Math.abs(N.x)<Math.abs(N.y))),P||(t.preventDefault(),d(),e.continuous?(s(r(M-1),N.x+y[r(M-1)],0),s(M,N.x+y[M],0),s(r(M+1),N.x+y[r(M+1)],0)):(e.bouncing?N.x=N.x/(!M&&N.x>0||M==S.length-1&&N.x<0?Math.abs(N.x)/E+1:1):(E*M-N.x<0&&(N.x=Math.min(N.x,E*M)),Math.abs(N.x)>E*(S.length-M-1)&&(N.x=Math.max(-E*(S.length-M-1),N.x))),s(M-1,N.x+y[M-1],0),s(M,N.x+y[M],0),s(M+1,N.x+y[M+1],0)),e.onDrag&&e.onDrag())}},end:function(){var t=+new Date-k.time,n=Number(t)<250&&Math.abs(N.x)>20||Math.abs(N.x)>E/2,i=!M&&N.x>0||M==S.length-1&&N.x<0;e.continuous&&(i=!1);var a=N.x<0;P||(n&&!i?(a?(e.continuous?(o(r(M-1),-E,0),o(r(M+2),E,0)):o(M-1,-E,0),o(M,y[M]-E,L),o(r(M+1),y[r(M+1)]-E,L),M=r(M+1)):(e.continuous?(o(r(M+1),E,0),o(r(M-2),-E,0)):o(M+1,E,0),o(M,y[M]+E,L),o(r(M-1),y[r(M-1)]+E,L),M=r(M-1)),e.callback&&e.callback(M,S[M])):e.continuous?(o(r(M-1),-E,L),o(M,0,L),o(r(M+1),E,L)):(o(M-1,-E,L),o(M,0,L),o(M+1,E,L))),D.removeEventListener(p,z,!1),D.removeEventListener(g,z,!1),D.removeEventListener(h,z,!1),D.removeEventListener(v,z,!1),document.removeEventListener(h,z,!1),document.removeEventListener(v,z,!1),e.onDragEnd&&e.onDragEnd()},transitionEnd:function(t){parseInt(t.target.getAttribute("data-index"),10)==M&&(I&&c(),e.transitionEnd&&e.transitionEnd.call(t,M,S[M]))}};this.update=function(){setTimeout(t)},this.setup=function(){t()},this.loop=function(t){return arguments.length&&(e.continuous=!!t),e.continuous},this.enableSlide=function(e){return arguments.length&&(this.slideIsDisabled=!e),!this.slideIsDisabled},this.slide=this.select=function(e,t){d(),a(e,t)},this.prev=this.previous=function(){d(),n()},this.next=function(){d(),i()},this.stop=function(){d()},this.start=function(){c()},this.autoPlay=function(e){!I||0>I?d():(I=e,c())},this.currentIndex=this.selected=function(){return M},this.slidesCount=this.count=function(){return x},this.kill=function(){d(),D.style.width="",D.style.left="",S&&(S=[]),T.addEventListener?(D.removeEventListener(u,z,!1),D.removeEventListener(m,z,!1),D.removeEventListener("webkitTransitionEnd",z,!1),D.removeEventListener("msTransitionEnd",z,!1),D.removeEventListener("oTransitionEnd",z,!1),D.removeEventListener("otransitionend",z,!1),D.removeEventListener("transitionend",z,!1),window.removeEventListener("resize",z,!1)):window.onresize=null},this.load=function(){t(),I&&c(),T.addEventListener?(D.addEventListener(u,z,!1),D.addEventListener(m,z,!1),T.transitions&&(D.addEventListener("webkitTransitionEnd",z,!1),D.addEventListener("msTransitionEnd",z,!1),D.addEventListener("oTransitionEnd",z,!1),D.addEventListener("otransitionend",z,!1),D.addEventListener("transitionend",z,!1)),window.addEventListener("resize",z,!1)):window.onresize=function(){t()}}}}})}(ionic),function(){"use strict";function e(e){e.fn.swiper=function(t){var i;return e(this).each(function(){var e=new n(this,t);i||(i=e)}),i}}var t,n=function(e,r,a,o){function s(){return"horizontal"===y.params.direction}function l(e){return Math.floor(e)}function c(){y.autoplayTimeoutId=setTimeout(function(){y.params.loop?(y.fixLoop(),y._slideNext()):y.isEnd?r.autoplayStopOnLast?y.stopAutoplay():y._slideTo(0):y._slideNext()},y.params.autoplay)}function d(e,n){var i=t(e.target);if(!i.is(n))if("string"==typeof n)i=i.parents(n);else if(n.nodeType){var r;return i.parents().each(function(e,t){t===n&&(r=n)}),r?n:void 0}return 0===i.length?void 0:i[0]}function u(e,t){t=t||{};var n=window.MutationObserver||window.WebkitMutationObserver,i=new n(function(e){e.forEach(function(e){y.onResize(!0),y.emit("onObserverUpdate",y,e)})});i.observe(e,{attributes:"undefined"==typeof t.attributes?!0:t.attributes,childList:"undefined"==typeof t.childList?!0:t.childList,characterData:"undefined"==typeof t.characterData?!0:t.characterData}),y.observers.push(i)}function p(e){e.originalEvent&&(e=e.originalEvent);var t=e.keyCode||e.charCode;if(!y.params.allowSwipeToNext&&(s()&&39===t||!s()&&40===t))return!1;if(!y.params.allowSwipeToPrev&&(s()&&37===t||!s()&&38===t))return!1;if(!(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey||document.activeElement&&document.activeElement.nodeName&&("input"===document.activeElement.nodeName.toLowerCase()||"textarea"===document.activeElement.nodeName.toLowerCase()))){if(37===t||39===t||38===t||40===t){var n=!1;if(y.container.parents(".swiper-slide").length>0&&0===y.container.parents(".swiper-slide-active").length)return;var i={left:window.pageXOffset,top:window.pageYOffset},r=window.innerWidth,a=window.innerHeight,o=y.container.offset();y.rtl&&(o.left=o.left-y.container[0].scrollLeft);for(var l=[[o.left,o.top],[o.left+y.width,o.top],[o.left,o.top+y.height],[o.left+y.width,o.top+y.height]],c=0;c<l.length;c++){var d=l[c];d[0]>=i.left&&d[0]<=i.left+r&&d[1]>=i.top&&d[1]<=i.top+a&&(n=!0)}if(!n)return}s()?((37===t||39===t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1),(39===t&&!y.rtl||37===t&&y.rtl)&&y.slideNext(),(37===t&&!y.rtl||39===t&&y.rtl)&&y.slidePrev()):((38===t||40===t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1),40===t&&y.slideNext(),38===t&&y.slidePrev())}}function h(e){e.originalEvent&&(e=e.originalEvent);var t=y.mousewheel.event,n=0,i=y.rtl?-1:1;if(e.detail)n=-e.detail;else if("mousewheel"===t)if(y.params.mousewheelForceToAxis)if(s()){if(!(Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)))return;n=e.wheelDeltaX*i}else{if(!(Math.abs(e.wheelDeltaY)>Math.abs(e.wheelDeltaX)))return;n=e.wheelDeltaY}else n=Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)?-e.wheelDeltaX*i:-e.wheelDeltaY;else if("DOMMouseScroll"===t)n=-e.detail;else if("wheel"===t)if(y.params.mousewheelForceToAxis)if(s()){if(!(Math.abs(e.deltaX)>Math.abs(e.deltaY)))return;n=-e.deltaX*i}else{if(!(Math.abs(e.deltaY)>Math.abs(e.deltaX)))return;n=-e.deltaY}else n=Math.abs(e.deltaX)>Math.abs(e.deltaY)?-e.deltaX*i:-e.deltaY;if(0!==n){if(y.params.mousewheelInvert&&(n=-n),y.params.freeMode){var r=y.getWrapperTranslate()+n*y.params.mousewheelSensitivity,a=y.isBeginning,o=y.isEnd;if(r>=y.minTranslate()&&(r=y.minTranslate()),r<=y.maxTranslate()&&(r=y.maxTranslate()),y.setWrapperTransition(0),y.setWrapperTranslate(r),y.updateProgress(),y.updateActiveIndex(),(!a&&y.isBeginning||!o&&y.isEnd)&&y.updateClasses(),y.params.freeModeSticky&&(clearTimeout(y.mousewheel.timeout),y.mousewheel.timeout=setTimeout(function(){y.slideReset()},300)),0===r||r===y.maxTranslate())return}else{if((new window.Date).getTime()-y.mousewheel.lastScrollTime>60)if(0>n)if(y.isEnd&&!y.params.loop||y.animating){if(y.params.mousewheelReleaseOnEdges)return!0}else y.slideNext();else if(y.isBeginning&&!y.params.loop||y.animating){if(y.params.mousewheelReleaseOnEdges)return!0}else y.slidePrev();y.mousewheel.lastScrollTime=(new window.Date).getTime()}return y.params.autoplay&&y.stopAutoplay(),e.preventDefault?e.preventDefault():e.returnValue=!1,!1}}function f(e,n){e=t(e);var i,r,a,o=y.rtl?-1:1;i=e.attr("data-swiper-parallax")||"0",
r=e.attr("data-swiper-parallax-x"),a=e.attr("data-swiper-parallax-y"),r||a?(r=r||"0",a=a||"0"):s()?(r=i,a="0"):(a=i,r="0"),r=r.indexOf("%")>=0?parseInt(r,10)*n*o+"%":r*n*o+"px",a=a.indexOf("%")>=0?parseInt(a,10)*n+"%":a*n+"px",e.transform("translate3d("+r+", "+a+",0px)")}function m(e){return 0!==e.indexOf("on")&&(e=e[0]!==e[0].toUpperCase()?"on"+e[0].toUpperCase()+e.substring(1):"on"+e),e}if(!(this instanceof n))return new n(e,r);var g={direction:"horizontal",touchEventsTarget:"container",initialSlide:0,speed:300,autoplay:!1,autoplayDisableOnInteraction:!0,iOSEdgeSwipeDetection:!1,iOSEdgeSwipeThreshold:20,freeMode:!1,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeSticky:!1,freeModeMinimumVelocity:.02,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",coverflow:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},cube:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94},fade:{crossFade:!1},parallax:!1,scrollbar:null,scrollbarHide:!0,scrollbarDraggable:!1,scrollbarSnapOnRelease:!1,keyboardControl:!1,mousewheelControl:!1,mousewheelReleaseOnEdges:!1,mousewheelInvert:!1,mousewheelForceToAxis:!1,mousewheelSensitivity:1,hashnav:!1,breakpoints:void 0,spaceBetween:0,slidesPerView:1,slidesPerColumn:1,slidesPerColumnFill:"column",slidesPerGroup:1,centeredSlides:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,onlyExternal:!1,threshold:0,touchMoveStopPropagation:!0,pagination:null,paginationElement:"span",paginationClickable:!1,paginationHide:!1,paginationBulletRender:null,resistance:!0,resistanceRatio:.85,nextButton:null,prevButton:null,watchSlidesProgress:!1,watchSlidesVisibility:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,lazyLoading:!1,lazyLoadingInPrevNext:!1,lazyLoadingOnTransitionStart:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,control:void 0,controlInverse:!1,controlBy:"slide",allowSwipeToPrev:!0,allowSwipeToNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",buttonDisabledClass:"swiper-button-disabled",paginationHiddenClass:"swiper-pagination-hidden",observer:!1,observeParents:!1,a11y:!1,prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",runCallbacksOnInit:!0},v=r&&r.virtualTranslate;r=r||{};var _={};for(var w in r)if("object"!=typeof r[w]||(r[w].nodeType||r[w]===window||r[w]===document||"undefined"!=typeof i&&r[w]instanceof i||"undefined"!=typeof jQuery&&r[w]instanceof jQuery))_[w]=r[w];else{_[w]={};for(var T in r[w])_[w][T]=r[w][T]}for(var b in g)if("undefined"==typeof r[b])r[b]=g[b];else if("object"==typeof r[b])for(var S in g[b])"undefined"==typeof r[b][S]&&(r[b][S]=g[b][S]);var y=this;if(y.params=r,y.originalParams=_,y.classNames=[],"undefined"!=typeof t&&"undefined"!=typeof i&&(t=i),("undefined"!=typeof t||(t="undefined"==typeof i?window.Dom7||window.Zepto||window.jQuery:i))&&(y.$=t,y.currentBreakpoint=void 0,y.getActiveBreakpoint=function(){if(!y.params.breakpoints)return!1;var e,t=!1,n=[];for(e in y.params.breakpoints)y.params.breakpoints.hasOwnProperty(e)&&n.push(e);n.sort(function(e,t){return parseInt(e,10)>parseInt(t,10)});for(var i=0;i<n.length;i++)e=n[i],e>=window.innerWidth&&!t&&(t=e);return t||"max"},y.setBreakpoint=function(){var e=y.getActiveBreakpoint();if(e&&y.currentBreakpoint!==e){var t=e in y.params.breakpoints?y.params.breakpoints[e]:y.originalParams;for(var n in t)y.params[n]=t[n];y.currentBreakpoint=e}},y.params.breakpoints&&y.setBreakpoint(),y.container=t(e),0!==y.container.length)){if(y.container.length>1)return void y.container.each(function(){new n(this,r)});y.container[0].swiper=y,y.container.data("swiper",y),y.classNames.push("swiper-container-"+y.params.direction),y.params.freeMode&&y.classNames.push("swiper-container-free-mode"),y.support.flexbox||(y.classNames.push("swiper-container-no-flexbox"),y.params.slidesPerColumn=1),y.params.autoHeight&&y.classNames.push("swiper-container-autoheight"),(y.params.parallax||y.params.watchSlidesVisibility)&&(y.params.watchSlidesProgress=!0),["cube","coverflow"].indexOf(y.params.effect)>=0&&(y.support.transforms3d?(y.params.watchSlidesProgress=!0,y.classNames.push("swiper-container-3d")):y.params.effect="slide"),"slide"!==y.params.effect&&y.classNames.push("swiper-container-"+y.params.effect),"cube"===y.params.effect&&(y.params.resistanceRatio=0,y.params.slidesPerView=1,y.params.slidesPerColumn=1,y.params.slidesPerGroup=1,y.params.centeredSlides=!1,y.params.spaceBetween=0,y.params.virtualTranslate=!0,y.params.setWrapperSize=!1),"fade"===y.params.effect&&(y.params.slidesPerView=1,y.params.slidesPerColumn=1,y.params.slidesPerGroup=1,y.params.watchSlidesProgress=!0,y.params.spaceBetween=0,"undefined"==typeof v&&(y.params.virtualTranslate=!0)),y.params.grabCursor&&y.support.touch&&(y.params.grabCursor=!1),y.wrapper=y.container.children("."+y.params.wrapperClass),y.params.pagination&&(y.paginationContainer=t(y.params.pagination),y.params.paginationClickable&&y.paginationContainer.addClass("swiper-pagination-clickable")),y.rtl=s()&&("rtl"===y.container[0].dir.toLowerCase()||"rtl"===y.container.css("direction")),y.rtl&&y.classNames.push("swiper-container-rtl"),y.rtl&&(y.wrongRTL="-webkit-box"===y.wrapper.css("display")),y.params.slidesPerColumn>1&&y.classNames.push("swiper-container-multirow"),y.device.android&&y.classNames.push("swiper-container-android"),y.container.addClass(y.classNames.join(" ")),y.translate=0,y.progress=0,y.velocity=0,y.lockSwipeToNext=function(){y.params.allowSwipeToNext=!1},y.lockSwipeToPrev=function(){y.params.allowSwipeToPrev=!1},y.lockSwipes=function(){y.params.allowSwipeToNext=y.params.allowSwipeToPrev=!1},y.unlockSwipeToNext=function(){y.params.allowSwipeToNext=!0},y.unlockSwipeToPrev=function(){y.params.allowSwipeToPrev=!0},y.unlockSwipes=function(){y.params.allowSwipeToNext=y.params.allowSwipeToPrev=!0},y.params.grabCursor&&(y.container[0].style.cursor="move",y.container[0].style.cursor="-webkit-grab",y.container[0].style.cursor="-moz-grab",y.container[0].style.cursor="grab"),y.imagesToLoad=[],y.imagesLoaded=0,y.loadImage=function(e,t,n,i,r){function a(){r&&r()}var o;e.complete&&i?a():t?(o=new window.Image,o.onload=a,o.onerror=a,n&&(o.srcset=n),t&&(o.src=t)):a()},y.preloadImages=function(){function e(){"undefined"!=typeof y&&null!==y&&(void 0!==y.imagesLoaded&&y.imagesLoaded++,y.imagesLoaded===y.imagesToLoad.length&&(y.params.updateOnImagesReady&&y.update(),y.emit("onImagesReady",y)))}y.imagesToLoad=y.container.find("img");for(var t=0;t<y.imagesToLoad.length;t++)y.loadImage(y.imagesToLoad[t],y.imagesToLoad[t].currentSrc||y.imagesToLoad[t].getAttribute("src"),y.imagesToLoad[t].srcset||y.imagesToLoad[t].getAttribute("srcset"),!0,e)},y.autoplayTimeoutId=void 0,y.autoplaying=!1,y.autoplayPaused=!1,y.startAutoplay=function(){return"undefined"!=typeof y.autoplayTimeoutId?!1:y.params.autoplay?y.autoplaying?!1:(y.autoplaying=!0,y.emit("onAutoplayStart",y),void c()):!1},y.stopAutoplay=function(e){y.autoplayTimeoutId&&(y.autoplayTimeoutId&&clearTimeout(y.autoplayTimeoutId),y.autoplaying=!1,y.autoplayTimeoutId=void 0,y.emit("onAutoplayStop",y))},y.pauseAutoplay=function(e){y.autoplayPaused||(y.autoplayTimeoutId&&clearTimeout(y.autoplayTimeoutId),y.autoplayPaused=!0,0===e?(y.autoplayPaused=!1,c()):y.wrapper.transitionEnd(function(){y&&(y.autoplayPaused=!1,y.autoplaying?c():y.stopAutoplay())}))},y.minTranslate=function(){return-y.snapGrid[0]},y.maxTranslate=function(){return-y.snapGrid[y.snapGrid.length-1]},y.updateAutoHeight=function(){var e=y.slides.eq(y.activeIndex)[0].offsetHeight;e&&y.wrapper.css("height",y.slides.eq(y.activeIndex)[0].offsetHeight+"px")},y.updateContainerSize=function(){var e,t;e="undefined"!=typeof y.params.width?y.params.width:y.container[0].clientWidth,t="undefined"!=typeof y.params.height?y.params.height:y.container[0].clientHeight,0===e&&s()||0===t&&!s()||(e=e-parseInt(y.container.css("padding-left"),10)-parseInt(y.container.css("padding-right"),10),t=t-parseInt(y.container.css("padding-top"),10)-parseInt(y.container.css("padding-bottom"),10),y.width=e,y.height=t,y.size=s()?y.width:y.height)},y.updateSlidesSize=function(){y.slides=y.wrapper.children("."+y.params.slideClass),y.snapGrid=[],y.slidesGrid=[],y.slidesSizesGrid=[];var e,t=y.params.spaceBetween,n=-y.params.slidesOffsetBefore,i=0,r=0;"string"==typeof t&&t.indexOf("%")>=0&&(t=parseFloat(t.replace("%",""))/100*y.size),y.virtualSize=-t,y.rtl?y.slides.css({marginLeft:"",marginTop:""}):y.slides.css({marginRight:"",marginBottom:""});var a;y.params.slidesPerColumn>1&&(a=Math.floor(y.slides.length/y.params.slidesPerColumn)===y.slides.length/y.params.slidesPerColumn?y.slides.length:Math.ceil(y.slides.length/y.params.slidesPerColumn)*y.params.slidesPerColumn,"auto"!==y.params.slidesPerView&&"row"===y.params.slidesPerColumnFill&&(a=Math.max(a,y.params.slidesPerView*y.params.slidesPerColumn)));var o,c=y.params.slidesPerColumn,d=a/c,u=d-(y.params.slidesPerColumn*d-y.slides.length);for(e=0;e<y.slides.length;e++){o=0;var p=y.slides.eq(e);if(y.params.slidesPerColumn>1){var h,f,m;"column"===y.params.slidesPerColumnFill?(f=Math.floor(e/c),m=e-f*c,(f>u||f===u&&m===c-1)&&++m>=c&&(m=0,f++),h=f+m*a/c,p.css({"-webkit-box-ordinal-group":h,"-moz-box-ordinal-group":h,"-ms-flex-order":h,"-webkit-order":h,order:h})):(m=Math.floor(e/d),f=e-m*d),p.css({"margin-top":0!==m&&y.params.spaceBetween&&y.params.spaceBetween+"px"}).attr("data-swiper-column",f).attr("data-swiper-row",m)}"none"!==p.css("display")&&("auto"===y.params.slidesPerView?(o=s()?p.outerWidth(!0):p.outerHeight(!0),y.params.roundLengths&&(o=l(o))):(o=(y.size-(y.params.slidesPerView-1)*t)/y.params.slidesPerView,y.params.roundLengths&&(o=l(o)),s()?y.slides[e].style.width=o+"px":y.slides[e].style.height=o+"px"),y.slides[e].swiperSlideSize=o,y.slidesSizesGrid.push(o),y.params.centeredSlides?(n=n+o/2+i/2+t,0===e&&(n=n-y.size/2-t),Math.abs(n)<.001&&(n=0),r%y.params.slidesPerGroup===0&&y.snapGrid.push(n),y.slidesGrid.push(n)):(r%y.params.slidesPerGroup===0&&y.snapGrid.push(n),y.slidesGrid.push(n),n=n+o+t),y.virtualSize+=o+t,i=o,r++)}y.virtualSize=Math.max(y.virtualSize,y.size)+y.params.slidesOffsetAfter;var g;if(y.rtl&&y.wrongRTL&&("slide"===y.params.effect||"coverflow"===y.params.effect)&&y.wrapper.css({width:y.virtualSize+y.params.spaceBetween+"px"}),(!y.support.flexbox||y.params.setWrapperSize)&&(s()?y.wrapper.css({width:y.virtualSize+y.params.spaceBetween+"px"}):y.wrapper.css({height:y.virtualSize+y.params.spaceBetween+"px"})),y.params.slidesPerColumn>1&&(y.virtualSize=(o+y.params.spaceBetween)*a,y.virtualSize=Math.ceil(y.virtualSize/y.params.slidesPerColumn)-y.params.spaceBetween,y.wrapper.css({width:y.virtualSize+y.params.spaceBetween+"px"}),y.params.centeredSlides)){for(g=[],e=0;e<y.snapGrid.length;e++)y.snapGrid[e]<y.virtualSize+y.snapGrid[0]&&g.push(y.snapGrid[e]);y.snapGrid=g}if(!y.params.centeredSlides){for(g=[],e=0;e<y.snapGrid.length;e++)y.snapGrid[e]<=y.virtualSize-y.size&&g.push(y.snapGrid[e]);y.snapGrid=g,Math.floor(y.virtualSize-y.size)>Math.floor(y.snapGrid[y.snapGrid.length-1])&&y.snapGrid.push(y.virtualSize-y.size)}0===y.snapGrid.length&&(y.snapGrid=[0]),0!==y.params.spaceBetween&&(s()?y.rtl?y.slides.css({marginLeft:t+"px"}):y.slides.css({marginRight:t+"px"}):y.slides.css({marginBottom:t+"px"})),y.params.watchSlidesProgress&&y.updateSlidesOffset()},y.updateSlidesOffset=function(){for(var e=0;e<y.slides.length;e++)y.slides[e].swiperSlideOffset=s()?y.slides[e].offsetLeft:y.slides[e].offsetTop},y.updateSlidesProgress=function(e){if("undefined"==typeof e&&(e=y.translate||0),0!==y.slides.length){"undefined"==typeof y.slides[0].swiperSlideOffset&&y.updateSlidesOffset();var t=-e;y.rtl&&(t=e),y.slides.removeClass(y.params.slideVisibleClass);for(var n=0;n<y.slides.length;n++){var i=y.slides[n],r=(t-i.swiperSlideOffset)/(i.swiperSlideSize+y.params.spaceBetween);if(y.params.watchSlidesVisibility){var a=-(t-i.swiperSlideOffset),o=a+y.slidesSizesGrid[n],s=a>=0&&a<y.size||o>0&&o<=y.size||0>=a&&o>=y.size;s&&y.slides.eq(n).addClass(y.params.slideVisibleClass)}i.progress=y.rtl?-r:r}}},y.updateProgress=function(e){"undefined"==typeof e&&(e=y.translate||0);var t=y.maxTranslate()-y.minTranslate(),n=y.isBeginning,i=y.isEnd;0===t?(y.progress=0,y.isBeginning=y.isEnd=!0):(y.progress=(e-y.minTranslate())/t,y.isBeginning=y.progress<=0,y.isEnd=y.progress>=1),y.isBeginning&&!n&&y.emit("onReachBeginning",y),y.isEnd&&!i&&y.emit("onReachEnd",y),y.params.watchSlidesProgress&&y.updateSlidesProgress(e),y.emit("onProgress",y,y.progress)},y.updateActiveIndex=function(){var e,t,n,i=y.rtl?y.translate:-y.translate;for(t=0;t<y.slidesGrid.length;t++)"undefined"!=typeof y.slidesGrid[t+1]?i>=y.slidesGrid[t]&&i<y.slidesGrid[t+1]-(y.slidesGrid[t+1]-y.slidesGrid[t])/2?e=t:i>=y.slidesGrid[t]&&i<y.slidesGrid[t+1]&&(e=t+1):i>=y.slidesGrid[t]&&(e=t);(0>e||"undefined"==typeof e)&&(e=0),n=Math.floor(e/y.params.slidesPerGroup),n>=y.snapGrid.length&&(n=y.snapGrid.length-1),e!==y.activeIndex&&(y.snapIndex=n,y.previousIndex=y.activeIndex,y.activeIndex=e,y.updateClasses())},y.updateClasses=function(){y.slides.removeClass(y.params.slideActiveClass+" "+y.params.slideNextClass+" "+y.params.slidePrevClass);var e=y.slides.eq(y.activeIndex);if(e.addClass(y.params.slideActiveClass),e.next("."+y.params.slideClass).addClass(y.params.slideNextClass),e.prev("."+y.params.slideClass).addClass(y.params.slidePrevClass),y.bullets&&y.bullets.length>0){y.bullets.removeClass(y.params.bulletActiveClass);var n;y.params.loop?(n=Math.ceil(y.activeIndex-y.loopedSlides)/y.params.slidesPerGroup,n>y.slides.length-1-2*y.loopedSlides&&(n-=y.slides.length-2*y.loopedSlides),n>y.bullets.length-1&&(n-=y.bullets.length)):n="undefined"!=typeof y.snapIndex?y.snapIndex:y.activeIndex||0,y.paginationContainer.length>1?y.bullets.each(function(){t(this).index()===n&&t(this).addClass(y.params.bulletActiveClass)}):y.bullets.eq(n).addClass(y.params.bulletActiveClass)}y.params.loop||(y.params.prevButton&&(y.isBeginning?(t(y.params.prevButton).addClass(y.params.buttonDisabledClass),y.params.a11y&&y.a11y&&y.a11y.disable(t(y.params.prevButton))):(t(y.params.prevButton).removeClass(y.params.buttonDisabledClass),y.params.a11y&&y.a11y&&y.a11y.enable(t(y.params.prevButton)))),y.params.nextButton&&(y.isEnd?(t(y.params.nextButton).addClass(y.params.buttonDisabledClass),y.params.a11y&&y.a11y&&y.a11y.disable(t(y.params.nextButton))):(t(y.params.nextButton).removeClass(y.params.buttonDisabledClass),y.params.a11y&&y.a11y&&y.a11y.enable(t(y.params.nextButton)))))},y.updatePagination=function(){if(y.params.pagination&&y.paginationContainer&&y.paginationContainer.length>0){for(var e="",t=y.params.loop?Math.ceil((y.slides.length-2*y.loopedSlides)/y.params.slidesPerGroup):y.snapGrid.length,n=0;t>n;n++)e+=y.params.paginationBulletRender?y.params.paginationBulletRender(n,y.params.bulletClass):"<"+y.params.paginationElement+' class="'+y.params.bulletClass+'"></'+y.params.paginationElement+">";y.paginationContainer.html(e),y.bullets=y.paginationContainer.find("."+y.params.bulletClass),y.params.paginationClickable&&y.params.a11y&&y.a11y&&y.a11y.initPagination()}},y.update=function(e){function t(){i=Math.min(Math.max(y.translate,y.maxTranslate()),y.minTranslate()),y.setWrapperTranslate(i),y.updateActiveIndex(),y.updateClasses()}if(y.updateContainerSize(),y.updateSlidesSize(),y.updateProgress(),y.updatePagination(),y.updateClasses(),y.params.scrollbar&&y.scrollbar&&y.scrollbar.set(),e){var n,i;y.controller&&y.controller.spline&&(y.controller.spline=void 0),y.params.freeMode?(t(),y.params.autoHeight&&y.updateAutoHeight()):(n=("auto"===y.params.slidesPerView||y.params.slidesPerView>1)&&y.isEnd&&!y.params.centeredSlides?y.slideTo(y.slides.length-1,0,!1,!0):y.slideTo(y.activeIndex,0,!1,!0),n||t())}else y.params.autoHeight&&y.updateAutoHeight()},y.onResize=function(e){y.params.breakpoints&&y.setBreakpoint();var t=y.params.allowSwipeToPrev,n=y.params.allowSwipeToNext;if(y.params.allowSwipeToPrev=y.params.allowSwipeToNext=!0,y.updateContainerSize(),y.updateSlidesSize(),("auto"===y.params.slidesPerView||y.params.freeMode||e)&&y.updatePagination(),y.params.scrollbar&&y.scrollbar&&y.scrollbar.set(),y.controller&&y.controller.spline&&(y.controller.spline=void 0),y.params.freeMode){var i=Math.min(Math.max(y.translate,y.maxTranslate()),y.minTranslate());y.setWrapperTranslate(i),y.updateActiveIndex(),y.updateClasses(),y.params.autoHeight&&y.updateAutoHeight()}else y.updateClasses(),("auto"===y.params.slidesPerView||y.params.slidesPerView>1)&&y.isEnd&&!y.params.centeredSlides?y.slideTo(y.slides.length-1,0,!1,!0):y.slideTo(y.activeIndex,0,!1,!0);y.params.allowSwipeToPrev=t,y.params.allowSwipeToNext=n};var E=["mousedown","mousemove","mouseup"];window.navigator.pointerEnabled?E=["pointerdown","pointermove","pointerup"]:window.navigator.msPointerEnabled&&(E=["MSPointerDown","MSPointerMove","MSPointerUp"]),y.touchEvents={start:y.support.touch||!y.params.simulateTouch?"touchstart":E[0],move:y.support.touch||!y.params.simulateTouch?"touchmove":E[1],end:y.support.touch||!y.params.simulateTouch?"touchend":E[2]},(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&("container"===y.params.touchEventsTarget?y.container:y.wrapper).addClass("swiper-wp8-"+y.params.direction),y.initEvents=function(e){var n=e?"off":"on",i=e?"removeEventListener":"addEventListener",a="container"===y.params.touchEventsTarget?y.container[0]:y.wrapper[0],o=y.support.touch?a:document,s=y.params.nested?!0:!1;y.browser.ie?(a[i](y.touchEvents.start,y.onTouchStart,!1),o[i](y.touchEvents.move,y.onTouchMove,s),o[i](y.touchEvents.end,y.onTouchEnd,!1)):(y.support.touch&&(a[i](y.touchEvents.start,y.onTouchStart,!1),a[i](y.touchEvents.move,y.onTouchMove,s),a[i](y.touchEvents.end,y.onTouchEnd,!1)),!r.simulateTouch||y.device.ios||y.device.android||(a[i]("mousedown",y.onTouchStart,!1),document[i]("mousemove",y.onTouchMove,s),document[i]("mouseup",y.onTouchEnd,!1))),window[i]("resize",y.onResize),y.params.nextButton&&(t(y.params.nextButton)[n]("click",y.onClickNext),y.params.a11y&&y.a11y&&t(y.params.nextButton)[n]("keydown",y.a11y.onEnterKey)),y.params.prevButton&&(t(y.params.prevButton)[n]("click",y.onClickPrev),y.params.a11y&&y.a11y&&t(y.params.prevButton)[n]("keydown",y.a11y.onEnterKey)),y.params.pagination&&y.params.paginationClickable&&(t(y.paginationContainer)[n]("click","."+y.params.bulletClass,y.onClickIndex),y.params.a11y&&y.a11y&&t(y.paginationContainer)[n]("keydown","."+y.params.bulletClass,y.a11y.onEnterKey)),(y.params.preventClicks||y.params.preventClicksPropagation)&&a[i]("click",y.preventClicks,!0)},y.attachEvents=function(e){y.initEvents()},y.detachEvents=function(){y.initEvents(!0)},y.allowClick=!0,y.preventClicks=function(e){y.allowClick||(y.params.preventClicks&&e.preventDefault(),y.params.preventClicksPropagation&&y.animating&&(e.stopPropagation(),e.stopImmediatePropagation()))},y.onClickNext=function(e){e.preventDefault(),(!y.isEnd||y.params.loop)&&y.slideNext()},y.onClickPrev=function(e){e.preventDefault(),(!y.isBeginning||y.params.loop)&&y.slidePrev()},y.onClickIndex=function(e){e.preventDefault();var n=t(this).index()*y.params.slidesPerGroup;y.params.loop&&(n+=y.loopedSlides),y.slideTo(n)},y.updateClickedSlide=function(e){var n=d(e,"."+y.params.slideClass),i=!1;if(n)for(var r=0;r<y.slides.length;r++)y.slides[r]===n&&(i=!0);if(!n||!i)return y.clickedSlide=void 0,void(y.clickedIndex=void 0);if(y.clickedSlide=n,y.clickedIndex=t(n).index(),y.params.slideToClickedSlide&&void 0!==y.clickedIndex&&y.clickedIndex!==y.activeIndex){var a,o=y.clickedIndex;if(y.params.loop){if(y.animating)return;a=t(y.clickedSlide).attr("data-swiper-slide-index"),y.params.centeredSlides?o<y.loopedSlides-y.params.slidesPerView/2||o>y.slides.length-y.loopedSlides+y.params.slidesPerView/2?(y.fixLoop(),o=y.wrapper.children("."+y.params.slideClass+'[data-swiper-slide-index="'+a+'"]:not(.swiper-slide-duplicate)').eq(0).index(),setTimeout(function(){y.slideTo(o)},0)):y.slideTo(o):o>y.slides.length-y.params.slidesPerView?(y.fixLoop(),o=y.wrapper.children("."+y.params.slideClass+'[data-swiper-slide-index="'+a+'"]:not(.swiper-slide-duplicate)').eq(0).index(),setTimeout(function(){y.slideTo(o)},0)):y.slideTo(o)}else y.slideTo(o)}};var x,D,M,L,C,P,I,k,N,z,O="input, select, textarea, button",A=Date.now(),G=[];y.animating=!1,y.touches={startX:0,startY:0,currentX:0,currentY:0,diff:0};var V,R;if(y.onTouchStart=function(e){if(e.originalEvent&&(e=e.originalEvent),V="touchstart"===e.type,V||!("which"in e)||3!==e.which){if(y.params.noSwiping&&d(e,"."+y.params.noSwipingClass))return void(y.allowClick=!0);if(!y.params.swipeHandler||d(e,y.params.swipeHandler)){var n=y.touches.currentX="touchstart"===e.type?e.targetTouches[0].pageX:e.pageX,i=y.touches.currentY="touchstart"===e.type?e.targetTouches[0].pageY:e.pageY;if(!(y.device.ios&&y.params.iOSEdgeSwipeDetection&&n<=y.params.iOSEdgeSwipeThreshold)){if(x=!0,D=!1,M=!0,C=void 0,R=void 0,y.touches.startX=n,y.touches.startY=i,L=Date.now(),y.allowClick=!0,y.updateContainerSize(),y.swipeDirection=void 0,y.params.threshold>0&&(k=!1),"touchstart"!==e.type){var r=!0;t(e.target).is(O)&&(r=!1),document.activeElement&&t(document.activeElement).is(O)&&document.activeElement.blur(),r&&e.preventDefault()}y.emit("onTouchStart",y,e)}}}},y.onTouchMove=function(e){if(e.originalEvent&&(e=e.originalEvent),!(V&&"mousemove"===e.type||e.preventedByNestedSwiper)){if(y.params.onlyExternal)return y.allowClick=!1,void(x&&(y.touches.startX=y.touches.currentX="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,y.touches.startY=y.touches.currentY="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,L=Date.now()));if(V&&document.activeElement&&e.target===document.activeElement&&t(e.target).is(O))return D=!0,void(y.allowClick=!1);if(M&&y.emit("onTouchMove",y,e),!(e.targetTouches&&e.targetTouches.length>1)){if(y.touches.currentX="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,y.touches.currentY="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,"undefined"==typeof C){var n=180*Math.atan2(Math.abs(y.touches.currentY-y.touches.startY),Math.abs(y.touches.currentX-y.touches.startX))/Math.PI;C=s()?n>y.params.touchAngle:90-n>y.params.touchAngle}if(C&&y.emit("onTouchMoveOpposite",y,e),"undefined"==typeof R&&y.browser.ieTouch&&(y.touches.currentX!==y.touches.startX||y.touches.currentY!==y.touches.startY)&&(R=!0),x){if(C)return void(x=!1);if(R||!y.browser.ieTouch){y.allowClick=!1,y.emit("onSliderMove",y,e),e.preventDefault(),y.params.touchMoveStopPropagation&&!y.params.nested&&e.stopPropagation(),D||(r.loop&&y.fixLoop(),I=y.getWrapperTranslate(),y.setWrapperTransition(0),y.animating&&y.wrapper.trigger("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd msTransitionEnd"),y.params.autoplay&&y.autoplaying&&(y.params.autoplayDisableOnInteraction?y.stopAutoplay():y.pauseAutoplay()),z=!1,y.params.grabCursor&&(y.container[0].style.cursor="move",y.container[0].style.cursor="-webkit-grabbing",y.container[0].style.cursor="-moz-grabbin",y.container[0].style.cursor="grabbing")),D=!0;var i=y.touches.diff=s()?y.touches.currentX-y.touches.startX:y.touches.currentY-y.touches.startY;i*=y.params.touchRatio,y.rtl&&(i=-i),y.swipeDirection=i>0?"prev":"next",P=i+I;var a=!0;if(i>0&&P>y.minTranslate()?(a=!1,y.params.resistance&&(P=y.minTranslate()-1+Math.pow(-y.minTranslate()+I+i,y.params.resistanceRatio))):0>i&&P<y.maxTranslate()&&(a=!1,y.params.resistance&&(P=y.maxTranslate()+1-Math.pow(y.maxTranslate()-I-i,y.params.resistanceRatio))),a&&(e.preventedByNestedSwiper=!0),!y.params.allowSwipeToNext&&"next"===y.swipeDirection&&I>P&&(P=I),!y.params.allowSwipeToPrev&&"prev"===y.swipeDirection&&P>I&&(P=I),y.params.followFinger){if(y.params.threshold>0){if(!(Math.abs(i)>y.params.threshold||k))return void(P=I);if(!k)return k=!0,y.touches.startX=y.touches.currentX,y.touches.startY=y.touches.currentY,P=I,void(y.touches.diff=s()?y.touches.currentX-y.touches.startX:y.touches.currentY-y.touches.startY)}(y.params.freeMode||y.params.watchSlidesProgress)&&y.updateActiveIndex(),y.params.freeMode&&(0===G.length&&G.push({position:y.touches[s()?"startX":"startY"],time:L}),G.push({position:y.touches[s()?"currentX":"currentY"],time:(new window.Date).getTime()})),y.updateProgress(P),y.setWrapperTranslate(P)}}}}}},y.onTouchEnd=function(e){if(e.originalEvent&&(e=e.originalEvent),M&&y.emit("onTouchEnd",y,e),M=!1,x){y.params.grabCursor&&D&&x&&(y.container[0].style.cursor="move",y.container[0].style.cursor="-webkit-grab",y.container[0].style.cursor="-moz-grab",y.container[0].style.cursor="grab");var n=Date.now(),i=n-L;if(y.allowClick&&(y.updateClickedSlide(e),y.emit("onTap",y,e),300>i&&n-A>300&&(N&&clearTimeout(N),N=setTimeout(function(){y&&(y.params.paginationHide&&y.paginationContainer.length>0&&!t(e.target).hasClass(y.params.bulletClass)&&y.paginationContainer.toggleClass(y.params.paginationHiddenClass),y.emit("onClick",y,e))},300)),300>i&&300>n-A&&(N&&clearTimeout(N),y.emit("onDoubleTap",y,e))),A=Date.now(),setTimeout(function(){y&&(y.allowClick=!0)},0),!x||!D||!y.swipeDirection||0===y.touches.diff||P===I)return void(x=D=!1);x=D=!1;var r;if(r=y.params.followFinger?y.rtl?y.translate:-y.translate:-P,y.params.freeMode){if(r<-y.minTranslate())return void y.slideTo(y.activeIndex);if(r>-y.maxTranslate())return void(y.slides.length<y.snapGrid.length?y.slideTo(y.snapGrid.length-1):y.slideTo(y.slides.length-1));if(y.params.freeModeMomentum){if(G.length>1){var a=G.pop(),o=G.pop(),s=a.position-o.position,l=a.time-o.time;y.velocity=s/l,y.velocity=y.velocity/2,Math.abs(y.velocity)<y.params.freeModeMinimumVelocity&&(y.velocity=0),(l>150||(new window.Date).getTime()-a.time>300)&&(y.velocity=0)}else y.velocity=0;G.length=0;var c=1e3*y.params.freeModeMomentumRatio,d=y.velocity*c,u=y.translate+d;y.rtl&&(u=-u);var p,h=!1,f=20*Math.abs(y.velocity)*y.params.freeModeMomentumBounceRatio;if(u<y.maxTranslate())y.params.freeModeMomentumBounce?(u+y.maxTranslate()<-f&&(u=y.maxTranslate()-f),p=y.maxTranslate(),h=!0,z=!0):u=y.maxTranslate();else if(u>y.minTranslate())y.params.freeModeMomentumBounce?(u-y.minTranslate()>f&&(u=y.minTranslate()+f),p=y.minTranslate(),h=!0,z=!0):u=y.minTranslate();else if(y.params.freeModeSticky){var m,g=0;for(g=0;g<y.snapGrid.length;g+=1)if(y.snapGrid[g]>-u){m=g;break}u=Math.abs(y.snapGrid[m]-u)<Math.abs(y.snapGrid[m-1]-u)||"next"===y.swipeDirection?y.snapGrid[m]:y.snapGrid[m-1],y.rtl||(u=-u)}if(0!==y.velocity)c=y.rtl?Math.abs((-u-y.translate)/y.velocity):Math.abs((u-y.translate)/y.velocity);else if(y.params.freeModeSticky)return void y.slideReset();y.params.freeModeMomentumBounce&&h?(y.updateProgress(p),y.setWrapperTransition(c),y.setWrapperTranslate(u),y.onTransitionStart(),y.animating=!0,y.wrapper.transitionEnd(function(){y&&z&&(y.emit("onMomentumBounce",y),y.setWrapperTransition(y.params.speed),y.setWrapperTranslate(p),y.wrapper.transitionEnd(function(){y&&y.onTransitionEnd()}))})):y.velocity?(y.updateProgress(u),y.setWrapperTransition(c),y.setWrapperTranslate(u),y.onTransitionStart(),y.animating||(y.animating=!0,y.wrapper.transitionEnd(function(){y&&y.onTransitionEnd()}))):y.updateProgress(u),y.updateActiveIndex()}return void((!y.params.freeModeMomentum||i>=y.params.longSwipesMs)&&(y.updateProgress(),y.updateActiveIndex()))}var v,_=0,w=y.slidesSizesGrid[0];for(v=0;v<y.slidesGrid.length;v+=y.params.slidesPerGroup)"undefined"!=typeof y.slidesGrid[v+y.params.slidesPerGroup]?r>=y.slidesGrid[v]&&r<y.slidesGrid[v+y.params.slidesPerGroup]&&(_=v,w=y.slidesGrid[v+y.params.slidesPerGroup]-y.slidesGrid[v]):r>=y.slidesGrid[v]&&(_=v,w=y.slidesGrid[y.slidesGrid.length-1]-y.slidesGrid[y.slidesGrid.length-2]);var T=(r-y.slidesGrid[_])/w;if(i>y.params.longSwipesMs){if(!y.params.longSwipes)return void y.slideTo(y.activeIndex);"next"===y.swipeDirection&&(T>=y.params.longSwipesRatio?y.slideTo(_+y.params.slidesPerGroup):y.slideTo(_)),"prev"===y.swipeDirection&&(T>1-y.params.longSwipesRatio?y.slideTo(_+y.params.slidesPerGroup):y.slideTo(_))}else{if(!y.params.shortSwipes)return void y.slideTo(y.activeIndex);"next"===y.swipeDirection&&y.slideTo(_+y.params.slidesPerGroup),"prev"===y.swipeDirection&&y.slideTo(_)}}},y._slideTo=function(e,t){return y.slideTo(e,t,!0,!0)},y.slideTo=function(e,t,n,i){"undefined"==typeof n&&(n=!0),"undefined"==typeof e&&(e=0),0>e&&(e=0),y.snapIndex=Math.floor(e/y.params.slidesPerGroup),y.snapIndex>=y.snapGrid.length&&(y.snapIndex=y.snapGrid.length-1);var r=-y.snapGrid[y.snapIndex];y.params.autoplay&&y.autoplaying&&(i||!y.params.autoplayDisableOnInteraction?y.pauseAutoplay(t):y.stopAutoplay()),y.updateProgress(r);for(var a=0;a<y.slidesGrid.length;a++)-Math.floor(100*r)>=Math.floor(100*y.slidesGrid[a])&&(e=a);return!y.params.allowSwipeToNext&&r<y.translate&&r<y.minTranslate()?!1:!y.params.allowSwipeToPrev&&r>y.translate&&r>y.maxTranslate()&&(y.activeIndex||0)!==e?!1:("undefined"==typeof t&&(t=y.params.speed),y.previousIndex=y.activeIndex||0,y.activeIndex=e,y.rtl&&-r===y.translate||!y.rtl&&r===y.translate?(y.params.autoHeight&&y.updateAutoHeight(),y.updateClasses(),"slide"!==y.params.effect&&y.setWrapperTranslate(r),!1):(y.updateClasses(),y.onTransitionStart(n),0===t?(y.setWrapperTranslate(r),y.setWrapperTransition(0),y.onTransitionEnd(n)):(y.setWrapperTranslate(r),y.setWrapperTransition(t),y.animating||(y.animating=!0,y.wrapper.transitionEnd(function(){y&&y.onTransitionEnd(n)}))),!0))},y.onTransitionStart=function(e){"undefined"==typeof e&&(e=!0),y.params.autoHeight&&y.updateAutoHeight(),y.lazy&&y.lazy.onTransitionStart(),e&&(y.emit("onTransitionStart",y),y.activeIndex!==y.previousIndex&&(y.emit("onSlideChangeStart",y),y.activeIndex>y.previousIndex?y.emit("onSlideNextStart",y):y.emit("onSlidePrevStart",y)))},y.onTransitionEnd=function(e){y.animating=!1,y.setWrapperTransition(0),"undefined"==typeof e&&(e=!0),y.lazy&&y.lazy.onTransitionEnd(),e&&(y.emit("onTransitionEnd",y),y.activeIndex!==y.previousIndex&&(y.emit("onSlideChangeEnd",y),y.activeIndex>y.previousIndex?y.emit("onSlideNextEnd",y):y.emit("onSlidePrevEnd",y))),y.params.hashnav&&y.hashnav&&y.hashnav.setHash()},y.slideNext=function(e,t,n){if(y.params.loop){if(y.animating)return!1;y.fixLoop();y.container[0].clientLeft;return y.slideTo(y.activeIndex+y.params.slidesPerGroup,t,e,n)}return y.slideTo(y.activeIndex+y.params.slidesPerGroup,t,e,n)},y._slideNext=function(e){return y.slideNext(!0,e,!0)},y.slidePrev=function(e,t,n){if(y.params.loop){if(y.animating)return!1;y.fixLoop();y.container[0].clientLeft;return y.slideTo(y.activeIndex-1,t,e,n)}return y.slideTo(y.activeIndex-1,t,e,n)},y._slidePrev=function(e){return y.slidePrev(!0,e,!0)},y.slideReset=function(e,t,n){return y.slideTo(y.activeIndex,t,e)},y.setWrapperTransition=function(e,t){y.wrapper.transition(e),"slide"!==y.params.effect&&y.effects[y.params.effect]&&y.effects[y.params.effect].setTransition(e),y.params.parallax&&y.parallax&&y.parallax.setTransition(e),y.params.scrollbar&&y.scrollbar&&y.scrollbar.setTransition(e),y.params.control&&y.controller&&y.controller.setTransition(e,t),y.emit("onSetTransition",y,e)},y.setWrapperTranslate=function(e,t,n){var i=0,r=0,a=0;s()?i=y.rtl?-e:e:r=e,y.params.roundLengths&&(i=l(i),r=l(r)),y.params.virtualTranslate||(y.support.transforms3d?y.wrapper.transform("translate3d("+i+"px, "+r+"px, "+a+"px)"):y.wrapper.transform("translate("+i+"px, "+r+"px)")),y.translate=s()?i:r;var o,c=y.maxTranslate()-y.minTranslate();o=0===c?0:(e-y.minTranslate())/c,
o!==y.progress&&y.updateProgress(e),t&&y.updateActiveIndex(),"slide"!==y.params.effect&&y.effects[y.params.effect]&&y.effects[y.params.effect].setTranslate(y.translate),y.params.parallax&&y.parallax&&y.parallax.setTranslate(y.translate),y.params.scrollbar&&y.scrollbar&&y.scrollbar.setTranslate(y.translate),y.params.control&&y.controller&&y.controller.setTranslate(y.translate,n),y.emit("onSetTranslate",y,y.translate)},y.getTranslate=function(e,t){var n,i,r,a;return"undefined"==typeof t&&(t="x"),y.params.virtualTranslate?y.rtl?-y.translate:y.translate:(r=window.getComputedStyle(e,null),window.WebKitCSSMatrix?(i=r.transform||r.webkitTransform,i.split(",").length>6&&(i=i.split(", ").map(function(e){return e.replace(",",".")}).join(", ")),a=new window.WebKitCSSMatrix("none"===i?"":i)):(a=r.MozTransform||r.OTransform||r.MsTransform||r.msTransform||r.transform||r.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),n=a.toString().split(",")),"x"===t&&(i=window.WebKitCSSMatrix?a.m41:16===n.length?parseFloat(n[12]):parseFloat(n[4])),"y"===t&&(i=window.WebKitCSSMatrix?a.m42:16===n.length?parseFloat(n[13]):parseFloat(n[5])),y.rtl&&i&&(i=-i),i||0)},y.getWrapperTranslate=function(e){return"undefined"==typeof e&&(e=s()?"x":"y"),y.getTranslate(y.wrapper[0],e)},y.observers=[],y.initObservers=function(){if(y.params.observeParents)for(var e=y.container.parents(),t=0;t<e.length;t++)u(e[t]);u(y.container[0],{childList:!1}),u(y.wrapper[0],{attributes:!1})},y.disconnectObservers=function(){for(var e=0;e<y.observers.length;e++)y.observers[e].disconnect();y.observers=[]},y.updateLoop=function(){for(var e=y.wrapper.children("."+y.params.slideClass+"."+y.params.slideDuplicateClass),t=y.wrapper.children("."+y.params.slideClass),n=0;n<e.length;n++)for(var i=e[n],r=angular.element(i).attr("data-swiper-slide-index"),a=0;n<t.length;a++){var o=t[a];if(!angular.element(o).hasClass(y.params.slideDuplicateClass)&&angular.element(o).attr("data-swiper-slide-index")===r){i.innerHTML=o.innerHTML;break}}},y.createLoop=function(){y.wrapper.children("."+y.params.slideClass+"."+y.params.slideDuplicateClass).remove();var e=y.wrapper.children("."+y.params.slideClass);"auto"!==y.params.slidesPerView||y.params.loopedSlides||(y.params.loopedSlides=e.length),y.loopedSlides=parseInt(y.params.loopedSlides||y.params.slidesPerView,10),y.loopedSlides=y.loopedSlides+y.params.loopAdditionalSlides,y.loopedSlides>e.length&&(y.loopedSlides=e.length);var n,i=[],r=[];for(e.each(function(n,a){var o=t(this);n<y.loopedSlides&&r.push(a),n<e.length&&n>=e.length-y.loopedSlides&&i.push(a),o.attr("data-swiper-slide-index",n)}),n=0;n<r.length;n++)y.wrapper.append(t(r[n].cloneNode(!0)).addClass(y.params.slideDuplicateClass));for(n=i.length-1;n>=0;n--)y.wrapper.prepend(t(i[n].cloneNode(!0)).addClass(y.params.slideDuplicateClass))},y.destroyLoop=function(){y.wrapper.children("."+y.params.slideClass+"."+y.params.slideDuplicateClass).remove(),y.slides.removeAttr("data-swiper-slide-index")},y.fixLoop=function(){var e;y.activeIndex<y.loopedSlides?(e=y.slides.length-3*y.loopedSlides+y.activeIndex,e+=y.loopedSlides,y.slideTo(e,0,!1,!0)):("auto"===y.params.slidesPerView&&y.activeIndex>=2*y.loopedSlides||y.activeIndex>y.slides.length-2*y.params.slidesPerView)&&(e=-y.slides.length+y.activeIndex+y.loopedSlides,e+=y.loopedSlides,y.slideTo(e,0,!1,!0))},y.appendSlide=function(e){if(y.params.loop&&y.destroyLoop(),"object"==typeof e&&e.length)for(var t=0;t<e.length;t++)e[t]&&y.wrapper.append(e[t]);else y.wrapper.append(e);y.params.loop&&y.createLoop(),y.params.observer&&y.support.observer||y.update(!0)},y.prependSlide=function(e){y.params.loop&&y.destroyLoop();var t=y.activeIndex+1;if("object"==typeof e&&e.length){for(var n=0;n<e.length;n++)e[n]&&y.wrapper.prepend(e[n]);t=y.activeIndex+e.length}else y.wrapper.prepend(e);y.params.loop&&y.createLoop(),y.params.observer&&y.support.observer||y.update(!0),y.slideTo(t,0,!1)},y.removeSlide=function(e){y.params.loop&&(y.destroyLoop(),y.slides=y.wrapper.children("."+y.params.slideClass));var t,n=y.activeIndex;if("object"==typeof e&&e.length){for(var i=0;i<e.length;i++)t=e[i],y.slides[t]&&y.slides.eq(t).remove(),n>t&&n--;n=Math.max(n,0)}else t=e,y.slides[t]&&y.slides.eq(t).remove(),n>t&&n--,n=Math.max(n,0);y.params.loop&&y.createLoop(),y.params.observer&&y.support.observer||y.update(!0),y.params.loop?y.slideTo(n+y.loopedSlides,0,!1):y.slideTo(n,0,!1)},y.removeAllSlides=function(){for(var e=[],t=0;t<y.slides.length;t++)e.push(t);y.removeSlide(e)},y.effects={fade:{setTranslate:function(){for(var e=0;e<y.slides.length;e++){var t=y.slides.eq(e),n=t[0].swiperSlideOffset,i=-n;y.params.virtualTranslate||(i-=y.translate);var r=0;s()||(r=i,i=0);var a=y.params.fade.crossFade?Math.max(1-Math.abs(t[0].progress),0):1+Math.min(Math.max(t[0].progress,-1),0);t.css({opacity:a}).transform("translate3d("+i+"px, "+r+"px, 0px)")}},setTransition:function(e){if(y.slides.transition(e),y.params.virtualTranslate&&0!==e){var t=!1;y.slides.transitionEnd(function(){if(!t&&y){t=!0,y.animating=!1;for(var e=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],n=0;n<e.length;n++)y.wrapper.trigger(e[n])}})}}},cube:{setTranslate:function(){var e,n=0;y.params.cube.shadow&&(s()?(e=y.wrapper.find(".swiper-cube-shadow"),0===e.length&&(e=t('<div class="swiper-cube-shadow"></div>'),y.wrapper.append(e)),e.css({height:y.width+"px"})):(e=y.container.find(".swiper-cube-shadow"),0===e.length&&(e=t('<div class="swiper-cube-shadow"></div>'),y.container.append(e))));for(var i=0;i<y.slides.length;i++){var r=y.slides.eq(i),a=90*i,o=Math.floor(a/360);y.rtl&&(a=-a,o=Math.floor(-a/360));var l=Math.max(Math.min(r[0].progress,1),-1),c=0,d=0,u=0;i%4===0?(c=4*-o*y.size,u=0):(i-1)%4===0?(c=0,u=4*-o*y.size):(i-2)%4===0?(c=y.size+4*o*y.size,u=y.size):(i-3)%4===0&&(c=-y.size,u=3*y.size+4*y.size*o),y.rtl&&(c=-c),s()||(d=c,c=0);var p="rotateX("+(s()?0:-a)+"deg) rotateY("+(s()?a:0)+"deg) translate3d("+c+"px, "+d+"px, "+u+"px)";if(1>=l&&l>-1&&(n=90*i+90*l,y.rtl&&(n=90*-i-90*l)),r.transform(p),y.params.cube.slideShadows){var h=s()?r.find(".swiper-slide-shadow-left"):r.find(".swiper-slide-shadow-top"),f=s()?r.find(".swiper-slide-shadow-right"):r.find(".swiper-slide-shadow-bottom");0===h.length&&(h=t('<div class="swiper-slide-shadow-'+(s()?"left":"top")+'"></div>'),r.append(h)),0===f.length&&(f=t('<div class="swiper-slide-shadow-'+(s()?"right":"bottom")+'"></div>'),r.append(f));r[0].progress;h.length&&(h[0].style.opacity=-r[0].progress),f.length&&(f[0].style.opacity=r[0].progress)}}if(y.wrapper.css({"-webkit-transform-origin":"50% 50% -"+y.size/2+"px","-moz-transform-origin":"50% 50% -"+y.size/2+"px","-ms-transform-origin":"50% 50% -"+y.size/2+"px","transform-origin":"50% 50% -"+y.size/2+"px"}),y.params.cube.shadow)if(s())e.transform("translate3d(0px, "+(y.width/2+y.params.cube.shadowOffset)+"px, "+-y.width/2+"px) rotateX(90deg) rotateZ(0deg) scale("+y.params.cube.shadowScale+")");else{var m=Math.abs(n)-90*Math.floor(Math.abs(n)/90),g=1.5-(Math.sin(2*m*Math.PI/360)/2+Math.cos(2*m*Math.PI/360)/2),v=y.params.cube.shadowScale,_=y.params.cube.shadowScale/g,w=y.params.cube.shadowOffset;e.transform("scale3d("+v+", 1, "+_+") translate3d(0px, "+(y.height/2+w)+"px, "+-y.height/2/_+"px) rotateX(-90deg)")}var T=y.isSafari||y.isUiWebView?-y.size/2:0;y.wrapper.transform("translate3d(0px,0,"+T+"px) rotateX("+(s()?0:n)+"deg) rotateY("+(s()?-n:0)+"deg)")},setTransition:function(e){y.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),y.params.cube.shadow&&!s()&&y.container.find(".swiper-cube-shadow").transition(e)}},coverflow:{setTranslate:function(){for(var e=y.translate,n=s()?-e+y.width/2:-e+y.height/2,i=s()?y.params.coverflow.rotate:-y.params.coverflow.rotate,r=y.params.coverflow.depth,a=0,o=y.slides.length;o>a;a++){var l=y.slides.eq(a),c=y.slidesSizesGrid[a],d=l[0].swiperSlideOffset,u=(n-d-c/2)/c*y.params.coverflow.modifier,p=s()?i*u:0,h=s()?0:i*u,f=-r*Math.abs(u),m=s()?0:y.params.coverflow.stretch*u,g=s()?y.params.coverflow.stretch*u:0;Math.abs(g)<.001&&(g=0),Math.abs(m)<.001&&(m=0),Math.abs(f)<.001&&(f=0),Math.abs(p)<.001&&(p=0),Math.abs(h)<.001&&(h=0);var v="translate3d("+g+"px,"+m+"px,"+f+"px)  rotateX("+h+"deg) rotateY("+p+"deg)";if(l.transform(v),l[0].style.zIndex=-Math.abs(Math.round(u))+1,y.params.coverflow.slideShadows){var _=s()?l.find(".swiper-slide-shadow-left"):l.find(".swiper-slide-shadow-top"),w=s()?l.find(".swiper-slide-shadow-right"):l.find(".swiper-slide-shadow-bottom");0===_.length&&(_=t('<div class="swiper-slide-shadow-'+(s()?"left":"top")+'"></div>'),l.append(_)),0===w.length&&(w=t('<div class="swiper-slide-shadow-'+(s()?"right":"bottom")+'"></div>'),l.append(w)),_.length&&(_[0].style.opacity=u>0?u:0),w.length&&(w[0].style.opacity=-u>0?-u:0)}}if(y.browser.ie){var T=y.wrapper[0].style;T.perspectiveOrigin=n+"px 50%"}},setTransition:function(e){y.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e)}}},y.lazy={initialImageLoaded:!1,loadImageInSlide:function(e,n){if("undefined"!=typeof e&&("undefined"==typeof n&&(n=!0),0!==y.slides.length)){var i=y.slides.eq(e),r=i.find(".swiper-lazy:not(.swiper-lazy-loaded):not(.swiper-lazy-loading)");!i.hasClass("swiper-lazy")||i.hasClass("swiper-lazy-loaded")||i.hasClass("swiper-lazy-loading")||(r=r.add(i[0])),0!==r.length&&r.each(function(){var e=t(this);e.addClass("swiper-lazy-loading");var r=e.attr("data-background"),a=e.attr("data-src"),o=e.attr("data-srcset");y.loadImage(e[0],a||r,o,!1,function(){if(r?(e.css("background-image","url("+r+")"),e.removeAttr("data-background")):(o&&(e.attr("srcset",o),e.removeAttr("data-srcset")),a&&(e.attr("src",a),e.removeAttr("data-src"))),e.addClass("swiper-lazy-loaded").removeClass("swiper-lazy-loading"),i.find(".swiper-lazy-preloader, .preloader").remove(),y.params.loop&&n){var t=i.attr("data-swiper-slide-index");if(i.hasClass(y.params.slideDuplicateClass)){var s=y.wrapper.children('[data-swiper-slide-index="'+t+'"]:not(.'+y.params.slideDuplicateClass+")");y.lazy.loadImageInSlide(s.index(),!1)}else{var l=y.wrapper.children("."+y.params.slideDuplicateClass+'[data-swiper-slide-index="'+t+'"]');y.lazy.loadImageInSlide(l.index(),!1)}}y.emit("onLazyImageReady",y,i[0],e[0])}),y.emit("onLazyImageLoad",y,i[0],e[0])})}},load:function(){var e;if(y.params.watchSlidesVisibility)y.wrapper.children("."+y.params.slideVisibleClass).each(function(){y.lazy.loadImageInSlide(t(this).index())});else if(y.params.slidesPerView>1)for(e=y.activeIndex;e<y.activeIndex+y.params.slidesPerView;e++)y.slides[e]&&y.lazy.loadImageInSlide(e);else y.lazy.loadImageInSlide(y.activeIndex);if(y.params.lazyLoadingInPrevNext)if(y.params.slidesPerView>1){for(e=y.activeIndex+y.params.slidesPerView;e<y.activeIndex+y.params.slidesPerView+y.params.slidesPerView;e++)y.slides[e]&&y.lazy.loadImageInSlide(e);for(e=y.activeIndex-y.params.slidesPerView;e<y.activeIndex;e++)y.slides[e]&&y.lazy.loadImageInSlide(e)}else{var n=y.wrapper.children("."+y.params.slideNextClass);n.length>0&&y.lazy.loadImageInSlide(n.index());var i=y.wrapper.children("."+y.params.slidePrevClass);i.length>0&&y.lazy.loadImageInSlide(i.index())}},onTransitionStart:function(){y.params.lazyLoading&&(y.params.lazyLoadingOnTransitionStart||!y.params.lazyLoadingOnTransitionStart&&!y.lazy.initialImageLoaded)&&y.lazy.load()},onTransitionEnd:function(){y.params.lazyLoading&&!y.params.lazyLoadingOnTransitionStart&&y.lazy.load()}},y.scrollbar={isTouched:!1,setDragPosition:function(e){var t=y.scrollbar,n=s()?"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].pageX:e.pageX||e.clientX:"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].pageY:e.pageY||e.clientY,i=n-t.track.offset()[s()?"left":"top"]-t.dragSize/2,r=-y.minTranslate()*t.moveDivider,a=-y.maxTranslate()*t.moveDivider;r>i?i=r:i>a&&(i=a),i=-i/t.moveDivider,y.updateProgress(i),y.setWrapperTranslate(i,!0)},dragStart:function(e){var t=y.scrollbar;t.isTouched=!0,e.preventDefault(),e.stopPropagation(),t.setDragPosition(e),clearTimeout(t.dragTimeout),t.track.transition(0),y.params.scrollbarHide&&t.track.css("opacity",1),y.wrapper.transition(100),t.drag.transition(100),y.emit("onScrollbarDragStart",y)},dragMove:function(e){var t=y.scrollbar;t.isTouched&&(e.preventDefault?e.preventDefault():e.returnValue=!1,t.setDragPosition(e),y.wrapper.transition(0),t.track.transition(0),t.drag.transition(0),y.emit("onScrollbarDragMove",y))},dragEnd:function(e){var t=y.scrollbar;t.isTouched&&(t.isTouched=!1,y.params.scrollbarHide&&(clearTimeout(t.dragTimeout),t.dragTimeout=setTimeout(function(){t.track.css("opacity",0),t.track.transition(400)},1e3)),y.emit("onScrollbarDragEnd",y),y.params.scrollbarSnapOnRelease&&y.slideReset())},enableDraggable:function(){var e=y.scrollbar,n=y.support.touch?e.track:document;t(e.track).on(y.touchEvents.start,e.dragStart),t(n).on(y.touchEvents.move,e.dragMove),t(n).on(y.touchEvents.end,e.dragEnd)},disableDraggable:function(){var e=y.scrollbar,n=y.support.touch?e.track:document;t(e.track).off(y.touchEvents.start,e.dragStart),t(n).off(y.touchEvents.move,e.dragMove),t(n).off(y.touchEvents.end,e.dragEnd)},set:function(){if(y.params.scrollbar){var e=y.scrollbar;e.track=t(y.params.scrollbar),e.drag=e.track.find(".swiper-scrollbar-drag"),0===e.drag.length&&(e.drag=t('<div class="swiper-scrollbar-drag"></div>'),e.track.append(e.drag)),e.drag[0].style.width="",e.drag[0].style.height="",e.trackSize=s()?e.track[0].offsetWidth:e.track[0].offsetHeight,e.divider=y.size/y.virtualSize,e.moveDivider=e.divider*(e.trackSize/y.size),e.dragSize=e.trackSize*e.divider,s()?e.drag[0].style.width=e.dragSize+"px":e.drag[0].style.height=e.dragSize+"px",e.divider>=1?e.track[0].style.display="none":e.track[0].style.display="",y.params.scrollbarHide&&(e.track[0].style.opacity=0)}},setTranslate:function(){if(y.params.scrollbar){var e,t=y.scrollbar,n=(y.translate||0,t.dragSize);e=(t.trackSize-t.dragSize)*y.progress,y.rtl&&s()?(e=-e,e>0?(n=t.dragSize-e,e=0):-e+t.dragSize>t.trackSize&&(n=t.trackSize+e)):0>e?(n=t.dragSize+e,e=0):e+t.dragSize>t.trackSize&&(n=t.trackSize-e),s()?(y.support.transforms3d?t.drag.transform("translate3d("+e+"px, 0, 0)"):t.drag.transform("translateX("+e+"px)"),t.drag[0].style.width=n+"px"):(y.support.transforms3d?t.drag.transform("translate3d(0px, "+e+"px, 0)"):t.drag.transform("translateY("+e+"px)"),t.drag[0].style.height=n+"px"),y.params.scrollbarHide&&(clearTimeout(t.timeout),t.track[0].style.opacity=1,t.timeout=setTimeout(function(){t.track[0].style.opacity=0,t.track.transition(400)},1e3))}},setTransition:function(e){y.params.scrollbar&&y.scrollbar.drag.transition(e)}},y.controller={LinearSpline:function(e,t){this.x=e,this.y=t,this.lastIndex=e.length-1;var n,i;this.x.length;this.interpolate=function(e){return e?(i=r(this.x,e),n=i-1,(e-this.x[n])*(this.y[i]-this.y[n])/(this.x[i]-this.x[n])+this.y[n]):0};var r=function(){var e,t,n;return function(i,r){for(t=-1,e=i.length;e-t>1;)i[n=e+t>>1]<=r?t=n:e=n;return e}}()},getInterpolateFunction:function(e){y.controller.spline||(y.controller.spline=y.params.loop?new y.controller.LinearSpline(y.slidesGrid,e.slidesGrid):new y.controller.LinearSpline(y.snapGrid,e.snapGrid))},setTranslate:function(e,t){function i(t){e=t.rtl&&"horizontal"===t.params.direction?-y.translate:y.translate,"slide"===y.params.controlBy&&(y.controller.getInterpolateFunction(t),a=-y.controller.spline.interpolate(-e)),a&&"container"!==y.params.controlBy||(r=(t.maxTranslate()-t.minTranslate())/(y.maxTranslate()-y.minTranslate()),a=(e-y.minTranslate())*r+t.minTranslate()),y.params.controlInverse&&(a=t.maxTranslate()-a),t.updateProgress(a),t.setWrapperTranslate(a,!1,y),t.updateActiveIndex()}var r,a,o=y.params.control;if(y.isArray(o))for(var s=0;s<o.length;s++)o[s]!==t&&o[s]instanceof n&&i(o[s]);else o instanceof n&&t!==o&&i(o)},setTransition:function(e,t){function i(t){t.setWrapperTransition(e,y),0!==e&&(t.onTransitionStart(),t.wrapper.transitionEnd(function(){a&&(t.params.loop&&"slide"===y.params.controlBy&&t.fixLoop(),t.onTransitionEnd())}))}var r,a=y.params.control;if(y.isArray(a))for(r=0;r<a.length;r++)a[r]!==t&&a[r]instanceof n&&i(a[r]);else a instanceof n&&t!==a&&i(a)}},y.hashnav={init:function(){if(y.params.hashnav){y.hashnav.initialized=!0;var e=document.location.hash.replace("#","");if(e)for(var t=0,n=0,i=y.slides.length;i>n;n++){var r=y.slides.eq(n),a=r.attr("data-hash");if(a===e&&!r.hasClass(y.params.slideDuplicateClass)){var o=r.index();y.slideTo(o,t,y.params.runCallbacksOnInit,!0)}}}},setHash:function(){y.hashnav.initialized&&y.params.hashnav&&(document.location.hash=y.slides.eq(y.activeIndex).attr("data-hash")||"")}},y.disableKeyboardControl=function(){y.params.keyboardControl=!1,t(document).off("keydown",p)},y.enableKeyboardControl=function(){y.params.keyboardControl=!0,t(document).on("keydown",p)},y.mousewheel={event:!1,lastScrollTime:(new window.Date).getTime()},y.params.mousewheelControl){try{new window.WheelEvent("wheel"),y.mousewheel.event="wheel"}catch(H){}y.mousewheel.event||void 0===document.onmousewheel||(y.mousewheel.event="mousewheel"),y.mousewheel.event||(y.mousewheel.event="DOMMouseScroll")}y.disableMousewheelControl=function(){return y.mousewheel.event?(y.container.off(y.mousewheel.event,h),!0):!1},y.enableMousewheelControl=function(){return y.mousewheel.event?(y.container.on(y.mousewheel.event,h),!0):!1},y.parallax={setTranslate:function(){y.container.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){f(this,y.progress)}),y.slides.each(function(){var e=t(this);e.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var t=Math.min(Math.max(e[0].progress,-1),1);f(this,t)})})},setTransition:function(e){"undefined"==typeof e&&(e=y.params.speed),y.container.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var n=t(this),i=parseInt(n.attr("data-swiper-parallax-duration"),10)||e;0===e&&(i=0),n.transition(i)})}},y._plugins=[];for(var Y in y.plugins){var X=y.plugins[Y](y,y.params[Y]);X&&y._plugins.push(X)}return y.callPlugins=function(e){for(var t=0;t<y._plugins.length;t++)e in y._plugins[t]&&y._plugins[t][e](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},y.emitterEventListeners={},y.emit=function(e){y.params[e]&&y.params[e](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);var t;if(y.emitterEventListeners[e])for(t=0;t<y.emitterEventListeners[e].length;t++)y.emitterEventListeners[e][t](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);y.callPlugins&&y.callPlugins(e,arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},y.on=function(e,t){return e=m(e),y.emitterEventListeners[e]||(y.emitterEventListeners[e]=[]),y.emitterEventListeners[e].push(t),y},y.off=function(e,t){var n;if(e=m(e),"undefined"==typeof t)return y.emitterEventListeners[e]=[],y;if(y.emitterEventListeners[e]&&0!==y.emitterEventListeners[e].length){for(n=0;n<y.emitterEventListeners[e].length;n++)y.emitterEventListeners[e][n]===t&&y.emitterEventListeners[e].splice(n,1);return y}},y.once=function(e,t){e=m(e);var n=function(){t(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),y.off(e,n)};return y.on(e,n),y},y.a11y={makeFocusable:function(e){return e.attr("tabIndex","0"),e},addRole:function(e,t){return e.attr("role",t),e},addLabel:function(e,t){return e.attr("aria-label",t),e},disable:function(e){return e.attr("aria-disabled",!0),e},enable:function(e){return e.attr("aria-disabled",!1),e},onEnterKey:function(e){13===e.keyCode&&(t(e.target).is(y.params.nextButton)?(y.onClickNext(e),y.isEnd?y.a11y.notify(y.params.lastSlideMessage):y.a11y.notify(y.params.nextSlideMessage)):t(e.target).is(y.params.prevButton)&&(y.onClickPrev(e),y.isBeginning?y.a11y.notify(y.params.firstSlideMessage):y.a11y.notify(y.params.prevSlideMessage)),t(e.target).is("."+y.params.bulletClass)&&t(e.target)[0].click())},liveRegion:t('<span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span>'),notify:function(e){var t=y.a11y.liveRegion;0!==t.length&&(t.html(""),t.html(e))},init:function(){if(y.params.nextButton){var e=t(y.params.nextButton);y.a11y.makeFocusable(e),y.a11y.addRole(e,"button"),y.a11y.addLabel(e,y.params.nextSlideMessage)}if(y.params.prevButton){var n=t(y.params.prevButton);y.a11y.makeFocusable(n),y.a11y.addRole(n,"button"),y.a11y.addLabel(n,y.params.prevSlideMessage)}t(y.container).append(y.a11y.liveRegion)},initPagination:function(){y.params.pagination&&y.params.paginationClickable&&y.bullets&&y.bullets.length&&y.bullets.each(function(){var e=t(this);y.a11y.makeFocusable(e),y.a11y.addRole(e,"button"),y.a11y.addLabel(e,y.params.paginationBulletMessage.replace(/{{index}}/,e.index()+1))})},destroy:function(){y.a11y.liveRegion&&y.a11y.liveRegion.length>0&&y.a11y.liveRegion.remove()}},y.init=function(){y.params.loop&&y.createLoop(),y.updateContainerSize(),y.updateSlidesSize(),y.updatePagination(),y.params.scrollbar&&y.scrollbar&&(y.scrollbar.set(),y.params.scrollbarDraggable&&y.scrollbar.enableDraggable()),"slide"!==y.params.effect&&y.effects[y.params.effect]&&(y.params.loop||y.updateProgress(),y.effects[y.params.effect].setTranslate()),y.params.loop?y.slideTo(y.params.initialSlide+y.loopedSlides,0,y.params.runCallbacksOnInit):(y.slideTo(y.params.initialSlide,0,y.params.runCallbacksOnInit),0===y.params.initialSlide&&(y.parallax&&y.params.parallax&&y.parallax.setTranslate(),y.lazy&&y.params.lazyLoading&&(y.lazy.load(),y.lazy.initialImageLoaded=!0))),y.attachEvents(),y.params.observer&&y.support.observer&&y.initObservers(),y.params.preloadImages&&!y.params.lazyLoading&&y.preloadImages(),y.params.autoplay&&y.startAutoplay(),y.params.keyboardControl&&y.enableKeyboardControl&&y.enableKeyboardControl(),y.params.mousewheelControl&&y.enableMousewheelControl&&y.enableMousewheelControl(),y.params.hashnav&&y.hashnav&&y.hashnav.init(),y.params.a11y&&y.a11y&&y.a11y.init(),y.emit("onInit",y)},y.cleanupStyles=function(){y.container.removeClass(y.classNames.join(" ")).removeAttr("style"),y.wrapper.removeAttr("style"),y.slides&&y.slides.length&&y.slides.removeClass([y.params.slideVisibleClass,y.params.slideActiveClass,y.params.slideNextClass,y.params.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-column").removeAttr("data-swiper-row"),y.paginationContainer&&y.paginationContainer.length&&y.paginationContainer.removeClass(y.params.paginationHiddenClass),y.bullets&&y.bullets.length&&y.bullets.removeClass(y.params.bulletActiveClass),y.params.prevButton&&t(y.params.prevButton).removeClass(y.params.buttonDisabledClass),y.params.nextButton&&t(y.params.nextButton).removeClass(y.params.buttonDisabledClass),y.params.scrollbar&&y.scrollbar&&(y.scrollbar.track&&y.scrollbar.track.length&&y.scrollbar.track.removeAttr("style"),y.scrollbar.drag&&y.scrollbar.drag.length&&y.scrollbar.drag.removeAttr("style"))},y.destroy=function(e,t){y.detachEvents(),y.stopAutoplay(),y.params.scrollbar&&y.scrollbar&&y.params.scrollbarDraggable&&y.scrollbar.disableDraggable(),y.params.loop&&y.destroyLoop(),t&&y.cleanupStyles(),y.disconnectObservers(),y.params.keyboardControl&&y.disableKeyboardControl&&y.disableKeyboardControl(),y.params.mousewheelControl&&y.disableMousewheelControl&&y.disableMousewheelControl(),y.params.a11y&&y.a11y&&y.a11y.destroy(),y.emit("onDestroy"),e!==!1&&(y=null)},y.init(),y}};n.prototype={isSafari:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("safari")>=0&&e.indexOf("chrome")<0&&e.indexOf("android")<0}(),isUiWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},browser:{ie:window.navigator.pointerEnabled||window.navigator.msPointerEnabled,ieTouch:window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>1||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>1},device:function(){var e=navigator.userAgent,t=e.match(/(Android);?[\s\/]+([\d.]+)?/),n=e.match(/(iPad).*OS\s([\d_]+)/),i=e.match(/(iPod)(.*OS\s([\d_]+))?/),r=!n&&e.match(/(iPhone\sOS)\s([\d_]+)/);return{ios:n||r||i,android:t}}(),support:{touch:window.Modernizr&&Modernizr.touch===!0||function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}(),transforms3d:window.Modernizr&&Modernizr.csstransforms3d===!0||function(){var e=document.createElement("div").style;return"webkitPerspective"in e||"MozPerspective"in e||"OPerspective"in e||"MsPerspective"in e||"perspective"in e}(),flexbox:function(){for(var e=document.createElement("div").style,t="alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient".split(" "),n=0;n<t.length;n++)if(t[n]in e)return!0}(),observer:function(){return"MutationObserver"in window||"WebkitMutationObserver"in window}()},plugins:{}};for(var i=(function(){var e=function(e){var t=this,n=0;for(n=0;n<e.length;n++)t[n]=e[n];return t.length=e.length,this},t=function(t,n){var i=[],r=0;if(t&&!n&&t instanceof e)return t;if(t)if("string"==typeof t){var a,o,s=t.trim();if(s.indexOf("<")>=0&&s.indexOf(">")>=0){var l="div";for(0===s.indexOf("<li")&&(l="ul"),0===s.indexOf("<tr")&&(l="tbody"),(0===s.indexOf("<td")||0===s.indexOf("<th"))&&(l="tr"),0===s.indexOf("<tbody")&&(l="table"),0===s.indexOf("<option")&&(l="select"),o=document.createElement(l),o.innerHTML=t,r=0;r<o.childNodes.length;r++)i.push(o.childNodes[r])}else for(a=n||"#"!==t[0]||t.match(/[ .<>:~]/)?(n||document).querySelectorAll(t):[document.getElementById(t.split("#")[1])],r=0;r<a.length;r++)a[r]&&i.push(a[r])}else if(t.nodeType||t===window||t===document)i.push(t);else if(t.length>0&&t[0].nodeType)for(r=0;r<t.length;r++)i.push(t[r]);return new e(i)};return e.prototype={addClass:function(e){if("undefined"==typeof e)return this;for(var t=e.split(" "),n=0;n<t.length;n++)for(var i=0;i<this.length;i++)this[i].classList.add(t[n]);return this},removeClass:function(e){for(var t=e.split(" "),n=0;n<t.length;n++)for(var i=0;i<this.length;i++)this[i].classList.remove(t[n]);return this},hasClass:function(e){return this[0]?this[0].classList.contains(e):!1},toggleClass:function(e){for(var t=e.split(" "),n=0;n<t.length;n++)for(var i=0;i<this.length;i++)this[i].classList.toggle(t[n]);return this},attr:function(e,t){if(1===arguments.length&&"string"==typeof e)return this[0]?this[0].getAttribute(e):void 0;for(var n=0;n<this.length;n++)if(2===arguments.length)this[n].setAttribute(e,t);else for(var i in e)this[n][i]=e[i],this[n].setAttribute(i,e[i]);return this},removeAttr:function(e){for(var t=0;t<this.length;t++)this[t].removeAttribute(e);return this},data:function(e,t){if("undefined"==typeof t){if(this[0]){var n=this[0].getAttribute("data-"+e);return n?n:this[0].dom7ElementDataStorage&&e in this[0].dom7ElementDataStorage?this[0].dom7ElementDataStorage[e]:void 0}return void 0}for(var i=0;i<this.length;i++){var r=this[i];r.dom7ElementDataStorage||(r.dom7ElementDataStorage={}),r.dom7ElementDataStorage[e]=t}return this},transform:function(e){for(var t=0;t<this.length;t++){var n=this[t].style;n.webkitTransform=n.MsTransform=n.msTransform=n.MozTransform=n.OTransform=n.transform=e}return this},transition:function(e){"string"!=typeof e&&(e+="ms");for(var t=0;t<this.length;t++){var n=this[t].style;n.webkitTransitionDuration=n.MsTransitionDuration=n.msTransitionDuration=n.MozTransitionDuration=n.OTransitionDuration=n.transitionDuration=e}return this},on:function(e,n,i,r){function a(e){var r=e.target;if(t(r).is(n))i.call(r,e);else for(var a=t(r).parents(),o=0;o<a.length;o++)t(a[o]).is(n)&&i.call(a[o],e)}var o,s,l=e.split(" ");for(o=0;o<this.length;o++)if("function"==typeof n||n===!1)for("function"==typeof n&&(i=arguments[1],r=arguments[2]||!1),s=0;s<l.length;s++)this[o].addEventListener(l[s],i,r);else for(s=0;s<l.length;s++)this[o].dom7LiveListeners||(this[o].dom7LiveListeners=[]),this[o].dom7LiveListeners.push({listener:i,liveListener:a}),this[o].addEventListener(l[s],a,r);return this},off:function(e,t,n,i){for(var r=e.split(" "),a=0;a<r.length;a++)for(var o=0;o<this.length;o++)if("function"==typeof t||t===!1)"function"==typeof t&&(n=arguments[1],i=arguments[2]||!1),this[o].removeEventListener(r[a],n,i);else if(this[o].dom7LiveListeners)for(var s=0;s<this[o].dom7LiveListeners.length;s++)this[o].dom7LiveListeners[s].listener===n&&this[o].removeEventListener(r[a],this[o].dom7LiveListeners[s].liveListener,i);return this},once:function(e,t,n,i){function r(o){n(o),a.off(e,t,r,i)}var a=this;"function"==typeof t&&(t=!1,n=arguments[1],i=arguments[2]),a.on(e,t,r,i)},trigger:function(e,t){for(var n=0;n<this.length;n++){var i;try{i=new window.CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0})}catch(r){i=document.createEvent("Event"),i.initEvent(e,!0,!0),i.detail=t}this[n].dispatchEvent(i)}return this},transitionEnd:function(e){function t(a){if(a.target===this)for(e.call(this,a),n=0;n<i.length;n++)r.off(i[n],t)}var n,i=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],r=this;if(e)for(n=0;n<i.length;n++)r.on(i[n],t);return this},width:function(){return this[0]===window?window.innerWidth:this.length>0?parseFloat(this.css("width")):null},outerWidth:function(e){return this.length>0?e?this[0].offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this[0].offsetWidth:null},height:function(){return this[0]===window?window.innerHeight:this.length>0?parseFloat(this.css("height")):null},outerHeight:function(e){return this.length>0?e?this[0].offsetHeight+parseFloat(this.css("margin-top"))+parseFloat(this.css("margin-bottom")):this[0].offsetHeight:null},offset:function(){if(this.length>0){var e=this[0],t=e.getBoundingClientRect(),n=document.body,i=e.clientTop||n.clientTop||0,r=e.clientLeft||n.clientLeft||0,a=window.pageYOffset||e.scrollTop,o=window.pageXOffset||e.scrollLeft;return{top:t.top+a-i,left:t.left+o-r}}return null},css:function(e,t){var n;if(1===arguments.length){if("string"!=typeof e){for(n=0;n<this.length;n++)for(var i in e)this[n].style[i]=e[i];return this}if(this[0])return window.getComputedStyle(this[0],null).getPropertyValue(e)}if(2===arguments.length&&"string"==typeof e){for(n=0;n<this.length;n++)this[n].style[e]=t;return this}return this},each:function(e){for(var t=0;t<this.length;t++)e.call(this[t],t,this[t]);return this},html:function(e){if("undefined"==typeof e)return this[0]?this[0].innerHTML:void 0;for(var t=0;t<this.length;t++)this[t].innerHTML=e;return this},is:function(n){if(!this[0])return!1;var i,r;if("string"==typeof n){var a=this[0];if(a===document)return n===document;if(a===window)return n===window;if(a.matches)return a.matches(n);if(a.webkitMatchesSelector)return a.webkitMatchesSelector(n);if(a.mozMatchesSelector)return a.mozMatchesSelector(n);if(a.msMatchesSelector)return a.msMatchesSelector(n);for(i=t(n),r=0;r<i.length;r++)if(i[r]===this[0])return!0;return!1}if(n===document)return this[0]===document;if(n===window)return this[0]===window;if(n.nodeType||n instanceof e){for(i=n.nodeType?[n]:n,r=0;r<i.length;r++)if(i[r]===this[0])return!0;return!1}return!1},index:function(){if(this[0]){for(var e=this[0],t=0;null!==(e=e.previousSibling);)1===e.nodeType&&t++;return t}return void 0},eq:function(t){if("undefined"==typeof t)return this;var n,i=this.length;return t>i-1?new e([]):0>t?(n=i+t,new e(0>n?[]:[this[n]])):new e([this[t]])},append:function(t){var n,i;for(n=0;n<this.length;n++)if("string"==typeof t){var r=document.createElement("div");for(r.innerHTML=t;r.firstChild;)this[n].appendChild(r.firstChild)}else if(t instanceof e)for(i=0;i<t.length;i++)this[n].appendChild(t[i]);else this[n].appendChild(t);return this},prepend:function(t){var n,i;for(n=0;n<this.length;n++)if("string"==typeof t){var r=document.createElement("div");
for(r.innerHTML=t,i=r.childNodes.length-1;i>=0;i--)this[n].insertBefore(r.childNodes[i],this[n].childNodes[0])}else if(t instanceof e)for(i=0;i<t.length;i++)this[n].insertBefore(t[i],this[n].childNodes[0]);else this[n].insertBefore(t,this[n].childNodes[0]);return this},insertBefore:function(e){for(var n=t(e),i=0;i<this.length;i++)if(1===n.length)n[0].parentNode.insertBefore(this[i],n[0]);else if(n.length>1)for(var r=0;r<n.length;r++)n[r].parentNode.insertBefore(this[i].cloneNode(!0),n[r])},insertAfter:function(e){for(var n=t(e),i=0;i<this.length;i++)if(1===n.length)n[0].parentNode.insertBefore(this[i],n[0].nextSibling);else if(n.length>1)for(var r=0;r<n.length;r++)n[r].parentNode.insertBefore(this[i].cloneNode(!0),n[r].nextSibling)},next:function(n){return new e(this.length>0?n?this[0].nextElementSibling&&t(this[0].nextElementSibling).is(n)?[this[0].nextElementSibling]:[]:this[0].nextElementSibling?[this[0].nextElementSibling]:[]:[])},nextAll:function(n){var i=[],r=this[0];if(!r)return new e([]);for(;r.nextElementSibling;){var a=r.nextElementSibling;n?t(a).is(n)&&i.push(a):i.push(a),r=a}return new e(i)},prev:function(n){return new e(this.length>0?n?this[0].previousElementSibling&&t(this[0].previousElementSibling).is(n)?[this[0].previousElementSibling]:[]:this[0].previousElementSibling?[this[0].previousElementSibling]:[]:[])},prevAll:function(n){var i=[],r=this[0];if(!r)return new e([]);for(;r.previousElementSibling;){var a=r.previousElementSibling;n?t(a).is(n)&&i.push(a):i.push(a),r=a}return new e(i)},parent:function(e){for(var n=[],i=0;i<this.length;i++)e?t(this[i].parentNode).is(e)&&n.push(this[i].parentNode):n.push(this[i].parentNode);return t(t.unique(n))},parents:function(e){for(var n=[],i=0;i<this.length;i++)for(var r=this[i].parentNode;r;)e?t(r).is(e)&&n.push(r):n.push(r),r=r.parentNode;return t(t.unique(n))},find:function(t){for(var n=[],i=0;i<this.length;i++)for(var r=this[i].querySelectorAll(t),a=0;a<r.length;a++)n.push(r[a]);return new e(n)},children:function(n){for(var i=[],r=0;r<this.length;r++)for(var a=this[r].childNodes,o=0;o<a.length;o++)n?1===a[o].nodeType&&t(a[o]).is(n)&&i.push(a[o]):1===a[o].nodeType&&i.push(a[o]);return new e(t.unique(i))},remove:function(){for(var e=0;e<this.length;e++)this[e].parentNode&&this[e].parentNode.removeChild(this[e]);return this},add:function(){var e,n,i=this;for(e=0;e<arguments.length;e++){var r=t(arguments[e]);for(n=0;n<r.length;n++)i[i.length]=r[n],i.length++}return i}},t.fn=e.prototype,t.unique=function(e){for(var t=[],n=0;n<e.length;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t},t}()),r=["jQuery","Zepto","Dom7"],a=0;a<r.length;a++)window[r[a]]&&e(window[r[a]]);var o;o="undefined"==typeof i?window.Dom7||window.Zepto||window.jQuery:i,o&&("transitionEnd"in o.fn||(o.fn.transitionEnd=function(e){function t(a){if(a.target===this)for(e.call(this,a),n=0;n<i.length;n++)r.off(i[n],t)}var n,i=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],r=this;if(e)for(n=0;n<i.length;n++)r.on(i[n],t);return this}),"transform"in o.fn||(o.fn.transform=function(e){for(var t=0;t<this.length;t++){var n=this[t].style;n.webkitTransform=n.MsTransform=n.msTransform=n.MozTransform=n.OTransform=n.transform=e}return this}),"transition"in o.fn||(o.fn.transition=function(e){"string"!=typeof e&&(e+="ms");for(var t=0;t<this.length;t++){var n=this[t].style;n.webkitTransitionDuration=n.MsTransitionDuration=n.msTransitionDuration=n.MozTransitionDuration=n.OTransitionDuration=n.transitionDuration=e}return this})),ionic.views.Swiper=n}(),function(e){"use strict";e.views.Toggle=e.views.View.inherit({initialize:function(t){var n=this;this.el=t.el,this.checkbox=t.checkbox,this.track=t.track,this.handle=t.handle,this.openPercent=-1,this.onChange=t.onChange||function(){},this.triggerThreshold=t.triggerThreshold||20,this.dragStartHandler=function(e){n.dragStart(e)},this.dragHandler=function(e){n.drag(e)},this.holdHandler=function(e){n.hold(e)},this.releaseHandler=function(e){n.release(e)},this.dragStartGesture=e.onGesture("dragstart",this.dragStartHandler,this.el),this.dragGesture=e.onGesture("drag",this.dragHandler,this.el),this.dragHoldGesture=e.onGesture("hold",this.holdHandler,this.el),this.dragReleaseGesture=e.onGesture("release",this.releaseHandler,this.el)},destroy:function(){e.offGesture(this.dragStartGesture,"dragstart",this.dragStartGesture),e.offGesture(this.dragGesture,"drag",this.dragGesture),e.offGesture(this.dragHoldGesture,"hold",this.holdHandler),e.offGesture(this.dragReleaseGesture,"release",this.releaseHandler)},tap:function(){"disabled"!==this.el.getAttribute("disabled")&&this.val(!this.checkbox.checked)},dragStart:function(e){this.checkbox.disabled||(this._dragInfo={width:this.el.offsetWidth,left:this.el.offsetLeft,right:this.el.offsetLeft+this.el.offsetWidth,triggerX:this.el.offsetWidth/2,initialState:this.checkbox.checked},e.gesture.srcEvent.preventDefault(),this.hold(e))},drag:function(t){var n=this;this._dragInfo&&(t.gesture.srcEvent.preventDefault(),e.requestAnimationFrame(function(){if(n._dragInfo){var e=t.gesture.touches[0].pageX-n._dragInfo.left,i=n._dragInfo.width-n.triggerThreshold;n._dragInfo.initialState?e<n.triggerThreshold?n.setOpenPercent(0):e>n._dragInfo.triggerX&&n.setOpenPercent(100):e<n._dragInfo.triggerX?n.setOpenPercent(0):e>i&&n.setOpenPercent(100)}}))},endDrag:function(){this._dragInfo=null},hold:function(){this.el.classList.add("dragging")},release:function(e){this.el.classList.remove("dragging"),this.endDrag(e)},setOpenPercent:function(t){if(this.openPercent<0||t<this.openPercent-3||t>this.openPercent+3)if(this.openPercent=t,0===t)this.val(!1);else if(100===t)this.val(!0);else{var n=Math.round(t/100*this.track.offsetWidth-this.handle.offsetWidth);n=1>n?0:n,this.handle.style[e.CSS.TRANSFORM]="translate3d("+n+"px,0,0)"}},val:function(t){return(t===!0||t===!1)&&(""!==this.handle.style[e.CSS.TRANSFORM]&&(this.handle.style[e.CSS.TRANSFORM]=""),this.checkbox.checked=t,this.openPercent=t?100:0,this.onChange&&this.onChange()),this.checkbox.checked}})}(ionic)}();
/*!
 * ionic.bundle.js is a concatenation of:
 * ionic.js, angular.js, angular-animate.js,
 * angular-sanitize.js, angular-ui-router.js,
 * and ionic-angular.js
 */

/*
 AngularJS v1.5.3
 (c) 2010-2016 Google, Inc. http://angularjs.org
 License: MIT
*/
(function(T,P,u){'use strict';function O(a){return function(){var b=arguments[0],d;d="["+(a?a+":":"")+b+"] http://errors.angularjs.org/1.5.3/"+(a?a+"/":"")+b;for(b=1;b<arguments.length;b++){d=d+(1==b?"?":"&")+"p"+(b-1)+"=";var c=encodeURIComponent,e;e=arguments[b];e="function"==typeof e?e.toString().replace(/ \{[\s\S]*$/,""):"undefined"==typeof e?"undefined":"string"!=typeof e?JSON.stringify(e):e;d+=c(e)}return Error(d)}}function za(a){if(null==a||Ya(a))return!1;if(M(a)||y(a)||H&&a instanceof H)return!0;
var b="length"in Object(a)&&a.length;return R(b)&&(0<=b&&(b-1 in a||a instanceof Array)||"function"==typeof a.item)}function q(a,b,d){var c,e;if(a)if(D(a))for(c in a)"prototype"==c||"length"==c||"name"==c||a.hasOwnProperty&&!a.hasOwnProperty(c)||b.call(d,a[c],c,a);else if(M(a)||za(a)){var f="object"!==typeof a;c=0;for(e=a.length;c<e;c++)(f||c in a)&&b.call(d,a[c],c,a)}else if(a.forEach&&a.forEach!==q)a.forEach(b,d,a);else if(oc(a))for(c in a)b.call(d,a[c],c,a);else if("function"===typeof a.hasOwnProperty)for(c in a)a.hasOwnProperty(c)&&
b.call(d,a[c],c,a);else for(c in a)va.call(a,c)&&b.call(d,a[c],c,a);return a}function pc(a,b,d){for(var c=Object.keys(a).sort(),e=0;e<c.length;e++)b.call(d,a[c[e]],c[e]);return c}function qc(a){return function(b,d){a(d,b)}}function Wd(){return++qb}function Ob(a,b,d){for(var c=a.$$hashKey,e=0,f=b.length;e<f;++e){var g=b[e];if(J(g)||D(g))for(var h=Object.keys(g),k=0,l=h.length;k<l;k++){var m=h[k],n=g[m];d&&J(n)?fa(n)?a[m]=new Date(n.valueOf()):Za(n)?a[m]=new RegExp(n):n.nodeName?a[m]=n.cloneNode(!0):
Pb(n)?a[m]=n.clone():(J(a[m])||(a[m]=M(n)?[]:{}),Ob(a[m],[n],!0)):a[m]=n}}c?a.$$hashKey=c:delete a.$$hashKey;return a}function S(a){return Ob(a,Aa.call(arguments,1),!1)}function Xd(a){return Ob(a,Aa.call(arguments,1),!0)}function Y(a){return parseInt(a,10)}function Qb(a,b){return S(Object.create(a),b)}function E(){}function $a(a){return a}function da(a){return function(){return a}}function rc(a){return D(a.toString)&&a.toString!==ka}function z(a){return"undefined"===typeof a}function A(a){return"undefined"!==
typeof a}function J(a){return null!==a&&"object"===typeof a}function oc(a){return null!==a&&"object"===typeof a&&!sc(a)}function y(a){return"string"===typeof a}function R(a){return"number"===typeof a}function fa(a){return"[object Date]"===ka.call(a)}function D(a){return"function"===typeof a}function Za(a){return"[object RegExp]"===ka.call(a)}function Ya(a){return a&&a.window===a}function ab(a){return a&&a.$evalAsync&&a.$watch}function Oa(a){return"boolean"===typeof a}function Yd(a){return a&&R(a.length)&&
Zd.test(ka.call(a))}function Pb(a){return!(!a||!(a.nodeName||a.prop&&a.attr&&a.find))}function $d(a){var b={};a=a.split(",");var d;for(d=0;d<a.length;d++)b[a[d]]=!0;return b}function oa(a){return N(a.nodeName||a[0]&&a[0].nodeName)}function bb(a,b){var d=a.indexOf(b);0<=d&&a.splice(d,1);return d}function pa(a,b){function d(a,b){var d=b.$$hashKey,e;if(M(a)){e=0;for(var f=a.length;e<f;e++)b.push(c(a[e]))}else if(oc(a))for(e in a)b[e]=c(a[e]);else if(a&&"function"===typeof a.hasOwnProperty)for(e in a)a.hasOwnProperty(e)&&
(b[e]=c(a[e]));else for(e in a)va.call(a,e)&&(b[e]=c(a[e]));d?b.$$hashKey=d:delete b.$$hashKey;return b}function c(a){if(!J(a))return a;var b=f.indexOf(a);if(-1!==b)return g[b];if(Ya(a)||ab(a))throw Ba("cpws");var b=!1,c=e(a);c===u&&(c=M(a)?[]:Object.create(sc(a)),b=!0);f.push(a);g.push(c);return b?d(a,c):c}function e(a){switch(ka.call(a)){case "[object Int8Array]":case "[object Int16Array]":case "[object Int32Array]":case "[object Float32Array]":case "[object Float64Array]":case "[object Uint8Array]":case "[object Uint8ClampedArray]":case "[object Uint16Array]":case "[object Uint32Array]":return new a.constructor(c(a.buffer));
case "[object ArrayBuffer]":if(!a.slice){var b=new ArrayBuffer(a.byteLength);(new Uint8Array(b)).set(new Uint8Array(a));return b}return a.slice(0);case "[object Boolean]":case "[object Number]":case "[object String]":case "[object Date]":return new a.constructor(a.valueOf());case "[object RegExp]":return b=new RegExp(a.source,a.toString().match(/[^\/]*$/)[0]),b.lastIndex=a.lastIndex,b;case "[object Blob]":return new a.constructor([a],{type:a.type})}if(D(a.cloneNode))return a.cloneNode(!0)}var f=[],
g=[];if(b){if(Yd(b)||"[object ArrayBuffer]"===ka.call(b))throw Ba("cpta");if(a===b)throw Ba("cpi");M(b)?b.length=0:q(b,function(a,c){"$$hashKey"!==c&&delete b[c]});f.push(a);g.push(b);return d(a,b)}return c(a)}function ia(a,b){if(M(a)){b=b||[];for(var d=0,c=a.length;d<c;d++)b[d]=a[d]}else if(J(a))for(d in b=b||{},a)if("$"!==d.charAt(0)||"$"!==d.charAt(1))b[d]=a[d];return b||a}function na(a,b){if(a===b)return!0;if(null===a||null===b)return!1;if(a!==a&&b!==b)return!0;var d=typeof a,c;if(d==typeof b&&
"object"==d)if(M(a)){if(!M(b))return!1;if((d=a.length)==b.length){for(c=0;c<d;c++)if(!na(a[c],b[c]))return!1;return!0}}else{if(fa(a))return fa(b)?na(a.getTime(),b.getTime()):!1;if(Za(a))return Za(b)?a.toString()==b.toString():!1;if(ab(a)||ab(b)||Ya(a)||Ya(b)||M(b)||fa(b)||Za(b))return!1;d=V();for(c in a)if("$"!==c.charAt(0)&&!D(a[c])){if(!na(a[c],b[c]))return!1;d[c]=!0}for(c in b)if(!(c in d)&&"$"!==c.charAt(0)&&A(b[c])&&!D(b[c]))return!1;return!0}return!1}function cb(a,b,d){return a.concat(Aa.call(b,
d))}function tc(a,b){var d=2<arguments.length?Aa.call(arguments,2):[];return!D(b)||b instanceof RegExp?b:d.length?function(){return arguments.length?b.apply(a,cb(d,arguments,0)):b.apply(a,d)}:function(){return arguments.length?b.apply(a,arguments):b.call(a)}}function ae(a,b){var d=b;"string"===typeof a&&"$"===a.charAt(0)&&"$"===a.charAt(1)?d=u:Ya(b)?d="$WINDOW":b&&P===b?d="$DOCUMENT":ab(b)&&(d="$SCOPE");return d}function db(a,b){if(z(a))return u;R(b)||(b=b?2:null);return JSON.stringify(a,ae,b)}function uc(a){return y(a)?
JSON.parse(a):a}function vc(a,b){a=a.replace(be,"");var d=Date.parse("Jan 01, 1970 00:00:00 "+a)/6E4;return isNaN(d)?b:d}function Rb(a,b,d){d=d?-1:1;var c=a.getTimezoneOffset();b=vc(b,c);d*=b-c;a=new Date(a.getTime());a.setMinutes(a.getMinutes()+d);return a}function wa(a){a=H(a).clone();try{a.empty()}catch(b){}var d=H("<div>").append(a).html();try{return a[0].nodeType===Pa?N(d):d.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(a,b){return"<"+N(b)})}catch(c){return N(d)}}function wc(a){try{return decodeURIComponent(a)}catch(b){}}
function xc(a){var b={};q((a||"").split("&"),function(a){var c,e,f;a&&(e=a=a.replace(/\+/g,"%20"),c=a.indexOf("="),-1!==c&&(e=a.substring(0,c),f=a.substring(c+1)),e=wc(e),A(e)&&(f=A(f)?wc(f):!0,va.call(b,e)?M(b[e])?b[e].push(f):b[e]=[b[e],f]:b[e]=f))});return b}function Sb(a){var b=[];q(a,function(a,c){M(a)?q(a,function(a){b.push(ja(c,!0)+(!0===a?"":"="+ja(a,!0)))}):b.push(ja(c,!0)+(!0===a?"":"="+ja(a,!0)))});return b.length?b.join("&"):""}function rb(a){return ja(a,!0).replace(/%26/gi,"&").replace(/%3D/gi,
"=").replace(/%2B/gi,"+")}function ja(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,b?"%20":"+")}function ce(a,b){var d,c,e=Qa.length;for(c=0;c<e;++c)if(d=Qa[c]+b,y(d=a.getAttribute(d)))return d;return null}function de(a,b){var d,c,e={};q(Qa,function(b){b+="app";!d&&a.hasAttribute&&a.hasAttribute(b)&&(d=a,c=a.getAttribute(b))});q(Qa,function(b){b+="app";var e;!d&&(e=a.querySelector("["+b.replace(":",
"\\:")+"]"))&&(d=e,c=e.getAttribute(b))});d&&(e.strictDi=null!==ce(d,"strict-di"),b(d,c?[c]:[],e))}function yc(a,b,d){J(d)||(d={});d=S({strictDi:!1},d);var c=function(){a=H(a);if(a.injector()){var c=a[0]===P?"document":wa(a);throw Ba("btstrpd",c.replace(/</,"&lt;").replace(/>/,"&gt;"));}b=b||[];b.unshift(["$provide",function(b){b.value("$rootElement",a)}]);d.debugInfoEnabled&&b.push(["$compileProvider",function(a){a.debugInfoEnabled(!0)}]);b.unshift("ng");c=eb(b,d.strictDi);c.invoke(["$rootScope",
"$rootElement","$compile","$injector",function(a,b,c,d){a.$apply(function(){b.data("$injector",d);c(b)(a)})}]);return c},e=/^NG_ENABLE_DEBUG_INFO!/,f=/^NG_DEFER_BOOTSTRAP!/;T&&e.test(T.name)&&(d.debugInfoEnabled=!0,T.name=T.name.replace(e,""));if(T&&!f.test(T.name))return c();T.name=T.name.replace(f,"");ea.resumeBootstrap=function(a){q(a,function(a){b.push(a)});return c()};D(ea.resumeDeferredBootstrap)&&ea.resumeDeferredBootstrap()}function ee(){T.name="NG_ENABLE_DEBUG_INFO!"+T.name;T.location.reload()}
function fe(a){a=ea.element(a).injector();if(!a)throw Ba("test");return a.get("$$testability")}function zc(a,b){b=b||"_";return a.replace(ge,function(a,c){return(c?b:"")+a.toLowerCase()})}function he(){var a;if(!Ac){var b=sb();($=z(b)?T.jQuery:b?T[b]:u)&&$.fn.on?(H=$,S($.fn,{scope:Ra.scope,isolateScope:Ra.isolateScope,controller:Ra.controller,injector:Ra.injector,inheritedData:Ra.inheritedData}),a=$.cleanData,$.cleanData=function(b){for(var c,e=0,f;null!=(f=b[e]);e++)(c=$._data(f,"events"))&&c.$destroy&&
$(f).triggerHandler("$destroy");a(b)}):H=U;ea.element=H;Ac=!0}}function tb(a,b,d){if(!a)throw Ba("areq",b||"?",d||"required");return a}function Sa(a,b,d){d&&M(a)&&(a=a[a.length-1]);tb(D(a),b,"not a function, got "+(a&&"object"===typeof a?a.constructor.name||"Object":typeof a));return a}function Ta(a,b){if("hasOwnProperty"===a)throw Ba("badname",b);}function Bc(a,b,d){if(!b)return a;b=b.split(".");for(var c,e=a,f=b.length,g=0;g<f;g++)c=b[g],a&&(a=(e=a)[c]);return!d&&D(a)?tc(e,a):a}function ub(a){for(var b=
a[0],d=a[a.length-1],c,e=1;b!==d&&(b=b.nextSibling);e++)if(c||a[e]!==b)c||(c=H(Aa.call(a,0,e))),c.push(b);return c||a}function V(){return Object.create(null)}function ie(a){function b(a,b,c){return a[b]||(a[b]=c())}var d=O("$injector"),c=O("ng");a=b(a,"angular",Object);a.$$minErr=a.$$minErr||O;return b(a,"module",function(){var a={};return function(f,g,h){if("hasOwnProperty"===f)throw c("badname","module");g&&a.hasOwnProperty(f)&&(a[f]=null);return b(a,f,function(){function a(b,d,e,f){f||(f=c);return function(){f[e||
"push"]([b,d,arguments]);return L}}function b(a,d){return function(b,e){e&&D(e)&&(e.$$moduleName=f);c.push([a,d,arguments]);return L}}if(!g)throw d("nomod",f);var c=[],e=[],p=[],F=a("$injector","invoke","push",e),L={_invokeQueue:c,_configBlocks:e,_runBlocks:p,requires:g,name:f,provider:b("$provide","provider"),factory:b("$provide","factory"),service:b("$provide","service"),value:a("$provide","value"),constant:a("$provide","constant","unshift"),decorator:b("$provide","decorator"),animation:b("$animateProvider",
"register"),filter:b("$filterProvider","register"),controller:b("$controllerProvider","register"),directive:b("$compileProvider","directive"),component:b("$compileProvider","component"),config:F,run:function(a){p.push(a);return this}};h&&F(h);return L})}})}function je(a){S(a,{bootstrap:yc,copy:pa,extend:S,merge:Xd,equals:na,element:H,forEach:q,injector:eb,noop:E,bind:tc,toJson:db,fromJson:uc,identity:$a,isUndefined:z,isDefined:A,isString:y,isFunction:D,isObject:J,isNumber:R,isElement:Pb,isArray:M,
version:ke,isDate:fa,lowercase:N,uppercase:vb,callbacks:{counter:0},getTestability:fe,$$minErr:O,$$csp:Ga,reloadWithDebugInfo:ee});Tb=ie(T);Tb("ng",["ngLocale"],["$provide",function(a){a.provider({$$sanitizeUri:le});a.provider("$compile",Cc).directive({a:me,input:Dc,textarea:Dc,form:ne,script:oe,select:pe,style:qe,option:re,ngBind:se,ngBindHtml:te,ngBindTemplate:ue,ngClass:ve,ngClassEven:we,ngClassOdd:xe,ngCloak:ye,ngController:ze,ngForm:Ae,ngHide:Be,ngIf:Ce,ngInclude:De,ngInit:Ee,ngNonBindable:Fe,
ngPluralize:Ge,ngRepeat:He,ngShow:Ie,ngStyle:Je,ngSwitch:Ke,ngSwitchWhen:Le,ngSwitchDefault:Me,ngOptions:Ne,ngTransclude:Oe,ngModel:Pe,ngList:Qe,ngChange:Re,pattern:Ec,ngPattern:Ec,required:Fc,ngRequired:Fc,minlength:Gc,ngMinlength:Gc,maxlength:Hc,ngMaxlength:Hc,ngValue:Se,ngModelOptions:Te}).directive({ngInclude:Ue}).directive(wb).directive(Ic);a.provider({$anchorScroll:Ve,$animate:We,$animateCss:Xe,$$animateJs:Ye,$$animateQueue:Ze,$$AnimateRunner:$e,$$animateAsyncRun:af,$browser:bf,$cacheFactory:cf,
$controller:df,$document:ef,$exceptionHandler:ff,$filter:Jc,$$forceReflow:gf,$interpolate:hf,$interval:jf,$http:kf,$httpParamSerializer:lf,$httpParamSerializerJQLike:mf,$httpBackend:nf,$xhrFactory:of,$location:pf,$log:qf,$parse:rf,$rootScope:sf,$q:tf,$$q:uf,$sce:vf,$sceDelegate:wf,$sniffer:xf,$templateCache:yf,$templateRequest:zf,$$testability:Af,$timeout:Bf,$window:Cf,$$rAF:Df,$$jqLite:Ef,$$HashMap:Ff,$$cookieReader:Gf})}])}function fb(a){return a.replace(Hf,function(a,d,c,e){return e?c.toUpperCase():
c}).replace(If,"Moz$1")}function Kc(a){a=a.nodeType;return 1===a||!a||9===a}function Lc(a,b){var d,c,e=b.createDocumentFragment(),f=[];if(Ub.test(a)){d=d||e.appendChild(b.createElement("div"));c=(Jf.exec(a)||["",""])[1].toLowerCase();c=ha[c]||ha._default;d.innerHTML=c[1]+a.replace(Kf,"<$1></$2>")+c[2];for(c=c[0];c--;)d=d.lastChild;f=cb(f,d.childNodes);d=e.firstChild;d.textContent=""}else f.push(b.createTextNode(a));e.textContent="";e.innerHTML="";q(f,function(a){e.appendChild(a)});return e}function Mc(a,
b){var d=a.parentNode;d&&d.replaceChild(b,a);b.appendChild(a)}function U(a){if(a instanceof U)return a;var b;y(a)&&(a=W(a),b=!0);if(!(this instanceof U)){if(b&&"<"!=a.charAt(0))throw Vb("nosel");return new U(a)}if(b){b=P;var d;a=(d=Lf.exec(a))?[b.createElement(d[1])]:(d=Lc(a,b))?d.childNodes:[]}Nc(this,a)}function Wb(a){return a.cloneNode(!0)}function xb(a,b){b||gb(a);if(a.querySelectorAll)for(var d=a.querySelectorAll("*"),c=0,e=d.length;c<e;c++)gb(d[c])}function Oc(a,b,d,c){if(A(c))throw Vb("offargs");
var e=(c=yb(a))&&c.events,f=c&&c.handle;if(f)if(b){var g=function(b){var c=e[b];A(d)&&bb(c||[],d);A(d)&&c&&0<c.length||(a.removeEventListener(b,f,!1),delete e[b])};q(b.split(" "),function(a){g(a);zb[a]&&g(zb[a])})}else for(b in e)"$destroy"!==b&&a.removeEventListener(b,f,!1),delete e[b]}function gb(a,b){var d=a.ng339,c=d&&hb[d];c&&(b?delete c.data[b]:(c.handle&&(c.events.$destroy&&c.handle({},"$destroy"),Oc(a)),delete hb[d],a.ng339=u))}function yb(a,b){var d=a.ng339,d=d&&hb[d];b&&!d&&(a.ng339=d=++Mf,
d=hb[d]={events:{},data:{},handle:u});return d}function Xb(a,b,d){if(Kc(a)){var c=A(d),e=!c&&b&&!J(b),f=!b;a=(a=yb(a,!e))&&a.data;if(c)a[b]=d;else{if(f)return a;if(e)return a&&a[b];S(a,b)}}}function Ab(a,b){return a.getAttribute?-1<(" "+(a.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+b+" "):!1}function Bb(a,b){b&&a.setAttribute&&q(b.split(" "),function(b){a.setAttribute("class",W((" "+(a.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+W(b)+" "," ")))})}function Cb(a,
b){if(b&&a.setAttribute){var d=(" "+(a.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");q(b.split(" "),function(a){a=W(a);-1===d.indexOf(" "+a+" ")&&(d+=a+" ")});a.setAttribute("class",W(d))}}function Nc(a,b){if(b)if(b.nodeType)a[a.length++]=b;else{var d=b.length;if("number"===typeof d&&b.window!==b){if(d)for(var c=0;c<d;c++)a[a.length++]=b[c]}else a[a.length++]=b}}function Pc(a,b){return Db(a,"$"+(b||"ngController")+"Controller")}function Db(a,b,d){9==a.nodeType&&(a=a.documentElement);for(b=
M(b)?b:[b];a;){for(var c=0,e=b.length;c<e;c++)if(A(d=H.data(a,b[c])))return d;a=a.parentNode||11===a.nodeType&&a.host}}function Qc(a){for(xb(a,!0);a.firstChild;)a.removeChild(a.firstChild)}function Yb(a,b){b||xb(a);var d=a.parentNode;d&&d.removeChild(a)}function Nf(a,b){b=b||T;if("complete"===b.document.readyState)b.setTimeout(a);else H(b).on("load",a)}function Rc(a,b){var d=Eb[b.toLowerCase()];return d&&Sc[oa(a)]&&d}function Of(a,b){var d=function(c,d){c.isDefaultPrevented=function(){return c.defaultPrevented};
var f=b[d||c.type],g=f?f.length:0;if(g){if(z(c.immediatePropagationStopped)){var h=c.stopImmediatePropagation;c.stopImmediatePropagation=function(){c.immediatePropagationStopped=!0;c.stopPropagation&&c.stopPropagation();h&&h.call(c)}}c.isImmediatePropagationStopped=function(){return!0===c.immediatePropagationStopped};var k=f.specialHandlerWrapper||Pf;1<g&&(f=ia(f));for(var l=0;l<g;l++)c.isImmediatePropagationStopped()||k(a,c,f[l])}};d.elem=a;return d}function Pf(a,b,d){d.call(a,b)}function Qf(a,b,
d){var c=b.relatedTarget;c&&(c===a||Rf.call(a,c))||d.call(a,b)}function Ef(){this.$get=function(){return S(U,{hasClass:function(a,b){a.attr&&(a=a[0]);return Ab(a,b)},addClass:function(a,b){a.attr&&(a=a[0]);return Cb(a,b)},removeClass:function(a,b){a.attr&&(a=a[0]);return Bb(a,b)}})}}function Ha(a,b){var d=a&&a.$$hashKey;if(d)return"function"===typeof d&&(d=a.$$hashKey()),d;d=typeof a;return d="function"==d||"object"==d&&null!==a?a.$$hashKey=d+":"+(b||Wd)():d+":"+a}function Ua(a,b){if(b){var d=0;this.nextUid=
function(){return++d}}q(a,this.put,this)}function Tc(a){a=a.toString().replace(Sf,"");return a.match(Tf)||a.match(Uf)}function Vf(a){return(a=Tc(a))?"function("+(a[1]||"").replace(/[\s\r\n]+/," ")+")":"fn"}function eb(a,b){function d(a){return function(b,c){if(J(b))q(b,qc(a));else return a(b,c)}}function c(a,b){Ta(a,"service");if(D(b)||M(b))b=p.instantiate(b);if(!b.$get)throw Ia("pget",a);return n[a+"Provider"]=b}function e(a,b){return function(){var c=x.invoke(b,this);if(z(c))throw Ia("undef",a);
return c}}function f(a,b,d){return c(a,{$get:!1!==d?e(a,b):b})}function g(a){tb(z(a)||M(a),"modulesToLoad","not an array");var b=[],c;q(a,function(a){function d(a){var b,c;b=0;for(c=a.length;b<c;b++){var e=a[b],f=p.get(e[0]);f[e[1]].apply(f,e[2])}}if(!m.get(a)){m.put(a,!0);try{y(a)?(c=Tb(a),b=b.concat(g(c.requires)).concat(c._runBlocks),d(c._invokeQueue),d(c._configBlocks)):D(a)?b.push(p.invoke(a)):M(a)?b.push(p.invoke(a)):Sa(a,"module")}catch(e){throw M(a)&&(a=a[a.length-1]),e.message&&e.stack&&
-1==e.stack.indexOf(e.message)&&(e=e.message+"\n"+e.stack),Ia("modulerr",a,e.stack||e.message||e);}}});return b}function h(a,c){function d(b,e){if(a.hasOwnProperty(b)){if(a[b]===k)throw Ia("cdep",b+" <- "+l.join(" <- "));return a[b]}try{return l.unshift(b),a[b]=k,a[b]=c(b,e)}catch(f){throw a[b]===k&&delete a[b],f;}finally{l.shift()}}function e(a,c,f){var g=[];a=eb.$$annotate(a,b,f);for(var h=0,k=a.length;h<k;h++){var l=a[h];if("string"!==typeof l)throw Ia("itkn",l);g.push(c&&c.hasOwnProperty(l)?c[l]:
d(l,f))}return g}return{invoke:function(a,b,c,d){"string"===typeof c&&(d=c,c=null);c=e(a,c,d);M(a)&&(a=a[a.length-1]);d=11>=Da?!1:"function"===typeof a&&/^(?:class\s|constructor\()/.test(Function.prototype.toString.call(a));return d?(c.unshift(null),new (Function.prototype.bind.apply(a,c))):a.apply(b,c)},instantiate:function(a,b,c){var d=M(a)?a[a.length-1]:a;a=e(a,b,c);a.unshift(null);return new (Function.prototype.bind.apply(d,a))},get:d,annotate:eb.$$annotate,has:function(b){return n.hasOwnProperty(b+
"Provider")||a.hasOwnProperty(b)}}}b=!0===b;var k={},l=[],m=new Ua([],!0),n={$provide:{provider:d(c),factory:d(f),service:d(function(a,b){return f(a,["$injector",function(a){return a.instantiate(b)}])}),value:d(function(a,b){return f(a,da(b),!1)}),constant:d(function(a,b){Ta(a,"constant");n[a]=b;F[a]=b}),decorator:function(a,b){var c=p.get(a+"Provider"),d=c.$get;c.$get=function(){var a=x.invoke(d,c);return x.invoke(b,null,{$delegate:a})}}}},p=n.$injector=h(n,function(a,b){ea.isString(b)&&l.push(b);
throw Ia("unpr",l.join(" <- "));}),F={},L=h(F,function(a,b){var c=p.get(a+"Provider",b);return x.invoke(c.$get,c,u,a)}),x=L;n.$injectorProvider={$get:da(L)};var r=g(a),x=L.get("$injector");x.strictDi=b;q(r,function(a){a&&x.invoke(a)});return x}function Ve(){var a=!0;this.disableAutoScrolling=function(){a=!1};this.$get=["$window","$location","$rootScope",function(b,d,c){function e(a){var b=null;Array.prototype.some.call(a,function(a){if("a"===oa(a))return b=a,!0});return b}function f(a){if(a){a.scrollIntoView();
var c;c=g.yOffset;D(c)?c=c():Pb(c)?(c=c[0],c="fixed"!==b.getComputedStyle(c).position?0:c.getBoundingClientRect().bottom):R(c)||(c=0);c&&(a=a.getBoundingClientRect().top,b.scrollBy(0,a-c))}else b.scrollTo(0,0)}function g(a){a=y(a)?a:d.hash();var b;a?(b=h.getElementById(a))?f(b):(b=e(h.getElementsByName(a)))?f(b):"top"===a&&f(null):f(null)}var h=b.document;a&&c.$watch(function(){return d.hash()},function(a,b){a===b&&""===a||Nf(function(){c.$evalAsync(g)})});return g}]}function ib(a,b){if(!a&&!b)return"";
if(!a)return b;if(!b)return a;M(a)&&(a=a.join(" "));M(b)&&(b=b.join(" "));return a+" "+b}function Wf(a){y(a)&&(a=a.split(" "));var b=V();q(a,function(a){a.length&&(b[a]=!0)});return b}function Ja(a){return J(a)?a:{}}function Xf(a,b,d,c){function e(a){try{a.apply(null,Aa.call(arguments,1))}finally{if(L--,0===L)for(;x.length;)try{x.pop()()}catch(b){d.error(b)}}}function f(){t=null;g();h()}function g(){r=G();r=z(r)?null:r;na(r,I)&&(r=I);I=r}function h(){if(v!==k.url()||w!==r)v=k.url(),w=r,q(C,function(a){a(k.url(),
r)})}var k=this,l=a.location,m=a.history,n=a.setTimeout,p=a.clearTimeout,F={};k.isMock=!1;var L=0,x=[];k.$$completeOutstandingRequest=e;k.$$incOutstandingRequestCount=function(){L++};k.notifyWhenNoOutstandingRequests=function(a){0===L?a():x.push(a)};var r,w,v=l.href,Q=b.find("base"),t=null,G=c.history?function(){try{return m.state}catch(a){}}:E;g();w=r;k.url=function(b,d,e){z(e)&&(e=null);l!==a.location&&(l=a.location);m!==a.history&&(m=a.history);if(b){var f=w===e;if(v===b&&(!c.history||f))return k;
var h=v&&Ka(v)===Ka(b);v=b;w=e;if(!c.history||h&&f){if(!h||t)t=b;d?l.replace(b):h?(d=l,e=b.indexOf("#"),e=-1===e?"":b.substr(e),d.hash=e):l.href=b;l.href!==b&&(t=b)}else m[d?"replaceState":"pushState"](e,"",b),g(),w=r;return k}return t||l.href.replace(/%27/g,"'")};k.state=function(){return r};var C=[],K=!1,I=null;k.onUrlChange=function(b){if(!K){if(c.history)H(a).on("popstate",f);H(a).on("hashchange",f);K=!0}C.push(b);return b};k.$$applicationDestroyed=function(){H(a).off("hashchange popstate",f)};
k.$$checkUrlChange=h;k.baseHref=function(){var a=Q.attr("href");return a?a.replace(/^(https?\:)?\/\/[^\/]*/,""):""};k.defer=function(a,b){var c;L++;c=n(function(){delete F[c];e(a)},b||0);F[c]=!0;return c};k.defer.cancel=function(a){return F[a]?(delete F[a],p(a),e(E),!0):!1}}function bf(){this.$get=["$window","$log","$sniffer","$document",function(a,b,d,c){return new Xf(a,c,b,d)}]}function cf(){this.$get=function(){function a(a,c){function e(a){a!=n&&(p?p==a&&(p=a.n):p=a,f(a.n,a.p),f(a,n),n=a,n.n=
null)}function f(a,b){a!=b&&(a&&(a.p=b),b&&(b.n=a))}if(a in b)throw O("$cacheFactory")("iid",a);var g=0,h=S({},c,{id:a}),k=V(),l=c&&c.capacity||Number.MAX_VALUE,m=V(),n=null,p=null;return b[a]={put:function(a,b){if(!z(b)){if(l<Number.MAX_VALUE){var c=m[a]||(m[a]={key:a});e(c)}a in k||g++;k[a]=b;g>l&&this.remove(p.key);return b}},get:function(a){if(l<Number.MAX_VALUE){var b=m[a];if(!b)return;e(b)}return k[a]},remove:function(a){if(l<Number.MAX_VALUE){var b=m[a];if(!b)return;b==n&&(n=b.p);b==p&&(p=
b.n);f(b.n,b.p);delete m[a]}a in k&&(delete k[a],g--)},removeAll:function(){k=V();g=0;m=V();n=p=null},destroy:function(){m=h=k=null;delete b[a]},info:function(){return S({},h,{size:g})}}}var b={};a.info=function(){var a={};q(b,function(b,e){a[e]=b.info()});return a};a.get=function(a){return b[a]};return a}}function yf(){this.$get=["$cacheFactory",function(a){return a("templates")}]}function Cc(a,b){function d(a,b,c){var d=/^\s*([@&<]|=(\*?))(\??)\s*(\w*)\s*$/,e={};q(a,function(a,f){if(a in m)e[f]=
m[a];else{var g=a.match(d);if(!g)throw ga("iscp",b,f,a,c?"controller bindings definition":"isolate scope definition");e[f]={mode:g[1][0],collection:"*"===g[2],optional:"?"===g[3],attrName:g[4]||f};g[4]&&(m[a]=e[f])}});return e}function c(a){var b=a.charAt(0);if(!b||b!==N(b))throw ga("baddir",a);if(a!==a.trim())throw ga("baddir",a);}var e={},f=/^\s*directive\:\s*([\w\-]+)\s+(.*)$/,g=/(([\w\-]+)(?:\:([^;]+))?;?)/,h=$d("ngSrc,ngSrcset,src,srcset"),k=/^(?:(\^\^?)?(\?)?(\^\^?)?)?/,l=/^(on[a-z]+|formaction)$/,
m=V();this.directive=function L(b,d){Ta(b,"directive");y(b)?(c(b),tb(d,"directiveFactory"),e.hasOwnProperty(b)||(e[b]=[],a.factory(b+"Directive",["$injector","$exceptionHandler",function(a,c){var d=[];q(e[b],function(e,f){try{var g=a.invoke(e);D(g)?g={compile:da(g)}:!g.compile&&g.link&&(g.compile=da(g.link));g.priority=g.priority||0;g.index=f;g.name=g.name||b;g.require=g.require||g.controller&&g.name;g.restrict=g.restrict||"EA";g.$$moduleName=e.$$moduleName;d.push(g)}catch(h){c(h)}});return d}])),
e[b].push(d)):q(b,qc(L));return this};this.component=function(a,b){function c(a){function e(b){return D(b)||M(b)?function(c,d){return a.invoke(b,this,{$element:c,$attrs:d})}:b}var f=b.template||b.templateUrl?b.template:"";return{controller:d,controllerAs:Uc(b.controller)||b.controllerAs||"$ctrl",template:e(f),templateUrl:e(b.templateUrl),transclude:b.transclude,scope:{},bindToController:b.bindings||{},restrict:"E",require:b.require}}var d=b.controller||E;q(b,function(a,b){"$"===b.charAt(0)&&(c[b]=
a,d[b]=a)});c.$inject=["$injector"];return this.directive(a,c)};this.aHrefSanitizationWhitelist=function(a){return A(a)?(b.aHrefSanitizationWhitelist(a),this):b.aHrefSanitizationWhitelist()};this.imgSrcSanitizationWhitelist=function(a){return A(a)?(b.imgSrcSanitizationWhitelist(a),this):b.imgSrcSanitizationWhitelist()};var n=!0;this.debugInfoEnabled=function(a){return A(a)?(n=a,this):n};var p=10;this.onChangesTtl=function(a){return arguments.length?(p=a,this):p};this.$get=["$injector","$interpolate",
"$exceptionHandler","$templateRequest","$parse","$controller","$rootScope","$sce","$animate","$$sanitizeUri",function(a,b,c,m,v,Q,t,G,C,K){function I(){try{if(!--pa)throw $=u,ga("infchng",p);t.$apply(function(){for(var a=0,b=$.length;a<b;++a)$[a]();$=u})}finally{pa++}}function qa(a,b){if(b){var c=Object.keys(b),d,e,f;d=0;for(e=c.length;d<e;d++)f=c[d],this[f]=b[f]}else this.$attr={};this.$$element=a}function Ca(a,b,c){la.innerHTML="<span "+b+">";b=la.firstChild.attributes;var d=b[0];b.removeNamedItem(d.name);
d.value=c;a.attributes.setNamedItem(d)}function B(a,b){try{a.addClass(b)}catch(c){}}function ba(a,b,c,d,e){a instanceof H||(a=H(a));for(var f=/\S+/,g=0,h=a.length;g<h;g++){var k=a[g];k.nodeType===Pa&&k.nodeValue.match(f)&&Mc(k,a[g]=P.createElement("span"))}var l=xa(a,b,a,c,d,e);ba.$$addScopeClass(a);var m=null;return function(b,c,d){tb(b,"scope");e&&e.needsNewScope&&(b=b.$parent.$new());d=d||{};var f=d.parentBoundTranscludeFn,g=d.transcludeControllers;d=d.futureParentElement;f&&f.$$boundTransclude&&
(f=f.$$boundTransclude);m||(m=(d=d&&d[0])?"foreignobject"!==oa(d)&&ka.call(d).match(/SVG/)?"svg":"html":"html");d="html"!==m?H(ca(m,H("<div>").append(a).html())):c?Ra.clone.call(a):a;if(g)for(var h in g)d.data("$"+h+"Controller",g[h].instance);ba.$$addScopeInfo(d,b);c&&c(d,b);l&&l(b,d,d,f);return d}}function xa(a,b,c,d,e,f){function g(a,c,d,e){var f,k,l,m,n,p,G;if(r)for(G=Array(c.length),m=0;m<h.length;m+=3)f=h[m],G[f]=c[f];else G=c;m=0;for(n=h.length;m<n;)k=G[h[m++]],c=h[m++],f=h[m++],c?(c.scope?
(l=a.$new(),ba.$$addScopeInfo(H(k),l)):l=a,p=c.transcludeOnThisElement?s(a,c.transclude,e):!c.templateOnThisElement&&e?e:!e&&b?s(a,b):null,c(f,l,k,d,p)):f&&f(a,k.childNodes,u,e)}for(var h=[],k,l,m,n,r,p=0;p<a.length;p++){k=new qa;l=A(a[p],[],k,0===p?d:u,e);(f=l.length?ra(l,a[p],k,b,c,null,[],[],f):null)&&f.scope&&ba.$$addScopeClass(k.$$element);k=f&&f.terminal||!(m=a[p].childNodes)||!m.length?null:xa(m,f?(f.transcludeOnThisElement||!f.templateOnThisElement)&&f.transclude:b);if(f||k)h.push(p,f,k),
n=!0,r=r||f;f=null}return n?g:null}function s(a,b,c){function d(e,f,g,h,k){e||(e=a.$new(!1,k),e.$$transcluded=!0);return b(e,f,{parentBoundTranscludeFn:c,transcludeControllers:g,futureParentElement:h})}var e=d.$$slots=V(),f;for(f in b.$$slots)e[f]=b.$$slots[f]?s(a,b.$$slots[f],c):null;return d}function A(a,b,c,d,e){var h=c.$attr,k;switch(a.nodeType){case 1:Fa(b,ya(oa(a)),"E",d,e);for(var l,m,n,r=a.attributes,p=0,G=r&&r.length;p<G;p++){var v=!1,C=!1;l=r[p];k=l.name;m=W(l.value);l=ya(k);if(n=za.test(l))k=
k.replace(Vc,"").substr(8).replace(/_(.)/g,function(a,b){return b.toUpperCase()});(l=l.match(Ba))&&R(l[1])&&(v=k,C=k.substr(0,k.length-5)+"end",k=k.substr(0,k.length-6));l=ya(k.toLowerCase());h[l]=k;if(n||!c.hasOwnProperty(l))c[l]=m,Rc(a,l)&&(c[l]=!0);fa(a,b,m,l,n);Fa(b,l,"A",d,e,v,C)}a=a.className;J(a)&&(a=a.animVal);if(y(a)&&""!==a)for(;k=g.exec(a);)l=ya(k[2]),Fa(b,l,"C",d,e)&&(c[l]=W(k[3])),a=a.substr(k.index+k[0].length);break;case Pa:if(11===Da)for(;a.parentNode&&a.nextSibling&&a.nextSibling.nodeType===
Pa;)a.nodeValue+=a.nextSibling.nodeValue,a.parentNode.removeChild(a.nextSibling);Y(b,a.nodeValue);break;case 8:try{if(k=f.exec(a.nodeValue))l=ya(k[1]),Fa(b,l,"M",d,e)&&(c[l]=W(k[2]))}catch(w){}}b.sort(Z);return b}function Wc(a,b,c){var d=[],e=0;if(b&&a.hasAttribute&&a.hasAttribute(b)){do{if(!a)throw ga("uterdir",b,c);1==a.nodeType&&(a.hasAttribute(b)&&e++,a.hasAttribute(c)&&e--);d.push(a);a=a.nextSibling}while(0<e)}else d.push(a);return H(d)}function O(a,b,c){return function(d,e,f,g,h){e=Wc(e[0],
b,c);return a(d,e,f,g,h)}}function Zb(a,b,c,d,e,f){var g;return a?ba(b,c,d,e,f):function(){g||(g=ba(b,c,d,e,f),b=c=f=null);return g.apply(this,arguments)}}function ra(a,b,d,e,f,g,h,k,l){function m(a,b,c,d){if(a){c&&(a=O(a,c,d));a.require=B.require;a.directiveName=L;if(C===B||B.$$isolateScope)a=ia(a,{isolateScope:!0});h.push(a)}if(b){c&&(b=O(b,c,d));b.require=B.require;b.directiveName=L;if(C===B||B.$$isolateScope)b=ia(b,{isolateScope:!0});k.push(b)}}function n(a,c,e,f,g){function l(a,b,c,d){var e;
ab(a)||(d=c,c=b,b=a,a=u);Ca&&(e=K);c||(c=Ca?t.parent():t);if(d){var f=g.$$slots[d];if(f)return f(a,b,e,c,s);if(z(f))throw ga("noslot",d,wa(t));}else return g(a,b,e,c,s)}var m,r,p,B,I,K,x,t;b===e?(f=d,t=d.$$element):(t=H(e),f=new qa(t,d));I=c;C?B=c.$new(!0):G&&(I=c.$parent);g&&(x=l,x.$$boundTransclude=g,x.isSlotFilled=function(a){return!!g.$$slots[a]});v&&(K=T(t,f,x,v,B,c,C));C&&(ba.$$addScopeInfo(t,B,!0,!(w&&(w===C||w===C.$$originalDirective))),ba.$$addScopeClass(t,!0),B.$$isolateBindings=C.$$isolateBindings,
(p=ha(c,f,B,B.$$isolateBindings,C))&&B.$on("$destroy",p));for(r in K){p=v[r];var Va=K[r],Q=p.$$bindings.bindToController;Va.identifier&&Q&&(m=ha(I,f,Va.instance,Q,p));var L=Va();L!==Va.instance&&(Va.instance=L,t.data("$"+p.name+"Controller",L),m&&m(),m=ha(I,f,Va.instance,Q,p))}q(v,function(a,b){var c=a.require;a.bindToController&&!M(c)&&J(c)&&S(K[b].instance,jb(b,c,t,K))});q(K,function(a){var b=a.instance;D(b.$onInit)&&b.$onInit();D(b.$onDestroy)&&I.$on("$destroy",function(){b.$onDestroy()})});m=
0;for(r=h.length;m<r;m++)p=h[m],ja(p,p.isolateScope?B:c,t,f,p.require&&jb(p.directiveName,p.require,t,K),x);var s=c;C&&(C.template||null===C.templateUrl)&&(s=B);a&&a(s,e.childNodes,u,g);for(m=k.length-1;0<=m;m--)p=k[m],ja(p,p.isolateScope?B:c,t,f,p.require&&jb(p.directiveName,p.require,t,K),x);q(K,function(a){a=a.instance;D(a.$postLink)&&a.$postLink()})}l=l||{};for(var p=-Number.MAX_VALUE,G=l.newScopeDirective,v=l.controllerDirectives,C=l.newIsolateScopeDirective,w=l.templateDirective,I=l.nonTlbTranscludeDirective,
K=!1,x=!1,Ca=l.hasElementTranscludeDirective,t=d.$$element=H(b),B,L,Q,s=e,xa,Ea=!1,E=!1,y,ra=0,N=a.length;ra<N;ra++){B=a[ra];var R=B.$$start,Fa=B.$$end;R&&(t=Wc(b,R,Fa));Q=u;if(p>B.priority)break;if(y=B.scope)B.templateUrl||(J(y)?(X("new/isolated scope",C||G,B,t),C=B):X("new/isolated scope",C,B,t)),G=G||B;L=B.name;if(!Ea&&(B.replace&&(B.templateUrl||B.template)||B.transclude&&!B.$$tlb)){for(y=ra+1;Ea=a[y++];)if(Ea.transclude&&!Ea.$$tlb||Ea.replace&&(Ea.templateUrl||Ea.template)){E=!0;break}Ea=!0}!B.templateUrl&&
B.controller&&(y=B.controller,v=v||V(),X("'"+L+"' controller",v[L],B,t),v[L]=B);if(y=B.transclude)if(K=!0,B.$$tlb||(X("transclusion",I,B,t),I=B),"element"==y)Ca=!0,p=B.priority,Q=t,t=d.$$element=H(ba.$$createComment(L,d[L])),b=t[0],da(f,Aa.call(Q,0),b),Q[0].$$parentNode=Q[0].parentNode,s=Zb(E,Q,e,p,g&&g.name,{nonTlbTranscludeDirective:I});else{var P=V();Q=H(Wb(b)).contents();if(J(y)){Q=[];var Z=V(),Y=V();q(y,function(a,b){var c="?"===a.charAt(0);a=c?a.substring(1):a;Z[a]=b;P[b]=null;Y[b]=c});q(t.contents(),
function(a){var b=Z[ya(oa(a))];b?(Y[b]=!0,P[b]=P[b]||[],P[b].push(a)):Q.push(a)});q(Y,function(a,b){if(!a)throw ga("reqslot",b);});for(var $ in P)P[$]&&(P[$]=Zb(E,P[$],e))}t.empty();s=Zb(E,Q,e,u,u,{needsNewScope:B.$$isolateScope||B.$$newScope});s.$$slots=P}if(B.template)if(x=!0,X("template",w,B,t),w=B,y=D(B.template)?B.template(t,d):B.template,y=ua(y),B.replace){g=B;Q=Ub.test(y)?Xc(ca(B.templateNamespace,W(y))):[];b=Q[0];if(1!=Q.length||1!==b.nodeType)throw ga("tplrt",L,"");da(f,t,b);N={$attr:{}};
y=A(b,[],N);var ea=a.splice(ra+1,a.length-(ra+1));(C||G)&&Yc(y,C,G);a=a.concat(y).concat(ea);U(d,N);N=a.length}else t.html(y);if(B.templateUrl)x=!0,X("template",w,B,t),w=B,B.replace&&(g=B),n=aa(a.splice(ra,a.length-ra),t,d,f,K&&s,h,k,{controllerDirectives:v,newScopeDirective:G!==B&&G,newIsolateScopeDirective:C,templateDirective:w,nonTlbTranscludeDirective:I}),N=a.length;else if(B.compile)try{xa=B.compile(t,d,s),D(xa)?m(null,xa,R,Fa):xa&&m(xa.pre,xa.post,R,Fa)}catch(fa){c(fa,wa(t))}B.terminal&&(n.terminal=
!0,p=Math.max(p,B.priority))}n.scope=G&&!0===G.scope;n.transcludeOnThisElement=K;n.templateOnThisElement=x;n.transclude=s;l.hasElementTranscludeDirective=Ca;return n}function jb(a,b,c,d){var e;if(y(b)){var f=b.match(k);b=b.substring(f[0].length);var g=f[1]||f[3],f="?"===f[2];"^^"===g?c=c.parent():e=(e=d&&d[b])&&e.instance;if(!e){var h="$"+b+"Controller";e=g?c.inheritedData(h):c.data(h)}if(!e&&!f)throw ga("ctreq",b,a);}else if(M(b))for(e=[],g=0,f=b.length;g<f;g++)e[g]=jb(a,b[g],c,d);else J(b)&&(e=
{},q(b,function(b,f){e[f]=jb(a,b,c,d)}));return e||null}function T(a,b,c,d,e,f,g){var h=V(),k;for(k in d){var l=d[k],m={$scope:l===g||l.$$isolateScope?e:f,$element:a,$attrs:b,$transclude:c},n=l.controller;"@"==n&&(n=b[l.name]);m=Q(n,m,!0,l.controllerAs);h[l.name]=m;a.data("$"+l.name+"Controller",m.instance)}return h}function Yc(a,b,c){for(var d=0,e=a.length;d<e;d++)a[d]=Qb(a[d],{$$isolateScope:b,$$newScope:c})}function Fa(b,f,g,h,k,l,m){if(f===k)return null;k=null;if(e.hasOwnProperty(f)){var n;f=
a.get(f+"Directive");for(var p=0,G=f.length;p<G;p++)try{if(n=f[p],(z(h)||h>n.priority)&&-1!=n.restrict.indexOf(g)){l&&(n=Qb(n,{$$start:l,$$end:m}));if(!n.$$bindings){var v=n,C=n,w=n.name,B={isolateScope:null,bindToController:null};J(C.scope)&&(!0===C.bindToController?(B.bindToController=d(C.scope,w,!0),B.isolateScope={}):B.isolateScope=d(C.scope,w,!1));J(C.bindToController)&&(B.bindToController=d(C.bindToController,w,!0));if(J(B.bindToController)){var I=C.controller,K=C.controllerAs;if(!I)throw ga("noctrl",
w);if(!Uc(I,K))throw ga("noident",w);}var x=v.$$bindings=B;J(x.isolateScope)&&(n.$$isolateBindings=x.isolateScope)}b.push(n);k=n}}catch(t){c(t)}}return k}function R(b){if(e.hasOwnProperty(b))for(var c=a.get(b+"Directive"),d=0,f=c.length;d<f;d++)if(b=c[d],b.multiElement)return!0;return!1}function U(a,b){var c=b.$attr,d=a.$attr,e=a.$$element;q(a,function(d,e){"$"!=e.charAt(0)&&(b[e]&&b[e]!==d&&(d+=("style"===e?";":" ")+b[e]),a.$set(e,d,!0,c[e]))});q(b,function(b,f){"class"==f?(B(e,b),a["class"]=(a["class"]?
a["class"]+" ":"")+b):"style"==f?(e.attr("style",e.attr("style")+";"+b),a.style=(a.style?a.style+";":"")+b):"$"==f.charAt(0)||a.hasOwnProperty(f)||(a[f]=b,d[f]=c[f])})}function aa(a,b,c,d,e,f,g,h){var k=[],l,n,p=b[0],r=a.shift(),G=Qb(r,{templateUrl:null,transclude:null,replace:null,$$originalDirective:r}),v=D(r.templateUrl)?r.templateUrl(b,c):r.templateUrl,C=r.templateNamespace;b.empty();m(v).then(function(m){var w,I;m=ua(m);if(r.replace){m=Ub.test(m)?Xc(ca(C,W(m))):[];w=m[0];if(1!=m.length||1!==
w.nodeType)throw ga("tplrt",r.name,v);m={$attr:{}};da(d,b,w);var K=A(w,[],m);J(r.scope)&&Yc(K,!0);a=K.concat(a);U(c,m)}else w=p,b.html(m);a.unshift(G);l=ra(a,w,c,e,b,r,f,g,h);q(d,function(a,c){a==w&&(d[c]=b[0])});for(n=xa(b[0].childNodes,e);k.length;){m=k.shift();I=k.shift();var x=k.shift(),t=k.shift(),K=b[0];if(!m.$$destroyed){if(I!==p){var qa=I.className;h.hasElementTranscludeDirective&&r.replace||(K=Wb(w));da(x,H(I),K);B(H(K),qa)}I=l.transcludeOnThisElement?s(m,l.transclude,t):t;l(n,m,K,d,I)}}k=
null});return function(a,b,c,d,e){a=e;b.$$destroyed||(k?k.push(b,c,d,a):(l.transcludeOnThisElement&&(a=s(b,l.transclude,e)),l(n,b,c,d,a)))}}function Z(a,b){var c=b.priority-a.priority;return 0!==c?c:a.name!==b.name?a.name<b.name?-1:1:a.index-b.index}function X(a,b,c,d){function e(a){return a?" (module: "+a+")":""}if(b)throw ga("multidir",b.name,e(b.$$moduleName),c.name,e(c.$$moduleName),a,wa(d));}function Y(a,c){var d=b(c,!0);d&&a.push({priority:0,compile:function(a){a=a.parent();var b=!!a.length;
b&&ba.$$addBindingClass(a);return function(a,c){var e=c.parent();b||ba.$$addBindingClass(e);ba.$$addBindingInfo(e,d.expressions);a.$watch(d,function(a){c[0].nodeValue=a})}}})}function ca(a,b){a=N(a||"html");switch(a){case "svg":case "math":var c=P.createElement("div");c.innerHTML="<"+a+">"+b+"</"+a+">";return c.childNodes[0].childNodes;default:return b}}function ea(a,b){if("srcdoc"==b)return G.HTML;var c=oa(a);if("xlinkHref"==b||"form"==c&&"action"==b||"img"!=c&&("src"==b||"ngSrc"==b))return G.RESOURCE_URL}
function fa(a,c,d,e,f){var g=ea(a,e);f=h[e]||f;var k=b(d,!0,g,f);if(k){if("multiple"===e&&"select"===oa(a))throw ga("selmulti",wa(a));c.push({priority:100,compile:function(){return{pre:function(a,c,h){c=h.$$observers||(h.$$observers=V());if(l.test(e))throw ga("nodomevents");var m=h[e];m!==d&&(k=m&&b(m,!0,g,f),d=m);k&&(h[e]=k(a),(c[e]||(c[e]=[])).$$inter=!0,(h.$$observers&&h.$$observers[e].$$scope||a).$watch(k,function(a,b){"class"===e&&a!=b?h.$updateClass(a,b):h.$set(e,a)}))}}}})}}function da(a,b,
c){var d=b[0],e=b.length,f=d.parentNode,g,h;if(a)for(g=0,h=a.length;g<h;g++)if(a[g]==d){a[g++]=c;h=g+e-1;for(var k=a.length;g<k;g++,h++)h<k?a[g]=a[h]:delete a[g];a.length-=e-1;a.context===d&&(a.context=c);break}f&&f.replaceChild(c,d);a=P.createDocumentFragment();for(g=0;g<e;g++)a.appendChild(b[g]);H.hasData(d)&&(H.data(c,H.data(d)),H(d).off("$destroy"));H.cleanData(a.querySelectorAll("*"));for(g=1;g<e;g++)delete b[g];b[0]=c;b.length=1}function ia(a,b){return S(function(){return a.apply(null,arguments)},
a,b)}function ja(a,b,d,e,f,g){try{a(b,d,e,f,g)}catch(h){c(h,wa(d))}}function ha(a,c,d,e,f){function g(b,c,e){D(d.$onChanges)&&c!==e&&($||(a.$$postDigest(I),$=[]),l||(l={},$.push(h)),l[b]&&(e=l[b].previousValue),l[b]={previousValue:e,currentValue:c})}function h(){d.$onChanges(l);l=u}var k=[],l;q(e,function(e,h){var l=e.attrName,m=e.optional,n,r,p,G;switch(e.mode){case "@":m||va.call(c,l)||(d[h]=c[l]=void 0);c.$observe(l,function(a){y(a)&&(g(h,a,d[h]),d[h]=a)});c.$$observers[l].$$scope=a;n=c[l];y(n)?
d[h]=b(n)(a):Oa(n)&&(d[h]=n);break;case "=":if(!va.call(c,l)){if(m)break;c[l]=void 0}if(m&&!c[l])break;r=v(c[l]);G=r.literal?na:function(a,b){return a===b||a!==a&&b!==b};p=r.assign||function(){n=d[h]=r(a);throw ga("nonassign",c[l],l,f.name);};n=d[h]=r(a);m=function(b){G(b,d[h])||(G(b,n)?p(a,b=d[h]):d[h]=b);return n=b};m.$stateful=!0;m=e.collection?a.$watchCollection(c[l],m):a.$watch(v(c[l],m),null,r.literal);k.push(m);break;case "<":if(!va.call(c,l)){if(m)break;c[l]=void 0}if(m&&!c[l])break;r=v(c[l]);
d[h]=r(a);m=a.$watch(r,function(a){g(h,a,d[h]);d[h]=a},r.literal);k.push(m);break;case "&":r=c.hasOwnProperty(l)?v(c[l]):E;if(r===E&&m)break;d[h]=function(b){return r(a,b)}}});return k.length&&function(){for(var a=0,b=k.length;a<b;++a)k[a]()}}var ma=/^\w/,la=P.createElement("div"),pa=p,$;qa.prototype={$normalize:ya,$addClass:function(a){a&&0<a.length&&C.addClass(this.$$element,a)},$removeClass:function(a){a&&0<a.length&&C.removeClass(this.$$element,a)},$updateClass:function(a,b){var c=Zc(a,b);c&&
c.length&&C.addClass(this.$$element,c);(c=Zc(b,a))&&c.length&&C.removeClass(this.$$element,c)},$set:function(a,b,d,e){var f=Rc(this.$$element[0],a),g=$c[a],h=a;f?(this.$$element.prop(a,b),e=f):g&&(this[g]=b,h=g);this[a]=b;e?this.$attr[a]=e:(e=this.$attr[a])||(this.$attr[a]=e=zc(a,"-"));f=oa(this.$$element);if("a"===f&&("href"===a||"xlinkHref"===a)||"img"===f&&"src"===a)this[a]=b=K(b,"src"===a);else if("img"===f&&"srcset"===a){for(var f="",g=W(b),k=/(\s+\d+x\s*,|\s+\d+w\s*,|\s+,|,\s+)/,k=/\s/.test(g)?
k:/(,)/,g=g.split(k),k=Math.floor(g.length/2),l=0;l<k;l++)var m=2*l,f=f+K(W(g[m]),!0),f=f+(" "+W(g[m+1]));g=W(g[2*l]).split(/\s/);f+=K(W(g[0]),!0);2===g.length&&(f+=" "+W(g[1]));this[a]=b=f}!1!==d&&(null===b||z(b)?this.$$element.removeAttr(e):ma.test(e)?this.$$element.attr(e,b):Ca(this.$$element[0],e,b));(a=this.$$observers)&&q(a[h],function(a){try{a(b)}catch(d){c(d)}})},$observe:function(a,b){var c=this,d=c.$$observers||(c.$$observers=V()),e=d[a]||(d[a]=[]);e.push(b);t.$evalAsync(function(){e.$$inter||
!c.hasOwnProperty(a)||z(c[a])||b(c[a])});return function(){bb(e,b)}}};var sa=b.startSymbol(),ta=b.endSymbol(),ua="{{"==sa&&"}}"==ta?$a:function(a){return a.replace(/\{\{/g,sa).replace(/}}/g,ta)},za=/^ngAttr[A-Z]/,Ba=/^(.+)Start$/;ba.$$addBindingInfo=n?function(a,b){var c=a.data("$binding")||[];M(b)?c=c.concat(b):c.push(b);a.data("$binding",c)}:E;ba.$$addBindingClass=n?function(a){B(a,"ng-binding")}:E;ba.$$addScopeInfo=n?function(a,b,c,d){a.data(c?d?"$isolateScopeNoTemplate":"$isolateScope":"$scope",
b)}:E;ba.$$addScopeClass=n?function(a,b){B(a,b?"ng-isolate-scope":"ng-scope")}:E;ba.$$createComment=function(a,b){var c="";n&&(c=" "+(a||"")+": "+(b||"")+" ");return P.createComment(c)};return ba}]}function ya(a){return fb(a.replace(Vc,""))}function Zc(a,b){var d="",c=a.split(/\s+/),e=b.split(/\s+/),f=0;a:for(;f<c.length;f++){for(var g=c[f],h=0;h<e.length;h++)if(g==e[h])continue a;d+=(0<d.length?" ":"")+g}return d}function Xc(a){a=H(a);var b=a.length;if(1>=b)return a;for(;b--;)8===a[b].nodeType&&
Yf.call(a,b,1);return a}function Uc(a,b){if(b&&y(b))return b;if(y(a)){var d=ad.exec(a);if(d)return d[3]}}function df(){var a={},b=!1;this.has=function(b){return a.hasOwnProperty(b)};this.register=function(b,c){Ta(b,"controller");J(b)?S(a,b):a[b]=c};this.allowGlobals=function(){b=!0};this.$get=["$injector","$window",function(d,c){function e(a,b,c,d){if(!a||!J(a.$scope))throw O("$controller")("noscp",d,b);a.$scope[b]=c}return function(f,g,h,k){var l,m,n;h=!0===h;k&&y(k)&&(n=k);if(y(f)){k=f.match(ad);
if(!k)throw Zf("ctrlfmt",f);m=k[1];n=n||k[3];f=a.hasOwnProperty(m)?a[m]:Bc(g.$scope,m,!0)||(b?Bc(c,m,!0):u);Sa(f,m,!0)}if(h)return h=(M(f)?f[f.length-1]:f).prototype,l=Object.create(h||null),n&&e(g,n,l,m||f.name),S(function(){var a=d.invoke(f,l,g,m);a!==l&&(J(a)||D(a))&&(l=a,n&&e(g,n,l,m||f.name));return l},{instance:l,identifier:n});l=d.instantiate(f,g,m);n&&e(g,n,l,m||f.name);return l}}]}function ef(){this.$get=["$window",function(a){return H(a.document)}]}function ff(){this.$get=["$log",function(a){return function(b,
d){a.error.apply(a,arguments)}}]}function $b(a){return J(a)?fa(a)?a.toISOString():db(a):a}function lf(){this.$get=function(){return function(a){if(!a)return"";var b=[];pc(a,function(a,c){null===a||z(a)||(M(a)?q(a,function(a){b.push(ja(c)+"="+ja($b(a)))}):b.push(ja(c)+"="+ja($b(a))))});return b.join("&")}}}function mf(){this.$get=function(){return function(a){function b(a,e,f){null===a||z(a)||(M(a)?q(a,function(a,c){b(a,e+"["+(J(a)?c:"")+"]")}):J(a)&&!fa(a)?pc(a,function(a,c){b(a,e+(f?"":"[")+c+(f?
"":"]"))}):d.push(ja(e)+"="+ja($b(a))))}if(!a)return"";var d=[];b(a,"",!0);return d.join("&")}}}function ac(a,b){if(y(a)){var d=a.replace($f,"").trim();if(d){var c=b("Content-Type");(c=c&&0===c.indexOf(bd))||(c=(c=d.match(ag))&&bg[c[0]].test(d));c&&(a=uc(d))}}return a}function cd(a){var b=V(),d;y(a)?q(a.split("\n"),function(a){d=a.indexOf(":");var e=N(W(a.substr(0,d)));a=W(a.substr(d+1));e&&(b[e]=b[e]?b[e]+", "+a:a)}):J(a)&&q(a,function(a,d){var f=N(d),g=W(a);f&&(b[f]=b[f]?b[f]+", "+g:g)});return b}
function dd(a){var b;return function(d){b||(b=cd(a));return d?(d=b[N(d)],void 0===d&&(d=null),d):b}}function ed(a,b,d,c){if(D(c))return c(a,b,d);q(c,function(c){a=c(a,b,d)});return a}function kf(){var a=this.defaults={transformResponse:[ac],transformRequest:[function(a){return J(a)&&"[object File]"!==ka.call(a)&&"[object Blob]"!==ka.call(a)&&"[object FormData]"!==ka.call(a)?db(a):a}],headers:{common:{Accept:"application/json, text/plain, */*"},post:ia(bc),put:ia(bc),patch:ia(bc)},xsrfCookieName:"XSRF-TOKEN",
xsrfHeaderName:"X-XSRF-TOKEN",paramSerializer:"$httpParamSerializer"},b=!1;this.useApplyAsync=function(a){return A(a)?(b=!!a,this):b};var d=!0;this.useLegacyPromiseExtensions=function(a){return A(a)?(d=!!a,this):d};var c=this.interceptors=[];this.$get=["$httpBackend","$$cookieReader","$cacheFactory","$rootScope","$q","$injector",function(e,f,g,h,k,l){function m(b){function c(a){var b=S({},a);b.data=ed(a.data,a.headers,a.status,f.transformResponse);a=a.status;return 200<=a&&300>a?b:k.reject(b)}function e(a,
b){var c,d={};q(a,function(a,e){D(a)?(c=a(b),null!=c&&(d[e]=c)):d[e]=a});return d}if(!J(b))throw O("$http")("badreq",b);if(!y(b.url))throw O("$http")("badreq",b.url);var f=S({method:"get",transformRequest:a.transformRequest,transformResponse:a.transformResponse,paramSerializer:a.paramSerializer},b);f.headers=function(b){var c=a.headers,d=S({},b.headers),f,g,h,c=S({},c.common,c[N(b.method)]);a:for(f in c){g=N(f);for(h in d)if(N(h)===g)continue a;d[f]=c[f]}return e(d,ia(b))}(b);f.method=vb(f.method);
f.paramSerializer=y(f.paramSerializer)?l.get(f.paramSerializer):f.paramSerializer;var g=[function(b){var d=b.headers,e=ed(b.data,dd(d),u,b.transformRequest);z(e)&&q(d,function(a,b){"content-type"===N(b)&&delete d[b]});z(b.withCredentials)&&!z(a.withCredentials)&&(b.withCredentials=a.withCredentials);return n(b,e).then(c,c)},u],h=k.when(f);for(q(L,function(a){(a.request||a.requestError)&&g.unshift(a.request,a.requestError);(a.response||a.responseError)&&g.push(a.response,a.responseError)});g.length;){b=
g.shift();var m=g.shift(),h=h.then(b,m)}d?(h.success=function(a){Sa(a,"fn");h.then(function(b){a(b.data,b.status,b.headers,f)});return h},h.error=function(a){Sa(a,"fn");h.then(null,function(b){a(b.data,b.status,b.headers,f)});return h}):(h.success=fd("success"),h.error=fd("error"));return h}function n(c,d){function g(a,c,d,e){function f(){l(c,a,d,e)}K&&(200<=a&&300>a?K.put(L,[a,c,cd(d),e]):K.remove(L));b?h.$applyAsync(f):(f(),h.$$phase||h.$apply())}function l(a,b,d,e){b=-1<=b?b:0;(200<=b&&300>b?G.resolve:
G.reject)({data:a,status:b,headers:dd(d),config:c,statusText:e})}function n(a){l(a.data,a.status,ia(a.headers()),a.statusText)}function t(){var a=m.pendingRequests.indexOf(c);-1!==a&&m.pendingRequests.splice(a,1)}var G=k.defer(),C=G.promise,K,I,qa=c.headers,L=p(c.url,c.paramSerializer(c.params));m.pendingRequests.push(c);C.then(t,t);!c.cache&&!a.cache||!1===c.cache||"GET"!==c.method&&"JSONP"!==c.method||(K=J(c.cache)?c.cache:J(a.cache)?a.cache:F);K&&(I=K.get(L),A(I)?I&&D(I.then)?I.then(n,n):M(I)?
l(I[1],I[0],ia(I[2]),I[3]):l(I,200,{},"OK"):K.put(L,C));z(I)&&((I=gd(c.url)?f()[c.xsrfCookieName||a.xsrfCookieName]:u)&&(qa[c.xsrfHeaderName||a.xsrfHeaderName]=I),e(c.method,L,d,g,qa,c.timeout,c.withCredentials,c.responseType));return C}function p(a,b){0<b.length&&(a+=(-1==a.indexOf("?")?"?":"&")+b);return a}var F=g("$http");a.paramSerializer=y(a.paramSerializer)?l.get(a.paramSerializer):a.paramSerializer;var L=[];q(c,function(a){L.unshift(y(a)?l.get(a):l.invoke(a))});m.pendingRequests=[];(function(a){q(arguments,
function(a){m[a]=function(b,c){return m(S({},c||{},{method:a,url:b}))}})})("get","delete","head","jsonp");(function(a){q(arguments,function(a){m[a]=function(b,c,d){return m(S({},d||{},{method:a,url:b,data:c}))}})})("post","put","patch");m.defaults=a;return m}]}function of(){this.$get=function(){return function(){return new T.XMLHttpRequest}}}function nf(){this.$get=["$browser","$window","$document","$xhrFactory",function(a,b,d,c){return cg(a,c,a.defer,b.angular.callbacks,d[0])}]}function cg(a,b,d,
c,e){function f(a,b,d){var f=e.createElement("script"),m=null;f.type="text/javascript";f.src=a;f.async=!0;m=function(a){f.removeEventListener("load",m,!1);f.removeEventListener("error",m,!1);e.body.removeChild(f);f=null;var g=-1,F="unknown";a&&("load"!==a.type||c[b].called||(a={type:"error"}),F=a.type,g="error"===a.type?404:200);d&&d(g,F)};f.addEventListener("load",m,!1);f.addEventListener("error",m,!1);e.body.appendChild(f);return m}return function(e,h,k,l,m,n,p,F){function L(){w&&w();v&&v.abort()}
function x(b,c,e,f,g){A(t)&&d.cancel(t);w=v=null;b(c,e,f,g);a.$$completeOutstandingRequest(E)}a.$$incOutstandingRequestCount();h=h||a.url();if("jsonp"==N(e)){var r="_"+(c.counter++).toString(36);c[r]=function(a){c[r].data=a;c[r].called=!0};var w=f(h.replace("JSON_CALLBACK","angular.callbacks."+r),r,function(a,b){x(l,a,c[r].data,"",b);c[r]=E})}else{var v=b(e,h);v.open(e,h,!0);q(m,function(a,b){A(a)&&v.setRequestHeader(b,a)});v.onload=function(){var a=v.statusText||"",b="response"in v?v.response:v.responseText,
c=1223===v.status?204:v.status;0===c&&(c=b?200:"file"==sa(h).protocol?404:0);x(l,c,b,v.getAllResponseHeaders(),a)};e=function(){x(l,-1,null,null,"")};v.onerror=e;v.onabort=e;p&&(v.withCredentials=!0);if(F)try{v.responseType=F}catch(Q){if("json"!==F)throw Q;}v.send(z(k)?null:k)}if(0<n)var t=d(L,n);else n&&D(n.then)&&n.then(L)}}function hf(){var a="{{",b="}}";this.startSymbol=function(b){return b?(a=b,this):a};this.endSymbol=function(a){return a?(b=a,this):b};this.$get=["$parse","$exceptionHandler",
"$sce",function(d,c,e){function f(a){return"\\\\\\"+a}function g(c){return c.replace(n,a).replace(p,b)}function h(a,b,c,d){var e;return e=a.$watch(function(a){e();return d(a)},b,c)}function k(f,k,n,r){function p(a){try{var b=a;a=n?e.getTrusted(n,b):e.valueOf(b);var d;if(r&&!A(a))d=a;else if(null==a)d="";else{switch(typeof a){case "string":break;case "number":a=""+a;break;default:a=db(a)}d=a}return d}catch(g){c(La.interr(f,g))}}if(!f.length||-1===f.indexOf(a)){var v;k||(k=g(f),v=da(k),v.exp=f,v.expressions=
[],v.$$watchDelegate=h);return v}r=!!r;var q,t,G=0,C=[],K=[];v=f.length;for(var I=[],qa=[];G<v;)if(-1!=(q=f.indexOf(a,G))&&-1!=(t=f.indexOf(b,q+l)))G!==q&&I.push(g(f.substring(G,q))),G=f.substring(q+l,t),C.push(G),K.push(d(G,p)),G=t+m,qa.push(I.length),I.push("");else{G!==v&&I.push(g(f.substring(G)));break}n&&1<I.length&&La.throwNoconcat(f);if(!k||C.length){var Ca=function(a){for(var b=0,c=C.length;b<c;b++){if(r&&z(a[b]))return;I[qa[b]]=a[b]}return I.join("")};return S(function(a){var b=0,d=C.length,
e=Array(d);try{for(;b<d;b++)e[b]=K[b](a);return Ca(e)}catch(g){c(La.interr(f,g))}},{exp:f,expressions:C,$$watchDelegate:function(a,b){var c;return a.$watchGroup(K,function(d,e){var f=Ca(d);D(b)&&b.call(this,f,d!==e?c:f,a);c=f})}})}}var l=a.length,m=b.length,n=new RegExp(a.replace(/./g,f),"g"),p=new RegExp(b.replace(/./g,f),"g");k.startSymbol=function(){return a};k.endSymbol=function(){return b};return k}]}function jf(){this.$get=["$rootScope","$window","$q","$$q","$browser",function(a,b,d,c,e){function f(f,
k,l,m){function n(){p?f.apply(null,F):f(r)}var p=4<arguments.length,F=p?Aa.call(arguments,4):[],q=b.setInterval,x=b.clearInterval,r=0,w=A(m)&&!m,v=(w?c:d).defer(),Q=v.promise;l=A(l)?l:0;Q.$$intervalId=q(function(){w?e.defer(n):a.$evalAsync(n);v.notify(r++);0<l&&r>=l&&(v.resolve(r),x(Q.$$intervalId),delete g[Q.$$intervalId]);w||a.$apply()},k);g[Q.$$intervalId]=v;return Q}var g={};f.cancel=function(a){return a&&a.$$intervalId in g?(g[a.$$intervalId].reject("canceled"),b.clearInterval(a.$$intervalId),
delete g[a.$$intervalId],!0):!1};return f}]}function cc(a){a=a.split("/");for(var b=a.length;b--;)a[b]=rb(a[b]);return a.join("/")}function hd(a,b){var d=sa(a);b.$$protocol=d.protocol;b.$$host=d.hostname;b.$$port=Y(d.port)||dg[d.protocol]||null}function id(a,b){var d="/"!==a.charAt(0);d&&(a="/"+a);var c=sa(a);b.$$path=decodeURIComponent(d&&"/"===c.pathname.charAt(0)?c.pathname.substring(1):c.pathname);b.$$search=xc(c.search);b.$$hash=decodeURIComponent(c.hash);b.$$path&&"/"!=b.$$path.charAt(0)&&(b.$$path=
"/"+b.$$path)}function la(a,b){if(0===b.indexOf(a))return b.substr(a.length)}function Ka(a){var b=a.indexOf("#");return-1==b?a:a.substr(0,b)}function kb(a){return a.replace(/(#.+)|#$/,"$1")}function dc(a,b,d){this.$$html5=!0;d=d||"";hd(a,this);this.$$parse=function(a){var d=la(b,a);if(!y(d))throw Fb("ipthprfx",a,b);id(d,this);this.$$path||(this.$$path="/");this.$$compose()};this.$$compose=function(){var a=Sb(this.$$search),d=this.$$hash?"#"+rb(this.$$hash):"";this.$$url=cc(this.$$path)+(a?"?"+a:"")+
d;this.$$absUrl=b+this.$$url.substr(1)};this.$$parseLinkUrl=function(c,e){if(e&&"#"===e[0])return this.hash(e.slice(1)),!0;var f,g;A(f=la(a,c))?(g=f,g=A(f=la(d,f))?b+(la("/",f)||f):a+g):A(f=la(b,c))?g=b+f:b==c+"/"&&(g=b);g&&this.$$parse(g);return!!g}}function ec(a,b,d){hd(a,this);this.$$parse=function(c){var e=la(a,c)||la(b,c),f;z(e)||"#"!==e.charAt(0)?this.$$html5?f=e:(f="",z(e)&&(a=c,this.replace())):(f=la(d,e),z(f)&&(f=e));id(f,this);c=this.$$path;var e=a,g=/^\/[A-Z]:(\/.*)/;0===f.indexOf(e)&&
(f=f.replace(e,""));g.exec(f)||(c=(f=g.exec(c))?f[1]:c);this.$$path=c;this.$$compose()};this.$$compose=function(){var b=Sb(this.$$search),e=this.$$hash?"#"+rb(this.$$hash):"";this.$$url=cc(this.$$path)+(b?"?"+b:"")+e;this.$$absUrl=a+(this.$$url?d+this.$$url:"")};this.$$parseLinkUrl=function(b,d){return Ka(a)==Ka(b)?(this.$$parse(b),!0):!1}}function jd(a,b,d){this.$$html5=!0;ec.apply(this,arguments);this.$$parseLinkUrl=function(c,e){if(e&&"#"===e[0])return this.hash(e.slice(1)),!0;var f,g;a==Ka(c)?
f=c:(g=la(b,c))?f=a+d+g:b===c+"/"&&(f=b);f&&this.$$parse(f);return!!f};this.$$compose=function(){var b=Sb(this.$$search),e=this.$$hash?"#"+rb(this.$$hash):"";this.$$url=cc(this.$$path)+(b?"?"+b:"")+e;this.$$absUrl=a+d+this.$$url}}function Gb(a){return function(){return this[a]}}function kd(a,b){return function(d){if(z(d))return this[a];this[a]=b(d);this.$$compose();return this}}function pf(){var a="",b={enabled:!1,requireBase:!0,rewriteLinks:!0};this.hashPrefix=function(b){return A(b)?(a=b,this):
a};this.html5Mode=function(a){return Oa(a)?(b.enabled=a,this):J(a)?(Oa(a.enabled)&&(b.enabled=a.enabled),Oa(a.requireBase)&&(b.requireBase=a.requireBase),Oa(a.rewriteLinks)&&(b.rewriteLinks=a.rewriteLinks),this):b};this.$get=["$rootScope","$browser","$sniffer","$rootElement","$window",function(d,c,e,f,g){function h(a,b,d){var e=l.url(),f=l.$$state;try{c.url(a,b,d),l.$$state=c.state()}catch(g){throw l.url(e),l.$$state=f,g;}}function k(a,b){d.$broadcast("$locationChangeSuccess",l.absUrl(),a,l.$$state,
b)}var l,m;m=c.baseHref();var n=c.url(),p;if(b.enabled){if(!m&&b.requireBase)throw Fb("nobase");p=n.substring(0,n.indexOf("/",n.indexOf("//")+2))+(m||"/");m=e.history?dc:jd}else p=Ka(n),m=ec;var F=p.substr(0,Ka(p).lastIndexOf("/")+1);l=new m(p,F,"#"+a);l.$$parseLinkUrl(n,n);l.$$state=c.state();var q=/^\s*(javascript|mailto):/i;f.on("click",function(a){if(b.rewriteLinks&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey&&2!=a.which&&2!=a.button){for(var e=H(a.target);"a"!==oa(e[0]);)if(e[0]===f[0]||!(e=e.parent())[0])return;
var h=e.prop("href"),k=e.attr("href")||e.attr("xlink:href");J(h)&&"[object SVGAnimatedString]"===h.toString()&&(h=sa(h.animVal).href);q.test(h)||!h||e.attr("target")||a.isDefaultPrevented()||!l.$$parseLinkUrl(h,k)||(a.preventDefault(),l.absUrl()!=c.url()&&(d.$apply(),g.angular["ff-684208-preventDefault"]=!0))}});kb(l.absUrl())!=kb(n)&&c.url(l.absUrl(),!0);var x=!0;c.onUrlChange(function(a,b){z(la(F,a))?g.location.href=a:(d.$evalAsync(function(){var c=l.absUrl(),e=l.$$state,f;a=kb(a);l.$$parse(a);
l.$$state=b;f=d.$broadcast("$locationChangeStart",a,c,b,e).defaultPrevented;l.absUrl()===a&&(f?(l.$$parse(c),l.$$state=e,h(c,!1,e)):(x=!1,k(c,e)))}),d.$$phase||d.$digest())});d.$watch(function(){var a=kb(c.url()),b=kb(l.absUrl()),f=c.state(),g=l.$$replace,m=a!==b||l.$$html5&&e.history&&f!==l.$$state;if(x||m)x=!1,d.$evalAsync(function(){var b=l.absUrl(),c=d.$broadcast("$locationChangeStart",b,a,l.$$state,f).defaultPrevented;l.absUrl()===b&&(c?(l.$$parse(a),l.$$state=f):(m&&h(b,g,f===l.$$state?null:
l.$$state),k(a,f)))});l.$$replace=!1});return l}]}function qf(){var a=!0,b=this;this.debugEnabled=function(b){return A(b)?(a=b,this):a};this.$get=["$window",function(d){function c(a){a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line));return a}function e(a){var b=d.console||{},e=b[a]||b.log||E;a=!1;try{a=!!e.apply}catch(k){}return a?function(){var a=[];q(arguments,function(b){a.push(c(b))});
return e.apply(b,a)}:function(a,b){e(a,null==b?"":b)}}return{log:e("log"),info:e("info"),warn:e("warn"),error:e("error"),debug:function(){var c=e("debug");return function(){a&&c.apply(b,arguments)}}()}}]}function Wa(a,b){if("__defineGetter__"===a||"__defineSetter__"===a||"__lookupGetter__"===a||"__lookupSetter__"===a||"__proto__"===a)throw ca("isecfld",b);return a}function eg(a){return a+""}function ta(a,b){if(a){if(a.constructor===a)throw ca("isecfn",b);if(a.window===a)throw ca("isecwindow",b);if(a.children&&
(a.nodeName||a.prop&&a.attr&&a.find))throw ca("isecdom",b);if(a===Object)throw ca("isecobj",b);}return a}function ld(a,b){if(a){if(a.constructor===a)throw ca("isecfn",b);if(a===fg||a===gg||a===hg)throw ca("isecff",b);}}function Hb(a,b){if(a&&(a===(0).constructor||a===(!1).constructor||a==="".constructor||a==={}.constructor||a===[].constructor||a===Function.constructor))throw ca("isecaf",b);}function ig(a,b){return"undefined"!==typeof a?a:b}function md(a,b){return"undefined"===typeof a?b:"undefined"===
typeof b?a:a+b}function aa(a,b){var d,c;switch(a.type){case s.Program:d=!0;q(a.body,function(a){aa(a.expression,b);d=d&&a.expression.constant});a.constant=d;break;case s.Literal:a.constant=!0;a.toWatch=[];break;case s.UnaryExpression:aa(a.argument,b);a.constant=a.argument.constant;a.toWatch=a.argument.toWatch;break;case s.BinaryExpression:aa(a.left,b);aa(a.right,b);a.constant=a.left.constant&&a.right.constant;a.toWatch=a.left.toWatch.concat(a.right.toWatch);break;case s.LogicalExpression:aa(a.left,
b);aa(a.right,b);a.constant=a.left.constant&&a.right.constant;a.toWatch=a.constant?[]:[a];break;case s.ConditionalExpression:aa(a.test,b);aa(a.alternate,b);aa(a.consequent,b);a.constant=a.test.constant&&a.alternate.constant&&a.consequent.constant;a.toWatch=a.constant?[]:[a];break;case s.Identifier:a.constant=!1;a.toWatch=[a];break;case s.MemberExpression:aa(a.object,b);a.computed&&aa(a.property,b);a.constant=a.object.constant&&(!a.computed||a.property.constant);a.toWatch=[a];break;case s.CallExpression:d=
a.filter?!b(a.callee.name).$stateful:!1;c=[];q(a.arguments,function(a){aa(a,b);d=d&&a.constant;a.constant||c.push.apply(c,a.toWatch)});a.constant=d;a.toWatch=a.filter&&!b(a.callee.name).$stateful?c:[a];break;case s.AssignmentExpression:aa(a.left,b);aa(a.right,b);a.constant=a.left.constant&&a.right.constant;a.toWatch=[a];break;case s.ArrayExpression:d=!0;c=[];q(a.elements,function(a){aa(a,b);d=d&&a.constant;a.constant||c.push.apply(c,a.toWatch)});a.constant=d;a.toWatch=c;break;case s.ObjectExpression:d=
!0;c=[];q(a.properties,function(a){aa(a.value,b);d=d&&a.value.constant;a.value.constant||c.push.apply(c,a.value.toWatch)});a.constant=d;a.toWatch=c;break;case s.ThisExpression:a.constant=!1;a.toWatch=[];break;case s.LocalsExpression:a.constant=!1,a.toWatch=[]}}function nd(a){if(1==a.length){a=a[0].expression;var b=a.toWatch;return 1!==b.length?b:b[0]!==a?b:u}}function od(a){return a.type===s.Identifier||a.type===s.MemberExpression}function pd(a){if(1===a.body.length&&od(a.body[0].expression))return{type:s.AssignmentExpression,
left:a.body[0].expression,right:{type:s.NGValueParameter},operator:"="}}function qd(a){return 0===a.body.length||1===a.body.length&&(a.body[0].expression.type===s.Literal||a.body[0].expression.type===s.ArrayExpression||a.body[0].expression.type===s.ObjectExpression)}function rd(a,b){this.astBuilder=a;this.$filter=b}function sd(a,b){this.astBuilder=a;this.$filter=b}function Ib(a){return"constructor"==a}function fc(a){return D(a.valueOf)?a.valueOf():jg.call(a)}function rf(){var a=V(),b=V(),d={"true":!0,
"false":!1,"null":null,undefined:u};this.addLiteral=function(a,b){d[a]=b};this.$get=["$filter",function(c){function e(d,e,g){var p,t,G;g=g||x;switch(typeof d){case "string":G=d=d.trim();var C=g?b:a;p=C[G];if(!p){":"===d.charAt(0)&&":"===d.charAt(1)&&(t=!0,d=d.substring(2));p=g?L:F;var K=new gc(p);p=(new hc(K,c,p)).parse(d);p.constant?p.$$watchDelegate=m:t?p.$$watchDelegate=p.literal?l:k:p.inputs&&(p.$$watchDelegate=h);g&&(p=f(p));C[G]=p}return n(p,e);case "function":return n(d,e);default:return n(E,
e)}}function f(a){function b(c,d,e,f){var g=x;x=!0;try{return a(c,d,e,f)}finally{x=g}}if(!a)return a;b.$$watchDelegate=a.$$watchDelegate;b.assign=f(a.assign);b.constant=a.constant;b.literal=a.literal;for(var c=0;a.inputs&&c<a.inputs.length;++c)a.inputs[c]=f(a.inputs[c]);b.inputs=a.inputs;return b}function g(a,b){return null==a||null==b?a===b:"object"===typeof a&&(a=fc(a),"object"===typeof a)?!1:a===b||a!==a&&b!==b}function h(a,b,c,d,e){var f=d.inputs,h;if(1===f.length){var k=g,f=f[0];return a.$watch(function(a){var b=
f(a);g(b,k)||(h=d(a,u,u,[b]),k=b&&fc(b));return h},b,c,e)}for(var l=[],m=[],n=0,p=f.length;n<p;n++)l[n]=g,m[n]=null;return a.$watch(function(a){for(var b=!1,c=0,e=f.length;c<e;c++){var k=f[c](a);if(b||(b=!g(k,l[c])))m[c]=k,l[c]=k&&fc(k)}b&&(h=d(a,u,u,m));return h},b,c,e)}function k(a,b,c,d){var e,f;return e=a.$watch(function(a){return d(a)},function(a,c,d){f=a;D(b)&&b.apply(this,arguments);A(a)&&d.$$postDigest(function(){A(f)&&e()})},c)}function l(a,b,c,d){function e(a){var b=!0;q(a,function(a){A(a)||
(b=!1)});return b}var f,g;return f=a.$watch(function(a){return d(a)},function(a,c,d){g=a;D(b)&&b.call(this,a,c,d);e(a)&&d.$$postDigest(function(){e(g)&&f()})},c)}function m(a,b,c,d){var e;return e=a.$watch(function(a){e();return d(a)},b,c)}function n(a,b){if(!b)return a;var c=a.$$watchDelegate,d=!1,c=c!==l&&c!==k?function(c,e,f,g){f=d&&g?g[0]:a(c,e,f,g);return b(f,c,e)}:function(c,d,e,f){e=a(c,d,e,f);c=b(e,c,d);return A(e)?c:e};a.$$watchDelegate&&a.$$watchDelegate!==h?c.$$watchDelegate=a.$$watchDelegate:
b.$stateful||(c.$$watchDelegate=h,d=!a.inputs,c.inputs=a.inputs?a.inputs:[a]);return c}var p=Ga().noUnsafeEval,F={csp:p,expensiveChecks:!1,literals:pa(d)},L={csp:p,expensiveChecks:!0,literals:pa(d)},x=!1;e.$$runningExpensiveChecks=function(){return x};return e}]}function tf(){this.$get=["$rootScope","$exceptionHandler",function(a,b){return td(function(b){a.$evalAsync(b)},b)}]}function uf(){this.$get=["$browser","$exceptionHandler",function(a,b){return td(function(b){a.defer(b)},b)}]}function td(a,
b){function d(){this.$$state={status:0}}function c(a,b){return function(c){b.call(a,c)}}function e(c){!c.processScheduled&&c.pending&&(c.processScheduled=!0,a(function(){var a,d,e;e=c.pending;c.processScheduled=!1;c.pending=u;for(var f=0,g=e.length;f<g;++f){d=e[f][0];a=e[f][c.status];try{D(a)?d.resolve(a(c.value)):1===c.status?d.resolve(c.value):d.reject(c.value)}catch(h){d.reject(h),b(h)}}}))}function f(){this.promise=new d}var g=O("$q",TypeError);S(d.prototype,{then:function(a,b,c){if(z(a)&&z(b)&&
z(c))return this;var d=new f;this.$$state.pending=this.$$state.pending||[];this.$$state.pending.push([d,a,b,c]);0<this.$$state.status&&e(this.$$state);return d.promise},"catch":function(a){return this.then(null,a)},"finally":function(a,b){return this.then(function(b){return k(b,!0,a)},function(b){return k(b,!1,a)},b)}});S(f.prototype,{resolve:function(a){this.promise.$$state.status||(a===this.promise?this.$$reject(g("qcycle",a)):this.$$resolve(a))},$$resolve:function(a){function d(a){k||(k=!0,h.$$resolve(a))}
function f(a){k||(k=!0,h.$$reject(a))}var g,h=this,k=!1;try{if(J(a)||D(a))g=a&&a.then;D(g)?(this.promise.$$state.status=-1,g.call(a,d,f,c(this,this.notify))):(this.promise.$$state.value=a,this.promise.$$state.status=1,e(this.promise.$$state))}catch(l){f(l),b(l)}},reject:function(a){this.promise.$$state.status||this.$$reject(a)},$$reject:function(a){this.promise.$$state.value=a;this.promise.$$state.status=2;e(this.promise.$$state)},notify:function(c){var d=this.promise.$$state.pending;0>=this.promise.$$state.status&&
d&&d.length&&a(function(){for(var a,e,f=0,g=d.length;f<g;f++){e=d[f][0];a=d[f][3];try{e.notify(D(a)?a(c):c)}catch(h){b(h)}}})}});var h=function(a,b){var c=new f;b?c.resolve(a):c.reject(a);return c.promise},k=function(a,b,c){var d=null;try{D(c)&&(d=c())}catch(e){return h(e,!1)}return d&&D(d.then)?d.then(function(){return h(a,b)},function(a){return h(a,!1)}):h(a,b)},l=function(a,b,c,d){var e=new f;e.resolve(a);return e.promise.then(b,c,d)},m=function(a){if(!D(a))throw g("norslvr",a);var b=new f;a(function(a){b.resolve(a)},
function(a){b.reject(a)});return b.promise};m.prototype=d.prototype;m.defer=function(){var a=new f;a.resolve=c(a,a.resolve);a.reject=c(a,a.reject);a.notify=c(a,a.notify);return a};m.reject=function(a){var b=new f;b.reject(a);return b.promise};m.when=l;m.resolve=l;m.all=function(a){var b=new f,c=0,d=M(a)?[]:{};q(a,function(a,e){c++;l(a).then(function(a){d.hasOwnProperty(e)||(d[e]=a,--c||b.resolve(d))},function(a){d.hasOwnProperty(e)||b.reject(a)})});0===c&&b.resolve(d);return b.promise};return m}function Df(){this.$get=
["$window","$timeout",function(a,b){var d=a.requestAnimationFrame||a.webkitRequestAnimationFrame,c=a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.webkitCancelRequestAnimationFrame,e=!!d,f=e?function(a){var b=d(a);return function(){c(b)}}:function(a){var c=b(a,16.66,!1);return function(){b.cancel(c)}};f.supported=e;return f}]}function sf(){function a(a){function b(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null;this.$$listeners={};this.$$listenerCount={};this.$$watchersCount=
0;this.$id=++qb;this.$$ChildScope=null}b.prototype=a;return b}var b=10,d=O("$rootScope"),c=null,e=null;this.digestTtl=function(a){arguments.length&&(b=a);return b};this.$get=["$exceptionHandler","$parse","$browser",function(f,g,h){function k(a){a.currentScope.$$destroyed=!0}function l(a){9===Da&&(a.$$childHead&&l(a.$$childHead),a.$$nextSibling&&l(a.$$nextSibling));a.$parent=a.$$nextSibling=a.$$prevSibling=a.$$childHead=a.$$childTail=a.$root=a.$$watchers=null}function m(){this.$id=++qb;this.$$phase=
this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null;this.$root=this;this.$$destroyed=!1;this.$$listeners={};this.$$listenerCount={};this.$$watchersCount=0;this.$$isolateBindings=null}function n(a){if(w.$$phase)throw d("inprog",w.$$phase);w.$$phase=a}function p(a,b){do a.$$watchersCount+=b;while(a=a.$parent)}function F(a,b,c){do a.$$listenerCount[c]-=b,0===a.$$listenerCount[c]&&delete a.$$listenerCount[c];while(a=a.$parent)}function s(){}function x(){for(;t.length;)try{t.shift()()}catch(a){f(a)}e=
null}function r(){null===e&&(e=h.defer(function(){w.$apply(x)}))}m.prototype={constructor:m,$new:function(b,c){var d;c=c||this;b?(d=new m,d.$root=this.$root):(this.$$ChildScope||(this.$$ChildScope=a(this)),d=new this.$$ChildScope);d.$parent=c;d.$$prevSibling=c.$$childTail;c.$$childHead?(c.$$childTail.$$nextSibling=d,c.$$childTail=d):c.$$childHead=c.$$childTail=d;(b||c!=this)&&d.$on("$destroy",k);return d},$watch:function(a,b,d,e){var f=g(a);if(f.$$watchDelegate)return f.$$watchDelegate(this,b,d,f,
a);var h=this,k=h.$$watchers,l={fn:b,last:s,get:f,exp:e||a,eq:!!d};c=null;D(b)||(l.fn=E);k||(k=h.$$watchers=[]);k.unshift(l);p(this,1);return function(){0<=bb(k,l)&&p(h,-1);c=null}},$watchGroup:function(a,b){function c(){h=!1;k?(k=!1,b(e,e,g)):b(e,d,g)}var d=Array(a.length),e=Array(a.length),f=[],g=this,h=!1,k=!0;if(!a.length){var l=!0;g.$evalAsync(function(){l&&b(e,e,g)});return function(){l=!1}}if(1===a.length)return this.$watch(a[0],function(a,c,f){e[0]=a;d[0]=c;b(e,a===c?e:d,f)});q(a,function(a,
b){var k=g.$watch(a,function(a,f){e[b]=a;d[b]=f;h||(h=!0,g.$evalAsync(c))});f.push(k)});return function(){for(;f.length;)f.shift()()}},$watchCollection:function(a,b){function c(a){e=a;var b,d,g,h;if(!z(e)){if(J(e))if(za(e))for(f!==n&&(f=n,v=f.length=0,l++),a=e.length,v!==a&&(l++,f.length=v=a),b=0;b<a;b++)h=f[b],g=e[b],d=h!==h&&g!==g,d||h===g||(l++,f[b]=g);else{f!==p&&(f=p={},v=0,l++);a=0;for(b in e)va.call(e,b)&&(a++,g=e[b],h=f[b],b in f?(d=h!==h&&g!==g,d||h===g||(l++,f[b]=g)):(v++,f[b]=g,l++));if(v>
a)for(b in l++,f)va.call(e,b)||(v--,delete f[b])}else f!==e&&(f=e,l++);return l}}c.$stateful=!0;var d=this,e,f,h,k=1<b.length,l=0,m=g(a,c),n=[],p={},r=!0,v=0;return this.$watch(m,function(){r?(r=!1,b(e,e,d)):b(e,h,d);if(k)if(J(e))if(za(e)){h=Array(e.length);for(var a=0;a<e.length;a++)h[a]=e[a]}else for(a in h={},e)va.call(e,a)&&(h[a]=e[a]);else h=e})},$digest:function(){var a,g,k,l,m,p,r,q,t=b,F,A=[],z,y;n("$digest");h.$$checkUrlChange();this===w&&null!==e&&(h.defer.cancel(e),x());c=null;do{q=!1;
for(F=this;v.length;){try{y=v.shift(),y.scope.$eval(y.expression,y.locals)}catch(E){f(E)}c=null}a:do{if(p=F.$$watchers)for(r=p.length;r--;)try{if(a=p[r])if(m=a.get,(g=m(F))!==(k=a.last)&&!(a.eq?na(g,k):"number"===typeof g&&"number"===typeof k&&isNaN(g)&&isNaN(k)))q=!0,c=a,a.last=a.eq?pa(g,null):g,l=a.fn,l(g,k===s?g:k,F),5>t&&(z=4-t,A[z]||(A[z]=[]),A[z].push({msg:D(a.exp)?"fn: "+(a.exp.name||a.exp.toString()):a.exp,newVal:g,oldVal:k}));else if(a===c){q=!1;break a}}catch(H){f(H)}if(!(p=F.$$watchersCount&&
F.$$childHead||F!==this&&F.$$nextSibling))for(;F!==this&&!(p=F.$$nextSibling);)F=F.$parent}while(F=p);if((q||v.length)&&!t--)throw w.$$phase=null,d("infdig",b,A);}while(q||v.length);for(w.$$phase=null;u.length;)try{u.shift()()}catch(J){f(J)}},$destroy:function(){if(!this.$$destroyed){var a=this.$parent;this.$broadcast("$destroy");this.$$destroyed=!0;this===w&&h.$$applicationDestroyed();p(this,-this.$$watchersCount);for(var b in this.$$listenerCount)F(this,this.$$listenerCount[b],b);a&&a.$$childHead==
this&&(a.$$childHead=this.$$nextSibling);a&&a.$$childTail==this&&(a.$$childTail=this.$$prevSibling);this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling);this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling);this.$destroy=this.$digest=this.$apply=this.$evalAsync=this.$applyAsync=E;this.$on=this.$watch=this.$watchGroup=function(){return E};this.$$listeners={};this.$$nextSibling=null;l(this)}},$eval:function(a,b){return g(a)(this,b)},$evalAsync:function(a,b){w.$$phase||
v.length||h.defer(function(){v.length&&w.$digest()});v.push({scope:this,expression:g(a),locals:b})},$$postDigest:function(a){u.push(a)},$apply:function(a){try{n("$apply");try{return this.$eval(a)}finally{w.$$phase=null}}catch(b){f(b)}finally{try{w.$digest()}catch(c){throw f(c),c;}}},$applyAsync:function(a){function b(){c.$eval(a)}var c=this;a&&t.push(b);a=g(a);r()},$on:function(a,b){var c=this.$$listeners[a];c||(this.$$listeners[a]=c=[]);c.push(b);var d=this;do d.$$listenerCount[a]||(d.$$listenerCount[a]=
0),d.$$listenerCount[a]++;while(d=d.$parent);var e=this;return function(){var d=c.indexOf(b);-1!==d&&(c[d]=null,F(e,1,a))}},$emit:function(a,b){var c=[],d,e=this,g=!1,h={name:a,targetScope:e,stopPropagation:function(){g=!0},preventDefault:function(){h.defaultPrevented=!0},defaultPrevented:!1},k=cb([h],arguments,1),l,m;do{d=e.$$listeners[a]||c;h.currentScope=e;l=0;for(m=d.length;l<m;l++)if(d[l])try{d[l].apply(null,k)}catch(n){f(n)}else d.splice(l,1),l--,m--;if(g)return h.currentScope=null,h;e=e.$parent}while(e);
h.currentScope=null;return h},$broadcast:function(a,b){var c=this,d=this,e={name:a,targetScope:this,preventDefault:function(){e.defaultPrevented=!0},defaultPrevented:!1};if(!this.$$listenerCount[a])return e;for(var g=cb([e],arguments,1),h,k;c=d;){e.currentScope=c;d=c.$$listeners[a]||[];h=0;for(k=d.length;h<k;h++)if(d[h])try{d[h].apply(null,g)}catch(l){f(l)}else d.splice(h,1),h--,k--;if(!(d=c.$$listenerCount[a]&&c.$$childHead||c!==this&&c.$$nextSibling))for(;c!==this&&!(d=c.$$nextSibling);)c=c.$parent}e.currentScope=
null;return e}};var w=new m,v=w.$$asyncQueue=[],u=w.$$postDigestQueue=[],t=w.$$applyAsyncQueue=[];return w}]}function le(){var a=/^\s*(https?|ftp|mailto|tel|file):/,b=/^\s*((https?|ftp|file|blob):|data:image\/)/;this.aHrefSanitizationWhitelist=function(b){return A(b)?(a=b,this):a};this.imgSrcSanitizationWhitelist=function(a){return A(a)?(b=a,this):b};this.$get=function(){return function(d,c){var e=c?b:a,f;f=sa(d).href;return""===f||f.match(e)?d:"unsafe:"+f}}}function kg(a){if("self"===a)return a;
if(y(a)){if(-1<a.indexOf("***"))throw ua("iwcard",a);a=ud(a).replace("\\*\\*",".*").replace("\\*","[^:/.?&;]*");return new RegExp("^"+a+"$")}if(Za(a))return new RegExp("^"+a.source+"$");throw ua("imatcher");}function vd(a){var b=[];A(a)&&q(a,function(a){b.push(kg(a))});return b}function wf(){this.SCE_CONTEXTS=ma;var a=["self"],b=[];this.resourceUrlWhitelist=function(b){arguments.length&&(a=vd(b));return a};this.resourceUrlBlacklist=function(a){arguments.length&&(b=vd(a));return b};this.$get=["$injector",
function(d){function c(a,b){return"self"===a?gd(b):!!a.exec(b.href)}function e(a){var b=function(a){this.$$unwrapTrustedValue=function(){return a}};a&&(b.prototype=new a);b.prototype.valueOf=function(){return this.$$unwrapTrustedValue()};b.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()};return b}var f=function(a){throw ua("unsafe");};d.has("$sanitize")&&(f=d.get("$sanitize"));var g=e(),h={};h[ma.HTML]=e(g);h[ma.CSS]=e(g);h[ma.URL]=e(g);h[ma.JS]=e(g);h[ma.RESOURCE_URL]=
e(h[ma.URL]);return{trustAs:function(a,b){var c=h.hasOwnProperty(a)?h[a]:null;if(!c)throw ua("icontext",a,b);if(null===b||z(b)||""===b)return b;if("string"!==typeof b)throw ua("itype",a);return new c(b)},getTrusted:function(d,e){if(null===e||z(e)||""===e)return e;var g=h.hasOwnProperty(d)?h[d]:null;if(g&&e instanceof g)return e.$$unwrapTrustedValue();if(d===ma.RESOURCE_URL){var g=sa(e.toString()),n,p,q=!1;n=0;for(p=a.length;n<p;n++)if(c(a[n],g)){q=!0;break}if(q)for(n=0,p=b.length;n<p;n++)if(c(b[n],
g)){q=!1;break}if(q)return e;throw ua("insecurl",e.toString());}if(d===ma.HTML)return f(e);throw ua("unsafe");},valueOf:function(a){return a instanceof g?a.$$unwrapTrustedValue():a}}}]}function vf(){var a=!0;this.enabled=function(b){arguments.length&&(a=!!b);return a};this.$get=["$parse","$sceDelegate",function(b,d){if(a&&8>Da)throw ua("iequirks");var c=ia(ma);c.isEnabled=function(){return a};c.trustAs=d.trustAs;c.getTrusted=d.getTrusted;c.valueOf=d.valueOf;a||(c.trustAs=c.getTrusted=function(a,b){return b},
c.valueOf=$a);c.parseAs=function(a,d){var e=b(d);return e.literal&&e.constant?e:b(d,function(b){return c.getTrusted(a,b)})};var e=c.parseAs,f=c.getTrusted,g=c.trustAs;q(ma,function(a,b){var d=N(b);c[fb("parse_as_"+d)]=function(b){return e(a,b)};c[fb("get_trusted_"+d)]=function(b){return f(a,b)};c[fb("trust_as_"+d)]=function(b){return g(a,b)}});return c}]}function xf(){this.$get=["$window","$document",function(a,b){var d={},c=!(a.chrome&&a.chrome.app&&a.chrome.app.runtime)&&a.history&&a.history.pushState,
e=Y((/android (\d+)/.exec(N((a.navigator||{}).userAgent))||[])[1]),f=/Boxee/i.test((a.navigator||{}).userAgent),g=b[0]||{},h,k=/^(Moz|webkit|ms)(?=[A-Z])/,l=g.body&&g.body.style,m=!1,n=!1;if(l){for(var p in l)if(m=k.exec(p)){h=m[0];h=h.substr(0,1).toUpperCase()+h.substr(1);break}h||(h="WebkitOpacity"in l&&"webkit");m=!!("transition"in l||h+"Transition"in l);n=!!("animation"in l||h+"Animation"in l);!e||m&&n||(m=y(l.webkitTransition),n=y(l.webkitAnimation))}return{history:!(!c||4>e||f),hasEvent:function(a){if("input"===
a&&11>=Da)return!1;if(z(d[a])){var b=g.createElement("div");d[a]="on"+a in b}return d[a]},csp:Ga(),vendorPrefix:h,transitions:m,animations:n,android:e}}]}function zf(){var a;this.httpOptions=function(b){return b?(a=b,this):a};this.$get=["$templateCache","$http","$q","$sce",function(b,d,c,e){function f(g,h){f.totalPendingRequests++;y(g)&&b.get(g)||(g=e.getTrustedResourceUrl(g));var k=d.defaults&&d.defaults.transformResponse;M(k)?k=k.filter(function(a){return a!==ac}):k===ac&&(k=null);return d.get(g,
S({cache:b,transformResponse:k},a))["finally"](function(){f.totalPendingRequests--}).then(function(a){b.put(g,a.data);return a.data},function(a){if(!h)throw lg("tpload",g,a.status,a.statusText);return c.reject(a)})}f.totalPendingRequests=0;return f}]}function Af(){this.$get=["$rootScope","$browser","$location",function(a,b,d){return{findBindings:function(a,b,d){a=a.getElementsByClassName("ng-binding");var g=[];q(a,function(a){var c=ea.element(a).data("$binding");c&&q(c,function(c){d?(new RegExp("(^|\\s)"+
ud(b)+"(\\s|\\||$)")).test(c)&&g.push(a):-1!=c.indexOf(b)&&g.push(a)})});return g},findModels:function(a,b,d){for(var g=["ng-","data-ng-","ng\\:"],h=0;h<g.length;++h){var k=a.querySelectorAll("["+g[h]+"model"+(d?"=":"*=")+'"'+b+'"]');if(k.length)return k}},getLocation:function(){return d.url()},setLocation:function(b){b!==d.url()&&(d.url(b),a.$digest())},whenStable:function(a){b.notifyWhenNoOutstandingRequests(a)}}}]}function Bf(){this.$get=["$rootScope","$browser","$q","$$q","$exceptionHandler",
function(a,b,d,c,e){function f(f,k,l){D(f)||(l=k,k=f,f=E);var m=Aa.call(arguments,3),n=A(l)&&!l,p=(n?c:d).defer(),q=p.promise,s;s=b.defer(function(){try{p.resolve(f.apply(null,m))}catch(b){p.reject(b),e(b)}finally{delete g[q.$$timeoutId]}n||a.$apply()},k);q.$$timeoutId=s;g[s]=p;return q}var g={};f.cancel=function(a){return a&&a.$$timeoutId in g?(g[a.$$timeoutId].reject("canceled"),delete g[a.$$timeoutId],b.defer.cancel(a.$$timeoutId)):!1};return f}]}function sa(a){Da&&(Z.setAttribute("href",a),a=
Z.href);Z.setAttribute("href",a);return{href:Z.href,protocol:Z.protocol?Z.protocol.replace(/:$/,""):"",host:Z.host,search:Z.search?Z.search.replace(/^\?/,""):"",hash:Z.hash?Z.hash.replace(/^#/,""):"",hostname:Z.hostname,port:Z.port,pathname:"/"===Z.pathname.charAt(0)?Z.pathname:"/"+Z.pathname}}function gd(a){a=y(a)?sa(a):a;return a.protocol===wd.protocol&&a.host===wd.host}function Cf(){this.$get=da(T)}function xd(a){function b(a){try{return decodeURIComponent(a)}catch(b){return a}}var d=a[0]||{},
c={},e="";return function(){var a,g,h,k,l;a=d.cookie||"";if(a!==e)for(e=a,a=e.split("; "),c={},h=0;h<a.length;h++)g=a[h],k=g.indexOf("="),0<k&&(l=b(g.substring(0,k)),z(c[l])&&(c[l]=b(g.substring(k+1))));return c}}function Gf(){this.$get=xd}function Jc(a){function b(d,c){if(J(d)){var e={};q(d,function(a,c){e[c]=b(c,a)});return e}return a.factory(d+"Filter",c)}this.register=b;this.$get=["$injector",function(a){return function(b){return a.get(b+"Filter")}}];b("currency",yd);b("date",zd);b("filter",mg);
b("json",ng);b("limitTo",og);b("lowercase",pg);b("number",Ad);b("orderBy",Bd);b("uppercase",qg)}function mg(){return function(a,b,d){if(!za(a)){if(null==a)return a;throw O("filter")("notarray",a);}var c;switch(ic(b)){case "function":break;case "boolean":case "null":case "number":case "string":c=!0;case "object":b=rg(b,d,c);break;default:return a}return Array.prototype.filter.call(a,b)}}function rg(a,b,d){var c=J(a)&&"$"in a;!0===b?b=na:D(b)||(b=function(a,b){if(z(a))return!1;if(null===a||null===b)return a===
b;if(J(b)||J(a)&&!rc(a))return!1;a=N(""+a);b=N(""+b);return-1!==a.indexOf(b)});return function(e){return c&&!J(e)?Ma(e,a.$,b,!1):Ma(e,a,b,d)}}function Ma(a,b,d,c,e){var f=ic(a),g=ic(b);if("string"===g&&"!"===b.charAt(0))return!Ma(a,b.substring(1),d,c);if(M(a))return a.some(function(a){return Ma(a,b,d,c)});switch(f){case "object":var h;if(c){for(h in a)if("$"!==h.charAt(0)&&Ma(a[h],b,d,!0))return!0;return e?!1:Ma(a,b,d,!1)}if("object"===g){for(h in b)if(e=b[h],!D(e)&&!z(e)&&(f="$"===h,!Ma(f?a:a[h],
e,d,f,f)))return!1;return!0}return d(a,b);case "function":return!1;default:return d(a,b)}}function ic(a){return null===a?"null":typeof a}function yd(a){var b=a.NUMBER_FORMATS;return function(a,c,e){z(c)&&(c=b.CURRENCY_SYM);z(e)&&(e=b.PATTERNS[1].maxFrac);return null==a?a:Cd(a,b.PATTERNS[1],b.GROUP_SEP,b.DECIMAL_SEP,e).replace(/\u00A4/g,c)}}function Ad(a){var b=a.NUMBER_FORMATS;return function(a,c){return null==a?a:Cd(a,b.PATTERNS[0],b.GROUP_SEP,b.DECIMAL_SEP,c)}}function sg(a){var b=0,d,c,e,f,g;-1<
(c=a.indexOf(Dd))&&(a=a.replace(Dd,""));0<(e=a.search(/e/i))?(0>c&&(c=e),c+=+a.slice(e+1),a=a.substring(0,e)):0>c&&(c=a.length);for(e=0;a.charAt(e)==jc;e++);if(e==(g=a.length))d=[0],c=1;else{for(g--;a.charAt(g)==jc;)g--;c-=e;d=[];for(f=0;e<=g;e++,f++)d[f]=+a.charAt(e)}c>Ed&&(d=d.splice(0,Ed-1),b=c-1,c=1);return{d:d,e:b,i:c}}function tg(a,b,d,c){var e=a.d,f=e.length-a.i;b=z(b)?Math.min(Math.max(d,f),c):+b;d=b+a.i;c=e[d];if(0<d){e.splice(Math.max(a.i,d));for(var g=d;g<e.length;g++)e[g]=0}else for(f=
Math.max(0,f),a.i=1,e.length=Math.max(1,d=b+1),e[0]=0,g=1;g<d;g++)e[g]=0;if(5<=c)if(0>d-1){for(c=0;c>d;c--)e.unshift(0),a.i++;e.unshift(1);a.i++}else e[d-1]++;for(;f<Math.max(0,b);f++)e.push(0);if(b=e.reduceRight(function(a,b,c,d){b+=a;d[c]=b%10;return Math.floor(b/10)},0))e.unshift(b),a.i++}function Cd(a,b,d,c,e){if(!y(a)&&!R(a)||isNaN(a))return"";var f=!isFinite(a),g=!1,h=Math.abs(a)+"",k="";if(f)k="\u221e";else{g=sg(h);tg(g,e,b.minFrac,b.maxFrac);k=g.d;h=g.i;e=g.e;f=[];for(g=k.reduce(function(a,
b){return a&&!b},!0);0>h;)k.unshift(0),h++;0<h?f=k.splice(h):(f=k,k=[0]);h=[];for(k.length>=b.lgSize&&h.unshift(k.splice(-b.lgSize).join(""));k.length>b.gSize;)h.unshift(k.splice(-b.gSize).join(""));k.length&&h.unshift(k.join(""));k=h.join(d);f.length&&(k+=c+f.join(""));e&&(k+="e+"+e)}return 0>a&&!g?b.negPre+k+b.negSuf:b.posPre+k+b.posSuf}function Jb(a,b,d,c){var e="";if(0>a||c&&0>=a)c?a=-a+1:(a=-a,e="-");for(a=""+a;a.length<b;)a=jc+a;d&&(a=a.substr(a.length-b));return e+a}function X(a,b,d,c,e){d=
d||0;return function(f){f=f["get"+a]();if(0<d||f>-d)f+=d;0===f&&-12==d&&(f=12);return Jb(f,b,c,e)}}function lb(a,b,d){return function(c,e){var f=c["get"+a](),g=vb((d?"STANDALONE":"")+(b?"SHORT":"")+a);return e[g][f]}}function Fd(a){var b=(new Date(a,0,1)).getDay();return new Date(a,0,(4>=b?5:12)-b)}function Gd(a){return function(b){var d=Fd(b.getFullYear());b=+new Date(b.getFullYear(),b.getMonth(),b.getDate()+(4-b.getDay()))-+d;b=1+Math.round(b/6048E5);return Jb(b,a)}}function kc(a,b){return 0>=a.getFullYear()?
b.ERAS[0]:b.ERAS[1]}function zd(a){function b(a){var b;if(b=a.match(d)){a=new Date(0);var f=0,g=0,h=b[8]?a.setUTCFullYear:a.setFullYear,k=b[8]?a.setUTCHours:a.setHours;b[9]&&(f=Y(b[9]+b[10]),g=Y(b[9]+b[11]));h.call(a,Y(b[1]),Y(b[2])-1,Y(b[3]));f=Y(b[4]||0)-f;g=Y(b[5]||0)-g;h=Y(b[6]||0);b=Math.round(1E3*parseFloat("0."+(b[7]||0)));k.call(a,f,g,h,b)}return a}var d=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(c,d,f){var g="",h=
[],k,l;d=d||"mediumDate";d=a.DATETIME_FORMATS[d]||d;y(c)&&(c=ug.test(c)?Y(c):b(c));R(c)&&(c=new Date(c));if(!fa(c)||!isFinite(c.getTime()))return c;for(;d;)(l=vg.exec(d))?(h=cb(h,l,1),d=h.pop()):(h.push(d),d=null);var m=c.getTimezoneOffset();f&&(m=vc(f,m),c=Rb(c,f,!0));q(h,function(b){k=wg[b];g+=k?k(c,a.DATETIME_FORMATS,m):"''"===b?"'":b.replace(/(^'|'$)/g,"").replace(/''/g,"'")});return g}}function ng(){return function(a,b){z(b)&&(b=2);return db(a,b)}}function og(){return function(a,b,d){b=Infinity===
Math.abs(Number(b))?Number(b):Y(b);if(isNaN(b))return a;R(a)&&(a=a.toString());if(!M(a)&&!y(a))return a;d=!d||isNaN(d)?0:Y(d);d=0>d?Math.max(0,a.length+d):d;return 0<=b?a.slice(d,d+b):0===d?a.slice(b,a.length):a.slice(Math.max(0,d+b),d)}}function Bd(a){function b(b,d){d=d?-1:1;return b.map(function(b){var c=1,h=$a;if(D(b))h=b;else if(y(b)){if("+"==b.charAt(0)||"-"==b.charAt(0))c="-"==b.charAt(0)?-1:1,b=b.substring(1);if(""!==b&&(h=a(b),h.constant))var k=h(),h=function(a){return a[k]}}return{get:h,
descending:c*d}})}function d(a){switch(typeof a){case "number":case "boolean":case "string":return!0;default:return!1}}return function(a,e,f){if(null==a)return a;if(!za(a))throw O("orderBy")("notarray",a);M(e)||(e=[e]);0===e.length&&(e=["+"]);var g=b(e,f);g.push({get:function(){return{}},descending:f?-1:1});a=Array.prototype.map.call(a,function(a,b){return{value:a,predicateValues:g.map(function(c){var e=c.get(a);c=typeof e;if(null===e)c="string",e="null";else if("string"===c)e=e.toLowerCase();else if("object"===
c)a:{if("function"===typeof e.valueOf&&(e=e.valueOf(),d(e)))break a;if(rc(e)&&(e=e.toString(),d(e)))break a;e=b}return{value:e,type:c}})}});a.sort(function(a,b){for(var c=0,d=0,e=g.length;d<e;++d){var c=a.predicateValues[d],f=b.predicateValues[d],q=0;c.type===f.type?c.value!==f.value&&(q=c.value<f.value?-1:1):q=c.type<f.type?-1:1;if(c=q*g[d].descending)break}return c});return a=a.map(function(a){return a.value})}}function Na(a){D(a)&&(a={link:a});a.restrict=a.restrict||"AC";return da(a)}function Hd(a,
b,d,c,e){var f=this,g=[];f.$error={};f.$$success={};f.$pending=u;f.$name=e(b.name||b.ngForm||"")(d);f.$dirty=!1;f.$pristine=!0;f.$valid=!0;f.$invalid=!1;f.$submitted=!1;f.$$parentForm=Kb;f.$rollbackViewValue=function(){q(g,function(a){a.$rollbackViewValue()})};f.$commitViewValue=function(){q(g,function(a){a.$commitViewValue()})};f.$addControl=function(a){Ta(a.$name,"input");g.push(a);a.$name&&(f[a.$name]=a);a.$$parentForm=f};f.$$renameControl=function(a,b){var c=a.$name;f[c]===a&&delete f[c];f[b]=
a;a.$name=b};f.$removeControl=function(a){a.$name&&f[a.$name]===a&&delete f[a.$name];q(f.$pending,function(b,c){f.$setValidity(c,null,a)});q(f.$error,function(b,c){f.$setValidity(c,null,a)});q(f.$$success,function(b,c){f.$setValidity(c,null,a)});bb(g,a);a.$$parentForm=Kb};Id({ctrl:this,$element:a,set:function(a,b,c){var d=a[b];d?-1===d.indexOf(c)&&d.push(c):a[b]=[c]},unset:function(a,b,c){var d=a[b];d&&(bb(d,c),0===d.length&&delete a[b])},$animate:c});f.$setDirty=function(){c.removeClass(a,Xa);c.addClass(a,
Lb);f.$dirty=!0;f.$pristine=!1;f.$$parentForm.$setDirty()};f.$setPristine=function(){c.setClass(a,Xa,Lb+" ng-submitted");f.$dirty=!1;f.$pristine=!0;f.$submitted=!1;q(g,function(a){a.$setPristine()})};f.$setUntouched=function(){q(g,function(a){a.$setUntouched()})};f.$setSubmitted=function(){c.addClass(a,"ng-submitted");f.$submitted=!0;f.$$parentForm.$setSubmitted()}}function lc(a){a.$formatters.push(function(b){return a.$isEmpty(b)?b:b.toString()})}function mb(a,b,d,c,e,f){var g=N(b[0].type);if(!e.android){var h=
!1;b.on("compositionstart",function(){h=!0});b.on("compositionend",function(){h=!1;l()})}var k,l=function(a){k&&(f.defer.cancel(k),k=null);if(!h){var e=b.val();a=a&&a.type;"password"===g||d.ngTrim&&"false"===d.ngTrim||(e=W(e));(c.$viewValue!==e||""===e&&c.$$hasNativeValidators)&&c.$setViewValue(e,a)}};if(e.hasEvent("input"))b.on("input",l);else{var m=function(a,b,c){k||(k=f.defer(function(){k=null;b&&b.value===c||l(a)}))};b.on("keydown",function(a){var b=a.keyCode;91===b||15<b&&19>b||37<=b&&40>=b||
m(a,this,this.value)});if(e.hasEvent("paste"))b.on("paste cut",m)}b.on("change",l);if(Jd[g]&&c.$$hasNativeValidators&&g===d.type)b.on("keydown wheel mousedown",function(a){if(!k){var b=this.validity,c=b.badInput,d=b.typeMismatch;k=f.defer(function(){k=null;b.badInput===c&&b.typeMismatch===d||l(a)})}});c.$render=function(){var a=c.$isEmpty(c.$viewValue)?"":c.$viewValue;b.val()!==a&&b.val(a)}}function Mb(a,b){return function(d,c){var e,f;if(fa(d))return d;if(y(d)){'"'==d.charAt(0)&&'"'==d.charAt(d.length-
1)&&(d=d.substring(1,d.length-1));if(xg.test(d))return new Date(d);a.lastIndex=0;if(e=a.exec(d))return e.shift(),f=c?{yyyy:c.getFullYear(),MM:c.getMonth()+1,dd:c.getDate(),HH:c.getHours(),mm:c.getMinutes(),ss:c.getSeconds(),sss:c.getMilliseconds()/1E3}:{yyyy:1970,MM:1,dd:1,HH:0,mm:0,ss:0,sss:0},q(e,function(a,c){c<b.length&&(f[b[c]]=+a)}),new Date(f.yyyy,f.MM-1,f.dd,f.HH,f.mm,f.ss||0,1E3*f.sss||0)}return NaN}}function nb(a,b,d,c){return function(e,f,g,h,k,l,m){function n(a){return a&&!(a.getTime&&
a.getTime()!==a.getTime())}function p(a){return A(a)&&!fa(a)?d(a)||u:a}Kd(e,f,g,h);mb(e,f,g,h,k,l);var q=h&&h.$options&&h.$options.timezone,s;h.$$parserName=a;h.$parsers.push(function(a){return h.$isEmpty(a)?null:b.test(a)?(a=d(a,s),q&&(a=Rb(a,q)),a):u});h.$formatters.push(function(a){if(a&&!fa(a))throw ob("datefmt",a);if(n(a))return(s=a)&&q&&(s=Rb(s,q,!0)),m("date")(a,c,q);s=null;return""});if(A(g.min)||g.ngMin){var x;h.$validators.min=function(a){return!n(a)||z(x)||d(a)>=x};g.$observe("min",function(a){x=
p(a);h.$validate()})}if(A(g.max)||g.ngMax){var r;h.$validators.max=function(a){return!n(a)||z(r)||d(a)<=r};g.$observe("max",function(a){r=p(a);h.$validate()})}}}function Kd(a,b,d,c){(c.$$hasNativeValidators=J(b[0].validity))&&c.$parsers.push(function(a){var c=b.prop("validity")||{};return c.badInput||c.typeMismatch?u:a})}function Ld(a,b,d,c,e){if(A(c)){a=a(c);if(!a.constant)throw ob("constexpr",d,c);return a(b)}return e}function mc(a,b){a="ngClass"+a;return["$animate",function(d){function c(a,b){var c=
[],d=0;a:for(;d<a.length;d++){for(var e=a[d],m=0;m<b.length;m++)if(e==b[m])continue a;c.push(e)}return c}function e(a){var b=[];return M(a)?(q(a,function(a){b=b.concat(e(a))}),b):y(a)?a.split(" "):J(a)?(q(a,function(a,c){a&&(b=b.concat(c.split(" ")))}),b):a}return{restrict:"AC",link:function(f,g,h){function k(a,b){var c=g.data("$classCounts")||V(),d=[];q(a,function(a){if(0<b||c[a])c[a]=(c[a]||0)+b,c[a]===+(0<b)&&d.push(a)});g.data("$classCounts",c);return d.join(" ")}function l(a){if(!0===b||f.$index%
2===b){var l=e(a||[]);if(!m){var q=k(l,1);h.$addClass(q)}else if(!na(a,m)){var s=e(m),q=c(l,s),l=c(s,l),q=k(q,1),l=k(l,-1);q&&q.length&&d.addClass(g,q);l&&l.length&&d.removeClass(g,l)}}m=ia(a)}var m;f.$watch(h[a],l,!0);h.$observe("class",function(b){l(f.$eval(h[a]))});"ngClass"!==a&&f.$watch("$index",function(c,d){var g=c&1;if(g!==(d&1)){var l=e(f.$eval(h[a]));g===b?(g=k(l,1),h.$addClass(g)):(g=k(l,-1),h.$removeClass(g))}})}}}]}function Id(a){function b(a,b){b&&!f[a]?(k.addClass(e,a),f[a]=!0):!b&&
f[a]&&(k.removeClass(e,a),f[a]=!1)}function d(a,c){a=a?"-"+zc(a,"-"):"";b(pb+a,!0===c);b(Md+a,!1===c)}var c=a.ctrl,e=a.$element,f={},g=a.set,h=a.unset,k=a.$animate;f[Md]=!(f[pb]=e.hasClass(pb));c.$setValidity=function(a,e,f){z(e)?(c.$pending||(c.$pending={}),g(c.$pending,a,f)):(c.$pending&&h(c.$pending,a,f),Nd(c.$pending)&&(c.$pending=u));Oa(e)?e?(h(c.$error,a,f),g(c.$$success,a,f)):(g(c.$error,a,f),h(c.$$success,a,f)):(h(c.$error,a,f),h(c.$$success,a,f));c.$pending?(b(Od,!0),c.$valid=c.$invalid=
u,d("",null)):(b(Od,!1),c.$valid=Nd(c.$error),c.$invalid=!c.$valid,d("",c.$valid));e=c.$pending&&c.$pending[a]?u:c.$error[a]?!1:c.$$success[a]?!0:null;d(a,e);c.$$parentForm.$setValidity(a,e,c)}}function Nd(a){if(a)for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}var yg=/^\/(.+)\/([a-z]*)$/,va=Object.prototype.hasOwnProperty,N=function(a){return y(a)?a.toLowerCase():a},vb=function(a){return y(a)?a.toUpperCase():a},Da,H,$,Aa=[].slice,Yf=[].splice,zg=[].push,ka=Object.prototype.toString,sc=Object.getPrototypeOf,
Ba=O("ng"),ea=T.angular||(T.angular={}),Tb,qb=0;Da=P.documentMode;E.$inject=[];$a.$inject=[];var M=Array.isArray,Zd=/^\[object (?:Uint8|Uint8Clamped|Uint16|Uint32|Int8|Int16|Int32|Float32|Float64)Array\]$/,W=function(a){return y(a)?a.trim():a},ud=function(a){return a.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},Ga=function(){if(!A(Ga.rules)){var a=P.querySelector("[ng-csp]")||P.querySelector("[data-ng-csp]");if(a){var b=a.getAttribute("ng-csp")||a.getAttribute("data-ng-csp");
Ga.rules={noUnsafeEval:!b||-1!==b.indexOf("no-unsafe-eval"),noInlineStyle:!b||-1!==b.indexOf("no-inline-style")}}else{a=Ga;try{new Function(""),b=!1}catch(d){b=!0}a.rules={noUnsafeEval:b,noInlineStyle:!1}}}return Ga.rules},sb=function(){if(A(sb.name_))return sb.name_;var a,b,d=Qa.length,c,e;for(b=0;b<d;++b)if(c=Qa[b],a=P.querySelector("["+c.replace(":","\\:")+"jq]")){e=a.getAttribute(c+"jq");break}return sb.name_=e},be=/:/g,Qa=["ng-","data-ng-","ng:","x-ng-"],ge=/[A-Z]/g,Ac=!1,Pa=3,ke={full:"1.5.3",
major:1,minor:5,dot:3,codeName:"diplohaplontic-meiosis"};U.expando="ng339";var hb=U.cache={},Mf=1;U._data=function(a){return this.cache[a[this.expando]]||{}};var Hf=/([\:\-\_]+(.))/g,If=/^moz([A-Z])/,zb={mouseleave:"mouseout",mouseenter:"mouseover"},Vb=O("jqLite"),Lf=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,Ub=/<|&#?\w+;/,Jf=/<([\w:-]+)/,Kf=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,ha={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,
"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ha.optgroup=ha.option;ha.tbody=ha.tfoot=ha.colgroup=ha.caption=ha.thead;ha.th=ha.td;var Rf=Node.prototype.contains||function(a){return!!(this.compareDocumentPosition(a)&16)},Ra=U.prototype={ready:function(a){function b(){d||(d=!0,a())}var d=!1;"complete"===P.readyState?setTimeout(b):(this.on("DOMContentLoaded",b),U(T).on("load",b))},toString:function(){var a=
[];q(this,function(b){a.push(""+b)});return"["+a.join(", ")+"]"},eq:function(a){return 0<=a?H(this[a]):H(this[this.length+a])},length:0,push:zg,sort:[].sort,splice:[].splice},Eb={};q("multiple selected checked disabled readOnly required open".split(" "),function(a){Eb[N(a)]=a});var Sc={};q("input select option textarea button form details".split(" "),function(a){Sc[a]=!0});var $c={ngMinlength:"minlength",ngMaxlength:"maxlength",ngMin:"min",ngMax:"max",ngPattern:"pattern"};q({data:Xb,removeData:gb,
hasData:function(a){for(var b in hb[a.ng339])return!0;return!1},cleanData:function(a){for(var b=0,d=a.length;b<d;b++)gb(a[b])}},function(a,b){U[b]=a});q({data:Xb,inheritedData:Db,scope:function(a){return H.data(a,"$scope")||Db(a.parentNode||a,["$isolateScope","$scope"])},isolateScope:function(a){return H.data(a,"$isolateScope")||H.data(a,"$isolateScopeNoTemplate")},controller:Pc,injector:function(a){return Db(a,"$injector")},removeAttr:function(a,b){a.removeAttribute(b)},hasClass:Ab,css:function(a,
b,d){b=fb(b);if(A(d))a.style[b]=d;else return a.style[b]},attr:function(a,b,d){var c=a.nodeType;if(c!==Pa&&2!==c&&8!==c)if(c=N(b),Eb[c])if(A(d))d?(a[b]=!0,a.setAttribute(b,c)):(a[b]=!1,a.removeAttribute(c));else return a[b]||(a.attributes.getNamedItem(b)||E).specified?c:u;else if(A(d))a.setAttribute(b,d);else if(a.getAttribute)return a=a.getAttribute(b,2),null===a?u:a},prop:function(a,b,d){if(A(d))a[b]=d;else return a[b]},text:function(){function a(a,d){if(z(d)){var c=a.nodeType;return 1===c||c===
Pa?a.textContent:""}a.textContent=d}a.$dv="";return a}(),val:function(a,b){if(z(b)){if(a.multiple&&"select"===oa(a)){var d=[];q(a.options,function(a){a.selected&&d.push(a.value||a.text)});return 0===d.length?null:d}return a.value}a.value=b},html:function(a,b){if(z(b))return a.innerHTML;xb(a,!0);a.innerHTML=b},empty:Qc},function(a,b){U.prototype[b]=function(b,c){var e,f,g=this.length;if(a!==Qc&&z(2==a.length&&a!==Ab&&a!==Pc?b:c)){if(J(b)){for(e=0;e<g;e++)if(a===Xb)a(this[e],b);else for(f in b)a(this[e],
f,b[f]);return this}e=a.$dv;g=z(e)?Math.min(g,1):g;for(f=0;f<g;f++){var h=a(this[f],b,c);e=e?e+h:h}return e}for(e=0;e<g;e++)a(this[e],b,c);return this}});q({removeData:gb,on:function(a,b,d,c){if(A(c))throw Vb("onargs");if(Kc(a)){c=yb(a,!0);var e=c.events,f=c.handle;f||(f=c.handle=Of(a,e));c=0<=b.indexOf(" ")?b.split(" "):[b];for(var g=c.length,h=function(b,c,g){var h=e[b];h||(h=e[b]=[],h.specialHandlerWrapper=c,"$destroy"===b||g||a.addEventListener(b,f,!1));h.push(d)};g--;)b=c[g],zb[b]?(h(zb[b],Qf),
h(b,u,!0)):h(b)}},off:Oc,one:function(a,b,d){a=H(a);a.on(b,function e(){a.off(b,d);a.off(b,e)});a.on(b,d)},replaceWith:function(a,b){var d,c=a.parentNode;xb(a);q(new U(b),function(b){d?c.insertBefore(b,d.nextSibling):c.replaceChild(b,a);d=b})},children:function(a){var b=[];q(a.childNodes,function(a){1===a.nodeType&&b.push(a)});return b},contents:function(a){return a.contentDocument||a.childNodes||[]},append:function(a,b){var d=a.nodeType;if(1===d||11===d){b=new U(b);for(var d=0,c=b.length;d<c;d++)a.appendChild(b[d])}},
prepend:function(a,b){if(1===a.nodeType){var d=a.firstChild;q(new U(b),function(b){a.insertBefore(b,d)})}},wrap:function(a,b){Mc(a,H(b).eq(0).clone()[0])},remove:Yb,detach:function(a){Yb(a,!0)},after:function(a,b){var d=a,c=a.parentNode;b=new U(b);for(var e=0,f=b.length;e<f;e++){var g=b[e];c.insertBefore(g,d.nextSibling);d=g}},addClass:Cb,removeClass:Bb,toggleClass:function(a,b,d){b&&q(b.split(" "),function(b){var e=d;z(e)&&(e=!Ab(a,b));(e?Cb:Bb)(a,b)})},parent:function(a){return(a=a.parentNode)&&
11!==a.nodeType?a:null},next:function(a){return a.nextElementSibling},find:function(a,b){return a.getElementsByTagName?a.getElementsByTagName(b):[]},clone:Wb,triggerHandler:function(a,b,d){var c,e,f=b.type||b,g=yb(a);if(g=(g=g&&g.events)&&g[f])c={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return!0===this.defaultPrevented},stopImmediatePropagation:function(){this.immediatePropagationStopped=!0},isImmediatePropagationStopped:function(){return!0===this.immediatePropagationStopped},
stopPropagation:E,type:f,target:a},b.type&&(c=S(c,b)),b=ia(g),e=d?[c].concat(d):[c],q(b,function(b){c.isImmediatePropagationStopped()||b.apply(a,e)})}},function(a,b){U.prototype[b]=function(b,c,e){for(var f,g=0,h=this.length;g<h;g++)z(f)?(f=a(this[g],b,c,e),A(f)&&(f=H(f))):Nc(f,a(this[g],b,c,e));return A(f)?f:this};U.prototype.bind=U.prototype.on;U.prototype.unbind=U.prototype.off});Ua.prototype={put:function(a,b){this[Ha(a,this.nextUid)]=b},get:function(a){return this[Ha(a,this.nextUid)]},remove:function(a){var b=
this[a=Ha(a,this.nextUid)];delete this[a];return b}};var Ff=[function(){this.$get=[function(){return Ua}]}],Tf=/^([^\(]+?)=>/,Uf=/^[^\(]*\(\s*([^\)]*)\)/m,Ag=/,/,Bg=/^\s*(_?)(\S+?)\1\s*$/,Sf=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,Ia=O("$injector");eb.$$annotate=function(a,b,d){var c;if("function"===typeof a){if(!(c=a.$inject)){c=[];if(a.length){if(b)throw y(d)&&d||(d=a.name||Vf(a)),Ia("strictdi",d);b=Tc(a);q(b[1].split(Ag),function(a){a.replace(Bg,function(a,b,d){c.push(d)})})}a.$inject=c}}else M(a)?
(b=a.length-1,Sa(a[b],"fn"),c=a.slice(0,b)):Sa(a,"fn",!0);return c};var Pd=O("$animate"),Ye=function(){this.$get=E},Ze=function(){var a=new Ua,b=[];this.$get=["$$AnimateRunner","$rootScope",function(d,c){function e(a,b,c){var d=!1;b&&(b=y(b)?b.split(" "):M(b)?b:[],q(b,function(b){b&&(d=!0,a[b]=c)}));return d}function f(){q(b,function(b){var c=a.get(b);if(c){var d=Wf(b.attr("class")),e="",f="";q(c,function(a,b){a!==!!d[b]&&(a?e+=(e.length?" ":"")+b:f+=(f.length?" ":"")+b)});q(b,function(a){e&&Cb(a,
e);f&&Bb(a,f)});a.remove(b)}});b.length=0}return{enabled:E,on:E,off:E,pin:E,push:function(g,h,k,l){l&&l();k=k||{};k.from&&g.css(k.from);k.to&&g.css(k.to);if(k.addClass||k.removeClass)if(h=k.addClass,l=k.removeClass,k=a.get(g)||{},h=e(k,h,!0),l=e(k,l,!1),h||l)a.put(g,k),b.push(g),1===b.length&&c.$$postDigest(f);g=new d;g.complete();return g}}}]},We=["$provide",function(a){var b=this;this.$$registeredAnimations=Object.create(null);this.register=function(d,c){if(d&&"."!==d.charAt(0))throw Pd("notcsel",
d);var e=d+"-animation";b.$$registeredAnimations[d.substr(1)]=e;a.factory(e,c)};this.classNameFilter=function(a){if(1===arguments.length&&(this.$$classNameFilter=a instanceof RegExp?a:null)&&/(\s+|\/)ng-animate(\s+|\/)/.test(this.$$classNameFilter.toString()))throw Pd("nongcls","ng-animate");return this.$$classNameFilter};this.$get=["$$animateQueue",function(a){function b(a,c,d){if(d){var h;a:{for(h=0;h<d.length;h++){var k=d[h];if(1===k.nodeType){h=k;break a}}h=void 0}!h||h.parentNode||h.previousElementSibling||
(d=null)}d?d.after(a):c.prepend(a)}return{on:a.on,off:a.off,pin:a.pin,enabled:a.enabled,cancel:function(a){a.end&&a.end()},enter:function(e,f,g,h){f=f&&H(f);g=g&&H(g);f=f||g.parent();b(e,f,g);return a.push(e,"enter",Ja(h))},move:function(e,f,g,h){f=f&&H(f);g=g&&H(g);f=f||g.parent();b(e,f,g);return a.push(e,"move",Ja(h))},leave:function(b,c){return a.push(b,"leave",Ja(c),function(){b.remove()})},addClass:function(b,c,g){g=Ja(g);g.addClass=ib(g.addclass,c);return a.push(b,"addClass",g)},removeClass:function(b,
c,g){g=Ja(g);g.removeClass=ib(g.removeClass,c);return a.push(b,"removeClass",g)},setClass:function(b,c,g,h){h=Ja(h);h.addClass=ib(h.addClass,c);h.removeClass=ib(h.removeClass,g);return a.push(b,"setClass",h)},animate:function(b,c,g,h,k){k=Ja(k);k.from=k.from?S(k.from,c):c;k.to=k.to?S(k.to,g):g;k.tempClasses=ib(k.tempClasses,h||"ng-inline-animate");return a.push(b,"animate",k)}}}]}],af=function(){this.$get=["$$rAF",function(a){function b(b){d.push(b);1<d.length||a(function(){for(var a=0;a<d.length;a++)d[a]();
d=[]})}var d=[];return function(){var a=!1;b(function(){a=!0});return function(d){a?d():b(d)}}}]},$e=function(){this.$get=["$q","$sniffer","$$animateAsyncRun","$document","$timeout",function(a,b,d,c,e){function f(a){this.setHost(a);var b=d();this._doneCallbacks=[];this._tick=function(a){var d=c[0];d&&d.hidden?e(a,0,!1):b(a)};this._state=0}f.chain=function(a,b){function c(){if(d===a.length)b(!0);else a[d](function(a){!1===a?b(!1):(d++,c())})}var d=0;c()};f.all=function(a,b){function c(f){e=e&&f;++d===
a.length&&b(e)}var d=0,e=!0;q(a,function(a){a.done(c)})};f.prototype={setHost:function(a){this.host=a||{}},done:function(a){2===this._state?a():this._doneCallbacks.push(a)},progress:E,getPromise:function(){if(!this.promise){var b=this;this.promise=a(function(a,c){b.done(function(b){!1===b?c():a()})})}return this.promise},then:function(a,b){return this.getPromise().then(a,b)},"catch":function(a){return this.getPromise()["catch"](a)},"finally":function(a){return this.getPromise()["finally"](a)},pause:function(){this.host.pause&&
this.host.pause()},resume:function(){this.host.resume&&this.host.resume()},end:function(){this.host.end&&this.host.end();this._resolve(!0)},cancel:function(){this.host.cancel&&this.host.cancel();this._resolve(!1)},complete:function(a){var b=this;0===b._state&&(b._state=1,b._tick(function(){b._resolve(a)}))},_resolve:function(a){2!==this._state&&(q(this._doneCallbacks,function(b){b(a)}),this._doneCallbacks.length=0,this._state=2)}};return f}]},Xe=function(){this.$get=["$$rAF","$q","$$AnimateRunner",
function(a,b,d){return function(b,e){function f(){a(function(){g.addClass&&(b.addClass(g.addClass),g.addClass=null);g.removeClass&&(b.removeClass(g.removeClass),g.removeClass=null);g.to&&(b.css(g.to),g.to=null);h||k.complete();h=!0});return k}var g=e||{};g.$$prepared||(g=pa(g));g.cleanupStyles&&(g.from=g.to=null);g.from&&(b.css(g.from),g.from=null);var h,k=new d;return{start:f,end:f}}}]},ga=O("$compile");Cc.$inject=["$provide","$$sanitizeUriProvider"];var Vc=/^((?:x|data)[\:\-_])/i,Zf=O("$controller"),
ad=/^(\S+)(\s+as\s+([\w$]+))?$/,gf=function(){this.$get=["$document",function(a){return function(b){b?!b.nodeType&&b instanceof H&&(b=b[0]):b=a[0].body;return b.offsetWidth+1}}]},bd="application/json",bc={"Content-Type":bd+";charset=utf-8"},ag=/^\[|^\{(?!\{)/,bg={"[":/]$/,"{":/}$/},$f=/^\)\]\}',?\n/,Cg=O("$http"),fd=function(a){return function(){throw Cg("legacy",a);}},La=ea.$interpolateMinErr=O("$interpolate");La.throwNoconcat=function(a){throw La("noconcat",a);};La.interr=function(a,b){return La("interr",
a,b.toString())};var Dg=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,dg={http:80,https:443,ftp:21},Fb=O("$location"),Eg={$$html5:!1,$$replace:!1,absUrl:Gb("$$absUrl"),url:function(a){if(z(a))return this.$$url;var b=Dg.exec(a);(b[1]||""===a)&&this.path(decodeURIComponent(b[1]));(b[2]||b[1]||""===a)&&this.search(b[3]||"");this.hash(b[5]||"");return this},protocol:Gb("$$protocol"),host:Gb("$$host"),port:Gb("$$port"),path:kd("$$path",function(a){a=null!==a?a.toString():"";return"/"==a.charAt(0)?a:"/"+a}),search:function(a,
b){switch(arguments.length){case 0:return this.$$search;case 1:if(y(a)||R(a))a=a.toString(),this.$$search=xc(a);else if(J(a))a=pa(a,{}),q(a,function(b,c){null==b&&delete a[c]}),this.$$search=a;else throw Fb("isrcharg");break;default:z(b)||null===b?delete this.$$search[a]:this.$$search[a]=b}this.$$compose();return this},hash:kd("$$hash",function(a){return null!==a?a.toString():""}),replace:function(){this.$$replace=!0;return this}};q([jd,ec,dc],function(a){a.prototype=Object.create(Eg);a.prototype.state=
function(b){if(!arguments.length)return this.$$state;if(a!==dc||!this.$$html5)throw Fb("nostate");this.$$state=z(b)?null:b;return this}});var ca=O("$parse"),fg=Function.prototype.call,gg=Function.prototype.apply,hg=Function.prototype.bind,Nb=V();q("+ - * / % === !== == != < > <= >= && || ! = |".split(" "),function(a){Nb[a]=!0});var Fg={n:"\n",f:"\f",r:"\r",t:"\t",v:"\v","'":"'",'"':'"'},gc=function(a){this.options=a};gc.prototype={constructor:gc,lex:function(a){this.text=a;this.index=0;for(this.tokens=
[];this.index<this.text.length;)if(a=this.text.charAt(this.index),'"'===a||"'"===a)this.readString(a);else if(this.isNumber(a)||"."===a&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdent(a))this.readIdent();else if(this.is(a,"(){}[].,;:?"))this.tokens.push({index:this.index,text:a}),this.index++;else if(this.isWhitespace(a))this.index++;else{var b=a+this.peek(),d=b+this.peek(2),c=Nb[b],e=Nb[d];Nb[a]||c||e?(a=e?d:c?b:a,this.tokens.push({index:this.index,text:a,operator:!0}),this.index+=
a.length):this.throwError("Unexpected next character ",this.index,this.index+1)}return this.tokens},is:function(a,b){return-1!==b.indexOf(a)},peek:function(a){a=a||1;return this.index+a<this.text.length?this.text.charAt(this.index+a):!1},isNumber:function(a){return"0"<=a&&"9">=a&&"string"===typeof a},isWhitespace:function(a){return" "===a||"\r"===a||"\t"===a||"\n"===a||"\v"===a||"\u00a0"===a},isIdent:function(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a||"_"===a||"$"===a},isExpOperator:function(a){return"-"===
a||"+"===a||this.isNumber(a)},throwError:function(a,b,d){d=d||this.index;b=A(b)?"s "+b+"-"+this.index+" ["+this.text.substring(b,d)+"]":" "+d;throw ca("lexerr",a,b,this.text);},readNumber:function(){for(var a="",b=this.index;this.index<this.text.length;){var d=N(this.text.charAt(this.index));if("."==d||this.isNumber(d))a+=d;else{var c=this.peek();if("e"==d&&this.isExpOperator(c))a+=d;else if(this.isExpOperator(d)&&c&&this.isNumber(c)&&"e"==a.charAt(a.length-1))a+=d;else if(!this.isExpOperator(d)||
c&&this.isNumber(c)||"e"!=a.charAt(a.length-1))break;else this.throwError("Invalid exponent")}this.index++}this.tokens.push({index:b,text:a,constant:!0,value:Number(a)})},readIdent:function(){for(var a=this.index;this.index<this.text.length;){var b=this.text.charAt(this.index);if(!this.isIdent(b)&&!this.isNumber(b))break;this.index++}this.tokens.push({index:a,text:this.text.slice(a,this.index),identifier:!0})},readString:function(a){var b=this.index;this.index++;for(var d="",c=a,e=!1;this.index<this.text.length;){var f=
this.text.charAt(this.index),c=c+f;if(e)"u"===f?(e=this.text.substring(this.index+1,this.index+5),e.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+e+"]"),this.index+=4,d+=String.fromCharCode(parseInt(e,16))):d+=Fg[f]||f,e=!1;else if("\\"===f)e=!0;else{if(f===a){this.index++;this.tokens.push({index:b,text:c,constant:!0,value:d});return}d+=f}this.index++}this.throwError("Unterminated quote",b)}};var s=function(a,b){this.lexer=a;this.options=b};s.Program="Program";s.ExpressionStatement=
"ExpressionStatement";s.AssignmentExpression="AssignmentExpression";s.ConditionalExpression="ConditionalExpression";s.LogicalExpression="LogicalExpression";s.BinaryExpression="BinaryExpression";s.UnaryExpression="UnaryExpression";s.CallExpression="CallExpression";s.MemberExpression="MemberExpression";s.Identifier="Identifier";s.Literal="Literal";s.ArrayExpression="ArrayExpression";s.Property="Property";s.ObjectExpression="ObjectExpression";s.ThisExpression="ThisExpression";s.LocalsExpression="LocalsExpression";
s.NGValueParameter="NGValueParameter";s.prototype={ast:function(a){this.text=a;this.tokens=this.lexer.lex(a);a=this.program();0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]);return a},program:function(){for(var a=[];;)if(0<this.tokens.length&&!this.peek("}",")",";","]")&&a.push(this.expressionStatement()),!this.expect(";"))return{type:s.Program,body:a}},expressionStatement:function(){return{type:s.ExpressionStatement,expression:this.filterChain()}},filterChain:function(){for(var a=
this.expression();this.expect("|");)a=this.filter(a);return a},expression:function(){return this.assignment()},assignment:function(){var a=this.ternary();this.expect("=")&&(a={type:s.AssignmentExpression,left:a,right:this.assignment(),operator:"="});return a},ternary:function(){var a=this.logicalOR(),b,d;return this.expect("?")&&(b=this.expression(),this.consume(":"))?(d=this.expression(),{type:s.ConditionalExpression,test:a,alternate:b,consequent:d}):a},logicalOR:function(){for(var a=this.logicalAND();this.expect("||");)a=
{type:s.LogicalExpression,operator:"||",left:a,right:this.logicalAND()};return a},logicalAND:function(){for(var a=this.equality();this.expect("&&");)a={type:s.LogicalExpression,operator:"&&",left:a,right:this.equality()};return a},equality:function(){for(var a=this.relational(),b;b=this.expect("==","!=","===","!==");)a={type:s.BinaryExpression,operator:b.text,left:a,right:this.relational()};return a},relational:function(){for(var a=this.additive(),b;b=this.expect("<",">","<=",">=");)a={type:s.BinaryExpression,
operator:b.text,left:a,right:this.additive()};return a},additive:function(){for(var a=this.multiplicative(),b;b=this.expect("+","-");)a={type:s.BinaryExpression,operator:b.text,left:a,right:this.multiplicative()};return a},multiplicative:function(){for(var a=this.unary(),b;b=this.expect("*","/","%");)a={type:s.BinaryExpression,operator:b.text,left:a,right:this.unary()};return a},unary:function(){var a;return(a=this.expect("+","-","!"))?{type:s.UnaryExpression,operator:a.text,prefix:!0,argument:this.unary()}:
this.primary()},primary:function(){var a;this.expect("(")?(a=this.filterChain(),this.consume(")")):this.expect("[")?a=this.arrayDeclaration():this.expect("{")?a=this.object():this.selfReferential.hasOwnProperty(this.peek().text)?a=pa(this.selfReferential[this.consume().text]):this.options.literals.hasOwnProperty(this.peek().text)?a={type:s.Literal,value:this.options.literals[this.consume().text]}:this.peek().identifier?a=this.identifier():this.peek().constant?a=this.constant():this.throwError("not a primary expression",
this.peek());for(var b;b=this.expect("(","[",".");)"("===b.text?(a={type:s.CallExpression,callee:a,arguments:this.parseArguments()},this.consume(")")):"["===b.text?(a={type:s.MemberExpression,object:a,property:this.expression(),computed:!0},this.consume("]")):"."===b.text?a={type:s.MemberExpression,object:a,property:this.identifier(),computed:!1}:this.throwError("IMPOSSIBLE");return a},filter:function(a){a=[a];for(var b={type:s.CallExpression,callee:this.identifier(),arguments:a,filter:!0};this.expect(":");)a.push(this.expression());
return b},parseArguments:function(){var a=[];if(")"!==this.peekToken().text){do a.push(this.expression());while(this.expect(","))}return a},identifier:function(){var a=this.consume();a.identifier||this.throwError("is not a valid identifier",a);return{type:s.Identifier,name:a.text}},constant:function(){return{type:s.Literal,value:this.consume().value}},arrayDeclaration:function(){var a=[];if("]"!==this.peekToken().text){do{if(this.peek("]"))break;a.push(this.expression())}while(this.expect(","))}this.consume("]");
return{type:s.ArrayExpression,elements:a}},object:function(){var a=[],b;if("}"!==this.peekToken().text){do{if(this.peek("}"))break;b={type:s.Property,kind:"init"};this.peek().constant?b.key=this.constant():this.peek().identifier?b.key=this.identifier():this.throwError("invalid key",this.peek());this.consume(":");b.value=this.expression();a.push(b)}while(this.expect(","))}this.consume("}");return{type:s.ObjectExpression,properties:a}},throwError:function(a,b){throw ca("syntax",b.text,a,b.index+1,this.text,
this.text.substring(b.index));},consume:function(a){if(0===this.tokens.length)throw ca("ueoe",this.text);var b=this.expect(a);b||this.throwError("is unexpected, expecting ["+a+"]",this.peek());return b},peekToken:function(){if(0===this.tokens.length)throw ca("ueoe",this.text);return this.tokens[0]},peek:function(a,b,d,c){return this.peekAhead(0,a,b,d,c)},peekAhead:function(a,b,d,c,e){if(this.tokens.length>a){a=this.tokens[a];var f=a.text;if(f===b||f===d||f===c||f===e||!(b||d||c||e))return a}return!1},
expect:function(a,b,d,c){return(a=this.peek(a,b,d,c))?(this.tokens.shift(),a):!1},selfReferential:{"this":{type:s.ThisExpression},$locals:{type:s.LocalsExpression}}};rd.prototype={compile:function(a,b){var d=this,c=this.astBuilder.ast(a);this.state={nextId:0,filters:{},expensiveChecks:b,fn:{vars:[],body:[],own:{}},assign:{vars:[],body:[],own:{}},inputs:[]};aa(c,d.$filter);var e="",f;this.stage="assign";if(f=pd(c))this.state.computing="assign",e=this.nextId(),this.recurse(f,e),this.return_(e),e="fn.assign="+
this.generateFunction("assign","s,v,l");f=nd(c.body);d.stage="inputs";q(f,function(a,b){var c="fn"+b;d.state[c]={vars:[],body:[],own:{}};d.state.computing=c;var e=d.nextId();d.recurse(a,e);d.return_(e);d.state.inputs.push(c);a.watchId=b});this.state.computing="fn";this.stage="main";this.recurse(c);e='"'+this.USE+" "+this.STRICT+'";\n'+this.filterPrefix()+"var fn="+this.generateFunction("fn","s,l,a,i")+e+this.watchFns()+"return fn;";e=(new Function("$filter","ensureSafeMemberName","ensureSafeObject",
"ensureSafeFunction","getStringValue","ensureSafeAssignContext","ifDefined","plus","text",e))(this.$filter,Wa,ta,ld,eg,Hb,ig,md,a);this.state=this.stage=u;e.literal=qd(c);e.constant=c.constant;return e},USE:"use",STRICT:"strict",watchFns:function(){var a=[],b=this.state.inputs,d=this;q(b,function(b){a.push("var "+b+"="+d.generateFunction(b,"s"))});b.length&&a.push("fn.inputs=["+b.join(",")+"];");return a.join("")},generateFunction:function(a,b){return"function("+b+"){"+this.varsPrefix(a)+this.body(a)+
"};"},filterPrefix:function(){var a=[],b=this;q(this.state.filters,function(d,c){a.push(d+"=$filter("+b.escape(c)+")")});return a.length?"var "+a.join(",")+";":""},varsPrefix:function(a){return this.state[a].vars.length?"var "+this.state[a].vars.join(",")+";":""},body:function(a){return this.state[a].body.join("")},recurse:function(a,b,d,c,e,f){var g,h,k=this,l,m;c=c||E;if(!f&&A(a.watchId))b=b||this.nextId(),this.if_("i",this.lazyAssign(b,this.computedMember("i",a.watchId)),this.lazyRecurse(a,b,d,
c,e,!0));else switch(a.type){case s.Program:q(a.body,function(b,c){k.recurse(b.expression,u,u,function(a){h=a});c!==a.body.length-1?k.current().body.push(h,";"):k.return_(h)});break;case s.Literal:m=this.escape(a.value);this.assign(b,m);c(m);break;case s.UnaryExpression:this.recurse(a.argument,u,u,function(a){h=a});m=a.operator+"("+this.ifDefined(h,0)+")";this.assign(b,m);c(m);break;case s.BinaryExpression:this.recurse(a.left,u,u,function(a){g=a});this.recurse(a.right,u,u,function(a){h=a});m="+"===
a.operator?this.plus(g,h):"-"===a.operator?this.ifDefined(g,0)+a.operator+this.ifDefined(h,0):"("+g+")"+a.operator+"("+h+")";this.assign(b,m);c(m);break;case s.LogicalExpression:b=b||this.nextId();k.recurse(a.left,b);k.if_("&&"===a.operator?b:k.not(b),k.lazyRecurse(a.right,b));c(b);break;case s.ConditionalExpression:b=b||this.nextId();k.recurse(a.test,b);k.if_(b,k.lazyRecurse(a.alternate,b),k.lazyRecurse(a.consequent,b));c(b);break;case s.Identifier:b=b||this.nextId();d&&(d.context="inputs"===k.stage?
"s":this.assign(this.nextId(),this.getHasOwnProperty("l",a.name)+"?l:s"),d.computed=!1,d.name=a.name);Wa(a.name);k.if_("inputs"===k.stage||k.not(k.getHasOwnProperty("l",a.name)),function(){k.if_("inputs"===k.stage||"s",function(){e&&1!==e&&k.if_(k.not(k.nonComputedMember("s",a.name)),k.lazyAssign(k.nonComputedMember("s",a.name),"{}"));k.assign(b,k.nonComputedMember("s",a.name))})},b&&k.lazyAssign(b,k.nonComputedMember("l",a.name)));(k.state.expensiveChecks||Ib(a.name))&&k.addEnsureSafeObject(b);c(b);
break;case s.MemberExpression:g=d&&(d.context=this.nextId())||this.nextId();b=b||this.nextId();k.recurse(a.object,g,u,function(){k.if_(k.notNull(g),function(){e&&1!==e&&k.addEnsureSafeAssignContext(g);if(a.computed)h=k.nextId(),k.recurse(a.property,h),k.getStringValue(h),k.addEnsureSafeMemberName(h),e&&1!==e&&k.if_(k.not(k.computedMember(g,h)),k.lazyAssign(k.computedMember(g,h),"{}")),m=k.ensureSafeObject(k.computedMember(g,h)),k.assign(b,m),d&&(d.computed=!0,d.name=h);else{Wa(a.property.name);e&&
1!==e&&k.if_(k.not(k.nonComputedMember(g,a.property.name)),k.lazyAssign(k.nonComputedMember(g,a.property.name),"{}"));m=k.nonComputedMember(g,a.property.name);if(k.state.expensiveChecks||Ib(a.property.name))m=k.ensureSafeObject(m);k.assign(b,m);d&&(d.computed=!1,d.name=a.property.name)}},function(){k.assign(b,"undefined")});c(b)},!!e);break;case s.CallExpression:b=b||this.nextId();a.filter?(h=k.filter(a.callee.name),l=[],q(a.arguments,function(a){var b=k.nextId();k.recurse(a,b);l.push(b)}),m=h+"("+
l.join(",")+")",k.assign(b,m),c(b)):(h=k.nextId(),g={},l=[],k.recurse(a.callee,h,g,function(){k.if_(k.notNull(h),function(){k.addEnsureSafeFunction(h);q(a.arguments,function(a){k.recurse(a,k.nextId(),u,function(a){l.push(k.ensureSafeObject(a))})});g.name?(k.state.expensiveChecks||k.addEnsureSafeObject(g.context),m=k.member(g.context,g.name,g.computed)+"("+l.join(",")+")"):m=h+"("+l.join(",")+")";m=k.ensureSafeObject(m);k.assign(b,m)},function(){k.assign(b,"undefined")});c(b)}));break;case s.AssignmentExpression:h=
this.nextId();g={};if(!od(a.left))throw ca("lval");this.recurse(a.left,u,g,function(){k.if_(k.notNull(g.context),function(){k.recurse(a.right,h);k.addEnsureSafeObject(k.member(g.context,g.name,g.computed));k.addEnsureSafeAssignContext(g.context);m=k.member(g.context,g.name,g.computed)+a.operator+h;k.assign(b,m);c(b||m)})},1);break;case s.ArrayExpression:l=[];q(a.elements,function(a){k.recurse(a,k.nextId(),u,function(a){l.push(a)})});m="["+l.join(",")+"]";this.assign(b,m);c(m);break;case s.ObjectExpression:l=
[];q(a.properties,function(a){k.recurse(a.value,k.nextId(),u,function(b){l.push(k.escape(a.key.type===s.Identifier?a.key.name:""+a.key.value)+":"+b)})});m="{"+l.join(",")+"}";this.assign(b,m);c(m);break;case s.ThisExpression:this.assign(b,"s");c("s");break;case s.LocalsExpression:this.assign(b,"l");c("l");break;case s.NGValueParameter:this.assign(b,"v"),c("v")}},getHasOwnProperty:function(a,b){var d=a+"."+b,c=this.current().own;c.hasOwnProperty(d)||(c[d]=this.nextId(!1,a+"&&("+this.escape(b)+" in "+
a+")"));return c[d]},assign:function(a,b){if(a)return this.current().body.push(a,"=",b,";"),a},filter:function(a){this.state.filters.hasOwnProperty(a)||(this.state.filters[a]=this.nextId(!0));return this.state.filters[a]},ifDefined:function(a,b){return"ifDefined("+a+","+this.escape(b)+")"},plus:function(a,b){return"plus("+a+","+b+")"},return_:function(a){this.current().body.push("return ",a,";")},if_:function(a,b,d){if(!0===a)b();else{var c=this.current().body;c.push("if(",a,"){");b();c.push("}");
d&&(c.push("else{"),d(),c.push("}"))}},not:function(a){return"!("+a+")"},notNull:function(a){return a+"!=null"},nonComputedMember:function(a,b){return a+"."+b},computedMember:function(a,b){return a+"["+b+"]"},member:function(a,b,d){return d?this.computedMember(a,b):this.nonComputedMember(a,b)},addEnsureSafeObject:function(a){this.current().body.push(this.ensureSafeObject(a),";")},addEnsureSafeMemberName:function(a){this.current().body.push(this.ensureSafeMemberName(a),";")},addEnsureSafeFunction:function(a){this.current().body.push(this.ensureSafeFunction(a),
";")},addEnsureSafeAssignContext:function(a){this.current().body.push(this.ensureSafeAssignContext(a),";")},ensureSafeObject:function(a){return"ensureSafeObject("+a+",text)"},ensureSafeMemberName:function(a){return"ensureSafeMemberName("+a+",text)"},ensureSafeFunction:function(a){return"ensureSafeFunction("+a+",text)"},getStringValue:function(a){this.assign(a,"getStringValue("+a+")")},ensureSafeAssignContext:function(a){return"ensureSafeAssignContext("+a+",text)"},lazyRecurse:function(a,b,d,c,e,f){var g=
this;return function(){g.recurse(a,b,d,c,e,f)}},lazyAssign:function(a,b){var d=this;return function(){d.assign(a,b)}},stringEscapeRegex:/[^ a-zA-Z0-9]/g,stringEscapeFn:function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)},escape:function(a){if(y(a))return"'"+a.replace(this.stringEscapeRegex,this.stringEscapeFn)+"'";if(R(a))return a.toString();if(!0===a)return"true";if(!1===a)return"false";if(null===a)return"null";if("undefined"===typeof a)return"undefined";throw ca("esc");},nextId:function(a,
b){var d="v"+this.state.nextId++;a||this.current().vars.push(d+(b?"="+b:""));return d},current:function(){return this.state[this.state.computing]}};sd.prototype={compile:function(a,b){var d=this,c=this.astBuilder.ast(a);this.expression=a;this.expensiveChecks=b;aa(c,d.$filter);var e,f;if(e=pd(c))f=this.recurse(e);e=nd(c.body);var g;e&&(g=[],q(e,function(a,b){var c=d.recurse(a);a.input=c;g.push(c);a.watchId=b}));var h=[];q(c.body,function(a){h.push(d.recurse(a.expression))});e=0===c.body.length?E:1===
c.body.length?h[0]:function(a,b){var c;q(h,function(d){c=d(a,b)});return c};f&&(e.assign=function(a,b,c){return f(a,c,b)});g&&(e.inputs=g);e.literal=qd(c);e.constant=c.constant;return e},recurse:function(a,b,d){var c,e,f=this,g;if(a.input)return this.inputs(a.input,a.watchId);switch(a.type){case s.Literal:return this.value(a.value,b);case s.UnaryExpression:return e=this.recurse(a.argument),this["unary"+a.operator](e,b);case s.BinaryExpression:return c=this.recurse(a.left),e=this.recurse(a.right),
this["binary"+a.operator](c,e,b);case s.LogicalExpression:return c=this.recurse(a.left),e=this.recurse(a.right),this["binary"+a.operator](c,e,b);case s.ConditionalExpression:return this["ternary?:"](this.recurse(a.test),this.recurse(a.alternate),this.recurse(a.consequent),b);case s.Identifier:return Wa(a.name,f.expression),f.identifier(a.name,f.expensiveChecks||Ib(a.name),b,d,f.expression);case s.MemberExpression:return c=this.recurse(a.object,!1,!!d),a.computed||(Wa(a.property.name,f.expression),
e=a.property.name),a.computed&&(e=this.recurse(a.property)),a.computed?this.computedMember(c,e,b,d,f.expression):this.nonComputedMember(c,e,f.expensiveChecks,b,d,f.expression);case s.CallExpression:return g=[],q(a.arguments,function(a){g.push(f.recurse(a))}),a.filter&&(e=this.$filter(a.callee.name)),a.filter||(e=this.recurse(a.callee,!0)),a.filter?function(a,c,d,f){for(var n=[],p=0;p<g.length;++p)n.push(g[p](a,c,d,f));a=e.apply(u,n,f);return b?{context:u,name:u,value:a}:a}:function(a,c,d,m){var n=
e(a,c,d,m),p;if(null!=n.value){ta(n.context,f.expression);ld(n.value,f.expression);p=[];for(var q=0;q<g.length;++q)p.push(ta(g[q](a,c,d,m),f.expression));p=ta(n.value.apply(n.context,p),f.expression)}return b?{value:p}:p};case s.AssignmentExpression:return c=this.recurse(a.left,!0,1),e=this.recurse(a.right),function(a,d,g,m){var n=c(a,d,g,m);a=e(a,d,g,m);ta(n.value,f.expression);Hb(n.context);n.context[n.name]=a;return b?{value:a}:a};case s.ArrayExpression:return g=[],q(a.elements,function(a){g.push(f.recurse(a))}),
function(a,c,d,e){for(var f=[],p=0;p<g.length;++p)f.push(g[p](a,c,d,e));return b?{value:f}:f};case s.ObjectExpression:return g=[],q(a.properties,function(a){g.push({key:a.key.type===s.Identifier?a.key.name:""+a.key.value,value:f.recurse(a.value)})}),function(a,c,d,e){for(var f={},p=0;p<g.length;++p)f[g[p].key]=g[p].value(a,c,d,e);return b?{value:f}:f};case s.ThisExpression:return function(a){return b?{value:a}:a};case s.LocalsExpression:return function(a,c){return b?{value:c}:c};case s.NGValueParameter:return function(a,
c,d){return b?{value:d}:d}}},"unary+":function(a,b){return function(d,c,e,f){d=a(d,c,e,f);d=A(d)?+d:0;return b?{value:d}:d}},"unary-":function(a,b){return function(d,c,e,f){d=a(d,c,e,f);d=A(d)?-d:0;return b?{value:d}:d}},"unary!":function(a,b){return function(d,c,e,f){d=!a(d,c,e,f);return b?{value:d}:d}},"binary+":function(a,b,d){return function(c,e,f,g){var h=a(c,e,f,g);c=b(c,e,f,g);h=md(h,c);return d?{value:h}:h}},"binary-":function(a,b,d){return function(c,e,f,g){var h=a(c,e,f,g);c=b(c,e,f,g);
h=(A(h)?h:0)-(A(c)?c:0);return d?{value:h}:h}},"binary*":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)*b(c,e,f,g);return d?{value:c}:c}},"binary/":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)/b(c,e,f,g);return d?{value:c}:c}},"binary%":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)%b(c,e,f,g);return d?{value:c}:c}},"binary===":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)===b(c,e,f,g);return d?{value:c}:c}},"binary!==":function(a,b,d){return function(c,e,f,g){c=a(c,
e,f,g)!==b(c,e,f,g);return d?{value:c}:c}},"binary==":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)==b(c,e,f,g);return d?{value:c}:c}},"binary!=":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)!=b(c,e,f,g);return d?{value:c}:c}},"binary<":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)<b(c,e,f,g);return d?{value:c}:c}},"binary>":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)>b(c,e,f,g);return d?{value:c}:c}},"binary<=":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,
g)<=b(c,e,f,g);return d?{value:c}:c}},"binary>=":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)>=b(c,e,f,g);return d?{value:c}:c}},"binary&&":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)&&b(c,e,f,g);return d?{value:c}:c}},"binary||":function(a,b,d){return function(c,e,f,g){c=a(c,e,f,g)||b(c,e,f,g);return d?{value:c}:c}},"ternary?:":function(a,b,d,c){return function(e,f,g,h){e=a(e,f,g,h)?b(e,f,g,h):d(e,f,g,h);return c?{value:e}:e}},value:function(a,b){return function(){return b?{context:u,
name:u,value:a}:a}},identifier:function(a,b,d,c,e){return function(f,g,h,k){f=g&&a in g?g:f;c&&1!==c&&f&&!f[a]&&(f[a]={});g=f?f[a]:u;b&&ta(g,e);return d?{context:f,name:a,value:g}:g}},computedMember:function(a,b,d,c,e){return function(f,g,h,k){var l=a(f,g,h,k),m,n;null!=l&&(m=b(f,g,h,k),m+="",Wa(m,e),c&&1!==c&&(Hb(l),l&&!l[m]&&(l[m]={})),n=l[m],ta(n,e));return d?{context:l,name:m,value:n}:n}},nonComputedMember:function(a,b,d,c,e,f){return function(g,h,k,l){g=a(g,h,k,l);e&&1!==e&&(Hb(g),g&&!g[b]&&
(g[b]={}));h=null!=g?g[b]:u;(d||Ib(b))&&ta(h,f);return c?{context:g,name:b,value:h}:h}},inputs:function(a,b){return function(d,c,e,f){return f?f[b]:a(d,c,e)}}};var hc=function(a,b,d){this.lexer=a;this.$filter=b;this.options=d;this.ast=new s(a,d);this.astCompiler=d.csp?new sd(this.ast,b):new rd(this.ast,b)};hc.prototype={constructor:hc,parse:function(a){return this.astCompiler.compile(a,this.options.expensiveChecks)}};var jg=Object.prototype.valueOf,ua=O("$sce"),ma={HTML:"html",CSS:"css",URL:"url",
RESOURCE_URL:"resourceUrl",JS:"js"},lg=O("$compile"),Z=P.createElement("a"),wd=sa(T.location.href);xd.$inject=["$document"];Jc.$inject=["$provide"];var Ed=22,Dd=".",jc="0";yd.$inject=["$locale"];Ad.$inject=["$locale"];var wg={yyyy:X("FullYear",4,0,!1,!0),yy:X("FullYear",2,0,!0,!0),y:X("FullYear",1,0,!1,!0),MMMM:lb("Month"),MMM:lb("Month",!0),MM:X("Month",2,1),M:X("Month",1,1),LLLL:lb("Month",!1,!0),dd:X("Date",2),d:X("Date",1),HH:X("Hours",2),H:X("Hours",1),hh:X("Hours",2,-12),h:X("Hours",1,-12),
mm:X("Minutes",2),m:X("Minutes",1),ss:X("Seconds",2),s:X("Seconds",1),sss:X("Milliseconds",3),EEEE:lb("Day"),EEE:lb("Day",!0),a:function(a,b){return 12>a.getHours()?b.AMPMS[0]:b.AMPMS[1]},Z:function(a,b,d){a=-1*d;return a=(0<=a?"+":"")+(Jb(Math[0<a?"floor":"ceil"](a/60),2)+Jb(Math.abs(a%60),2))},ww:Gd(2),w:Gd(1),G:kc,GG:kc,GGG:kc,GGGG:function(a,b){return 0>=a.getFullYear()?b.ERANAMES[0]:b.ERANAMES[1]}},vg=/((?:[^yMLdHhmsaZEwG']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|L+|d+|H+|h+|m+|s+|a|Z|G+|w+))(.*)/,
ug=/^\-?\d+$/;zd.$inject=["$locale"];var pg=da(N),qg=da(vb);Bd.$inject=["$parse"];var me=da({restrict:"E",compile:function(a,b){if(!b.href&&!b.xlinkHref)return function(a,b){if("a"===b[0].nodeName.toLowerCase()){var e="[object SVGAnimatedString]"===ka.call(b.prop("href"))?"xlink:href":"href";b.on("click",function(a){b.attr(e)||a.preventDefault()})}}}}),wb={};q(Eb,function(a,b){function d(a,d,e){a.$watch(e[c],function(a){e.$set(b,!!a)})}if("multiple"!=a){var c=ya("ng-"+b),e=d;"checked"===a&&(e=function(a,
b,e){e.ngModel!==e[c]&&d(a,b,e)});wb[c]=function(){return{restrict:"A",priority:100,link:e}}}});q($c,function(a,b){wb[b]=function(){return{priority:100,link:function(a,c,e){if("ngPattern"===b&&"/"==e.ngPattern.charAt(0)&&(c=e.ngPattern.match(yg))){e.$set("ngPattern",new RegExp(c[1],c[2]));return}a.$watch(e[b],function(a){e.$set(b,a)})}}}});q(["src","srcset","href"],function(a){var b=ya("ng-"+a);wb[b]=function(){return{priority:99,link:function(d,c,e){var f=a,g=a;"href"===a&&"[object SVGAnimatedString]"===
ka.call(c.prop("href"))&&(g="xlinkHref",e.$attr[g]="xlink:href",f=null);e.$observe(b,function(b){b?(e.$set(g,b),Da&&f&&c.prop(f,e[g])):"href"===a&&e.$set(g,null)})}}}});var Kb={$addControl:E,$$renameControl:function(a,b){a.$name=b},$removeControl:E,$setValidity:E,$setDirty:E,$setPristine:E,$setSubmitted:E};Hd.$inject=["$element","$attrs","$scope","$animate","$interpolate"];var Qd=function(a){return["$timeout","$parse",function(b,d){function c(a){return""===a?d('this[""]').assign:d(a).assign||E}return{name:"form",
restrict:a?"EAC":"E",require:["form","^^?form"],controller:Hd,compile:function(d,f){d.addClass(Xa).addClass(pb);var g=f.name?"name":a&&f.ngForm?"ngForm":!1;return{pre:function(a,d,e,f){var n=f[0];if(!("action"in e)){var p=function(b){a.$apply(function(){n.$commitViewValue();n.$setSubmitted()});b.preventDefault()};d[0].addEventListener("submit",p,!1);d.on("$destroy",function(){b(function(){d[0].removeEventListener("submit",p,!1)},0,!1)})}(f[1]||n.$$parentForm).$addControl(n);var q=g?c(n.$name):E;g&&
(q(a,n),e.$observe(g,function(b){n.$name!==b&&(q(a,u),n.$$parentForm.$$renameControl(n,b),q=c(n.$name),q(a,n))}));d.on("$destroy",function(){n.$$parentForm.$removeControl(n);q(a,u);S(n,Kb)})}}}}}]},ne=Qd(),Ae=Qd(!0),xg=/^\d{4,}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+(?:[+-][0-2]\d:[0-5]\d|Z)$/,Gg=/^[a-z][a-z\d.+-]*:\/*(?:[^:@]+(?::[^@]+)?@)?(?:[^\s:/?#]+|\[[a-f\d:]+\])(?::\d+)?(?:\/[^?#]*)?(?:\?[^#]*)?(?:#.*)?$/i,Hg=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,
Ig=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))([eE][+-]?\d+)?\s*$/,Rd=/^(\d{4,})-(\d{2})-(\d{2})$/,Sd=/^(\d{4,})-(\d\d)-(\d\d)T(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,nc=/^(\d{4,})-W(\d\d)$/,Td=/^(\d{4,})-(\d\d)$/,Ud=/^(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,Jd=V();q(["date","datetime-local","month","time","week"],function(a){Jd[a]=!0});var Vd={text:function(a,b,d,c,e,f){mb(a,b,d,c,e,f);lc(c)},date:nb("date",Rd,Mb(Rd,["yyyy","MM","dd"]),"yyyy-MM-dd"),"datetime-local":nb("datetimelocal",Sd,Mb(Sd,"yyyy MM dd HH mm ss sss".split(" ")),
"yyyy-MM-ddTHH:mm:ss.sss"),time:nb("time",Ud,Mb(Ud,["HH","mm","ss","sss"]),"HH:mm:ss.sss"),week:nb("week",nc,function(a,b){if(fa(a))return a;if(y(a)){nc.lastIndex=0;var d=nc.exec(a);if(d){var c=+d[1],e=+d[2],f=d=0,g=0,h=0,k=Fd(c),e=7*(e-1);b&&(d=b.getHours(),f=b.getMinutes(),g=b.getSeconds(),h=b.getMilliseconds());return new Date(c,0,k.getDate()+e,d,f,g,h)}}return NaN},"yyyy-Www"),month:nb("month",Td,Mb(Td,["yyyy","MM"]),"yyyy-MM"),number:function(a,b,d,c,e,f){Kd(a,b,d,c);mb(a,b,d,c,e,f);c.$$parserName=
"number";c.$parsers.push(function(a){return c.$isEmpty(a)?null:Ig.test(a)?parseFloat(a):u});c.$formatters.push(function(a){if(!c.$isEmpty(a)){if(!R(a))throw ob("numfmt",a);a=a.toString()}return a});if(A(d.min)||d.ngMin){var g;c.$validators.min=function(a){return c.$isEmpty(a)||z(g)||a>=g};d.$observe("min",function(a){A(a)&&!R(a)&&(a=parseFloat(a,10));g=R(a)&&!isNaN(a)?a:u;c.$validate()})}if(A(d.max)||d.ngMax){var h;c.$validators.max=function(a){return c.$isEmpty(a)||z(h)||a<=h};d.$observe("max",function(a){A(a)&&
!R(a)&&(a=parseFloat(a,10));h=R(a)&&!isNaN(a)?a:u;c.$validate()})}},url:function(a,b,d,c,e,f){mb(a,b,d,c,e,f);lc(c);c.$$parserName="url";c.$validators.url=function(a,b){var d=a||b;return c.$isEmpty(d)||Gg.test(d)}},email:function(a,b,d,c,e,f){mb(a,b,d,c,e,f);lc(c);c.$$parserName="email";c.$validators.email=function(a,b){var d=a||b;return c.$isEmpty(d)||Hg.test(d)}},radio:function(a,b,d,c){z(d.name)&&b.attr("name",++qb);b.on("click",function(a){b[0].checked&&c.$setViewValue(d.value,a&&a.type)});c.$render=
function(){b[0].checked=d.value==c.$viewValue};d.$observe("value",c.$render)},checkbox:function(a,b,d,c,e,f,g,h){var k=Ld(h,a,"ngTrueValue",d.ngTrueValue,!0),l=Ld(h,a,"ngFalseValue",d.ngFalseValue,!1);b.on("click",function(a){c.$setViewValue(b[0].checked,a&&a.type)});c.$render=function(){b[0].checked=c.$viewValue};c.$isEmpty=function(a){return!1===a};c.$formatters.push(function(a){return na(a,k)});c.$parsers.push(function(a){return a?k:l})},hidden:E,button:E,submit:E,reset:E,file:E},Dc=["$browser",
"$sniffer","$filter","$parse",function(a,b,d,c){return{restrict:"E",require:["?ngModel"],link:{pre:function(e,f,g,h){h[0]&&(Vd[N(g.type)]||Vd.text)(e,f,g,h[0],b,a,d,c)}}}}],Jg=/^(true|false|\d+)$/,Se=function(){return{restrict:"A",priority:100,compile:function(a,b){return Jg.test(b.ngValue)?function(a,b,e){e.$set("value",a.$eval(e.ngValue))}:function(a,b,e){a.$watch(e.ngValue,function(a){e.$set("value",a)})}}}},se=["$compile",function(a){return{restrict:"AC",compile:function(b){a.$$addBindingClass(b);
return function(b,c,e){a.$$addBindingInfo(c,e.ngBind);c=c[0];b.$watch(e.ngBind,function(a){c.textContent=z(a)?"":a})}}}}],ue=["$interpolate","$compile",function(a,b){return{compile:function(d){b.$$addBindingClass(d);return function(c,d,f){c=a(d.attr(f.$attr.ngBindTemplate));b.$$addBindingInfo(d,c.expressions);d=d[0];f.$observe("ngBindTemplate",function(a){d.textContent=z(a)?"":a})}}}}],te=["$sce","$parse","$compile",function(a,b,d){return{restrict:"A",compile:function(c,e){var f=b(e.ngBindHtml),g=
b(e.ngBindHtml,function(a){return(a||"").toString()});d.$$addBindingClass(c);return function(b,c,e){d.$$addBindingInfo(c,e.ngBindHtml);b.$watch(g,function(){c.html(a.getTrustedHtml(f(b))||"")})}}}}],Re=da({restrict:"A",require:"ngModel",link:function(a,b,d,c){c.$viewChangeListeners.push(function(){a.$eval(d.ngChange)})}}),ve=mc("",!0),xe=mc("Odd",0),we=mc("Even",1),ye=Na({compile:function(a,b){b.$set("ngCloak",u);a.removeClass("ng-cloak")}}),ze=[function(){return{restrict:"A",scope:!0,controller:"@",
priority:500}}],Ic={},Kg={blur:!0,focus:!0};q("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(a){var b=ya("ng-"+a);Ic[b]=["$parse","$rootScope",function(d,c){return{restrict:"A",compile:function(e,f){var g=d(f[b],null,!0);return function(b,d){d.on(a,function(d){var e=function(){g(b,{$event:d})};Kg[a]&&c.$$phase?b.$evalAsync(e):b.$apply(e)})}}}}]});var Ce=["$animate","$compile",function(a,
b){return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(d,c,e,f,g){var h,k,l;d.$watch(e.ngIf,function(d){d?k||g(function(d,f){k=f;d[d.length++]=b.$$createComment("end ngIf",e.ngIf);h={clone:d};a.enter(d,c.parent(),c)}):(l&&(l.remove(),l=null),k&&(k.$destroy(),k=null),h&&(l=ub(h.clone),a.leave(l).then(function(){l=null}),h=null))})}}}],De=["$templateRequest","$anchorScroll","$animate",function(a,b,d){return{restrict:"ECA",priority:400,terminal:!0,
transclude:"element",controller:ea.noop,compile:function(c,e){var f=e.ngInclude||e.src,g=e.onload||"",h=e.autoscroll;return function(c,e,m,n,p){var q=0,s,x,r,w=function(){x&&(x.remove(),x=null);s&&(s.$destroy(),s=null);r&&(d.leave(r).then(function(){x=null}),x=r,r=null)};c.$watch(f,function(f){var m=function(){!A(h)||h&&!c.$eval(h)||b()},t=++q;f?(a(f,!0).then(function(a){if(!c.$$destroyed&&t===q){var b=c.$new();n.template=a;a=p(b,function(a){w();d.enter(a,null,e).then(m)});s=b;r=a;s.$emit("$includeContentLoaded",
f);c.$eval(g)}},function(){c.$$destroyed||t!==q||(w(),c.$emit("$includeContentError",f))}),c.$emit("$includeContentRequested",f)):(w(),n.template=null)})}}}}],Ue=["$compile",function(a){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(b,d,c,e){ka.call(d[0]).match(/SVG/)?(d.empty(),a(Lc(e.template,P).childNodes)(b,function(a){d.append(a)},{futureParentElement:d})):(d.html(e.template),a(d.contents())(b))}}}],Ee=Na({priority:450,compile:function(){return{pre:function(a,b,d){a.$eval(d.ngInit)}}}}),
Qe=function(){return{restrict:"A",priority:100,require:"ngModel",link:function(a,b,d,c){var e=b.attr(d.$attr.ngList)||", ",f="false"!==d.ngTrim,g=f?W(e):e;c.$parsers.push(function(a){if(!z(a)){var b=[];a&&q(a.split(g),function(a){a&&b.push(f?W(a):a)});return b}});c.$formatters.push(function(a){return M(a)?a.join(e):u});c.$isEmpty=function(a){return!a||!a.length}}}},pb="ng-valid",Md="ng-invalid",Xa="ng-pristine",Lb="ng-dirty",Od="ng-pending",ob=O("ngModel"),Lg=["$scope","$exceptionHandler","$attrs",
"$element","$parse","$animate","$timeout","$rootScope","$q","$interpolate",function(a,b,d,c,e,f,g,h,k,l){this.$modelValue=this.$viewValue=Number.NaN;this.$$rawModelValue=u;this.$validators={};this.$asyncValidators={};this.$parsers=[];this.$formatters=[];this.$viewChangeListeners=[];this.$untouched=!0;this.$touched=!1;this.$pristine=!0;this.$dirty=!1;this.$valid=!0;this.$invalid=!1;this.$error={};this.$$success={};this.$pending=u;this.$name=l(d.name||"",!1)(a);this.$$parentForm=Kb;var m=e(d.ngModel),
n=m.assign,p=m,s=n,y=null,x,r=this;this.$$setOptions=function(a){if((r.$options=a)&&a.getterSetter){var b=e(d.ngModel+"()"),f=e(d.ngModel+"($$$p)");p=function(a){var c=m(a);D(c)&&(c=b(a));return c};s=function(a,b){D(m(a))?f(a,{$$$p:b}):n(a,b)}}else if(!m.assign)throw ob("nonassign",d.ngModel,wa(c));};this.$render=E;this.$isEmpty=function(a){return z(a)||""===a||null===a||a!==a};this.$$updateEmptyClasses=function(a){r.$isEmpty(a)?(f.removeClass(c,"ng-not-empty"),f.addClass(c,"ng-empty")):(f.removeClass(c,
"ng-empty"),f.addClass(c,"ng-not-empty"))};var w=0;Id({ctrl:this,$element:c,set:function(a,b){a[b]=!0},unset:function(a,b){delete a[b]},$animate:f});this.$setPristine=function(){r.$dirty=!1;r.$pristine=!0;f.removeClass(c,Lb);f.addClass(c,Xa)};this.$setDirty=function(){r.$dirty=!0;r.$pristine=!1;f.removeClass(c,Xa);f.addClass(c,Lb);r.$$parentForm.$setDirty()};this.$setUntouched=function(){r.$touched=!1;r.$untouched=!0;f.setClass(c,"ng-untouched","ng-touched")};this.$setTouched=function(){r.$touched=
!0;r.$untouched=!1;f.setClass(c,"ng-touched","ng-untouched")};this.$rollbackViewValue=function(){g.cancel(y);r.$viewValue=r.$$lastCommittedViewValue;r.$render()};this.$validate=function(){if(!R(r.$modelValue)||!isNaN(r.$modelValue)){var a=r.$$rawModelValue,b=r.$valid,c=r.$modelValue,d=r.$options&&r.$options.allowInvalid;r.$$runValidators(a,r.$$lastCommittedViewValue,function(e){d||b===e||(r.$modelValue=e?a:u,r.$modelValue!==c&&r.$$writeModelToScope())})}};this.$$runValidators=function(a,b,c){function d(){var c=
!0;q(r.$validators,function(d,e){var g=d(a,b);c=c&&g;f(e,g)});return c?!0:(q(r.$asyncValidators,function(a,b){f(b,null)}),!1)}function e(){var c=[],d=!0;q(r.$asyncValidators,function(e,g){var h=e(a,b);if(!h||!D(h.then))throw ob("nopromise",h);f(g,u);c.push(h.then(function(){f(g,!0)},function(){d=!1;f(g,!1)}))});c.length?k.all(c).then(function(){g(d)},E):g(!0)}function f(a,b){h===w&&r.$setValidity(a,b)}function g(a){h===w&&c(a)}w++;var h=w;(function(){var a=r.$$parserName||"parse";if(z(x))f(a,null);
else return x||(q(r.$validators,function(a,b){f(b,null)}),q(r.$asyncValidators,function(a,b){f(b,null)})),f(a,x),x;return!0})()?d()?e():g(!1):g(!1)};this.$commitViewValue=function(){var a=r.$viewValue;g.cancel(y);if(r.$$lastCommittedViewValue!==a||""===a&&r.$$hasNativeValidators)r.$$updateEmptyClasses(a),r.$$lastCommittedViewValue=a,r.$pristine&&this.$setDirty(),this.$$parseAndValidate()};this.$$parseAndValidate=function(){var b=r.$$lastCommittedViewValue;if(x=z(b)?u:!0)for(var c=0;c<r.$parsers.length;c++)if(b=
r.$parsers[c](b),z(b)){x=!1;break}R(r.$modelValue)&&isNaN(r.$modelValue)&&(r.$modelValue=p(a));var d=r.$modelValue,e=r.$options&&r.$options.allowInvalid;r.$$rawModelValue=b;e&&(r.$modelValue=b,r.$modelValue!==d&&r.$$writeModelToScope());r.$$runValidators(b,r.$$lastCommittedViewValue,function(a){e||(r.$modelValue=a?b:u,r.$modelValue!==d&&r.$$writeModelToScope())})};this.$$writeModelToScope=function(){s(a,r.$modelValue);q(r.$viewChangeListeners,function(a){try{a()}catch(c){b(c)}})};this.$setViewValue=
function(a,b){r.$viewValue=a;r.$options&&!r.$options.updateOnDefault||r.$$debounceViewValueCommit(b)};this.$$debounceViewValueCommit=function(b){var c=0,d=r.$options;d&&A(d.debounce)&&(d=d.debounce,R(d)?c=d:R(d[b])?c=d[b]:R(d["default"])&&(c=d["default"]));g.cancel(y);c?y=g(function(){r.$commitViewValue()},c):h.$$phase?r.$commitViewValue():a.$apply(function(){r.$commitViewValue()})};a.$watch(function(){var b=p(a);if(b!==r.$modelValue&&(r.$modelValue===r.$modelValue||b===b)){r.$modelValue=r.$$rawModelValue=
b;x=u;for(var c=r.$formatters,d=c.length,e=b;d--;)e=c[d](e);r.$viewValue!==e&&(r.$$updateEmptyClasses(e),r.$viewValue=r.$$lastCommittedViewValue=e,r.$render(),r.$$runValidators(b,e,E))}return b})}],Pe=["$rootScope",function(a){return{restrict:"A",require:["ngModel","^?form","^?ngModelOptions"],controller:Lg,priority:1,compile:function(b){b.addClass(Xa).addClass("ng-untouched").addClass(pb);return{pre:function(a,b,e,f){var g=f[0];b=f[1]||g.$$parentForm;g.$$setOptions(f[2]&&f[2].$options);b.$addControl(g);
e.$observe("name",function(a){g.$name!==a&&g.$$parentForm.$$renameControl(g,a)});a.$on("$destroy",function(){g.$$parentForm.$removeControl(g)})},post:function(b,c,e,f){var g=f[0];if(g.$options&&g.$options.updateOn)c.on(g.$options.updateOn,function(a){g.$$debounceViewValueCommit(a&&a.type)});c.on("blur",function(){g.$touched||(a.$$phase?b.$evalAsync(g.$setTouched):b.$apply(g.$setTouched))})}}}}}],Mg=/(\s+|^)default(\s+|$)/,Te=function(){return{restrict:"A",controller:["$scope","$attrs",function(a,
b){var d=this;this.$options=pa(a.$eval(b.ngModelOptions));A(this.$options.updateOn)?(this.$options.updateOnDefault=!1,this.$options.updateOn=W(this.$options.updateOn.replace(Mg,function(){d.$options.updateOnDefault=!0;return" "}))):this.$options.updateOnDefault=!0}]}},Fe=Na({terminal:!0,priority:1E3}),Ng=O("ngOptions"),Og=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,
Ne=["$compile","$parse",function(a,b){function d(a,c,d){function e(a,b,c,d,f){this.selectValue=a;this.viewValue=b;this.label=c;this.group=d;this.disabled=f}function l(a){var b;if(!p&&za(a))b=a;else{b=[];for(var c in a)a.hasOwnProperty(c)&&"$"!==c.charAt(0)&&b.push(c)}return b}var m=a.match(Og);if(!m)throw Ng("iexp",a,wa(c));var n=m[5]||m[7],p=m[6];a=/ as /.test(m[0])&&m[1];var q=m[9];c=b(m[2]?m[1]:n);var s=a&&b(a)||c,x=q&&b(q),r=q?function(a,b){return x(d,b)}:function(a){return Ha(a)},w=function(a,
b){return r(a,y(a,b))},v=b(m[2]||m[1]),u=b(m[3]||""),t=b(m[4]||""),G=b(m[8]),C={},y=p?function(a,b){C[p]=b;C[n]=a;return C}:function(a){C[n]=a;return C};return{trackBy:q,getTrackByValue:w,getWatchables:b(G,function(a){var b=[];a=a||[];for(var c=l(a),e=c.length,f=0;f<e;f++){var g=a===c?f:c[f],k=a[g],g=y(k,g),k=r(k,g);b.push(k);if(m[2]||m[1])k=v(d,g),b.push(k);m[4]&&(g=t(d,g),b.push(g))}return b}),getOptions:function(){for(var a=[],b={},c=G(d)||[],f=l(c),g=f.length,m=0;m<g;m++){var n=c===f?m:f[m],p=
y(c[n],n),x=s(d,p),n=r(x,p),C=v(d,p),A=u(d,p),p=t(d,p),x=new e(n,x,C,A,p);a.push(x);b[n]=x}return{items:a,selectValueMap:b,getOptionFromViewValue:function(a){return b[w(a)]},getViewValueFromOption:function(a){return q?ea.copy(a.viewValue):a.viewValue}}}}}var c=P.createElement("option"),e=P.createElement("optgroup");return{restrict:"A",terminal:!0,require:["select","ngModel"],link:{pre:function(a,b,c,d){d[0].registerOption=E},post:function(b,g,h,k){function l(a,b){a.element=b;b.disabled=a.disabled;
a.label!==b.label&&(b.label=a.label,b.textContent=a.label);a.value!==b.value&&(b.value=a.selectValue)}function m(a,b,c,d){b&&N(b.nodeName)===c?c=b:(c=d.cloneNode(!1),b?a.insertBefore(c,b):a.appendChild(c));return c}function n(a){for(var b;a;)b=a.nextSibling,Yb(a),a=b}function p(a){var b=w&&w[0],c=G&&G[0];if(b||c)for(;a&&(a===b||a===c||8===a.nodeType||"option"===oa(a)&&""===a.value);)a=a.nextSibling;return a}function s(){var a=C&&u.readValue();C=z.getOptions();var b={},d=g[0].firstChild;t&&g.prepend(w);
d=p(d);C.items.forEach(function(a){var f,h;A(a.group)?(f=b[a.group],f||(f=m(g[0],d,"optgroup",e),d=f.nextSibling,f.label=a.group,f=b[a.group]={groupElement:f,currentOptionElement:f.firstChild}),h=m(f.groupElement,f.currentOptionElement,"option",c),l(a,h),f.currentOptionElement=h.nextSibling):(h=m(g[0],d,"option",c),l(a,h),d=h.nextSibling)});Object.keys(b).forEach(function(a){n(b[a].currentOptionElement)});n(d);x.$render();if(!x.$isEmpty(a)){var f=u.readValue();(z.trackBy||r?na(a,f):a===f)||(x.$setViewValue(f),
x.$render())}}var u=k[0],x=k[1],r=h.multiple,w;k=0;for(var v=g.children(),y=v.length;k<y;k++)if(""===v[k].value){w=v.eq(k);break}var t=!!w,G=H(c.cloneNode(!1));G.val("?");var C,z=d(h.ngOptions,g,b);r?(x.$isEmpty=function(a){return!a||0===a.length},u.writeValue=function(a){C.items.forEach(function(a){a.element.selected=!1});a&&a.forEach(function(a){(a=C.getOptionFromViewValue(a))&&!a.disabled&&(a.element.selected=!0)})},u.readValue=function(){var a=g.val()||[],b=[];q(a,function(a){(a=C.selectValueMap[a])&&
!a.disabled&&b.push(C.getViewValueFromOption(a))});return b},z.trackBy&&b.$watchCollection(function(){if(M(x.$viewValue))return x.$viewValue.map(function(a){return z.getTrackByValue(a)})},function(){x.$render()})):(u.writeValue=function(a){var b=C.getOptionFromViewValue(a);b&&!b.disabled?(g[0].value!==b.selectValue&&(G.remove(),t||w.remove(),g[0].value=b.selectValue,b.element.selected=!0),b.element.setAttribute("selected","selected")):null===a||t?(G.remove(),t||g.prepend(w),g.val(""),w.prop("selected",
!0),w.attr("selected",!0)):(t||w.remove(),g.prepend(G),g.val("?"),G.prop("selected",!0),G.attr("selected",!0))},u.readValue=function(){var a=C.selectValueMap[g.val()];return a&&!a.disabled?(t||w.remove(),G.remove(),C.getViewValueFromOption(a)):null},z.trackBy&&b.$watch(function(){return z.getTrackByValue(x.$viewValue)},function(){x.$render()}));t?(w.remove(),a(w)(b),w.removeClass("ng-scope")):w=H(c.cloneNode(!1));s();b.$watchCollection(z.getWatchables,s)}}}}],Ge=["$locale","$interpolate","$log",function(a,
b,d){var c=/{}/g,e=/^when(Minus)?(.+)$/;return{link:function(f,g,h){function k(a){g.text(a||"")}var l=h.count,m=h.$attr.when&&g.attr(h.$attr.when),n=h.offset||0,p=f.$eval(m)||{},s={},u=b.startSymbol(),x=b.endSymbol(),r=u+l+"-"+n+x,w=ea.noop,v;q(h,function(a,b){var c=e.exec(b);c&&(c=(c[1]?"-":"")+N(c[2]),p[c]=g.attr(h.$attr[b]))});q(p,function(a,d){s[d]=b(a.replace(c,r))});f.$watch(l,function(b){var c=parseFloat(b),e=isNaN(c);e||c in p||(c=a.pluralCat(c-n));c===v||e&&R(v)&&isNaN(v)||(w(),e=s[c],z(e)?
(null!=b&&d.debug("ngPluralize: no rule defined for '"+c+"' in "+m),w=E,k()):w=f.$watch(e,k),v=c)})}}}],He=["$parse","$animate","$compile",function(a,b,d){var c=O("ngRepeat"),e=function(a,b,c,d,e,m,n){a[c]=d;e&&(a[e]=m);a.$index=b;a.$first=0===b;a.$last=b===n-1;a.$middle=!(a.$first||a.$last);a.$odd=!(a.$even=0===(b&1))};return{restrict:"A",multiElement:!0,transclude:"element",priority:1E3,terminal:!0,$$tlb:!0,compile:function(f,g){var h=g.ngRepeat,k=d.$$createComment("end ngRepeat",h),l=h.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);
if(!l)throw c("iexp",h);var m=l[1],n=l[2],p=l[3],s=l[4],l=m.match(/^(?:(\s*[\$\w]+)|\(\s*([\$\w]+)\s*,\s*([\$\w]+)\s*\))$/);if(!l)throw c("iidexp",m);var y=l[3]||l[1],x=l[2];if(p&&(!/^[$a-zA-Z_][$a-zA-Z0-9_]*$/.test(p)||/^(null|undefined|this|\$index|\$first|\$middle|\$last|\$even|\$odd|\$parent|\$root|\$id)$/.test(p)))throw c("badident",p);var r,w,v,z,t={$id:Ha};s?r=a(s):(v=function(a,b){return Ha(b)},z=function(a){return a});return function(a,d,f,g,l){r&&(w=function(b,c,d){x&&(t[x]=b);t[y]=c;t.$index=
d;return r(a,t)});var m=V();a.$watchCollection(n,function(f){var g,n,r=d[0],s,t=V(),A,E,H,D,I,F,J;p&&(a[p]=f);if(za(f))I=f,n=w||v;else for(J in n=w||z,I=[],f)va.call(f,J)&&"$"!==J.charAt(0)&&I.push(J);A=I.length;J=Array(A);for(g=0;g<A;g++)if(E=f===I?g:I[g],H=f[E],D=n(E,H,g),m[D])F=m[D],delete m[D],t[D]=F,J[g]=F;else{if(t[D])throw q(J,function(a){a&&a.scope&&(m[a.id]=a)}),c("dupes",h,D,H);J[g]={id:D,scope:u,clone:u};t[D]=!0}for(s in m){F=m[s];D=ub(F.clone);b.leave(D);if(D[0].parentNode)for(g=0,n=D.length;g<
n;g++)D[g].$$NG_REMOVED=!0;F.scope.$destroy()}for(g=0;g<A;g++)if(E=f===I?g:I[g],H=f[E],F=J[g],F.scope){s=r;do s=s.nextSibling;while(s&&s.$$NG_REMOVED);F.clone[0]!=s&&b.move(ub(F.clone),null,r);r=F.clone[F.clone.length-1];e(F.scope,g,y,H,x,E,A)}else l(function(a,c){F.scope=c;var d=k.cloneNode(!1);a[a.length++]=d;b.enter(a,null,r);r=d;F.clone=a;t[F.id]=F;e(F.scope,g,y,H,x,E,A)});m=t})}}}}],Ie=["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(b,d,c){b.$watch(c.ngShow,function(b){a[b?
"removeClass":"addClass"](d,"ng-hide",{tempClasses:"ng-hide-animate"})})}}}],Be=["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(b,d,c){b.$watch(c.ngHide,function(b){a[b?"addClass":"removeClass"](d,"ng-hide",{tempClasses:"ng-hide-animate"})})}}}],Je=Na(function(a,b,d){a.$watch(d.ngStyle,function(a,d){d&&a!==d&&q(d,function(a,c){b.css(c,"")});a&&b.css(a)},!0)}),Ke=["$animate","$compile",function(a,b){return{require:"ngSwitch",controller:["$scope",function(){this.cases={}}],
link:function(d,c,e,f){var g=[],h=[],k=[],l=[],m=function(a,b){return function(){a.splice(b,1)}};d.$watch(e.ngSwitch||e.on,function(c){var d,e;d=0;for(e=k.length;d<e;++d)a.cancel(k[d]);d=k.length=0;for(e=l.length;d<e;++d){var s=ub(h[d].clone);l[d].$destroy();(k[d]=a.leave(s)).then(m(k,d))}h.length=0;l.length=0;(g=f.cases["!"+c]||f.cases["?"])&&q(g,function(c){c.transclude(function(d,e){l.push(e);var f=c.element;d[d.length++]=b.$$createComment("end ngSwitchWhen");h.push({clone:d});a.enter(d,f.parent(),
f)})})})}}}],Le=Na({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(a,b,d,c,e){c.cases["!"+d.ngSwitchWhen]=c.cases["!"+d.ngSwitchWhen]||[];c.cases["!"+d.ngSwitchWhen].push({transclude:e,element:b})}}),Me=Na({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(a,b,d,c,e){c.cases["?"]=c.cases["?"]||[];c.cases["?"].push({transclude:e,element:b})}}),Pg=O("ngTransclude"),Oe=Na({restrict:"EAC",link:function(a,b,d,c,e){d.ngTransclude===
d.$attr.ngTransclude&&(d.ngTransclude="");if(!e)throw Pg("orphan",wa(b));e(function(a){a.length&&(b.empty(),b.append(a))},null,d.ngTransclude||d.ngTranscludeSlot)}}),oe=["$templateCache",function(a){return{restrict:"E",terminal:!0,compile:function(b,d){"text/ng-template"==d.type&&a.put(d.id,b[0].text)}}}],Qg={$setViewValue:E,$render:E},Rg=["$element","$scope",function(a,b){var d=this,c=new Ua;d.ngModelCtrl=Qg;d.unknownOption=H(P.createElement("option"));d.renderUnknownOption=function(b){b="? "+Ha(b)+
" ?";d.unknownOption.val(b);a.prepend(d.unknownOption);a.val(b)};b.$on("$destroy",function(){d.renderUnknownOption=E});d.removeUnknownOption=function(){d.unknownOption.parent()&&d.unknownOption.remove()};d.readValue=function(){d.removeUnknownOption();return a.val()};d.writeValue=function(b){d.hasOption(b)?(d.removeUnknownOption(),a.val(b),""===b&&d.emptyOption.prop("selected",!0)):null==b&&d.emptyOption?(d.removeUnknownOption(),a.val("")):d.renderUnknownOption(b)};d.addOption=function(a,b){if(8!==
b[0].nodeType){Ta(a,'"option value"');""===a&&(d.emptyOption=b);var g=c.get(a)||0;c.put(a,g+1);d.ngModelCtrl.$render();b[0].hasAttribute("selected")&&(b[0].selected=!0)}};d.removeOption=function(a){var b=c.get(a);b&&(1===b?(c.remove(a),""===a&&(d.emptyOption=u)):c.put(a,b-1))};d.hasOption=function(a){return!!c.get(a)};d.registerOption=function(a,b,c,h,k){if(h){var l;c.$observe("value",function(a){A(l)&&d.removeOption(l);l=a;d.addOption(a,b)})}else k?a.$watch(k,function(a,e){c.$set("value",a);e!==
a&&d.removeOption(e);d.addOption(a,b)}):d.addOption(c.value,b);b.on("$destroy",function(){d.removeOption(c.value);d.ngModelCtrl.$render()})}}],pe=function(){return{restrict:"E",require:["select","?ngModel"],controller:Rg,priority:1,link:{pre:function(a,b,d,c){var e=c[1];if(e){var f=c[0];f.ngModelCtrl=e;b.on("change",function(){a.$apply(function(){e.$setViewValue(f.readValue())})});if(d.multiple){f.readValue=function(){var a=[];q(b.find("option"),function(b){b.selected&&a.push(b.value)});return a};
f.writeValue=function(a){var c=new Ua(a);q(b.find("option"),function(a){a.selected=A(c.get(a.value))})};var g,h=NaN;a.$watch(function(){h!==e.$viewValue||na(g,e.$viewValue)||(g=ia(e.$viewValue),e.$render());h=e.$viewValue});e.$isEmpty=function(a){return!a||0===a.length}}}},post:function(a,b,d,c){var e=c[1];if(e){var f=c[0];e.$render=function(){f.writeValue(e.$viewValue)}}}}}},re=["$interpolate",function(a){return{restrict:"E",priority:100,compile:function(b,d){if(A(d.value))var c=a(d.value,!0);else{var e=
a(b.text(),!0);e||d.$set("value",b.text())}return function(a,b,d){var k=b.parent();(k=k.data("$selectController")||k.parent().data("$selectController"))&&k.registerOption(a,b,d,c,e)}}}}],qe=da({restrict:"E",terminal:!1}),Fc=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,d,c){c&&(d.required=!0,c.$validators.required=function(a,b){return!d.required||!c.$isEmpty(b)},d.$observe("required",function(){c.$validate()}))}}},Ec=function(){return{restrict:"A",require:"?ngModel",link:function(a,
b,d,c){if(c){var e,f=d.ngPattern||d.pattern;d.$observe("pattern",function(a){y(a)&&0<a.length&&(a=new RegExp("^"+a+"$"));if(a&&!a.test)throw O("ngPattern")("noregexp",f,a,wa(b));e=a||u;c.$validate()});c.$validators.pattern=function(a,b){return c.$isEmpty(b)||z(e)||e.test(b)}}}}},Hc=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,d,c){if(c){var e=-1;d.$observe("maxlength",function(a){a=Y(a);e=isNaN(a)?-1:a;c.$validate()});c.$validators.maxlength=function(a,b){return 0>e||c.$isEmpty(b)||
b.length<=e}}}}},Gc=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,d,c){if(c){var e=0;d.$observe("minlength",function(a){e=Y(a)||0;c.$validate()});c.$validators.minlength=function(a,b){return c.$isEmpty(b)||b.length>=e}}}}};T.angular.bootstrap?T.console&&console.log("WARNING: Tried to load angular more than once."):(he(),je(ea),ea.module("ngLocale",[],["$provide",function(a){function b(a){a+="";var b=a.indexOf(".");return-1==b?0:a.length-b-1}a.value("$locale",{DATETIME_FORMATS:{AMPMS:["AM",
"PM"],DAY:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),ERANAMES:["Before Christ","Anno Domini"],ERAS:["BC","AD"],FIRSTDAYOFWEEK:6,MONTH:"January February March April May June July August September October November December".split(" "),SHORTDAY:"Sun Mon Tue Wed Thu Fri Sat".split(" "),SHORTMONTH:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),STANDALONEMONTH:"January February March April May June July August September October November December".split(" "),WEEKENDRANGE:[5,
6],fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",medium:"MMM d, y h:mm:ss a",mediumDate:"MMM d, y",mediumTime:"h:mm:ss a","short":"M/d/yy h:mm a",shortDate:"M/d/yy",shortTime:"h:mm a"},NUMBER_FORMATS:{CURRENCY_SYM:"$",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-\u00a4",negSuf:"",posPre:"\u00a4",posSuf:""}]},id:"en-us",localeID:"en_US",pluralCat:function(a,
c){var e=a|0,f=c;u===f&&(f=Math.min(b(a),3));Math.pow(10,f);return 1==e&&0==f?"one":"other"}})}]),H(P).ready(function(){de(P,yc)}))})(window,document);!window.angular.$$csp().noInlineStyle&&window.angular.element(document.head).prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\\:form{display:block;}.ng-animate-shim{visibility:hidden;}.ng-anchor{position:absolute;}</style>');
//# sourceMappingURL=angular.min.js.map

/*!
 * ionic.bundle.js is a concatenation of:
 * ionic.js, angular.js, angular-animate.js,
 * angular-sanitize.js, angular-ui-router.js,
 * and ionic-angular.js
 */

/*
 AngularJS v1.5.3
 (c) 2010-2016 Google, Inc. http://angularjs.org
 License: MIT
*/
(function(E,w,Va){'use strict';function ya(a,b,c){if(!a)throw Ka("areq",b||"?",c||"required");return a}function za(a,b){if(!a&&!b)return"";if(!a)return b;if(!b)return a;ba(a)&&(a=a.join(" "));ba(b)&&(b=b.join(" "));return a+" "+b}function La(a){var b={};a&&(a.to||a.from)&&(b.to=a.to,b.from=a.from);return b}function V(a,b,c){var d="";a=ba(a)?a:a&&I(a)&&a.length?a.split(/\s+/):[];q(a,function(a,f){a&&0<a.length&&(d+=0<f?" ":"",d+=c?b+a:a+b)});return d}function Ma(a){if(a instanceof H)switch(a.length){case 0:return[];
case 1:if(1===a[0].nodeType)return a;break;default:return H(ga(a))}if(1===a.nodeType)return H(a)}function ga(a){if(!a[0])return a;for(var b=0;b<a.length;b++){var c=a[b];if(1==c.nodeType)return c}}function Na(a,b,c){q(b,function(b){a.addClass(b,c)})}function Oa(a,b,c){q(b,function(b){a.removeClass(b,c)})}function Q(a){return function(b,c){c.addClass&&(Na(a,b,c.addClass),c.addClass=null);c.removeClass&&(Oa(a,b,c.removeClass),c.removeClass=null)}}function oa(a){a=a||{};if(!a.$$prepared){var b=a.domOperation||
O;a.domOperation=function(){a.$$domOperationFired=!0;b();b=O};a.$$prepared=!0}return a}function ha(a,b){Aa(a,b);Ba(a,b)}function Aa(a,b){b.from&&(a.css(b.from),b.from=null)}function Ba(a,b){b.to&&(a.css(b.to),b.to=null)}function T(a,b,c){var d=b.options||{};c=c.options||{};var e=(d.addClass||"")+" "+(c.addClass||""),f=(d.removeClass||"")+" "+(c.removeClass||"");a=Pa(a.attr("class"),e,f);c.preparationClasses&&(d.preparationClasses=W(c.preparationClasses,d.preparationClasses),delete c.preparationClasses);
e=d.domOperation!==O?d.domOperation:null;Ca(d,c);e&&(d.domOperation=e);d.addClass=a.addClass?a.addClass:null;d.removeClass=a.removeClass?a.removeClass:null;b.addClass=d.addClass;b.removeClass=d.removeClass;return d}function Pa(a,b,c){function d(a){I(a)&&(a=a.split(" "));var b={};q(a,function(a){a.length&&(b[a]=!0)});return b}var e={};a=d(a);b=d(b);q(b,function(a,b){e[b]=1});c=d(c);q(c,function(a,b){e[b]=1===e[b]?null:-1});var f={addClass:"",removeClass:""};q(e,function(b,c){var d,e;1===b?(d="addClass",
e=!a[c]):-1===b&&(d="removeClass",e=a[c]);e&&(f[d].length&&(f[d]+=" "),f[d]+=c)});return f}function A(a){return a instanceof w.element?a[0]:a}function Qa(a,b,c){var d="";b&&(d=V(b,"ng-",!0));c.addClass&&(d=W(d,V(c.addClass,"-add")));c.removeClass&&(d=W(d,V(c.removeClass,"-remove")));d.length&&(c.preparationClasses=d,a.addClass(d))}function pa(a,b){var c=b?"-"+b+"s":"";la(a,[ma,c]);return[ma,c]}function ra(a,b){var c=b?"paused":"",d=X+"PlayState";la(a,[d,c]);return[d,c]}function la(a,b){a.style[b[0]]=
b[1]}function W(a,b){return a?b?a+" "+b:a:b}function Da(a,b,c){var d=Object.create(null),e=a.getComputedStyle(b)||{};q(c,function(a,b){var c=e[a];if(c){var F=c.charAt(0);if("-"===F||"+"===F||0<=F)c=Ra(c);0===c&&(c=null);d[b]=c}});return d}function Ra(a){var b=0;a=a.split(/\s*,\s*/);q(a,function(a){"s"==a.charAt(a.length-1)&&(a=a.substring(0,a.length-1));a=parseFloat(a)||0;b=b?Math.max(a,b):a});return b}function sa(a){return 0===a||null!=a}function Ea(a,b){var c=R,d=a+"s";b?c+="Duration":d+=" linear all";
return[c,d]}function Fa(){var a=Object.create(null);return{flush:function(){a=Object.create(null)},count:function(b){return(b=a[b])?b.total:0},get:function(b){return(b=a[b])&&b.value},put:function(b,c){a[b]?a[b].total++:a[b]={total:1,value:c}}}}function Ga(a,b,c){q(c,function(c){a[c]=Y(a[c])?a[c]:b.style.getPropertyValue(c)})}var O=w.noop,Ha=w.copy,Ca=w.extend,H=w.element,q=w.forEach,ba=w.isArray,I=w.isString,ca=w.isObject,N=w.isUndefined,Y=w.isDefined,Ia=w.isFunction,ta=w.isElement,R,ua,X,va;N(E.ontransitionend)&&
Y(E.onwebkittransitionend)?(R="WebkitTransition",ua="webkitTransitionEnd transitionend"):(R="transition",ua="transitionend");N(E.onanimationend)&&Y(E.onwebkitanimationend)?(X="WebkitAnimation",va="webkitAnimationEnd animationend"):(X="animation",va="animationend");var qa=X+"Delay",wa=X+"Duration",ma=R+"Delay";E=R+"Duration";var Ka=w.$$minErr("ng"),Sa={transitionDuration:E,transitionDelay:ma,transitionProperty:R+"Property",animationDuration:wa,animationDelay:qa,animationIterationCount:X+"IterationCount"},
Ta={transitionDuration:E,transitionDelay:ma,animationDuration:wa,animationDelay:qa};w.module("ngAnimate",[]).directive("ngAnimateSwap",["$animate","$rootScope",function(a,b){return{restrict:"A",transclude:"element",terminal:!0,priority:600,link:function(b,d,e,f,r){var x,F;b.$watchCollection(e.ngAnimateSwap||e["for"],function(e){x&&a.leave(x);F&&(F.$destroy(),F=null);if(e||0===e)F=b.$new(),r(F,function(b){x=b;a.enter(b,null,d)})})}}}]).directive("ngAnimateChildren",["$interpolate",function(a){return{link:function(b,
c,d){function e(a){c.data("$$ngAnimateChildren","on"===a||"true"===a)}var f=d.ngAnimateChildren;w.isString(f)&&0===f.length?c.data("$$ngAnimateChildren",!0):(e(a(f)(b)),d.$observe("ngAnimateChildren",e))}}}]).factory("$$rAFScheduler",["$$rAF",function(a){function b(a){d=d.concat(a);c()}function c(){if(d.length){for(var b=d.shift(),r=0;r<b.length;r++)b[r]();e||a(function(){e||c()})}}var d,e;d=b.queue=[];b.waitUntilQuiet=function(b){e&&e();e=a(function(){e=null;b();c()})};return b}]).provider("$$animateQueue",
["$animateProvider",function(a){function b(a){if(!a)return null;a=a.split(" ");var b=Object.create(null);q(a,function(a){b[a]=!0});return b}function c(a,c){if(a&&c){var d=b(c);return a.split(" ").some(function(a){return d[a]})}}function d(a,b,c,d){return f[a].some(function(a){return a(b,c,d)})}function e(a,b){var c=0<(a.addClass||"").length,d=0<(a.removeClass||"").length;return b?c&&d:c||d}var f=this.rules={skip:[],cancel:[],join:[]};f.join.push(function(a,b,c){return!b.structural&&e(b)});f.skip.push(function(a,
b,c){return!b.structural&&!e(b)});f.skip.push(function(a,b,c){return"leave"==c.event&&b.structural});f.skip.push(function(a,b,c){return c.structural&&2===c.state&&!b.structural});f.cancel.push(function(a,b,c){return c.structural&&b.structural});f.cancel.push(function(a,b,c){return 2===c.state&&b.structural});f.cancel.push(function(a,b,d){if(d.structural)return!1;a=b.addClass;b=b.removeClass;var e=d.addClass;d=d.removeClass;return N(a)&&N(b)||N(e)&&N(d)?!1:c(a,d)||c(b,e)});this.$get=["$$rAF","$rootScope",
"$rootElement","$document","$$HashMap","$$animation","$$AnimateRunner","$templateRequest","$$jqLite","$$forceReflow",function(b,c,f,u,l,w,s,M,v,h){function P(){var a=!1;return function(b){a?b():c.$$postDigest(function(){a=!0;b()})}}function y(a,b,c){var g=A(b),d=A(a),k=[];(a=G[c])&&q(a,function(a){t.call(a.node,g)?k.push(a.callback):"leave"===c&&t.call(a.node,d)&&k.push(a.callback)});return k}function k(a,g,k){function m(c,g,d,k){F(function(){var c=y(J,a,g);c.length&&b(function(){q(c,function(b){b(a,
d,k)})})});c.progress(g,d,k)}function G(b){var c=a,g=h;g.preparationClasses&&(c.removeClass(g.preparationClasses),g.preparationClasses=null);g.activeClasses&&(c.removeClass(g.activeClasses),g.activeClasses=null);Ja(a,h);ha(a,h);h.domOperation();f.complete(!b)}var h=Ha(k),t,J;if(a=Ma(a))t=A(a),J=a.parent();var h=oa(h),f=new s,F=P();ba(h.addClass)&&(h.addClass=h.addClass.join(" "));h.addClass&&!I(h.addClass)&&(h.addClass=null);ba(h.removeClass)&&(h.removeClass=h.removeClass.join(" "));h.removeClass&&
!I(h.removeClass)&&(h.removeClass=null);h.from&&!ca(h.from)&&(h.from=null);h.to&&!ca(h.to)&&(h.to=null);if(!t)return G(),f;k=[t.className,h.addClass,h.removeClass].join(" ");if(!Ua(k))return G(),f;var v=0<=["enter","move","leave"].indexOf(g),l=!K||u[0].hidden||C.get(t);k=!l&&z.get(t)||{};var Z=!!k.state;l||Z&&1==k.state||(l=!n(a,J,g));if(l)return G(),f;v&&xa(a);l={structural:v,element:a,event:g,addClass:h.addClass,removeClass:h.removeClass,close:G,options:h,runner:f};if(Z){if(d("skip",a,l,k)){if(2===
k.state)return G(),f;T(a,k,l);return k.runner}if(d("cancel",a,l,k))if(2===k.state)k.runner.end();else if(k.structural)k.close();else return T(a,k,l),k.runner;else if(d("join",a,l,k))if(2===k.state)T(a,l,{});else return Qa(a,v?g:null,h),g=l.event=k.event,h=T(a,k,l),k.runner}else T(a,l,{});(Z=l.structural)||(Z="animate"===l.event&&0<Object.keys(l.options.to||{}).length||e(l));if(!Z)return G(),ka(a),f;var M=(k.counter||0)+1;l.counter=M;D(a,1,l);c.$$postDigest(function(){var b=z.get(t),c=!b,b=b||{},d=
0<(a.parent()||[]).length&&("animate"===b.event||b.structural||e(b));if(c||b.counter!==M||!d){c&&(Ja(a,h),ha(a,h));if(c||v&&b.event!==g)h.domOperation(),f.end();d||ka(a)}else g=!b.structural&&e(b,!0)?"setClass":b.event,D(a,2),b=w(a,g,b.options),b.done(function(b){G(!b);(b=z.get(t))&&b.counter===M&&ka(A(a));m(f,g,"close",{})}),f.setHost(b),m(f,g,"start",{})});return f}function xa(a){a=A(a).querySelectorAll("[data-ng-animate]");q(a,function(a){var b=parseInt(a.getAttribute("data-ng-animate")),c=z.get(a);
if(c)switch(b){case 2:c.runner.end();case 1:z.remove(a)}})}function ka(a){a=A(a);a.removeAttribute("data-ng-animate");z.remove(a)}function J(a,b){return A(a)===A(b)}function n(a,b,c){c=H(u[0].body);var g=J(a,c)||"HTML"===a[0].nodeName,d=J(a,f),k=!1,h,m=C.get(A(a));(a=H.data(a[0],"$ngAnimatePin"))&&(b=a);for(b=A(b);b;){d||(d=J(b,f));if(1!==b.nodeType)break;a=z.get(b)||{};if(!k){var e=C.get(b);if(!0===e&&!1!==m){m=!0;break}else!1===e&&(m=!1);k=a.structural}if(N(h)||!0===h)a=H.data(b,"$$ngAnimateChildren"),
Y(a)&&(h=a);if(k&&!1===h)break;g||(g=J(b,c));if(g&&d)break;if(!d&&(a=H.data(b,"$ngAnimatePin"))){b=A(a);continue}b=b.parentNode}return(!k||h)&&!0!==m&&d&&g}function D(a,b,c){c=c||{};c.state=b;a=A(a);a.setAttribute("data-ng-animate",b);c=(b=z.get(a))?Ca(b,c):c;z.put(a,c)}var z=new l,C=new l,K=null,g=c.$watch(function(){return 0===M.totalPendingRequests},function(a){a&&(g(),c.$$postDigest(function(){c.$$postDigest(function(){null===K&&(K=!0)})}))}),G={},m=a.classNameFilter(),Ua=m?function(a){return m.test(a)}:
function(){return!0},Ja=Q(v),t=Node.prototype.contains||function(a){return this===a||!!(this.compareDocumentPosition(a)&16)},Z={on:function(a,b,c){var g=ga(b);G[a]=G[a]||[];G[a].push({node:g,callback:c});H(b).on("$destroy",function(){Z.off(a,b,c)})},off:function(a,b,c){function g(a,b,c){var d=ga(b);return a.filter(function(a){return!(a.node===d&&(!c||a.callback===c))})}var d=G[a];d&&(G[a]=1===arguments.length?null:g(d,b,c))},pin:function(a,b){ya(ta(a),"element","not an element");ya(ta(b),"parentElement",
"not an element");a.data("$ngAnimatePin",b)},push:function(a,b,c,g){c=c||{};c.domOperation=g;return k(a,b,c)},enabled:function(a,b){var c=arguments.length;if(0===c)b=!!K;else if(ta(a)){var g=A(a),d=C.get(g);1===c?b=!d:C.put(g,!b)}else b=K=!!a;return b}};return Z}]}]).provider("$$animation",["$animateProvider",function(a){function b(a){return a.data("$$animationRunner")}var c=this.drivers=[];this.$get=["$$jqLite","$rootScope","$injector","$$AnimateRunner","$$HashMap","$$rAFScheduler",function(a,e,
f,r,x,F){function u(a){function b(a){if(a.processed)return a;a.processed=!0;var d=a.domNode,h=d.parentNode;e.put(d,a);for(var f;h;){if(f=e.get(h)){f.processed||(f=b(f));break}h=h.parentNode}(f||c).children.push(a);return a}var c={children:[]},d,e=new x;for(d=0;d<a.length;d++){var f=a[d];e.put(f.domNode,a[d]={domNode:f.domNode,fn:f.fn,children:[]})}for(d=0;d<a.length;d++)b(a[d]);return function(a){var b=[],c=[],d;for(d=0;d<a.children.length;d++)c.push(a.children[d]);a=c.length;var h=0,e=[];for(d=0;d<
c.length;d++){var f=c[d];0>=a&&(a=h,h=0,b.push(e),e=[]);e.push(f.fn);f.children.forEach(function(a){h++;c.push(a)});a--}e.length&&b.push(e);return b}(c)}var l=[],w=Q(a);return function(s,x,v){function h(a){a=a.hasAttribute("ng-animate-ref")?[a]:a.querySelectorAll("[ng-animate-ref]");var b=[];q(a,function(a){var c=a.getAttribute("ng-animate-ref");c&&c.length&&b.push(a)});return b}function P(a){var b=[],c={};q(a,function(a,g){var d=A(a.element),k=0<=["enter","move"].indexOf(a.event),d=a.structural?
h(d):[];if(d.length){var e=k?"to":"from";q(d,function(a){var b=a.getAttribute("ng-animate-ref");c[b]=c[b]||{};c[b][e]={animationID:g,element:H(a)}})}else b.push(a)});var d={},k={};q(c,function(c,h){var e=c.from,f=c.to;if(e&&f){var m=a[e.animationID],C=a[f.animationID],n=e.animationID.toString();if(!k[n]){var D=k[n]={structural:!0,beforeStart:function(){m.beforeStart();C.beforeStart()},close:function(){m.close();C.close()},classes:y(m.classes,C.classes),from:m,to:C,anchors:[]};D.classes.length?b.push(D):
(b.push(m),b.push(C))}k[n].anchors.push({out:e.element,"in":f.element})}else e=e?e.animationID:f.animationID,f=e.toString(),d[f]||(d[f]=!0,b.push(a[e]))});return b}function y(a,b){a=a.split(" ");b=b.split(" ");for(var c=[],d=0;d<a.length;d++){var k=a[d];if("ng-"!==k.substring(0,3))for(var e=0;e<b.length;e++)if(k===b[e]){c.push(k);break}}return c.join(" ")}function k(a){for(var b=c.length-1;0<=b;b--){var d=c[b];if(f.has(d)&&(d=f.get(d)(a)))return d}}function xa(a,c){a.from&&a.to?(b(a.from.element).setHost(c),
b(a.to.element).setHost(c)):b(a.element).setHost(c)}function ka(){var a=b(s);!a||"leave"===x&&v.$$domOperationFired||a.end()}function J(b){s.off("$destroy",ka);s.removeData("$$animationRunner");w(s,v);ha(s,v);v.domOperation();C&&a.removeClass(s,C);s.removeClass("ng-animate");D.complete(!b)}v=oa(v);var n=0<=["enter","move","leave"].indexOf(x),D=new r({end:function(){J()},cancel:function(){J(!0)}});if(!c.length)return J(),D;s.data("$$animationRunner",D);var z=za(s.attr("class"),za(v.addClass,v.removeClass)),
C=v.tempClasses;C&&(z+=" "+C,v.tempClasses=null);var K;n&&(K="ng-"+x+"-prepare",a.addClass(s,K));l.push({element:s,classes:z,event:x,structural:n,options:v,beforeStart:function(){s.addClass("ng-animate");C&&a.addClass(s,C);K&&(a.removeClass(s,K),K=null)},close:J});s.on("$destroy",ka);if(1<l.length)return D;e.$$postDigest(function(){var a=[];q(l,function(c){b(c.element)?a.push(c):c.close()});l.length=0;var c=P(a),d=[];q(c,function(a){d.push({domNode:A(a.from?a.from.element:a.element),fn:function(){a.beforeStart();
var c,d=a.close;if(b(a.anchors?a.from.element||a.to.element:a.element)){var g=k(a);g&&(c=g.start)}c?(c=c(),c.done(function(a){d(!a)}),xa(a,c)):d()}})});F(u(d))});return D}}]}]).provider("$animateCss",["$animateProvider",function(a){var b=Fa(),c=Fa();this.$get=["$window","$$jqLite","$$AnimateRunner","$timeout","$$forceReflow","$sniffer","$$rAFScheduler","$$animateQueue",function(a,e,f,r,x,F,u,l){function w(a,b){var c=a.parentNode;return(c.$$ngAnimateParentKey||(c.$$ngAnimateParentKey=++P))+"-"+a.getAttribute("class")+
"-"+b}function s(k,h,f,l){var n;0<b.count(f)&&(n=c.get(f),n||(h=V(h,"-stagger"),e.addClass(k,h),n=Da(a,k,l),n.animationDuration=Math.max(n.animationDuration,0),n.transitionDuration=Math.max(n.transitionDuration,0),e.removeClass(k,h),c.put(f,n)));return n||{}}function M(a){y.push(a);u.waitUntilQuiet(function(){b.flush();c.flush();for(var a=x(),d=0;d<y.length;d++)y[d](a);y.length=0})}function v(c,h,e){h=b.get(e);h||(h=Da(a,c,Sa),"infinite"===h.animationIterationCount&&(h.animationIterationCount=1));
b.put(e,h);c=h;e=c.animationDelay;h=c.transitionDelay;c.maxDelay=e&&h?Math.max(e,h):e||h;c.maxDuration=Math.max(c.animationDuration*c.animationIterationCount,c.transitionDuration);return c}var h=Q(e),P=0,y=[];return function(a,c){function d(){n()}function u(){n(!0)}function n(b){if(!(P||H&&da)){P=!0;da=!1;g.$$skipPreparationClasses||e.removeClass(a,fa);e.removeClass(a,ga);ra(m,!1);pa(m,!1);q(y,function(a){m.style[a[0]]=""});h(a,g);ha(a,g);Object.keys(G).length&&q(G,function(a,b){a?m.style.setProperty(b,
a):m.style.removeProperty(b)});if(g.onDone)g.onDone();ea&&ea.length&&a.off(ea.join(" "),C);var c=a.data("$$animateCss");c&&(r.cancel(c[0].timer),a.removeData("$$animateCss"));E&&E.complete(!b)}}function D(a){p.blockTransition&&pa(m,a);p.blockKeyframeAnimation&&ra(m,!!a)}function z(){E=new f({end:d,cancel:u});M(O);n();return{$$willAnimate:!1,start:function(){return E},end:d}}function C(a){a.stopPropagation();var b=a.originalEvent||a;a=b.$manualTimeStamp||Date.now();b=parseFloat(b.elapsedTime.toFixed(3));
Math.max(a-W,0)>=Q&&b>=L&&(H=!0,n())}function K(){function b(){if(!P){D(!1);q(y,function(a){m.style[a[0]]=a[1]});h(a,g);e.addClass(a,ga);if(p.recalculateTimingStyles){na=m.className+" "+fa;ia=w(m,na);B=v(m,na,ia);$=B.maxDelay;I=Math.max($,0);L=B.maxDuration;if(0===L){n();return}p.hasTransitions=0<B.transitionDuration;p.hasAnimations=0<B.animationDuration}p.applyAnimationDelay&&($="boolean"!==typeof g.delay&&sa(g.delay)?parseFloat(g.delay):$,I=Math.max($,0),B.animationDelay=$,aa=[qa,$+"s"],y.push(aa),
m.style[aa[0]]=aa[1]);Q=1E3*I;T=1E3*L;if(g.easing){var d,f=g.easing;p.hasTransitions&&(d=R+"TimingFunction",y.push([d,f]),m.style[d]=f);p.hasAnimations&&(d=X+"TimingFunction",y.push([d,f]),m.style[d]=f)}B.transitionDuration&&ea.push(ua);B.animationDuration&&ea.push(va);W=Date.now();var l=Q+1.5*T;d=W+l;var f=a.data("$$animateCss")||[],K=!0;if(f.length){var z=f[0];(K=d>z.expectedEndTime)?r.cancel(z.timer):f.push(n)}K&&(l=r(c,l,!1),f[0]={timer:l,expectedEndTime:d},f.push(n),a.data("$$animateCss",f));
if(ea.length)a.on(ea.join(" "),C);g.to&&(g.cleanupStyles&&Ga(G,m,Object.keys(g.to)),Ba(a,g))}}function c(){var b=a.data("$$animateCss");if(b){for(var d=1;d<b.length;d++)b[d]();a.removeData("$$animateCss")}}if(!P)if(m.parentNode){var d=function(a){if(H)da&&a&&(da=!1,n());else if(da=!a,B.animationDuration)if(a=ra(m,da),da)y.push(a);else{var b=y,c=b.indexOf(a);0<=a&&b.splice(c,1)}},f=0<ca&&(B.transitionDuration&&0===U.transitionDuration||B.animationDuration&&0===U.animationDuration)&&Math.max(U.animationDelay,
U.transitionDelay);f?r(b,Math.floor(f*ca*1E3),!1):b();N.resume=function(){d(!0)};N.pause=function(){d(!1)}}else n()}var g=c||{};g.$$prepared||(g=oa(Ha(g)));var G={},m=A(a);if(!m||!m.parentNode||!l.enabled())return z();var y=[],x=a.attr("class"),t=La(g),P,da,H,E,N,I,Q,L,T,W,ea=[];if(0===g.duration||!F.animations&&!F.transitions)return z();var ja=g.event&&ba(g.event)?g.event.join(" "):g.event,Y="",S="";ja&&g.structural?Y=V(ja,"ng-",!0):ja&&(Y=ja);g.addClass&&(S+=V(g.addClass,"-add"));g.removeClass&&
(S.length&&(S+=" "),S+=V(g.removeClass,"-remove"));g.applyClassesEarly&&S.length&&h(a,g);var fa=[Y,S].join(" ").trim(),na=x+" "+fa,ga=V(fa,"-active"),x=t.to&&0<Object.keys(t.to).length;if(!(0<(g.keyframeStyle||"").length||x||fa))return z();var ia,U;0<g.stagger?(t=parseFloat(g.stagger),U={transitionDelay:t,animationDelay:t,transitionDuration:0,animationDuration:0}):(ia=w(m,na),U=s(m,fa,ia,Ta));g.$$skipPreparationClasses||e.addClass(a,fa);g.transitionStyle&&(t=[R,g.transitionStyle],la(m,t),y.push(t));
0<=g.duration&&(t=0<m.style[R].length,t=Ea(g.duration,t),la(m,t),y.push(t));g.keyframeStyle&&(t=[X,g.keyframeStyle],la(m,t),y.push(t));var ca=U?0<=g.staggerIndex?g.staggerIndex:b.count(ia):0;(ja=0===ca)&&!g.skipBlocking&&pa(m,9999);var B=v(m,na,ia),$=B.maxDelay;I=Math.max($,0);L=B.maxDuration;var p={};p.hasTransitions=0<B.transitionDuration;p.hasAnimations=0<B.animationDuration;p.hasTransitionAll=p.hasTransitions&&"all"==B.transitionProperty;p.applyTransitionDuration=x&&(p.hasTransitions&&!p.hasTransitionAll||
p.hasAnimations&&!p.hasTransitions);p.applyAnimationDuration=g.duration&&p.hasAnimations;p.applyTransitionDelay=sa(g.delay)&&(p.applyTransitionDuration||p.hasTransitions);p.applyAnimationDelay=sa(g.delay)&&p.hasAnimations;p.recalculateTimingStyles=0<S.length;if(p.applyTransitionDuration||p.applyAnimationDuration)L=g.duration?parseFloat(g.duration):L,p.applyTransitionDuration&&(p.hasTransitions=!0,B.transitionDuration=L,t=0<m.style[R+"Property"].length,y.push(Ea(L,t))),p.applyAnimationDuration&&(p.hasAnimations=
!0,B.animationDuration=L,y.push([wa,L+"s"]));if(0===L&&!p.recalculateTimingStyles)return z();if(null!=g.delay){var aa;"boolean"!==typeof g.delay&&(aa=parseFloat(g.delay),I=Math.max(aa,0));p.applyTransitionDelay&&y.push([ma,aa+"s"]);p.applyAnimationDelay&&y.push([qa,aa+"s"])}null==g.duration&&0<B.transitionDuration&&(p.recalculateTimingStyles=p.recalculateTimingStyles||ja);Q=1E3*I;T=1E3*L;g.skipBlocking||(p.blockTransition=0<B.transitionDuration,p.blockKeyframeAnimation=0<B.animationDuration&&0<U.animationDelay&&
0===U.animationDuration);g.from&&(g.cleanupStyles&&Ga(G,m,Object.keys(g.from)),Aa(a,g));p.blockTransition||p.blockKeyframeAnimation?D(L):g.skipBlocking||pa(m,!1);return{$$willAnimate:!0,end:d,start:function(){if(!P)return N={end:d,cancel:u,resume:null,pause:null},E=new f(N),M(K),E}}}}]}]).provider("$$animateCssDriver",["$$animationProvider",function(a){a.drivers.push("$$animateCssDriver");this.$get=["$animateCss","$rootScope","$$AnimateRunner","$rootElement","$sniffer","$$jqLite","$document",function(a,
c,d,e,f,r,x){function F(a){return a.replace(/\bng-\S+\b/g,"")}function u(a,b){I(a)&&(a=a.split(" "));I(b)&&(b=b.split(" "));return a.filter(function(a){return-1===b.indexOf(a)}).join(" ")}function l(c,e,f){function k(a){var b={},c=A(a).getBoundingClientRect();q(["width","height","top","left"],function(a){var d=c[a];switch(a){case "top":d+=M.scrollTop;break;case "left":d+=M.scrollLeft}b[a]=Math.floor(d)+"px"});return b}function l(){var c=F(f.attr("class")||""),d=u(c,n),c=u(n,c),d=a(r,{to:k(f),addClass:"ng-anchor-in "+
d,removeClass:"ng-anchor-out "+c,delay:!0});return d.$$willAnimate?d:null}function x(){r.remove();e.removeClass("ng-animate-shim");f.removeClass("ng-animate-shim")}var r=H(A(e).cloneNode(!0)),n=F(r.attr("class")||"");e.addClass("ng-animate-shim");f.addClass("ng-animate-shim");r.addClass("ng-anchor");v.append(r);var D;c=function(){var c=a(r,{addClass:"ng-anchor-out",delay:!0,from:k(e)});return c.$$willAnimate?c:null}();if(!c&&(D=l(),!D))return x();var z=c||D;return{start:function(){function a(){c&&
c.end()}var b,c=z.start();c.done(function(){c=null;if(!D&&(D=l()))return c=D.start(),c.done(function(){c=null;x();b.complete()}),c;x();b.complete()});return b=new d({end:a,cancel:a})}}}function w(a,b,c,e){var f=s(a,O),r=s(b,O),x=[];q(e,function(a){(a=l(c,a.out,a["in"]))&&x.push(a)});if(f||r||0!==x.length)return{start:function(){function a(){q(b,function(a){a.end()})}var b=[];f&&b.push(f.start());r&&b.push(r.start());q(x,function(a){b.push(a.start())});var c=new d({end:a,cancel:a});d.all(b,function(a){c.complete(a)});
return c}}}function s(c){var d=c.element,e=c.options||{};c.structural&&(e.event=c.event,e.structural=!0,e.applyClassesEarly=!0,"leave"===c.event&&(e.onDone=e.domOperation));e.preparationClasses&&(e.event=W(e.event,e.preparationClasses));c=a(d,e);return c.$$willAnimate?c:null}if(!f.animations&&!f.transitions)return O;var M=x[0].body;c=A(e);var v=H(c.parentNode&&11===c.parentNode.nodeType||M.contains(c)?c:M);Q(r);return function(a){return a.from&&a.to?w(a.from,a.to,a.classes,a.anchors):s(a)}}]}]).provider("$$animateJs",
["$animateProvider",function(a){this.$get=["$injector","$$AnimateRunner","$$jqLite",function(b,c,d){function e(c){c=ba(c)?c:c.split(" ");for(var d=[],e={},f=0;f<c.length;f++){var l=c[f],q=a.$$registeredAnimations[l];q&&!e[l]&&(d.push(b.get(q)),e[l]=!0)}return d}var f=Q(d);return function(a,b,d,u){function l(){u.domOperation();f(a,u)}function w(a,b,d,e,g){switch(d){case "animate":b=[b,e.from,e.to,g];break;case "setClass":b=[b,h,H,g];break;case "addClass":b=[b,h,g];break;case "removeClass":b=[b,H,g];
break;default:b=[b,g]}b.push(e);if(a=a.apply(a,b))if(Ia(a.start)&&(a=a.start()),a instanceof c)a.done(g);else if(Ia(a))return a;return O}function s(a,b,d,e,g){var f=[];q(e,function(e){var h=e[g];h&&f.push(function(){var e,g,f=!1,k=function(a){f||(f=!0,(g||O)(a),e.complete(!a))};e=new c({end:function(){k()},cancel:function(){k(!0)}});g=w(h,a,b,d,function(a){k(!1===a)});return e})});return f}function A(a,b,d,e,g){var f=s(a,b,d,e,g);if(0===f.length){var h,k;"beforeSetClass"===g?(h=s(a,"removeClass",
d,e,"beforeRemoveClass"),k=s(a,"addClass",d,e,"beforeAddClass")):"setClass"===g&&(h=s(a,"removeClass",d,e,"removeClass"),k=s(a,"addClass",d,e,"addClass"));h&&(f=f.concat(h));k&&(f=f.concat(k))}if(0!==f.length)return function(a){var b=[];f.length&&q(f,function(a){b.push(a())});b.length?c.all(b,a):a();return function(a){q(b,function(b){a?b.cancel():b.end()})}}}var v=!1;3===arguments.length&&ca(d)&&(u=d,d=null);u=oa(u);d||(d=a.attr("class")||"",u.addClass&&(d+=" "+u.addClass),u.removeClass&&(d+=" "+
u.removeClass));var h=u.addClass,H=u.removeClass,y=e(d),k,E;if(y.length){var I,J;"leave"==b?(J="leave",I="afterLeave"):(J="before"+b.charAt(0).toUpperCase()+b.substr(1),I=b);"enter"!==b&&"move"!==b&&(k=A(a,b,u,y,J));E=A(a,b,u,y,I)}if(k||E){var n;return{$$willAnimate:!0,end:function(){n?n.end():(v=!0,l(),ha(a,u),n=new c,n.complete(!0));return n},start:function(){function b(c){v=!0;l();ha(a,u);n.complete(c)}if(n)return n;n=new c;var d,e=[];k&&e.push(function(a){d=k(a)});e.length?e.push(function(a){l();
a(!0)}):l();E&&e.push(function(a){d=E(a)});n.setHost({end:function(){v||((d||O)(void 0),b(void 0))},cancel:function(){v||((d||O)(!0),b(!0))}});c.chain(e,b);return n}}}}}]}]).provider("$$animateJsDriver",["$$animationProvider",function(a){a.drivers.push("$$animateJsDriver");this.$get=["$$animateJs","$$AnimateRunner",function(a,c){function d(c){return a(c.element,c.event,c.classes,c.options)}return function(a){if(a.from&&a.to){var b=d(a.from),r=d(a.to);if(b||r)return{start:function(){function a(){return function(){q(d,
function(a){a.end()})}}var d=[];b&&d.push(b.start());r&&d.push(r.start());c.all(d,function(a){e.complete(a)});var e=new c({end:a(),cancel:a()});return e}}}else return d(a)}}]}])})(window,window.angular);
//# sourceMappingURL=angular-animate.min.js.map

/*!
 * ionic.bundle.js is a concatenation of:
 * ionic.js, angular.js, angular-animate.js,
 * angular-sanitize.js, angular-ui-router.js,
 * and ionic-angular.js
 */

/*
 AngularJS v1.5.3
 (c) 2010-2016 Google, Inc. http://angularjs.org
 License: MIT
*/
(function(A,e,B){'use strict';function C(a){var c=[];v(c,e.noop).chars(a);return c.join("")}function h(a,c){var b={},d=a.split(","),l;for(l=0;l<d.length;l++)b[c?e.lowercase(d[l]):d[l]]=!0;return b}function D(a,c){null===a||a===B?a="":"string"!==typeof a&&(a=""+a);g.innerHTML=a;var b=5;do{if(0===b)throw w("uinput");b--;11>=document.documentMode&&n(g);a=g.innerHTML;g.innerHTML=a}while(a!==g.innerHTML);for(b=g.firstChild;b;){switch(b.nodeType){case 1:c.start(b.nodeName.toLowerCase(),E(b.attributes));
break;case 3:c.chars(b.textContent)}var d;if(!(d=b.firstChild)&&(1==b.nodeType&&c.end(b.nodeName.toLowerCase()),d=b.nextSibling,!d))for(;null==d;){b=b.parentNode;if(b===g)break;d=b.nextSibling;1==b.nodeType&&c.end(b.nodeName.toLowerCase())}b=d}for(;b=g.firstChild;)g.removeChild(b)}function E(a){for(var c={},b=0,d=a.length;b<d;b++){var l=a[b];c[l.name]=l.value}return c}function x(a){return a.replace(/&/g,"&amp;").replace(F,function(a){var b=a.charCodeAt(0);a=a.charCodeAt(1);return"&#"+(1024*(b-55296)+
(a-56320)+65536)+";"}).replace(G,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function v(a,c){var b=!1,d=e.bind(a,a.push);return{start:function(a,f){a=e.lowercase(a);!b&&H[a]&&(b=a);b||!0!==t[a]||(d("<"),d(a),e.forEach(f,function(b,f){var g=e.lowercase(f),h="img"===a&&"src"===g||"background"===g;!0!==I[g]||!0===y[g]&&!c(b,h)||(d(" "),d(f),d('="'),d(x(b)),d('"'))}),d(">"))},end:function(a){a=e.lowercase(a);b||!0!==t[a]||!0===z[a]||(d("</"),d(a),d(">"));a==
b&&(b=!1)},chars:function(a){b||d(x(a))}}}function n(a){if(a.nodeType===Node.ELEMENT_NODE)for(var c=a.attributes,b=0,d=c.length;b<d;b++){var e=c[b],f=e.name.toLowerCase();if("xmlns:ns1"===f||0===f.indexOf("ns1:"))a.removeAttributeNode(e),b--,d--}(c=a.firstChild)&&n(c);(c=a.nextSibling)&&n(c)}var w=e.$$minErr("$sanitize"),F=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,G=/([^\#-~ |!])/g,z=h("area,br,col,hr,img,wbr"),q=h("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),k=h("rp,rt"),u=e.extend({},k,q),q=e.extend({},
q,h("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,section,table,ul")),k=e.extend({},k,h("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),J=h("circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,stop,svg,switch,text,title,tspan"),
H=h("script,style"),t=e.extend({},z,q,k,u),y=h("background,cite,href,longdesc,src,xlink:href"),u=h("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,tabindex,target,title,type,valign,value,vspace,width"),k=h("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan",
!0),I=e.extend({},y,k,u),g;(function(a){if(a.document&&a.document.implementation)a=a.document.implementation.createHTMLDocument("inert");else throw w("noinert");var c=(a.documentElement||a.getDocumentElement()).getElementsByTagName("body");1===c.length?g=c[0]:(c=a.createElement("html"),g=a.createElement("body"),c.appendChild(g),a.appendChild(c))})(A);e.module("ngSanitize",[]).provider("$sanitize",function(){var a=!1;this.$get=["$$sanitizeUri",function(c){a&&e.extend(t,J);return function(a){var d=
[];D(a,v(d,function(a,b){return!/^unsafe:/.test(c(a,b))}));return d.join("")}}];this.enableSvg=function(c){return e.isDefined(c)?(a=c,this):a}});e.module("ngSanitize").filter("linky",["$sanitize",function(a){var c=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/i,b=/^mailto:/i,d=e.$$minErr("linky"),g=e.isString;return function(f,h,m){function k(a){a&&p.push(C(a))}function q(a,b){var c;p.push("<a ");e.isFunction(m)&&(m=m(a));if(e.isObject(m))for(c in m)p.push(c+
'="'+m[c]+'" ');else m={};!e.isDefined(h)||"target"in m||p.push('target="',h,'" ');p.push('href="',a.replace(/"/g,"&quot;"),'">');k(b);p.push("</a>")}if(null==f||""===f)return f;if(!g(f))throw d("notstring",f);for(var r=f,p=[],s,n;f=r.match(c);)s=f[0],f[2]||f[4]||(s=(f[3]?"http://":"mailto:")+s),n=f.index,k(r.substr(0,n)),q(s,f[0].replace(b,"")),r=r.substring(n+f[0].length);k(r);return a(p.join(""))}}])})(window,window.angular);
//# sourceMappingURL=angular-sanitize.min.js.map

/*!
 * ionic.bundle.js is a concatenation of:
 * ionic.js, angular.js, angular-animate.js,
 * angular-sanitize.js, angular-ui-router.js,
 * and ionic-angular.js
 */

/**
 * State-based routing for AngularJS
 * @version v0.2.13
 * @link http://angular-ui.github.com/
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ui.router"),function(a,b,c){"use strict";function d(a,b){return M(new(M(function(){},{prototype:a})),b)}function e(a){return L(arguments,function(b){b!==a&&L(b,function(b,c){a.hasOwnProperty(c)||(a[c]=b)})}),a}function f(a,b){var c=[];for(var d in a.path){if(a.path[d]!==b.path[d])break;c.push(a.path[d])}return c}function g(a){if(Object.keys)return Object.keys(a);var c=[];return b.forEach(a,function(a,b){c.push(b)}),c}function h(a,b){if(Array.prototype.indexOf)return a.indexOf(b,Number(arguments[2])||0);var c=a.length>>>0,d=Number(arguments[2])||0;for(d=0>d?Math.ceil(d):Math.floor(d),0>d&&(d+=c);c>d;d++)if(d in a&&a[d]===b)return d;return-1}function i(a,b,c,d){var e,i=f(c,d),j={},k=[];for(var l in i)if(i[l].params&&(e=g(i[l].params),e.length))for(var m in e)h(k,e[m])>=0||(k.push(e[m]),j[e[m]]=a[e[m]]);return M({},j,b)}function j(a,b,c){if(!c){c=[];for(var d in a)c.push(d)}for(var e=0;e<c.length;e++){var f=c[e];if(a[f]!=b[f])return!1}return!0}function k(a,b){var c={};return L(a,function(a){c[a]=b[a]}),c}function l(a){var b={},c=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));for(var d in a)-1==h(c,d)&&(b[d]=a[d]);return b}function m(a,b){var c=K(a),d=c?[]:{};return L(a,function(a,e){b(a,e)&&(d[c?d.length:e]=a)}),d}function n(a,b){var c=K(a)?[]:{};return L(a,function(a,d){c[d]=b(a,d)}),c}function o(a,b){var d=1,f=2,i={},j=[],k=i,m=M(a.when(i),{$$promises:i,$$values:i});this.study=function(i){function n(a,c){if(s[c]!==f){if(r.push(c),s[c]===d)throw r.splice(0,h(r,c)),new Error("Cyclic dependency: "+r.join(" -> "));if(s[c]=d,I(a))q.push(c,[function(){return b.get(a)}],j);else{var e=b.annotate(a);L(e,function(a){a!==c&&i.hasOwnProperty(a)&&n(i[a],a)}),q.push(c,a,e)}r.pop(),s[c]=f}}function o(a){return J(a)&&a.then&&a.$$promises}if(!J(i))throw new Error("'invocables' must be an object");var p=g(i||{}),q=[],r=[],s={};return L(i,n),i=r=s=null,function(d,f,g){function h(){--u||(v||e(t,f.$$values),r.$$values=t,r.$$promises=r.$$promises||!0,delete r.$$inheritedValues,n.resolve(t))}function i(a){r.$$failure=a,n.reject(a)}function j(c,e,f){function j(a){l.reject(a),i(a)}function k(){if(!G(r.$$failure))try{l.resolve(b.invoke(e,g,t)),l.promise.then(function(a){t[c]=a,h()},j)}catch(a){j(a)}}var l=a.defer(),m=0;L(f,function(a){s.hasOwnProperty(a)&&!d.hasOwnProperty(a)&&(m++,s[a].then(function(b){t[a]=b,--m||k()},j))}),m||k(),s[c]=l.promise}if(o(d)&&g===c&&(g=f,f=d,d=null),d){if(!J(d))throw new Error("'locals' must be an object")}else d=k;if(f){if(!o(f))throw new Error("'parent' must be a promise returned by $resolve.resolve()")}else f=m;var n=a.defer(),r=n.promise,s=r.$$promises={},t=M({},d),u=1+q.length/3,v=!1;if(G(f.$$failure))return i(f.$$failure),r;f.$$inheritedValues&&e(t,l(f.$$inheritedValues,p)),M(s,f.$$promises),f.$$values?(v=e(t,l(f.$$values,p)),r.$$inheritedValues=l(f.$$values,p),h()):(f.$$inheritedValues&&(r.$$inheritedValues=l(f.$$inheritedValues,p)),f.then(h,i));for(var w=0,x=q.length;x>w;w+=3)d.hasOwnProperty(q[w])?h():j(q[w],q[w+1],q[w+2]);return r}},this.resolve=function(a,b,c,d){return this.study(a)(b,c,d)}}function p(a,b,c){this.fromConfig=function(a,b,c){return G(a.template)?this.fromString(a.template,b):G(a.templateUrl)?this.fromUrl(a.templateUrl,b):G(a.templateProvider)?this.fromProvider(a.templateProvider,b,c):null},this.fromString=function(a,b){return H(a)?a(b):a},this.fromUrl=function(c,d){return H(c)&&(c=c(d)),null==c?null:a.get(c,{cache:b,headers:{Accept:"text/html"}}).then(function(a){return a.data})},this.fromProvider=function(a,b,d){return c.invoke(a,null,d||{params:b})}}function q(a,b,e){function f(b,c,d,e){if(q.push(b),o[b])return o[b];if(!/^\w+(-+\w+)*(?:\[\])?$/.test(b))throw new Error("Invalid parameter name '"+b+"' in pattern '"+a+"'");if(p[b])throw new Error("Duplicate parameter name '"+b+"' in pattern '"+a+"'");return p[b]=new O.Param(b,c,d,e),p[b]}function g(a,b,c){var d=["",""],e=a.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!b)return e;switch(c){case!1:d=["(",")"];break;case!0:d=["?(",")?"];break;default:d=["("+c+"|",")?"]}return e+d[0]+b+d[1]}function h(c,e){var f,g,h,i,j;return f=c[2]||c[3],j=b.params[f],h=a.substring(m,c.index),g=e?c[4]:c[4]||("*"==c[1]?".*":null),i=O.type(g||"string")||d(O.type("string"),{pattern:new RegExp(g)}),{id:f,regexp:g,segment:h,type:i,cfg:j}}b=M({params:{}},J(b)?b:{});var i,j=/([:*])([\w\[\]]+)|\{([\w\[\]]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,k=/([:]?)([\w\[\]-]+)|\{([\w\[\]-]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,l="^",m=0,n=this.segments=[],o=e?e.params:{},p=this.params=e?e.params.$$new():new O.ParamSet,q=[];this.source=a;for(var r,s,t;(i=j.exec(a))&&(r=h(i,!1),!(r.segment.indexOf("?")>=0));)s=f(r.id,r.type,r.cfg,"path"),l+=g(r.segment,s.type.pattern.source,s.squash),n.push(r.segment),m=j.lastIndex;t=a.substring(m);var u=t.indexOf("?");if(u>=0){var v=this.sourceSearch=t.substring(u);if(t=t.substring(0,u),this.sourcePath=a.substring(0,m+u),v.length>0)for(m=0;i=k.exec(v);)r=h(i,!0),s=f(r.id,r.type,r.cfg,"search"),m=j.lastIndex}else this.sourcePath=a,this.sourceSearch="";l+=g(t)+(b.strict===!1?"/?":"")+"$",n.push(t),this.regexp=new RegExp(l,b.caseInsensitive?"i":c),this.prefix=n[0],this.$$paramNames=q}function r(a){M(this,a)}function s(){function a(a){return null!=a?a.toString().replace(/\//g,"%2F"):a}function e(a){return null!=a?a.toString().replace(/%2F/g,"/"):a}function f(a){return this.pattern.test(a)}function i(){return{strict:t,caseInsensitive:p}}function j(a){return H(a)||K(a)&&H(a[a.length-1])}function k(){for(;x.length;){var a=x.shift();if(a.pattern)throw new Error("You cannot override a type's .pattern at runtime.");b.extend(v[a.name],o.invoke(a.def))}}function l(a){M(this,a||{})}O=this;var o,p=!1,t=!0,u=!1,v={},w=!0,x=[],y={string:{encode:a,decode:e,is:f,pattern:/[^/]*/},"int":{encode:a,decode:function(a){return parseInt(a,10)},is:function(a){return G(a)&&this.decode(a.toString())===a},pattern:/\d+/},bool:{encode:function(a){return a?1:0},decode:function(a){return 0!==parseInt(a,10)},is:function(a){return a===!0||a===!1},pattern:/0|1/},date:{encode:function(a){return this.is(a)?[a.getFullYear(),("0"+(a.getMonth()+1)).slice(-2),("0"+a.getDate()).slice(-2)].join("-"):c},decode:function(a){if(this.is(a))return a;var b=this.capture.exec(a);return b?new Date(b[1],b[2]-1,b[3]):c},is:function(a){return a instanceof Date&&!isNaN(a.valueOf())},equals:function(a,b){return this.is(a)&&this.is(b)&&a.toISOString()===b.toISOString()},pattern:/[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/,capture:/([0-9]{4})-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/},json:{encode:b.toJson,decode:b.fromJson,is:b.isObject,equals:b.equals,pattern:/[^/]*/},any:{encode:b.identity,decode:b.identity,is:b.identity,equals:b.equals,pattern:/.*/}};s.$$getDefaultValue=function(a){if(!j(a.value))return a.value;if(!o)throw new Error("Injectable functions cannot be called at configuration time");return o.invoke(a.value)},this.caseInsensitive=function(a){return G(a)&&(p=a),p},this.strictMode=function(a){return G(a)&&(t=a),t},this.defaultSquashPolicy=function(a){if(!G(a))return u;if(a!==!0&&a!==!1&&!I(a))throw new Error("Invalid squash policy: "+a+". Valid policies: false, true, arbitrary-string");return u=a,a},this.compile=function(a,b){return new q(a,M(i(),b))},this.isMatcher=function(a){if(!J(a))return!1;var b=!0;return L(q.prototype,function(c,d){H(c)&&(b=b&&G(a[d])&&H(a[d]))}),b},this.type=function(a,b,c){if(!G(b))return v[a];if(v.hasOwnProperty(a))throw new Error("A type named '"+a+"' has already been defined.");return v[a]=new r(M({name:a},b)),c&&(x.push({name:a,def:c}),w||k()),this},L(y,function(a,b){v[b]=new r(M({name:b},a))}),v=d(v,{}),this.$get=["$injector",function(a){return o=a,w=!1,k(),L(y,function(a,b){v[b]||(v[b]=new r(a))}),this}],this.Param=function(a,b,d,e){function f(a){var b=J(a)?g(a):[],c=-1===h(b,"value")&&-1===h(b,"type")&&-1===h(b,"squash")&&-1===h(b,"array");return c&&(a={value:a}),a.$$fn=j(a.value)?a.value:function(){return a.value},a}function i(b,c,d){if(b.type&&c)throw new Error("Param '"+a+"' has two type configurations.");return c?c:b.type?b.type instanceof r?b.type:new r(b.type):"config"===d?v.any:v.string}function k(){var b={array:"search"===e?"auto":!1},c=a.match(/\[\]$/)?{array:!0}:{};return M(b,c,d).array}function l(a,b){var c=a.squash;if(!b||c===!1)return!1;if(!G(c)||null==c)return u;if(c===!0||I(c))return c;throw new Error("Invalid squash policy: '"+c+"'. Valid policies: false, true, or arbitrary string")}function p(a,b,d,e){var f,g,i=[{from:"",to:d||b?c:""},{from:null,to:d||b?c:""}];return f=K(a.replace)?a.replace:[],I(e)&&f.push({from:e,to:c}),g=n(f,function(a){return a.from}),m(i,function(a){return-1===h(g,a.from)}).concat(f)}function q(){if(!o)throw new Error("Injectable functions cannot be called at configuration time");return o.invoke(d.$$fn)}function s(a){function b(a){return function(b){return b.from===a}}function c(a){var c=n(m(w.replace,b(a)),function(a){return a.to});return c.length?c[0]:a}return a=c(a),G(a)?w.type.decode(a):q()}function t(){return"{Param:"+a+" "+b+" squash: '"+z+"' optional: "+y+"}"}var w=this;d=f(d),b=i(d,b,e);var x=k();b=x?b.$asArray(x,"search"===e):b,"string"!==b.name||x||"path"!==e||d.value!==c||(d.value="");var y=d.value!==c,z=l(d,y),A=p(d,x,y,z);M(this,{id:a,type:b,location:e,array:x,squash:z,replace:A,isOptional:y,value:s,dynamic:c,config:d,toString:t})},l.prototype={$$new:function(){return d(this,M(new l,{$$parent:this}))},$$keys:function(){for(var a=[],b=[],c=this,d=g(l.prototype);c;)b.push(c),c=c.$$parent;return b.reverse(),L(b,function(b){L(g(b),function(b){-1===h(a,b)&&-1===h(d,b)&&a.push(b)})}),a},$$values:function(a){var b={},c=this;return L(c.$$keys(),function(d){b[d]=c[d].value(a&&a[d])}),b},$$equals:function(a,b){var c=!0,d=this;return L(d.$$keys(),function(e){var f=a&&a[e],g=b&&b[e];d[e].type.equals(f,g)||(c=!1)}),c},$$validates:function(a){var b,c,d,e=!0,f=this;return L(this.$$keys(),function(g){d=f[g],c=a[g],b=!c&&d.isOptional,e=e&&(b||!!d.type.is(c))}),e},$$parent:c},this.ParamSet=l}function t(a,d){function e(a){var b=/^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(a.source);return null!=b?b[1].replace(/\\(.)/g,"$1"):""}function f(a,b){return a.replace(/\$(\$|\d{1,2})/,function(a,c){return b["$"===c?0:Number(c)]})}function g(a,b,c){if(!c)return!1;var d=a.invoke(b,b,{$match:c});return G(d)?d:!0}function h(d,e,f,g){function h(a,b,c){return"/"===p?a:b?p.slice(0,-1)+a:c?p.slice(1)+a:a}function m(a){function b(a){var b=a(f,d);return b?(I(b)&&d.replace().url(b),!0):!1}if(!a||!a.defaultPrevented){var e=o&&d.url()===o;if(o=c,e)return!0;var g,h=j.length;for(g=0;h>g;g++)if(b(j[g]))return;k&&b(k)}}function n(){return i=i||e.$on("$locationChangeSuccess",m)}var o,p=g.baseHref(),q=d.url();return l||n(),{sync:function(){m()},listen:function(){return n()},update:function(a){return a?void(q=d.url()):void(d.url()!==q&&(d.url(q),d.replace()))},push:function(a,b,e){d.url(a.format(b||{})),o=e&&e.$$avoidResync?d.url():c,e&&e.replace&&d.replace()},href:function(c,e,f){if(!c.validates(e))return null;var g=a.html5Mode();b.isObject(g)&&(g=g.enabled);var i=c.format(e);if(f=f||{},g||null===i||(i="#"+a.hashPrefix()+i),i=h(i,g,f.absolute),!f.absolute||!i)return i;var j=!g&&i?"/":"",k=d.port();return k=80===k||443===k?"":":"+k,[d.protocol(),"://",d.host(),k,j,i].join("")}}}var i,j=[],k=null,l=!1;this.rule=function(a){if(!H(a))throw new Error("'rule' must be a function");return j.push(a),this},this.otherwise=function(a){if(I(a)){var b=a;a=function(){return b}}else if(!H(a))throw new Error("'rule' must be a function");return k=a,this},this.when=function(a,b){var c,h=I(b);if(I(a)&&(a=d.compile(a)),!h&&!H(b)&&!K(b))throw new Error("invalid 'handler' in when()");var i={matcher:function(a,b){return h&&(c=d.compile(b),b=["$match",function(a){return c.format(a)}]),M(function(c,d){return g(c,b,a.exec(d.path(),d.search()))},{prefix:I(a.prefix)?a.prefix:""})},regex:function(a,b){if(a.global||a.sticky)throw new Error("when() RegExp must not be global or sticky");return h&&(c=b,b=["$match",function(a){return f(c,a)}]),M(function(c,d){return g(c,b,a.exec(d.path()))},{prefix:e(a)})}},j={matcher:d.isMatcher(a),regex:a instanceof RegExp};for(var k in j)if(j[k])return this.rule(i[k](a,b));throw new Error("invalid 'what' in when()")},this.deferIntercept=function(a){a===c&&(a=!0),l=a},this.$get=h,h.$inject=["$location","$rootScope","$injector","$browser"]}function u(a,e){function f(a){return 0===a.indexOf(".")||0===a.indexOf("^")}function l(a,b){if(!a)return c;var d=I(a),e=d?a:a.name,g=f(e);if(g){if(!b)throw new Error("No reference point given for path '"+e+"'");b=l(b);for(var h=e.split("."),i=0,j=h.length,k=b;j>i;i++)if(""!==h[i]||0!==i){if("^"!==h[i])break;if(!k.parent)throw new Error("Path '"+e+"' not valid for state '"+b.name+"'");k=k.parent}else k=b;h=h.slice(i).join("."),e=k.name+(k.name&&h?".":"")+h}var m=y[e];return!m||!d&&(d||m!==a&&m.self!==a)?c:m}function m(a,b){z[a]||(z[a]=[]),z[a].push(b)}function o(a){for(var b=z[a]||[];b.length;)p(b.shift())}function p(b){b=d(b,{self:b,resolve:b.resolve||{},toString:function(){return this.name}});var c=b.name;if(!I(c)||c.indexOf("@")>=0)throw new Error("State must have a valid name");if(y.hasOwnProperty(c))throw new Error("State '"+c+"'' is already defined");var e=-1!==c.indexOf(".")?c.substring(0,c.lastIndexOf(".")):I(b.parent)?b.parent:J(b.parent)&&I(b.parent.name)?b.parent.name:"";if(e&&!y[e])return m(e,b.self);for(var f in B)H(B[f])&&(b[f]=B[f](b,B.$delegates[f]));return y[c]=b,!b[A]&&b.url&&a.when(b.url,["$match","$stateParams",function(a,c){x.$current.navigable==b&&j(a,c)||x.transitionTo(b,a,{inherit:!0,location:!1})}]),o(c),b}function q(a){return a.indexOf("*")>-1}function r(a){var b=a.split("."),c=x.$current.name.split(".");if("**"===b[0]&&(c=c.slice(h(c,b[1])),c.unshift("**")),"**"===b[b.length-1]&&(c.splice(h(c,b[b.length-2])+1,Number.MAX_VALUE),c.push("**")),b.length!=c.length)return!1;for(var d=0,e=b.length;e>d;d++)"*"===b[d]&&(c[d]="*");return c.join("")===b.join("")}function s(a,b){return I(a)&&!G(b)?B[a]:H(b)&&I(a)?(B[a]&&!B.$delegates[a]&&(B.$delegates[a]=B[a]),B[a]=b,this):this}function t(a,b){return J(a)?b=a:b.name=a,p(b),this}function u(a,e,f,h,m,o,p){function s(b,c,d,f){var g=a.$broadcast("$stateNotFound",b,c,d);if(g.defaultPrevented)return p.update(),B;if(!g.retry)return null;if(f.$retry)return p.update(),C;var h=x.transition=e.when(g.retry);return h.then(function(){return h!==x.transition?u:(b.options.$retry=!0,x.transitionTo(b.to,b.toParams,b.options))},function(){return B}),p.update(),h}function t(a,c,d,g,i,j){var l=d?c:k(a.params.$$keys(),c),n={$stateParams:l};i.resolve=m.resolve(a.resolve,n,i.resolve,a);var o=[i.resolve.then(function(a){i.globals=a})];return g&&o.push(g),L(a.views,function(c,d){var e=c.resolve&&c.resolve!==a.resolve?c.resolve:{};e.$template=[function(){return f.load(d,{view:c,locals:n,params:l,notify:j.notify})||""}],o.push(m.resolve(e,n,i.resolve,a).then(function(f){if(H(c.controllerProvider)||K(c.controllerProvider)){var g=b.extend({},e,n);f.$$controller=h.invoke(c.controllerProvider,null,g)}else f.$$controller=c.controller;f.$$state=a,f.$$controllerAs=c.controllerAs,i[d]=f}))}),e.all(o).then(function(){return i})}var u=e.reject(new Error("transition superseded")),z=e.reject(new Error("transition prevented")),B=e.reject(new Error("transition aborted")),C=e.reject(new Error("transition failed"));return w.locals={resolve:null,globals:{$stateParams:{}}},x={params:{},current:w.self,$current:w,transition:null},x.reload=function(){return x.transitionTo(x.current,o,{reload:!0,inherit:!1,notify:!0})},x.go=function(a,b,c){return x.transitionTo(a,b,M({inherit:!0,relative:x.$current},c))},x.transitionTo=function(b,c,f){c=c||{},f=M({location:!0,inherit:!1,relative:null,notify:!0,reload:!1,$retry:!1},f||{});var g,j=x.$current,m=x.params,n=j.path,q=l(b,f.relative);if(!G(q)){var r={to:b,toParams:c,options:f},y=s(r,j.self,m,f);if(y)return y;if(b=r.to,c=r.toParams,f=r.options,q=l(b,f.relative),!G(q)){if(!f.relative)throw new Error("No such state '"+b+"'");throw new Error("Could not resolve '"+b+"' from state '"+f.relative+"'")}}if(q[A])throw new Error("Cannot transition to abstract state '"+b+"'");if(f.inherit&&(c=i(o,c||{},x.$current,q)),!q.params.$$validates(c))return C;c=q.params.$$values(c),b=q;var B=b.path,D=0,E=B[D],F=w.locals,H=[];if(!f.reload)for(;E&&E===n[D]&&E.ownParams.$$equals(c,m);)F=H[D]=E.locals,D++,E=B[D];if(v(b,j,F,f))return b.self.reloadOnSearch!==!1&&p.update(),x.transition=null,e.when(x.current);if(c=k(b.params.$$keys(),c||{}),f.notify&&a.$broadcast("$stateChangeStart",b.self,c,j.self,m).defaultPrevented)return p.update(),z;for(var I=e.when(F),J=D;J<B.length;J++,E=B[J])F=H[J]=d(F),I=t(E,c,E===b,I,F,f);var K=x.transition=I.then(function(){var d,e,g;if(x.transition!==K)return u;for(d=n.length-1;d>=D;d--)g=n[d],g.self.onExit&&h.invoke(g.self.onExit,g.self,g.locals.globals),g.locals=null;for(d=D;d<B.length;d++)e=B[d],e.locals=H[d],e.self.onEnter&&h.invoke(e.self.onEnter,e.self,e.locals.globals);return x.transition!==K?u:(x.$current=b,x.current=b.self,x.params=c,N(x.params,o),x.transition=null,f.location&&b.navigable&&p.push(b.navigable.url,b.navigable.locals.globals.$stateParams,{$$avoidResync:!0,replace:"replace"===f.location}),f.notify&&a.$broadcast("$stateChangeSuccess",b.self,c,j.self,m),p.update(!0),x.current)},function(d){return x.transition!==K?u:(x.transition=null,g=a.$broadcast("$stateChangeError",b.self,c,j.self,m,d),g.defaultPrevented||p.update(),e.reject(d))});return K},x.is=function(a,b,d){d=M({relative:x.$current},d||{});var e=l(a,d.relative);return G(e)?x.$current!==e?!1:b?j(e.params.$$values(b),o):!0:c},x.includes=function(a,b,d){if(d=M({relative:x.$current},d||{}),I(a)&&q(a)){if(!r(a))return!1;a=x.$current.name}var e=l(a,d.relative);return G(e)?G(x.$current.includes[e.name])?b?j(e.params.$$values(b),o,g(b)):!0:!1:c},x.href=function(a,b,d){d=M({lossy:!0,inherit:!0,absolute:!1,relative:x.$current},d||{});var e=l(a,d.relative);if(!G(e))return null;d.inherit&&(b=i(o,b||{},x.$current,e));var f=e&&d.lossy?e.navigable:e;return f&&f.url!==c&&null!==f.url?p.href(f.url,k(e.params.$$keys(),b||{}),{absolute:d.absolute}):null},x.get=function(a,b){if(0===arguments.length)return n(g(y),function(a){return y[a].self});var c=l(a,b||x.$current);return c&&c.self?c.self:null},x}function v(a,b,c,d){return a!==b||(c!==b.locals||d.reload)&&a.self.reloadOnSearch!==!1?void 0:!0}var w,x,y={},z={},A="abstract",B={parent:function(a){if(G(a.parent)&&a.parent)return l(a.parent);var b=/^(.+)\.[^.]+$/.exec(a.name);return b?l(b[1]):w},data:function(a){return a.parent&&a.parent.data&&(a.data=a.self.data=M({},a.parent.data,a.data)),a.data},url:function(a){var b=a.url,c={params:a.params||{}};if(I(b))return"^"==b.charAt(0)?e.compile(b.substring(1),c):(a.parent.navigable||w).url.concat(b,c);if(!b||e.isMatcher(b))return b;throw new Error("Invalid url '"+b+"' in state '"+a+"'")},navigable:function(a){return a.url?a:a.parent?a.parent.navigable:null},ownParams:function(a){var b=a.url&&a.url.params||new O.ParamSet;return L(a.params||{},function(a,c){b[c]||(b[c]=new O.Param(c,null,a,"config"))}),b},params:function(a){return a.parent&&a.parent.params?M(a.parent.params.$$new(),a.ownParams):new O.ParamSet},views:function(a){var b={};return L(G(a.views)?a.views:{"":a},function(c,d){d.indexOf("@")<0&&(d+="@"+a.parent.name),b[d]=c}),b},path:function(a){return a.parent?a.parent.path.concat(a):[]},includes:function(a){var b=a.parent?M({},a.parent.includes):{};return b[a.name]=!0,b},$delegates:{}};w=p({name:"",url:"^",views:null,"abstract":!0}),w.navigable=null,this.decorator=s,this.state=t,this.$get=u,u.$inject=["$rootScope","$q","$view","$injector","$resolve","$stateParams","$urlRouter","$location","$urlMatcherFactory"]}function v(){function a(a,b){return{load:function(c,d){var e,f={template:null,controller:null,view:null,locals:null,notify:!0,async:!0,params:{}};return d=M(f,d),d.view&&(e=b.fromConfig(d.view,d.params,d.locals)),e&&d.notify&&a.$broadcast("$viewContentLoading",d),e}}}this.$get=a,a.$inject=["$rootScope","$templateFactory"]}function w(){var a=!1;this.useAnchorScroll=function(){a=!0},this.$get=["$anchorScroll","$timeout",function(b,c){return a?b:function(a){c(function(){a[0].scrollIntoView()},0,!1)}}]}function x(a,c,d,e){function f(){return c.has?function(a){return c.has(a)?c.get(a):null}:function(a){try{return c.get(a)}catch(b){return null}}}function g(a,b){var c=function(){return{enter:function(a,b,c){b.after(a),c()},leave:function(a,b){a.remove(),b()}}};if(j)return{enter:function(a,b,c){var d=j.enter(a,null,b,c);d&&d.then&&d.then(c)},leave:function(a,b){var c=j.leave(a,b);c&&c.then&&c.then(b)}};if(i){var d=i&&i(b,a);return{enter:function(a,b,c){d.enter(a,null,b),c()},leave:function(a,b){d.leave(a),b()}}}return c()}var h=f(),i=h("$animator"),j=h("$animate"),k={restrict:"ECA",terminal:!0,priority:400,transclude:"element",compile:function(c,f,h){return function(c,f,i){function j(){l&&(l.remove(),l=null),n&&(n.$destroy(),n=null),m&&(r.leave(m,function(){l=null}),l=m,m=null)}function k(g){var k,l=z(c,i,f,e),s=l&&a.$current&&a.$current.locals[l];if(g||s!==o){k=c.$new(),o=a.$current.locals[l];var t=h(k,function(a){r.enter(a,f,function(){n&&n.$emit("$viewContentAnimationEnded"),(b.isDefined(q)&&!q||c.$eval(q))&&d(a)}),j()});m=t,n=k,n.$emit("$viewContentLoaded"),n.$eval(p)}}var l,m,n,o,p=i.onload||"",q=i.autoscroll,r=g(i,c);c.$on("$stateChangeSuccess",function(){k(!1)}),c.$on("$viewContentLoading",function(){k(!1)}),k(!0)}}};return k}function y(a,b,c,d){return{restrict:"ECA",priority:-400,compile:function(e){var f=e.html();return function(e,g,h){var i=c.$current,j=z(e,h,g,d),k=i&&i.locals[j];if(k){g.data("$uiView",{name:j,state:k.$$state}),g.html(k.$template?k.$template:f);var l=a(g.contents());if(k.$$controller){k.$scope=e;var m=b(k.$$controller,k);k.$$controllerAs&&(e[k.$$controllerAs]=m),g.data("$ngControllerController",m),g.children().data("$ngControllerController",m)}l(e)}}}}}function z(a,b,c,d){var e=d(b.uiView||b.name||"")(a),f=c.inheritedData("$uiView");return e.indexOf("@")>=0?e:e+"@"+(f?f.state.name:"")}function A(a,b){var c,d=a.match(/^\s*({[^}]*})\s*$/);if(d&&(a=b+"("+d[1]+")"),c=a.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/),!c||4!==c.length)throw new Error("Invalid state ref '"+a+"'");return{state:c[1],paramExpr:c[3]||null}}function B(a){var b=a.parent().inheritedData("$uiView");return b&&b.state&&b.state.name?b.state:void 0}function C(a,c){var d=["location","inherit","reload"];return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(e,f,g,h){var i=A(g.uiSref,a.current.name),j=null,k=B(f)||a.$current,l=null,m="A"===f.prop("tagName"),n="FORM"===f[0].nodeName,o=n?"action":"href",p=!0,q={relative:k,inherit:!0},r=e.$eval(g.uiSrefOpts)||{};b.forEach(d,function(a){a in r&&(q[a]=r[a])});var s=function(c){if(c&&(j=b.copy(c)),p){l=a.href(i.state,j,q);var d=h[1]||h[0];return d&&d.$$setStateInfo(i.state,j),null===l?(p=!1,!1):void g.$set(o,l)}};i.paramExpr&&(e.$watch(i.paramExpr,function(a){a!==j&&s(a)},!0),j=b.copy(e.$eval(i.paramExpr))),s(),n||f.bind("click",function(b){var d=b.which||b.button;if(!(d>1||b.ctrlKey||b.metaKey||b.shiftKey||f.attr("target"))){var e=c(function(){a.go(i.state,j,q)});b.preventDefault();var g=m&&!l?1:0;b.preventDefault=function(){g--<=0&&c.cancel(e)}}})}}}function D(a,b,c){return{restrict:"A",controller:["$scope","$element","$attrs",function(b,d,e){function f(){g()?d.addClass(j):d.removeClass(j)}function g(){return"undefined"!=typeof e.uiSrefActiveEq?h&&a.is(h.name,i):h&&a.includes(h.name,i)}var h,i,j;j=c(e.uiSrefActiveEq||e.uiSrefActive||"",!1)(b),this.$$setStateInfo=function(b,c){h=a.get(b,B(d)),i=c,f()},b.$on("$stateChangeSuccess",f)}]}}function E(a){var b=function(b){return a.is(b)};return b.$stateful=!0,b}function F(a){var b=function(b){return a.includes(b)};return b.$stateful=!0,b}var G=b.isDefined,H=b.isFunction,I=b.isString,J=b.isObject,K=b.isArray,L=b.forEach,M=b.extend,N=b.copy;b.module("ui.router.util",["ng"]),b.module("ui.router.router",["ui.router.util"]),b.module("ui.router.state",["ui.router.router","ui.router.util"]),b.module("ui.router",["ui.router.state"]),b.module("ui.router.compat",["ui.router"]),o.$inject=["$q","$injector"],b.module("ui.router.util").service("$resolve",o),p.$inject=["$http","$templateCache","$injector"],b.module("ui.router.util").service("$templateFactory",p);var O;q.prototype.concat=function(a,b){var c={caseInsensitive:O.caseInsensitive(),strict:O.strictMode(),squash:O.defaultSquashPolicy()};return new q(this.sourcePath+a+this.sourceSearch,M(c,b),this)},q.prototype.toString=function(){return this.source},q.prototype.exec=function(a,b){function c(a){function b(a){return a.split("").reverse().join("")}function c(a){return a.replace(/\\-/,"-")}var d=b(a).split(/-(?!\\)/),e=n(d,b);return n(e,c).reverse()}var d=this.regexp.exec(a);if(!d)return null;b=b||{};var e,f,g,h=this.parameters(),i=h.length,j=this.segments.length-1,k={};if(j!==d.length-1)throw new Error("Unbalanced capture group in route '"+this.source+"'");for(e=0;j>e;e++){g=h[e];var l=this.params[g],m=d[e+1];for(f=0;f<l.replace;f++)l.replace[f].from===m&&(m=l.replace[f].to);m&&l.array===!0&&(m=c(m)),k[g]=l.value(m)}for(;i>e;e++)g=h[e],k[g]=this.params[g].value(b[g]);return k},q.prototype.parameters=function(a){return G(a)?this.params[a]||null:this.$$paramNames},q.prototype.validates=function(a){return this.params.$$validates(a)},q.prototype.format=function(a){function b(a){return encodeURIComponent(a).replace(/-/g,function(a){return"%5C%"+a.charCodeAt(0).toString(16).toUpperCase()})}a=a||{};var c=this.segments,d=this.parameters(),e=this.params;if(!this.validates(a))return null;var f,g=!1,h=c.length-1,i=d.length,j=c[0];for(f=0;i>f;f++){var k=h>f,l=d[f],m=e[l],o=m.value(a[l]),p=m.isOptional&&m.type.equals(m.value(),o),q=p?m.squash:!1,r=m.type.encode(o);if(k){var s=c[f+1];if(q===!1)null!=r&&(j+=K(r)?n(r,b).join("-"):encodeURIComponent(r)),j+=s;else if(q===!0){var t=j.match(/\/$/)?/\/?(.*)/:/(.*)/;j+=s.match(t)[1]}else I(q)&&(j+=q+s)}else{if(null==r||p&&q!==!1)continue;K(r)||(r=[r]),r=n(r,encodeURIComponent).join("&"+l+"="),j+=(g?"&":"?")+(l+"="+r),g=!0}}return j},r.prototype.is=function(){return!0},r.prototype.encode=function(a){return a},r.prototype.decode=function(a){return a},r.prototype.equals=function(a,b){return a==b},r.prototype.$subPattern=function(){var a=this.pattern.toString();return a.substr(1,a.length-2)},r.prototype.pattern=/.*/,r.prototype.toString=function(){return"{Type:"+this.name+"}"},r.prototype.$asArray=function(a,b){function d(a,b){function d(a,b){return function(){return a[b].apply(a,arguments)}}function e(a){return K(a)?a:G(a)?[a]:[]}function f(a){switch(a.length){case 0:return c;case 1:return"auto"===b?a[0]:a;default:return a}}function g(a){return!a}function h(a,b){return function(c){c=e(c);var d=n(c,a);return b===!0?0===m(d,g).length:f(d)}}function i(a){return function(b,c){var d=e(b),f=e(c);if(d.length!==f.length)return!1;for(var g=0;g<d.length;g++)if(!a(d[g],f[g]))return!1;return!0}}this.encode=h(d(a,"encode")),this.decode=h(d(a,"decode")),this.is=h(d(a,"is"),!0),this.equals=i(d(a,"equals")),this.pattern=a.pattern,this.$arrayMode=b}if(!a)return this;if("auto"===a&&!b)throw new Error("'auto' array mode is for query parameters only");return new d(this,a)},b.module("ui.router.util").provider("$urlMatcherFactory",s),b.module("ui.router.util").run(["$urlMatcherFactory",function(){}]),t.$inject=["$locationProvider","$urlMatcherFactoryProvider"],b.module("ui.router.router").provider("$urlRouter",t),u.$inject=["$urlRouterProvider","$urlMatcherFactoryProvider"],b.module("ui.router.state").value("$stateParams",{}).provider("$state",u),v.$inject=[],b.module("ui.router.state").provider("$view",v),b.module("ui.router.state").provider("$uiViewScroll",w),x.$inject=["$state","$injector","$uiViewScroll","$interpolate"],y.$inject=["$compile","$controller","$state","$interpolate"],b.module("ui.router.state").directive("uiView",x),b.module("ui.router.state").directive("uiView",y),C.$inject=["$state","$timeout"],D.$inject=["$state","$stateParams","$interpolate"],b.module("ui.router.state").directive("uiSref",C).directive("uiSrefActive",D).directive("uiSrefActiveEq",D),E.$inject=["$state"],F.$inject=["$state"],b.module("ui.router.state").filter("isState",E).filter("includedByState",F)}(window,window.angular);
/*!
 * ionic.bundle.js is a concatenation of:
 * ionic.js, angular.js, angular-animate.js,
 * angular-sanitize.js, angular-ui-router.js,
 * and ionic-angular.js
 */

/*!
 * Copyright 2015 Drifty Co.
 * http://drifty.com/
 *
 * Ionic, v1.3.0
 * A powerful HTML5 mobile app framework.
 * http://ionicframework.com/
 *
 * By @maxlynch, @benjsperry, @adamdbradley <3
 *
 * Licensed under the MIT license. Please see LICENSE for more information.
 *
 */

!function(){function e(e,t,n,i,o,r){function a(i,a,c,s,u){function d(){N.resizeRequiresRefresh(w.__clientWidth,w.__clientHeight)&&g()}function f(){var e;return e={dataLength:0,width:0,height:0,resizeRequiresRefresh:function(t,n){var i=e.dataLength&&t&&n&&(t!==e.width||n!==e.height);return e.width=t,e.height=n,!!i},dataChangeRequiresRefresh:function(t){var n=t.length>0||t.length<e.dataLength;return e.dataLength=t.length,!!n}}}function h(){return T||(T=new e({afterItemsNode:M[0],containerNode:S,heightData:A,widthData:E,forceRefreshImages:!(!l(c.forceRefreshImages)||"false"===c.forceRefreshImages),keyExpression:B,renderBuffer:D,scope:i,scrollView:s.scrollView,transclude:u}))}function p(){var e=angular.element(w.__content.querySelector(".collection-repeat-after-container"));if(!e.length){var t=!1,n=[].filter.call(w.__content.childNodes,function(e){return ionic.DomUtil.contains(e,S)?(t=!0,!1):t});e=angular.element('<span class="collection-repeat-after-container">'),w.options.scrollingX&&e.addClass("horizontal"),e.append(n),w.__content.appendChild(e[0])}return e}function v(){L?m(L,A):A.computed=!0,R?m(R,E):E.computed=!0}function g(){var e=P.length>0;if(e&&(A.computed||E.computed)&&$(),e&&A.computed){if(A.value=V.height,!A.value)throw new Error('collection-repeat tried to compute the height of repeated elements "'+k+'", but was unable to. Please provide the "item-height" attribute. http://ionicframework.com/docs/api/directive/collectionRepeat/')}else!A.dynamic&&A.getValue&&(A.value=A.getValue());if(e&&E.computed){if(E.value=V.width,!E.value)throw new Error('collection-repeat tried to compute the width of repeated elements "'+k+'", but was unable to. Please provide the "item-width" attribute. http://ionicframework.com/docs/api/directive/collectionRepeat/')}else!E.dynamic&&E.getValue&&(E.value=E.getValue());h().refreshLayout()}function m(e,n){if(e){var i;try{i=t(e)}catch(o){e.trim().match(/\d+(px|%)$/)&&(e='"'+e+'"'),i=t(e)}var r=e.replace(/(\'|\"|px|%)/g,"").trim(),a=r.length&&!/([a-zA-Z]|\$|:|\?)/.test(r);if(n.attrValue=e,a)if(e.indexOf("%")>-1){var c=parseFloat(i())/100;n.getValue=n===A?function(){return Math.floor(c*w.__clientHeight)}:function(){return Math.floor(c*w.__clientWidth)}}else n.value=parseInt(i());else n.dynamic=!0,n.getValue=n===A?function(e,t){var n=i(e,t);return n.charAt&&"%"===n.charAt(n.length-1)?Math.floor(parseFloat(n)/100*w.__clientHeight):parseInt(n)}:function(e,t){var n=i(e,t);return n.charAt&&"%"===n.charAt(n.length-1)?Math.floor(parseFloat(n)/100*w.__clientWidth):parseInt(n)}}}function $(){z||u(H=i.$new(),function(e){e[0].removeAttribute("collection-repeat"),z=e[0]}),H[B]=(x(i)||[])[0],o.$$phase||H.$digest(),S.appendChild(z);var e=n.getComputedStyle(z);V.width=parseInt(e.width),V.height=parseInt(e.height),S.removeChild(z)}var w=s.scrollView,b=a[0],S=angular.element('<div class="collection-repeat-container">')[0];if(b.parentNode.replaceChild(S,b),w.options.scrollingX&&w.options.scrollingY)throw new Error("collection-repeat expected a parent x or y scrollView, not an xy scrollView.");var k=c.collectionRepeat,C=k.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(!C)throw new Error("collection-repeat expected expression in form of '_item_ in _collection_[ track by _id_]' but got '"+c.collectionRepeat+"'.");var T,B=C[1],I=C[2],x=t(I),A={},E={},V={},P=[],_=c.itemRenderBuffer||c.collectionBufferSize,D=angular.isDefined(_)?parseInt(_):y,L=c.itemHeight||c.collectionItemHeight,R=c.itemWidth||c.collectionItemWidth,M=p(),N=f();v(),s.$element.on("scroll-resize",g),angular.element(n).on("resize",d);var O=o.$on("$ionicExposeAside",ionic.animationFrameThrottle(function(){s.scrollView.resize(),d()}));r(g,0,!1),i.$watchCollection(x,function(e){if(P=e||(e=[]),!angular.isArray(e))throw new Error("collection-repeat expected an array for '"+I+"', but got a "+typeof value);i.$$postDigest(function(){h().setData(P),N.dataChangeRequiresRefresh(P)&&g()})}),i.$on("$destroy",function(){angular.element(n).off("resize",d),O(),s.$element&&s.$element.off("scroll-resize",g),z&&z.parentNode&&z.parentNode.removeChild(z),H&&H.$destroy(),H=z=null,T&&T.destroy(),T=null});var z,H}return{restrict:"A",priority:1e3,transclude:"element",$$tlb:!0,require:"^^$ionicScroll",link:a}}
e.$inject = ["e", "t", "n", "i", "o", "r"];function t(e,t,n){var i={primaryPos:0,secondaryPos:0,primarySize:0,secondarySize:0,rowPrimarySize:0};return function(o){function r(){return a(!0)}function a(t){if(!a.destroyed){var n,o,r,l,u,d=ee.getScrollValue(),f=d+ee.scrollPrimarySize;ee.updateRenderRange(d,f),F=Math.max(0,F-T),W=Math.min(A.length-1,W+T);for(n in Z)(F>n||n>W)&&(r=Z[n],delete Z[n],G.push(r),r.isShown=!1);for(n=F;W>=n;n++)n>=A.length||Z[n]&&!t||(r=Z[n]||(Z[n]=G.length?G.pop():j.length?j.shift():new s),K.push(r),r.isShown=!0,u=r.scope,u.$index=n,u[C]=A[n],u.$first=0===n,u.$last=n===A.length-1,u.$middle=!(u.$first||u.$last),u.$odd=!(u.$even=0===(1&n)),u.$$disconnected&&ionic.Utils.reconnectScope(r.scope),l=ee.getDimensions(n),(r.secondaryPos!==l.secondaryPos||r.primaryPos!==l.primaryPos)&&(r.node.style[ionic.CSS.TRANSFORM]=z.replace(N,r.primaryPos=l.primaryPos).replace(O,r.secondaryPos=l.secondaryPos)),(r.secondarySize!==l.secondarySize||r.primarySize!==l.primarySize)&&(r.node.style.cssText=r.node.style.cssText.replace(b,H.replace(N,(r.primarySize=l.primarySize)+1).replace(O,r.secondarySize=l.secondarySize))));for(W===A.length-1&&(l=ee.getDimensions(A.length-1)||i,m.style[ionic.CSS.TRANSFORM]=z.replace(N,l.primaryPos+l.primarySize).replace(O,0));G.length;)r=G.pop(),r.scope.$broadcast("$collectionRepeatLeave"),ionic.Utils.disconnectScope(r.scope),j.push(r),r.node.style[ionic.CSS.TRANSFORM]="translate3d(-9999px,-9999px,0)",r.primaryPos=r.secondaryPos=null;if(y)for(n=0,o=K.length;o>n&&(r=K[n]);n++)if(r.images)for(var h,p=0,v=r.images.length;v>p&&(h=r.images[p]);p++){var g=h.src;h.src=w,h.src=g}if(t)for(var $=e.$$phase;K.length;)r=K.pop(),$||r.scope.$digest();else c()}}function c(){var t;c.running||(c.running=!0,n(function(){for(var n=e.$$phase;K.length;)t=K.pop(),t.isShown&&(n||t.scope.$digest());c.running=!1}))}function s(){var e=this;this.scope=B.$new(),this.id="item"+J++,x(this.scope,function(t){e.element=t,e.element.data("$$collectionRepeatItem",e),e.node=t[0],e.node.style[ionic.CSS.TRANSFORM]="translate3d(-9999px,-9999px,0)",e.node.style.cssText+=" height: 0px; width: 0px;",ionic.Utils.disconnectScope(e.scope),$.appendChild(e.node),e.images=t[0].getElementsByTagName("img")})}function l(){this.getItemPrimarySize=P,this.getItemSecondarySize=D,this.getScrollValue=function(){return Math.max(0,Math.min(I.__scrollTop-q,I.__maxScrollTop-q-U))},this.refreshDirection=function(){this.scrollPrimarySize=I.__clientHeight,this.scrollSecondarySize=I.__clientWidth,this.estimatedPrimarySize=v,this.estimatedSecondarySize=g,this.estimatedItemsAcross=R&&Math.floor(I.__clientWidth/g)||1}}function u(){this.getItemPrimarySize=D,this.getItemSecondarySize=P,this.getScrollValue=function(){return Math.max(0,Math.min(I.__scrollLeft-q,I.__maxScrollLeft-q-U))},this.refreshDirection=function(){this.scrollPrimarySize=I.__clientWidth,this.scrollSecondarySize=I.__clientHeight,this.estimatedPrimarySize=g,this.estimatedSecondarySize=v,this.estimatedItemsAcross=R&&Math.floor(I.__clientHeight/v)||1}}function d(){this.getEstimatedSecondaryPos=function(e){return e%this.estimatedItemsAcross*this.estimatedSecondarySize},this.getEstimatedPrimaryPos=function(e){return Math.floor(e/this.estimatedItemsAcross)*this.estimatedPrimarySize},this.getEstimatedIndex=function(e){return Math.floor(e/this.estimatedPrimarySize)*this.estimatedItemsAcross}}function f(){this.getEstimatedSecondaryPos=function(){return 0},this.getEstimatedPrimaryPos=function(e){return e*this.estimatedPrimarySize},this.getEstimatedIndex=function(e){return Math.floor(e/this.estimatedPrimarySize)}}function h(){this.getContentSize=function(){return this.getEstimatedPrimaryPos(A.length-1)+this.estimatedPrimarySize+q+U};var e={};this.getDimensions=function(t){return e.primaryPos=this.getEstimatedPrimaryPos(t),e.secondaryPos=this.getEstimatedSecondaryPos(t),e.primarySize=this.estimatedPrimarySize,e.secondarySize=this.estimatedSecondarySize,e},this.updateRenderRange=function(e,t){F=Math.max(0,this.getEstimatedIndex(e)),W=Math.min(A.length-1,this.getEstimatedIndex(t)+this.estimatedItemsAcross-1),Y=Math.max(0,this.getEstimatedPrimaryPos(F)),X=this.getEstimatedPrimaryPos(W)+this.estimatedPrimarySize}}function p(){function e(e){var t,r,a;for(t=Math.max(0,n);e>=t&&(a=c[t]);t++)r=c[t-1]||i,a.primarySize=o.getItemPrimarySize(t,A[t]),a.secondarySize=o.scrollSecondarySize,a.primaryPos=r.primaryPos+r.primarySize,a.secondaryPos=0}function t(e){var t,r,a;for(t=Math.max(n,0);e>=t&&(a=c[t]);t++)r=c[t-1]||i,a.secondarySize=Math.min(o.getItemSecondarySize(t,A[t]),o.scrollSecondarySize),a.secondaryPos=r.secondaryPos+r.secondarySize,0===t||a.secondaryPos+a.secondarySize>o.scrollSecondarySize?(a.secondaryPos=0,a.primarySize=o.getItemPrimarySize(t,A[t]),a.primaryPos=r.primaryPos+r.rowPrimarySize,a.rowStartIndex=t,a.rowPrimarySize=a.primarySize):(a.primarySize=o.getItemPrimarySize(t,A[t]),a.primaryPos=r.primaryPos,a.rowStartIndex=r.rowStartIndex,c[a.rowStartIndex].rowPrimarySize=a.rowPrimarySize=Math.max(c[a.rowStartIndex].rowPrimarySize,a.primarySize),a.rowPrimarySize=Math.max(a.primarySize,a.rowPrimarySize))}var n,o=this,r=ionic.debounce(Q,25,!0),a=R?t:e,c=[];this.getContentSize=function(){var e=c[n]||i;return(e.primaryPos+e.primarySize||0)+this.getEstimatedPrimaryPos(A.length-n-1)+q+U},this.onDestroy=function(){c.length=0},this.onRefreshData=function(){var e,t;for(e=c.length,t=A.length;t>e;e++)c.push({});n=-1},this.onRefreshLayout=function(){n=-1},this.getDimensions=function(e){return e=Math.min(e,A.length-1),e>n&&(e>.9*A.length?(a(A.length-1),n=A.length-1,Q()):(a(e),n=e,r())),c[e]};var s=-1,l=-1;this.updateRenderRange=function(e,t){var n,i,o;if(this.getDimensions(2*this.getEstimatedIndex(t)),-1===s||0===e)n=0;else if(e>=l)for(n=s,i=A.length;i>n&&!((o=this.getDimensions(n))&&o.primaryPos+o.rowPrimarySize>=e);n++);else for(n=s;n>=0;n--)if((o=this.getDimensions(n))&&o.primaryPos<=e){n=R?o.rowStartIndex:n;break}F=Math.min(Math.max(0,n),A.length-1),Y=-1!==F?this.getDimensions(F).primaryPos:-1;var r;for(n=F+1,i=A.length;i>n;n++)if((o=this.getDimensions(n))&&o.primaryPos+o.rowPrimarySize>t){if(R)for(r=o;i-1>n&&(o=this.getDimensions(n+1)).primaryPos===r.primaryPos;)n++;break}W=Math.min(n,A.length-1),X=-1!==W?(o=this.getDimensions(W)).primaryPos+(o.rowPrimarySize||o.primarySize):-1,l=e,s=F}}var v,g,m=o.afterItemsNode,$=o.containerNode,y=o.forceRefreshImages,S=o.heightData,k=o.widthData,C=o.keyExpression,T=o.renderBuffer,B=o.scope,I=o.scrollView,x=o.transclude,A=[],E={},V=S.getValue||function(){return S.value},P=function(e,t){return E[C]=t,E.$index=e,V(B,E)},_=k.getValue||function(){return k.value},D=function(e,t){return E[C]=t,E.$index=e,_(B,E)},L=!!I.options.scrollingY,R=L?k.dynamic||k.value!==I.__clientWidth:S.dynamic||S.value!==I.__clientHeight,M=!S.dynamic&&!k.dynamic,N="PRIMARY",O="SECONDARY",z=L?"translate3d(SECONDARYpx,PRIMARYpx,0)":"translate3d(PRIMARYpx,SECONDARYpx,0)",H=L?"height: PRIMARYpx; width: SECONDARYpx;":"height: SECONDARYpx; width: PRIMARYpx;",q=0,U=0,F=-1,W=-1,X=-1,Y=-1,j=[],G=[],K=[],Z={},J=0,Q=L?function(){I.setDimensions(null,null,null,ee.getContentSize(),!0)}:function(){I.setDimensions(null,null,ee.getContentSize(),null,!0)},ee=L?new l:new u;(R?d:f).call(ee),(M?h:p).call(ee);var te=L?"getContentHeight":"getContentWidth",ne=I.options[te];I.options[te]=angular.bind(ee,ee.getContentSize),I.__$callback=I.__callback,I.__callback=function(e,t,n,i){var o=ee.getScrollValue();(-1===F||o+ee.scrollPrimarySize>X||Y>o)&&a(),I.__$callback(e,t,n,i)};var ie=!1,oe=!1;this.refreshLayout=function(){A.length?(v=P(0,A[0]),g=D(0,A[0])):(v=100,g=100);var e=getComputedStyle(m)||{},n=m.firstElementChild&&getComputedStyle(m.firstElementChild)||{},i=m.lastElementChild&&getComputedStyle(m.lastElementChild)||{};U=(parseInt(e[L?"height":"width"])||0)+(n&&parseInt(n[L?"marginTop":"marginLeft"])||0)+(i&&parseInt(i[L?"marginBottom":"marginRight"])||0),q=0;var o=$;do q+=o[L?"offsetTop":"offsetLeft"];while(ionic.DomUtil.contains(I.__content,o=o.offsetParent));var a=$.previousElementSibling,c=a?t.getComputedStyle(a):{},l=parseInt(c[L?"marginBottom":"marginRight"]||0);if($.style[ionic.CSS.TRANSFORM]=z.replace(N,-l).replace(O,0),q-=l,I.__clientHeight&&I.__clientWidth||(I.__clientWidth=I.__container.clientWidth,I.__clientHeight=I.__container.clientHeight),(ee.onRefreshLayout||angular.noop)(),ee.refreshDirection(),Q(),!ie)for(var u=Math.max(20,3*T),d=0;u>d;d++)j.push(new s);ie=!0,ie&&oe&&((I.__scrollLeft>I.__maxScrollLeft||I.__scrollTop>I.__maxScrollTop)&&I.resize(),r(!0))},this.setData=function(e){A=e,(ee.onRefreshData||angular.noop)(),oe=!0},this.destroy=function(){a.destroyed=!0,j.forEach(function(e){e.scope.$destroy(),e.scope=e.element=e.node=e.images=null}),j.length=K.length=G.length=0,Z={},I.options[te]=ne,I.__callback=I.__$callback,I.resize(),(ee.onDestroy||angular.noop)()}}}
t.$inject = ["e", "t", "n"];function n(e){return["$ionicGesture","$parse",function(t,n){var i=e.substr(2).toLowerCase();return function(o,r,a){var c=n(a[e]),s=function(e){o.$apply(function(){c(o,{$event:e})})},l=t.on(i,s,r);o.$on("$destroy",function(){t.off(l,i,s)})}}]}function i(e){return["$document","$timeout",function(t,n){return{restrict:"E",controller:"$ionicHeaderBar",compile:function(i){function o(t,n,i,o){e?(t.$watch(function(){return n[0].className},function(e){var n=-1===e.indexOf("ng-hide"),i=-1!==e.indexOf("bar-subheader");t.$hasHeader=n&&!i,t.$hasSubheader=n&&i,t.$emit("$ionicSubheader",t.$hasSubheader)}),t.$on("$destroy",function(){delete t.$hasHeader,delete t.$hasSubheader}),o.align(),t.$on("$ionicHeader.align",function(){ionic.requestAnimationFrame(function(){o.align()})})):(t.$watch(function(){return n[0].className},function(e){var n=-1===e.indexOf("ng-hide"),i=-1!==e.indexOf("bar-subfooter");t.$hasFooter=n&&!i,t.$hasSubfooter=n&&i}),t.$on("$destroy",function(){delete t.$hasFooter,delete t.$hasSubfooter}),t.$watch("$hasTabs",function(e){n.toggleClass("has-tabs",!!e)}),o.align(),t.$on("$ionicFooter.align",function(){ionic.requestAnimationFrame(function(){o.align()})}))}return i.addClass(e?"bar bar-header":"bar bar-footer"),n(function(){e&&t[0].getElementsByClassName("tabs-top").length&&i.addClass("has-tabs-top")}),{pre:o}}}}]}function o(e){return e.clientHeight}function r(e){e.stopPropagation()}var a=angular.module("ionic",["ngAnimate","ngSanitize","ui.router","ngIOS9UIWebViewPatch"]),c=angular.extend,s=angular.forEach,l=angular.isDefined,u=angular.isNumber,d=angular.isString,f=angular.element,h=angular.noop;a.factory("$ionicActionSheet",["$rootScope","$compile","$animate","$timeout","$ionicTemplateLoader","$ionicPlatform","$ionicBody","IONIC_BACK_PRIORITY",function(e,t,n,i,o,r,a,s){function l(o){function l(e){e&&/icon/.test(e)&&(u.$actionSheetHasIcon=!0)}var u=e.$new(!0);c(u,{cancel:h,destructiveButtonClicked:h,buttonClicked:h,$deregisterBackButton:h,buttons:[],cancelOnStateChange:!0},o||{});for(var d=0;d<u.buttons.length;d++)l(u.buttons[d].text);l(u.cancelText),l(u.destructiveText);var p=u.element=t('<ion-action-sheet ng-class="cssClass" buttons="buttons"></ion-action-sheet>')(u),v=f(p[0].querySelector(".action-sheet-wrapper")),g=u.cancelOnStateChange?e.$on("$stateChangeSuccess",function(){u.cancel()}):h;return u.removeSheet=function(e){u.removed||(u.removed=!0,v.removeClass("action-sheet-up"),i(function(){a.removeClass("action-sheet-open")},400),u.$deregisterBackButton(),g(),n.removeClass(p,"active").then(function(){u.$destroy(),p.remove(),u.cancel.$scope=v=null,(e||h)(o.buttons)}))},u.showSheet=function(e){u.removed||(a.append(p).addClass("action-sheet-open"),n.addClass(p,"active").then(function(){u.removed||(e||h)()}),i(function(){u.removed||v.addClass("action-sheet-up")},20,!1))},u.$deregisterBackButton=r.registerBackButtonAction(function(){i(u.cancel)},s.actionSheet),u.cancel=function(){u.removeSheet(o.cancel)},u.buttonClicked=function(e){o.buttonClicked(e,o.buttons[e])===!0&&u.removeSheet()},u.destructiveButtonClicked=function(){o.destructiveButtonClicked()===!0&&u.removeSheet()},u.showSheet(),u.cancel.$scope=u,u.cancel}return{show:l}}]),f.prototype.addClass=function(e){var t,n,i,o,r,a;if(e&&"ng-scope"!=e&&"ng-isolate-scope"!=e)for(t=0;t<this.length;t++)if(o=this[t],o.setAttribute)if(e.indexOf(" ")<0&&o.classList.add)o.classList.add(e);else{for(a=(" "+(o.getAttribute("class")||"")+" ").replace(/[\n\t]/g," "),r=e.split(" "),n=0;n<r.length;n++)i=r[n].trim(),-1===a.indexOf(" "+i+" ")&&(a+=i+" ");o.setAttribute("class",a.trim())}return this},f.prototype.removeClass=function(e){var t,n,i,o,r;if(e)for(t=0;t<this.length;t++)if(r=this[t],r.getAttribute)if(e.indexOf(" ")<0&&r.classList.remove)r.classList.remove(e);else for(i=e.split(" "),n=0;n<i.length;n++)o=i[n],r.setAttribute("class",(" "+(r.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+o.trim()+" "," ").trim());return this},a.factory("$ionicBackdrop",["$document","$timeout","$$rAF","$rootScope",function(e,t,n,i){function o(){s++,1===s&&(c.addClass("visible"),i.$broadcast("backdrop.shown"),n(function(){s>=1&&c.addClass("active")}))}function r(){1===s&&(c.removeClass("active"),i.$broadcast("backdrop.hidden"),t(function(){0===s&&c.removeClass("visible")},400,!1)),s=Math.max(0,s-1)}function a(){return c}var c=f('<div class="backdrop">'),s=0;return e[0].body.appendChild(c[0]),{retain:o,release:r,getElement:a,_element:c}}]),a.factory("$ionicBind",["$parse","$interpolate",function(e,t){var n=/^\s*([@=&])(\??)\s*(\w*)\s*$/;return function(i,o,r){s(r||{},function(r,a){var c,s,l=r.match(n)||[],u=l[3]||a,d=l[1];switch(d){case"@":if(!o[u])return;o.$observe(u,function(e){i[a]=e}),o[u]&&(i[a]=t(o[u])(i));break;case"=":if(!o[u])return;s=i.$watch(o[u],function(e){i[a]=e}),i.$on("$destroy",s);break;case"&":if(o[u]&&o[u].match(RegExp(a+"(.*?)")))throw new Error('& expression binding "'+a+'" looks like it will recursively call "'+o[u]+'" and cause a stack overflow! Please choose a different scopeName.');c=e(o[u]),i[a]=function(e){return c(i,e)}}})}}]),a.factory("$ionicBody",["$document",function(e){return{addClass:function(){for(var t=0;t<arguments.length;t++)e[0].body.classList.add(arguments[t]);return this},removeClass:function(){for(var t=0;t<arguments.length;t++)e[0].body.classList.remove(arguments[t]);return this},enableClass:function(e){var t=Array.prototype.slice.call(arguments).slice(1);return e?this.addClass.apply(this,t):this.removeClass.apply(this,t),this},append:function(t){return e[0].body.appendChild(t.length?t[0]:t),this},get:function(){return e[0].body}}}]),a.factory("$ionicClickBlock",["$document","$ionicBody","$timeout",function(e,t,n){function i(e){e.preventDefault(),e.stopPropagation()}function o(){s&&(a?a.classList.remove(l):(a=e[0].createElement("div"),a.className="click-block",t.append(a),a.addEventListener("touchstart",i),a.addEventListener("mousedown",i)),s=!1)}function r(){a&&a.classList.add(l)}var a,c,s,l="click-block-hide";return{show:function(e){s=!0,n.cancel(c),c=n(this.hide,e||310,!1),o()},hide:function(){s=!1,n.cancel(c),r()}}}]),a.factory("$ionicGesture",[function(){return{on:function(e,t,n,i){return window.ionic.onGesture(e,t,n[0],i)},off:function(e,t,n){return window.ionic.offGesture(e,t,n)}}}]),a.factory("$ionicHistory",["$rootScope","$state","$location","$window","$timeout","$ionicViewSwitcher","$ionicNavViewDelegate",function(e,t,n,i,o,r,a){function s(e){return e?R.views[e]:null}function u(e){return e?s(e.backViewId):null}function d(e){return e?s(e.forwardViewId):null}function f(e){return e?R.histories[e]:null}function h(e){var t=p(e);return R.histories[t.historyId]||(R.histories[t.historyId]={historyId:t.historyId,parentHistoryId:p(t.scope.$parent).historyId,stack:[],cursor:-1}),f(t.historyId)}function p(t){for(var n=t;n;){if(n.hasOwnProperty("$historyId"))return{historyId:n.$historyId,scope:n};n=n.$parent}return{historyId:"root",scope:e}}function v(e){R.currentView=s(e),R.backView=u(R.currentView),R.forwardView=d(R.currentView)}function g(){var e;if(t&&t.current&&t.current.name){if(e=t.current.name,t.params)for(var n in t.params)t.params.hasOwnProperty(n)&&t.params[n]&&(e+="_"+n+"="+t.params[n]);return e}return ionic.Utils.nextUid()}function m(){var e;if(t&&t.params)for(var n in t.params)t.params.hasOwnProperty(n)&&(e=e||{},e[n]=t.params[n]);return e}function $(e){return e&&e.length&&/ion-side-menus|ion-tabs/i.test(e[0].tagName)}function w(e,t){if(t&&t.$$state&&t.$$state.self.canSwipeBack===!1)return!1;if(e&&"false"===e.attr("can-swipe-back"))return!1;var n=e.find("ion-view");return n&&"false"===n.attr("can-swipe-back")?!1:!0}var b,y,S,k,C,T="initialView",B="newView",I="moveBack",x="moveForward",A="back",E="forward",V="enter",P="exit",_="swap",D="none",L=0,R={histories:{root:{historyId:"root",parentHistoryId:null,stack:[],cursor:-1}},views:{},backView:null,forwardView:null,currentView:null},M=function(){};return M.prototype.initialize=function(e){if(e){for(var t in e)this[t]=e[t];return this}return null},M.prototype.go=function(){if(this.stateName)return t.go(this.stateName,this.stateParams);if(this.url&&this.url!==n.url()){if(R.backView===this)return i.history.go(-1);if(R.forwardView===this)return i.history.go(1);n.url(this.url)}return null},M.prototype.destroy=function(){this.scope&&(this.scope.$destroy&&this.scope.$destroy(),this.scope=null)},{register:function(e,t){var i,a,c,l=g(),d=h(e),$=R.currentView,M=R.backView,N=R.forwardView,O=null,z=null,H=D,q=d.historyId,U=n.url();if(b!==l&&(b=l,L++),C)O=C.viewId,z=C.action,H=C.direction,C=null;else if(M&&M.stateId===l)O=M.viewId,q=M.historyId,z=I,M.historyId===$.historyId?H=A:$&&(H=P,i=f(M.historyId),i&&i.parentHistoryId===$.historyId?H=V:(i=f($.historyId),i&&i.parentHistoryId===d.parentHistoryId&&(H=_)));else if(N&&N.stateId===l)O=N.viewId,q=N.historyId,z=x,N.historyId===$.historyId?H=E:$&&(H=P,$.historyId===d.parentHistoryId?H=V:(i=f($.historyId),i&&i.parentHistoryId===d.parentHistoryId&&(H=_))),i=p(e),N.historyId&&i.scope&&(i.scope.$historyId=N.historyId,q=N.historyId);else if($&&$.historyId!==q&&d.cursor>-1&&d.stack.length>0&&d.cursor<d.stack.length&&d.stack[d.cursor].stateId===l){var F=d.stack[d.cursor];O=F.viewId,q=F.historyId,z=I,H=_,i=f($.historyId),i&&i.parentHistoryId===q?H=P:(i=f(q),i&&i.parentHistoryId===$.historyId&&(H=V)),i=s(F.backViewId),i&&F.historyId!==i.historyId&&(d.stack[d.cursor].backViewId=$.viewId)}else{if(c=r.createViewEle(t),this.isAbstractEle(c,t))return{action:"abstractView",direction:D,ele:c};if(O=ionic.Utils.nextUid(),$){if($.forwardViewId=O,z=B,N&&$.stateId!==N.stateId&&$.historyId===N.historyId&&(i=f(N.historyId))){for(a=i.stack.length-1;a>=N.index;a--){var W=i.stack[a];W&&W.destroy&&W.destroy(),i.stack.splice(a)}q=N.historyId}d.historyId===$.historyId?H=E:$.historyId!==d.historyId&&(H=V,i=f($.historyId),i&&i.parentHistoryId===d.parentHistoryId?H=_:(i=f(i.parentHistoryId),i&&i.historyId===d.historyId&&(H=P)))}else z=T;2>L&&(H=D),R.views[O]=this.createView({viewId:O,index:d.stack.length,historyId:d.historyId,backViewId:$&&$.viewId&&($.historyId===d.historyId||$.historyId===d.parentHistoryId)?$.viewId:null,forwardViewId:null,stateId:l,stateName:this.currentStateName(),stateParams:m(),url:U,canSwipeBack:w(c,t)}),d.stack.push(R.views[O])}if(S&&S(),o.cancel(k),y){if(y.disableAnimate&&(H=D),y.disableBack&&(R.views[O].backViewId=null),y.historyRoot){for(a=0;a<d.stack.length;a++)d.stack[a].viewId===O?(d.stack[a].index=0,d.stack[a].backViewId=d.stack[a].forwardViewId=null):delete R.views[d.stack[a].viewId];d.stack=[R.views[O]]}y=null}if(v(O),R.backView&&q==R.backView.historyId&&l==R.backView.stateId&&U==R.backView.url)for(a=0;a<d.stack.length;a++)if(d.stack[a].viewId==O){z="dupNav",H=D,a>0&&(d.stack[a-1].forwardViewId=null),R.forwardView=null,R.currentView.index=R.backView.index,R.currentView.backViewId=R.backView.backViewId,R.backView=u(R.backView),d.stack.splice(a,1);break}return d.cursor=R.currentView.index,{viewId:O,action:z,direction:H,historyId:q,enableBack:this.enabledBack(R.currentView),isHistoryRoot:0===R.currentView.index,ele:c}},registerHistory:function(e){e.$historyId=ionic.Utils.nextUid()},createView:function(e){var t=new M;return t.initialize(e)},getViewById:s,viewHistory:function(){return R},currentView:function(e){return arguments.length&&(R.currentView=e),R.currentView},currentHistoryId:function(){return R.currentView?R.currentView.historyId:null},currentTitle:function(e){return R.currentView?(arguments.length&&(R.currentView.title=e),R.currentView.title):void 0},backView:function(e){return arguments.length&&(R.backView=e),R.backView},backTitle:function(e){var t=e&&s(e.backViewId)||R.backView;return t&&t.title},forwardView:function(e){return arguments.length&&(R.forwardView=e),R.forwardView},currentStateName:function(){return t&&t.current?t.current.name:null},isCurrentStateNavView:function(e){return!!(t&&t.current&&t.current.views&&t.current.views[e])},goToHistoryRoot:function(e){if(e){var t=f(e);if(t&&t.stack.length){if(R.currentView&&R.currentView.viewId===t.stack[0].viewId)return;C={viewId:t.stack[0].viewId,action:I,direction:A},t.stack[0].go()}}},goBack:function(e){if(l(e)&&-1!==e){if(e>-1)return;var t=R.histories[this.currentHistoryId()],n=t.cursor+e+1;1>n&&(n=1),t.cursor=n,v(t.stack[n].viewId);for(var i=n-1,r=[],a=s(t.stack[i].forwardViewId);a&&(r.push(a.stateId||a.viewId),i++,!(i>=t.stack.length));)a=s(t.stack[i].forwardViewId);var c=this;r.length&&o(function(){c.clearCache(r)},300)}R.backView&&R.backView.go()},removeBackView:function(){var e=this,t=R.histories[this.currentHistoryId()],n=t.cursor,i=t.stack[n],o=t.stack[n-1],r=t.stack[n-2];o&&r&&(t.stack.splice(n-1,1),e.clearCache([o.viewId]),i.backViewId=r.viewId,i.index=i.index-1,r.forwardViewId=i.viewId,R.backView=r,t.currentCursor+=-1)},enabledBack:function(e){var t=u(e);return!(!t||t.historyId!==e.historyId)},clearHistory:function(){var e=R.histories,t=R.currentView;if(e)for(var n in e)e[n].stack&&(e[n].stack=[],e[n].cursor=-1),t&&t.historyId===n?(t.backViewId=t.forwardViewId=null,e[n].stack.push(t)):e[n].destroy&&e[n].destroy();for(var i in R.views)i!==t.viewId&&delete R.views[i];t&&v(t.viewId)},clearCache:function(e){return o(function(){a._instances.forEach(function(t){t.clearCache(e)})})},nextViewOptions:function(t){return S&&S(),arguments.length&&(o.cancel(k),null===t?y=t:(y=y||{},c(y,t),y.expire&&(S=e.$on("$stateChangeSuccess",function(){k=o(function(){y=null},y.expire)})))),y},isAbstractEle:function(e,t){return t&&t.$$state&&t.$$state.self["abstract"]?!0:!(!e||!$(e)&&!$(e.children()))},isActiveScope:function(e){if(!e)return!1;for(var t,n=e,i=this.currentHistoryId();n;){if(n.$$disconnected)return!1;if(!t&&n.hasOwnProperty("$historyId")&&(t=!0),i){if(n.hasOwnProperty("$historyId")&&i==n.$historyId)return!0;if(n.hasOwnProperty("$activeHistoryId")&&i==n.$activeHistoryId){if(n.hasOwnProperty("$historyId"))return!0;if(!t)return!0}}t&&n.hasOwnProperty("$activeHistoryId")&&(t=!1),n=n.$parent}return i?"root"==i:!0}}}]).run(["$rootScope","$state","$location","$document","$ionicPlatform","$ionicHistory","IONIC_BACK_PRIORITY",function(e,t,n,i,o,r,a){function c(e){var t=r.backView();return t?t.go():ionic.Platform.exitApp(),e.preventDefault(),!1}e.$on("$ionicView.beforeEnter",function(){ionic.keyboard&&ionic.keyboard.hide&&ionic.keyboard.hide()}),e.$on("$ionicHistory.change",function(e,i){if(!i)return null;var o=r.viewHistory(),a=i.historyId?o.histories[i.historyId]:null;if(a&&a.cursor>-1&&a.cursor<a.stack.length){var c=a.stack[a.cursor];return c.go(i)}!i.url&&i.uiSref&&(i.url=t.href(i.uiSref)),i.url&&(0===i.url.indexOf("#")&&(i.url=i.url.replace("#","")),i.url!==n.url()&&n.url(i.url))}),e.$ionicGoBack=function(e){r.goBack(e)},e.$on("$ionicView.afterEnter",function(e,t){t&&t.title&&(i[0].title=t.title)}),o.registerBackButtonAction(c,a.view)}]),a.provider("$ionicConfig",function(){function e(e,i){a.platform[e]=i,o.platform[e]={},t(a,a.platform[e]),n(a.platform[e],o.platform[e],"")}function t(e,n){for(var i in e)i!=r&&e.hasOwnProperty(i)&&(angular.isObject(e[i])?(l(n[i])||(n[i]={}),t(e[i],n[i])):l(n[i])||(n[i]=null))}function n(e,t,o){s(e,function(c,s){angular.isObject(e[s])?(t[s]={},n(e[s],t[s],o+"."+s)):t[s]=function(n){if(arguments.length)return e[s]=n,t;if(e[s]==r){var c=i(a.platform,ionic.Platform.platform()+o+"."+s);return c||c===!1?c:i(a.platform,"default"+o+"."+s)}return e[s]}})}function i(e,t){t=t.split(".");for(var n=0;n<t.length;n++){if(!e||!l(e[t[n]]))return null;e=e[t[n]]}return e}var o=this;o.platform={};var r="platform",a={views:{maxCache:r,forwardCache:r,transition:r,swipeBackEnabled:r,swipeBackHitWidth:r},navBar:{alignTitle:r,positionPrimaryButtons:r,positionSecondaryButtons:r,transition:r},backButton:{icon:r,text:r,previousTitleText:r},form:{checkbox:r,toggle:r},scrolling:{jsScrolling:r},spinner:{icon:r},tabs:{style:r,position:r},templates:{maxPrefetch:r},platform:{}};n(a,o,""),e("default",{views:{maxCache:10,forwardCache:!1,transition:"ios",swipeBackEnabled:!0,swipeBackHitWidth:45},navBar:{alignTitle:"center",positionPrimaryButtons:"left",positionSecondaryButtons:"right",transition:"view"},backButton:{icon:"ion-ios-arrow-back",text:"Back",previousTitleText:!0},form:{checkbox:"circle",toggle:"large"},scrolling:{jsScrolling:!0},spinner:{icon:"ios"},tabs:{style:"standard",position:"bottom"},templates:{maxPrefetch:30}}),e("ios",{}),e("android",{views:{transition:"android",swipeBackEnabled:!1},navBar:{alignTitle:"left",positionPrimaryButtons:"right",positionSecondaryButtons:"right"},backButton:{icon:"ion-android-arrow-back",text:!1,previousTitleText:!1},form:{checkbox:"square",toggle:"small"},spinner:{icon:"android"},tabs:{style:"striped",position:"top"},scrolling:{jsScrolling:!1}}),e("windowsphone",{spinner:{icon:"android"}}),o.transitions={views:{},navBar:{}},o.transitions.views.ios=function(e,t,n,i){function o(e,t,n,i){var o={};o[ionic.CSS.TRANSITION_DURATION]=r.shouldAnimate?"":0,o.opacity=t,i>-1&&(o.boxShadow="0 0 10px rgba(0,0,0,"+(r.shouldAnimate?.45*i:.3)+")"),o[ionic.CSS.TRANSFORM]="translate3d("+n+"%,0,0)",ionic.DomUtil.cachedStyles(e,o)}var r={run:function(i){"forward"==n?(o(e,1,99*(1-i),1-i),o(t,1-.1*i,-33*i,-1)):"back"==n?(o(e,1-.1*(1-i),-33*(1-i),-1),o(t,1,100*i,1-i)):(o(e,1,0,-1),o(t,0,0,-1))},shouldAnimate:i&&("forward"==n||"back"==n)};return r},o.transitions.navBar.ios=function(e,t,n,i){function o(e,t,n,i){var o={};o[ionic.CSS.TRANSITION_DURATION]=c.shouldAnimate?"":"0ms",o.opacity=1===t?"":t,e.setCss("buttons-left",o),e.setCss("buttons-right",o),e.setCss("back-button",o),o[ionic.CSS.TRANSFORM]="translate3d("+i+"px,0,0)",e.setCss("back-text",o),o[ionic.CSS.TRANSFORM]="translate3d("+n+"px,0,0)",e.setCss("title",o)}function r(e,t,n){if(e&&t){var i=(e.titleTextX()+e.titleWidth())*(1-n),r=t&&(t.titleTextX()-e.backButtonTextLeft())*(1-n)||0;o(e,n,i,r)}}function a(e,t,n){if(e&&t){var i=(-(e.titleTextX()-t.backButtonTextLeft())-e.titleLeftRight())*n;o(e,1-n,i,0)}}var c={run:function(n){var i=e.controller(),o=t&&t.controller();"back"==c.direction?(a(i,o,1-n),r(o,i,1-n)):(r(i,o,n),a(o,i,n))},direction:n,shouldAnimate:i&&("forward"==n||"back"==n)};return c},o.transitions.views.android=function(e,t,n,i){function o(e,t,n){var i={};i[ionic.CSS.TRANSITION_DURATION]=r.shouldAnimate?"":0,i[ionic.CSS.TRANSFORM]="translate3d("+t+"%,0,0)",i.opacity=n,ionic.DomUtil.cachedStyles(e,i)}i=i&&("forward"==n||"back"==n);var r={run:function(i){"forward"==n?(o(e,99*(1-i),1),o(t,-100*i,1)):"back"==n?(o(e,-100*(1-i),1),o(t,100*i,1)):(o(e,0,1),o(t,0,0))},shouldAnimate:i};return r},o.transitions.navBar.android=function(e,t,n,i){function o(e,t){if(e){var n={};n.opacity=1===t?"":t,e.setCss("buttons-left",n),e.setCss("buttons-right",n),e.setCss("back-button",n),e.setCss("back-text",n),e.setCss("title",n)}}return{run:function(n){o(e.controller(),n),o(t&&t.controller(),1-n)},shouldAnimate:i&&("forward"==n||"back"==n)}},o.transitions.views.none=function(e,t){return{run:function(n){
o.transitions.views.android(e,t,!1,!1).run(n)},shouldAnimate:!1}},o.transitions.navBar.none=function(e,t){return{run:function(n){o.transitions.navBar.ios(e,t,!1,!1).run(n),o.transitions.navBar.android(e,t,!1,!1).run(n)},shouldAnimate:!1}},o.setPlatformConfig=e,o.$get=function(){return o}}).config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|sms|tel|geo|ftp|mailto|file|ghttps?|ms-appx-web|ms-appx|x-wmapp0):/),e.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|file|content|blob|ms-appx|ms-appx-web|x-wmapp0):|data:image\//)}]);var p='<div class="loading-container"><div class="loading"></div></div>',v="$ionicLoading instance.hide() has been deprecated. Use $ionicLoading.hide().",g="$ionicLoading instance.show() has been deprecated. Use $ionicLoading.show().",m="$ionicLoading instance.setContent() has been deprecated. Use $ionicLoading.show({ template: 'my content' }).";a.constant("$ionicLoadingConfig",{template:"<ion-spinner></ion-spinner>"}).factory("$ionicLoading",["$ionicLoadingConfig","$ionicBody","$ionicTemplateLoader","$ionicBackdrop","$timeout","$q","$log","$compile","$ionicPlatform","$rootScope","IONIC_BACK_PRIORITY",function(e,t,n,i,o,r,a,s,l,u,d){function f(){return b||(b=n.compile({template:p,appendTo:t.get()}).then(function(e){return e.show=function(a){var c=a.templateUrl?n.load(a.templateUrl):r.when(a.template||a.content||"");e.scope=a.scope||e.scope,e.isShown||(e.hasBackdrop=!a.noBackdrop&&a.showBackdrop!==!1,e.hasBackdrop&&(i.retain(),i.getElement().addClass("backdrop-loading"))),a.duration&&(o.cancel(e.durationTimeout),e.durationTimeout=o(angular.bind(e,e.hide),+a.duration)),y(),y=l.registerBackButtonAction(h,d.loading),c.then(function(n){if(n){var i=e.element.children();i.html(n),s(i.contents())(e.scope)}e.isShown&&(e.element.addClass("visible"),ionic.requestAnimationFrame(function(){e.isShown&&(e.element.addClass("active"),t.addClass("loading-active"))}))}),e.isShown=!0},e.hide=function(){y(),e.isShown&&(e.hasBackdrop&&(i.release(),i.getElement().removeClass("backdrop-loading")),e.element.removeClass("active"),t.removeClass("loading-active"),e.element.removeClass("visible"),ionic.requestAnimationFrame(function(){!e.isShown&&e.element.removeClass("visible")})),o.cancel(e.durationTimeout),e.isShown=!1;var n=e.element.children();n.html("")},e})),b}function $(t){t=c({},e||{},t||{});var n=t.delay||t.showDelay||0;return S(),k(),t.hideOnStateChange&&(S=u.$on("$stateChangeSuccess",w),k=u.$on("$stateChangeError",w)),o.cancel(C),C=o(h,n),C.then(f).then(function(e){return e.show(t)}),{hide:function(){return a.error(v),w.apply(this,arguments)},show:function(){return a.error(g),$.apply(this,arguments)},setContent:function(e){return a.error(m),f().then(function(t){t.show({template:e})})}}}function w(){S(),k(),o.cancel(C),f().then(function(e){e.hide()})}var b,y=h,S=h,k=h,C=r.when();return{show:$,hide:w,_getLoader:f}}]),a.factory("$ionicModal",["$rootScope","$ionicBody","$compile","$timeout","$ionicPlatform","$ionicTemplateLoader","$$q","$log","$ionicClickBlock","$window","IONIC_BACK_PRIORITY",function(e,t,n,i,o,r,a,s,l,u,d){var p=ionic.views.Modal.inherit({initialize:function(e){ionic.views.Modal.prototype.initialize.call(this,e),this.animation=e.animation||"slide-in-up"},show:function(e){var n=this;if(n.scope.$$destroyed)return s.error("Cannot call "+n.viewType+".show() after remove(). Please create a new "+n.viewType+" instance."),a.when();l.show(600),m.add(n);var r=f(n.modalEl);n.el.classList.remove("hide"),i(function(){n._isShown&&t.addClass(n.viewType+"-open")},400,!1),n.el.parentElement||(r.addClass(n.animation),t.append(n.el));var c=r.data("$$ionicScrollController");return c&&c.resize(),e&&n.positionView&&(n.positionView(e,r),n._onWindowResize=function(){n._isShown&&n.positionView(e,r)},ionic.on("resize",n._onWindowResize,window)),r.addClass("ng-enter active").removeClass("ng-leave ng-leave-active"),n._isShown=!0,n._deregisterBackButton=o.registerBackButtonAction(n.hardwareBackButtonClose?angular.bind(n,n.hide):h,d.modal),ionic.views.Modal.prototype.show.call(n),i(function(){n._isShown&&(r.addClass("ng-enter-active"),ionic.trigger("resize"),n.scope.$parent&&n.scope.$parent.$broadcast(n.viewType+".shown",n),n.el.classList.add("active"),n.scope.$broadcast("$ionicHeader.align"),n.scope.$broadcast("$ionicFooter.align"),n.scope.$broadcast("$ionic.modalPresented"))},20),i(function(){n._isShown&&(n.$el.on("touchmove",function(e){var t=ionic.DomUtil.getParentOrSelfWithClass(e.target,"scroll");t||e.preventDefault()}),n.$el.on("click",function(e){n.backdropClickToClose&&e.target===n.el&&m.isHighest(n)&&n.hide()}))},400)},hide:function(){var e=this,n=f(e.modalEl);return l.show(600),m.remove(e),e.el.classList.remove("active"),n.addClass("ng-leave"),i(function(){e._isShown||(n.addClass("ng-leave-active").removeClass("ng-enter ng-enter-active active"),e.scope.$broadcast("$ionic.modalRemoved"))},20,!1),e.$el.off("click"),e._isShown=!1,e.scope.$parent&&e.scope.$parent.$broadcast(e.viewType+".hidden",e),e._deregisterBackButton&&e._deregisterBackButton(),ionic.views.Modal.prototype.hide.call(e),e.positionView&&ionic.off("resize",e._onWindowResize,window),i(function(){t.removeClass(e.viewType+"-open"),e.el.classList.add("hide")},e.hideDelay||320)},remove:function(){var e,t,n=this;return n.scope.$parent&&n.scope.$parent.$broadcast(n.viewType+".removed",n),n._isShown?t=n.hide():(e=a.defer(),e.resolve(),t=e.promise),t.then(function(){n.scope.$destroy(),n.$el.remove()})},isShown:function(){return!!this._isShown}}),v=function(t,i){var o=i.scope&&i.scope.$new()||e.$new(!0);i.viewType=i.viewType||"modal",c(o,{$hasHeader:!1,$hasSubheader:!1,$hasFooter:!1,$hasSubfooter:!1,$hasTabs:!1,$hasTabsTop:!1});var r=n("<ion-"+i.viewType+">"+t+"</ion-"+i.viewType+">")(o);i.$el=r,i.el=r[0],i.modalEl=i.el.querySelector("."+i.viewType);var a=new p(i);return a.scope=o,i.scope||(o[i.viewType]=a),a},g=[],m={add:function(e){g.push(e)},remove:function(e){var t=g.indexOf(e);t>-1&&t<g.length&&g.splice(t,1)},isHighest:function(e){var t=g.indexOf(e);return t>-1&&t===g.length-1}};return{fromTemplate:function(e,t){var n=v(e,t||{});return n},fromTemplateUrl:function(e,t,n){var i;return angular.isFunction(t)&&(i=t,t=n),r.load(e).then(function(e){var n=v(e,t||{});return i&&i(n),n})},stack:m}}]),a.service("$ionicNavBarDelegate",ionic.DelegateService(["align","showBackButton","showBar","title","changeTitle","setTitle","getTitle","back","getPreviousTitle"])),a.service("$ionicNavViewDelegate",ionic.DelegateService(["clearCache"])),a.constant("IONIC_BACK_PRIORITY",{view:100,sideMenu:150,modal:200,actionSheet:300,popup:400,loading:500}).provider("$ionicPlatform",function(){return{$get:["$q","$ionicScrollDelegate",function(e,t){var n={onHardwareBackButton:function(e){ionic.Platform.ready(function(){document.addEventListener("backbutton",e,!1)})},offHardwareBackButton:function(e){ionic.Platform.ready(function(){document.removeEventListener("backbutton",e)})},$backButtonActions:{},registerBackButtonAction:function(e,t,i){n._hasBackButtonHandler||(n.$backButtonActions={},n.onHardwareBackButton(n.hardwareBackButtonClick),n._hasBackButtonHandler=!0);var o={id:i?i:ionic.Utils.nextUid(),priority:t?t:0,fn:e};return n.$backButtonActions[o.id]=o,function(){delete n.$backButtonActions[o.id]}},hardwareBackButtonClick:function(e){var t,i;for(i in n.$backButtonActions)(!t||n.$backButtonActions[i].priority>=t.priority)&&(t=n.$backButtonActions[i]);return t?(t.fn(e),t):void 0},is:function(e){return ionic.Platform.is(e)},on:function(e,t){return ionic.Platform.ready(function(){document.addEventListener(e,t,!1)}),function(){ionic.Platform.ready(function(){document.removeEventListener(e,t)})}},ready:function(t){var n=e.defer();return ionic.Platform.ready(function(){n.resolve(),t&&t()}),n.promise}};return window.addEventListener("statusTap",function(){t.scrollTop(!0)}),n}]}}),a.factory("$ionicPopover",["$ionicModal","$ionicPosition","$document","$window",function(e,t,n,i){function o(e,n){var o=f(e.target||e),a=t.offset(o),c=n.prop("offsetWidth"),s=n.prop("offsetHeight"),l=i.innerWidth,u=i.innerHeight,d={left:a.left+a.width/2-c/2},h=f(n[0].querySelector(".popover-arrow"));d.left<r?d.left=r:d.left+c+r>l&&(d.left=l-c-r),a.top+a.height+s>u&&a.top-s>0?(d.top=a.top-s,n.addClass("popover-bottom")):(d.top=a.top+a.height,n.removeClass("popover-bottom")),h.css({left:a.left+a.width/2-h.prop("offsetWidth")/2-d.left+"px"}),n.css({top:d.top+"px",left:d.left+"px",marginLeft:"0",opacity:"1"})}var r=6,a={viewType:"popover",hideDelay:1,animation:"none",positionView:o};return{fromTemplate:function(t,n){return e.fromTemplate(t,ionic.Utils.extend({},a,n))},fromTemplateUrl:function(t,n){return e.fromTemplateUrl(t,ionic.Utils.extend({},a,n))}}}]);var $='<div class="popup-container" ng-class="cssClass"><div class="popup"><div class="popup-head"><h3 class="popup-title" ng-bind-html="title"></h3><h5 class="popup-sub-title" ng-bind-html="subTitle" ng-if="subTitle"></h5></div><div class="popup-body"></div><div class="popup-buttons" ng-show="buttons.length"><button ng-repeat="button in buttons" ng-click="$buttonTapped(button, $event)" class="button" ng-class="button.type || \'button-default\'" ng-bind-html="button.text"></button></div></div></div>';a.factory("$ionicPopup",["$ionicTemplateLoader","$ionicBackdrop","$q","$timeout","$rootScope","$ionicBody","$compile","$ionicPlatform","$ionicModal","IONIC_BACK_PRIORITY",function(e,t,n,i,o,r,a,s,l,u){function d(t){t=c({scope:null,title:"",buttons:[]},t||{});var s={};return s.scope=(t.scope||o).$new(),s.element=f($),s.responseDeferred=n.defer(),r.get().appendChild(s.element[0]),a(s.element)(s.scope),c(s.scope,{title:t.title,buttons:t.buttons,subTitle:t.subTitle,cssClass:t.cssClass,$buttonTapped:function(e,t){var n=(e.onTap||h).apply(s,[t]);t=t.originalEvent||t,t.defaultPrevented||s.responseDeferred.resolve(n)}}),n.when(t.templateUrl?e.load(t.templateUrl):t.template||t.content||"").then(function(e){var t=f(s.element[0].querySelector(".popup-body"));e?(t.html(e),a(t.contents())(s.scope)):t.remove()}),s.show=function(){s.isShown||s.removed||(l.stack.add(s),s.isShown=!0,ionic.requestAnimationFrame(function(){s.isShown&&(s.element.removeClass("popup-hidden"),s.element.addClass("popup-showing active"),g(s.element))}))},s.hide=function(e){return e=e||h,s.isShown?(l.stack.remove(s),s.isShown=!1,s.element.removeClass("active"),s.element.addClass("popup-hidden"),void i(e,250,!1)):e()},s.remove=function(){s.removed||(s.hide(function(){s.element.remove(),s.scope.$destroy()}),s.removed=!0)},s}function p(){var e=S[S.length-1];e&&e.responseDeferred.resolve()}function v(e){function n(){S.push(o),i(o.show,a,!1),o.responseDeferred.promise.then(function(e){var n=S.indexOf(o);return-1!==n&&S.splice(n,1),o.remove(),S.length>0?S[S.length-1].show():(t.release(),i(function(){S.length||r.removeClass("popup-open")},400,!1),(k._backButtonActionDone||h)()),e})}var o=k._createPopup(e),a=0;return S.length>0?(a=y.stackPushDelay,i(S[S.length-1].hide,a,!1)):(r.addClass("popup-open"),t.retain(),k._backButtonActionDone=s.registerBackButtonAction(p,u.popup)),o.responseDeferred.promise.close=function(e){o.removed||o.responseDeferred.resolve(e)},o.responseDeferred.notify({close:o.responseDeferred.close}),n(),o.responseDeferred.promise}function g(e){var t=e[0].querySelector("[autofocus]");t&&t.focus()}function m(e){return v(c({buttons:[{text:e.okText||"OK",type:e.okType||"button-positive",onTap:function(){return!0}}]},e||{}))}function w(e){return v(c({buttons:[{text:e.cancelText||"Cancel",type:e.cancelType||"button-default",onTap:function(){return!1}},{text:e.okText||"OK",type:e.okType||"button-positive",onTap:function(){return!0}}]},e||{}))}function b(e){var t=o.$new(!0);t.data={},t.data.fieldtype=e.inputType?e.inputType:"text",t.data.response=e.defaultText?e.defaultText:"",t.data.placeholder=e.inputPlaceholder?e.inputPlaceholder:"",t.data.maxlength=e.maxLength?parseInt(e.maxLength):"";var n="";return e.template&&/<[a-z][\s\S]*>/i.test(e.template)===!1&&(n="<span>"+e.template+"</span>",delete e.template),v(c({template:n+'<input ng-model="data.response" type="{{ data.fieldtype }}"maxlength="{{ data.maxlength }}"placeholder="{{ data.placeholder }}">',scope:t,buttons:[{text:e.cancelText||"Cancel",type:e.cancelType||"button-default",onTap:function(){}},{text:e.okText||"OK",type:e.okType||"button-positive",onTap:function(){return t.data.response||""}}]},e||{}))}var y={stackPushDelay:75},S=[],k={show:v,alert:m,confirm:w,prompt:b,_createPopup:d,_popupStack:S};return k}]),a.factory("$ionicPosition",["$document","$window",function(e,t){function n(e,n){return e.currentStyle?e.currentStyle[n]:t.getComputedStyle?t.getComputedStyle(e)[n]:e.style[n]}function i(e){return"static"===(n(e,"position")||"static")}var o=function(t){for(var n=e[0],o=t.offsetParent||n;o&&o!==n&&i(o);)o=o.offsetParent;return o||n};return{position:function(t){var n=this.offset(t),i={top:0,left:0},r=o(t[0]);r!=e[0]&&(i=this.offset(f(r)),i.top+=r.clientTop-r.scrollTop,i.left+=r.clientLeft-r.scrollLeft);var a=t[0].getBoundingClientRect();return{width:a.width||t.prop("offsetWidth"),height:a.height||t.prop("offsetHeight"),top:n.top-i.top,left:n.left-i.left}},offset:function(n){var i=n[0].getBoundingClientRect();return{width:i.width||n.prop("offsetWidth"),height:i.height||n.prop("offsetHeight"),top:i.top+(t.pageYOffset||e[0].documentElement.scrollTop),left:i.left+(t.pageXOffset||e[0].documentElement.scrollLeft)}}}}]),a.service("$ionicScrollDelegate",ionic.DelegateService(["resize","scrollTop","scrollBottom","scrollTo","scrollBy","zoomTo","zoomBy","getScrollPosition","anchorScroll","freezeScroll","freezeAllScrolls","getScrollView"])),a.service("$ionicSideMenuDelegate",ionic.DelegateService(["toggleLeft","toggleRight","getOpenRatio","isOpen","isOpenLeft","isOpenRight","canDragContent","edgeDragThreshold"])),a.service("$ionicSlideBoxDelegate",ionic.DelegateService(["update","slide","select","enableSlide","previous","next","stop","autoPlay","start","currentIndex","selected","slidesCount","count","loop"])),a.service("$ionicTabsDelegate",ionic.DelegateService(["select","selectedIndex","showBar"])),function(){var e=[];a.factory("$ionicTemplateCache",["$http","$templateCache","$timeout",function(t,n,i){function o(e){return"undefined"==typeof e?r():(d(e)&&(e=[e]),s(e,function(e){c.push(e)}),void(a&&r()))}function r(){var e;if(o._runCount++,a=!0,0!==c.length){for(var s=0;4>s&&(e=c.pop());)d(e)&&t.get(e,{cache:n}),s++;c.length&&i(r,1e3)}}var a,c=e;return o._runCount=0,o}]).config(["$stateProvider","$ionicConfigProvider",function(t,n){var i=t.state;t.state=function(o,r){if("object"==typeof r){var a=r.prefetchTemplate!==!1&&e.length<n.templates.maxPrefetch();if(a&&d(r.templateUrl)&&e.push(r.templateUrl),angular.isObject(r.views))for(var c in r.views)a=r.views[c].prefetchTemplate!==!1&&e.length<n.templates.maxPrefetch(),a&&d(r.views[c].templateUrl)&&e.push(r.views[c].templateUrl)}return i.call(t,o,r)}}]).run(["$ionicTemplateCache",function(e){e()}])}(),a.factory("$ionicTemplateLoader",["$compile","$controller","$http","$q","$rootScope","$templateCache",function(e,t,n,i,o,r){function a(e){return n.get(e,{cache:r}).then(function(e){return e.data&&e.data.trim()})}function s(n){n=c({template:"",templateUrl:"",scope:null,controller:null,locals:{},appendTo:null},n||{});var r=n.templateUrl?this.load(n.templateUrl):i.when(n.template);return r.then(function(i){var r,a=n.scope||o.$new(),s=f("<div>").html(i).contents();return n.controller&&(r=t(n.controller,c(n.locals,{$scope:a})),s.children().data("$ngControllerController",r)),n.appendTo&&f(n.appendTo).append(s),e(s)(a),{element:s,scope:a}})}return{load:a,compile:s}}]),a.factory("$ionicViewService",["$ionicHistory","$log",function(e,t){function n(e,n){t.warn("$ionicViewService"+e+" is deprecated, please use $ionicHistory"+n+" instead: http://ionicframework.com/docs/nightly/api/service/$ionicHistory/")}n("","");var i={getCurrentView:"currentView",getBackView:"backView",getForwardView:"forwardView",getCurrentStateName:"currentStateName",nextViewOptions:"nextViewOptions",clearHistory:"clearHistory"};return s(i,function(t,o){i[o]=function(){return n("."+o,"."+t),e[t].apply(this,arguments)}}),i}]),a.factory("$ionicViewSwitcher",["$timeout","$document","$q","$ionicClickBlock","$ionicConfig","$ionicNavBarDelegate",function(e,t,n,i,o,r){function a(e,t){return u(e)["abstract"]?u(e).name:t?t.stateId||t.viewId:ionic.Utils.nextUid()}function u(e){return e&&e.$$state&&e.$$state.self||{}}function d(e,t,n,i){var r=u(e),a=g||V(t,"view-transition")||r.viewTransition||o.views.transition()||"ios",s=o.navBar.transition();return n=m||V(t,"view-direction")||r.viewDirection||n||"none",c(h(i),{transition:a,navBarTransition:"view"===s?a:s,direction:n,shouldAnimate:"none"!==a&&"none"!==n})}function h(e){return e=e||{},{viewId:e.viewId,historyId:e.historyId,stateId:e.stateId,stateName:e.stateName,stateParams:e.stateParams}}function p(e,t){return arguments.length>1?void V(e,T,t):V(e,T)}function v(e){if(e&&e.length){var t=e.scope();t&&(t.$emit("$ionicView.unloaded",e.data(C)),t.$destroy()),e.remove()}}var g,m,$="webkitTransitionEnd transitionend",w="$noCache",b="$destroyEle",y="$eleId",S="$accessed",k="$fallbackTimer",C="$viewData",T="nav-view",B="active",I="cached",x="stage",A=0;ionic.transition=ionic.transition||{},ionic.transition.isActive=!1;var E,V=ionic.DomUtil.cachedAttr,P=[],_=1100,D={create:function(t,s,f,T,E,L){var R,M,N,O=++A,z={init:function(e,t){D.isTransitioning(!0),z.loadViewElements(e),z.render(e,function(){t&&t()})},loadViewElements:function(e){var n,i,o,r=t.getViewElements(),c=a(s,f),u=t.activeEleId();for(n=0,i=r.length;i>n&&(o=r.eq(n),o.data(y)===c?o.data(w)?(o.data(y,c+ionic.Utils.nextUid()),o.data(b,!0)):R=o:l(u)&&o.data(y)===u&&(M=o),!R||!M);n++);N=!!R,N||(R=e.ele||D.createViewEle(s),R.data(y,c)),L&&t.activeEleId(c),e.ele=null},render:function(e,n){if(N)ionic.Utils.reconnectScope(R.scope());else{p(R,x);var i=d(s,R,e.direction,f),r=o.transitions.views[i.transition]||o.transitions.views.none;r(R,null,i.direction,!0).run(0),R.data(C,{viewId:i.viewId,historyId:i.historyId,stateName:i.stateName,stateParams:i.stateParams}),(u(s).cache===!1||"false"===u(s).cache||"false"==R.attr("cache-view")||0===o.views.maxCache())&&R.data(w,!0);var a=t.appendViewElement(R,s);delete i.direction,delete i.transition,a.$emit("$ionicView.loaded",i)}R.data(S,Date.now()),n&&n()},transition:function(a,l,u){function v(){p(R,F.shouldAnimate?"entering":B),p(M,F.shouldAnimate?"leaving":I),F.run(1),r._instances.forEach(function(e){e.triggerTransitionStart(O)}),F.shouldAnimate||b()}function w(e){e.target===this&&b()}function b(){b.x||(b.x=!0,R.off($,w),e.cancel(R.data(k)),M&&e.cancel(M.data(k)),C&&C.resolve(t),O===A&&(n.all(P).then(D.transitionEnd),z.emit("after",H,q),z.cleanup(H)),r._instances.forEach(function(e){e.triggerTransitionEnd()}),g=m=f=T=R=M=null)}function y(e){e.target===this&&S()}function S(){p(R,I),p(M,B),R.off($,y),e.cancel(R.data(k)),D.transitionEnd([t])}var C,H=d(s,R,a,f),q=c(c({},H),h(T));H.transitionId=q.transitionId=O,H.fromCache=!!N,H.enableBack=!!l,H.renderStart=E,H.renderEnd=L,V(R.parent(),"nav-view-transition",H.transition),V(R.parent(),"nav-view-direction",H.direction),e.cancel(R.data(k));var U=o.transitions.views[H.transition]||o.transitions.views.none,F=U(R,M,H.direction,H.shouldAnimate&&u&&L);if(F.shouldAnimate&&(R.on($,w),R.data(k,e(b,_)),i.show(_)),E&&(z.emit("before",H,q),p(R,x),F.run(0)),L&&(C=n.defer(),P.push(C.promise)),E&&L)e(function(){ionic.requestAnimationFrame(v)});else{if(!L)return p(R,"entering"),p(M,"leaving"),{run:F.run,cancel:function(t){t?(R.on($,y),R.data(k,e(S,_)),i.show(_)):S(),F.shouldAnimate=t,F.run(0),F=null}};L&&v()}},emit:function(e,t,n){var i=R.scope(),o=M&&M.scope();"after"==e&&(i&&i.$emit("$ionicView.enter",t),o?o.$emit("$ionicView.leave",n):i&&n&&n.viewId&&i.$emit("$ionicNavView.leave",n)),i&&i.$emit("$ionicView."+e+"Enter",t),o?o.$emit("$ionicView."+e+"Leave",n):i&&n&&n.viewId&&i.$emit("$ionicNavView."+e+"Leave",n)},cleanup:function(e){M&&"back"==e.direction&&!o.views.forwardCache()&&v(M);var n,i,r,a=t.getViewElements(),c=a.length,s=c-1>o.views.maxCache(),l=Date.now();for(n=0;c>n;n++)i=a.eq(n),s&&i.data(S)<l?(l=i.data(S),r=a.eq(n)):i.data(b)&&p(i)!=B&&v(i);v(r),R.data(w)&&R.data(b,!0)},enteringEle:function(){return R},leavingEle:function(){return M}};return z},transitionEnd:function(e){s(e,function(e){e.transitionEnd()}),D.isTransitioning(!1),i.hide(),P=[]},nextTransition:function(e){g=e},nextDirection:function(e){m=e},isTransitioning:function(t){return arguments.length&&(ionic.transition.isActive=!!t,e.cancel(E),t&&(E=e(function(){D.isTransitioning(!1)},999))),ionic.transition.isActive},createViewEle:function(e){var n=t[0].createElement("div");return e&&e.$template&&(n.innerHTML=e.$template,1===n.children.length)?(n.children[0].classList.add("pane"),f(n.children[0])):(n.className="pane",f(n))},viewEleIsActive:function(e,t){p(e,t?B:I)},getTransitionData:d,navViewAttr:p,destroyViewEle:v};return D}]),angular.module("ngIOS9UIWebViewPatch",["ng"]).config(["$provide",function(e){"use strict";e.decorator("$browser",["$delegate","$window",function(e,t){function n(e){return/(iPhone|iPad|iPod).* OS 9_\d/.test(e)&&!/Version\/9\./.test(e)}function i(e){function t(){n=null}var n=null,i=e.url;return e.url=function(){return arguments.length?(n=arguments[0],i.apply(e,arguments)):n||i.apply(e,arguments)},window.addEventListener("popstate",t,!1),window.addEventListener("hashchange",t,!1),e}return n(t.navigator.userAgent)?i(e):e}])}]),a.config(["$provide",function(e){e.decorator("$compile",["$delegate",function(e){return e.$$addScopeInfo=function(e,t,n,i){var o=n?i?"$isolateScopeNoTemplate":"$isolateScope":"$scope";e.data(o,t)},e}])}]),a.config(["$provide",function(e){function t(e,t){return e.__hash=e.hash,e.hash=function(n){return l(n)&&n.length>0&&t(function(){var e=document.querySelector(".scroll-content");e&&(e.scrollTop=0)},0,!1),e.__hash(n)},e}e.decorator("$location",["$delegate","$timeout",t])}]),a.controller("$ionicHeaderBar",["$scope","$element","$attrs","$q","$ionicConfig","$ionicHistory",function(e,t,n,i,o,r){function a(e){return C[e]||(C[e]=t[0].querySelector("."+e)),C[e]}var c="title",s="back-text",l="back-button",u="default-title",d="previous-title",f="hide",h=this,p="",v="",g=0,m=0,$="",w=!1,b=!0,y=!0,S=!1,k=0;h.beforeEnter=function(t){e.$broadcast("$ionicView.beforeEnter",t)},h.title=function(e){return arguments.length&&e!==p&&(a(c).innerHTML=e,p=e,k=0),p},h.enableBack=function(e,t){return arguments.length&&(w=e,t||h.updateBackButton()),w},h.showBack=function(e,t){return arguments.length&&(b=e,t||h.updateBackButton()),b},h.showNavBack=function(e){y=e,h.updateBackButton()},h.updateBackButton=function(){var e;(b&&y&&w)!==S&&(S=b&&y&&w,e=a(l),e&&e.classList[S?"remove":"add"](f)),w&&(e=e||a(l),e&&(h.backButtonIcon!==o.backButton.icon()&&(e=a(l+" .icon"),e&&(h.backButtonIcon=o.backButton.icon(),e.className="icon "+h.backButtonIcon)),h.backButtonText!==o.backButton.text()&&(e=a(l+" .back-text"),e&&(e.textContent=h.backButtonText=o.backButton.text()))))},h.titleTextWidth=function(){if(!k){var e=ionic.DomUtil.getTextBounds(a(c));k=Math.min(e&&e.width||30)}return k},h.titleWidth=function(){var e=h.titleTextWidth(),t=a(c).offsetWidth;return e>t&&(e=t+(g-m-5)),e},h.titleTextX=function(){return t[0].offsetWidth/2-h.titleWidth()/2},h.titleLeftRight=function(){return g-m},h.backButtonTextLeft=function(){for(var e=0,t=a(s);t;)e+=t.offsetLeft,t=t.parentElement;return e},h.resetBackButton=function(e){if(o.backButton.previousTitleText()){var t=a(d);if(t){t.classList.remove(f);var n=e&&r.getViewById(e.viewId),i=r.backTitle(n);i!==v&&(v=t.innerHTML=i)}var c=a(u);c&&c.classList.remove(f)}},h.align=function(e){var i=a(c);e=e||n.alignTitle||o.navBar.alignTitle();var r=h.calcWidths(e,!1);if(b&&v&&o.backButton.previousTitleText()){var s=h.calcWidths(e,!0),l=t[0].offsetWidth-s.titleLeft-s.titleRight;h.titleTextWidth()<=l&&(r=s)}return h.updatePositions(i,r.titleLeft,r.titleRight,r.buttonsLeft,r.buttonsRight,r.css,r.showPrevTitle)},h.calcWidths=function(e,n){var i,o,r,h,p,v,g,m,$,w=a(c),y=a(l),S=t[0].childNodes,k=0,C=0,T=0,B=0,I="",x=0;for(i=0;i<S.length;i++){if(p=S[i],g=0,1==p.nodeType){if(p===w){$=!0;continue}if(p.classList.contains(f))continue;if(b&&p===y){for(o=0;o<p.childNodes.length;o++)if(h=p.childNodes[o],1==h.nodeType)if(h.classList.contains(s))for(r=0;r<h.children.length;r++)if(v=h.children[r],n){if(v.classList.contains(u))continue;x+=v.offsetWidth}else{if(v.classList.contains(d))continue;x+=v.offsetWidth}else x+=h.offsetWidth;else 3==h.nodeType&&h.nodeValue.trim()&&(m=ionic.DomUtil.getTextBounds(h),x+=m&&m.width||0);g=x||p.offsetWidth}else g=p.offsetWidth}else 3==p.nodeType&&p.nodeValue.trim()&&(m=ionic.DomUtil.getTextBounds(p),g=m&&m.width||0);$?C+=g:k+=g}if("left"==e)I="title-left",k&&(T=k+15),C&&(B=C+15);else if("right"==e)I="title-right",k&&(T=k+15),C&&(B=C+15);else{var A=Math.max(k,C)+10;A>10&&(T=B=A)}return{backButtonWidth:x,buttonsLeft:k,buttonsRight:C,titleLeft:T,titleRight:B,showPrevTitle:n,css:I}},h.updatePositions=function(e,n,r,c,s,l,p){var v=i.defer();if(e&&(n!==g&&(e.style.left=n?n+"px":"",g=n),r!==m&&(e.style.right=r?r+"px":"",m=r),l!==$&&(l&&e.classList.add(l),$&&e.classList.remove($),$=l)),o.backButton.previousTitleText()){var w=a(d),b=a(u);w&&w.classList[p?"remove":"add"](f),b&&b.classList[p?"add":"remove"](f)}return ionic.requestAnimationFrame(function(){if(e&&e.offsetWidth+10<e.scrollWidth){var n=s+5,i=t[0].offsetWidth-g-h.titleTextWidth()-20;r=n>i?n:i,r!==m&&(e.style.right=r+"px",m=r)}v.resolve()}),v.promise},h.setCss=function(e,t){ionic.DomUtil.cachedStyles(a(e),t)};var C={};e.$on("$destroy",function(){for(var e in C)C[e]=null})}]),a.controller("$ionInfiniteScroll",["$scope","$attrs","$element","$timeout",function(e,t,n,i){function o(){ionic.requestAnimationFrame(function(){n[0].classList.add("active")}),s.isLoading=!0,e.$parent&&e.$parent.$apply(t.onInfinite||"")}function r(){ionic.requestAnimationFrame(function(){n[0].classList.remove("active")}),i(function(){s.jsScrolling&&s.scrollView.resize(),(s.jsScrolling&&s.scrollView.__container&&s.scrollView.__container.offsetHeight>0||!s.jsScrolling)&&s.checkBounds()},30,!1),s.isLoading=!1}function a(){if(!s.isLoading){var e={};if(s.jsScrolling){e=s.getJSMaxScroll();var t=s.scrollView.getValues();(-1!==e.left&&t.left>=e.left||-1!==e.top&&t.top>=e.top)&&o()}else e=s.getNativeMaxScroll(),(-1!==e.left&&s.scrollEl.scrollLeft>=e.left-s.scrollEl.clientWidth||-1!==e.top&&s.scrollEl.scrollTop>=e.top-s.scrollEl.clientHeight)&&o()}}function c(e){var n=(t.distance||"2.5%").trim(),i=-1!==n.indexOf("%");return i?e*(1-parseFloat(n)/100):e-parseFloat(n)}var s=this;s.isLoading=!1,e.icon=function(){return l(t.icon)?t.icon:"ion-load-d"},e.spinner=function(){return l(t.spinner)?t.spinner:""},e.$on("scroll.infiniteScrollComplete",function(){r()}),e.$on("$destroy",function(){s.scrollCtrl&&s.scrollCtrl.$element&&s.scrollCtrl.$element.off("scroll",s.checkBounds),s.scrollEl&&s.scrollEl.removeEventListener&&s.scrollEl.removeEventListener("scroll",s.checkBounds)}),s.checkBounds=ionic.Utils.throttle(a,300),s.getJSMaxScroll=function(){var e=s.scrollView.getScrollMax();return{left:s.scrollView.options.scrollingX?c(e.left):-1,top:s.scrollView.options.scrollingY?c(e.top):-1}},s.getNativeMaxScroll=function(){var e={left:s.scrollEl.scrollWidth,top:s.scrollEl.scrollHeight},t=window.getComputedStyle(s.scrollEl)||{};return{left:!e.left||"scroll"!==t.overflowX&&"auto"!==t.overflowX&&"scroll"!==s.scrollEl.style["overflow-x"]?-1:c(e.left),top:!e.top||"scroll"!==t.overflowY&&"auto"!==t.overflowY&&"scroll"!==s.scrollEl.style["overflow-y"]?-1:c(e.top)}},s.__finishInfiniteScroll=r}]),a.service("$ionicListDelegate",ionic.DelegateService(["showReorder","showDelete","canSwipeItems","closeOptionButtons"])).controller("$ionicList",["$scope","$attrs","$ionicListDelegate","$ionicHistory",function(e,t,n,i){var o=this,r=!0,a=!1,c=!1,s=n._registerInstance(o,t.delegateHandle,function(){return i.isActiveScope(e)});e.$on("$destroy",s),o.showReorder=function(e){return arguments.length&&(a=!!e),a},o.showDelete=function(e){return arguments.length&&(c=!!e),c},o.canSwipeItems=function(e){return arguments.length&&(r=!!e),r},o.closeOptionButtons=function(){o.listView&&o.listView.clearDragEffects()}}]),a.controller("$ionicNavBar",["$scope","$element","$attrs","$compile","$timeout","$ionicNavBarDelegate","$ionicConfig","$ionicHistory",function(e,t,n,i,o,r,a,c){function u(e,t){var n=console.warn||console.log;n&&n.call(console,"navBarController."+e+" is deprecated, please use "+t+" instead")}function d(e){return x[e]?f(x[e]):void 0}function h(){for(var e=0;e<I.length;e++)if(I[e].isActive)return I[e]}function p(){for(var e=0;e<I.length;e++)if(!I[e].isActive)return I[e]}function v(e,t){e&&ionic.DomUtil.cachedAttr(e.containerEle(),"nav-bar",t)}function g(e){ionic.DomUtil.cachedAttr(t,"nav-swipe",e)}var m,$,w,b="hide",y="$ionNavBarController",S="primaryButtons",k="secondaryButtons",C="backButton",T="primaryButtons secondaryButtons leftButtons rightButtons title".split(" "),B=this,I=[],x={},A=!0;t.parent().data(y,B);var E=n.delegateHandle||"navBar"+ionic.Utils.nextUid(),V=r._registerInstance(B,E);B.init=function(){t.addClass("nav-bar-container"),ionic.DomUtil.cachedAttr(t,"nav-bar-transition",a.views.transition()),B.createHeaderBar(!1),B.createHeaderBar(!0),e.$emit("ionNavBar.init",E)},B.createHeaderBar=function(o){function r(e,t){e&&("title"===t?g.append(e):"rightButtons"==t||t==k&&"left"!=a.navBar.positionSecondaryButtons()||t==S&&"right"==a.navBar.positionPrimaryButtons()?(v||(v=f('<div class="buttons buttons-right">'),h.append(v)),t==k?v.append(e):v.prepend(e)):(p||(p=f('<div class="buttons buttons-left">'),m[C]?m[C].after(p):h.prepend(p)),t==k?p.append(e):p.prepend(e)))}var c=f('<div class="nav-bar-block">');ionic.DomUtil.cachedAttr(c,"nav-bar",o?"active":"cached");var u=n.alignTitle||a.navBar.alignTitle(),h=f("<ion-header-bar>").addClass(n["class"]).attr("align-title",u);l(n.noTapScroll)&&h.attr("no-tap-scroll",n.noTapScroll);var p,v,g=f('<div class="title title-'+u+'">'),m={},$={};m[C]=d(C),m[C]&&h.append(m[C]),h.append(g),s(T,function(e){m[e]=d(e),r(m[e],e)});for(var w=0;w<h[0].children.length;w++)h[0].children[w].classList.add("header-item");c.append(h),t.append(i(c)(e.$new()));var y=h.data("$ionHeaderBarController");y.backButtonIcon=a.backButton.icon(),y.backButtonText=a.backButton.text();var B={isActive:o,title:function(e){y.title(e)},setItem:function(e,t){B.removeItem(t),e?("title"===t&&B.title(""),r(e,t),m[t]&&m[t].addClass(b),$[t]=e):m[t]&&m[t].removeClass(b)},removeItem:function(e){$[e]&&($[e].scope().$destroy(),$[e].remove(),$[e]=null)},containerEle:function(){return c},headerBarEle:function(){return h},afterLeave:function(){s(T,function(e){B.removeItem(e)}),y.resetBackButton()},controller:function(){return y},destroy:function(){s(T,function(e){B.removeItem(e)}),c.scope().$destroy();for(var e in m)m[e]&&(m[e].removeData(),m[e]=null);p&&p.removeData(),v&&v.removeData(),g.removeData(),h.removeData(),c.remove(),c=h=g=p=v=null}};return I.push(B),B},B.navElement=function(e,t){return l(t)&&(x[e]=t),x[e]},B.update=function(e){var t=!e.hasHeaderBar&&e.showNavBar;e.transition=a.views.transition(),t||(e.direction="none"),B.enable(t);var n=B.isInitialized?p():h(),i=B.isInitialized?h():null,o=n.controller();o.enableBack(e.enableBack,!0),o.showBack(e.showBack,!0),o.updateBackButton(),B.title(e.title,n),B.showBar(t),e.navBarItems&&s(T,function(t){n.setItem(e.navBarItems[t],t)}),B.transition(n,i,e),B.isInitialized=!0,g("")},B.transition=function(n,i,r){function c(){for(var e=0;e<I.length;e++)I[e].isActive=!1;n.isActive=!0,v(n,"active"),v(i,"cached"),B.activeTransition=d=$=null}var s=n.controller(),l=a.transitions.navBar[r.navBarTransition]||a.transitions.navBar.none,u=r.transitionId;s.beforeEnter(r);var d=l(n,i,r.direction,r.shouldAnimate&&B.isInitialized);ionic.DomUtil.cachedAttr(t,"nav-bar-transition",r.navBarTransition),
ionic.DomUtil.cachedAttr(t,"nav-bar-direction",r.direction),d.shouldAnimate&&r.renderEnd?v(n,"stage"):(v(n,"entering"),v(i,"leaving")),s.resetBackButton(r),d.run(0),B.activeTransition={run:function(e){d.shouldAnimate=!1,d.direction="back",d.run(e)},cancel:function(t,o,r){g(o),v(i,"active"),v(n,"cached"),d.shouldAnimate=t,d.run(0),B.activeTransition=d=null;var a;r.showBar!==B.showBar()&&B.showBar(r.showBar),r.showBackButton!==B.showBackButton()&&B.showBackButton(r.showBackButton),a&&e.$apply()},complete:function(e,t){g(t),d.shouldAnimate=e,d.run(1),$=c}},o(s.align,16),(m=function(){w===u&&(v(n,"entering"),v(i,"leaving"),d.run(1),$=function(){w!=u&&d.shouldAnimate||c()},m=null)})()},B.triggerTransitionStart=function(e){w=e,m&&m()},B.triggerTransitionEnd=function(){$&&$()},B.showBar=function(t){return arguments.length&&(B.visibleBar(t),e.$parent.$hasHeader=!!t),!!e.$parent.$hasHeader},B.visibleBar=function(e){e&&!A?(t.removeClass(b),B.align()):!e&&A&&t.addClass(b),A=e},B.enable=function(e){B.visibleBar(e);for(var t=0;t<r._instances.length;t++)r._instances[t]!==B&&r._instances[t].visibleBar(!1)},B.showBackButton=function(t){if(arguments.length){for(var n=0;n<I.length;n++)I[n].controller().showNavBack(!!t);e.$isBackButtonShown=!!t}return e.$isBackButtonShown},B.showActiveBackButton=function(e){var t=h();return t?arguments.length?t.controller().showBack(e):t.controller().showBack():void 0},B.title=function(t,n){return l(t)&&(t=t||"",n=n||h(),n&&n.title(t),e.$title=t,c.currentTitle(t)),e.$title},B.align=function(e,t){t=t||h(),t&&t.controller().align(e)},B.hasTabsTop=function(e){t[e?"addClass":"removeClass"]("nav-bar-tabs-top")},B.hasBarSubheader=function(e){t[e?"addClass":"removeClass"]("nav-bar-has-subheader")},B.changeTitle=function(e){u("changeTitle(val)","title(val)"),B.title(e)},B.setTitle=function(e){u("setTitle(val)","title(val)"),B.title(e)},B.getTitle=function(){return u("getTitle()","title()"),B.title()},B.back=function(){u("back()","$ionicHistory.goBack()"),c.goBack()},B.getPreviousTitle=function(){u("getPreviousTitle()","$ionicHistory.backTitle()"),c.goBack()},e.$on("$destroy",function(){e.$parent.$hasHeader=!1,t.parent().removeData(y);for(var n=0;n<I.length;n++)I[n].destroy();t.remove(),t=I=null,V()})}]),a.controller("$ionicNavView",["$scope","$element","$attrs","$compile","$controller","$ionicNavBarDelegate","$ionicNavViewDelegate","$ionicHistory","$ionicViewSwitcher","$ionicConfig","$ionicScrollDelegate","$ionicSideMenuDelegate",function(e,t,n,i,o,r,a,s,l,u,d,f){function h(e,n){for(var i,o,r=t.children(),a=0,c=r.length;c>a;a++)if(i=r.eq(a),E(i)==B){o=i.scope(),o&&o.$emit(e.name.replace("Tabs","View"),n);break}}function p(e){ionic.DomUtil.cachedAttr(t,"nav-swipe",e)}function v(e,t){var n=m();n&&n.hasTabsTop(t)}function g(e,t){var n=m();n&&n.hasBarSubheader(t)}function m(){if(w)for(var e=0;e<r._instances.length;e++)if(r._instances[e].$$delegateHandle==w)return r._instances[e];return t.inheritedData("$ionNavBarController")}var $,w,b,y,S,k="$eleId",C="$destroyEle",T="$noCache",B="active",I="cached",x=this,A=!1,E=l.navViewAttr;x.scope=e,x.element=t,x.init=function(){var i=n.name||"",o=t.parent().inheritedData("$uiView"),r=o&&o.state?o.state.name:"";i.indexOf("@")<0&&(i=i+"@"+r);var c={name:i,state:null};t.data("$uiView",c);var s=a._registerInstance(x,n.delegateHandle);return e.$on("$destroy",function(){s(),x.isSwipeFreeze&&d.freezeAllScrolls(!1)}),e.$on("$ionicHistory.deselect",x.cacheCleanup),e.$on("$ionicTabs.top",v),e.$on("$ionicSubheader",g),e.$on("$ionicTabs.beforeLeave",h),e.$on("$ionicTabs.afterLeave",h),e.$on("$ionicTabs.leave",h),ionic.Platform.ready(function(){ionic.Platform.isWebView()&&ionic.Platform.isIOS()&&x.initSwipeBack()}),c},x.register=function(t){var n=c({},s.currentView()),i=s.register(e,t);x.update(i);var o=s.getViewById(i.viewId)||{},r=y!==i.viewId;x.render(i,t,o,n,r,!0)},x.update=function(e){A=!0,$=e.direction;var n=t.parent().inheritedData("$ionNavViewController");n&&(n.isPrimary(!1),("enter"===$||"exit"===$)&&(n.direction($),"enter"===$&&($="none")))},x.render=function(e,t,n,i,o,r){var a=l.create(x,t,n,i,o,r);a.init(e,function(){a.transition(x.direction(),e.enableBack,!S),y=S=null})},x.beforeEnter=function(e){if(A){w=e.navBarDelegate;var t=m();t&&t.update(e),p("")}},x.activeEleId=function(e){return arguments.length&&(b=e),b},x.transitionEnd=function(){var e,n,i,o=t.children();for(e=0,n=o.length;n>e;e++)i=o.eq(e),i.data(k)===b?E(i,B):("leaving"===E(i)||E(i)===B||E(i)===I)&&(i.data(C)||i.data(T)?l.destroyViewEle(i):(E(i,I),ionic.Utils.disconnectScope(i.scope())));p(""),x.isSwipeFreeze&&d.freezeAllScrolls(!1)},x.cacheCleanup=function(){for(var e=t.children(),n=0,i=e.length;i>n;n++)e.eq(n).data(C)&&l.destroyViewEle(e.eq(n))},x.clearCache=function(e){var n,i,o,r,a,c,s=t.children();for(o=0,r=s.length;r>o;o++)if(n=s.eq(o),e)for(c=n.data(k),a=0;a<e.length;a++)c===e[a]&&l.destroyViewEle(n);else E(n)==I?l.destroyViewEle(n):E(n)==B&&(i=n.scope(),i&&i.$broadcast("$ionicView.clearCache"))},x.getViewElements=function(){return t.children()},x.appendViewElement=function(n,r){var a=i(n);t.append(n);var c=e.$new();if(r&&r.$$controller){r.$scope=c;var s=o(r.$$controller,r);r.$$controllerAs&&(c[r.$$controllerAs]=s),t.children().data("$ngControllerController",s)}return a(c),c},x.title=function(e){var t=m();t&&t.title(e)},x.enableBackButton=function(e){var t=m();t&&t.enableBackButton(e)},x.showBackButton=function(e){var t=m();return t?arguments.length?t.showActiveBackButton(e):t.showActiveBackButton():!0},x.showBar=function(e){var t=m();return t?arguments.length?t.showBar(e):t.showBar():!0},x.isPrimary=function(e){return arguments.length&&(A=e),A},x.direction=function(e){return arguments.length&&($=e),$},x.initSwipeBack=function(){function n(e){if(A&&u.views.swipeBackEnabled()&&!f.isOpenRight()&&(k=r(e),!(k>T))){v=s.backView();var n=s.currentView();if(v&&v.historyId===n.historyId&&n.canSwipeBack!==!1){b||(b=window.innerWidth),x.isSwipeFreeze=d.freezeAllScrolls(!0);var a={direction:"back"};C=[],B={showBar:x.showBar(),showBackButton:x.showBackButton()};var p=l.create(x,a,v,n,!0,!1);p.loadViewElements(a),p.render(a),c=p.transition("back",s.enabledBack(v),!0),h=m(),$=ionic.onGesture("drag",i,t[0]),w=ionic.onGesture("release",o,t[0])}}}function i(e){if(A&&c){var t=r(e);if(C.push({t:Date.now(),x:t}),t>=b-15)o(e);else{var n=Math.min(Math.max(a(t),0),1);c.run(n),h&&h.activeTransition&&h.activeTransition.run(n)}}}function o(e){if(A&&c&&C&&C.length>1){for(var t=Date.now(),n=r(e),s=C[C.length-1],l=C.length-2;l>=0&&!(t-s.t>200);l--)s=C[l];var u=n>=C[C.length-2].x,f=a(n),g=Math.abs(s.x-n)/(t-s.t);if(y=v.viewId,S=.03>f||f>.97,u&&(f>.5||g>.1)){var m=g>.5||.05>g||n>b-45?"fast":"slow";p(S?"":m),v.go(),h&&h.activeTransition&&h.activeTransition.complete(!S,m)}else p(S?"":"fast"),y=null,c.cancel(!S),h&&h.activeTransition&&h.activeTransition.cancel(!S,"fast",B),S=null}ionic.offGesture($,"drag",i),ionic.offGesture(w,"release",o),b=c=C=null,x.isSwipeFreeze=d.freezeAllScrolls(!1)}function r(e){return ionic.tap.pointerCoord(e.gesture.srcEvent).x}function a(e){return(e-k)/b}var c,h,v,g,$,w,b,k,C,T=u.views.swipeBackHitWidth(),B={};g=ionic.onGesture("dragstart",n,t[0]),e.$on("$destroy",function(){ionic.offGesture(g,"dragstart",n),ionic.offGesture($,"drag",i),ionic.offGesture(w,"release",o),x.element=c=h=null})}}]),a.controller("$ionicRefresher",["$scope","$attrs","$element","$ionicBind","$timeout",function(e,t,n,i,o){function r(e){e.touches=e.touches||[{screenX:e.screenX,screenY:e.screenY}],P=Math.floor(e.touches[0].screenY)}function a(e){e.touches=e.touches||[{screenX:e.screenX,screenY:e.screenY}],P=e.touches[0].screenY}function c(){P=null,(D||T)&&(T?(T=!1,I=0,x>A?($(),p(A,V)):(p(0,V,m),B=!1)):(I=0,B=!1,h(!1)))}function s(e){if(e.touches=e.touches||[{screenX:e.screenX,screenY:e.screenY}],(P||"mousemove"!=e.type)&&D&&!(e.touches.length>1)){if(null===P&&(P=e.touches[0].screenY),_=e.touches[0].screenY-P,ionic.Platform.isAndroid()&&4.4===ionic.Platform.version()&&!ionic.Platform.isCrosswalk()&&0===S.scrollTop&&_>0&&(T=!0,e.preventDefault()),0>=_-I||0!==S.scrollTop)return B&&(B=!1,h(!1)),T&&f(S,_- -1*I),void(0!==x&&d(0));_>0&&0===S.scrollTop&&!B&&(I=_),e.preventDefault(),B||(B=!0,h(!0)),T=!0,d((_-I)/3),!E&&x>A?(E=!0,ionic.requestAnimationFrame(g)):E&&A>x&&(E=!1,ionic.requestAnimationFrame(m))}}function u(e){D=0===e.target.scrollTop||T}function d(e){k.style[ionic.CSS.TRANSFORM]="translateY("+e+"px)",x=e}function f(e,t){e.scrollTop=t;var n=document.createEvent("UIEvents");n.initUIEvent("scroll",!0,!0,window,1),e.dispatchEvent(n)}function h(e){e?ionic.requestAnimationFrame(function(){k.classList.add("overscroll"),w()}):ionic.requestAnimationFrame(function(){k.classList.remove("overscroll"),b(),m()})}function p(e,t,n){function i(e){return--e*e*e+1}function o(){var c=Date.now(),s=Math.min(1,(c-r)/t),l=i(s);d(Math.floor(l*(e-a)+a)),1>s?ionic.requestAnimationFrame(o):(5>e&&e>-5&&(B=!1,h(!1)),n&&n())}var r=Date.now(),a=x;return a===e?void n():void ionic.requestAnimationFrame(o)}function v(){k&&(ionic.off(L,a,k),ionic.off(R,s,k),ionic.off(M,c,k),ionic.off("mousedown",r,k),ionic.off("mousemove",s,k),ionic.off("mouseup",c,k)),S&&ionic.off("scroll",u,S),S=null,k=null}function g(){n[0].classList.add("active"),e.$onPulling()}function m(){o(function(){n.removeClass("active refreshing refreshing-tail"),E&&(E=!1)},150)}function $(){n[0].classList.add("refreshing");var t=e.$onRefresh();t&&t.then&&t["finally"](function(){e.$broadcast("scroll.refreshComplete")})}function w(){n[0].classList.remove("invisible")}function b(){n[0].classList.add("invisible")}function y(){n[0].classList.add("refreshing-tail")}var S,k,C=this,T=!1,B=!1,I=0,x=0,A=60,E=!1,V=500,P=null,_=null,D=!0;l(t.pullingIcon)||t.$set("pullingIcon","ion-android-arrow-down"),e.showSpinner=!l(t.refreshingIcon)&&"none"!=t.spinner,e.showIcon=l(t.refreshingIcon),i(e,t,{pullingIcon:"@",pullingText:"@",refreshingIcon:"@",refreshingText:"@",spinner:"@",disablePullingRotation:"@",$onRefresh:"&onRefresh",$onPulling:"&onPulling"}),e.$on("scroll.refreshComplete",function(){o(function(){ionic.requestAnimationFrame(y),p(0,V,m),o(function(){B&&(B=!1,h(!1))},V)},V)});var L,R,M;window.navigator.pointerEnabled?(L="pointerdown",R="pointermove",M="pointerup"):window.navigator.msPointerEnabled?(L="MSPointerDown",R="MSPointerMove",M="MSPointerUp"):(L="touchstart",R="touchmove",M="touchend"),C.init=function(){if(S=n.parent().parent()[0],k=n.parent()[0],!(S&&S.classList.contains("ionic-scroll")&&k&&k.classList.contains("scroll")))throw new Error("Refresher must be immediate child of ion-content or ion-scroll");ionic.on(L,a,k),ionic.on(R,s,k),ionic.on(M,c,k),ionic.on("mousedown",r,k),ionic.on("mousemove",s,k),ionic.on("mouseup",c,k),ionic.on("scroll",u,S),e.$on("$destroy",v)},C.getRefresherDomMethods=function(){return{activate:g,deactivate:m,start:$,show:w,hide:b,tail:y}},C.__handleTouchmove=s,C.__getScrollChild=function(){return k},C.__getScrollParent=function(){return S}}]),a.controller("$ionicScroll",["$scope","scrollViewOptions","$timeout","$window","$location","$document","$ionicScrollDelegate","$ionicHistory",function(e,t,n,i,o,r,a,c){var s=this;s.__timeout=n,s._scrollViewOptions=t,s.isNative=function(){return!!t.nativeScrolling};var u,d=s.element=t.el,h=s.$element=f(d);u=s.isNative()?s.scrollView=new ionic.views.ScrollNative(t):s.scrollView=new ionic.views.Scroll(t),(h.parent().length?h.parent():h).data("$$ionicScrollController",s);var p=a._registerInstance(s,t.delegateHandle,function(){return c.isActiveScope(e)});l(t.bouncing)||ionic.Platform.ready(function(){u&&u.options&&(u.options.bouncing=!0,ionic.Platform.isAndroid()&&(u.options.bouncing=!1,u.options.deceleration=.95))});var v=angular.bind(u,u.resize);angular.element(i).on("resize",v);var g=function(t){var n=(t.originalEvent||t).detail||{};e.$onScroll&&e.$onScroll({event:t,scrollTop:n.scrollTop||0,scrollLeft:n.scrollLeft||0})};h.on("scroll",g),e.$on("$destroy",function(){p(),u&&u.__cleanup&&u.__cleanup(),angular.element(i).off("resize",v),h&&h.off("scroll",g),s._scrollViewOptions&&(s._scrollViewOptions.el=null),t&&(t.el=null),u=s.scrollView=t=s._scrollViewOptions=d=s.$element=h=null}),n(function(){u&&u.run&&u.run()}),s.getScrollView=function(){return u},s.getScrollPosition=function(){return u.getValues()},s.resize=function(){return n(v,0,!1).then(function(){h&&h.triggerHandler("scroll-resize")})},s.scrollTop=function(e){s.resize().then(function(){u&&u.scrollTo(0,0,!!e)})},s.scrollBottom=function(e){s.resize().then(function(){if(u){var t=u.getScrollMax();u.scrollTo(t.left,t.top,!!e)}})},s.scrollTo=function(e,t,n){s.resize().then(function(){u&&u.scrollTo(e,t,!!n)})},s.zoomTo=function(e,t,n,i){s.resize().then(function(){u&&u.zoomTo(e,!!t,n,i)})},s.zoomBy=function(e,t,n,i){s.resize().then(function(){u&&u.zoomBy(e,!!t,n,i)})},s.scrollBy=function(e,t,n){s.resize().then(function(){u&&u.scrollBy(e,t,!!n)})},s.anchorScroll=function(e){s.resize().then(function(){if(u){var t=o.hash(),n=t&&r[0].getElementById(t);if(!t||!n)return void u.scrollTo(0,0,!!e);var i=n,a=0,c=0;do null!==i&&(a+=i.offsetLeft),null!==i&&(c+=i.offsetTop),i=i.offsetParent;while(i.attributes!=s.element.attributes&&i.offsetParent);u.scrollTo(a,c,!!e)}})},s.freezeScroll=u.freeze,s.freezeScrollShut=u.freezeShut,s.freezeAllScrolls=function(e){for(var t=0;t<a._instances.length;t++)a._instances[t].freezeScroll(e)},s._setRefresher=function(e,t,n){s.refresher=t;var i=s.refresher.clientHeight||60;u.activatePullToRefresh(i,n)}}]),a.controller("$ionicSideMenus",["$scope","$attrs","$ionicSideMenuDelegate","$ionicPlatform","$ionicBody","$ionicHistory","$ionicScrollDelegate","IONIC_BACK_PRIORITY","$rootScope",function(e,t,n,i,o,r,a,c,s){var l,d,f,p,v,g,m,$=this,w=!0;$.$scope=e,$.initialize=function(e){$.left=e.left,$.right=e.right,$.setContent(e.content),$.dragThresholdX=e.dragThresholdX||10,r.registerHistory($.$scope)},$.setContent=function(e){e&&($.content=e,$.content.onDrag=function(e){$._handleDrag(e)},$.content.endDrag=function(e){$._endDrag(e)})},$.isOpenLeft=function(){return $.getOpenAmount()>0},$.isOpenRight=function(){return $.getOpenAmount()<0},$.toggleLeft=function(e){if(!m&&$.left.isEnabled){var t=$.getOpenAmount();0===arguments.length&&(e=0>=t),$.content.enableAnimation(),e?($.openPercentage(100),s.$emit("$ionicSideMenuOpen","left")):($.openPercentage(0),s.$emit("$ionicSideMenuClose","left"))}},$.toggleRight=function(e){if(!m&&$.right.isEnabled){var t=$.getOpenAmount();0===arguments.length&&(e=t>=0),$.content.enableAnimation(),e?($.openPercentage(-100),s.$emit("$ionicSideMenuOpen","right")):($.openPercentage(0),s.$emit("$ionicSideMenuClose","right"))}},$.toggle=function(e){"right"==e?$.toggleRight():$.toggleLeft()},$.close=function(){$.openPercentage(0),s.$emit("$ionicSideMenuClose","left"),s.$emit("$ionicSideMenuClose","right")},$.getOpenAmount=function(){return $.content&&$.content.getTranslateX()||0},$.getOpenRatio=function(){var e=$.getOpenAmount();return e>=0?e/$.left.width:e/$.right.width},$.isOpen=function(){return 0!==$.getOpenAmount()},$.getOpenPercentage=function(){return 100*$.getOpenRatio()},$.openPercentage=function(e){var t=e/100;$.left&&e>=0?$.openAmount($.left.width*t):$.right&&0>e&&$.openAmount($.right.width*t),o.enableClass(0!==e,"menu-open"),$.content.setCanScroll(0==e)},$.openAmount=function(e){var t=$.left&&$.left.width||0,n=$.right&&$.right.width||0;return($.left&&$.left.isEnabled||!(e>0))&&($.right&&$.right.isEnabled||!(0>e))?d&&e>t?void $.content.setTranslateX(t):l&&-n>e?void $.content.setTranslateX(-n):($.content.setTranslateX(e),void(e>=0?(d=!0,l=!1,e>0&&($.right&&$.right.pushDown&&$.right.pushDown(),$.left&&$.left.bringUp&&$.left.bringUp())):(l=!0,d=!1,$.right&&$.right.bringUp&&$.right.bringUp(),$.left&&$.left.pushDown&&$.left.pushDown()))):void $.content.setTranslateX(0)},$.snapToRest=function(e){$.content.enableAnimation(),f=!1;var t=$.getOpenRatio();if(0===t)return void $.openPercentage(0);var n=.3,i=e.gesture.velocityX,o=e.gesture.direction;t>0&&.5>t&&"right"==o&&n>i?$.openPercentage(0):t>.5&&"left"==o&&n>i?$.openPercentage(100):0>t&&t>-.5&&"left"==o&&n>i?$.openPercentage(0):.5>t&&"right"==o&&n>i?$.openPercentage(-100):"right"==o&&t>=0&&(t>=.5||i>n)?$.openPercentage(100):"left"==o&&0>=t&&(-.5>=t||i>n)?$.openPercentage(-100):$.openPercentage(0)},$.enableMenuWithBackViews=function(e){return arguments.length&&(w=!!e),w},$.isAsideExposed=function(){return!!m},$.exposeAside=function(e){($.left&&$.left.isEnabled||$.right&&$.right.isEnabled)&&($.close(),m=e,$.left&&$.left.isEnabled&&$.right&&$.right.isEnabled?$.content.setMarginLeftAndRight(m?$.left.width:0,m?$.right.width:0):$.left&&$.left.isEnabled?$.content.setMarginLeft(m?$.left.width:0):$.right&&$.right.isEnabled&&$.content.setMarginRight(m?$.right.width:0),$.$scope.$emit("$ionicExposeAside",m))},$.activeAsideResizing=function(e){o.enableClass(e,"aside-resizing")},$._endDrag=function(e){m||(f&&$.snapToRest(e),p=null,v=null,g=null)},$._handleDrag=function(t){!m&&e.dragContent&&(p?v=t.gesture.touches[0].pageX:(p=t.gesture.touches[0].pageX,v=p),!f&&Math.abs(v-p)>$.dragThresholdX&&(p=v,f=!0,$.content.disableAnimation(),g=$.getOpenAmount()),f&&$.openAmount(g+(v-p)))},$.canDragContent=function(t){return arguments.length&&(e.dragContent=!!t),e.dragContent},$.edgeThreshold=25,$.edgeThresholdEnabled=!1,$.edgeDragThreshold=function(e){return arguments.length&&(u(e)&&e>0?($.edgeThreshold=e,$.edgeThresholdEnabled=!0):$.edgeThresholdEnabled=!!e),$.edgeThresholdEnabled},$.isDraggableTarget=function(t){var n=$.edgeThresholdEnabled&&!$.isOpen(),i=t.gesture.startEvent&&t.gesture.startEvent.center&&t.gesture.startEvent.center.pageX,o=!n||i<=$.edgeThreshold||i>=$.content.element.offsetWidth-$.edgeThreshold,a=r.backView(),c=w?!0:!a;if(!c){var s=r.currentView()||{};return o&&a.historyId!==s.historyId}return(e.dragContent||$.isOpen())&&o&&!t.gesture.srcEvent.defaultPrevented&&c&&!t.target.tagName.match(/input|textarea|select|object|embed/i)&&!t.target.isContentEditable&&!(t.target.dataset?t.target.dataset.preventScroll:"true"==t.target.getAttribute("data-prevent-scroll"))},e.sideMenuContentTranslateX=0;var b=h,y=angular.bind($,$.close);e.$watch(function(){return 0!==$.getOpenAmount()},function(e){b(),e&&(b=i.registerBackButtonAction(y,c.sideMenu))});var S=n._registerInstance($,t.delegateHandle,function(){return r.isActiveScope(e)});e.$on("$destroy",function(){S(),b(),$.$scope=null,$.content&&($.content.setCanScroll(!0),$.content.element=null,$.content=null)}),$.initialize({left:{width:275},right:{width:275}})}]),function(e){function t(e,i,o,r){var a,c,s,l=document.createElement(f[e]||e);for(a in i)if(angular.isArray(i[a]))for(c=0;c<i[a].length;c++)if(i[a][c].fn)for(s=0;s<i[a][c].t;s++)t(a,i[a][c].fn(s,r),l,r);else t(a,i[a][c],l,r);else n(l,a,i[a]);o.appendChild(l)}function n(e,t,n){e.setAttribute(f[t]||t,n)}function i(e,t){var n=e.split(";"),i=n.slice(t),o=n.slice(0,n.length-i.length);return n=i.concat(o).reverse(),n.join(";")+";"+n[0]}function o(e,t){return e/=t/2,1>e?.5*e*e*e:(e-=2,.5*(e*e*e+2))}var r="translate(32,32)",c="stroke-opacity",s="round",l="indefinite",u="750ms",d="none",f={a:"animate",an:"attributeName",at:"animateTransform",c:"circle",da:"stroke-dasharray",os:"stroke-dashoffset",f:"fill",lc:"stroke-linecap",rc:"repeatCount",sw:"stroke-width",t:"transform",v:"values"},h={v:"0,32,32;360,32,32",an:"transform",type:"rotate",rc:l,dur:u},p={sw:4,lc:s,line:[{fn:function(e,t){return{y1:"ios"==t?17:12,y2:"ios"==t?29:20,t:r+" rotate("+(30*e+(6>e?180:-180))+")",a:[{fn:function(){return{an:c,dur:u,v:i("0;.1;.15;.25;.35;.45;.55;.65;.7;.85;1",e),rc:l}},t:1}]}},t:12}]},v={android:{c:[{sw:6,da:128,os:82,r:26,cx:32,cy:32,f:d}]},ios:p,"ios-small":p,bubbles:{sw:0,c:[{fn:function(e){return{cx:24*Math.cos(2*Math.PI*e/8),cy:24*Math.sin(2*Math.PI*e/8),t:r,a:[{fn:function(){return{an:"r",dur:u,v:i("1;2;3;4;5;6;7;8",e),rc:l}},t:1}]}},t:8}]},circles:{c:[{fn:function(e){return{r:5,cx:24*Math.cos(2*Math.PI*e/8),cy:24*Math.sin(2*Math.PI*e/8),t:r,sw:0,a:[{fn:function(){return{an:"fill-opacity",dur:u,v:i(".3;.3;.3;.4;.7;.85;.9;1",e),rc:l}},t:1}]}},t:8}]},crescent:{c:[{sw:4,da:128,os:82,r:26,cx:32,cy:32,f:d,at:[h]}]},dots:{c:[{fn:function(e){return{cx:16+16*e,cy:32,sw:0,a:[{fn:function(){return{an:"fill-opacity",dur:u,v:i(".5;.6;.8;1;.8;.6;.5",e),rc:l}},t:1},{fn:function(){return{an:"r",dur:u,v:i("4;5;6;5;4;3;3",e),rc:l}},t:1}]}},t:3}]},lines:{sw:7,lc:s,line:[{fn:function(e){return{x1:10+14*e,x2:10+14*e,a:[{fn:function(){return{an:"y1",dur:u,v:i("16;18;28;18;16",e),rc:l}},t:1},{fn:function(){return{an:"y2",dur:u,v:i("48;44;36;46;48",e),rc:l}},t:1},{fn:function(){return{an:c,dur:u,v:i("1;.8;.5;.4;1",e),rc:l}},t:1}]}},t:4}]},ripple:{f:d,"fill-rule":"evenodd",sw:3,circle:[{fn:function(e){return{cx:32,cy:32,a:[{fn:function(){return{an:"r",begin:-1*e+"s",dur:"2s",v:"0;24",keyTimes:"0;1",keySplines:"0.1,0.2,0.3,1",calcMode:"spline",rc:l}},t:1},{fn:function(){return{an:c,begin:-1*e+"s",dur:"2s",v:".2;1;.2;0",rc:l}},t:1}]}},t:2}]},spiral:{defs:[{linearGradient:[{id:"sGD",gradientUnits:"userSpaceOnUse",x1:55,y1:46,x2:2,y2:46,stop:[{offset:.1,"class":"stop1"},{offset:1,"class":"stop2"}]}]}],g:[{sw:4,lc:s,f:d,path:[{stroke:"url(#sGD)",d:"M4,32 c0,15,12,28,28,28c8,0,16-4,21-9"},{d:"M60,32 C60,16,47.464,4,32,4S4,16,4,32"}],at:[h]}]}},g={android:function(t){function i(){if(!r.stop){var t=o(Date.now()-a,650),d=1,f=0,h=188-58*t,p=182-182*t;c%2&&(d=-1,f=-64,h=128- -58*t,p=182*t);var v=[0,-101,-90,-11,-180,79,-270,-191][c];n(u,"da",Math.max(Math.min(h,188),128)),n(u,"os",Math.max(Math.min(p,182),0)),n(u,"t","scale("+d+",1) translate("+f+",0) rotate("+v+",32,32)"),s+=4.1,s>359&&(s=0),n(l,"t","rotate("+s+",32,32)"),t>=1&&(c++,c>7&&(c=0),a=Date.now()),e.requestAnimationFrame(i)}}var r={};this.stop=!1;var a,c=0,s=0,l=t.querySelector("g"),u=t.querySelector("circle");return function(){return a=Date.now(),i(),r}}};a.controller("$ionicSpinner",["$element","$attrs","$ionicConfig",function(e,n,i){var o,r;this.init=function(){o=n.icon||i.spinner.icon();var r=document.createElement("div");return t("svg",{viewBox:"0 0 64 64",g:[v[o]]},r,o),e.html(r.innerHTML),this.start(),o},this.start=function(){g[o]&&(r=g[o](e[0])())},this.stop=function(){g[o]&&(r.stop=!0)}}])}(ionic),a.controller("$ionicTab",["$scope","$ionicHistory","$attrs","$location","$state",function(e,t,n,i,o){this.$scope=e,this.hrefMatchesState=function(){return n.href&&0===i.path().indexOf(n.href.replace(/^#/,"").replace(/\/$/,""))},this.srefMatchesState=function(){return n.uiSref&&o.includes(n.uiSref.split("(")[0])},this.navNameMatchesState=function(){return this.navViewName&&t.isCurrentStateNavView(this.navViewName)},this.tabMatchesState=function(){return this.hrefMatchesState()||this.srefMatchesState()||this.navNameMatchesState()}}]),a.controller("$ionicTabs",["$scope","$element","$ionicHistory",function(e,t,n){var i,o=this,r=null,a=null,c=!0;o.tabs=[],o.selectedIndex=function(){return o.tabs.indexOf(r)},o.selectedTab=function(){return r},o.previousSelectedTab=function(){return a},o.add=function(e){n.registerHistory(e),o.tabs.push(e)},o.remove=function(e){var t=o.tabs.indexOf(e);if(-1!==t){if(e.$tabSelected)if(o.deselect(e),1===o.tabs.length);else{var n=t===o.tabs.length-1?t-1:t+1;o.select(o.tabs[n])}o.tabs.splice(t,1)}},o.deselect=function(e){e.$tabSelected&&(a=r,r=i=null,e.$tabSelected=!1,(e.onDeselect||h)(),e.$broadcast&&e.$broadcast("$ionicHistory.deselect"))},o.select=function(t,a){var c;if(u(t)){if(c=t,c>=o.tabs.length)return;t=o.tabs[c]}else c=o.tabs.indexOf(t);1===arguments.length&&(a=!(!t.navViewName&&!t.uiSref)),r&&r.$historyId==t.$historyId?a&&n.goToHistoryRoot(t.$historyId):i!==c&&(s(o.tabs,function(e){o.deselect(e)}),r=t,i=c,o.$scope&&o.$scope.$parent&&(o.$scope.$parent.$activeHistoryId=t.$historyId),t.$tabSelected=!0,(t.onSelect||h)(),a&&e.$emit("$ionicHistory.change",{type:"tab",tabIndex:c,historyId:t.$historyId,navViewName:t.navViewName,hasNavView:!!t.navViewName,title:t.title,url:t.href,uiSref:t.uiSref}),e.$broadcast("tabSelected",{selectedTab:t,selectedTabIndex:c}))},o.hasActiveScope=function(){for(var e=0;e<o.tabs.length;e++)if(n.isActiveScope(o.tabs[e]))return!0;return!1},o.showBar=function(e){return arguments.length&&(e?t.removeClass("tabs-item-hide"):t.addClass("tabs-item-hide"),c=!!e),c}}]),a.controller("$ionicView",["$scope","$element","$attrs","$compile","$rootScope",function(e,t,n,i,o){function r(){var t=l(n.viewTitle)&&"viewTitle"||l(n.title)&&"title";t&&(a(n[t]),$.push(n.$observe(t,a))),l(n.hideBackButton)&&$.push(e.$watch(n.hideBackButton,function(e){f.showBackButton(!e)})),l(n.hideNavBar)&&$.push(e.$watch(n.hideNavBar,function(e){f.showBar(!e)}))}function a(e){l(e)&&e!==v&&(v=e,f.title(v))}function s(){for(var e=0;e<$.length;e++)$[e]();$=[]}function u(t){return t?i(t)(e.$new()):void 0}function d(t){return!!e.$eval(n[t])}var f,h,p,v,g=this,m={},$=[],w=e.$on("ionNavBar.init",function(e,t){e.stopPropagation(),h=t});g.init=function(){w();var n=t.inheritedData("$ionModalController");f=t.inheritedData("$ionNavViewController"),f&&!n&&(e.$on("$ionicView.beforeEnter",g.beforeEnter),e.$on("$ionicView.afterEnter",r),e.$on("$ionicView.beforeLeave",s))},g.beforeEnter=function(t,i){if(i&&!i.viewNotified){i.viewNotified=!0,o.$$phase||e.$digest(),v=l(n.viewTitle)?n.viewTitle:n.title;var r={};for(var a in m)r[a]=u(m[a]);f.beforeEnter(c(i,{title:v,showBack:!d("hideBackButton"),navBarItems:r,navBarDelegate:h||null,showNavBar:!d("hideNavBar"),hasHeaderBar:!!p})),s()}},g.navElement=function(e,t){m[e]=t}}]),a.directive("ionActionSheet",["$document",function(e){return{restrict:"E",scope:!0,replace:!0,link:function(t,n){var i=function(e){27==e.which&&(t.cancel(),t.$apply())},o=function(e){e.target==n[0]&&(t.cancel(),t.$apply())};t.$on("$destroy",function(){n.remove(),e.unbind("keyup",i)}),e.bind("keyup",i),n.bind("click",o)},template:'<div class="action-sheet-backdrop"><div class="action-sheet-wrapper"><div class="action-sheet" ng-class="{\'action-sheet-has-icons\': $actionSheetHasIcon}"><div class="action-sheet-group action-sheet-options"><div class="action-sheet-title" ng-if="titleText" ng-bind-html="titleText"></div><button class="button action-sheet-option" ng-click="buttonClicked($index)" ng-class="b.className" ng-repeat="b in buttons" ng-bind-html="b.text"></button><button class="button destructive action-sheet-destructive" ng-if="destructiveText" ng-click="destructiveButtonClicked()" ng-bind-html="destructiveText"></button></div><div class="action-sheet-group action-sheet-cancel" ng-if="cancelText"><button class="button" ng-click="cancel()" ng-bind-html="cancelText"></button></div></div></div></div>'}}]),a.directive("ionCheckbox",["$ionicConfig",function(e){return{restrict:"E",replace:!0,require:"?ngModel",transclude:!0,template:'<label class="item item-checkbox"><div class="checkbox checkbox-input-hidden disable-pointer-events"><input type="checkbox"><i class="checkbox-icon"></i></div><div class="item-content disable-pointer-events" ng-transclude></div></label>',compile:function(t,n){var i=t.find("input");s({name:n.name,"ng-value":n.ngValue,"ng-model":n.ngModel,"ng-checked":n.ngChecked,"ng-disabled":n.ngDisabled,"ng-true-value":n.ngTrueValue,"ng-false-value":n.ngFalseValue,"ng-change":n.ngChange,"ng-required":n.ngRequired,required:n.required},function(e,t){l(e)&&i.attr(t,e)});var o=t[0].querySelector(".checkbox");o.classList.add("checkbox-"+e.form.checkbox())}}}]),a.directive("collectionRepeat",e).factory("$ionicCollectionManager",t);var w="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",b=/height:.*?px;\s*width:.*?px/,y=3;e.$inject=["$ionicCollectionManager","$parse","$window","$$rAF","$rootScope","$timeout"],t.$inject=["$rootScope","$window","$$rAF"],a.directive("ionContent",["$timeout","$controller","$ionicBind","$ionicConfig",function(e,t,n,i){return{restrict:"E",require:"^?ionNavView",scope:!0,priority:800,compile:function(e,o){function r(e,i,r){function u(){e.$onScrollComplete({scrollTop:c.scrollView.__scrollTop,scrollLeft:c.scrollView.__scrollLeft})}var d=e.$parent;if(e.$watch(function(){return(d.$hasHeader?" has-header":"")+(d.$hasSubheader?" has-subheader":"")+(d.$hasFooter?" has-footer":"")+(d.$hasSubfooter?" has-subfooter":"")+(d.$hasTabs?" has-tabs":"")+(d.$hasTabsTop?" has-tabs-top":"")},function(e,t){i.removeClass(t),i.addClass(e)}),e.$hasHeader=e.$hasSubheader=e.$hasFooter=e.$hasSubfooter=e.$hasTabs=e.$hasTabsTop=!1,n(e,r,{$onScroll:"&onScroll",$onScrollComplete:"&onScrollComplete",hasBouncing:"@",padding:"@",direction:"@",scrollbarX:"@",scrollbarY:"@",startX:"@",startY:"@",scrollEventInterval:"@"}),e.direction=e.direction||"y",l(r.padding)&&e.$watch(r.padding,function(e){(a||i).toggleClass("padding",!!e)}),"false"===r.scroll);else{var f={};s?(i.addClass("overflow-scroll"),f={el:i[0],delegateHandle:o.delegateHandle,startX:e.$eval(e.startX)||0,startY:e.$eval(e.startY)||0,nativeScrolling:!0}):f={el:i[0],delegateHandle:o.delegateHandle,locking:"true"===(o.locking||"true"),bouncing:e.$eval(e.hasBouncing),startX:e.$eval(e.startX)||0,startY:e.$eval(e.startY)||0,scrollbarX:e.$eval(e.scrollbarX)!==!1,scrollbarY:e.$eval(e.scrollbarY)!==!1,scrollingX:e.direction.indexOf("x")>=0,scrollingY:e.direction.indexOf("y")>=0,scrollEventInterval:parseInt(e.scrollEventInterval,10)||10,scrollingComplete:u},c=t("$ionicScroll",{$scope:e,scrollViewOptions:f}),e.scrollCtrl=c,e.$on("$destroy",function(){f&&(f.scrollingComplete=h,delete f.el),a=null,i=null,o.$$element=null})}}var a,c;e.addClass("scroll-content ionic-scroll"),"false"!=o.scroll?(a=f('<div class="scroll"></div>'),a.append(e.contents()),e.append(a)):e.addClass("scroll-content-false");var s="false"!==o.overflowScroll&&("true"===o.overflowScroll||!i.scrolling.jsScrolling());return s&&(s=!e[0].querySelector("[collection-repeat]")),{pre:r}}}}]),a.directive("exposeAsideWhen",["$window",function(e){return{restrict:"A",require:"^ionSideMenus",link:function(t,n,i,o){function r(){var t="large"==i.exposeAsideWhen?"(min-width:768px)":i.exposeAsideWhen;o.exposeAside(e.matchMedia(t).matches),o.activeAsideResizing(!1)}function a(){o.activeAsideResizing(!0),l()}var c=e.innerWidth,s=e.innerHeight;ionic.on("resize",function(){(c!==e.innerWidth||s!==e.innerHeight)&&(c=e.innerWidth,s=e.innerHeight,a())},e);var l=ionic.debounce(function(){t.$apply(r)},300,!1);t.$evalAsync(r)}}}]);var S="onHold onTap onDoubleTap onTouch onRelease onDragStart onDrag onDragEnd onDragUp onDragRight onDragDown onDragLeft onSwipe onSwipeUp onSwipeRight onSwipeDown onSwipeLeft".split(" ");S.forEach(function(e){a.directive(e,n(e))}),a.directive("ionHeaderBar",i(!0)).directive("ionFooterBar",i(!1)),a.directive("ionInfiniteScroll",["$timeout",function(e){return{restrict:"E",require:["?^$ionicScroll","ionInfiniteScroll"],template:function(e,t){return t.icon?'<i class="icon {{icon()}} icon-refreshing {{scrollingType}}"></i>':'<ion-spinner icon="{{spinner()}}"></ion-spinner>'},scope:!0,controller:"$ionInfiniteScroll",link:function(t,n,i,o){var r=o[1],a=r.scrollCtrl=o[0],c=r.jsScrolling=!a.isNative();if(c)r.scrollView=a.scrollView,t.scrollingType="js-scrolling",a.$element.on("scroll",r.checkBounds);else{var s=ionic.DomUtil.getParentOrSelfWithClass(n[0].parentNode,"overflow-scroll");if(r.scrollEl=s,!s)throw"Infinite scroll must be used inside a scrollable div";r.scrollEl.addEventListener("scroll",r.checkBounds)}var u=l(i.immediateCheck)?t.$eval(i.immediateCheck):!0;u&&e(function(){r.checkBounds()})}}}]);var k=-1;a.directive("ionInput",[function(){return{restrict:"E",controller:["$scope","$element",function(e,t){this.$scope=e,this.$element=t,this.setInputAriaLabeledBy=function(e){var n=t[0].querySelectorAll("input,textarea");n.length&&n[0].setAttribute("aria-labelledby",e)},this.focus=function(){var e=t[0].querySelectorAll("input,textarea");e.length&&e[0].focus()}}]}}]),a.directive("ionLabel",[function(){return{restrict:"E",require:"?^ionInput",compile:function(){return function(e,t,n,i){var o=t[0];t.addClass("input-label"),t.attr("aria-label",t.text());
var r=o.id||"_label-"+ ++k;o.id||t.attr("id",r),i&&(i.setInputAriaLabeledBy(r),t.on("click",function(){i.focus()}))}}}}]),a.directive("inputLabel",[function(){return{restrict:"C",require:"?^ionInput",compile:function(){return function(e,t,n,i){var o=t[0];t.attr("aria-label",t.text());var r=o.id||"_label-"+ ++k;o.id||t.attr("id",r),i&&i.setInputAriaLabeledBy(r)}}}}]),a.directive("ionItem",["$$rAF",function(e){return{restrict:"E",controller:["$scope","$element",function(e,t){this.$scope=e,this.$element=t}],scope:!0,compile:function(t,n){var i=l(n.href)||l(n.ngHref)||l(n.uiSref),o=i||/ion-(delete|option|reorder)-button/i.test(t.html());if(o){var r=f(i?"<a></a>":"<div></div>");r.addClass("item-content"),(l(n.href)||l(n.ngHref))&&(r.attr("ng-href","{{$href()}}"),l(n.target)&&r.attr("target","{{$target()}}")),r.append(t.contents()),t.addClass("item item-complex").append(r)}else t.addClass("item");return function(t,n,i){t.$href=function(){return i.href||i.ngHref},t.$target=function(){return i.target};var o=n[0].querySelector(".item-content");o&&t.$on("$collectionRepeatLeave",function(){o&&o.$$ionicOptionsOpen&&(o.style[ionic.CSS.TRANSFORM]="",o.style[ionic.CSS.TRANSITION]="none",e(function(){o.style[ionic.CSS.TRANSITION]=""}),o.$$ionicOptionsOpen=!1)})}}}}]);var C='<div class="item-left-edit item-delete enable-pointer-events"></div>';a.directive("ionDeleteButton",function(){function e(e){e.stopPropagation()}return{restrict:"E",require:["^^ionItem","^?ionList"],priority:Number.MAX_VALUE,compile:function(t,n){return n.$set("class",(n["class"]||"")+" button icon button-icon",!0),function(t,n,i,o){function r(){c=c||n.controller("ionList"),c&&c.showDelete()&&s.addClass("visible active")}var a=o[0],c=o[1],s=f(C);s.append(n),a.$element.append(s).addClass("item-left-editable"),n.on("click",e),r(),t.$on("$ionic.reconnectScope",r)}}}}),a.directive("itemFloatingLabel",function(){return{restrict:"C",link:function(e,t){var n=t[0],i=n.querySelector("input, textarea"),o=n.querySelector(".input-label");if(i&&o){var r=function(){i.value?o.classList.add("has-input"):o.classList.remove("has-input")};i.addEventListener("input",r);var a=f(i).controller("ngModel");a&&(a.$render=function(){i.value=a.$viewValue||"",r()}),e.$on("$destroy",function(){i.removeEventListener("input",r)})}}}});var T='<div class="item-options invisible"></div>';a.directive("ionOptionButton",[function(){function e(e){e.stopPropagation()}return{restrict:"E",require:"^ionItem",priority:Number.MAX_VALUE,compile:function(t,n){return n.$set("class",(n["class"]||"")+" button",!0),function(t,n,i,o){o.optionsContainer||(o.optionsContainer=f(T),o.$element.append(o.optionsContainer)),o.optionsContainer.append(n),o.$element.addClass("item-right-editable"),n.on("click",e)}}}}]);var B='<div data-prevent-scroll="true" class="item-right-edit item-reorder enable-pointer-events"></div>';a.directive("ionReorderButton",["$parse",function(e){return{restrict:"E",require:["^ionItem","^?ionList"],priority:Number.MAX_VALUE,compile:function(t,n){return n.$set("class",(n["class"]||"")+" button icon button-icon",!0),t[0].setAttribute("data-prevent-scroll",!0),function(t,n,i,o){var r=o[0],a=o[1],c=e(i.onReorder);t.$onReorder=function(e,n){c(t,{$fromIndex:e,$toIndex:n})},i.ngClick||i.onClick||i.onclick||(n[0].onclick=function(e){return e.stopPropagation(),!1});var s=f(B);s.append(n),r.$element.append(s).addClass("item-right-editable"),a&&a.showReorder()&&s.addClass("visible active")}}}}]),a.directive("keyboardAttach",function(){return function(e,t){function n(e){if(!ionic.Platform.isAndroid()||ionic.Platform.isFullScreen){var n=e.keyboardHeight||e.detail&&e.detail.keyboardHeight;t.css("bottom",n+"px"),r=t.controller("$ionicScroll"),r&&(r.scrollView.__container.style.bottom=n+o(t[0])+"px")}}function i(){(!ionic.Platform.isAndroid()||ionic.Platform.isFullScreen)&&(t.css("bottom",""),r&&(r.scrollView.__container.style.bottom=""))}ionic.on("native.keyboardshow",n,window),ionic.on("native.keyboardhide",i,window),ionic.on("native.showkeyboard",n,window),ionic.on("native.hidekeyboard",i,window);var r;e.$on("$destroy",function(){ionic.off("native.keyboardshow",n,window),ionic.off("native.keyboardhide",i,window),ionic.off("native.showkeyboard",n,window),ionic.off("native.hidekeyboard",i,window)})}}),a.directive("ionList",["$timeout",function(e){return{restrict:"E",require:["ionList","^?$ionicScroll"],controller:"$ionicList",compile:function(t,n){var i=f('<div class="list">').append(t.contents()).addClass(n.type);return t.append(i),function(t,i,o,r){function a(){function o(e,t){t()&&e.addClass("visible")||e.removeClass("active"),ionic.requestAnimationFrame(function(){t()&&e.addClass("active")||e.removeClass("visible")})}var r=c.listView=new ionic.views.ListView({el:i[0],listEl:i.children()[0],scrollEl:s&&s.element,scrollView:s&&s.scrollView,onReorder:function(t,n,i){var o=f(t).scope();o&&o.$onReorder&&e(function(){o.$onReorder(n,i)})},canSwipe:function(){return c.canSwipeItems()}});t.$on("$destroy",function(){r&&(r.deregister&&r.deregister(),r=null)}),l(n.canSwipe)&&t.$watch("!!("+n.canSwipe+")",function(e){c.canSwipeItems(e)}),l(n.showDelete)&&t.$watch("!!("+n.showDelete+")",function(e){c.showDelete(e)}),l(n.showReorder)&&t.$watch("!!("+n.showReorder+")",function(e){c.showReorder(e)}),t.$watch(function(){return c.showDelete()},function(e,t){if(e||t){e&&c.closeOptionButtons(),c.canSwipeItems(!e),i.children().toggleClass("list-left-editing",e),i.toggleClass("disable-pointer-events",e);var n=f(i[0].getElementsByClassName("item-delete"));o(n,c.showDelete)}}),t.$watch(function(){return c.showReorder()},function(e,t){if(e||t){e&&c.closeOptionButtons(),c.canSwipeItems(!e),i.children().toggleClass("list-right-editing",e),i.toggleClass("disable-pointer-events",e);var n=f(i[0].getElementsByClassName("item-reorder"));o(n,c.showReorder)}})}var c=r[0],s=r[1];e(a)}}}}]),a.directive("menuClose",["$ionicHistory","$timeout",function(e,t){return{restrict:"AC",link:function(n,i){i.bind("click",function(){var n=i.inheritedData("$ionSideMenusController");n&&(e.nextViewOptions({historyRoot:!0,disableAnimate:!0,expire:300}),t(function(){e.nextViewOptions({historyRoot:!1,disableAnimate:!1})},300),n.close())})}}}]),a.directive("menuToggle",function(){return{restrict:"AC",link:function(e,t,n){e.$on("$ionicView.beforeEnter",function(e,n){if(n.enableBack){var i=t.inheritedData("$ionSideMenusController");i.enableMenuWithBackViews()||t.addClass("hide")}else t.removeClass("hide")}),t.bind("click",function(){var e=t.inheritedData("$ionSideMenusController");e&&e.toggle(n.menuToggle)})}}}),a.directive("ionModal",[function(){return{restrict:"E",transclude:!0,replace:!0,controller:[function(){}],template:'<div class="modal-backdrop"><div class="modal-backdrop-bg"></div><div class="modal-wrapper" ng-transclude></div></div>'}}]),a.directive("ionModalView",function(){return{restrict:"E",compile:function(e){e.addClass("modal")}}}),a.directive("ionNavBackButton",["$ionicConfig","$document",function(e,t){return{restrict:"E",require:"^ionNavBar",compile:function(n,i){function o(e){return/ion-|icon/.test(e.className)}var r=t[0].createElement("button");for(var a in i.$attr)r.setAttribute(i.$attr[a],i[a]);i.ngClick||r.setAttribute("ng-click","$ionicGoBack()"),r.className="button back-button hide buttons "+(n.attr("class")||""),r.innerHTML=n.html()||"";for(var c,s,l,u,d=o(n[0]),f=0;f<n[0].childNodes.length;f++)c=n[0].childNodes[f],1===c.nodeType?o(c)?d=!0:c.classList.contains("default-title")?l=!0:c.classList.contains("previous-title")&&(u=!0):s||3!==c.nodeType||(s=!!c.nodeValue.trim());var h=e.backButton.icon();if(!d&&h&&"none"!==h&&(r.innerHTML='<i class="icon '+h+'"></i> '+r.innerHTML,r.className+=" button-clear"),!s){var p=t[0].createElement("span");p.className="back-text",!l&&e.backButton.text()&&(p.innerHTML+='<span class="default-title">'+e.backButton.text()+"</span>"),!u&&e.backButton.previousTitleText()&&(p.innerHTML+='<span class="previous-title"></span>'),r.appendChild(p)}return n.attr("class","hide"),n.empty(),{pre:function(e,t,n,i){i.navElement("backButton",r.outerHTML),r=null}}}}}]),a.directive("ionNavBar",function(){return{restrict:"E",controller:"$ionicNavBar",scope:!0,link:function(e,t,n,i){i.init()}}}),a.directive("ionNavButtons",["$document",function(e){return{require:"^ionNavBar",restrict:"E",compile:function(t,n){var i="left";/^primary|secondary|right$/i.test(n.side||"")&&(i=n.side.toLowerCase());var o=e[0].createElement("span");o.className=i+"-buttons",o.innerHTML=t.html();var r=i+"Buttons";return t.attr("class","hide"),t.empty(),{pre:function(e,t,n,i){var a=t.parent().data("$ionViewController");a?a.navElement(r,o.outerHTML):i.navElement(r,o.outerHTML),o=null}}}}}]),a.directive("navDirection",["$ionicViewSwitcher",function(e){return{restrict:"A",priority:1e3,link:function(t,n,i){n.bind("click",function(){e.nextDirection(i.navDirection)})}}}]),a.directive("ionNavTitle",["$document",function(e){return{require:"^ionNavBar",restrict:"E",compile:function(t,n){var i="title",o=e[0].createElement("span");for(var r in n.$attr)o.setAttribute(n.$attr[r],n[r]);return o.classList.add("nav-bar-title"),o.innerHTML=t.html(),t.attr("class","hide"),t.empty(),{pre:function(e,t,n,r){var a=t.parent().data("$ionViewController");a?a.navElement(i,o.outerHTML):r.navElement(i,o.outerHTML),o=null}}}}}]),a.directive("navTransition",["$ionicViewSwitcher",function(e){return{restrict:"A",priority:1e3,link:function(t,n,i){n.bind("click",function(){e.nextTransition(i.navTransition)})}}}]),a.directive("ionNavView",["$state","$ionicConfig",function(e,t){return{restrict:"E",terminal:!0,priority:2e3,transclude:!0,controller:"$ionicNavView",compile:function(n,i,o){return n.addClass("view-container"),ionic.DomUtil.cachedAttr(n,"nav-view-transition",t.views.transition()),function(t,n,i,r){function a(t){var n=e.$current&&e.$current.locals[s.name];n&&(t||n!==c)&&(c=n,s.state=n.$$state,r.register(n))}var c;o(t,function(e){n.append(e)});var s=r.init();t.$on("$stateChangeSuccess",function(){a(!1)}),t.$on("$viewContentLoading",function(){a(!1)}),a(!0)}}}}]),a.config(["$provide",function(e){e.decorator("ngClickDirective",["$delegate",function(e){return e.shift(),e}])}]).factory("$ionicNgClick",["$parse",function(e){return function(t,n,i){var o=angular.isFunction(i)?i:e(i);n.on("click",function(e){t.$apply(function(){o(t,{$event:e})})}),n.onclick=h}}]).directive("ngClick",["$ionicNgClick",function(e){return function(t,n,i){e(t,n,i.ngClick)}}]).directive("ionStopEvent",function(){return{restrict:"A",link:function(e,t,n){t.bind(n.ionStopEvent,r)}}}),a.directive("ionPane",function(){return{restrict:"E",link:function(e,t){t.addClass("pane")}}}),a.directive("ionPopover",[function(){return{restrict:"E",transclude:!0,replace:!0,controller:[function(){}],template:'<div class="popover-backdrop"><div class="popover-wrapper" ng-transclude></div></div>'}}]),a.directive("ionPopoverView",function(){return{restrict:"E",compile:function(e){e.append(f('<div class="popover-arrow">')),e.addClass("popover")}}}),a.directive("ionRadio",function(){return{restrict:"E",replace:!0,require:"?ngModel",transclude:!0,template:'<label class="item item-radio"><input type="radio" name="radio-group"><div class="radio-content"><div class="item-content disable-pointer-events" ng-transclude></div><i class="radio-icon disable-pointer-events icon ion-checkmark"></i></div></label>',compile:function(e,t){if(t.icon){var n=e.find("i");n.removeClass("ion-checkmark").addClass(t.icon)}var i=e.find("input");return s({name:t.name,value:t.value,disabled:t.disabled,"ng-value":t.ngValue,"ng-model":t.ngModel,"ng-disabled":t.ngDisabled,"ng-change":t.ngChange,"ng-required":t.ngRequired,required:t.required},function(e,t){l(e)&&i.attr(t,e)}),function(e,t,n){e.getValue=function(){return e.ngValue||n.value}}}}}),a.directive("ionRefresher",[function(){return{restrict:"E",replace:!0,require:["?^$ionicScroll","ionRefresher"],controller:"$ionicRefresher",template:'<div class="scroll-refresher invisible" collection-repeat-ignore><div class="ionic-refresher-content" ng-class="{\'ionic-refresher-with-text\': pullingText || refreshingText}"><div class="icon-pulling" ng-class="{\'pulling-rotation-disabled\':disablePullingRotation}"><i class="icon {{pullingIcon}}"></i></div><div class="text-pulling" ng-bind-html="pullingText"></div><div class="icon-refreshing"><ion-spinner ng-if="showSpinner" icon="{{spinner}}"></ion-spinner><i ng-if="showIcon" class="icon {{refreshingIcon}}"></i></div><div class="text-refreshing" ng-bind-html="refreshingText"></div></div></div>',link:function(e,t,n,i){var o=i[0],r=i[1];!o||o.isNative()?r.init():(t[0].classList.add("js-scrolling"),o._setRefresher(e,t[0],r.getRefresherDomMethods()),e.$on("scroll.refreshComplete",function(){e.$evalAsync(function(){o.scrollView.finishPullToRefresh()})}))}}}]),a.directive("ionScroll",["$timeout","$controller","$ionicBind","$ionicConfig",function(e,t,n,i){return{restrict:"E",scope:!0,controller:function(){},compile:function(e,o){function r(e,i,o){n(e,o,{direction:"@",paging:"@",$onScroll:"&onScroll",scroll:"@",scrollbarX:"@",scrollbarY:"@",zooming:"@",minZoom:"@",maxZoom:"@"}),e.direction=e.direction||"y",l(o.padding)&&e.$watch(o.padding,function(e){a.toggleClass("padding",!!e)}),e.$eval(e.paging)===!0&&a.addClass("scroll-paging"),e.direction||(e.direction="y");var r=e.$eval(e.paging)===!0;c&&i.addClass("overflow-scroll"),i.addClass("scroll-"+e.direction);var s={el:i[0],delegateHandle:o.delegateHandle,locking:"true"===(o.locking||"true"),bouncing:e.$eval(o.hasBouncing),paging:r,scrollbarX:e.$eval(e.scrollbarX)!==!1,scrollbarY:e.$eval(e.scrollbarY)!==!1,scrollingX:e.direction.indexOf("x")>=0,scrollingY:e.direction.indexOf("y")>=0,zooming:e.$eval(e.zooming)===!0,maxZoom:e.$eval(e.maxZoom)||3,minZoom:e.$eval(e.minZoom)||.5,preventDefault:!0,nativeScrolling:c};r&&(s.speedMultiplier=.8,s.bouncing=!1),t("$ionicScroll",{$scope:e,scrollViewOptions:s})}e.addClass("scroll-view ionic-scroll");var a=f('<div class="scroll"></div>');a.append(e.contents()),e.append(a);var c="false"!==o.overflowScroll&&("true"===o.overflowScroll||!i.scrolling.jsScrolling());return{pre:r}}}}]),a.directive("ionSideMenu",function(){return{restrict:"E",require:"^ionSideMenus",scope:!0,compile:function(e,t){return angular.isUndefined(t.isEnabled)&&t.$set("isEnabled","true"),angular.isUndefined(t.width)&&t.$set("width","275"),e.addClass("menu menu-"+t.side),function(e,n,i,o){e.side=i.side||"left";var r=o[e.side]=new ionic.views.SideMenu({width:t.width,el:n[0],isEnabled:!0});e.$watch(i.width,function(e){var t=+e;t&&t==e&&r.setWidth(+e)}),e.$watch(i.isEnabled,function(e){r.setIsEnabled(!!e)})}}}}),a.directive("ionSideMenuContent",["$timeout","$ionicGesture","$window",function(e,t,n){return{restrict:"EA",require:"^ionSideMenus",scope:!0,compile:function(i,o){function r(r,a,c,s){function u(e){0!==s.getOpenAmount()?(s.close(),e.gesture.srcEvent.preventDefault(),v=null,g=null):v||(v=ionic.tap.pointerCoord(e.gesture.srcEvent))}function d(e){s.isDraggableTarget(e)&&"x"==p(e)&&(s._handleDrag(e),e.gesture.srcEvent.preventDefault())}function f(e){"x"==p(e)&&e.gesture.srcEvent.preventDefault()}function h(e){s._endDrag(e),v=null,g=null}function p(e){if(g)return g;if(e&&e.gesture){if(v){var t=ionic.tap.pointerCoord(e.gesture.srcEvent),n=Math.abs(t.x-v.x),i=Math.abs(t.y-v.y),o=i>n?"y":"x";return Math.max(n,i)>30&&(g=o),o}v=ionic.tap.pointerCoord(e.gesture.srcEvent)}return"y"}var v=null,g=null;l(o.dragContent)?r.$watch(o.dragContent,function(e){s.canDragContent(e)}):s.canDragContent(!0),l(o.edgeDragThreshold)&&r.$watch(o.edgeDragThreshold,function(e){s.edgeDragThreshold(e)});var m={element:i[0],onDrag:function(){},endDrag:function(){},setCanScroll:function(e){var t=a[0].querySelector(".scroll");if(t){var n=angular.element(t.parentElement);if(n){var i=n.scope();i.scrollCtrl&&i.scrollCtrl.freezeScrollShut(!e)}}},getTranslateX:function(){return r.sideMenuContentTranslateX||0},setTranslateX:ionic.animationFrameThrottle(function(t){var n=m.offsetX+t;a[0].style[ionic.CSS.TRANSFORM]="translate3d("+n+"px,0,0)",e(function(){r.sideMenuContentTranslateX=t})}),setMarginLeft:ionic.animationFrameThrottle(function(e){e?(e=parseInt(e,10),a[0].style[ionic.CSS.TRANSFORM]="translate3d("+e+"px,0,0)",a[0].style.width=n.innerWidth-e+"px",m.offsetX=e):(a[0].style[ionic.CSS.TRANSFORM]="translate3d(0,0,0)",a[0].style.width="",m.offsetX=0)}),setMarginRight:ionic.animationFrameThrottle(function(e){e?(e=parseInt(e,10),a[0].style.width=n.innerWidth-e+"px",m.offsetX=e):(a[0].style.width="",m.offsetX=0),a[0].style[ionic.CSS.TRANSFORM]="translate3d(0,0,0)"}),setMarginLeftAndRight:ionic.animationFrameThrottle(function(e,t){e=e&&parseInt(e,10)||0,t=t&&parseInt(t,10)||0;var i=e+t;i>0?(a[0].style[ionic.CSS.TRANSFORM]="translate3d("+e+"px,0,0)",a[0].style.width=n.innerWidth-i+"px",m.offsetX=e):(a[0].style[ionic.CSS.TRANSFORM]="translate3d(0,0,0)",a[0].style.width="",m.offsetX=0)}),enableAnimation:function(){r.animationEnabled=!0,a[0].classList.add("menu-animated")},disableAnimation:function(){r.animationEnabled=!1,a[0].classList.remove("menu-animated")},offsetX:0};s.setContent(m);var $={stop_browser_behavior:!1};$.prevent_default_directions=["left","right"];var w=t.on("tap",u,a,$),b=t.on("dragright",d,a,$),y=t.on("dragleft",d,a,$),S=t.on("dragup",f,a,$),k=t.on("dragdown",f,a,$),C=t.on("release",h,a,$);r.$on("$destroy",function(){m&&(m.element=null,m=null),t.off(y,"dragleft",d),t.off(b,"dragright",d),t.off(S,"dragup",f),t.off(k,"dragdown",f),t.off(C,"release",h),t.off(w,"tap",u)})}return i.addClass("menu-content pane"),{pre:r}}}}]),a.directive("ionSideMenus",["$ionicBody",function(e){return{restrict:"ECA",controller:"$ionicSideMenus",compile:function(t,n){function i(t,n,i,o){o.enableMenuWithBackViews(t.$eval(i.enableMenuWithBackViews)),t.$on("$ionicExposeAside",function(n,i){t.$exposeAside||(t.$exposeAside={}),t.$exposeAside.active=i,e.enableClass(i,"aside-open")}),t.$on("$ionicView.beforeEnter",function(e,n){n.historyId&&(t.$activeHistoryId=n.historyId)}),t.$on("$destroy",function(){e.removeClass("menu-open","aside-open")})}return n.$set("class",(n["class"]||"")+" view"),{pre:i}}}}]),a.directive("ionSlideBox",["$animate","$timeout","$compile","$ionicSlideBoxDelegate","$ionicHistory","$ionicScrollDelegate",function(e,t,n,i,o,r){return{restrict:"E",replace:!0,transclude:!0,scope:{autoPlay:"=",doesContinue:"@",slideInterval:"@",showPager:"@",pagerClick:"&",disableScroll:"@",onSlideChanged:"&",activeSlide:"=?",bounce:"@"},controller:["$scope","$element","$attrs",function(e,n,a){function c(e){e&&!s.isScrollFreeze?r.freezeAllScrolls(e):!e&&s.isScrollFreeze&&r.freezeAllScrolls(!1),s.isScrollFreeze=e}var s=this,u=e.$eval(e.doesContinue)===!0,d=e.$eval(e.bounce)!==!1,f=l(a.autoPlay)?!!e.autoPlay:!1,h=f?e.$eval(e.slideInterval)||4e3:0,p=new ionic.views.Slider({el:n[0],auto:h,continuous:u,startSlide:e.activeSlide,bouncing:d,slidesChanged:function(){e.currentSlide=p.currentIndex(),t(function(){})},callback:function(n){e.currentSlide=n,e.onSlideChanged({index:e.currentSlide,$index:e.currentSlide}),e.$parent.$broadcast("slideBox.slideChanged",n),e.activeSlide=n,t(function(){})},onDrag:function(){c(!0)},onDragEnd:function(){c(!1)}});p.enableSlide(e.$eval(a.disableScroll)!==!0),e.$watch("activeSlide",function(e){l(e)&&p.slide(e)}),e.$on("slideBox.nextSlide",function(){p.next()}),e.$on("slideBox.prevSlide",function(){p.prev()}),e.$on("slideBox.setSlide",function(e,t){p.slide(t)}),this.__slider=p;var v=i._registerInstance(p,a.delegateHandle,function(){return o.isActiveScope(e)});e.$on("$destroy",function(){v(),p.kill()}),this.slidesCount=function(){return p.slidesCount()},this.onPagerClick=function(t){e.pagerClick({index:t})},t(function(){p.load()})}],template:'<div class="slider"><div class="slider-slides" ng-transclude></div></div>',link:function(t,i,o){function r(){if(!a){var e=t.$new();a=f("<ion-pager></ion-pager>"),i.append(a),a=n(a)(e)}return a}e.enabled(i,!1),l(o.showPager)||(t.showPager=!0,r().toggleClass("hide",!1)),o.$observe("showPager",function(e){void 0!==e&&(e=t.$eval(e),r().toggleClass("hide",!e))});var a}}}]).directive("ionSlide",function(){return{restrict:"E",require:"?^ionSlideBox",compile:function(e){e.addClass("slider-slide")}}}).directive("ionPager",function(){return{restrict:"E",replace:!0,require:"^ionSlideBox",template:'<div class="slider-pager"><span class="slider-pager-page" ng-repeat="slide in numSlides() track by $index" ng-class="{active: $index == currentSlide}" ng-click="pagerClick($index)"><i class="icon ion-record"></i></span></div>',link:function(e,t,n,i){var o=function(e){for(var n=t[0].children,i=n.length,o=0;i>o;o++)o==e?n[o].classList.add("active"):n[o].classList.remove("active")};e.pagerClick=function(e){i.onPagerClick(e)},e.numSlides=function(){return new Array(i.slidesCount())},e.$watch("currentSlide",function(e){o(e)})}}}),a.directive("ionSlides",["$animate","$timeout","$compile",function(e,t,n){return{restrict:"E",transclude:!0,scope:{options:"=",slider:"="},template:'<div class="swiper-container"><div class="swiper-wrapper" ng-transclude></div><div ng-hide="!showPager" class="swiper-pagination"></div></div>',controller:["$scope","$element",function(e,i){var o=this,r=null,a=null,c=null,s=null,l=null;this.update=function(){t(function(){if(o.__slider){o.__slider.update(),o._options.loop&&o.__slider.createLoop();var t=o.__slider.slides.length;t>10&&(e.showPager=!1),o.__slider.activeIndex>t-1&&o.__slider.slideTo(t-1)}})},this.rapidUpdate=ionic.debounce(function(){o.update()},50),this.updateLoop=ionic.debounce(function(){o._options.loop&&o.__slider.updateLoop()},50),this.watchForChanges=function(){r||(r=e.$watch(function(){o.updateLoop()}))},this.stopWatching=function(){r&&(r(),r=null)},this.cleanUpEventHandlers=function(){a&&(a(),a=null),c&&(c(),c=null),s&&(s(),s=null),l&&(l(),l=null)},this.getSlider=function(){return o.__slider};var u=e.options||{},d=angular.extend({pagination:i.children().children()[1],paginationClickable:!0,lazyLoading:!0,preloadImages:!1},u);this._options=d,t(function(){var t=new ionic.views.Swiper(i.children()[0],d,e,n);o.__slider=t,e.slider=o.__slider,e.$on("$destroy",function(){t.destroy(),o.__slider=null,o.stopWatching(),o.cleanUpEventHandlers()}),o.watchForChanges(),a=e.$on("$ionicView.enter",function(){o.watchForChanges()}),c=e.$on("$ionicView.afterLeave",function(){o.stopWatching()}),s=e.$on("$ionic.modalRemoved",function(){o.stopWatching()}),l=e.$on("$ionic.modalPresented",function(){o.watchForChanges()})})}],link:function(e){e.showPager=!0}}}]).directive("ionSlidePage",[function(){return{restrict:"E",require:"?^ionSlides",transclude:!0,replace:!0,template:'<div class="swiper-slide" ng-transclude></div>',link:function(e,t,n,i){i.rapidUpdate(),e.$on("$destroy",function(){i.rapidUpdate()})}}}]),a.directive("ionSpinner",function(){return{restrict:"E",controller:"$ionicSpinner",link:function(e,t,n,i){var o=i.init();t.addClass("spinner spinner-"+o),t.on("$destroy",function(){i.stop()})}}}),a.directive("ionTab",["$compile","$ionicConfig","$ionicBind","$ionicViewSwitcher",function(e,t,n,i){function o(e,t){return l(t)?" "+e+'="'+t+'"':""}return{restrict:"E",require:["^ionTabs","ionTab"],controller:"$ionicTab",scope:!0,compile:function(r,a){for(var c="<ion-tab-nav"+o("ng-click",a.ngClick)+o("title",a.title)+o("icon",a.icon)+o("icon-on",a.iconOn)+o("icon-off",a.iconOff)+o("badge",a.badge)+o("badge-style",a.badgeStyle)+o("hidden",a.hidden)+o("disabled",a.disabled)+o("class",a["class"])+"></ion-tab-nav>",s=document.createElement("div"),l=0;l<r[0].children.length;l++)s.appendChild(r[0].children[l].cloneNode(!0));var u=s.childElementCount;r.empty();var d,h;return u&&("ION-NAV-VIEW"===s.children[0].tagName&&(d=s.children[0].getAttribute("name"),s.children[0].classList.add("view-container"),h=!0),1===u&&(s=s.children[0]),h||s.classList.add("pane"),s.classList.add("tab-content")),function(o,r,a,l){function h(){w.tabMatchesState()&&$.select(o,!1)}function p(n){n&&u?(b||(g=o.$new(),m=f(s),i.viewEleIsActive(m,!0),$.$element.append(m),e(m)(g),b=!0),i.viewEleIsActive(m,!0)):b&&m&&(t.views.maxCache()>0?i.viewEleIsActive(m,!1):v())}function v(){g&&g.$destroy(),b&&m&&m.remove(),s.innerHTML="",b=g=m=null}var g,m,$=l[0],w=l[1],b=!1;o.$tabSelected=!1,n(o,a,{onSelect:"&",onDeselect:"&",title:"@",uiSref:"@",href:"@"}),$.add(o),o.$on("$destroy",function(){o.$tabsDestroy||$.remove(o),y.isolateScope().$destroy(),y.remove(),y=s=m=null}),r[0].removeAttribute("title"),d&&(w.navViewName=o.navViewName=d),o.$on("$stateChangeSuccess",h),h();var y=f(c);y.data("$ionTabsController",$),y.data("$ionTabController",w),$.$tabsElement.append(e(y)(o)),o.$watch("$tabSelected",p),o.$on("$ionicView.afterEnter",function(){i.viewEleIsActive(m,o.$tabSelected)}),o.$on("$ionicView.clearCache",function(){o.$tabSelected||v()})}}}}]),a.directive("ionTabNav",[function(){return{restrict:"E",replace:!0,require:["^ionTabs","^ionTab"],template:'<a ng-class="{\'has-badge\':badge, \'tab-hidden\':isHidden()}"  ng-disabled="disabled()" class="tab-item"><span class="badge {{badgeStyle}}" ng-if="badge">{{badge}}</span><i class="icon"></i><span class="tab-title" ng-bind-html="title"></span></a>',scope:{title:"@",icon:"@",iconOn:"@",iconOff:"@",badge:"=",hidden:"@",disabled:"&",badgeStyle:"@","class":"@"},link:function(e,t,n,i){function o(){r.selectedTab()===a.$scope?(t.addClass("tab-item-active"),t.find("i").removeClass(e.getIconOff()),t.find("i").addClass(e.getIconOn())):(t.removeClass("tab-item-active"),t.find("i").removeClass(e.getIconOn()),t.find("i").addClass(e.getIconOff()))}var r=i[0],a=i[1];t[0].removeAttribute("title"),e.selectTab=function(e){e.preventDefault(),r.select(a.$scope,!0)},n.ngClick||t.on("click",function(t){e.$apply(function(){e.selectTab(t)})}),e.isHidden=function(){return"true"===n.hidden||n.hidden===!0?!0:!1},e.getIconOn=function(){return e.iconOn||e.icon},e.getIconOff=function(){return e.iconOff||e.icon},e.isTabActive=function(){return r.selectedTab()===a.$scope},e.$watch("icon",function(){o()}),e.$watch("iconOff",function(){o()}),e.$watch("iconOn",function(){o()}),e.$on("tabSelected",o),o()}}}]),a.directive("ionTabs",["$ionicTabsDelegate","$ionicConfig",function(e,t){return{restrict:"E",scope:!0,controller:"$ionicTabs",compile:function(n){function i(t,n,i,o){function a(e,t){e.stopPropagation();var n=o.previousSelectedTab();n&&n.$broadcast(e.name.replace("NavView","Tabs"),t)}var c=e._registerInstance(o,i.delegateHandle,o.hasActiveScope);o.$scope=t,o.$element=n,o.$tabsElement=f(n[0].querySelector(".tabs")),t.$watch(function(){return n[0].className},function(e){var n=-1!==e.indexOf("tabs-top"),i=-1!==e.indexOf("tabs-item-hide");t.$hasTabs=!n&&!i,t.$hasTabsTop=n&&!i,t.$emit("$ionicTabs.top",t.$hasTabsTop)}),t.$on("$ionicNavView.beforeLeave",a),t.$on("$ionicNavView.afterLeave",a),t.$on("$ionicNavView.leave",a),t.$on("$destroy",function(){t.$tabsDestroy=!0,c(),o.$tabsElement=o.$element=o.$scope=r=null,delete t.$hasTabs,delete t.$hasTabsTop})}function o(e,t,n,i){i.selectedTab()||i.select(0)}var r=f('<div class="tab-nav tabs">');return r.append(n.contents()),n.append(r).addClass("tabs-"+t.tabs.position()+" tabs-"+t.tabs.style()),{pre:i,post:o}}}}]),a.directive("ionTitle",[function(){return{restrict:"E",compile:function(e){e.addClass("title")}}}]),a.directive("ionToggle",["$timeout","$ionicConfig",function(e,t){return{restrict:"E",replace:!0,require:"?ngModel",transclude:!0,template:'<div class="item item-toggle"><div ng-transclude></div><label class="toggle"><input type="checkbox"><div class="track"><div class="handle"></div></div></label></div>',compile:function(e,n){var i=e.find("input");return s({name:n.name,"ng-value":n.ngValue,"ng-model":n.ngModel,"ng-checked":n.ngChecked,"ng-disabled":n.ngDisabled,"ng-true-value":n.ngTrueValue,"ng-false-value":n.ngFalseValue,"ng-change":n.ngChange,"ng-required":n.ngRequired,required:n.required},function(e,t){l(e)&&i.attr(t,e)}),n.toggleClass&&e[0].getElementsByTagName("label")[0].classList.add(n.toggleClass),e.addClass("toggle-"+t.form.toggle()),function(e,t){var n=t[0].getElementsByTagName("label")[0],i=n.children[0],o=n.children[1],r=o.children[0],a=f(i).controller("ngModel");e.toggle=new ionic.views.Toggle({el:n,track:o,checkbox:i,handle:r,onChange:function(){a&&(a.$setViewValue(i.checked),e.$apply())}}),e.$on("$destroy",function(){e.toggle.destroy()})}}}}]),a.directive("ionView",function(){return{restrict:"EA",priority:1e3,controller:"$ionicView",compile:function(e){return e.addClass("pane"),e[0].removeAttribute("title"),function(e,t,n,i){i.init()}}}})}();


/**
 * Restful Resources service for AngularJS apps
 * @version v1.4.0 - 2014-04-25 * @link https://github.com/mgonto/restangular
 * @author Martin Gontovnikas <martin@gon.to>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */(function() {

var module = angular.module('restangular', []);

module.provider('Restangular', function() {
        // Configuration
        var Configurer = {};
        Configurer.init = function(object, config) {
            /**
             * Those are HTTP safe methods for which there is no need to pass any data with the request.
             */

            object.configuration = config;

            var safeMethods= ["get", "head", "options", "trace", "getlist"];
            config.isSafe = function(operation) {
              return _.contains(safeMethods, operation.toLowerCase());
            };

            var absolutePattern = /^https?:\/\//i;
            config.isAbsoluteUrl = function(string) {
              return _.isUndefined(config.absoluteUrl) || _.isNull(config.absoluteUrl) ?
                      string && absolutePattern.test(string) :
                      config.absoluteUrl;
            };

            config.absoluteUrl = _.isUndefined(config.absoluteUrl) ? true : config.absoluteUrl;
            object.setSelfLinkAbsoluteUrl = function(value) {
                config.absoluteUrl = value;
            };
            /**
             * This is the BaseURL to be used with Restangular
             */
            config.baseUrl = _.isUndefined(config.baseUrl) ? "" : config.baseUrl;
            object.setBaseUrl = function(newBaseUrl) {
                config.baseUrl = /\/$/.test(newBaseUrl)
                  ? newBaseUrl.substring(0, newBaseUrl.length-1)
                  : newBaseUrl;
                return this;
            };

            /**
             * Sets the extra fields to keep from the parents
             */
            config.extraFields = config.extraFields || [];
            object.setExtraFields = function(newExtraFields) {
              config.extraFields = newExtraFields;
              return this;
            };

            /**
             * Some default $http parameter to be used in EVERY call
            **/
            config.defaultHttpFields = config.defaultHttpFields || {};
            object.setDefaultHttpFields = function(values) {
              config.defaultHttpFields = values;
              return this;
            };

            config.withHttpValues = function(httpLocalConfig, obj) {
              return _.defaults(obj, httpLocalConfig, config.defaultHttpFields);
            };

            config.encodeIds = _.isUndefined(config.encodeIds) ? true : config.encodeIds;
            object.setEncodeIds = function(encode) {
                config.encodeIds = encode;
            };

            config.defaultRequestParams = config.defaultRequestParams || {
                get: {},
                post: {},
                put: {},
                remove: {},
                common: {}
            };

            object.setDefaultRequestParams = function(param1, param2) {
              var methods = [],
                  params = param2 || param1;
              if (!_.isUndefined(param2)) {
                if (_.isArray(param1)) {
                  methods = param1;
                } else {
                  methods.push(param1);
                }
              } else {
                methods.push('common');
              }

              _.each(methods, function (method) {
                config.defaultRequestParams[method] = params;
              });
              return this;
            };

            object.requestParams = config.defaultRequestParams;


            config.defaultHeaders = config.defaultHeaders || {};
            object.setDefaultHeaders = function(headers) {
              config.defaultHeaders = headers;
              object.defaultHeaders = config.defaultHeaders;
              return this;
            };

            object.defaultHeaders = config.defaultHeaders;

            /**
             * Method overriders will set which methods are sent via POST with an X-HTTP-Method-Override
             **/
            config.methodOverriders = config.methodOverriders || [];
            object.setMethodOverriders = function(values) {
              var overriders = _.extend([], values);
              if (config.isOverridenMethod('delete', overriders)) {
                overriders.push("remove");
              }
              config.methodOverriders = overriders;
              return this;
            };

            config.jsonp = _.isUndefined(config.jsonp) ? false : config.jsonp;
            object.setJsonp = function(active) {
              config.jsonp = active;
            };

            config.isOverridenMethod = function(method, values) {
              var search = values || config.methodOverriders;
              return !_.isUndefined(_.find(search, function(one) {
                return one.toLowerCase() === method.toLowerCase();
              }));
            };

            /**
             * Sets the URL creator type. For now, only Path is created. In the future we'll have queryParams
            **/
            config.urlCreator = config.urlCreator || "path";
            object.setUrlCreator = function(name) {
              if (!_.has(config.urlCreatorFactory, name)) {
                  throw new Error("URL Path selected isn't valid");
              }

              config.urlCreator = name;
              return this;
            };

            /**
             * You can set the restangular fields here. The 3 required fields for Restangular are:
             *
             * id: Id of the element
             * route: name of the route of this element
             * parentResource: the reference to the parent resource
             *
             *  All of this fields except for id, are handled (and created) by Restangular. By default,
             *  the field values will be id, route and parentResource respectively
             */
            config.restangularFields = config.restangularFields || {
                id: "id",
                route: "route",
                parentResource: "parentResource",
                restangularCollection: "restangularCollection",
                cannonicalId: "__cannonicalId",
                etag: "restangularEtag",
                selfLink: "href",
                get: "get",
                getList: "getList",
                put: "put",
                post: "post",
                remove: "remove",
                head: "head",
                trace: "trace",
                options: "options",
                patch: "patch",
                getRestangularUrl: "getRestangularUrl",
                getRequestedUrl: "getRequestedUrl",
                putElement: "putElement",
                addRestangularMethod: "addRestangularMethod",
                getParentList: "getParentList",
                clone: "clone",
                ids: "ids",
                httpConfig: '_$httpConfig',
                reqParams: 'reqParams',
                one: 'one',
                all: 'all',
                several: 'several',
                oneUrl: 'oneUrl',
                allUrl: 'allUrl',
                customPUT: 'customPUT',
                customPOST: 'customPOST',
                customDELETE: 'customDELETE',
                customGET: 'customGET',
                customGETLIST: 'customGETLIST',
                customOperation: 'customOperation',
                doPUT: 'doPUT',
                doPOST: 'doPOST',
                doDELETE: 'doDELETE',
                doGET: 'doGET',
                doGETLIST: 'doGETLIST',
                fromServer: 'fromServer',
                withConfig: 'withConfig',
                withHttpConfig: 'withHttpConfig',
                singleOne: 'singleOne',
                plain: 'plain',
                save: 'save'
            };
            object.setRestangularFields = function(resFields) {
                config.restangularFields =
                  _.extend(config.restangularFields, resFields);
                return this;
            };

            config.isRestangularized = function(obj) {
              return !!obj[config.restangularFields.one] || !!obj[config.restangularFields.all];
            };

            config.setFieldToElem = function(field, elem, value) {
              var properties = field.split('.');
              var idValue = elem;
              _.each(_.initial(properties), function(prop) {
                idValue[prop] = {};
                idValue = idValue[prop];
              });
              idValue[_.last(properties)] = value;
              return this;
            };

            config.getFieldFromElem = function(field, elem) {
              var properties = field.split('.');
              var idValue = elem;
              _.each(properties, function(prop) {
                if (idValue) {
                  idValue = idValue[prop];
                }
              });
              return angular.copy(idValue);
            };

            config.setIdToElem = function(elem, id) {
              config.setFieldToElem(config.restangularFields.id, elem, id);
              return this;
            };

            config.getIdFromElem = function(elem) {
              return config.getFieldFromElem(config.restangularFields.id, elem);
            };

            config.isValidId = function(elemId) {
                return "" !== elemId && !_.isUndefined(elemId) && !_.isNull(elemId);
            };

            config.setUrlToElem = function(elem, url, route) {
              config.setFieldToElem(config.restangularFields.selfLink, elem, url);
              return this;
            };

            config.getUrlFromElem = function(elem) {
              return config.getFieldFromElem(config.restangularFields.selfLink, elem);
            };

            config.useCannonicalId = _.isUndefined(config.useCannonicalId) ? false : config.useCannonicalId;
            object.setUseCannonicalId = function(value) {
                config.useCannonicalId = value;
                return this;
            };

            config.getCannonicalIdFromElem = function(elem) {
              var cannonicalId = elem[config.restangularFields.cannonicalId];
              var actualId = config.isValidId(cannonicalId) ?
                  cannonicalId : config.getIdFromElem(elem);
              return actualId;
            };

            /**
             * Sets the Response parser. This is used in case your response isn't directly the data.
             * For example if you have a response like {meta: {'meta'}, data: {name: 'Gonto'}}
             * you can extract this data which is the one that needs wrapping
             *
             * The ResponseExtractor is a function that receives the response and the method executed.
             */

            config.responseInterceptors = config.responseInterceptors || [];

            config.defaultResponseInterceptor = function(data, operation,
                    what, url, response, deferred) {
                return data;
            };

            config.responseExtractor = function(data, operation,
                    what, url, response, deferred) {
                var interceptors = angular.copy(config.responseInterceptors);
                interceptors.push(config.defaultResponseInterceptor);
                var theData = data;
                _.each(interceptors, function(interceptor) {
                  theData = interceptor(theData, operation,
                    what, url, response, deferred);
                });
                return theData;
            };

            object.addResponseInterceptor = function(extractor) {
              config.responseInterceptors.push(extractor);
              return this;
            };

            object.setResponseInterceptor = object.addResponseInterceptor;
            object.setResponseExtractor = object.addResponseInterceptor;

            /**
             * Response interceptor is called just before resolving promises.
             */


            /**
             * Request interceptor is called before sending an object to the server.
             */
             config.requestInterceptors = config.requestInterceptors || [];

             config.defaultInterceptor = function(element, operation,
              path, url, headers, params, httpConfig) {
                return {
                  element: element,
                  headers: headers,
                  params: params,
                  httpConfig: httpConfig
                };
              };

            config.fullRequestInterceptor = function(element, operation,
              path, url, headers, params, httpConfig) {
                var interceptors = angular.copy(config.requestInterceptors);
                var defaultRequest = config.defaultInterceptor(element, operation, path, url, headers, params, httpConfig);
                return _.reduce(interceptors, function(request, interceptor) {
                  return _.extend(request, interceptor(request.element, operation,
                    path, url, request.headers, request.params, request.httpConfig));
                }, defaultRequest);
            };

            object.addRequestInterceptor = function(interceptor) {
              config.requestInterceptors.push(function(elem, operation, path, url, headers, params, httpConfig) {
                return {
                  headers: headers,
                  params: params,
                  element: interceptor(elem, operation, path, url),
                  httpConfig: httpConfig
                };
              });
              return this;
            };

            object.setRequestInterceptor = object.addRequestInterceptor;

            object.addFullRequestInterceptor = function(interceptor) {
              config.requestInterceptors.push(interceptor);
              return this;
            };

            object.setFullRequestInterceptor = object.addFullRequestInterceptor;

            config.errorInterceptor = config.errorInterceptor || function() {};

            object.setErrorInterceptor = function(interceptor) {
              config.errorInterceptor = interceptor;
              return this;
            };

            config.onBeforeElemRestangularized = config.onBeforeElemRestangularized || function(elem) {
              return elem;
            };
            object.setOnBeforeElemRestangularized = function(post) {
              config.onBeforeElemRestangularized = post;
              return this;
            };

            /**
             * This method is called after an element has been "Restangularized".
             *
             * It receives the element, a boolean indicating if it's an element or a collection
             * and the name of the model
             *
             */
            config.onElemRestangularized = config.onElemRestangularized || function(elem) {
              return elem;
            };
            object.setOnElemRestangularized = function(post) {
              config.onElemRestangularized = post;
              return this;
            };

            config.shouldSaveParent = config.shouldSaveParent || function() {
                return true;
            };
            object.setParentless = function(values) {
                if (_.isArray(values)) {
                    config.shouldSaveParent = function(route) {
                        return !_.contains(values, route);
                    };
                } else if (_.isBoolean(values)) {
                    config.shouldSaveParent = function() {
                        return !values;
                    };
                }
                return this;
            };

            /**
             * This lets you set a suffix to every request.
             *
             * For example, if your api requires that for JSon requests you do /users/123.json, you can set that
             * in here.
             *
             *
             * By default, the suffix is null
             */
            config.suffix = _.isUndefined(config.suffix) ? null : config.suffix;
            object.setRequestSuffix = function(newSuffix) {
                config.suffix = newSuffix;
                return this;
            };

            /**
             * Add element transformers for certain routes.
             */
            config.transformers = config.transformers || {};
            object.addElementTransformer = function(type, secondArg, thirdArg) {
                var isCollection = null;
                var transformer = null;
                if (arguments.length === 2) {
                    transformer = secondArg;
                } else {
                    transformer = thirdArg;
                    isCollection = secondArg;
                }

                var typeTransformers = config.transformers[type];
                if (!typeTransformers) {
                    typeTransformers = config.transformers[type] = [];
                }

                typeTransformers.push(function(coll, elem) {
                    if (_.isNull(isCollection) || (coll == isCollection)) {
                        return transformer(elem);
                    }
                    return elem;
                });

                return object;
            };

            object.extendCollection = function(route, fn) {
              return object.addElementTransformer(route, true, fn);
            };

            object.extendModel = function(route, fn) {
              return object.addElementTransformer(route, false, fn);
            };

            config.transformElem = function(elem, isCollection, route, Restangular, force) {
                if (!force && !config.transformLocalElements && !elem[config.restangularFields.fromServer]) {
                  return elem;
                }
                var typeTransformers = config.transformers[route];
                var changedElem = elem;
                if (typeTransformers) {
                    _.each(typeTransformers, function(transformer) {
                       changedElem = transformer(isCollection, changedElem);
                    });
                }
                return config.onElemRestangularized(changedElem,
                  isCollection, route, Restangular);
            };

            config.transformLocalElements = _.isUndefined(config.transformLocalElements) ? false : config.transformLocalElements;
            object.setTransformOnlyServerElements = function(active) {
              config.transformLocalElements = !active;
            }

            config.fullResponse = _.isUndefined(config.fullResponse) ? false : config.fullResponse;
            object.setFullResponse = function(full) {
                config.fullResponse = full;
                return this;
            };





            //Internal values and functions
            config.urlCreatorFactory = {};

            /**
             * Base URL Creator. Base prototype for everything related to it
             **/

             var BaseCreator = function() {
             };

             BaseCreator.prototype.setConfig = function(config) {
                 this.config = config;
                 return this;
             };

             BaseCreator.prototype.parentsArray = function(current) {
                var parents = [];
                while(current) {
                    parents.push(current);
                    current = current[this.config.restangularFields.parentResource];
                }
                return parents.reverse();
            };

            function RestangularResource(config, $http, url, configurer) {
              var resource = {};
              _.each(_.keys(configurer), function(key) {
                  var value = configurer[key];

                  // Add default parameters
                  value.params = _.extend({}, value.params,
                          config.defaultRequestParams[value.method.toLowerCase()]);
                  // We don't want the ? if no params are there
                  if (_.isEmpty(value.params)) {
                    delete value.params;
                  }

                  if (config.isSafe(value.method)) {

                      resource[key] = function() {
                          return $http(_.extend(value, {
                              url: url
                          }));
                      };

                  } else {

                      resource[key] = function(data) {
                          return $http(_.extend(value, {
                              url: url,
                              data: data
                          }));
                      };

                  }
              });

              return resource;
            }

            BaseCreator.prototype.resource = function(current, $http, localHttpConfig, callHeaders, callParams, what, etag, operation) {

                var params = _.defaults(callParams || {}, this.config.defaultRequestParams.common);
                var headers = _.defaults(callHeaders || {}, this.config.defaultHeaders);

                if (etag) {
                    if (!config.isSafe(operation)) {
                      headers['If-Match'] = etag;
                    } else {
                      headers['If-None-Match'] = etag;
                    }
                }

                var url = this.base(current);

                if (what) {
                  var add = '';
                  if (!/\/$/.test(url)) {
                    add += '/';
                  }
                  add += what;
                  url += add;
                }

                if (this.config.suffix
                  && url.indexOf(this.config.suffix, url.length - this.config.suffix.length) === -1
                  && !this.config.getUrlFromElem(current)) {
                    url += this.config.suffix;
                }

                current[this.config.restangularFields.httpConfig] = undefined;


                return RestangularResource(this.config, $http, url, {
                    getList: this.config.withHttpValues(localHttpConfig,
                      {method: 'GET',
                      params: params,
                      headers: headers}),

                    get: this.config.withHttpValues(localHttpConfig,
                      {method: 'GET',
                      params: params,
                      headers: headers}),

                    jsonp: this.config.withHttpValues(localHttpConfig,
                      {method: 'jsonp',
                      params: params,
                      headers: headers}),

                    put: this.config.withHttpValues(localHttpConfig,
                      {method: 'PUT',
                      params: params,
                      headers: headers}),

                    post: this.config.withHttpValues(localHttpConfig,
                      {method: 'POST',
                      params: params,
                      headers: headers}),

                    remove: this.config.withHttpValues(localHttpConfig,
                      {method: 'DELETE',
                      params: params,
                      headers: headers}),

                    head: this.config.withHttpValues(localHttpConfig,
                      {method: 'HEAD',
                      params: params,
                      headers: headers}),

                    trace: this.config.withHttpValues(localHttpConfig,
                      {method: 'TRACE',
                      params: params,
                      headers: headers}),

                    options: this.config.withHttpValues(localHttpConfig,
                      {method: 'OPTIONS',
                      params: params,
                      headers: headers}),

                    patch: this.config.withHttpValues(localHttpConfig,
                      {method: 'PATCH',
                      params: params,
                      headers: headers})
                });
            };

            /**
             * This is the Path URL creator. It uses Path to show Hierarchy in the Rest API.
             * This means that if you have an Account that then has a set of Buildings, a URL to a building
             * would be /accounts/123/buildings/456
            **/
            var Path = function() {
            };

            Path.prototype = new BaseCreator();

            Path.prototype.base = function(current) {
                var __this = this;
                return  _.reduce(this.parentsArray(current), function(acum, elem) {
                    var elemUrl;
                    var elemSelfLink = __this.config.getUrlFromElem(elem);
                    if (elemSelfLink) {
                      if (__this.config.isAbsoluteUrl(elemSelfLink)) {
                        return elemSelfLink;
                      } else {
                        elemUrl = elemSelfLink;
                      }
                    } else {
                      elemUrl = elem[__this.config.restangularFields.route];

                      if (elem[__this.config.restangularFields.restangularCollection]) {
                        var ids = elem[__this.config.restangularFields.ids];
                        if (ids) {
                          elemUrl += "/" + ids.join(",");
                        }
                      } else {
                          var elemId;
                          if (__this.config.useCannonicalId) {
                              elemId = __this.config.getCannonicalIdFromElem(elem);
                          } else {
                              elemId = __this.config.getIdFromElem(elem);
                          }

                          if (config.isValidId(elemId) && !elem.singleOne) {
                              elemUrl += "/" + (__this.config.encodeIds ? encodeURIComponent(elemId) : elemId);
                          }
                      }
                    }

                    return acum.replace(/\/$/, "") + "/" + elemUrl;

                }, this.config.baseUrl);
            };



            Path.prototype.fetchUrl = function(current, what) {
                var baseUrl = this.base(current);
                if (what) {
                    baseUrl += "/" + what;
                }
                return baseUrl;
            };

            Path.prototype.fetchRequestedUrl = function(current, what) {
                var url = this.fetchUrl(current, what);
                var params = current[config.restangularFields.reqParams];

                // From here on and until the end of fetchRequestedUrl,
                // the code has been kindly borrowed from angular.js
                // The reason for such code bloating is coherence:
                //   If the user were to use this for cache management, the
                //   serialization of parameters would need to be identical
                //   to the one done by angular for cache keys to match.
                function sortedKeys(obj) {
                  var keys = [];
                  for (var key in obj) {
                    if (obj.hasOwnProperty(key)) {
                      keys.push(key);
                    }
                  }
                  return keys.sort();
                }

                function forEachSorted(obj, iterator, context) {
                  var keys = sortedKeys(obj);
                  for ( var i = 0; i < keys.length; i++) {
                    iterator.call(context, obj[keys[i]], keys[i]);
                  }
                  return keys;
                }

                function encodeUriQuery(val, pctEncodeSpaces) {
                  return encodeURIComponent(val).
                             replace(/%40/gi, '@').
                             replace(/%3A/gi, ':').
                             replace(/%24/g, '$').
                             replace(/%2C/gi, ',').
                             replace(/%20/g, (pctEncodeSpaces ? '%20' : '+'));
                }

                if (!params) return url;
                var parts = [];
                forEachSorted(params, function(value, key) {
                  if (value == null || value == undefined) return;
                  if (!angular.isArray(value)) value = [value];

                  angular.forEach(value, function(v) {
                    if (angular.isObject(v)) {
                      v = angular.toJson(v);
                    }
                    parts.push(encodeUriQuery(key) + '=' +
                               encodeUriQuery(v));
                  });
                });
                return url + (this.config.suffix || '') + ((url.indexOf('?') === -1) ? '?' : '&') + parts.join('&');
            };



            config.urlCreatorFactory.path = Path;

        };

        var globalConfiguration = {};

        Configurer.init(this, globalConfiguration);




       this.$get = ['$http', '$q', function($http, $q) {

          function createServiceForConfiguration(config) {
              var service = {};

              var urlHandler = new config.urlCreatorFactory[config.urlCreator]();
              urlHandler.setConfig(config);

              function restangularizeBase(parent, elem, route, reqParams, fromServer) {
                  elem[config.restangularFields.route] = route;
                  elem[config.restangularFields.getRestangularUrl] = _.bind(urlHandler.fetchUrl, urlHandler, elem);
                  elem[config.restangularFields.getRequestedUrl] = _.bind(urlHandler.fetchRequestedUrl, urlHandler, elem);
                  elem[config.restangularFields.addRestangularMethod] = _.bind(addRestangularMethodFunction, elem);
                  elem[config.restangularFields.clone] = _.bind(copyRestangularizedElement, elem, elem);
                  elem[config.restangularFields.reqParams] = _.isEmpty(reqParams) ? null : reqParams;
                  elem[config.restangularFields.withHttpConfig] = _.bind(withHttpConfig, elem);
                  elem[config.restangularFields.plain] = _.bind(stripRestangular, elem, elem);

                  // RequestLess connection
                  elem[config.restangularFields.one] = _.bind(one, elem, elem);
                  elem[config.restangularFields.all] = _.bind(all, elem, elem);
                  elem[config.restangularFields.several] = _.bind(several, elem, elem);
                  elem[config.restangularFields.oneUrl] = _.bind(oneUrl, elem, elem);
                  elem[config.restangularFields.allUrl] = _.bind(allUrl, elem, elem);

                  elem[config.restangularFields.fromServer] = !!fromServer;

                  if (parent && config.shouldSaveParent(route)) {
                      var parentId = config.getIdFromElem(parent);
                      var parentUrl = config.getUrlFromElem(parent);

                      var restangularFieldsForParent = _.union(
                        _.values( _.pick(config.restangularFields, ['route', 'singleOne', 'parentResource']) ),
                        config.extraFields
                      );
                      var parentResource = _.pick(parent, restangularFieldsForParent);

                      if (config.isValidId(parentId)) {
                          config.setIdToElem(parentResource, parentId);
                      }
                      if (config.isValidId(parentUrl)) {
                          config.setUrlToElem(parentResource, parentUrl);
                      }

                      elem[config.restangularFields.parentResource] = parentResource;
                  } else {
                    elem[config.restangularFields.parentResource] = null;
                  }
                  return elem;
              }



              function one(parent, route, id, singleOne) {
                  if (_.isNumber(route) || _.isNumber(parent)) {
                    var error = "You're creating a Restangular entity with the number "
                    error += "instead of the route or the parent. You can't call .one(12)";
                    throw new Error(error);
                  }
                  var elem = {};
                  config.setIdToElem(elem, id);
                  config.setFieldToElem(config.restangularFields.singleOne, elem, singleOne);
                  return restangularizeElem(parent, elem , route, false);
              }


              function all(parent, route) {
                  return restangularizeCollection(parent, [] , route, false);
              }

              function several(parent, route, ids) {
                var collection = [];
                collection[config.restangularFields.ids] =
                  Array.prototype.splice.call(arguments, 2);
                return restangularizeCollection(parent, collection , route, false);
              }

              function oneUrl(parent, route, url) {
                  if (!route) {
                    throw new Error("Route is mandatory when creating new Restangular objects.");
                  }
                  var elem = {};
                  config.setUrlToElem(elem, url, route);
                  return restangularizeElem(parent, elem , route, false);
              }


              function allUrl(parent, route, url) {
                  if (!route) {
                    throw new Error("Route is mandatory when creating new Restangular objects.");
                  }
                  var elem = {};
                  config.setUrlToElem(elem, url, route);
                  return restangularizeCollection(parent, elem , route, false);
              }
              // Promises
              function restangularizePromise(promise, isCollection, valueToFill) {
                  promise.call = _.bind(promiseCall, promise);
                  promise.get = _.bind(promiseGet, promise);
                  promise[config.restangularFields.restangularCollection] = isCollection;
                  if (isCollection) {
                      promise.push = _.bind(promiseCall, promise, "push");
                  }
                  promise.$object = valueToFill;
                  return promise;
              }

              function promiseCall(method) {
                  var deferred = $q.defer();
                  var callArgs = arguments;
                  var filledValue = {};
                  this.then(function(val) {
                      var params = Array.prototype.slice.call(callArgs, 1);
                      var func = val[method];
                      func.apply(val, params);
                      filledValue = val;
                      deferred.resolve(val);
                  });
                  return restangularizePromise(deferred.promise, this[config.restangularFields.restangularCollection], filledValue);
              }

              function promiseGet(what) {
                  var deferred = $q.defer();
                  var filledValue = {};
                  this.then(function(val) {
                      filledValue = val[what];
                      deferred.resolve(filledValue);
                  });
                  return restangularizePromise(deferred.promise, this[config.restangularFields.restangularCollection], filledValue);
              }

              function resolvePromise(deferred, response, data, filledValue) {

                _.extend(filledValue, data);

                // Trigger the full response interceptor.
                if (config.fullResponse) {
                  return deferred.resolve(_.extend(response, {
                    data: data
                  }));
                } else {
                  deferred.resolve(data);
                }
              }


              // Elements

              function stripRestangular(elem) {
                if (_.isArray(elem)) {
                    var array = [];
                    _.each(elem, function(value) {
                        array.push(stripRestangular(value));
                    });
                    return array;
                } else {
                    return _.omit(elem, _.values(_.omit(config.restangularFields, 'id')));
                }


              }

              function addCustomOperation(elem) {
                  elem[config.restangularFields.customOperation] = _.bind(customFunction, elem);
                  _.each(["put", "post", "get", "delete"], function(oper) {
                      _.each(["do", "custom"], function(alias) {
                          var callOperation = oper === 'delete' ? 'remove' : oper;
                          var name = alias + oper.toUpperCase();
                          var callFunction;

                          if (callOperation !== 'put' && callOperation !== 'post') {
                              callFunction = customFunction;
                          } else {
                              callFunction = function(operation, elem, path, params, headers) {
                                return _.bind(customFunction, this)(operation, path, params, headers, elem);
                              };
                          }
                          elem[name] = _.bind(callFunction, elem, callOperation);
                      });
                  });
                  elem[config.restangularFields.customGETLIST] = _.bind(fetchFunction, elem);
                  elem[config.restangularFields.doGETLIST] = elem[config.restangularFields.customGETLIST];
              }

              function copyRestangularizedElement(fromElement, toElement) {
                  var copiedElement = angular.copy(fromElement, toElement);
                  return restangularizeElem(copiedElement[config.restangularFields.parentResource],
                          copiedElement, copiedElement[config.restangularFields.route], true);
              }

              function restangularizeElem(parent, element, route, fromServer, collection, reqParams) {
                  var elem = config.onBeforeElemRestangularized(element, false, route);

                  var localElem = restangularizeBase(parent, elem, route, reqParams, fromServer);

                  if (config.useCannonicalId) {
                      localElem[config.restangularFields.cannonicalId] = config.getIdFromElem(localElem);
                  }

                  if (collection) {
                      localElem[config.restangularFields.getParentList] = function() {
                          return collection;
                      };
                  }

                  localElem[config.restangularFields.restangularCollection] = false;
                  localElem[config.restangularFields.get] = _.bind(getFunction, localElem);
                  localElem[config.restangularFields.getList] = _.bind(fetchFunction, localElem);
                  localElem[config.restangularFields.put] = _.bind(putFunction, localElem);
                  localElem[config.restangularFields.post] = _.bind(postFunction, localElem);
                  localElem[config.restangularFields.remove] = _.bind(deleteFunction, localElem);
                  localElem[config.restangularFields.head] = _.bind(headFunction, localElem);
                  localElem[config.restangularFields.trace] = _.bind(traceFunction, localElem);
                  localElem[config.restangularFields.options] = _.bind(optionsFunction, localElem);
                  localElem[config.restangularFields.patch] = _.bind(patchFunction, localElem);
                  localElem[config.restangularFields.save] = _.bind(save, localElem);

                  addCustomOperation(localElem);
                  return config.transformElem(localElem, false, route, service, true);
              }

              function restangularizeCollection(parent, element, route, fromServer, reqParams) {
                  var elem = config.onBeforeElemRestangularized(element, true, route);

                  var localElem = restangularizeBase(parent, elem, route, reqParams, fromServer);
                  localElem[config.restangularFields.restangularCollection] = true;
                  localElem[config.restangularFields.post] = _.bind(postFunction, localElem, null);
                  localElem[config.restangularFields.remove] = _.bind(deleteFunction, localElem);
                  localElem[config.restangularFields.head] = _.bind(headFunction, localElem);
                  localElem[config.restangularFields.trace] = _.bind(traceFunction, localElem);
                  localElem[config.restangularFields.putElement] = _.bind(putElementFunction, localElem);
                  localElem[config.restangularFields.options] = _.bind(optionsFunction, localElem);
                  localElem[config.restangularFields.patch] = _.bind(patchFunction, localElem);
                  localElem[config.restangularFields.get] = _.bind(getById, localElem);
                  localElem[config.restangularFields.getList] = _.bind(fetchFunction, localElem, null);

                  addCustomOperation(localElem);
                  return config.transformElem(localElem, true, route, service, true);
              }

              function restangularizeCollectionAndElements(parent, element, route) {
                var collection = restangularizeCollection(parent, element, route, false);
                _.each(collection, function(elem) {
                  restangularizeElem(parent, elem, route, false);
                });
                return collection;
              }

              function getById(id, reqParams, headers){
                  return this.customGET(id.toString(), reqParams, headers);
              }

              function putElementFunction(idx, params, headers) {
                  var __this = this;
                  var elemToPut = this[idx];
                  var deferred = $q.defer();
                  var filledArray = [];
                  filledArray = config.transformElem(filledArray, true, elemToPut[config.restangularFields.route], service)
                  elemToPut.put(params, headers).then(function(serverElem) {
                      var newArray = copyRestangularizedElement(__this);
                      newArray[idx] = serverElem;
                      filledArray = newArray;
                      deferred.resolve(newArray);
                  }, function(response) {
                      deferred.reject(response);
                  });

                  return restangularizePromise(deferred.promise, true, filledArray);
              }

              function parseResponse(resData, operation, route, fetchUrl, response, deferred) {
                  var data = config.responseExtractor(resData, operation, route, fetchUrl, response, deferred);
                  var etag = response.headers("ETag");
                  if (data && etag) {
                      data[config.restangularFields.etag] = etag;
                  }
                  return data;
              }


              function fetchFunction(what, reqParams, headers) {
                  var __this = this;
                  var deferred = $q.defer();
                  var operation = 'getList';
                  var url = urlHandler.fetchUrl(this, what);
                  var whatFetched = what || __this[config.restangularFields.route];

                  var request = config.fullRequestInterceptor(null, operation,
                      whatFetched, url, headers || {}, reqParams || {}, this[config.restangularFields.httpConfig] || {});

                  var filledArray = [];
                  filledArray = config.transformElem(filledArray, true, whatFetched, service)

                  var method = "getList";

                  if (config.jsonp) {
                    method = "jsonp";
                  }

                  urlHandler.resource(this, $http, request.httpConfig, request.headers, request.params, what,
                          this[config.restangularFields.etag], operation)[method]().then(function(response) {
                      var resData = response.data;
                      var fullParams = response.config.params;
                      var data = parseResponse(resData, operation, whatFetched, url, response, deferred);

                      // support empty response for getList() calls (some APIs respond with 204 and empty body)
                      if (_.isUndefined(data) || "" === data) {
                          data = []
                      }
                      if (!_.isArray(data)) {
                        throw new Error("Response for getList SHOULD be an array and not an object or something else");
                      }
                      var processedData = _.map(data, function(elem) {
                          if (!__this[config.restangularFields.restangularCollection]) {
                              return restangularizeElem(__this, elem, what, true, data);
                          } else {
                              return restangularizeElem(__this[config.restangularFields.parentResource],
                                elem, __this[config.restangularFields.route], true, data);
                          }

                      });

                      processedData = _.extend(data, processedData);

                      if (!__this[config.restangularFields.restangularCollection]) {
                          resolvePromise(deferred, response, restangularizeCollection(__this, processedData, what, true, fullParams), filledArray);
                      } else {
                          resolvePromise(deferred, response, restangularizeCollection(__this[config.restangularFields.parentResource], processedData, __this[config.restangularFields.route], true, fullParams), filledArray);
                      }
                  }, function error(response) {
                      if (response.status === 304 && __this[config.restangularFields.restangularCollection]) {
                        resolvePromise(deferred, response, __this, filledArray);
                      } else if ( config.errorInterceptor(response, deferred) !== false ) {
                          deferred.reject(response);
                      }
                  });

                  return restangularizePromise(deferred.promise, true, filledArray);
              }

              function withHttpConfig(httpConfig) {
                 this[config.restangularFields.httpConfig] = httpConfig;
                 return this;
              }

              function save(params, headers) {
                if (this[config.restangularFields.fromServer]) {
                  return this[config.restangularFields.put](params, headers);
                } else {
                  return _.bind(elemFunction, this)("post", undefined, params, undefined, headers);
                }
              }

              function elemFunction(operation, what, params, obj, headers) {
                  var __this = this;
                  var deferred = $q.defer();
                  var resParams = params || {};
                  var route = what || this[config.restangularFields.route];
                  var fetchUrl = urlHandler.fetchUrl(this, what);

                  var callObj = obj || this;
                  // fallback to etag on restangular object (since for custom methods we probably don't explicitly specify the etag field)
                  var etag = callObj[config.restangularFields.etag] || (operation != "post" ? this[config.restangularFields.etag] : null);

                  if (_.isObject(callObj) && config.isRestangularized(callObj)) {
                      callObj = stripRestangular(callObj);
                  }
                  var request = config.fullRequestInterceptor(callObj, operation, route, fetchUrl,
                    headers || {}, resParams || {}, this[config.restangularFields.httpConfig] || {});

                  var filledObject = {};
                  filledObject = config.transformElem(filledObject, false, route, service);

                  var okCallback = function(response) {
                      var resData = response.data;
                      var fullParams = response.config.params;
                      var elem = parseResponse(resData, operation, route, fetchUrl, response, deferred);
                      if (elem) {

                        if (operation === "post" && !__this[config.restangularFields.restangularCollection]) {
                          resolvePromise(deferred, response, restangularizeElem(__this, elem, what, true, null, fullParams), filledObject);
                        } else {
                          data = restangularizeElem(__this[config.restangularFields.parentResource], elem, __this[config.restangularFields.route], true, null, fullParams)
                          data[config.restangularFields.singleOne] = __this[config.restangularFields.singleOne]
                          resolvePromise(deferred, response, data, filledObject);
                        }

                      } else {
                        resolvePromise(deferred, response, undefined, filledObject);
                      }
                  };

                  var errorCallback = function(response) {
                      if (response.status === 304 && config.isSafe(operation)) {
                        resolvePromise(deferred, response, __this, filledObject);
                      } else if ( config.errorInterceptor(response, deferred) !== false ) {
                          deferred.reject(response);
                      }
                  };
                  // Overring HTTP Method
                  var callOperation = operation;
                  var callHeaders = _.extend({}, request.headers);
                  var isOverrideOperation = config.isOverridenMethod(operation);
                  if (isOverrideOperation) {
                    callOperation = 'post';
                    callHeaders = _.extend(callHeaders, {'X-HTTP-Method-Override': operation === 'remove' ? 'DELETE' : operation});
                  } else if (config.jsonp && callOperation === 'get') {
                    callOperation = 'jsonp';
                  }

                  if (config.isSafe(operation)) {
                    if (isOverrideOperation) {
                      urlHandler.resource(this, $http, request.httpConfig, callHeaders, request.params,
                        what, etag, callOperation)[callOperation]({}).then(okCallback, errorCallback);
                    } else {
                      urlHandler.resource(this, $http, request.httpConfig, callHeaders, request.params,
                        what, etag, callOperation)[callOperation]().then(okCallback, errorCallback);
                    }
                  } else {
                      urlHandler.resource(this, $http, request.httpConfig, callHeaders, request.params,
                        what, etag, callOperation)[callOperation](request.element).then(okCallback, errorCallback);
                  }

                  return restangularizePromise(deferred.promise, false, filledObject);
              }

              function getFunction(params, headers) {
                  return _.bind(elemFunction, this)("get", undefined, params, undefined, headers);
              }

              function deleteFunction(params, headers) {
                  return _.bind(elemFunction, this)("remove", undefined, params, undefined, headers);
              }

              function putFunction(params, headers) {
                  return _.bind(elemFunction, this)("put", undefined, params, undefined, headers);
              }

              function postFunction(what, elem, params, headers) {
                  return _.bind(elemFunction, this)("post", what, params, elem, headers);
              }

             function headFunction(params, headers) {
               return _.bind(elemFunction, this)("head", undefined, params, undefined, headers);
             }

             function traceFunction(params, headers) {
               return _.bind(elemFunction, this)("trace", undefined, params, undefined, headers);
             }

             function optionsFunction(params, headers) {
               return _.bind(elemFunction, this)("options", undefined, params, undefined, headers);
             }

             function patchFunction(elem, params, headers) {
               return _.bind(elemFunction, this)("patch", undefined, params, elem, headers);
             }

             function customFunction(operation, path, params, headers, elem) {
                 return _.bind(elemFunction, this)(operation, path, params, elem, headers);
             }

             function addRestangularMethodFunction(name, operation, path, defaultParams, defaultHeaders, defaultElem) {
                 var bindedFunction;
                 if (operation === 'getList') {
                     bindedFunction = _.bind(fetchFunction, this, path);
                 } else {
                     bindedFunction = _.bind(customFunction, this, operation, path);
                 }

                 var createdFunction = function(params, headers, elem) {
                     var callParams = _.defaults({
                         params: params,
                         headers: headers,
                         elem: elem
                     }, {
                         params: defaultParams,
                         headers: defaultHeaders,
                         elem: defaultElem
                     });
                     return bindedFunction(callParams.params, callParams.headers, callParams.elem);
                 };

                 if (config.isSafe(operation)) {
                     this[name] = createdFunction;
                 } else {
                     this[name] = function(elem, params, headers) {
                         return createdFunction(params, headers, elem);
                     };
                 }

             }

             function withConfigurationFunction(configurer) {
                 var newConfig = angular.copy(_.omit(config, 'configuration'));
                 Configurer.init(newConfig, newConfig);
                 configurer(newConfig);
                 return createServiceForConfiguration(newConfig);
             }

             function toService(route, parent) {
                 var serv = {};
                 var collection = (parent || service).all(route);
                 serv.one = _.bind(one, (parent || service), parent, route);
                 serv.post = _.bind(collection.post, collection);
                 serv.getList = _.bind(collection.getList, collection);
                 return serv;
             }


              Configurer.init(service, config);

              service.copy = _.bind(copyRestangularizedElement, service);

              service.service = _.bind(toService, service);

              service.withConfig = _.bind(withConfigurationFunction, service);

              service.one = _.bind(one, service, null);

              service.all = _.bind(all, service, null);

              service.several = _.bind(several, service, null);

              service.oneUrl = _.bind(oneUrl, service, null);

              service.allUrl = _.bind(allUrl, service, null);

              service.stripRestangular = _.bind(stripRestangular, service);

              service.restangularizeElement = _.bind(restangularizeElem, service);

              service.restangularizeCollection = _.bind(restangularizeCollectionAndElements, service);

              return service;
          }

          return createServiceForConfiguration(globalConfiguration);

        }];
    }
);

})();

/**
 * @license
 * lodash 3.4.0 (Custom Build) <https://lodash.com/>
 * Build: `lodash modern -o ./lodash.js`
 * Copyright 2012-2015 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.8.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <https://lodash.com/license>
 */
;(function() {

  /** Used as a safe reference for `undefined` in pre-ES5 environments. */
  var undefined;

  /** Used as the semantic version number. */
  var VERSION = '3.4.0';

  /** Used to compose bitmasks for wrapper metadata. */
  var BIND_FLAG = 1,
      BIND_KEY_FLAG = 2,
      CURRY_BOUND_FLAG = 4,
      CURRY_FLAG = 8,
      CURRY_RIGHT_FLAG = 16,
      PARTIAL_FLAG = 32,
      PARTIAL_RIGHT_FLAG = 64,
      REARG_FLAG = 128,
      ARY_FLAG = 256;

  /** Used as default options for `_.trunc`. */
  var DEFAULT_TRUNC_LENGTH = 30,
      DEFAULT_TRUNC_OMISSION = '...';

  /** Used to detect when a function becomes hot. */
  var HOT_COUNT = 150,
      HOT_SPAN = 16;

  /** Used to indicate the type of lazy iteratees. */
  var LAZY_DROP_WHILE_FLAG = 0,
      LAZY_MAP_FLAG = 2,
      LAZY_TAKE_WHILE_FLAG = 3;

  /** Used as the `TypeError` message for "Functions" methods. */
  var FUNC_ERROR_TEXT = 'Expected a function';

  /** Used as the internal argument placeholder. */
  var PLACEHOLDER = '__lodash_placeholder__';

  /** `Object#toString` result references. */
  var argsTag = '[object Arguments]',
      arrayTag = '[object Array]',
      boolTag = '[object Boolean]',
      dateTag = '[object Date]',
      errorTag = '[object Error]',
      funcTag = '[object Function]',
      mapTag = '[object Map]',
      numberTag = '[object Number]',
      objectTag = '[object Object]',
      regexpTag = '[object RegExp]',
      setTag = '[object Set]',
      stringTag = '[object String]',
      weakMapTag = '[object WeakMap]';

  var arrayBufferTag = '[object ArrayBuffer]',
      float32Tag = '[object Float32Array]',
      float64Tag = '[object Float64Array]',
      int8Tag = '[object Int8Array]',
      int16Tag = '[object Int16Array]',
      int32Tag = '[object Int32Array]',
      uint8Tag = '[object Uint8Array]',
      uint8ClampedTag = '[object Uint8ClampedArray]',
      uint16Tag = '[object Uint16Array]',
      uint32Tag = '[object Uint32Array]';

  /** Used to match empty string literals in compiled template source. */
  var reEmptyStringLeading = /\b__p \+= '';/g,
      reEmptyStringMiddle = /\b(__p \+=) '' \+/g,
      reEmptyStringTrailing = /(__e\(.*?\)|\b__t\)) \+\n'';/g;

  /** Used to match HTML entities and HTML characters. */
  var reEscapedHtml = /&(?:amp|lt|gt|quot|#39|#96);/g,
      reUnescapedHtml = /[&<>"'`]/g,
      reHasEscapedHtml = RegExp(reEscapedHtml.source),
      reHasUnescapedHtml = RegExp(reUnescapedHtml.source);

  /** Used to match template delimiters. */
  var reEscape = /<%-([\s\S]+?)%>/g,
      reEvaluate = /<%([\s\S]+?)%>/g,
      reInterpolate = /<%=([\s\S]+?)%>/g;

  /**
   * Used to match ES template delimiters.
   * See the [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-template-literal-lexical-components)
   * for more details.
   */
  var reEsTemplate = /\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;

  /** Used to match `RegExp` flags from their coerced string values. */
  var reFlags = /\w*$/;

  /** Used to detect named functions. */
  var reFuncName = /^\s*function[ \n\r\t]+\w/;

  /** Used to detect hexadecimal string values. */
  var reHexPrefix = /^0[xX]/;

  /** Used to detect host constructors (Safari > 5). */
  var reHostCtor = /^\[object .+?Constructor\]$/;

  /** Used to match latin-1 supplementary letters (excluding mathematical operators). */
  var reLatin1 = /[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g;

  /** Used to ensure capturing order of template delimiters. */
  var reNoMatch = /($^)/;

  /**
   * Used to match `RegExp` special characters.
   * See this [article on `RegExp` characters](http://www.regular-expressions.info/characters.html#special)
   * for more details.
   */
  var reRegExpChars = /[.*+?^${}()|[\]\/\\]/g,
      reHasRegExpChars = RegExp(reRegExpChars.source);

  /** Used to detect functions containing a `this` reference. */
  var reThis = /\bthis\b/;

  /** Used to match unescaped characters in compiled string literals. */
  var reUnescapedString = /['\n\r\u2028\u2029\\]/g;

  /** Used to match words to create compound words. */
  var reWords = (function() {
    var upper = '[A-Z\\xc0-\\xd6\\xd8-\\xde]',
        lower = '[a-z\\xdf-\\xf6\\xf8-\\xff]+';

    return RegExp(upper + '+(?=' + upper + lower + ')|' + upper + '?' + lower + '|' + upper + '+|[0-9]+', 'g');
  }());

  /** Used to detect and test for whitespace. */
  var whitespace = (
    // Basic whitespace characters.
    ' \t\x0b\f\xa0\ufeff' +

    // Line terminators.
    '\n\r\u2028\u2029' +

    // Unicode category "Zs" space separators.
    '\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000'
  );

  /** Used to assign default `context` object properties. */
  var contextProps = [
    'Array', 'ArrayBuffer', 'Date', 'Error', 'Float32Array', 'Float64Array',
    'Function', 'Int8Array', 'Int16Array', 'Int32Array', 'Math', 'Number',
    'Object', 'RegExp', 'Set', 'String', '_', 'clearTimeout', 'document',
    'isFinite', 'parseInt', 'setTimeout', 'TypeError', 'Uint8Array',
    'Uint8ClampedArray', 'Uint16Array', 'Uint32Array', 'WeakMap',
    'window', 'WinRTError'
  ];

  /** Used to make template sourceURLs easier to identify. */
  var templateCounter = -1;

  /** Used to identify `toStringTag` values of typed arrays. */
  var typedArrayTags = {};
  typedArrayTags[float32Tag] = typedArrayTags[float64Tag] =
  typedArrayTags[int8Tag] = typedArrayTags[int16Tag] =
  typedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =
  typedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =
  typedArrayTags[uint32Tag] = true;
  typedArrayTags[argsTag] = typedArrayTags[arrayTag] =
  typedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =
  typedArrayTags[dateTag] = typedArrayTags[errorTag] =
  typedArrayTags[funcTag] = typedArrayTags[mapTag] =
  typedArrayTags[numberTag] = typedArrayTags[objectTag] =
  typedArrayTags[regexpTag] = typedArrayTags[setTag] =
  typedArrayTags[stringTag] = typedArrayTags[weakMapTag] = false;

  /** Used to identify `toStringTag` values supported by `_.clone`. */
  var cloneableTags = {};
  cloneableTags[argsTag] = cloneableTags[arrayTag] =
  cloneableTags[arrayBufferTag] = cloneableTags[boolTag] =
  cloneableTags[dateTag] = cloneableTags[float32Tag] =
  cloneableTags[float64Tag] = cloneableTags[int8Tag] =
  cloneableTags[int16Tag] = cloneableTags[int32Tag] =
  cloneableTags[numberTag] = cloneableTags[objectTag] =
  cloneableTags[regexpTag] = cloneableTags[stringTag] =
  cloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] =
  cloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;
  cloneableTags[errorTag] = cloneableTags[funcTag] =
  cloneableTags[mapTag] = cloneableTags[setTag] =
  cloneableTags[weakMapTag] = false;

  /** Used as an internal `_.debounce` options object by `_.throttle`. */
  var debounceOptions = {
    'leading': false,
    'maxWait': 0,
    'trailing': false
  };

  /** Used to map latin-1 supplementary letters to basic latin letters. */
  var deburredLetters = {
    '\xc0': 'A',  '\xc1': 'A', '\xc2': 'A', '\xc3': 'A', '\xc4': 'A', '\xc5': 'A',
    '\xe0': 'a',  '\xe1': 'a', '\xe2': 'a', '\xe3': 'a', '\xe4': 'a', '\xe5': 'a',
    '\xc7': 'C',  '\xe7': 'c',
    '\xd0': 'D',  '\xf0': 'd',
    '\xc8': 'E',  '\xc9': 'E', '\xca': 'E', '\xcb': 'E',
    '\xe8': 'e',  '\xe9': 'e', '\xea': 'e', '\xeb': 'e',
    '\xcC': 'I',  '\xcd': 'I', '\xce': 'I', '\xcf': 'I',
    '\xeC': 'i',  '\xed': 'i', '\xee': 'i', '\xef': 'i',
    '\xd1': 'N',  '\xf1': 'n',
    '\xd2': 'O',  '\xd3': 'O', '\xd4': 'O', '\xd5': 'O', '\xd6': 'O', '\xd8': 'O',
    '\xf2': 'o',  '\xf3': 'o', '\xf4': 'o', '\xf5': 'o', '\xf6': 'o', '\xf8': 'o',
    '\xd9': 'U',  '\xda': 'U', '\xdb': 'U', '\xdc': 'U',
    '\xf9': 'u',  '\xfa': 'u', '\xfb': 'u', '\xfc': 'u',
    '\xdd': 'Y',  '\xfd': 'y', '\xff': 'y',
    '\xc6': 'Ae', '\xe6': 'ae',
    '\xde': 'Th', '\xfe': 'th',
    '\xdf': 'ss'
  };

  /** Used to map characters to HTML entities. */
  var htmlEscapes = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;',
    '`': '&#96;'
  };

  /** Used to map HTML entities to characters. */
  var htmlUnescapes = {
    '&amp;': '&',
    '&lt;': '<',
    '&gt;': '>',
    '&quot;': '"',
    '&#39;': "'",
    '&#96;': '`'
  };

  /** Used to determine if values are of the language type `Object`. */
  var objectTypes = {
    'function': true,
    'object': true
  };

  /** Used to escape characters for inclusion in compiled string literals. */
  var stringEscapes = {
    '\\': '\\',
    "'": "'",
    '\n': 'n',
    '\r': 'r',
    '\u2028': 'u2028',
    '\u2029': 'u2029'
  };

  /** Detect free variable `exports`. */
  var freeExports = objectTypes[typeof exports] && exports && !exports.nodeType && exports;

  /** Detect free variable `module`. */
  var freeModule = objectTypes[typeof module] && module && !module.nodeType && module;

  /** Detect free variable `global` from Node.js. */
  var freeGlobal = freeExports && freeModule && typeof global == 'object' && global;

  /** Detect free variable `window`. */
  var freeWindow = objectTypes[typeof window] && window;

  /** Detect the popular CommonJS extension `module.exports`. */
  var moduleExports = freeModule && freeModule.exports === freeExports && freeExports;

  /**
   * Used as a reference to the global object.
   *
   * The `this` value is used if it is the global object to avoid Greasemonkey's
   * restricted `window` object, otherwise the `window` object is used.
   */
  var root = freeGlobal || ((freeWindow !== (this && this.window)) && freeWindow) || this;

  /*--------------------------------------------------------------------------*/

  /**
   * The base implementation of `compareAscending` which compares values and
   * sorts them in ascending order without guaranteeing a stable sort.
   *
   * @private
   * @param {*} value The value to compare to `other`.
   * @param {*} other The value to compare to `value`.
   * @returns {number} Returns the sort order indicator for `value`.
   */
  function baseCompareAscending(value, other) {
    if (value !== other) {
      var valIsReflexive = value === value,
          othIsReflexive = other === other;

      if (value > other || !valIsReflexive || (typeof value == 'undefined' && othIsReflexive)) {
        return 1;
      }
      if (value < other || !othIsReflexive || (typeof other == 'undefined' && valIsReflexive)) {
        return -1;
      }
    }
    return 0;
  }

  /**
   * The base implementation of `_.indexOf` without support for binary searches.
   *
   * @private
   * @param {Array} array The array to search.
   * @param {*} value The value to search for.
   * @param {number} fromIndex The index to search from.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function baseIndexOf(array, value, fromIndex) {
    if (value !== value) {
      return indexOfNaN(array, fromIndex);
    }
    var index = fromIndex - 1,
        length = array.length;

    while (++index < length) {
      if (array[index] === value) {
        return index;
      }
    }
    return -1;
  }

  /**
   * The base implementation of `_.isFunction` without support for environments
   * with incorrect `typeof` results.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.
   */
  function baseIsFunction(value) {
    // Avoid a Chakra JIT bug in compatibility modes of IE 11.
    // See https://github.com/jashkenas/underscore/issues/1621 for more details.
    return typeof value == 'function' || false;
  }

  /**
   * Converts `value` to a string if it is not one. An empty string is returned
   * for `null` or `undefined` values.
   *
   * @private
   * @param {*} value The value to process.
   * @returns {string} Returns the string.
   */
  function baseToString(value) {
    if (typeof value == 'string') {
      return value;
    }
    return value == null ? '' : (value + '');
  }

  /**
   * Used by `_.max` and `_.min` as the default callback for string values.
   *
   * @private
   * @param {string} string The string to inspect.
   * @returns {number} Returns the code unit of the first character of the string.
   */
  function charAtCallback(string) {
    return string.charCodeAt(0);
  }

  /**
   * Used by `_.trim` and `_.trimLeft` to get the index of the first character
   * of `string` that is not found in `chars`.
   *
   * @private
   * @param {string} string The string to inspect.
   * @param {string} chars The characters to find.
   * @returns {number} Returns the index of the first character not found in `chars`.
   */
  function charsLeftIndex(string, chars) {
    var index = -1,
        length = string.length;

    while (++index < length && chars.indexOf(string.charAt(index)) > -1) {}
    return index;
  }

  /**
   * Used by `_.trim` and `_.trimRight` to get the index of the last character
   * of `string` that is not found in `chars`.
   *
   * @private
   * @param {string} string The string to inspect.
   * @param {string} chars The characters to find.
   * @returns {number} Returns the index of the last character not found in `chars`.
   */
  function charsRightIndex(string, chars) {
    var index = string.length;

    while (index-- && chars.indexOf(string.charAt(index)) > -1) {}
    return index;
  }

  /**
   * Used by `_.sortBy` to compare transformed elements of a collection and stable
   * sort them in ascending order.
   *
   * @private
   * @param {Object} object The object to compare to `other`.
   * @param {Object} other The object to compare to `object`.
   * @returns {number} Returns the sort order indicator for `object`.
   */
  function compareAscending(object, other) {
    return baseCompareAscending(object.criteria, other.criteria) || (object.index - other.index);
  }

  /**
   * Used by `_.sortByOrder` to compare multiple properties of each element
   * in a collection and stable sort them in the following order:
   *
   * If orders is unspecified, sort in ascending order for all properties.
   * Otherwise, for each property, sort in ascending order if its corresponding value in
   * orders is true, and descending order if false.
   *
   * @private
   * @param {Object} object The object to compare to `other`.
   * @param {Object} other The object to compare to `object`.
   * @param {boolean[]} orders The order to sort by for each property.
   * @returns {number} Returns the sort order indicator for `object`.
   */
  function compareMultiple(object, other, orders) {
    var index = -1,
        objCriteria = object.criteria,
        othCriteria = other.criteria,
        length = objCriteria.length,
        ordersLength = orders.length;

    while (++index < length) {
      var result = baseCompareAscending(objCriteria[index], othCriteria[index]);
      if (result) {
        if (index >= ordersLength) {
          return result;
        } else {
          return orders[index] ? result : result * -1;
        }
      }
    }
    // Fixes an `Array#sort` bug in the JS engine embedded in Adobe applications
    // that causes it, under certain circumstances, to provide the same value for
    // `object` and `other`. See https://github.com/jashkenas/underscore/pull/1247
    // for more details.
    //
    // This also ensures a stable sort in V8 and other engines.
    // See https://code.google.com/p/v8/issues/detail?id=90 for more details.
    return object.index - other.index;
  }

  /**
   * Used by `_.deburr` to convert latin-1 supplementary letters to basic latin letters.
   *
   * @private
   * @param {string} letter The matched letter to deburr.
   * @returns {string} Returns the deburred letter.
   */
  function deburrLetter(letter) {
    return deburredLetters[letter];
  }

  /**
   * Used by `_.escape` to convert characters to HTML entities.
   *
   * @private
   * @param {string} chr The matched character to escape.
   * @returns {string} Returns the escaped character.
   */
  function escapeHtmlChar(chr) {
    return htmlEscapes[chr];
  }

  /**
   * Used by `_.template` to escape characters for inclusion in compiled
   * string literals.
   *
   * @private
   * @param {string} chr The matched character to escape.
   * @returns {string} Returns the escaped character.
   */
  function escapeStringChar(chr) {
    return '\\' + stringEscapes[chr];
  }

  /**
   * Gets the index at which the first occurrence of `NaN` is found in `array`.
   * If `fromRight` is provided elements of `array` are iterated from right to left.
   *
   * @private
   * @param {Array} array The array to search.
   * @param {number} fromIndex The index to search from.
   * @param {boolean} [fromRight] Specify iterating from right to left.
   * @returns {number} Returns the index of the matched `NaN`, else `-1`.
   */
  function indexOfNaN(array, fromIndex, fromRight) {
    var length = array.length,
        index = fromIndex + (fromRight ? 0 : -1);

    while ((fromRight ? index-- : ++index < length)) {
      var other = array[index];
      if (other !== other) {
        return index;
      }
    }
    return -1;
  }

  /**
   * Checks if `value` is object-like.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
   */
  function isObjectLike(value) {
    return (value && typeof value == 'object') || false;
  }

  /**
   * Used by `trimmedLeftIndex` and `trimmedRightIndex` to determine if a
   * character code is whitespace.
   *
   * @private
   * @param {number} charCode The character code to inspect.
   * @returns {boolean} Returns `true` if `charCode` is whitespace, else `false`.
   */
  function isSpace(charCode) {
    return ((charCode <= 160 && (charCode >= 9 && charCode <= 13) || charCode == 32 || charCode == 160) || charCode == 5760 || charCode == 6158 ||
      (charCode >= 8192 && (charCode <= 8202 || charCode == 8232 || charCode == 8233 || charCode == 8239 || charCode == 8287 || charCode == 12288 || charCode == 65279)));
  }

  /**
   * Replaces all `placeholder` elements in `array` with an internal placeholder
   * and returns an array of their indexes.
   *
   * @private
   * @param {Array} array The array to modify.
   * @param {*} placeholder The placeholder to replace.
   * @returns {Array} Returns the new array of placeholder indexes.
   */
  function replaceHolders(array, placeholder) {
    var index = -1,
        length = array.length,
        resIndex = -1,
        result = [];

    while (++index < length) {
      if (array[index] === placeholder) {
        array[index] = PLACEHOLDER;
        result[++resIndex] = index;
      }
    }
    return result;
  }

  /**
   * An implementation of `_.uniq` optimized for sorted arrays without support
   * for callback shorthands and `this` binding.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {Function} [iteratee] The function invoked per iteration.
   * @returns {Array} Returns the new duplicate-value-free array.
   */
  function sortedUniq(array, iteratee) {
    var seen,
        index = -1,
        length = array.length,
        resIndex = -1,
        result = [];

    while (++index < length) {
      var value = array[index],
          computed = iteratee ? iteratee(value, index, array) : value;

      if (!index || seen !== computed) {
        seen = computed;
        result[++resIndex] = value;
      }
    }
    return result;
  }

  /**
   * Used by `_.trim` and `_.trimLeft` to get the index of the first non-whitespace
   * character of `string`.
   *
   * @private
   * @param {string} string The string to inspect.
   * @returns {number} Returns the index of the first non-whitespace character.
   */
  function trimmedLeftIndex(string) {
    var index = -1,
        length = string.length;

    while (++index < length && isSpace(string.charCodeAt(index))) {}
    return index;
  }

  /**
   * Used by `_.trim` and `_.trimRight` to get the index of the last non-whitespace
   * character of `string`.
   *
   * @private
   * @param {string} string The string to inspect.
   * @returns {number} Returns the index of the last non-whitespace character.
   */
  function trimmedRightIndex(string) {
    var index = string.length;

    while (index-- && isSpace(string.charCodeAt(index))) {}
    return index;
  }

  /**
   * Used by `_.unescape` to convert HTML entities to characters.
   *
   * @private
   * @param {string} chr The matched character to unescape.
   * @returns {string} Returns the unescaped character.
   */
  function unescapeHtmlChar(chr) {
    return htmlUnescapes[chr];
  }

  /*--------------------------------------------------------------------------*/

  /**
   * Create a new pristine `lodash` function using the given `context` object.
   *
   * @static
   * @memberOf _
   * @category Utility
   * @param {Object} [context=root] The context object.
   * @returns {Function} Returns a new `lodash` function.
   * @example
   *
   * _.mixin({ 'add': function(a, b) { return a + b; } });
   *
   * var lodash = _.runInContext();
   * lodash.mixin({ 'sub': function(a, b) { return a - b; } });
   *
   * _.isFunction(_.add);
   * // => true
   * _.isFunction(_.sub);
   * // => false
   *
   * lodash.isFunction(lodash.add);
   * // => false
   * lodash.isFunction(lodash.sub);
   * // => true
   *
   * // using `context` to mock `Date#getTime` use in `_.now`
   * var mock = _.runInContext({
   *   'Date': function() {
   *     return { 'getTime': getTimeMock };
   *   }
   * });
   *
   * // or creating a suped-up `defer` in Node.js
   * var defer = _.runInContext({ 'setTimeout': setImmediate }).defer;
   */
  function runInContext(context) {
    // Avoid issues with some ES3 environments that attempt to use values, named
    // after built-in constructors like `Object`, for the creation of literals.
    // ES5 clears this up by stating that literals must use built-in constructors.
    // See https://es5.github.io/#x11.1.5 for more details.
    context = context ? _.defaults(root.Object(), context, _.pick(root, contextProps)) : root;

    /** Native constructor references. */
    var Array = context.Array,
        Date = context.Date,
        Error = context.Error,
        Function = context.Function,
        Math = context.Math,
        Number = context.Number,
        Object = context.Object,
        RegExp = context.RegExp,
        String = context.String,
        TypeError = context.TypeError;

    /** Used for native method references. */
    var arrayProto = Array.prototype,
        objectProto = Object.prototype;

    /** Used to detect DOM support. */
    var document = (document = context.window) && document.document;

    /** Used to resolve the decompiled source of functions. */
    var fnToString = Function.prototype.toString;

    /** Used to the length of n-tuples for `_.unzip`. */
    var getLength = baseProperty('length');

    /** Used to check objects for own properties. */
    var hasOwnProperty = objectProto.hasOwnProperty;

    /** Used to generate unique IDs. */
    var idCounter = 0;

    /**
     * Used to resolve the `toStringTag` of values.
     * See the [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-object.prototype.tostring)
     * for more details.
     */
    var objToString = objectProto.toString;

    /** Used to restore the original `_` reference in `_.noConflict`. */
    var oldDash = context._;

    /** Used to detect if a method is native. */
    var reNative = RegExp('^' +
      escapeRegExp(objToString)
      .replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g, '$1.*?') + '$'
    );

    /** Native method references. */
    var ArrayBuffer = isNative(ArrayBuffer = context.ArrayBuffer) && ArrayBuffer,
        bufferSlice = isNative(bufferSlice = ArrayBuffer && new ArrayBuffer(0).slice) && bufferSlice,
        ceil = Math.ceil,
        clearTimeout = context.clearTimeout,
        floor = Math.floor,
        getPrototypeOf = isNative(getPrototypeOf = Object.getPrototypeOf) && getPrototypeOf,
        push = arrayProto.push,
        propertyIsEnumerable = objectProto.propertyIsEnumerable,
        Set = isNative(Set = context.Set) && Set,
        setTimeout = context.setTimeout,
        splice = arrayProto.splice,
        Uint8Array = isNative(Uint8Array = context.Uint8Array) && Uint8Array,
        WeakMap = isNative(WeakMap = context.WeakMap) && WeakMap;

    /** Used to clone array buffers. */
    var Float64Array = (function() {
      // Safari 5 errors when using an array buffer to initialize a typed array
      // where the array buffer's `byteLength` is not a multiple of the typed
      // array's `BYTES_PER_ELEMENT`.
      try {
        var func = isNative(func = context.Float64Array) && func,
            result = new func(new ArrayBuffer(10), 0, 1) && func;
      } catch(e) {}
      return result;
    }());

    /* Native method references for those with the same name as other `lodash` methods. */
    var nativeIsArray = isNative(nativeIsArray = Array.isArray) && nativeIsArray,
        nativeCreate = isNative(nativeCreate = Object.create) && nativeCreate,
        nativeIsFinite = context.isFinite,
        nativeKeys = isNative(nativeKeys = Object.keys) && nativeKeys,
        nativeMax = Math.max,
        nativeMin = Math.min,
        nativeNow = isNative(nativeNow = Date.now) && nativeNow,
        nativeNumIsFinite = isNative(nativeNumIsFinite = Number.isFinite) && nativeNumIsFinite,
        nativeParseInt = context.parseInt,
        nativeRandom = Math.random;

    /** Used as references for `-Infinity` and `Infinity`. */
    var NEGATIVE_INFINITY = Number.NEGATIVE_INFINITY,
        POSITIVE_INFINITY = Number.POSITIVE_INFINITY;

    /** Used as references for the maximum length and index of an array. */
    var MAX_ARRAY_LENGTH = Math.pow(2, 32) - 1,
        MAX_ARRAY_INDEX =  MAX_ARRAY_LENGTH - 1,
        HALF_MAX_ARRAY_LENGTH = MAX_ARRAY_LENGTH >>> 1;

    /** Used as the size, in bytes, of each `Float64Array` element. */
    var FLOAT64_BYTES_PER_ELEMENT = Float64Array ? Float64Array.BYTES_PER_ELEMENT : 0;

    /**
     * Used as the maximum length of an array-like value.
     * See the [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-number.max_safe_integer)
     * for more details.
     */
    var MAX_SAFE_INTEGER = Math.pow(2, 53) - 1;

    /** Used to store function metadata. */
    var metaMap = WeakMap && new WeakMap;

    /*------------------------------------------------------------------------*/

    /**
     * Creates a `lodash` object which wraps `value` to enable implicit chaining.
     * Methods that operate on and return arrays, collections, and functions can
     * be chained together. Methods that return a boolean or single value will
     * automatically end the chain returning the unwrapped value. Explicit chaining
     * may be enabled using `_.chain`. The execution of chained methods is lazy,
     * that is, execution is deferred until `_#value` is implicitly or explicitly
     * called.
     *
     * Lazy evaluation allows several methods to support shortcut fusion. Shortcut
     * fusion is an optimization that merges iteratees to avoid creating intermediate
     * arrays and reduce the number of iteratee executions.
     *
     * Chaining is supported in custom builds as long as the `_#value` method is
     * directly or indirectly included in the build.
     *
     * In addition to lodash methods, wrappers also have the following `Array` methods:
     * `concat`, `join`, `pop`, `push`, `reverse`, `shift`, `slice`, `sort`, `splice`,
     * and `unshift`
     *
     * The wrapper methods that support shortcut fusion are:
     * `compact`, `drop`, `dropRight`, `dropRightWhile`, `dropWhile`, `filter`,
     * `first`, `initial`, `last`, `map`, `pluck`, `reject`, `rest`, `reverse`,
     * `slice`, `take`, `takeRight`, `takeRightWhile`, `takeWhile`, `toArray`,
     * and `where`
     *
     * The chainable wrapper methods are:
     * `after`, `ary`, `assign`, `at`, `before`, `bind`, `bindAll`, `bindKey`,
     * `callback`, `chain`, `chunk`, `commit`, `compact`, `concat`, `constant`,
     * `countBy`, `create`, `curry`, `debounce`, `defaults`, `defer`, `delay`,
     * `difference`, `drop`, `dropRight`, `dropRightWhile`, `dropWhile`, `fill`,
     * `filter`, `flatten`, `flattenDeep`, `flow`, `flowRight`, `forEach`,
     * `forEachRight`, `forIn`, `forInRight`, `forOwn`, `forOwnRight`, `functions`,
     * `groupBy`, `indexBy`, `initial`, `intersection`, `invert`, `invoke`, `keys`,
     * `keysIn`, `map`, `mapValues`, `matches`, `matchesProperty`, `memoize`, `merge`,
     * `mixin`, `negate`, `noop`, `omit`, `once`, `pairs`, `partial`, `partialRight`,
     * `partition`, `pick`, `plant`, `pluck`, `property`, `propertyOf`, `pull`,
     * `pullAt`, `push`, `range`, `rearg`, `reject`, `remove`, `rest`, `reverse`,
     * `shuffle`, `slice`, `sort`, `sortBy`, `sortByAll`, `sortByOrder`, `splice`,
     * `spread`, `take`, `takeRight`, `takeRightWhile`, `takeWhile`, `tap`,
     * `throttle`, `thru`, `times`, `toArray`, `toPlainObject`, `transform`,
     * `union`, `uniq`, `unshift`, `unzip`, `values`, `valuesIn`, `where`,
     * `without`, `wrap`, `xor`, `zip`, and `zipObject`
     *
     * The wrapper methods that are **not** chainable by default are:
     * `add`, `attempt`, `camelCase`, `capitalize`, `clone`, `cloneDeep`, `deburr`,
     * `endsWith`, `escape`, `escapeRegExp`, `every`, `find`, `findIndex`, `findKey`,
     * `findLast`, `findLastIndex`, `findLastKey`, `findWhere`, `first`, `has`,
     * `identity`, `includes`, `indexOf`, `inRange`, `isArguments`, `isArray`,
     * `isBoolean`, `isDate`, `isElement`, `isEmpty`, `isEqual`, `isError`,
     * `isFinite`,`isFunction`, `isMatch`, `isNative`, `isNaN`, `isNull`, `isNumber`,
     * `isObject`, `isPlainObject`, `isRegExp`, `isString`, `isUndefined`,
     * `isTypedArray`, `join`, `kebabCase`, `last`, `lastIndexOf`, `max`, `min`,
     * `noConflict`, `now`, `pad`, `padLeft`, `padRight`, `parseInt`, `pop`,
     * `random`, `reduce`, `reduceRight`, `repeat`, `result`, `runInContext`,
     * `shift`, `size`, `snakeCase`, `some`, `sortedIndex`, `sortedLastIndex`,
     * `startCase`, `startsWith`, `sum`, `template`, `trim`, `trimLeft`,
     * `trimRight`, `trunc`, `unescape`, `uniqueId`, `value`, and `words`
     *
     * The wrapper method `sample` will return a wrapped value when `n` is provided,
     * otherwise an unwrapped value is returned.
     *
     * @name _
     * @constructor
     * @category Chain
     * @param {*} value The value to wrap in a `lodash` instance.
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var wrapped = _([1, 2, 3]);
     *
     * // returns an unwrapped value
     * wrapped.reduce(function(sum, n) {
     *   return sum + n;
     * });
     * // => 6
     *
     * // returns a wrapped value
     * var squares = wrapped.map(function(n) {
     *   return n * n;
     * });
     *
     * _.isArray(squares);
     * // => false
     *
     * _.isArray(squares.value());
     * // => true
     */
    function lodash(value) {
      if (isObjectLike(value) && !isArray(value) && !(value instanceof LazyWrapper)) {
        if (value instanceof LodashWrapper) {
          return value;
        }
        if (hasOwnProperty.call(value, '__chain__') && hasOwnProperty.call(value, '__wrapped__')) {
          return wrapperClone(value);
        }
      }
      return new LodashWrapper(value);
    }

    /**
     * The function whose prototype all chaining wrappers inherit from.
     *
     * @private
     */
    function baseLodash() {
      // No operation performed.
    }

    /**
     * The base constructor for creating `lodash` wrapper objects.
     *
     * @private
     * @param {*} value The value to wrap.
     * @param {boolean} [chainAll] Enable chaining for all wrapper methods.
     * @param {Array} [actions=[]] Actions to peform to resolve the unwrapped value.
     */
    function LodashWrapper(value, chainAll, actions) {
      this.__wrapped__ = value;
      this.__actions__ = actions || [];
      this.__chain__ = !!chainAll;
    }

    /**
     * An object environment feature flags.
     *
     * @static
     * @memberOf _
     * @type Object
     */
    var support = lodash.support = {};

    (function(x) {

      /**
       * Detect if functions can be decompiled by `Function#toString`
       * (all but Firefox OS certified apps, older Opera mobile browsers, and
       * the PlayStation 3; forced `false` for Windows 8 apps).
       *
       * @memberOf _.support
       * @type boolean
       */
      support.funcDecomp = !isNative(context.WinRTError) && reThis.test(runInContext);

      /**
       * Detect if `Function#name` is supported (all but IE).
       *
       * @memberOf _.support
       * @type boolean
       */
      support.funcNames = typeof Function.name == 'string';

      /**
       * Detect if the DOM is supported.
       *
       * @memberOf _.support
       * @type boolean
       */
      try {
        support.dom = document.createDocumentFragment().nodeType === 11;
      } catch(e) {
        support.dom = false;
      }

      /**
       * Detect if `arguments` object indexes are non-enumerable.
       *
       * In Firefox < 4, IE < 9, PhantomJS, and Safari < 5.1 `arguments` object
       * indexes are non-enumerable. Chrome < 25 and Node.js < 0.11.0 treat
       * `arguments` object indexes as non-enumerable and fail `hasOwnProperty`
       * checks for indexes that exceed their function's formal parameters with
       * associated values of `0`.
       *
       * @memberOf _.support
       * @type boolean
       */
      try {
        support.nonEnumArgs = !propertyIsEnumerable.call(arguments, 1);
      } catch(e) {
        support.nonEnumArgs = true;
      }
    }(0, 0));

    /**
     * By default, the template delimiters used by lodash are like those in
     * embedded Ruby (ERB). Change the following template settings to use
     * alternative delimiters.
     *
     * @static
     * @memberOf _
     * @type Object
     */
    lodash.templateSettings = {

      /**
       * Used to detect `data` property values to be HTML-escaped.
       *
       * @memberOf _.templateSettings
       * @type RegExp
       */
      'escape': reEscape,

      /**
       * Used to detect code to be evaluated.
       *
       * @memberOf _.templateSettings
       * @type RegExp
       */
      'evaluate': reEvaluate,

      /**
       * Used to detect `data` property values to inject.
       *
       * @memberOf _.templateSettings
       * @type RegExp
       */
      'interpolate': reInterpolate,

      /**
       * Used to reference the data object in the template text.
       *
       * @memberOf _.templateSettings
       * @type string
       */
      'variable': '',

      /**
       * Used to import variables into the compiled template.
       *
       * @memberOf _.templateSettings
       * @type Object
       */
      'imports': {

        /**
         * A reference to the `lodash` function.
         *
         * @memberOf _.templateSettings.imports
         * @type Function
         */
        '_': lodash
      }
    };

    /*------------------------------------------------------------------------*/

    /**
     * Creates a lazy wrapper object which wraps `value` to enable lazy evaluation.
     *
     * @private
     * @param {*} value The value to wrap.
     */
    function LazyWrapper(value) {
      this.__wrapped__ = value;
      this.__actions__ = null;
      this.__dir__ = 1;
      this.__dropCount__ = 0;
      this.__filtered__ = false;
      this.__iteratees__ = null;
      this.__takeCount__ = POSITIVE_INFINITY;
      this.__views__ = null;
    }

    /**
     * Creates a clone of the lazy wrapper object.
     *
     * @private
     * @name clone
     * @memberOf LazyWrapper
     * @returns {Object} Returns the cloned `LazyWrapper` object.
     */
    function lazyClone() {
      var actions = this.__actions__,
          iteratees = this.__iteratees__,
          views = this.__views__,
          result = new LazyWrapper(this.__wrapped__);

      result.__actions__ = actions ? arrayCopy(actions) : null;
      result.__dir__ = this.__dir__;
      result.__dropCount__ = this.__dropCount__;
      result.__filtered__ = this.__filtered__;
      result.__iteratees__ = iteratees ? arrayCopy(iteratees) : null;
      result.__takeCount__ = this.__takeCount__;
      result.__views__ = views ? arrayCopy(views) : null;
      return result;
    }

    /**
     * Reverses the direction of lazy iteration.
     *
     * @private
     * @name reverse
     * @memberOf LazyWrapper
     * @returns {Object} Returns the new reversed `LazyWrapper` object.
     */
    function lazyReverse() {
      if (this.__filtered__) {
        var result = new LazyWrapper(this);
        result.__dir__ = -1;
        result.__filtered__ = true;
      } else {
        result = this.clone();
        result.__dir__ *= -1;
      }
      return result;
    }

    /**
     * Extracts the unwrapped value from its lazy wrapper.
     *
     * @private
     * @name value
     * @memberOf LazyWrapper
     * @returns {*} Returns the unwrapped value.
     */
    function lazyValue() {
      var array = this.__wrapped__.value();
      if (!isArray(array)) {
        return baseWrapperValue(array, this.__actions__);
      }
      var dir = this.__dir__,
          isRight = dir < 0,
          view = getView(0, array.length, this.__views__),
          start = view.start,
          end = view.end,
          length = end - start,
          dropCount = this.__dropCount__,
          takeCount = nativeMin(length, this.__takeCount__),
          index = isRight ? end : start - 1,
          iteratees = this.__iteratees__,
          iterLength = iteratees ? iteratees.length : 0,
          resIndex = 0,
          result = [];

      outer:
      while (length-- && resIndex < takeCount) {
        index += dir;

        var iterIndex = -1,
            value = array[index];

        while (++iterIndex < iterLength) {
          var data = iteratees[iterIndex],
              iteratee = data.iteratee,
              type = data.type;

          if (type != LAZY_DROP_WHILE_FLAG) {
            var computed = iteratee(value);
          } else {
            data.done = data.done && (isRight ? index < data.index : index > data.index);
            data.index = index;
            computed = data.done || (data.done = !iteratee(value));
          }
          if (type == LAZY_MAP_FLAG) {
            value = computed;
          } else if (!computed) {
            if (type == LAZY_TAKE_WHILE_FLAG) {
              break outer;
            } else {
              continue outer;
            }
          }
        }
        if (dropCount) {
          dropCount--;
        } else {
          result[resIndex++] = value;
        }
      }
      return result;
    }

    /*------------------------------------------------------------------------*/

    /**
     * Creates a cache object to store key/value pairs.
     *
     * @private
     * @static
     * @name Cache
     * @memberOf _.memoize
     */
    function MapCache() {
      this.__data__ = {};
    }

    /**
     * Removes `key` and its value from the cache.
     *
     * @private
     * @name delete
     * @memberOf _.memoize.Cache
     * @param {string} key The key of the value to remove.
     * @returns {boolean} Returns `true` if the entry was removed successfully, else `false`.
     */
    function mapDelete(key) {
      return this.has(key) && delete this.__data__[key];
    }

    /**
     * Gets the cached value for `key`.
     *
     * @private
     * @name get
     * @memberOf _.memoize.Cache
     * @param {string} key The key of the value to get.
     * @returns {*} Returns the cached value.
     */
    function mapGet(key) {
      return key == '__proto__' ? undefined : this.__data__[key];
    }

    /**
     * Checks if a cached value for `key` exists.
     *
     * @private
     * @name has
     * @memberOf _.memoize.Cache
     * @param {string} key The key of the entry to check.
     * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
     */
    function mapHas(key) {
      return key != '__proto__' && hasOwnProperty.call(this.__data__, key);
    }

    /**
     * Adds `value` to `key` of the cache.
     *
     * @private
     * @name set
     * @memberOf _.memoize.Cache
     * @param {string} key The key of the value to cache.
     * @param {*} value The value to cache.
     * @returns {Object} Returns the cache object.
     */
    function mapSet(key, value) {
      if (key != '__proto__') {
        this.__data__[key] = value;
      }
      return this;
    }

    /*------------------------------------------------------------------------*/

    /**
     *
     * Creates a cache object to store unique values.
     *
     * @private
     * @param {Array} [values] The values to cache.
     */
    function SetCache(values) {
      var length = values ? values.length : 0;

      this.data = { 'hash': nativeCreate(null), 'set': new Set };
      while (length--) {
        this.push(values[length]);
      }
    }

    /**
     * Checks if `value` is in `cache` mimicking the return signature of
     * `_.indexOf` by returning `0` if the value is found, else `-1`.
     *
     * @private
     * @param {Object} cache The cache to search.
     * @param {*} value The value to search for.
     * @returns {number} Returns `0` if `value` is found, else `-1`.
     */
    function cacheIndexOf(cache, value) {
      var data = cache.data,
          result = (typeof value == 'string' || isObject(value)) ? data.set.has(value) : data.hash[value];

      return result ? 0 : -1;
    }

    /**
     * Adds `value` to the cache.
     *
     * @private
     * @name push
     * @memberOf SetCache
     * @param {*} value The value to cache.
     */
    function cachePush(value) {
      var data = this.data;
      if (typeof value == 'string' || isObject(value)) {
        data.set.add(value);
      } else {
        data.hash[value] = true;
      }
    }

    /*------------------------------------------------------------------------*/

    /**
     * Copies the values of `source` to `array`.
     *
     * @private
     * @param {Array} source The array to copy values from.
     * @param {Array} [array=[]] The array to copy values to.
     * @returns {Array} Returns `array`.
     */
    function arrayCopy(source, array) {
      var index = -1,
          length = source.length;

      array || (array = Array(length));
      while (++index < length) {
        array[index] = source[index];
      }
      return array;
    }

    /**
     * A specialized version of `_.forEach` for arrays without support for callback
     * shorthands or `this` binding.
     *
     * @private
     * @param {Array} array The array to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Array} Returns `array`.
     */
    function arrayEach(array, iteratee) {
      var index = -1,
          length = array.length;

      while (++index < length) {
        if (iteratee(array[index], index, array) === false) {
          break;
        }
      }
      return array;
    }

    /**
     * A specialized version of `_.forEachRight` for arrays without support for
     * callback shorthands or `this` binding.
     *
     * @private
     * @param {Array} array The array to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Array} Returns `array`.
     */
    function arrayEachRight(array, iteratee) {
      var length = array.length;

      while (length--) {
        if (iteratee(array[length], length, array) === false) {
          break;
        }
      }
      return array;
    }

    /**
     * A specialized version of `_.every` for arrays without support for callback
     * shorthands or `this` binding.
     *
     * @private
     * @param {Array} array The array to iterate over.
     * @param {Function} predicate The function invoked per iteration.
     * @returns {boolean} Returns `true` if all elements pass the predicate check,
     *  else `false`.
     */
    function arrayEvery(array, predicate) {
      var index = -1,
          length = array.length;

      while (++index < length) {
        if (!predicate(array[index], index, array)) {
          return false;
        }
      }
      return true;
    }

    /**
     * A specialized version of `_.filter` for arrays without support for callback
     * shorthands or `this` binding.
     *
     * @private
     * @param {Array} array The array to iterate over.
     * @param {Function} predicate The function invoked per iteration.
     * @returns {Array} Returns the new filtered array.
     */
    function arrayFilter(array, predicate) {
      var index = -1,
          length = array.length,
          resIndex = -1,
          result = [];

      while (++index < length) {
        var value = array[index];
        if (predicate(value, index, array)) {
          result[++resIndex] = value;
        }
      }
      return result;
    }

    /**
     * A specialized version of `_.map` for arrays without support for callback
     * shorthands or `this` binding.
     *
     * @private
     * @param {Array} array The array to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Array} Returns the new mapped array.
     */
    function arrayMap(array, iteratee) {
      var index = -1,
          length = array.length,
          result = Array(length);

      while (++index < length) {
        result[index] = iteratee(array[index], index, array);
      }
      return result;
    }

    /**
     * A specialized version of `_.max` for arrays without support for iteratees.
     *
     * @private
     * @param {Array} array The array to iterate over.
     * @returns {*} Returns the maximum value.
     */
    function arrayMax(array) {
      var index = -1,
          length = array.length,
          result = NEGATIVE_INFINITY;

      while (++index < length) {
        var value = array[index];
        if (value > result) {
          result = value;
        }
      }
      return result;
    }

    /**
     * A specialized version of `_.min` for arrays without support for iteratees.
     *
     * @private
     * @param {Array} array The array to iterate over.
     * @returns {*} Returns the minimum value.
     */
    function arrayMin(array) {
      var index = -1,
          length = array.length,
          result = POSITIVE_INFINITY;

      while (++index < length) {
        var value = array[index];
        if (value < result) {
          result = value;
        }
      }
      return result;
    }

    /**
     * A specialized version of `_.reduce` for arrays without support for callback
     * shorthands or `this` binding.
     *
     * @private
     * @param {Array} array The array to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @param {*} [accumulator] The initial value.
     * @param {boolean} [initFromArray] Specify using the first element of `array`
     *  as the initial value.
     * @returns {*} Returns the accumulated value.
     */
    function arrayReduce(array, iteratee, accumulator, initFromArray) {
      var index = -1,
          length = array.length;

      if (initFromArray && length) {
        accumulator = array[++index];
      }
      while (++index < length) {
        accumulator = iteratee(accumulator, array[index], index, array);
      }
      return accumulator;
    }

    /**
     * A specialized version of `_.reduceRight` for arrays without support for
     * callback shorthands or `this` binding.
     *
     * @private
     * @param {Array} array The array to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @param {*} [accumulator] The initial value.
     * @param {boolean} [initFromArray] Specify using the last element of `array`
     *  as the initial value.
     * @returns {*} Returns the accumulated value.
     */
    function arrayReduceRight(array, iteratee, accumulator, initFromArray) {
      var length = array.length;
      if (initFromArray && length) {
        accumulator = array[--length];
      }
      while (length--) {
        accumulator = iteratee(accumulator, array[length], length, array);
      }
      return accumulator;
    }

    /**
     * A specialized version of `_.some` for arrays without support for callback
     * shorthands or `this` binding.
     *
     * @private
     * @param {Array} array The array to iterate over.
     * @param {Function} predicate The function invoked per iteration.
     * @returns {boolean} Returns `true` if any element passes the predicate check,
     *  else `false`.
     */
    function arraySome(array, predicate) {
      var index = -1,
          length = array.length;

      while (++index < length) {
        if (predicate(array[index], index, array)) {
          return true;
        }
      }
      return false;
    }

    /**
     * Used by `_.defaults` to customize its `_.assign` use.
     *
     * @private
     * @param {*} objectValue The destination object property value.
     * @param {*} sourceValue The source object property value.
     * @returns {*} Returns the value to assign to the destination object.
     */
    function assignDefaults(objectValue, sourceValue) {
      return typeof objectValue == 'undefined' ? sourceValue : objectValue;
    }

    /**
     * Used by `_.template` to customize its `_.assign` use.
     *
     * **Note:** This method is like `assignDefaults` except that it ignores
     * inherited property values when checking if a property is `undefined`.
     *
     * @private
     * @param {*} objectValue The destination object property value.
     * @param {*} sourceValue The source object property value.
     * @param {string} key The key associated with the object and source values.
     * @param {Object} object The destination object.
     * @returns {*} Returns the value to assign to the destination object.
     */
    function assignOwnDefaults(objectValue, sourceValue, key, object) {
      return (typeof objectValue == 'undefined' || !hasOwnProperty.call(object, key))
        ? sourceValue
        : objectValue;
    }

    /**
     * The base implementation of `_.assign` without support for argument juggling,
     * multiple sources, and `this` binding `customizer` functions.
     *
     * @private
     * @param {Object} object The destination object.
     * @param {Object} source The source object.
     * @param {Function} [customizer] The function to customize assigning values.
     * @returns {Object} Returns the destination object.
     */
    function baseAssign(object, source, customizer) {
      var props = keys(source);
      if (!customizer) {
        return baseCopy(source, object, props);
      }
      var index = -1,
          length = props.length;

      while (++index < length) {
        var key = props[index],
            value = object[key],
            result = customizer(value, source[key], key, object, source);

        if ((result === result ? result !== value : value === value) ||
            (typeof value == 'undefined' && !(key in object))) {
          object[key] = result;
        }
      }
      return object;
    }

    /**
     * The base implementation of `_.at` without support for strings and individual
     * key arguments.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {number[]|string[]} [props] The property names or indexes of elements to pick.
     * @returns {Array} Returns the new array of picked elements.
     */
    function baseAt(collection, props) {
      var index = -1,
          length = collection.length,
          isArr = isLength(length),
          propsLength = props.length,
          result = Array(propsLength);

      while(++index < propsLength) {
        var key = props[index];
        if (isArr) {
          key = parseFloat(key);
          result[index] = isIndex(key, length) ? collection[key] : undefined;
        } else {
          result[index] = collection[key];
        }
      }
      return result;
    }

    /**
     * Copies the properties of `source` to `object`.
     *
     * @private
     * @param {Object} source The object to copy properties from.
     * @param {Object} [object={}] The object to copy properties to.
     * @param {Array} props The property names to copy.
     * @returns {Object} Returns `object`.
     */
    function baseCopy(source, object, props) {
      if (!props) {
        props = object;
        object = {};
      }
      var index = -1,
          length = props.length;

      while (++index < length) {
        var key = props[index];
        object[key] = source[key];
      }
      return object;
    }

    /**
     * The base implementation of `_.bindAll` without support for individual
     * method name arguments.
     *
     * @private
     * @param {Object} object The object to bind and assign the bound methods to.
     * @param {string[]} methodNames The object method names to bind.
     * @returns {Object} Returns `object`.
     */
    function baseBindAll(object, methodNames) {
      var index = -1,
          length = methodNames.length;

      while (++index < length) {
        var key = methodNames[index];
        object[key] = createWrapper(object[key], BIND_FLAG, object);
      }
      return object;
    }

    /**
     * The base implementation of `_.callback` which supports specifying the
     * number of arguments to provide to `func`.
     *
     * @private
     * @param {*} [func=_.identity] The value to convert to a callback.
     * @param {*} [thisArg] The `this` binding of `func`.
     * @param {number} [argCount] The number of arguments to provide to `func`.
     * @returns {Function} Returns the callback.
     */
    function baseCallback(func, thisArg, argCount) {
      var type = typeof func;
      if (type == 'function') {
        return (typeof thisArg != 'undefined' && isBindable(func))
          ? bindCallback(func, thisArg, argCount)
          : func;
      }
      if (func == null) {
        return identity;
      }
      if (type == 'object') {
        return baseMatches(func);
      }
      return typeof thisArg == 'undefined'
        ? baseProperty(func + '')
        : baseMatchesProperty(func + '', thisArg);
    }

    /**
     * The base implementation of `_.clone` without support for argument juggling
     * and `this` binding `customizer` functions.
     *
     * @private
     * @param {*} value The value to clone.
     * @param {boolean} [isDeep] Specify a deep clone.
     * @param {Function} [customizer] The function to customize cloning values.
     * @param {string} [key] The key of `value`.
     * @param {Object} [object] The object `value` belongs to.
     * @param {Array} [stackA=[]] Tracks traversed source objects.
     * @param {Array} [stackB=[]] Associates clones with source counterparts.
     * @returns {*} Returns the cloned value.
     */
    function baseClone(value, isDeep, customizer, key, object, stackA, stackB) {
      var result;
      if (customizer) {
        result = object ? customizer(value, key, object) : customizer(value);
      }
      if (typeof result != 'undefined') {
        return result;
      }
      if (!isObject(value)) {
        return value;
      }
      var isArr = isArray(value);
      if (isArr) {
        result = initCloneArray(value);
        if (!isDeep) {
          return arrayCopy(value, result);
        }
      } else {
        var tag = objToString.call(value),
            isFunc = tag == funcTag;

        if (tag == objectTag || tag == argsTag || (isFunc && !object)) {
          result = initCloneObject(isFunc ? {} : value);
          if (!isDeep) {
            return baseCopy(value, result, keys(value));
          }
        } else {
          return cloneableTags[tag]
            ? initCloneByTag(value, tag, isDeep)
            : (object ? value : {});
        }
      }
      // Check for circular references and return corresponding clone.
      stackA || (stackA = []);
      stackB || (stackB = []);

      var length = stackA.length;
      while (length--) {
        if (stackA[length] == value) {
          return stackB[length];
        }
      }
      // Add the source value to the stack of traversed objects and associate it with its clone.
      stackA.push(value);
      stackB.push(result);

      // Recursively populate clone (susceptible to call stack limits).
      (isArr ? arrayEach : baseForOwn)(value, function(subValue, key) {
        result[key] = baseClone(subValue, isDeep, customizer, key, value, stackA, stackB);
      });
      return result;
    }

    /**
     * The base implementation of `_.create` without support for assigning
     * properties to the created object.
     *
     * @private
     * @param {Object} prototype The object to inherit from.
     * @returns {Object} Returns the new object.
     */
    var baseCreate = (function() {
      function Object() {}
      return function(prototype) {
        if (isObject(prototype)) {
          Object.prototype = prototype;
          var result = new Object;
          Object.prototype = null;
        }
        return result || context.Object();
      };
    }());

    /**
     * The base implementation of `_.delay` and `_.defer` which accepts an index
     * of where to slice the arguments to provide to `func`.
     *
     * @private
     * @param {Function} func The function to delay.
     * @param {number} wait The number of milliseconds to delay invocation.
     * @param {Object} args The `arguments` object to slice and provide to `func`.
     * @returns {number} Returns the timer id.
     */
    function baseDelay(func, wait, args, fromIndex) {
      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      return setTimeout(function() { func.apply(undefined, baseSlice(args, fromIndex)); }, wait);
    }

    /**
     * The base implementation of `_.difference` which accepts a single array
     * of values to exclude.
     *
     * @private
     * @param {Array} array The array to inspect.
     * @param {Array} values The values to exclude.
     * @returns {Array} Returns the new array of filtered values.
     */
    function baseDifference(array, values) {
      var length = array ? array.length : 0,
          result = [];

      if (!length) {
        return result;
      }
      var index = -1,
          indexOf = getIndexOf(),
          isCommon = indexOf == baseIndexOf,
          cache = (isCommon && values.length >= 200) ? createCache(values) : null,
          valuesLength = values.length;

      if (cache) {
        indexOf = cacheIndexOf;
        isCommon = false;
        values = cache;
      }
      outer:
      while (++index < length) {
        var value = array[index];

        if (isCommon && value === value) {
          var valuesIndex = valuesLength;
          while (valuesIndex--) {
            if (values[valuesIndex] === value) {
              continue outer;
            }
          }
          result.push(value);
        }
        else if (indexOf(values, value, 0) < 0) {
          result.push(value);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.forEach` without support for callback
     * shorthands and `this` binding.
     *
     * @private
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Array|Object|string} Returns `collection`.
     */
    function baseEach(collection, iteratee) {
      var length = collection ? collection.length : 0;
      if (!isLength(length)) {
        return baseForOwn(collection, iteratee);
      }
      var index = -1,
          iterable = toObject(collection);

      while (++index < length) {
        if (iteratee(iterable[index], index, iterable) === false) {
          break;
        }
      }
      return collection;
    }

    /**
     * The base implementation of `_.forEachRight` without support for callback
     * shorthands and `this` binding.
     *
     * @private
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Array|Object|string} Returns `collection`.
     */
    function baseEachRight(collection, iteratee) {
      var length = collection ? collection.length : 0;
      if (!isLength(length)) {
        return baseForOwnRight(collection, iteratee);
      }
      var iterable = toObject(collection);
      while (length--) {
        if (iteratee(iterable[length], length, iterable) === false) {
          break;
        }
      }
      return collection;
    }

    /**
     * The base implementation of `_.every` without support for callback
     * shorthands or `this` binding.
     *
     * @private
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} predicate The function invoked per iteration.
     * @returns {boolean} Returns `true` if all elements pass the predicate check,
     *  else `false`
     */
    function baseEvery(collection, predicate) {
      var result = true;
      baseEach(collection, function(value, index, collection) {
        result = !!predicate(value, index, collection);
        return result;
      });
      return result;
    }

    /**
     * The base implementation of `_.fill` without an iteratee call guard.
     *
     * @private
     * @param {Array} array The array to fill.
     * @param {*} value The value to fill `array` with.
     * @param {number} [start=0] The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns `array`.
     */
    function baseFill(array, value, start, end) {
      var length = array.length;

      start = start == null ? 0 : (+start || 0);
      if (start < 0) {
        start = -start > length ? 0 : (length + start);
      }
      end = (typeof end == 'undefined' || end > length) ? length : (+end || 0);
      if (end < 0) {
        end += length;
      }
      length = start > end ? 0 : end >>> 0;
      start >>>= 0;

      while (start < length) {
        array[start++] = value;
      }
      return array;
    }

    /**
     * The base implementation of `_.filter` without support for callback
     * shorthands or `this` binding.
     *
     * @private
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} predicate The function invoked per iteration.
     * @returns {Array} Returns the new filtered array.
     */
    function baseFilter(collection, predicate) {
      var result = [];
      baseEach(collection, function(value, index, collection) {
        if (predicate(value, index, collection)) {
          result.push(value);
        }
      });
      return result;
    }

    /**
     * The base implementation of `_.find`, `_.findLast`, `_.findKey`, and `_.findLastKey`,
     * without support for callback shorthands and `this` binding, which iterates
     * over `collection` using the provided `eachFunc`.
     *
     * @private
     * @param {Array|Object|string} collection The collection to search.
     * @param {Function} predicate The function invoked per iteration.
     * @param {Function} eachFunc The function to iterate over `collection`.
     * @param {boolean} [retKey] Specify returning the key of the found element
     *  instead of the element itself.
     * @returns {*} Returns the found element or its key, else `undefined`.
     */
    function baseFind(collection, predicate, eachFunc, retKey) {
      var result;
      eachFunc(collection, function(value, key, collection) {
        if (predicate(value, key, collection)) {
          result = retKey ? key : value;
          return false;
        }
      });
      return result;
    }

    /**
     * The base implementation of `_.flatten` with added support for restricting
     * flattening and specifying the start index.
     *
     * @private
     * @param {Array} array The array to flatten.
     * @param {boolean} isDeep Specify a deep flatten.
     * @param {boolean} isStrict Restrict flattening to arrays and `arguments` objects.
     * @param {number} fromIndex The index to start from.
     * @returns {Array} Returns the new flattened array.
     */
    function baseFlatten(array, isDeep, isStrict, fromIndex) {
      var index = fromIndex - 1,
          length = array.length,
          resIndex = -1,
          result = [];

      while (++index < length) {
        var value = array[index];

        if (isObjectLike(value) && isLength(value.length) && (isArray(value) || isArguments(value))) {
          if (isDeep) {
            // Recursively flatten arrays (susceptible to call stack limits).
            value = baseFlatten(value, isDeep, isStrict, 0);
          }
          var valIndex = -1,
              valLength = value.length;

          result.length += valLength;
          while (++valIndex < valLength) {
            result[++resIndex] = value[valIndex];
          }
        } else if (!isStrict) {
          result[++resIndex] = value;
        }
      }
      return result;
    }

    /**
     * The base implementation of `baseForIn` and `baseForOwn` which iterates
     * over `object` properties returned by `keysFunc` invoking `iteratee` for
     * each property. Iterator functions may exit iteration early by explicitly
     * returning `false`.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @param {Function} keysFunc The function to get the keys of `object`.
     * @returns {Object} Returns `object`.
     */
    function baseFor(object, iteratee, keysFunc) {
      var index = -1,
          iterable = toObject(object),
          props = keysFunc(object),
          length = props.length;

      while (++index < length) {
        var key = props[index];
        if (iteratee(iterable[key], key, iterable) === false) {
          break;
        }
      }
      return object;
    }

    /**
     * This function is like `baseFor` except that it iterates over properties
     * in the opposite order.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @param {Function} keysFunc The function to get the keys of `object`.
     * @returns {Object} Returns `object`.
     */
    function baseForRight(object, iteratee, keysFunc) {
      var iterable = toObject(object),
          props = keysFunc(object),
          length = props.length;

      while (length--) {
        var key = props[length];
        if (iteratee(iterable[key], key, iterable) === false) {
          break;
        }
      }
      return object;
    }

    /**
     * The base implementation of `_.forIn` without support for callback
     * shorthands and `this` binding.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Object} Returns `object`.
     */
    function baseForIn(object, iteratee) {
      return baseFor(object, iteratee, keysIn);
    }

    /**
     * The base implementation of `_.forOwn` without support for callback
     * shorthands and `this` binding.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Object} Returns `object`.
     */
    function baseForOwn(object, iteratee) {
      return baseFor(object, iteratee, keys);
    }

    /**
     * The base implementation of `_.forOwnRight` without support for callback
     * shorthands and `this` binding.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Object} Returns `object`.
     */
    function baseForOwnRight(object, iteratee) {
      return baseForRight(object, iteratee, keys);
    }

    /**
     * The base implementation of `_.functions` which creates an array of
     * `object` function property names filtered from those provided.
     *
     * @private
     * @param {Object} object The object to inspect.
     * @param {Array} props The property names to filter.
     * @returns {Array} Returns the new array of filtered property names.
     */
    function baseFunctions(object, props) {
      var index = -1,
          length = props.length,
          resIndex = -1,
          result = [];

      while (++index < length) {
        var key = props[index];
        if (isFunction(object[key])) {
          result[++resIndex] = key;
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.invoke` which requires additional arguments
     * to be provided as an array of arguments rather than individually.
     *
     * @private
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|string} methodName The name of the method to invoke or
     *  the function invoked per iteration.
     * @param {Array} [args] The arguments to invoke the method with.
     * @returns {Array} Returns the array of results.
     */
    function baseInvoke(collection, methodName, args) {
      var index = -1,
          isFunc = typeof methodName == 'function',
          length = collection ? collection.length : 0,
          result = isLength(length) ? Array(length) : [];

      baseEach(collection, function(value) {
        var func = isFunc ? methodName : (value != null && value[methodName]);
        result[++index] = func ? func.apply(value, args) : undefined;
      });
      return result;
    }

    /**
     * The base implementation of `_.isEqual` without support for `this` binding
     * `customizer` functions.
     *
     * @private
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @param {Function} [customizer] The function to customize comparing values.
     * @param {boolean} [isWhere] Specify performing partial comparisons.
     * @param {Array} [stackA] Tracks traversed `value` objects.
     * @param {Array} [stackB] Tracks traversed `other` objects.
     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
     */
    function baseIsEqual(value, other, customizer, isWhere, stackA, stackB) {
      // Exit early for identical values.
      if (value === other) {
        // Treat `+0` vs. `-0` as not equal.
        return value !== 0 || (1 / value == 1 / other);
      }
      var valType = typeof value,
          othType = typeof other;

      // Exit early for unlike primitive values.
      if ((valType != 'function' && valType != 'object' && othType != 'function' && othType != 'object') ||
          value == null || other == null) {
        // Return `false` unless both values are `NaN`.
        return value !== value && other !== other;
      }
      return baseIsEqualDeep(value, other, baseIsEqual, customizer, isWhere, stackA, stackB);
    }

    /**
     * A specialized version of `baseIsEqual` for arrays and objects which performs
     * deep comparisons and tracks traversed objects enabling objects with circular
     * references to be compared.
     *
     * @private
     * @param {Object} object The object to compare.
     * @param {Object} other The other object to compare.
     * @param {Function} equalFunc The function to determine equivalents of values.
     * @param {Function} [customizer] The function to customize comparing objects.
     * @param {boolean} [isWhere] Specify performing partial comparisons.
     * @param {Array} [stackA=[]] Tracks traversed `value` objects.
     * @param {Array} [stackB=[]] Tracks traversed `other` objects.
     * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
     */
    function baseIsEqualDeep(object, other, equalFunc, customizer, isWhere, stackA, stackB) {
      var objIsArr = isArray(object),
          othIsArr = isArray(other),
          objTag = arrayTag,
          othTag = arrayTag;

      if (!objIsArr) {
        objTag = objToString.call(object);
        if (objTag == argsTag) {
          objTag = objectTag;
        } else if (objTag != objectTag) {
          objIsArr = isTypedArray(object);
        }
      }
      if (!othIsArr) {
        othTag = objToString.call(other);
        if (othTag == argsTag) {
          othTag = objectTag;
        } else if (othTag != objectTag) {
          othIsArr = isTypedArray(other);
        }
      }
      var objIsObj = objTag == objectTag,
          othIsObj = othTag == objectTag,
          isSameTag = objTag == othTag;

      if (isSameTag && !(objIsArr || objIsObj)) {
        return equalByTag(object, other, objTag);
      }
      var valWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),
          othWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');

      if (valWrapped || othWrapped) {
        return equalFunc(valWrapped ? object.value() : object, othWrapped ? other.value() : other, customizer, isWhere, stackA, stackB);
      }
      if (!isSameTag) {
        return false;
      }
      // Assume cyclic values are equal.
      // For more information on detecting circular references see https://es5.github.io/#JO.
      stackA || (stackA = []);
      stackB || (stackB = []);

      var length = stackA.length;
      while (length--) {
        if (stackA[length] == object) {
          return stackB[length] == other;
        }
      }
      // Add `object` and `other` to the stack of traversed objects.
      stackA.push(object);
      stackB.push(other);

      var result = (objIsArr ? equalArrays : equalObjects)(object, other, equalFunc, customizer, isWhere, stackA, stackB);

      stackA.pop();
      stackB.pop();

      return result;
    }

    /**
     * The base implementation of `_.isMatch` without support for callback
     * shorthands or `this` binding.
     *
     * @private
     * @param {Object} object The object to inspect.
     * @param {Array} props The source property names to match.
     * @param {Array} values The source values to match.
     * @param {Array} strictCompareFlags Strict comparison flags for source values.
     * @param {Function} [customizer] The function to customize comparing objects.
     * @returns {boolean} Returns `true` if `object` is a match, else `false`.
     */
    function baseIsMatch(object, props, values, strictCompareFlags, customizer) {
      var length = props.length;
      if (object == null) {
        return !length;
      }
      var index = -1,
          noCustomizer = !customizer;

      while (++index < length) {
        if ((noCustomizer && strictCompareFlags[index])
              ? values[index] !== object[props[index]]
              : !hasOwnProperty.call(object, props[index])
            ) {
          return false;
        }
      }
      index = -1;
      while (++index < length) {
        var key = props[index];
        if (noCustomizer && strictCompareFlags[index]) {
          var result = hasOwnProperty.call(object, key);
        } else {
          var objValue = object[key],
              srcValue = values[index];

          result = customizer ? customizer(objValue, srcValue, key) : undefined;
          if (typeof result == 'undefined') {
            result = baseIsEqual(srcValue, objValue, customizer, true);
          }
        }
        if (!result) {
          return false;
        }
      }
      return true;
    }

    /**
     * The base implementation of `_.map` without support for callback shorthands
     * or `this` binding.
     *
     * @private
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Array} Returns the new mapped array.
     */
    function baseMap(collection, iteratee) {
      var result = [];
      baseEach(collection, function(value, key, collection) {
        result.push(iteratee(value, key, collection));
      });
      return result;
    }

    /**
     * The base implementation of `_.matches` which does not clone `source`.
     *
     * @private
     * @param {Object} source The object of property values to match.
     * @returns {Function} Returns the new function.
     */
    function baseMatches(source) {
      var props = keys(source),
          length = props.length;

      if (length == 1) {
        var key = props[0],
            value = source[key];

        if (isStrictComparable(value)) {
          return function(object) {
            return object != null && object[key] === value && hasOwnProperty.call(object, key);
          };
        }
      }
      var values = Array(length),
          strictCompareFlags = Array(length);

      while (length--) {
        value = source[props[length]];
        values[length] = value;
        strictCompareFlags[length] = isStrictComparable(value);
      }
      return function(object) {
        return baseIsMatch(object, props, values, strictCompareFlags);
      };
    }

    /**
     * The base implementation of `_.matchesProperty` which does not coerce `key`
     * to a string.
     *
     * @private
     * @param {string} key The key of the property to get.
     * @param {*} value The value to compare.
     * @returns {Function} Returns the new function.
     */
    function baseMatchesProperty(key, value) {
      if (isStrictComparable(value)) {
        return function(object) {
          return object != null && object[key] === value;
        };
      }
      return function(object) {
        return object != null && baseIsEqual(value, object[key], null, true);
      };
    }

    /**
     * The base implementation of `_.merge` without support for argument juggling,
     * multiple sources, and `this` binding `customizer` functions.
     *
     * @private
     * @param {Object} object The destination object.
     * @param {Object} source The source object.
     * @param {Function} [customizer] The function to customize merging properties.
     * @param {Array} [stackA=[]] Tracks traversed source objects.
     * @param {Array} [stackB=[]] Associates values with source counterparts.
     * @returns {Object} Returns the destination object.
     */
    function baseMerge(object, source, customizer, stackA, stackB) {
      if (!isObject(object)) {
        return object;
      }
      var isSrcArr = isLength(source.length) && (isArray(source) || isTypedArray(source));
      (isSrcArr ? arrayEach : baseForOwn)(source, function(srcValue, key, source) {
        if (isObjectLike(srcValue)) {
          stackA || (stackA = []);
          stackB || (stackB = []);
          return baseMergeDeep(object, source, key, baseMerge, customizer, stackA, stackB);
        }
        var value = object[key],
            result = customizer ? customizer(value, srcValue, key, object, source) : undefined,
            isCommon = typeof result == 'undefined';

        if (isCommon) {
          result = srcValue;
        }
        if ((isSrcArr || typeof result != 'undefined') &&
            (isCommon || (result === result ? result !== value : value === value))) {
          object[key] = result;
        }
      });
      return object;
    }

    /**
     * A specialized version of `baseMerge` for arrays and objects which performs
     * deep merges and tracks traversed objects enabling objects with circular
     * references to be merged.
     *
     * @private
     * @param {Object} object The destination object.
     * @param {Object} source The source object.
     * @param {string} key The key of the value to merge.
     * @param {Function} mergeFunc The function to merge values.
     * @param {Function} [customizer] The function to customize merging properties.
     * @param {Array} [stackA=[]] Tracks traversed source objects.
     * @param {Array} [stackB=[]] Associates values with source counterparts.
     * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
     */
    function baseMergeDeep(object, source, key, mergeFunc, customizer, stackA, stackB) {
      var length = stackA.length,
          srcValue = source[key];

      while (length--) {
        if (stackA[length] == srcValue) {
          object[key] = stackB[length];
          return;
        }
      }
      var value = object[key],
          result = customizer ? customizer(value, srcValue, key, object, source) : undefined,
          isCommon = typeof result == 'undefined';

      if (isCommon) {
        result = srcValue;
        if (isLength(srcValue.length) && (isArray(srcValue) || isTypedArray(srcValue))) {
          result = isArray(value)
            ? value
            : (value ? arrayCopy(value) : []);
        }
        else if (isPlainObject(srcValue) || isArguments(srcValue)) {
          result = isArguments(value)
            ? toPlainObject(value)
            : (isPlainObject(value) ? value : {});
        }
        else {
          isCommon = false;
        }
      }
      // Add the source value to the stack of traversed objects and associate
      // it with its merged value.
      stackA.push(srcValue);
      stackB.push(result);

      if (isCommon) {
        // Recursively merge objects and arrays (susceptible to call stack limits).
        object[key] = mergeFunc(result, srcValue, customizer, stackA, stackB);
      } else if (result === result ? result !== value : value === value) {
        object[key] = result;
      }
    }

    /**
     * The base implementation of `_.property` which does not coerce `key` to a string.
     *
     * @private
     * @param {string} key The key of the property to get.
     * @returns {Function} Returns the new function.
     */
    function baseProperty(key) {
      return function(object) {
        return object == null ? undefined : object[key];
      };
    }

    /**
     * The base implementation of `_.pullAt` without support for individual
     * index arguments.
     *
     * @private
     * @param {Array} array The array to modify.
     * @param {number[]} indexes The indexes of elements to remove.
     * @returns {Array} Returns the new array of removed elements.
     */
    function basePullAt(array, indexes) {
      var length = indexes.length,
          result = baseAt(array, indexes);

      indexes.sort(baseCompareAscending);
      while (length--) {
        var index = parseFloat(indexes[length]);
        if (index != previous && isIndex(index)) {
          var previous = index;
          splice.call(array, index, 1);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.random` without support for argument juggling
     * and returning floating-point numbers.
     *
     * @private
     * @param {number} min The minimum possible value.
     * @param {number} max The maximum possible value.
     * @returns {number} Returns the random number.
     */
    function baseRandom(min, max) {
      return min + floor(nativeRandom() * (max - min + 1));
    }

    /**
     * The base implementation of `_.reduce` and `_.reduceRight` without support
     * for callback shorthands or `this` binding, which iterates over `collection`
     * using the provided `eachFunc`.
     *
     * @private
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @param {*} accumulator The initial value.
     * @param {boolean} initFromCollection Specify using the first or last element
     *  of `collection` as the initial value.
     * @param {Function} eachFunc The function to iterate over `collection`.
     * @returns {*} Returns the accumulated value.
     */
    function baseReduce(collection, iteratee, accumulator, initFromCollection, eachFunc) {
      eachFunc(collection, function(value, index, collection) {
        accumulator = initFromCollection
          ? (initFromCollection = false, value)
          : iteratee(accumulator, value, index, collection);
      });
      return accumulator;
    }

    /**
     * The base implementation of `setData` without support for hot loop detection.
     *
     * @private
     * @param {Function} func The function to associate metadata with.
     * @param {*} data The metadata.
     * @returns {Function} Returns `func`.
     */
    var baseSetData = !metaMap ? identity : function(func, data) {
      metaMap.set(func, data);
      return func;
    };

    /**
     * The base implementation of `_.slice` without an iteratee call guard.
     *
     * @private
     * @param {Array} array The array to slice.
     * @param {number} [start=0] The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns the slice of `array`.
     */
    function baseSlice(array, start, end) {
      var index = -1,
          length = array.length;

      start = start == null ? 0 : (+start || 0);
      if (start < 0) {
        start = -start > length ? 0 : (length + start);
      }
      end = (typeof end == 'undefined' || end > length) ? length : (+end || 0);
      if (end < 0) {
        end += length;
      }
      length = start > end ? 0 : (end - start) >>> 0;
      start >>>= 0;

      var result = Array(length);
      while (++index < length) {
        result[index] = array[index + start];
      }
      return result;
    }

    /**
     * The base implementation of `_.some` without support for callback shorthands
     * or `this` binding.
     *
     * @private
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} predicate The function invoked per iteration.
     * @returns {boolean} Returns `true` if any element passes the predicate check,
     *  else `false`.
     */
    function baseSome(collection, predicate) {
      var result;

      baseEach(collection, function(value, index, collection) {
        result = predicate(value, index, collection);
        return !result;
      });
      return !!result;
    }

    /**
     * The base implementation of `_.sortBy` which uses `comparer` to define
     * the sort order of `array` and replaces criteria objects with their
     * corresponding values.
     *
     * @private
     * @param {Array} array The array to sort.
     * @param {Function} comparer The function to define sort order.
     * @returns {Array} Returns `array`.
     */
    function baseSortBy(array, comparer) {
      var length = array.length;

      array.sort(comparer);
      while (length--) {
        array[length] = array[length].value;
      }
      return array;
    }

    /**
     * The base implementation of `_.sortByOrder` without param guards.
     *
     * @private
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {string[]} props The property names to sort by.
     * @param {boolean[]} orders The sort orders of `props`.
     * @returns {Array} Returns the new sorted array.
     */
    function baseSortByOrder(collection, props, orders) {
      var index = -1,
          length = collection.length,
          result = isLength(length) ? Array(length) : [];

      baseEach(collection, function(value) {
        var length = props.length,
            criteria = Array(length);

        while (length--) {
          criteria[length] = value == null ? undefined : value[props[length]];
        }
        result[++index] = { 'criteria': criteria, 'index': index, 'value': value };
      });

      return baseSortBy(result, function(object, other) {
        return compareMultiple(object, other, orders);
      });
    }

    /**
     * The base implementation of `_.uniq` without support for callback shorthands
     * and `this` binding.
     *
     * @private
     * @param {Array} array The array to inspect.
     * @param {Function} [iteratee] The function invoked per iteration.
     * @returns {Array} Returns the new duplicate-value-free array.
     */
    function baseUniq(array, iteratee) {
      var index = -1,
          indexOf = getIndexOf(),
          length = array.length,
          isCommon = indexOf == baseIndexOf,
          isLarge = isCommon && length >= 200,
          seen = isLarge ? createCache() : null,
          result = [];

      if (seen) {
        indexOf = cacheIndexOf;
        isCommon = false;
      } else {
        isLarge = false;
        seen = iteratee ? [] : result;
      }
      outer:
      while (++index < length) {
        var value = array[index],
            computed = iteratee ? iteratee(value, index, array) : value;

        if (isCommon && value === value) {
          var seenIndex = seen.length;
          while (seenIndex--) {
            if (seen[seenIndex] === computed) {
              continue outer;
            }
          }
          if (iteratee) {
            seen.push(computed);
          }
          result.push(value);
        }
        else if (indexOf(seen, computed, 0) < 0) {
          if (iteratee || isLarge) {
            seen.push(computed);
          }
          result.push(value);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.values` and `_.valuesIn` which creates an
     * array of `object` property values corresponding to the property names
     * returned by `keysFunc`.
     *
     * @private
     * @param {Object} object The object to query.
     * @param {Array} props The property names to get values for.
     * @returns {Object} Returns the array of property values.
     */
    function baseValues(object, props) {
      var index = -1,
          length = props.length,
          result = Array(length);

      while (++index < length) {
        result[index] = object[props[index]];
      }
      return result;
    }

    /**
     * The base implementation of `wrapperValue` which returns the result of
     * performing a sequence of actions on the unwrapped `value`, where each
     * successive action is supplied the return value of the previous.
     *
     * @private
     * @param {*} value The unwrapped value.
     * @param {Array} actions Actions to peform to resolve the unwrapped value.
     * @returns {*} Returns the resolved unwrapped value.
     */
    function baseWrapperValue(value, actions) {
      var result = value;
      if (result instanceof LazyWrapper) {
        result = result.value();
      }
      var index = -1,
          length = actions.length;

      while (++index < length) {
        var args = [result],
            action = actions[index];

        push.apply(args, action.args);
        result = action.func.apply(action.thisArg, args);
      }
      return result;
    }

    /**
     * Performs a binary search of `array` to determine the index at which `value`
     * should be inserted into `array` in order to maintain its sort order.
     *
     * @private
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @param {boolean} [retHighest] Specify returning the highest, instead
     *  of the lowest, index at which a value should be inserted into `array`.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     */
    function binaryIndex(array, value, retHighest) {
      var low = 0,
          high = array ? array.length : low;

      if (typeof value == 'number' && value === value && high <= HALF_MAX_ARRAY_LENGTH) {
        while (low < high) {
          var mid = (low + high) >>> 1,
              computed = array[mid];

          if (retHighest ? (computed <= value) : (computed < value)) {
            low = mid + 1;
          } else {
            high = mid;
          }
        }
        return high;
      }
      return binaryIndexBy(array, value, identity, retHighest);
    }

    /**
     * This function is like `binaryIndex` except that it invokes `iteratee` for
     * `value` and each element of `array` to compute their sort ranking. The
     * iteratee is invoked with one argument; (value).
     *
     * @private
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @param {Function} iteratee The function invoked per iteration.
     * @param {boolean} [retHighest] Specify returning the highest, instead
     *  of the lowest, index at which a value should be inserted into `array`.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     */
    function binaryIndexBy(array, value, iteratee, retHighest) {
      value = iteratee(value);

      var low = 0,
          high = array ? array.length : 0,
          valIsNaN = value !== value,
          valIsUndef = typeof value == 'undefined';

      while (low < high) {
        var mid = floor((low + high) / 2),
            computed = iteratee(array[mid]),
            isReflexive = computed === computed;

        if (valIsNaN) {
          var setLow = isReflexive || retHighest;
        } else if (valIsUndef) {
          setLow = isReflexive && (retHighest || typeof computed != 'undefined');
        } else {
          setLow = retHighest ? (computed <= value) : (computed < value);
        }
        if (setLow) {
          low = mid + 1;
        } else {
          high = mid;
        }
      }
      return nativeMin(high, MAX_ARRAY_INDEX);
    }

    /**
     * A specialized version of `baseCallback` which only supports `this` binding
     * and specifying the number of arguments to provide to `func`.
     *
     * @private
     * @param {Function} func The function to bind.
     * @param {*} thisArg The `this` binding of `func`.
     * @param {number} [argCount] The number of arguments to provide to `func`.
     * @returns {Function} Returns the callback.
     */
    function bindCallback(func, thisArg, argCount) {
      if (typeof func != 'function') {
        return identity;
      }
      if (typeof thisArg == 'undefined') {
        return func;
      }
      switch (argCount) {
        case 1: return function(value) {
          return func.call(thisArg, value);
        };
        case 3: return function(value, index, collection) {
          return func.call(thisArg, value, index, collection);
        };
        case 4: return function(accumulator, value, index, collection) {
          return func.call(thisArg, accumulator, value, index, collection);
        };
        case 5: return function(value, other, key, object, source) {
          return func.call(thisArg, value, other, key, object, source);
        };
      }
      return function() {
        return func.apply(thisArg, arguments);
      };
    }

    /**
     * Creates a clone of the given array buffer.
     *
     * @private
     * @param {ArrayBuffer} buffer The array buffer to clone.
     * @returns {ArrayBuffer} Returns the cloned array buffer.
     */
    function bufferClone(buffer) {
      return bufferSlice.call(buffer, 0);
    }
    if (!bufferSlice) {
      // PhantomJS has `ArrayBuffer` and `Uint8Array` but not `Float64Array`.
      bufferClone = !(ArrayBuffer && Uint8Array) ? constant(null) : function(buffer) {
        var byteLength = buffer.byteLength,
            floatLength = Float64Array ? floor(byteLength / FLOAT64_BYTES_PER_ELEMENT) : 0,
            offset = floatLength * FLOAT64_BYTES_PER_ELEMENT,
            result = new ArrayBuffer(byteLength);

        if (floatLength) {
          var view = new Float64Array(result, 0, floatLength);
          view.set(new Float64Array(buffer, 0, floatLength));
        }
        if (byteLength != offset) {
          view = new Uint8Array(result, offset);
          view.set(new Uint8Array(buffer, offset));
        }
        return result;
      };
    }

    /**
     * Creates an array that is the composition of partially applied arguments,
     * placeholders, and provided arguments into a single array of arguments.
     *
     * @private
     * @param {Array|Object} args The provided arguments.
     * @param {Array} partials The arguments to prepend to those provided.
     * @param {Array} holders The `partials` placeholder indexes.
     * @returns {Array} Returns the new array of composed arguments.
     */
    function composeArgs(args, partials, holders) {
      var holdersLength = holders.length,
          argsIndex = -1,
          argsLength = nativeMax(args.length - holdersLength, 0),
          leftIndex = -1,
          leftLength = partials.length,
          result = Array(argsLength + leftLength);

      while (++leftIndex < leftLength) {
        result[leftIndex] = partials[leftIndex];
      }
      while (++argsIndex < holdersLength) {
        result[holders[argsIndex]] = args[argsIndex];
      }
      while (argsLength--) {
        result[leftIndex++] = args[argsIndex++];
      }
      return result;
    }

    /**
     * This function is like `composeArgs` except that the arguments composition
     * is tailored for `_.partialRight`.
     *
     * @private
     * @param {Array|Object} args The provided arguments.
     * @param {Array} partials The arguments to append to those provided.
     * @param {Array} holders The `partials` placeholder indexes.
     * @returns {Array} Returns the new array of composed arguments.
     */
    function composeArgsRight(args, partials, holders) {
      var holdersIndex = -1,
          holdersLength = holders.length,
          argsIndex = -1,
          argsLength = nativeMax(args.length - holdersLength, 0),
          rightIndex = -1,
          rightLength = partials.length,
          result = Array(argsLength + rightLength);

      while (++argsIndex < argsLength) {
        result[argsIndex] = args[argsIndex];
      }
      var pad = argsIndex;
      while (++rightIndex < rightLength) {
        result[pad + rightIndex] = partials[rightIndex];
      }
      while (++holdersIndex < holdersLength) {
        result[pad + holders[holdersIndex]] = args[argsIndex++];
      }
      return result;
    }

    /**
     * Creates a function that aggregates a collection, creating an accumulator
     * object composed from the results of running each element in the collection
     * through an iteratee.
     *
     * @private
     * @param {Function} setter The function to set keys and values of the accumulator object.
     * @param {Function} [initializer] The function to initialize the accumulator object.
     * @returns {Function} Returns the new aggregator function.
     */
    function createAggregator(setter, initializer) {
      return function(collection, iteratee, thisArg) {
        var result = initializer ? initializer() : {};
        iteratee = getCallback(iteratee, thisArg, 3);

        if (isArray(collection)) {
          var index = -1,
              length = collection.length;

          while (++index < length) {
            var value = collection[index];
            setter(result, value, iteratee(value, index, collection), collection);
          }
        } else {
          baseEach(collection, function(value, key, collection) {
            setter(result, value, iteratee(value, key, collection), collection);
          });
        }
        return result;
      };
    }

    /**
     * Creates a function that assigns properties of source object(s) to a given
     * destination object.
     *
     * @private
     * @param {Function} assigner The function to assign values.
     * @returns {Function} Returns the new assigner function.
     */
    function createAssigner(assigner) {
      return function() {
        var args = arguments,
            length = args.length,
            object = args[0];

        if (length < 2 || object == null) {
          return object;
        }
        var customizer = args[length - 2],
            thisArg = args[length - 1],
            guard = args[3];

        if (length > 3 && typeof customizer == 'function') {
          customizer = bindCallback(customizer, thisArg, 5);
          length -= 2;
        } else {
          customizer = (length > 2 && typeof thisArg == 'function') ? thisArg : null;
          length -= (customizer ? 1 : 0);
        }
        if (guard && isIterateeCall(args[1], args[2], guard)) {
          customizer = length == 3 ? null : customizer;
          length = 2;
        }
        var index = 0;
        while (++index < length) {
          var source = args[index];
          if (source) {
            assigner(object, source, customizer);
          }
        }
        return object;
      };
    }

    /**
     * Creates a function that wraps `func` and invokes it with the `this`
     * binding of `thisArg`.
     *
     * @private
     * @param {Function} func The function to bind.
     * @param {*} [thisArg] The `this` binding of `func`.
     * @returns {Function} Returns the new bound function.
     */
    function createBindWrapper(func, thisArg) {
      var Ctor = createCtorWrapper(func);

      function wrapper() {
        return (this instanceof wrapper ? Ctor : func).apply(thisArg, arguments);
      }
      return wrapper;
    }

    /**
     * Creates a `Set` cache object to optimize linear searches of large arrays.
     *
     * @private
     * @param {Array} [values] The values to cache.
     * @returns {null|Object} Returns the new cache object if `Set` is supported, else `null`.
     */
    var createCache = !(nativeCreate && Set) ? constant(null) : function(values) {
      return new SetCache(values);
    };

    /**
     * Creates a function to compose other functions into a single function.
     *
     * @private
     * @param {boolean} [fromRight] Specify iterating from right to left.
     * @returns {Function} Returns the new composer function.
     */
    function createComposer(fromRight) {
      return function() {
        var length = arguments.length,
            index = length,
            fromIndex = fromRight ? length - 1 : 0;

        if (!length) {
          return function() { return arguments[0]; };
        }
        var funcs = Array(length);
        while (index--) {
          funcs[index] = arguments[index];
          if (typeof funcs[index] != 'function') {
            throw new TypeError(FUNC_ERROR_TEXT);
          }
        }
        return function() {
          var index = fromIndex,
              result = funcs[index].apply(this, arguments);

          while ((fromRight ? index-- : ++index < length)) {
            result = funcs[index].call(this, result);
          }
          return result;
        };
      };
    }

    /**
     * Creates a function that produces compound words out of the words in a
     * given string.
     *
     * @private
     * @param {Function} callback The function to combine each word.
     * @returns {Function} Returns the new compounder function.
     */
    function createCompounder(callback) {
      return function(string) {
        var index = -1,
            array = words(deburr(string)),
            length = array.length,
            result = '';

        while (++index < length) {
          result = callback(result, array[index], index);
        }
        return result;
      };
    }

    /**
     * Creates a function that produces an instance of `Ctor` regardless of
     * whether it was invoked as part of a `new` expression or by `call` or `apply`.
     *
     * @private
     * @param {Function} Ctor The constructor to wrap.
     * @returns {Function} Returns the new wrapped function.
     */
    function createCtorWrapper(Ctor) {
      return function() {
        var thisBinding = baseCreate(Ctor.prototype),
            result = Ctor.apply(thisBinding, arguments);

        // Mimic the constructor's `return` behavior.
        // See https://es5.github.io/#x13.2.2 for more details.
        return isObject(result) ? result : thisBinding;
      };
    }

    /**
     * Creates a function that gets the extremum value of a collection.
     *
     * @private
     * @param {Function} arrayFunc The function to get the extremum value from an array.
     * @param {boolean} [isMin] Specify returning the minimum, instead of the maximum,
     *  extremum value.
     * @returns {Function} Returns the new extremum function.
     */
    function createExtremum(arrayFunc, isMin) {
      return function(collection, iteratee, thisArg) {
        if (thisArg && isIterateeCall(collection, iteratee, thisArg)) {
          iteratee = null;
        }
        var func = getCallback(),
            noIteratee = iteratee == null;

        if (!(func === baseCallback && noIteratee)) {
          noIteratee = false;
          iteratee = func(iteratee, thisArg, 3);
        }
        if (noIteratee) {
          var isArr = isArray(collection);
          if (!isArr && isString(collection)) {
            iteratee = charAtCallback;
          } else {
            return arrayFunc(isArr ? collection : toIterable(collection));
          }
        }
        return extremumBy(collection, iteratee, isMin);
      };
    }

    /**
     * Creates a function that wraps `func` and invokes it with optional `this`
     * binding of, partial application, and currying.
     *
     * @private
     * @param {Function|string} func The function or method name to reference.
     * @param {number} bitmask The bitmask of flags. See `createWrapper` for more details.
     * @param {*} [thisArg] The `this` binding of `func`.
     * @param {Array} [partials] The arguments to prepend to those provided to the new function.
     * @param {Array} [holders] The `partials` placeholder indexes.
     * @param {Array} [partialsRight] The arguments to append to those provided to the new function.
     * @param {Array} [holdersRight] The `partialsRight` placeholder indexes.
     * @param {Array} [argPos] The argument positions of the new function.
     * @param {number} [ary] The arity cap of `func`.
     * @param {number} [arity] The arity of `func`.
     * @returns {Function} Returns the new wrapped function.
     */
    function createHybridWrapper(func, bitmask, thisArg, partials, holders, partialsRight, holdersRight, argPos, ary, arity) {
      var isAry = bitmask & ARY_FLAG,
          isBind = bitmask & BIND_FLAG,
          isBindKey = bitmask & BIND_KEY_FLAG,
          isCurry = bitmask & CURRY_FLAG,
          isCurryBound = bitmask & CURRY_BOUND_FLAG,
          isCurryRight = bitmask & CURRY_RIGHT_FLAG;

      var Ctor = !isBindKey && createCtorWrapper(func),
          key = func;

      function wrapper() {
        // Avoid `arguments` object use disqualifying optimizations by
        // converting it to an array before providing it to other functions.
        var length = arguments.length,
            index = length,
            args = Array(length);

        while (index--) {
          args[index] = arguments[index];
        }
        if (partials) {
          args = composeArgs(args, partials, holders);
        }
        if (partialsRight) {
          args = composeArgsRight(args, partialsRight, holdersRight);
        }
        if (isCurry || isCurryRight) {
          var placeholder = wrapper.placeholder,
              argsHolders = replaceHolders(args, placeholder);

          length -= argsHolders.length;
          if (length < arity) {
            var newArgPos = argPos ? arrayCopy(argPos) : null,
                newArity = nativeMax(arity - length, 0),
                newsHolders = isCurry ? argsHolders : null,
                newHoldersRight = isCurry ? null : argsHolders,
                newPartials = isCurry ? args : null,
                newPartialsRight = isCurry ? null : args;

            bitmask |= (isCurry ? PARTIAL_FLAG : PARTIAL_RIGHT_FLAG);
            bitmask &= ~(isCurry ? PARTIAL_RIGHT_FLAG : PARTIAL_FLAG);

            if (!isCurryBound) {
              bitmask &= ~(BIND_FLAG | BIND_KEY_FLAG);
            }
            var result = createHybridWrapper(func, bitmask, thisArg, newPartials, newsHolders, newPartialsRight, newHoldersRight, newArgPos, ary, newArity);
            result.placeholder = placeholder;
            return result;
          }
        }
        var thisBinding = isBind ? thisArg : this;
        if (isBindKey) {
          func = thisBinding[key];
        }
        if (argPos) {
          args = reorder(args, argPos);
        }
        if (isAry && ary < args.length) {
          args.length = ary;
        }
        return (this instanceof wrapper ? (Ctor || createCtorWrapper(func)) : func).apply(thisBinding, args);
      }
      return wrapper;
    }

    /**
     * Creates the pad required for `string` based on the given padding length.
     * The `chars` string may be truncated if the number of padding characters
     * exceeds the padding length.
     *
     * @private
     * @param {string} string The string to create padding for.
     * @param {number} [length=0] The padding length.
     * @param {string} [chars=' '] The string used as padding.
     * @returns {string} Returns the pad for `string`.
     */
    function createPad(string, length, chars) {
      var strLength = string.length;
      length = +length;

      if (strLength >= length || !nativeIsFinite(length)) {
        return '';
      }
      var padLength = length - strLength;
      chars = chars == null ? ' ' : (chars + '');
      return repeat(chars, ceil(padLength / chars.length)).slice(0, padLength);
    }

    /**
     * Creates a function that wraps `func` and invokes it with the optional `this`
     * binding of `thisArg` and the `partials` prepended to those provided to
     * the wrapper.
     *
     * @private
     * @param {Function} func The function to partially apply arguments to.
     * @param {number} bitmask The bitmask of flags. See `createWrapper` for more details.
     * @param {*} thisArg The `this` binding of `func`.
     * @param {Array} partials The arguments to prepend to those provided to the new function.
     * @returns {Function} Returns the new bound function.
     */
    function createPartialWrapper(func, bitmask, thisArg, partials) {
      var isBind = bitmask & BIND_FLAG,
          Ctor = createCtorWrapper(func);

      function wrapper() {
        // Avoid `arguments` object use disqualifying optimizations by
        // converting it to an array before providing it `func`.
        var argsIndex = -1,
            argsLength = arguments.length,
            leftIndex = -1,
            leftLength = partials.length,
            args = Array(argsLength + leftLength);

        while (++leftIndex < leftLength) {
          args[leftIndex] = partials[leftIndex];
        }
        while (argsLength--) {
          args[leftIndex++] = arguments[++argsIndex];
        }
        return (this instanceof wrapper ? Ctor : func).apply(isBind ? thisArg : this, args);
      }
      return wrapper;
    }

    /**
     * Creates a function that either curries or invokes `func` with optional
     * `this` binding and partially applied arguments.
     *
     * @private
     * @param {Function|string} func The function or method name to reference.
     * @param {number} bitmask The bitmask of flags.
     *  The bitmask may be composed of the following flags:
     *     1 - `_.bind`
     *     2 - `_.bindKey`
     *     4 - `_.curry` or `_.curryRight` of a bound function
     *     8 - `_.curry`
     *    16 - `_.curryRight`
     *    32 - `_.partial`
     *    64 - `_.partialRight`
     *   128 - `_.rearg`
     *   256 - `_.ary`
     * @param {*} [thisArg] The `this` binding of `func`.
     * @param {Array} [partials] The arguments to be partially applied.
     * @param {Array} [holders] The `partials` placeholder indexes.
     * @param {Array} [argPos] The argument positions of the new function.
     * @param {number} [ary] The arity cap of `func`.
     * @param {number} [arity] The arity of `func`.
     * @returns {Function} Returns the new wrapped function.
     */
    function createWrapper(func, bitmask, thisArg, partials, holders, argPos, ary, arity) {
      var isBindKey = bitmask & BIND_KEY_FLAG;
      if (!isBindKey && typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      var length = partials ? partials.length : 0;
      if (!length) {
        bitmask &= ~(PARTIAL_FLAG | PARTIAL_RIGHT_FLAG);
        partials = holders = null;
      }
      length -= (holders ? holders.length : 0);
      if (bitmask & PARTIAL_RIGHT_FLAG) {
        var partialsRight = partials,
            holdersRight = holders;

        partials = holders = null;
      }
      var data = !isBindKey && getData(func),
          newData = [func, bitmask, thisArg, partials, holders, partialsRight, holdersRight, argPos, ary, arity];

      if (data && data !== true) {
        mergeData(newData, data);
        bitmask = newData[1];
        arity = newData[9];
      }
      newData[9] = arity == null
        ? (isBindKey ? 0 : func.length)
        : (nativeMax(arity - length, 0) || 0);

      if (bitmask == BIND_FLAG) {
        var result = createBindWrapper(newData[0], newData[2]);
      } else if ((bitmask == PARTIAL_FLAG || bitmask == (BIND_FLAG | PARTIAL_FLAG)) && !newData[4].length) {
        result = createPartialWrapper.apply(undefined, newData);
      } else {
        result = createHybridWrapper.apply(undefined, newData);
      }
      var setter = data ? baseSetData : setData;
      return setter(result, newData);
    }

    /**
     * A specialized version of `baseIsEqualDeep` for arrays with support for
     * partial deep comparisons.
     *
     * @private
     * @param {Array} array The array to compare.
     * @param {Array} other The other array to compare.
     * @param {Function} equalFunc The function to determine equivalents of values.
     * @param {Function} [customizer] The function to customize comparing arrays.
     * @param {boolean} [isWhere] Specify performing partial comparisons.
     * @param {Array} [stackA] Tracks traversed `value` objects.
     * @param {Array} [stackB] Tracks traversed `other` objects.
     * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.
     */
    function equalArrays(array, other, equalFunc, customizer, isWhere, stackA, stackB) {
      var index = -1,
          arrLength = array.length,
          othLength = other.length,
          result = true;

      if (arrLength != othLength && !(isWhere && othLength > arrLength)) {
        return false;
      }
      // Deep compare the contents, ignoring non-numeric properties.
      while (result && ++index < arrLength) {
        var arrValue = array[index],
            othValue = other[index];

        result = undefined;
        if (customizer) {
          result = isWhere
            ? customizer(othValue, arrValue, index)
            : customizer(arrValue, othValue, index);
        }
        if (typeof result == 'undefined') {
          // Recursively compare arrays (susceptible to call stack limits).
          if (isWhere) {
            var othIndex = othLength;
            while (othIndex--) {
              othValue = other[othIndex];
              result = (arrValue && arrValue === othValue) || equalFunc(arrValue, othValue, customizer, isWhere, stackA, stackB);
              if (result) {
                break;
              }
            }
          } else {
            result = (arrValue && arrValue === othValue) || equalFunc(arrValue, othValue, customizer, isWhere, stackA, stackB);
          }
        }
      }
      return !!result;
    }

    /**
     * A specialized version of `baseIsEqualDeep` for comparing objects of
     * the same `toStringTag`.
     *
     * **Note:** This function only supports comparing values with tags of
     * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
     *
     * @private
     * @param {Object} value The object to compare.
     * @param {Object} other The other object to compare.
     * @param {string} tag The `toStringTag` of the objects to compare.
     * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
     */
    function equalByTag(object, other, tag) {
      switch (tag) {
        case boolTag:
        case dateTag:
          // Coerce dates and booleans to numbers, dates to milliseconds and booleans
          // to `1` or `0` treating invalid dates coerced to `NaN` as not equal.
          return +object == +other;

        case errorTag:
          return object.name == other.name && object.message == other.message;

        case numberTag:
          // Treat `NaN` vs. `NaN` as equal.
          return (object != +object)
            ? other != +other
            // But, treat `-0` vs. `+0` as not equal.
            : (object == 0 ? ((1 / object) == (1 / other)) : object == +other);

        case regexpTag:
        case stringTag:
          // Coerce regexes to strings and treat strings primitives and string
          // objects as equal. See https://es5.github.io/#x15.10.6.4 for more details.
          return object == (other + '');
      }
      return false;
    }

    /**
     * A specialized version of `baseIsEqualDeep` for objects with support for
     * partial deep comparisons.
     *
     * @private
     * @param {Object} object The object to compare.
     * @param {Object} other The other object to compare.
     * @param {Function} equalFunc The function to determine equivalents of values.
     * @param {Function} [customizer] The function to customize comparing values.
     * @param {boolean} [isWhere] Specify performing partial comparisons.
     * @param {Array} [stackA] Tracks traversed `value` objects.
     * @param {Array} [stackB] Tracks traversed `other` objects.
     * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
     */
    function equalObjects(object, other, equalFunc, customizer, isWhere, stackA, stackB) {
      var objProps = keys(object),
          objLength = objProps.length,
          othProps = keys(other),
          othLength = othProps.length;

      if (objLength != othLength && !isWhere) {
        return false;
      }
      var hasCtor,
          index = -1;

      while (++index < objLength) {
        var key = objProps[index],
            result = hasOwnProperty.call(other, key);

        if (result) {
          var objValue = object[key],
              othValue = other[key];

          result = undefined;
          if (customizer) {
            result = isWhere
              ? customizer(othValue, objValue, key)
              : customizer(objValue, othValue, key);
          }
          if (typeof result == 'undefined') {
            // Recursively compare objects (susceptible to call stack limits).
            result = (objValue && objValue === othValue) || equalFunc(objValue, othValue, customizer, isWhere, stackA, stackB);
          }
        }
        if (!result) {
          return false;
        }
        hasCtor || (hasCtor = key == 'constructor');
      }
      if (!hasCtor) {
        var objCtor = object.constructor,
            othCtor = other.constructor;

        // Non `Object` object instances with different constructors are not equal.
        if (objCtor != othCtor && ('constructor' in object && 'constructor' in other) &&
            !(typeof objCtor == 'function' && objCtor instanceof objCtor && typeof othCtor == 'function' && othCtor instanceof othCtor)) {
          return false;
        }
      }
      return true;
    }

    /**
     * Gets the extremum value of `collection` invoking `iteratee` for each value
     * in `collection` to generate the criterion by which the value is ranked.
     * The `iteratee` is invoked with three arguments; (value, index, collection).
     *
     * @private
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @param {boolean} [isMin] Specify returning the minimum, instead of the
     *  maximum, extremum value.
     * @returns {*} Returns the extremum value.
     */
    function extremumBy(collection, iteratee, isMin) {
      var exValue = isMin ? POSITIVE_INFINITY : NEGATIVE_INFINITY,
          computed = exValue,
          result = computed;

      baseEach(collection, function(value, index, collection) {
        var current = iteratee(value, index, collection);
        if ((isMin ? current < computed : current > computed) || (current === exValue && current === result)) {
          computed = current;
          result = value;
        }
      });
      return result;
    }

    /**
     * Gets the appropriate "callback" function. If the `_.callback` method is
     * customized this function returns the custom method, otherwise it returns
     * the `baseCallback` function. If arguments are provided the chosen function
     * is invoked with them and its result is returned.
     *
     * @private
     * @returns {Function} Returns the chosen function or its result.
     */
    function getCallback(func, thisArg, argCount) {
      var result = lodash.callback || callback;
      result = result === callback ? baseCallback : result;
      return argCount ? result(func, thisArg, argCount) : result;
    }

    /**
     * Gets metadata for `func`.
     *
     * @private
     * @param {Function} func The function to query.
     * @returns {*} Returns the metadata for `func`.
     */
    var getData = !metaMap ? noop : function(func) {
      return metaMap.get(func);
    };

    /**
     * Gets the appropriate "indexOf" function. If the `_.indexOf` method is
     * customized this function returns the custom method, otherwise it returns
     * the `baseIndexOf` function. If arguments are provided the chosen function
     * is invoked with them and its result is returned.
     *
     * @private
     * @returns {Function|number} Returns the chosen function or its result.
     */
    function getIndexOf(collection, target, fromIndex) {
      var result = lodash.indexOf || indexOf;
      result = result === indexOf ? baseIndexOf : result;
      return collection ? result(collection, target, fromIndex) : result;
    }

    /**
     * Gets the view, applying any `transforms` to the `start` and `end` positions.
     *
     * @private
     * @param {number} start The start of the view.
     * @param {number} end The end of the view.
     * @param {Array} [transforms] The transformations to apply to the view.
     * @returns {Object} Returns an object containing the `start` and `end`
     *  positions of the view.
     */
    function getView(start, end, transforms) {
      var index = -1,
          length = transforms ? transforms.length : 0;

      while (++index < length) {
        var data = transforms[index],
            size = data.size;

        switch (data.type) {
          case 'drop':      start += size; break;
          case 'dropRight': end -= size; break;
          case 'take':      end = nativeMin(end, start + size); break;
          case 'takeRight': start = nativeMax(start, end - size); break;
        }
      }
      return { 'start': start, 'end': end };
    }

    /**
     * Initializes an array clone.
     *
     * @private
     * @param {Array} array The array to clone.
     * @returns {Array} Returns the initialized clone.
     */
    function initCloneArray(array) {
      var length = array.length,
          result = new array.constructor(length);

      // Add array properties assigned by `RegExp#exec`.
      if (length && typeof array[0] == 'string' && hasOwnProperty.call(array, 'index')) {
        result.index = array.index;
        result.input = array.input;
      }
      return result;
    }

    /**
     * Initializes an object clone.
     *
     * @private
     * @param {Object} object The object to clone.
     * @returns {Object} Returns the initialized clone.
     */
    function initCloneObject(object) {
      var Ctor = object.constructor;
      if (!(typeof Ctor == 'function' && Ctor instanceof Ctor)) {
        Ctor = Object;
      }
      return new Ctor;
    }

    /**
     * Initializes an object clone based on its `toStringTag`.
     *
     * **Note:** This function only supports cloning values with tags of
     * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
     *
     *
     * @private
     * @param {Object} object The object to clone.
     * @param {string} tag The `toStringTag` of the object to clone.
     * @param {boolean} [isDeep] Specify a deep clone.
     * @returns {Object} Returns the initialized clone.
     */
    function initCloneByTag(object, tag, isDeep) {
      var Ctor = object.constructor;
      switch (tag) {
        case arrayBufferTag:
          return bufferClone(object);

        case boolTag:
        case dateTag:
          return new Ctor(+object);

        case float32Tag: case float64Tag:
        case int8Tag: case int16Tag: case int32Tag:
        case uint8Tag: case uint8ClampedTag: case uint16Tag: case uint32Tag:
          var buffer = object.buffer;
          return new Ctor(isDeep ? bufferClone(buffer) : buffer, object.byteOffset, object.length);

        case numberTag:
        case stringTag:
          return new Ctor(object);

        case regexpTag:
          var result = new Ctor(object.source, reFlags.exec(object));
          result.lastIndex = object.lastIndex;
      }
      return result;
    }

    /**
     * Checks if `func` is eligible for `this` binding.
     *
     * @private
     * @param {Function} func The function to check.
     * @returns {boolean} Returns `true` if `func` is eligible, else `false`.
     */
    function isBindable(func) {
      var support = lodash.support,
          result = !(support.funcNames ? func.name : support.funcDecomp);

      if (!result) {
        var source = fnToString.call(func);
        if (!support.funcNames) {
          result = !reFuncName.test(source);
        }
        if (!result) {
          // Check if `func` references the `this` keyword and store the result.
          result = reThis.test(source) || isNative(func);
          baseSetData(func, result);
        }
      }
      return result;
    }

    /**
     * Checks if `value` is a valid array-like index.
     *
     * @private
     * @param {*} value The value to check.
     * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
     * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
     */
    function isIndex(value, length) {
      value = +value;
      length = length == null ? MAX_SAFE_INTEGER : length;
      return value > -1 && value % 1 == 0 && value < length;
    }

    /**
     * Checks if the provided arguments are from an iteratee call.
     *
     * @private
     * @param {*} value The potential iteratee value argument.
     * @param {*} index The potential iteratee index or key argument.
     * @param {*} object The potential iteratee object argument.
     * @returns {boolean} Returns `true` if the arguments are from an iteratee call, else `false`.
     */
    function isIterateeCall(value, index, object) {
      if (!isObject(object)) {
        return false;
      }
      var type = typeof index;
      if (type == 'number') {
        var length = object.length,
            prereq = isLength(length) && isIndex(index, length);
      } else {
        prereq = type == 'string' && index in object;
      }
      if (prereq) {
        var other = object[index];
        return value === value ? value === other : other !== other;
      }
      return false;
    }

    /**
     * Checks if `value` is a valid array-like length.
     *
     * **Note:** This function is based on ES `ToLength`. See the
     * [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-tolength)
     * for more details.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
     */
    function isLength(value) {
      return typeof value == 'number' && value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;
    }

    /**
     * Checks if `value` is suitable for strict equality comparisons, i.e. `===`.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` if suitable for strict
     *  equality comparisons, else `false`.
     */
    function isStrictComparable(value) {
      return value === value && (value === 0 ? ((1 / value) > 0) : !isObject(value));
    }

    /**
     * Merges the function metadata of `source` into `data`.
     *
     * Merging metadata reduces the number of wrappers required to invoke a function.
     * This is possible because methods like `_.bind`, `_.curry`, and `_.partial`
     * may be applied regardless of execution order. Methods like `_.ary` and `_.rearg`
     * augment function arguments, making the order in which they are executed important,
     * preventing the merging of metadata. However, we make an exception for a safe
     * common case where curried functions have `_.ary` and or `_.rearg` applied.
     *
     * @private
     * @param {Array} data The destination metadata.
     * @param {Array} source The source metadata.
     * @returns {Array} Returns `data`.
     */
    function mergeData(data, source) {
      var bitmask = data[1],
          srcBitmask = source[1],
          newBitmask = bitmask | srcBitmask;

      var arityFlags = ARY_FLAG | REARG_FLAG,
          bindFlags = BIND_FLAG | BIND_KEY_FLAG,
          comboFlags = arityFlags | bindFlags | CURRY_BOUND_FLAG | CURRY_RIGHT_FLAG;

      var isAry = bitmask & ARY_FLAG && !(srcBitmask & ARY_FLAG),
          isRearg = bitmask & REARG_FLAG && !(srcBitmask & REARG_FLAG),
          argPos = (isRearg ? data : source)[7],
          ary = (isAry ? data : source)[8];

      var isCommon = !(bitmask >= REARG_FLAG && srcBitmask > bindFlags) &&
        !(bitmask > bindFlags && srcBitmask >= REARG_FLAG);

      var isCombo = (newBitmask >= arityFlags && newBitmask <= comboFlags) &&
        (bitmask < REARG_FLAG || ((isRearg || isAry) && argPos.length <= ary));

      // Exit early if metadata can't be merged.
      if (!(isCommon || isCombo)) {
        return data;
      }
      // Use source `thisArg` if available.
      if (srcBitmask & BIND_FLAG) {
        data[2] = source[2];
        // Set when currying a bound function.
        newBitmask |= (bitmask & BIND_FLAG) ? 0 : CURRY_BOUND_FLAG;
      }
      // Compose partial arguments.
      var value = source[3];
      if (value) {
        var partials = data[3];
        data[3] = partials ? composeArgs(partials, value, source[4]) : arrayCopy(value);
        data[4] = partials ? replaceHolders(data[3], PLACEHOLDER) : arrayCopy(source[4]);
      }
      // Compose partial right arguments.
      value = source[5];
      if (value) {
        partials = data[5];
        data[5] = partials ? composeArgsRight(partials, value, source[6]) : arrayCopy(value);
        data[6] = partials ? replaceHolders(data[5], PLACEHOLDER) : arrayCopy(source[6]);
      }
      // Use source `argPos` if available.
      value = source[7];
      if (value) {
        data[7] = arrayCopy(value);
      }
      // Use source `ary` if it's smaller.
      if (srcBitmask & ARY_FLAG) {
        data[8] = data[8] == null ? source[8] : nativeMin(data[8], source[8]);
      }
      // Use source `arity` if one is not provided.
      if (data[9] == null) {
        data[9] = source[9];
      }
      // Use source `func` and merge bitmasks.
      data[0] = source[0];
      data[1] = newBitmask;

      return data;
    }

    /**
     * A specialized version of `_.pick` that picks `object` properties specified
     * by the `props` array.
     *
     * @private
     * @param {Object} object The source object.
     * @param {string[]} props The property names to pick.
     * @returns {Object} Returns the new object.
     */
    function pickByArray(object, props) {
      object = toObject(object);

      var index = -1,
          length = props.length,
          result = {};

      while (++index < length) {
        var key = props[index];
        if (key in object) {
          result[key] = object[key];
        }
      }
      return result;
    }

    /**
     * A specialized version of `_.pick` that picks `object` properties `predicate`
     * returns truthy for.
     *
     * @private
     * @param {Object} object The source object.
     * @param {Function} predicate The function invoked per iteration.
     * @returns {Object} Returns the new object.
     */
    function pickByCallback(object, predicate) {
      var result = {};
      baseForIn(object, function(value, key, object) {
        if (predicate(value, key, object)) {
          result[key] = value;
        }
      });
      return result;
    }

    /**
     * Reorder `array` according to the specified indexes where the element at
     * the first index is assigned as the first element, the element at
     * the second index is assigned as the second element, and so on.
     *
     * @private
     * @param {Array} array The array to reorder.
     * @param {Array} indexes The arranged array indexes.
     * @returns {Array} Returns `array`.
     */
    function reorder(array, indexes) {
      var arrLength = array.length,
          length = nativeMin(indexes.length, arrLength),
          oldArray = arrayCopy(array);

      while (length--) {
        var index = indexes[length];
        array[length] = isIndex(index, arrLength) ? oldArray[index] : undefined;
      }
      return array;
    }

    /**
     * Sets metadata for `func`.
     *
     * **Note:** If this function becomes hot, i.e. is invoked a lot in a short
     * period of time, it will trip its breaker and transition to an identity function
     * to avoid garbage collection pauses in V8. See [V8 issue 2070](https://code.google.com/p/v8/issues/detail?id=2070)
     * for more details.
     *
     * @private
     * @param {Function} func The function to associate metadata with.
     * @param {*} data The metadata.
     * @returns {Function} Returns `func`.
     */
    var setData = (function() {
      var count = 0,
          lastCalled = 0;

      return function(key, value) {
        var stamp = now(),
            remaining = HOT_SPAN - (stamp - lastCalled);

        lastCalled = stamp;
        if (remaining > 0) {
          if (++count >= HOT_COUNT) {
            return key;
          }
        } else {
          count = 0;
        }
        return baseSetData(key, value);
      };
    }());

    /**
     * A fallback implementation of `_.isPlainObject` which checks if `value`
     * is an object created by the `Object` constructor or has a `[[Prototype]]`
     * of `null`.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.
     */
    function shimIsPlainObject(value) {
      var Ctor,
          support = lodash.support;

      // Exit early for non `Object` objects.
      if (!(isObjectLike(value) && objToString.call(value) == objectTag) ||
          (!hasOwnProperty.call(value, 'constructor') &&
            (Ctor = value.constructor, typeof Ctor == 'function' && !(Ctor instanceof Ctor)))) {
        return false;
      }
      // IE < 9 iterates inherited properties before own properties. If the first
      // iterated property is an object's own property then there are no inherited
      // enumerable properties.
      var result;
      // In most environments an object's own properties are iterated before
      // its inherited properties. If the last iterated property is an object's
      // own property then there are no inherited enumerable properties.
      baseForIn(value, function(subValue, key) {
        result = key;
      });
      return typeof result == 'undefined' || hasOwnProperty.call(value, result);
    }

    /**
     * A fallback implementation of `Object.keys` which creates an array of the
     * own enumerable property names of `object`.
     *
     * @private
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns the array of property names.
     */
    function shimKeys(object) {
      var props = keysIn(object),
          propsLength = props.length,
          length = propsLength && object.length,
          support = lodash.support;

      var allowIndexes = length && isLength(length) &&
        (isArray(object) || (support.nonEnumArgs && isArguments(object)));

      var index = -1,
          result = [];

      while (++index < propsLength) {
        var key = props[index];
        if ((allowIndexes && isIndex(key, length)) || hasOwnProperty.call(object, key)) {
          result.push(key);
        }
      }
      return result;
    }

    /**
     * Converts `value` to an array-like object if it is not one.
     *
     * @private
     * @param {*} value The value to process.
     * @returns {Array|Object} Returns the array-like object.
     */
    function toIterable(value) {
      if (value == null) {
        return [];
      }
      if (!isLength(value.length)) {
        return values(value);
      }
      return isObject(value) ? value : Object(value);
    }

    /**
     * Converts `value` to an object if it is not one.
     *
     * @private
     * @param {*} value The value to process.
     * @returns {Object} Returns the object.
     */
    function toObject(value) {
      return isObject(value) ? value : Object(value);
    }

    /**
     * Creates a clone of `wrapper`.
     *
     * @private
     * @param {Object} wrapper The wrapper to clone.
     * @returns {Object} Returns the cloned wrapper.
     */
    function wrapperClone(wrapper) {
      return wrapper instanceof LazyWrapper
        ? wrapper.clone()
        : new LodashWrapper(wrapper.__wrapped__, wrapper.__chain__, arrayCopy(wrapper.__actions__));
    }

    /*------------------------------------------------------------------------*/

    /**
     * Creates an array of elements split into groups the length of `size`.
     * If `collection` can't be split evenly, the final chunk will be the remaining
     * elements.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to process.
     * @param {number} [size=1] The length of each chunk.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {Array} Returns the new array containing chunks.
     * @example
     *
     * _.chunk(['a', 'b', 'c', 'd'], 2);
     * // => [['a', 'b'], ['c', 'd']]
     *
     * _.chunk(['a', 'b', 'c', 'd'], 3);
     * // => [['a', 'b', 'c'], ['d']]
     */
    function chunk(array, size, guard) {
      if (guard ? isIterateeCall(array, size, guard) : size == null) {
        size = 1;
      } else {
        size = nativeMax(+size || 1, 1);
      }
      var index = 0,
          length = array ? array.length : 0,
          resIndex = -1,
          result = Array(ceil(length / size));

      while (index < length) {
        result[++resIndex] = baseSlice(array, index, (index += size));
      }
      return result;
    }

    /**
     * Creates an array with all falsey values removed. The values `false`, `null`,
     * `0`, `""`, `undefined`, and `NaN` are falsey.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to compact.
     * @returns {Array} Returns the new array of filtered values.
     * @example
     *
     * _.compact([0, 1, false, 2, '', 3]);
     * // => [1, 2, 3]
     */
    function compact(array) {
      var index = -1,
          length = array ? array.length : 0,
          resIndex = -1,
          result = [];

      while (++index < length) {
        var value = array[index];
        if (value) {
          result[++resIndex] = value;
        }
      }
      return result;
    }

    /**
     * Creates an array excluding all values of the provided arrays using
     * `SameValueZero` for equality comparisons.
     *
     * **Note:** `SameValueZero` comparisons are like strict equality comparisons,
     * e.g. `===`, except that `NaN` matches `NaN`. See the
     * [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-samevaluezero)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {...Array} [values] The arrays of values to exclude.
     * @returns {Array} Returns the new array of filtered values.
     * @example
     *
     * _.difference([1, 2, 3], [4, 2]);
     * // => [1, 3]
     */
    function difference() {
      var args = arguments,
          index = -1,
          length = args.length;

      while (++index < length) {
        var value = args[index];
        if (isArray(value) || isArguments(value)) {
          break;
        }
      }
      return baseDifference(value, baseFlatten(args, false, true, ++index));
    }

    /**
     * Creates a slice of `array` with `n` elements dropped from the beginning.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=1] The number of elements to drop.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.drop([1, 2, 3]);
     * // => [2, 3]
     *
     * _.drop([1, 2, 3], 2);
     * // => [3]
     *
     * _.drop([1, 2, 3], 5);
     * // => []
     *
     * _.drop([1, 2, 3], 0);
     * // => [1, 2, 3]
     */
    function drop(array, n, guard) {
      var length = array ? array.length : 0;
      if (!length) {
        return [];
      }
      if (guard ? isIterateeCall(array, n, guard) : n == null) {
        n = 1;
      }
      return baseSlice(array, n < 0 ? 0 : n);
    }

    /**
     * Creates a slice of `array` with `n` elements dropped from the end.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=1] The number of elements to drop.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.dropRight([1, 2, 3]);
     * // => [1, 2]
     *
     * _.dropRight([1, 2, 3], 2);
     * // => [1]
     *
     * _.dropRight([1, 2, 3], 5);
     * // => []
     *
     * _.dropRight([1, 2, 3], 0);
     * // => [1, 2, 3]
     */
    function dropRight(array, n, guard) {
      var length = array ? array.length : 0;
      if (!length) {
        return [];
      }
      if (guard ? isIterateeCall(array, n, guard) : n == null) {
        n = 1;
      }
      n = length - (+n || 0);
      return baseSlice(array, 0, n < 0 ? 0 : n);
    }

    /**
     * Creates a slice of `array` excluding elements dropped from the end.
     * Elements are dropped until `predicate` returns falsey. The predicate is
     * bound to `thisArg` and invoked with three arguments; (value, index, array).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that match the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to query.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.dropRightWhile([1, 2, 3], function(n) {
     *   return n > 1;
     * });
     * // => [1]
     *
     * var users = [
     *   { 'user': 'barney',  'active': true },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': false }
     * ];
     *
     * // using the `_.matches` callback shorthand
     * _.pluck(_.dropRightWhile(users, { 'user': 'pebbles', 'active': false }), 'user');
     * // => ['barney', 'fred']
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.pluck(_.dropRightWhile(users, 'active', false), 'user');
     * // => ['barney']
     *
     * // using the `_.property` callback shorthand
     * _.pluck(_.dropRightWhile(users, 'active'), 'user');
     * // => ['barney', 'fred', 'pebbles']
     */
    function dropRightWhile(array, predicate, thisArg) {
      var length = array ? array.length : 0;
      if (!length) {
        return [];
      }
      predicate = getCallback(predicate, thisArg, 3);
      while (length-- && predicate(array[length], length, array)) {}
      return baseSlice(array, 0, length + 1);
    }

    /**
     * Creates a slice of `array` excluding elements dropped from the beginning.
     * Elements are dropped until `predicate` returns falsey. The predicate is
     * bound to `thisArg` and invoked with three arguments; (value, index, array).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to query.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.dropWhile([1, 2, 3], function(n) {
     *   return n < 3;
     * });
     * // => [3]
     *
     * var users = [
     *   { 'user': 'barney',  'active': false },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': true }
     * ];
     *
     * // using the `_.matches` callback shorthand
     * _.pluck(_.dropWhile(users, { 'user': 'barney', 'active': false }), 'user');
     * // => ['fred', 'pebbles']
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.pluck(_.dropWhile(users, 'active', false), 'user');
     * // => ['pebbles']
     *
     * // using the `_.property` callback shorthand
     * _.pluck(_.dropWhile(users, 'active'), 'user');
     * // => ['barney', 'fred', 'pebbles']
     */
    function dropWhile(array, predicate, thisArg) {
      var length = array ? array.length : 0;
      if (!length) {
        return [];
      }
      var index = -1;
      predicate = getCallback(predicate, thisArg, 3);
      while (++index < length && predicate(array[index], index, array)) {}
      return baseSlice(array, index);
    }

    /**
     * Fills elements of `array` with `value` from `start` up to, but not
     * including, `end`.
     *
     * **Note:** This method mutates `array`.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to fill.
     * @param {*} value The value to fill `array` with.
     * @param {number} [start=0] The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns `array`.
     */
    function fill(array, value, start, end) {
      var length = array ? array.length : 0;
      if (!length) {
        return [];
      }
      if (start && typeof start != 'number' && isIterateeCall(array, value, start)) {
        start = 0;
        end = length;
      }
      return baseFill(array, value, start, end);
    }

    /**
     * This method is like `_.find` except that it returns the index of the first
     * element `predicate` returns truthy for, instead of the element itself.
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to search.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {number} Returns the index of the found element, else `-1`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': false },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': true }
     * ];
     *
     * _.findIndex(users, function(chr) {
     *   return chr.user == 'barney';
     * });
     * // => 0
     *
     * // using the `_.matches` callback shorthand
     * _.findIndex(users, { 'user': 'fred', 'active': false });
     * // => 1
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.findIndex(users, 'active', false);
     * // => 0
     *
     * // using the `_.property` callback shorthand
     * _.findIndex(users, 'active');
     * // => 2
     */
    function findIndex(array, predicate, thisArg) {
      var index = -1,
          length = array ? array.length : 0;

      predicate = getCallback(predicate, thisArg, 3);
      while (++index < length) {
        if (predicate(array[index], index, array)) {
          return index;
        }
      }
      return -1;
    }

    /**
     * This method is like `_.findIndex` except that it iterates over elements
     * of `collection` from right to left.
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to search.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {number} Returns the index of the found element, else `-1`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': true },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': false }
     * ];
     *
     * _.findLastIndex(users, function(chr) {
     *   return chr.user == 'pebbles';
     * });
     * // => 2
     *
     * // using the `_.matches` callback shorthand
     * _.findLastIndex(users, { 'user': 'barney', 'active': true });
     * // => 0
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.findLastIndex(users, 'active', false);
     * // => 2
     *
     * // using the `_.property` callback shorthand
     * _.findLastIndex(users, 'active');
     * // => 0
     */
    function findLastIndex(array, predicate, thisArg) {
      var length = array ? array.length : 0;
      predicate = getCallback(predicate, thisArg, 3);
      while (length--) {
        if (predicate(array[length], length, array)) {
          return length;
        }
      }
      return -1;
    }

    /**
     * Gets the first element of `array`.
     *
     * @static
     * @memberOf _
     * @alias head
     * @category Array
     * @param {Array} array The array to query.
     * @returns {*} Returns the first element of `array`.
     * @example
     *
     * _.first([1, 2, 3]);
     * // => 1
     *
     * _.first([]);
     * // => undefined
     */
    function first(array) {
      return array ? array[0] : undefined;
    }

    /**
     * Flattens a nested array. If `isDeep` is `true` the array is recursively
     * flattened, otherwise it is only flattened a single level.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to flatten.
     * @param {boolean} [isDeep] Specify a deep flatten.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * _.flatten([1, [2, 3, [4]]]);
     * // => [1, 2, 3, [4]];
     *
     * // using `isDeep`
     * _.flatten([1, [2, 3, [4]]], true);
     * // => [1, 2, 3, 4];
     */
    function flatten(array, isDeep, guard) {
      var length = array ? array.length : 0;
      if (guard && isIterateeCall(array, isDeep, guard)) {
        isDeep = false;
      }
      return length ? baseFlatten(array, isDeep, false, 0) : [];
    }

    /**
     * Recursively flattens a nested array.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to recursively flatten.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * _.flattenDeep([1, [2, 3, [4]]]);
     * // => [1, 2, 3, 4];
     */
    function flattenDeep(array) {
      var length = array ? array.length : 0;
      return length ? baseFlatten(array, true, false, 0) : [];
    }

    /**
     * Gets the index at which the first occurrence of `value` is found in `array`
     * using `SameValueZero` for equality comparisons. If `fromIndex` is negative,
     * it is used as the offset from the end of `array`. If `array` is sorted
     * providing `true` for `fromIndex` performs a faster binary search.
     *
     * **Note:** `SameValueZero` comparisons are like strict equality comparisons,
     * e.g. `===`, except that `NaN` matches `NaN`. See the
     * [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-samevaluezero)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to search.
     * @param {*} value The value to search for.
     * @param {boolean|number} [fromIndex=0] The index to search from or `true`
     *  to perform a binary search on a sorted array.
     * @returns {number} Returns the index of the matched value, else `-1`.
     * @example
     *
     * _.indexOf([1, 2, 1, 2], 2);
     * // => 1
     *
     * // using `fromIndex`
     * _.indexOf([1, 2, 1, 2], 2, 2);
     * // => 3
     *
     * // performing a binary search
     * _.indexOf([1, 1, 2, 2], 2, true);
     * // => 2
     */
    function indexOf(array, value, fromIndex) {
      var length = array ? array.length : 0;
      if (!length) {
        return -1;
      }
      if (typeof fromIndex == 'number') {
        fromIndex = fromIndex < 0 ? nativeMax(length + fromIndex, 0) : fromIndex;
      } else if (fromIndex) {
        var index = binaryIndex(array, value),
            other = array[index];

        return (value === value ? value === other : other !== other) ? index : -1;
      }
      return baseIndexOf(array, value, fromIndex || 0);
    }

    /**
     * Gets all but the last element of `array`.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to query.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.initial([1, 2, 3]);
     * // => [1, 2]
     */
    function initial(array) {
      return dropRight(array, 1);
    }

    /**
     * Creates an array of unique values in all provided arrays using `SameValueZero`
     * for equality comparisons.
     *
     * **Note:** `SameValueZero` comparisons are like strict equality comparisons,
     * e.g. `===`, except that `NaN` matches `NaN`. See the
     * [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-samevaluezero)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @returns {Array} Returns the new array of shared values.
     * @example
     * _.intersection([1, 2], [4, 2], [2, 1]);
     * // => [2]
     */
    function intersection() {
      var args = [],
          argsIndex = -1,
          argsLength = arguments.length,
          caches = [],
          indexOf = getIndexOf(),
          isCommon = indexOf == baseIndexOf;

      while (++argsIndex < argsLength) {
        var value = arguments[argsIndex];
        if (isArray(value) || isArguments(value)) {
          args.push(value);
          caches.push((isCommon && value.length >= 120) ? createCache(argsIndex && value) : null);
        }
      }
      argsLength = args.length;
      var array = args[0],
          index = -1,
          length = array ? array.length : 0,
          result = [],
          seen = caches[0];

      outer:
      while (++index < length) {
        value = array[index];
        if ((seen ? cacheIndexOf(seen, value) : indexOf(result, value, 0)) < 0) {
          argsIndex = argsLength;
          while (--argsIndex) {
            var cache = caches[argsIndex];
            if ((cache ? cacheIndexOf(cache, value) : indexOf(args[argsIndex], value, 0)) < 0) {
              continue outer;
            }
          }
          if (seen) {
            seen.push(value);
          }
          result.push(value);
        }
      }
      return result;
    }

    /**
     * Gets the last element of `array`.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to query.
     * @returns {*} Returns the last element of `array`.
     * @example
     *
     * _.last([1, 2, 3]);
     * // => 3
     */
    function last(array) {
      var length = array ? array.length : 0;
      return length ? array[length - 1] : undefined;
    }

    /**
     * This method is like `_.indexOf` except that it iterates over elements of
     * `array` from right to left.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to search.
     * @param {*} value The value to search for.
     * @param {boolean|number} [fromIndex=array.length-1] The index to search from
     *  or `true` to perform a binary search on a sorted array.
     * @returns {number} Returns the index of the matched value, else `-1`.
     * @example
     *
     * _.lastIndexOf([1, 2, 1, 2], 2);
     * // => 3
     *
     * // using `fromIndex`
     * _.lastIndexOf([1, 2, 1, 2], 2, 2);
     * // => 1
     *
     * // performing a binary search
     * _.lastIndexOf([1, 1, 2, 2], 2, true);
     * // => 3
     */
    function lastIndexOf(array, value, fromIndex) {
      var length = array ? array.length : 0;
      if (!length) {
        return -1;
      }
      var index = length;
      if (typeof fromIndex == 'number') {
        index = (fromIndex < 0 ? nativeMax(length + fromIndex, 0) : nativeMin(fromIndex || 0, length - 1)) + 1;
      } else if (fromIndex) {
        index = binaryIndex(array, value, true) - 1;
        var other = array[index];
        return (value === value ? value === other : other !== other) ? index : -1;
      }
      if (value !== value) {
        return indexOfNaN(array, index, true);
      }
      while (index--) {
        if (array[index] === value) {
          return index;
        }
      }
      return -1;
    }

    /**
     * Removes all provided values from `array` using `SameValueZero` for equality
     * comparisons.
     *
     * **Notes:**
     *  - Unlike `_.without`, this method mutates `array`.
     *  - `SameValueZero` comparisons are like strict equality comparisons, e.g. `===`,
     *    except that `NaN` matches `NaN`. See the [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-samevaluezero)
     *    for more details.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to modify.
     * @param {...*} [values] The values to remove.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = [1, 2, 3, 1, 2, 3];
     *
     * _.pull(array, 2, 3);
     * console.log(array);
     * // => [1, 1]
     */
    function pull() {
      var args = arguments,
          array = args[0];

      if (!(array && array.length)) {
        return array;
      }
      var index = 0,
          indexOf = getIndexOf(),
          length = args.length;

      while (++index < length) {
        var fromIndex = 0,
            value = args[index];

        while ((fromIndex = indexOf(array, value, fromIndex)) > -1) {
          splice.call(array, fromIndex, 1);
        }
      }
      return array;
    }

    /**
     * Removes elements from `array` corresponding to the given indexes and returns
     * an array of the removed elements. Indexes may be specified as an array of
     * indexes or as individual arguments.
     *
     * **Note:** Unlike `_.at`, this method mutates `array`.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to modify.
     * @param {...(number|number[])} [indexes] The indexes of elements to remove,
     *  specified as individual indexes or arrays of indexes.
     * @returns {Array} Returns the new array of removed elements.
     * @example
     *
     * var array = [5, 10, 15, 20];
     * var evens = _.pullAt(array, 1, 3);
     *
     * console.log(array);
     * // => [5, 15]
     *
     * console.log(evens);
     * // => [10, 20]
     */
    function pullAt(array) {
      return basePullAt(array || [], baseFlatten(arguments, false, false, 1));
    }

    /**
     * Removes all elements from `array` that `predicate` returns truthy for
     * and returns an array of the removed elements. The predicate is bound to
     * `thisArg` and invoked with three arguments; (value, index, array).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * **Note:** Unlike `_.filter`, this method mutates `array`.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to modify.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {Array} Returns the new array of removed elements.
     * @example
     *
     * var array = [1, 2, 3, 4];
     * var evens = _.remove(array, function(n) {
     *   return n % 2 == 0;
     * });
     *
     * console.log(array);
     * // => [1, 3]
     *
     * console.log(evens);
     * // => [2, 4]
     */
    function remove(array, predicate, thisArg) {
      var index = -1,
          length = array ? array.length : 0,
          result = [];

      predicate = getCallback(predicate, thisArg, 3);
      while (++index < length) {
        var value = array[index];
        if (predicate(value, index, array)) {
          result.push(value);
          splice.call(array, index--, 1);
          length--;
        }
      }
      return result;
    }

    /**
     * Gets all but the first element of `array`.
     *
     * @static
     * @memberOf _
     * @alias tail
     * @category Array
     * @param {Array} array The array to query.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.rest([1, 2, 3]);
     * // => [2, 3]
     */
    function rest(array) {
      return drop(array, 1);
    }

    /**
     * Creates a slice of `array` from `start` up to, but not including, `end`.
     *
     * **Note:** This function is used instead of `Array#slice` to support node
     * lists in IE < 9 and to ensure dense arrays are returned.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to slice.
     * @param {number} [start=0] The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns the slice of `array`.
     */
    function slice(array, start, end) {
      var length = array ? array.length : 0;
      if (!length) {
        return [];
      }
      if (end && typeof end != 'number' && isIterateeCall(array, start, end)) {
        start = 0;
        end = length;
      }
      return baseSlice(array, start, end);
    }

    /**
     * Uses a binary search to determine the lowest index at which `value` should
     * be inserted into `array` in order to maintain its sort order. If an iteratee
     * function is provided it is invoked for `value` and each element of `array`
     * to compute their sort ranking. The iteratee is bound to `thisArg` and
     * invoked with one argument; (value).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @param {Function|Object|string} [iteratee=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     * @example
     *
     * _.sortedIndex([30, 50], 40);
     * // => 1
     *
     * _.sortedIndex([4, 4, 5, 5], 5);
     * // => 2
     *
     * var dict = { 'data': { 'thirty': 30, 'forty': 40, 'fifty': 50 } };
     *
     * // using an iteratee function
     * _.sortedIndex(['thirty', 'fifty'], 'forty', function(word) {
     *   return this.data[word];
     * }, dict);
     * // => 1
     *
     * // using the `_.property` callback shorthand
     * _.sortedIndex([{ 'x': 30 }, { 'x': 50 }], { 'x': 40 }, 'x');
     * // => 1
     */
    function sortedIndex(array, value, iteratee, thisArg) {
      var func = getCallback(iteratee);
      return (func === baseCallback && iteratee == null)
        ? binaryIndex(array, value)
        : binaryIndexBy(array, value, func(iteratee, thisArg, 1));
    }

    /**
     * This method is like `_.sortedIndex` except that it returns the highest
     * index at which `value` should be inserted into `array` in order to
     * maintain its sort order.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @param {Function|Object|string} [iteratee=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     * @example
     *
     * _.sortedLastIndex([4, 4, 5, 5], 5);
     * // => 4
     */
    function sortedLastIndex(array, value, iteratee, thisArg) {
      var func = getCallback(iteratee);
      return (func === baseCallback && iteratee == null)
        ? binaryIndex(array, value, true)
        : binaryIndexBy(array, value, func(iteratee, thisArg, 1), true);
    }

    /**
     * Creates a slice of `array` with `n` elements taken from the beginning.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=1] The number of elements to take.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.take([1, 2, 3]);
     * // => [1]
     *
     * _.take([1, 2, 3], 2);
     * // => [1, 2]
     *
     * _.take([1, 2, 3], 5);
     * // => [1, 2, 3]
     *
     * _.take([1, 2, 3], 0);
     * // => []
     */
    function take(array, n, guard) {
      var length = array ? array.length : 0;
      if (!length) {
        return [];
      }
      if (guard ? isIterateeCall(array, n, guard) : n == null) {
        n = 1;
      }
      return baseSlice(array, 0, n < 0 ? 0 : n);
    }

    /**
     * Creates a slice of `array` with `n` elements taken from the end.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=1] The number of elements to take.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.takeRight([1, 2, 3]);
     * // => [3]
     *
     * _.takeRight([1, 2, 3], 2);
     * // => [2, 3]
     *
     * _.takeRight([1, 2, 3], 5);
     * // => [1, 2, 3]
     *
     * _.takeRight([1, 2, 3], 0);
     * // => []
     */
    function takeRight(array, n, guard) {
      var length = array ? array.length : 0;
      if (!length) {
        return [];
      }
      if (guard ? isIterateeCall(array, n, guard) : n == null) {
        n = 1;
      }
      n = length - (+n || 0);
      return baseSlice(array, n < 0 ? 0 : n);
    }

    /**
     * Creates a slice of `array` with elements taken from the end. Elements are
     * taken until `predicate` returns falsey. The predicate is bound to `thisArg`
     * and invoked with three arguments; (value, index, array).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to query.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.takeRightWhile([1, 2, 3], function(n) {
     *   return n > 1;
     * });
     * // => [2, 3]
     *
     * var users = [
     *   { 'user': 'barney',  'active': true },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': false }
     * ];
     *
     * // using the `_.matches` callback shorthand
     * _.pluck(_.takeRightWhile(users, { 'user': 'pebbles', 'active': false }), 'user');
     * // => ['pebbles']
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.pluck(_.takeRightWhile(users, 'active', false), 'user');
     * // => ['fred', 'pebbles']
     *
     * // using the `_.property` callback shorthand
     * _.pluck(_.takeRightWhile(users, 'active'), 'user');
     * // => []
     */
    function takeRightWhile(array, predicate, thisArg) {
      var length = array ? array.length : 0;
      if (!length) {
        return [];
      }
      predicate = getCallback(predicate, thisArg, 3);
      while (length-- && predicate(array[length], length, array)) {}
      return baseSlice(array, length + 1);
    }

    /**
     * Creates a slice of `array` with elements taken from the beginning. Elements
     * are taken until `predicate` returns falsey. The predicate is bound to
     * `thisArg` and invoked with three arguments; (value, index, array).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to query.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.takeWhile([1, 2, 3], function(n) {
     *   return n < 3;
     * });
     * // => [1, 2]
     *
     * var users = [
     *   { 'user': 'barney',  'active': false },
     *   { 'user': 'fred',    'active': false},
     *   { 'user': 'pebbles', 'active': true }
     * ];
     *
     * // using the `_.matches` callback shorthand
     * _.pluck(_.takeWhile(users, { 'user': 'barney', 'active': false }), 'user');
     * // => ['barney']
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.pluck(_.takeWhile(users, 'active', false), 'user');
     * // => ['barney', 'fred']
     *
     * // using the `_.property` callback shorthand
     * _.pluck(_.takeWhile(users, 'active'), 'user');
     * // => []
     */
    function takeWhile(array, predicate, thisArg) {
      var length = array ? array.length : 0;
      if (!length) {
        return [];
      }
      var index = -1;
      predicate = getCallback(predicate, thisArg, 3);
      while (++index < length && predicate(array[index], index, array)) {}
      return baseSlice(array, 0, index);
    }

    /**
     * Creates an array of unique values, in order, of the provided arrays using
     * `SameValueZero` for equality comparisons.
     *
     * **Note:** `SameValueZero` comparisons are like strict equality comparisons,
     * e.g. `===`, except that `NaN` matches `NaN`. See the
     * [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-samevaluezero)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @returns {Array} Returns the new array of combined values.
     * @example
     *
     * _.union([1, 2], [4, 2], [2, 1]);
     * // => [1, 2, 4]
     */
    function union() {
      return baseUniq(baseFlatten(arguments, false, true, 0));
    }

    /**
     * Creates a duplicate-value-free version of an array using `SameValueZero`
     * for equality comparisons. Providing `true` for `isSorted` performs a faster
     * search algorithm for sorted arrays. If an iteratee function is provided it
     * is invoked for each value in the array to generate the criterion by which
     * uniqueness is computed. The `iteratee` is bound to `thisArg` and invoked
     * with three arguments; (value, index, array).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * **Note:** `SameValueZero` comparisons are like strict equality comparisons,
     * e.g. `===`, except that `NaN` matches `NaN`. See the
     * [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-samevaluezero)
     * for more details.
     *
     * @static
     * @memberOf _
     * @alias unique
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {boolean} [isSorted] Specify the array is sorted.
     * @param {Function|Object|string} [iteratee] The function invoked per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Array} Returns the new duplicate-value-free array.
     * @example
     *
     * _.uniq([1, 2, 1]);
     * // => [1, 2]
     *
     * // using `isSorted`
     * _.uniq([1, 1, 2], true);
     * // => [1, 2]
     *
     * // using an iteratee function
     * _.uniq([1, 2.5, 1.5, 2], function(n) {
     *   return this.floor(n);
     * }, Math);
     * // => [1, 2.5]
     *
     * // using the `_.property` callback shorthand
     * _.uniq([{ 'x': 1 }, { 'x': 2 }, { 'x': 1 }], 'x');
     * // => [{ 'x': 1 }, { 'x': 2 }]
     */
    function uniq(array, isSorted, iteratee, thisArg) {
      var length = array ? array.length : 0;
      if (!length) {
        return [];
      }
      if (isSorted != null && typeof isSorted != 'boolean') {
        thisArg = iteratee;
        iteratee = isIterateeCall(array, isSorted, thisArg) ? null : isSorted;
        isSorted = false;
      }
      var func = getCallback();
      if (!(func === baseCallback && iteratee == null)) {
        iteratee = func(iteratee, thisArg, 3);
      }
      return (isSorted && getIndexOf() == baseIndexOf)
        ? sortedUniq(array, iteratee)
        : baseUniq(array, iteratee);
    }

    /**
     * This method is like `_.zip` except that it accepts an array of grouped
     * elements and creates an array regrouping the elements to their pre-`_.zip`
     * configuration.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array of grouped elements to process.
     * @returns {Array} Returns the new array of regrouped elements.
     * @example
     *
     * var zipped = _.zip(['fred', 'barney'], [30, 40], [true, false]);
     * // => [['fred', 30, true], ['barney', 40, false]]
     *
     * _.unzip(zipped);
     * // => [['fred', 'barney'], [30, 40], [true, false]]
     */
    function unzip(array) {
      var index = -1,
          length = (array && array.length && arrayMax(arrayMap(array, getLength))) >>> 0,
          result = Array(length);

      while (++index < length) {
        result[index] = arrayMap(array, baseProperty(index));
      }
      return result;
    }

    /**
     * Creates an array excluding all provided values using `SameValueZero` for
     * equality comparisons.
     *
     * **Note:** `SameValueZero` comparisons are like strict equality comparisons,
     * e.g. `===`, except that `NaN` matches `NaN`. See the
     * [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-samevaluezero)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {Array} array The array to filter.
     * @param {...*} [values] The values to exclude.
     * @returns {Array} Returns the new array of filtered values.
     * @example
     *
     * _.without([1, 2, 1, 3], 1, 2);
     * // => [3]
     */
    function without(array) {
      return baseDifference(array, baseSlice(arguments, 1));
    }

    /**
     * Creates an array that is the symmetric difference of the provided arrays.
     * See [Wikipedia](https://en.wikipedia.org/wiki/Symmetric_difference) for
     * more details.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @returns {Array} Returns the new array of values.
     * @example
     *
     * _.xor([1, 2], [4, 2]);
     * // => [1, 4]
     */
    function xor() {
      var index = -1,
          length = arguments.length;

      while (++index < length) {
        var array = arguments[index];
        if (isArray(array) || isArguments(array)) {
          var result = result
            ? baseDifference(result, array).concat(baseDifference(array, result))
            : array;
        }
      }
      return result ? baseUniq(result) : [];
    }

    /**
     * Creates an array of grouped elements, the first of which contains the first
     * elements of the given arrays, the second of which contains the second elements
     * of the given arrays, and so on.
     *
     * @static
     * @memberOf _
     * @category Array
     * @param {...Array} [arrays] The arrays to process.
     * @returns {Array} Returns the new array of grouped elements.
     * @example
     *
     * _.zip(['fred', 'barney'], [30, 40], [true, false]);
     * // => [['fred', 30, true], ['barney', 40, false]]
     */
    function zip() {
      var length = arguments.length,
          array = Array(length);

      while (length--) {
        array[length] = arguments[length];
      }
      return unzip(array);
    }

    /**
     * Creates an object composed from arrays of property names and values. Provide
     * either a single two dimensional array, e.g. `[[key1, value1], [key2, value2]]`
     * or two arrays, one of property names and one of corresponding values.
     *
     * @static
     * @memberOf _
     * @alias object
     * @category Array
     * @param {Array} props The property names.
     * @param {Array} [values=[]] The property values.
     * @returns {Object} Returns the new object.
     * @example
     *
     * _.zipObject(['fred', 'barney'], [30, 40]);
     * // => { 'fred': 30, 'barney': 40 }
     */
    function zipObject(props, values) {
      var index = -1,
          length = props ? props.length : 0,
          result = {};

      if (length && !values && !isArray(props[0])) {
        values = [];
      }
      while (++index < length) {
        var key = props[index];
        if (values) {
          result[key] = values[index];
        } else if (key) {
          result[key[0]] = key[1];
        }
      }
      return result;
    }

    /*------------------------------------------------------------------------*/

    /**
     * Creates a `lodash` object that wraps `value` with explicit method
     * chaining enabled.
     *
     * @static
     * @memberOf _
     * @category Chain
     * @param {*} value The value to wrap.
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'age': 36 },
     *   { 'user': 'fred',    'age': 40 },
     *   { 'user': 'pebbles', 'age': 1 }
     * ];
     *
     * var youngest = _.chain(users)
     *   .sortBy('age')
     *   .map(function(chr) {
     *     return chr.user + ' is ' + chr.age;
     *   })
     *   .first()
     *   .value();
     * // => 'pebbles is 1'
     */
    function chain(value) {
      var result = lodash(value);
      result.__chain__ = true;
      return result;
    }

    /**
     * This method invokes `interceptor` and returns `value`. The interceptor is
     * bound to `thisArg` and invoked with one argument; (value). The purpose of
     * this method is to "tap into" a method chain in order to perform operations
     * on intermediate results within the chain.
     *
     * @static
     * @memberOf _
     * @category Chain
     * @param {*} value The value to provide to `interceptor`.
     * @param {Function} interceptor The function to invoke.
     * @param {*} [thisArg] The `this` binding of `interceptor`.
     * @returns {*} Returns `value`.
     * @example
     *
     * _([1, 2, 3])
     *  .tap(function(array) {
     *    array.pop();
     *  })
     *  .reverse()
     *  .value();
     * // => [2, 1]
     */
    function tap(value, interceptor, thisArg) {
      interceptor.call(thisArg, value);
      return value;
    }

    /**
     * This method is like `_.tap` except that it returns the result of `interceptor`.
     *
     * @static
     * @memberOf _
     * @category Chain
     * @param {*} value The value to provide to `interceptor`.
     * @param {Function} interceptor The function to invoke.
     * @param {*} [thisArg] The `this` binding of `interceptor`.
     * @returns {*} Returns the result of `interceptor`.
     * @example
     *
     * _([1, 2, 3])
     *  .last()
     *  .thru(function(value) {
     *    return [value];
     *  })
     *  .value();
     * // => [3]
     */
    function thru(value, interceptor, thisArg) {
      return interceptor.call(thisArg, value);
    }

    /**
     * Enables explicit method chaining on the wrapper object.
     *
     * @name chain
     * @memberOf _
     * @category Chain
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36 },
     *   { 'user': 'fred',   'age': 40 }
     * ];
     *
     * // without explicit chaining
     * _(users).first();
     * // => { 'user': 'barney', 'age': 36 }
     *
     * // with explicit chaining
     * _(users).chain()
     *   .first()
     *   .pick('user')
     *   .value();
     * // => { 'user': 'barney' }
     */
    function wrapperChain() {
      return chain(this);
    }

    /**
     * Executes the chained sequence and returns the wrapped result.
     *
     * @name commit
     * @memberOf _
     * @category Chain
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var array = [1, 2];
     * var wrapper = _(array).push(3);
     *
     * console.log(array);
     * // => [1, 2]
     *
     * wrapper = wrapper.commit();
     * console.log(array);
     * // => [1, 2, 3]
     *
     * wrapper.last();
     * // => 3
     *
     * console.log(array);
     * // => [1, 2, 3]
     */
    function wrapperCommit() {
      return new LodashWrapper(this.value(), this.__chain__);
    }

    /**
     * Creates a clone of the chained sequence planting `value` as the wrapped value.
     *
     * @name plant
     * @memberOf _
     * @category Chain
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var array = [1, 2];
     * var wrapper = _(array).map(function(value) {
     *   return Math.pow(value, 2);
     * });
     *
     * var other = [3, 4];
     * var otherWrapper = wrapper.plant(other);
     *
     * otherWrapper.value();
     * // => [9, 16]
     *
     * wrapper.value();
     * // => [1, 4]
     */
    function wrapperPlant(value) {
      var result,
          parent = this;

      while (parent instanceof baseLodash) {
        var clone = wrapperClone(parent);
        if (result) {
          previous.__wrapped__ = clone;
        } else {
          result = clone;
        }
        var previous = clone;
        parent = parent.__wrapped__;
      }
      previous.__wrapped__ = value;
      return result;
    }

    /**
     * Reverses the wrapped array so the first element becomes the last, the
     * second element becomes the second to last, and so on.
     *
     * **Note:** This method mutates the wrapped array.
     *
     * @name reverse
     * @memberOf _
     * @category Chain
     * @returns {Object} Returns the new reversed `lodash` wrapper instance.
     * @example
     *
     * var array = [1, 2, 3];
     *
     * _(array).reverse().value()
     * // => [3, 2, 1]
     *
     * console.log(array);
     * // => [3, 2, 1]
     */
    function wrapperReverse() {
      var value = this.__wrapped__;
      if (value instanceof LazyWrapper) {
        if (this.__actions__.length) {
          value = new LazyWrapper(this);
        }
        return new LodashWrapper(value.reverse(), this.__chain__);
      }
      return this.thru(function(value) {
        return value.reverse();
      });
    }

    /**
     * Produces the result of coercing the unwrapped value to a string.
     *
     * @name toString
     * @memberOf _
     * @category Chain
     * @returns {string} Returns the coerced string value.
     * @example
     *
     * _([1, 2, 3]).toString();
     * // => '1,2,3'
     */
    function wrapperToString() {
      return (this.value() + '');
    }

    /**
     * Executes the chained sequence to extract the unwrapped value.
     *
     * @name value
     * @memberOf _
     * @alias run, toJSON, valueOf
     * @category Chain
     * @returns {*} Returns the resolved unwrapped value.
     * @example
     *
     * _([1, 2, 3]).value();
     * // => [1, 2, 3]
     */
    function wrapperValue() {
      return baseWrapperValue(this.__wrapped__, this.__actions__);
    }

    /*------------------------------------------------------------------------*/

    /**
     * Creates an array of elements corresponding to the given keys, or indexes,
     * of `collection`. Keys may be specified as individual arguments or as arrays
     * of keys.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {...(number|number[]|string|string[])} [props] The property names
     *  or indexes of elements to pick, specified individually or in arrays.
     * @returns {Array} Returns the new array of picked elements.
     * @example
     *
     * _.at(['a', 'b', 'c'], [0, 2]);
     * // => ['a', 'c']
     *
     * _.at(['fred', 'barney', 'pebbles'], 0, 2);
     * // => ['fred', 'pebbles']
     */
    function at(collection) {
      var length = collection ? collection.length : 0;
      if (isLength(length)) {
        collection = toIterable(collection);
      }
      return baseAt(collection, baseFlatten(arguments, false, false, 1));
    }

    /**
     * Creates an object composed of keys generated from the results of running
     * each element of `collection` through `iteratee`. The corresponding value
     * of each key is the number of times the key was returned by `iteratee`.
     * The `iteratee` is bound to `thisArg` and invoked with three arguments;
     * (value, index|key, collection).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [iteratee=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Object} Returns the composed aggregate object.
     * @example
     *
     * _.countBy([4.3, 6.1, 6.4], function(n) {
     *   return Math.floor(n);
     * });
     * // => { '4': 1, '6': 2 }
     *
     * _.countBy([4.3, 6.1, 6.4], function(n) {
     *   return this.floor(n);
     * }, Math);
     * // => { '4': 1, '6': 2 }
     *
     * _.countBy(['one', 'two', 'three'], 'length');
     * // => { '3': 2, '5': 1 }
     */
    var countBy = createAggregator(function(result, value, key) {
      hasOwnProperty.call(result, key) ? ++result[key] : (result[key] = 1);
    });

    /**
     * Checks if `predicate` returns truthy for **all** elements of `collection`.
     * The predicate is bound to `thisArg` and invoked with three arguments;
     * (value, index|key, collection).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @alias all
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {boolean} Returns `true` if all elements pass the predicate check,
     *  else `false`.
     * @example
     *
     * _.every([true, 1, null, 'yes'], Boolean);
     * // => false
     *
     * var users = [
     *   { 'user': 'barney', 'active': false },
     *   { 'user': 'fred',   'active': false }
     * ];
     *
     * // using the `_.matches` callback shorthand
     * _.every(users, { 'user': 'barney', 'active': false });
     * // => false
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.every(users, 'active', false);
     * // => true
     *
     * // using the `_.property` callback shorthand
     * _.every(users, 'active');
     * // => false
     */
    function every(collection, predicate, thisArg) {
      var func = isArray(collection) ? arrayEvery : baseEvery;
      if (typeof predicate != 'function' || typeof thisArg != 'undefined') {
        predicate = getCallback(predicate, thisArg, 3);
      }
      return func(collection, predicate);
    }

    /**
     * Iterates over elements of `collection`, returning an array of all elements
     * `predicate` returns truthy for. The predicate is bound to `thisArg` and
     * invoked with three arguments; (value, index|key, collection).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @alias select
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {Array} Returns the new filtered array.
     * @example
     *
     * _.filter([4, 5, 6], function(n) {
     *   return n % 2 == 0;
     * });
     * // => [4, 6]
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36, 'active': true },
     *   { 'user': 'fred',   'age': 40, 'active': false }
     * ];
     *
     * // using the `_.matches` callback shorthand
     * _.pluck(_.filter(users, { 'age': 36, 'active': true }), 'user');
     * // => ['barney']
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.pluck(_.filter(users, 'active', false), 'user');
     * // => ['fred']
     *
     * // using the `_.property` callback shorthand
     * _.pluck(_.filter(users, 'active'), 'user');
     * // => ['barney']
     */
    function filter(collection, predicate, thisArg) {
      var func = isArray(collection) ? arrayFilter : baseFilter;
      predicate = getCallback(predicate, thisArg, 3);
      return func(collection, predicate);
    }

    /**
     * Iterates over elements of `collection`, returning the first element
     * `predicate` returns truthy for. The predicate is bound to `thisArg` and
     * invoked with three arguments; (value, index|key, collection).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @alias detect
     * @category Collection
     * @param {Array|Object|string} collection The collection to search.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {*} Returns the matched element, else `undefined`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'age': 36, 'active': true },
     *   { 'user': 'fred',    'age': 40, 'active': false },
     *   { 'user': 'pebbles', 'age': 1,  'active': true }
     * ];
     *
     * _.result(_.find(users, function(chr) {
     *   return chr.age < 40;
     * }), 'user');
     * // => 'barney'
     *
     * // using the `_.matches` callback shorthand
     * _.result(_.find(users, { 'age': 1, 'active': true }), 'user');
     * // => 'pebbles'
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.result(_.find(users, 'active', false), 'user');
     * // => 'fred'
     *
     * // using the `_.property` callback shorthand
     * _.result(_.find(users, 'active'), 'user');
     * // => 'barney'
     */
    function find(collection, predicate, thisArg) {
      if (isArray(collection)) {
        var index = findIndex(collection, predicate, thisArg);
        return index > -1 ? collection[index] : undefined;
      }
      predicate = getCallback(predicate, thisArg, 3);
      return baseFind(collection, predicate, baseEach);
    }

    /**
     * This method is like `_.find` except that it iterates over elements of
     * `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to search.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {*} Returns the matched element, else `undefined`.
     * @example
     *
     * _.findLast([1, 2, 3, 4], function(n) {
     *   return n % 2 == 1;
     * });
     * // => 3
     */
    function findLast(collection, predicate, thisArg) {
      predicate = getCallback(predicate, thisArg, 3);
      return baseFind(collection, predicate, baseEachRight);
    }

    /**
     * Performs a deep comparison between each element in `collection` and the
     * source object, returning the first element that has equivalent property
     * values.
     *
     * **Note:** This method supports comparing arrays, booleans, `Date` objects,
     * numbers, `Object` objects, regexes, and strings. Objects are compared by
     * their own, not inherited, enumerable properties. For comparing a single
     * own or inherited property value see `_.matchesProperty`.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to search.
     * @param {Object} source The object of property values to match.
     * @returns {*} Returns the matched element, else `undefined`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36, 'active': true },
     *   { 'user': 'fred',   'age': 40, 'active': false }
     * ];
     *
     * _.result(_.findWhere(users, { 'age': 36, 'active': true }), 'user');
     * // => 'barney'
     *
     * _.result(_.findWhere(users, { 'age': 40, 'active': false }), 'user');
     * // => 'fred'
     */
    function findWhere(collection, source) {
      return find(collection, baseMatches(source));
    }

    /**
     * Iterates over elements of `collection` invoking `iteratee` for each element.
     * The `iteratee` is bound to `thisArg` and invoked with three arguments;
     * (value, index|key, collection). Iterator functions may exit iteration early
     * by explicitly returning `false`.
     *
     * **Note:** As with other "Collections" methods, objects with a `length` property
     * are iterated like arrays. To avoid this behavior `_.forIn` or `_.forOwn`
     * may be used for object iteration.
     *
     * @static
     * @memberOf _
     * @alias each
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Array|Object|string} Returns `collection`.
     * @example
     *
     * _([1, 2]).forEach(function(n) {
     *   console.log(n);
     * }).value();
     * // => logs each value from left to right and returns the array
     *
     * _.forEach({ 'a': 1, 'b': 2 }, function(n, key) {
     *   console.log(n, key);
     * });
     * // => logs each value-key pair and returns the object (iteration order is not guaranteed)
     */
    function forEach(collection, iteratee, thisArg) {
      return (typeof iteratee == 'function' && typeof thisArg == 'undefined' && isArray(collection))
        ? arrayEach(collection, iteratee)
        : baseEach(collection, bindCallback(iteratee, thisArg, 3));
    }

    /**
     * This method is like `_.forEach` except that it iterates over elements of
     * `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @alias eachRight
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Array|Object|string} Returns `collection`.
     * @example
     *
     * _([1, 2]).forEachRight(function(n) {
     *   console.log(n);
     * }).join(',');
     * // => logs each value from right to left and returns the array
     */
    function forEachRight(collection, iteratee, thisArg) {
      return (typeof iteratee == 'function' && typeof thisArg == 'undefined' && isArray(collection))
        ? arrayEachRight(collection, iteratee)
        : baseEachRight(collection, bindCallback(iteratee, thisArg, 3));
    }

    /**
     * Creates an object composed of keys generated from the results of running
     * each element of `collection` through `iteratee`. The corresponding value
     * of each key is an array of the elements responsible for generating the key.
     * The `iteratee` is bound to `thisArg` and invoked with three arguments;
     * (value, index|key, collection).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [iteratee=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Object} Returns the composed aggregate object.
     * @example
     *
     * _.groupBy([4.2, 6.1, 6.4], function(n) {
     *   return Math.floor(n);
     * });
     * // => { '4': [4.2], '6': [6.1, 6.4] }
     *
     * _.groupBy([4.2, 6.1, 6.4], function(n) {
     *   return this.floor(n);
     * }, Math);
     * // => { '4': [4.2], '6': [6.1, 6.4] }
     *
     * // using the `_.property` callback shorthand
     * _.groupBy(['one', 'two', 'three'], 'length');
     * // => { '3': ['one', 'two'], '5': ['three'] }
     */
    var groupBy = createAggregator(function(result, value, key) {
      if (hasOwnProperty.call(result, key)) {
        result[key].push(value);
      } else {
        result[key] = [value];
      }
    });

    /**
     * Checks if `value` is in `collection` using `SameValueZero` for equality
     * comparisons. If `fromIndex` is negative, it is used as the offset from
     * the end of `collection`.
     *
     * **Note:** `SameValueZero` comparisons are like strict equality comparisons,
     * e.g. `===`, except that `NaN` matches `NaN`. See the
     * [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-samevaluezero)
     * for more details.
     *
     * @static
     * @memberOf _
     * @alias contains, include
     * @category Collection
     * @param {Array|Object|string} collection The collection to search.
     * @param {*} target The value to search for.
     * @param {number} [fromIndex=0] The index to search from.
     * @returns {boolean} Returns `true` if a matching element is found, else `false`.
     * @example
     *
     * _.includes([1, 2, 3], 1);
     * // => true
     *
     * _.includes([1, 2, 3], 1, 2);
     * // => false
     *
     * _.includes({ 'user': 'fred', 'age': 40 }, 'fred');
     * // => true
     *
     * _.includes('pebbles', 'eb');
     * // => true
     */
    function includes(collection, target, fromIndex) {
      var length = collection ? collection.length : 0;
      if (!isLength(length)) {
        collection = values(collection);
        length = collection.length;
      }
      if (!length) {
        return false;
      }
      if (typeof fromIndex == 'number') {
        fromIndex = fromIndex < 0 ? nativeMax(length + fromIndex, 0) : (fromIndex || 0);
      } else {
        fromIndex = 0;
      }
      return (typeof collection == 'string' || !isArray(collection) && isString(collection))
        ? (fromIndex < length && collection.indexOf(target, fromIndex) > -1)
        : (getIndexOf(collection, target, fromIndex) > -1);
    }

    /**
     * Creates an object composed of keys generated from the results of running
     * each element of `collection` through `iteratee`. The corresponding value
     * of each key is the last element responsible for generating the key. The
     * iteratee function is bound to `thisArg` and invoked with three arguments;
     * (value, index|key, collection).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [iteratee=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Object} Returns the composed aggregate object.
     * @example
     *
     * var keyData = [
     *   { 'dir': 'left', 'code': 97 },
     *   { 'dir': 'right', 'code': 100 }
     * ];
     *
     * _.indexBy(keyData, 'dir');
     * // => { 'left': { 'dir': 'left', 'code': 97 }, 'right': { 'dir': 'right', 'code': 100 } }
     *
     * _.indexBy(keyData, function(object) {
     *   return String.fromCharCode(object.code);
     * });
     * // => { 'a': { 'dir': 'left', 'code': 97 }, 'd': { 'dir': 'right', 'code': 100 } }
     *
     * _.indexBy(keyData, function(object) {
     *   return this.fromCharCode(object.code);
     * }, String);
     * // => { 'a': { 'dir': 'left', 'code': 97 }, 'd': { 'dir': 'right', 'code': 100 } }
     */
    var indexBy = createAggregator(function(result, value, key) {
      result[key] = value;
    });

    /**
     * Invokes the method named by `methodName` on each element in `collection`,
     * returning an array of the results of each invoked method. Any additional
     * arguments are provided to each invoked method. If `methodName` is a function
     * it is invoked for, and `this` bound to, each element in `collection`.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|string} methodName The name of the method to invoke or
     *  the function invoked per iteration.
     * @param {...*} [args] The arguments to invoke the method with.
     * @returns {Array} Returns the array of results.
     * @example
     *
     * _.invoke([[5, 1, 7], [3, 2, 1]], 'sort');
     * // => [[1, 5, 7], [1, 2, 3]]
     *
     * _.invoke([123, 456], String.prototype.split, '');
     * // => [['1', '2', '3'], ['4', '5', '6']]
     */
    function invoke(collection, methodName) {
      return baseInvoke(collection, methodName, baseSlice(arguments, 2));
    }

    /**
     * Creates an array of values by running each element in `collection` through
     * `iteratee`. The `iteratee` is bound to `thisArg` and invoked with three
     * arguments; (value, index|key, collection).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * Many lodash methods are guarded to work as interatees for methods like
     * `_.every`, `_.filter`, `_.map`, `_.mapValues`, `_.reject`, and `_.some`.
     *
     * The guarded methods are:
     * `ary`, `callback`, `chunk`, `clone`, `create`, `curry`, `curryRight`, `drop`,
     * `dropRight`, `fill`, `flatten`, `invert`, `max`, `min`, `parseInt`, `slice`,
     * `sortBy`, `take`, `takeRight`, `template`, `trim`, `trimLeft`, `trimRight`,
     * `trunc`, `random`, `range`, `sample`, `uniq`, and `words`
     *
     * @static
     * @memberOf _
     * @alias collect
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [iteratee=_.identity] The function invoked
     *  per iteration.
     *  create a `_.property` or `_.matches` style callback respectively.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Array} Returns the new mapped array.
     * @example
     *
     * function timesThree(n) {
     *   return n * 3;
     * }
     *
     * _.map([1, 2], timesThree);
     * // => [3, 6]
     *
     * _.map({ 'a': 1, 'b': 2 }, timesThree);
     * // => [3, 6] (iteration order is not guaranteed)
     *
     * var users = [
     *   { 'user': 'barney' },
     *   { 'user': 'fred' }
     * ];
     *
     * // using the `_.property` callback shorthand
     * _.map(users, 'user');
     * // => ['barney', 'fred']
     */
    function map(collection, iteratee, thisArg) {
      var func = isArray(collection) ? arrayMap : baseMap;
      iteratee = getCallback(iteratee, thisArg, 3);
      return func(collection, iteratee);
    }

    /**
     * Creates an array of elements split into two groups, the first of which
     * contains elements `predicate` returns truthy for, while the second of which
     * contains elements `predicate` returns falsey for. The predicate is bound
     * to `thisArg` and invoked with three arguments; (value, index|key, collection).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {Array} Returns the array of grouped elements.
     * @example
     *
     * _.partition([1, 2, 3], function(n) {
     *   return n % 2;
     * });
     * // => [[1, 3], [2]]
     *
     * _.partition([1.2, 2.3, 3.4], function(n) {
     *   return this.floor(n) % 2;
     * }, Math);
     * // => [[1.2, 3.4], [2.3]]
     *
     * var users = [
     *   { 'user': 'barney',  'age': 36, 'active': false },
     *   { 'user': 'fred',    'age': 40, 'active': true },
     *   { 'user': 'pebbles', 'age': 1,  'active': false }
     * ];
     *
     * var mapper = function(array) {
     *   return _.pluck(array, 'user');
     * };
     *
     * // using the `_.matches` callback shorthand
     * _.map(_.partition(users, { 'age': 1, 'active': false }), mapper);
     * // => [['pebbles'], ['barney', 'fred']]
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.map(_.partition(users, 'active', false), mapper);
     * // => [['barney', 'pebbles'], ['fred']]
     *
     * // using the `_.property` callback shorthand
     * _.map(_.partition(users, 'active'), mapper);
     * // => [['fred'], ['barney', 'pebbles']]
     */
    var partition = createAggregator(function(result, value, key) {
      result[key ? 0 : 1].push(value);
    }, function() { return [[], []]; });

    /**
     * Gets the value of `key` from all elements in `collection`.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {string} key The key of the property to pluck.
     * @returns {Array} Returns the property values.
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36 },
     *   { 'user': 'fred',   'age': 40 }
     * ];
     *
     * _.pluck(users, 'user');
     * // => ['barney', 'fred']
     *
     * var userIndex = _.indexBy(users, 'user');
     * _.pluck(userIndex, 'age');
     * // => [36, 40] (iteration order is not guaranteed)
     */
    function pluck(collection, key) {
      return map(collection, baseProperty(key));
    }

    /**
     * Reduces `collection` to a value which is the accumulated result of running
     * each element in `collection` through `iteratee`, where each successive
     * invocation is supplied the return value of the previous. If `accumulator`
     * is not provided the first element of `collection` is used as the initial
     * value. The `iteratee` is bound to `thisArg`and invoked with four arguments;
     * (accumulator, value, index|key, collection).
     *
     * Many lodash methods are guarded to work as interatees for methods like
     * `_.reduce`, `_.reduceRight`, and `_.transform`.
     *
     * The guarded methods are:
     * `assign`, `defaults`, `merge`, and `sortAllBy`
     *
     * @static
     * @memberOf _
     * @alias foldl, inject
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [accumulator] The initial value.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {*} Returns the accumulated value.
     * @example
     *
     * _.reduce([1, 2], function(sum, n) {
     *   return sum + n;
     * });
     * // => 3
     *
     * _.reduce({ 'a': 1, 'b': 2 }, function(result, n, key) {
     *   result[key] = n * 3;
     *   return result;
     * }, {});
     * // => { 'a': 3, 'b': 6 } (iteration order is not guaranteed)
     */
    function reduce(collection, iteratee, accumulator, thisArg) {
      var func = isArray(collection) ? arrayReduce : baseReduce;
      return func(collection, getCallback(iteratee, thisArg, 4), accumulator, arguments.length < 3, baseEach);
    }

    /**
     * This method is like `_.reduce` except that it iterates over elements of
     * `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @alias foldr
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [accumulator] The initial value.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {*} Returns the accumulated value.
     * @example
     *
     * var array = [[0, 1], [2, 3], [4, 5]];
     *
     * _.reduceRight(array, function(flattened, other) {
     *   return flattened.concat(other);
     * }, []);
     * // => [4, 5, 2, 3, 0, 1]
     */
    function reduceRight(collection, iteratee, accumulator, thisArg) {
      var func = isArray(collection) ? arrayReduceRight : baseReduce;
      return func(collection, getCallback(iteratee, thisArg, 4), accumulator, arguments.length < 3, baseEachRight);
    }

    /**
     * The opposite of `_.filter`; this method returns the elements of `collection`
     * that `predicate` does **not** return truthy for.
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {Array} Returns the new filtered array.
     * @example
     *
     * _.reject([1, 2, 3, 4], function(n) {
     *   return n % 2 == 0;
     * });
     * // => [1, 3]
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36, 'active': false },
     *   { 'user': 'fred',   'age': 40, 'active': true }
     * ];
     *
     * // using the `_.matches` callback shorthand
     * _.pluck(_.reject(users, { 'age': 40, 'active': true }), 'user');
     * // => ['barney']
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.pluck(_.reject(users, 'active', false), 'user');
     * // => ['fred']
     *
     * // using the `_.property` callback shorthand
     * _.pluck(_.reject(users, 'active'), 'user');
     * // => ['barney']
     */
    function reject(collection, predicate, thisArg) {
      var func = isArray(collection) ? arrayFilter : baseFilter;
      predicate = getCallback(predicate, thisArg, 3);
      return func(collection, function(value, index, collection) {
        return !predicate(value, index, collection);
      });
    }

    /**
     * Gets a random element or `n` random elements from a collection.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to sample.
     * @param {number} [n] The number of elements to sample.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {*} Returns the random sample(s).
     * @example
     *
     * _.sample([1, 2, 3, 4]);
     * // => 2
     *
     * _.sample([1, 2, 3, 4], 2);
     * // => [3, 1]
     */
    function sample(collection, n, guard) {
      if (guard ? isIterateeCall(collection, n, guard) : n == null) {
        collection = toIterable(collection);
        var length = collection.length;
        return length > 0 ? collection[baseRandom(0, length - 1)] : undefined;
      }
      var result = shuffle(collection);
      result.length = nativeMin(n < 0 ? 0 : (+n || 0), result.length);
      return result;
    }

    /**
     * Creates an array of shuffled values, using a version of the Fisher-Yates
     * shuffle. See [Wikipedia](https://en.wikipedia.org/wiki/Fisher-Yates_shuffle)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to shuffle.
     * @returns {Array} Returns the new shuffled array.
     * @example
     *
     * _.shuffle([1, 2, 3, 4]);
     * // => [4, 1, 3, 2]
     */
    function shuffle(collection) {
      collection = toIterable(collection);

      var index = -1,
          length = collection.length,
          result = Array(length);

      while (++index < length) {
        var rand = baseRandom(0, index);
        if (index != rand) {
          result[index] = result[rand];
        }
        result[rand] = collection[index];
      }
      return result;
    }

    /**
     * Gets the size of `collection` by returning `collection.length` for
     * array-like values or the number of own enumerable properties for objects.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to inspect.
     * @returns {number} Returns the size of `collection`.
     * @example
     *
     * _.size([1, 2, 3]);
     * // => 3
     *
     * _.size({ 'a': 1, 'b': 2 });
     * // => 2
     *
     * _.size('pebbles');
     * // => 7
     */
    function size(collection) {
      var length = collection ? collection.length : 0;
      return isLength(length) ? length : keys(collection).length;
    }

    /**
     * Checks if `predicate` returns truthy for **any** element of `collection`.
     * The function returns as soon as it finds a passing value and does not iterate
     * over the entire collection. The predicate is bound to `thisArg` and invoked
     * with three arguments; (value, index|key, collection).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @alias any
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {boolean} Returns `true` if any element passes the predicate check,
     *  else `false`.
     * @example
     *
     * _.some([null, 0, 'yes', false], Boolean);
     * // => true
     *
     * var users = [
     *   { 'user': 'barney', 'active': true },
     *   { 'user': 'fred',   'active': false }
     * ];
     *
     * // using the `_.matches` callback shorthand
     * _.some(users, { 'user': 'barney', 'active': false });
     * // => false
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.some(users, 'active', false);
     * // => true
     *
     * // using the `_.property` callback shorthand
     * _.some(users, 'active');
     * // => true
     */
    function some(collection, predicate, thisArg) {
      var func = isArray(collection) ? arraySome : baseSome;
      if (typeof predicate != 'function' || typeof thisArg != 'undefined') {
        predicate = getCallback(predicate, thisArg, 3);
      }
      return func(collection, predicate);
    }

    /**
     * Creates an array of elements, sorted in ascending order by the results of
     * running each element in a collection through `iteratee`. This method performs
     * a stable sort, that is, it preserves the original sort order of equal elements.
     * The `iteratee` is bound to `thisArg` and invoked with three arguments;
     * (value, index|key, collection).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Array|Function|Object|string} [iteratee=_.identity] The function
     *  invoked per iteration. If a property name or an object is provided it is
     *  used to create a `_.property` or `_.matches` style callback respectively.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Array} Returns the new sorted array.
     * @example
     *
     * _.sortBy([1, 2, 3], function(n) {
     *   return Math.sin(n);
     * });
     * // => [3, 1, 2]
     *
     * _.sortBy([1, 2, 3], function(n) {
     *   return this.sin(n);
     * }, Math);
     * // => [3, 1, 2]
     *
     * var users = [
     *   { 'user': 'fred' },
     *   { 'user': 'pebbles' },
     *   { 'user': 'barney' }
     * ];
     *
     * // using the `_.property` callback shorthand
     * _.pluck(_.sortBy(users, 'user'), 'user');
     * // => ['barney', 'fred', 'pebbles']
     */
    function sortBy(collection, iteratee, thisArg) {
      if (collection == null) {
        return [];
      }
      var index = -1,
          length = collection.length,
          result = isLength(length) ? Array(length) : [];

      if (thisArg && isIterateeCall(collection, iteratee, thisArg)) {
        iteratee = null;
      }
      iteratee = getCallback(iteratee, thisArg, 3);
      baseEach(collection, function(value, key, collection) {
        result[++index] = { 'criteria': iteratee(value, key, collection), 'index': index, 'value': value };
      });
      return baseSortBy(result, compareAscending);
    }

    /**
     * This method is like `_.sortBy` except that it sorts by property names
     * instead of an iteratee function.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {...(string|string[])} props The property names to sort by,
     *  specified as individual property names or arrays of property names.
     * @returns {Array} Returns the new sorted array.
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36 },
     *   { 'user': 'fred',   'age': 40 },
     *   { 'user': 'barney', 'age': 26 },
     *   { 'user': 'fred',   'age': 30 }
     * ];
     *
     * _.map(_.sortByAll(users, ['user', 'age']), _.values);
     * // => [['barney', 26], ['barney', 36], ['fred', 30], ['fred', 40]]
     */
    function sortByAll(collection) {
      if (collection == null) {
        return [];
      }
      var args = arguments,
          guard = args[3];

      if (guard && isIterateeCall(args[1], args[2], guard)) {
        args = [collection, args[1]];
      }
      return baseSortByOrder(collection, baseFlatten(args, false, false, 1), []);
    }

    /**
     * This method is like `_.sortByAll` except that it allows specifying the
     * sort orders of the property names to sort by. A truthy value in `orders`
     * will sort the corresponding property name in ascending order while a
     * falsey value will sort it in descending order.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {string[]} props The property names to sort by.
     * @param {boolean[]} orders The sort orders of `props`.
     * @returns {Array} Returns the new sorted array.
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36 },
     *   { 'user': 'fred',   'age': 40 },
     *   { 'user': 'barney', 'age': 26 },
     *   { 'user': 'fred',   'age': 30 }
     * ];
     *
     * // sort by `user` in ascending order and by `age` in descending order
     * _.map(_.sortByOrder(users, ['user', 'age'], [true, false]), _.values);
     * // => [['barney', 36], ['barney', 26], ['fred', 40], ['fred', 30]]
     */
    function sortByOrder(collection, props, orders, guard) {
      if (collection == null) {
        return [];
      }
      if (guard && isIterateeCall(props, orders, guard)) {
        orders = null;
      }
      if (!isArray(props)) {
        props = props == null ? [] : [props];
      }
      if (!isArray(orders)) {
        orders = orders == null ? [] : [orders];
      }
      return baseSortByOrder(collection, props, orders);
    }

    /**
     * Performs a deep comparison between each element in `collection` and the
     * source object, returning an array of all elements that have equivalent
     * property values.
     *
     * **Note:** This method supports comparing arrays, booleans, `Date` objects,
     * numbers, `Object` objects, regexes, and strings. Objects are compared by
     * their own, not inherited, enumerable properties. For comparing a single
     * own or inherited property value see `_.matchesProperty`.
     *
     * @static
     * @memberOf _
     * @category Collection
     * @param {Array|Object|string} collection The collection to search.
     * @param {Object} source The object of property values to match.
     * @returns {Array} Returns the new filtered array.
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36, 'active': false, 'pets': ['hoppy'] },
     *   { 'user': 'fred',   'age': 40, 'active': true, 'pets': ['baby puss', 'dino'] }
     * ];
     *
     * _.pluck(_.where(users, { 'age': 36, 'active': false }), 'user');
     * // => ['barney']
     *
     * _.pluck(_.where(users, { 'pets': ['dino'] }), 'user');
     * // => ['fred']
     */
    function where(collection, source) {
      return filter(collection, baseMatches(source));
    }

    /*------------------------------------------------------------------------*/

    /**
     * Gets the number of milliseconds that have elapsed since the Unix epoch
     * (1 January 1970 00:00:00 UTC).
     *
     * @static
     * @memberOf _
     * @category Date
     * @example
     *
     * _.defer(function(stamp) {
     *   console.log(_.now() - stamp);
     * }, _.now());
     * // => logs the number of milliseconds it took for the deferred function to be invoked
     */
    var now = nativeNow || function() {
      return new Date().getTime();
    };

    /*------------------------------------------------------------------------*/

    /**
     * The opposite of `_.before`; this method creates a function that invokes
     * `func` once it is called `n` or more times.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {number} n The number of calls before `func` is invoked.
     * @param {Function} func The function to restrict.
     * @returns {Function} Returns the new restricted function.
     * @example
     *
     * var saves = ['profile', 'settings'];
     *
     * var done = _.after(saves.length, function() {
     *   console.log('done saving!');
     * });
     *
     * _.forEach(saves, function(type) {
     *   asyncSave({ 'type': type, 'complete': done });
     * });
     * // => logs 'done saving!' after the two async saves have completed
     */
    function after(n, func) {
      if (typeof func != 'function') {
        if (typeof n == 'function') {
          var temp = n;
          n = func;
          func = temp;
        } else {
          throw new TypeError(FUNC_ERROR_TEXT);
        }
      }
      n = nativeIsFinite(n = +n) ? n : 0;
      return function() {
        if (--n < 1) {
          return func.apply(this, arguments);
        }
      };
    }

    /**
     * Creates a function that accepts up to `n` arguments ignoring any
     * additional arguments.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to cap arguments for.
     * @param {number} [n=func.length] The arity cap.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {Function} Returns the new function.
     * @example
     *
     * _.map(['6', '8', '10'], _.ary(parseInt, 1));
     * // => [6, 8, 10]
     */
    function ary(func, n, guard) {
      if (guard && isIterateeCall(func, n, guard)) {
        n = null;
      }
      n = (func && n == null) ? func.length : nativeMax(+n || 0, 0);
      return createWrapper(func, ARY_FLAG, null, null, null, null, n);
    }

    /**
     * Creates a function that invokes `func`, with the `this` binding and arguments
     * of the created function, while it is called less than `n` times. Subsequent
     * calls to the created function return the result of the last `func` invocation.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {number} n The number of calls at which `func` is no longer invoked.
     * @param {Function} func The function to restrict.
     * @returns {Function} Returns the new restricted function.
     * @example
     *
     * jQuery('#add').on('click', _.before(5, addContactToList));
     * // => allows adding up to 4 contacts to the list
     */
    function before(n, func) {
      var result;
      if (typeof func != 'function') {
        if (typeof n == 'function') {
          var temp = n;
          n = func;
          func = temp;
        } else {
          throw new TypeError(FUNC_ERROR_TEXT);
        }
      }
      return function() {
        if (--n > 0) {
          result = func.apply(this, arguments);
        } else {
          func = null;
        }
        return result;
      };
    }

    /**
     * Creates a function that invokes `func` with the `this` binding of `thisArg`
     * and prepends any additional `_.bind` arguments to those provided to the
     * bound function.
     *
     * The `_.bind.placeholder` value, which defaults to `_` in monolithic builds,
     * may be used as a placeholder for partially applied arguments.
     *
     * **Note:** Unlike native `Function#bind` this method does not set the `length`
     * property of bound functions.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to bind.
     * @param {*} thisArg The `this` binding of `func`.
     * @param {...*} [args] The arguments to be partially applied.
     * @returns {Function} Returns the new bound function.
     * @example
     *
     * var greet = function(greeting, punctuation) {
     *   return greeting + ' ' + this.user + punctuation;
     * };
     *
     * var object = { 'user': 'fred' };
     *
     * var bound = _.bind(greet, object, 'hi');
     * bound('!');
     * // => 'hi fred!'
     *
     * // using placeholders
     * var bound = _.bind(greet, object, _, '!');
     * bound('hi');
     * // => 'hi fred!'
     */
    function bind(func, thisArg) {
      var bitmask = BIND_FLAG;
      if (arguments.length > 2) {
        var partials = baseSlice(arguments, 2),
            holders = replaceHolders(partials, bind.placeholder);

        bitmask |= PARTIAL_FLAG;
      }
      return createWrapper(func, bitmask, thisArg, partials, holders);
    }

    /**
     * Binds methods of an object to the object itself, overwriting the existing
     * method. Method names may be specified as individual arguments or as arrays
     * of method names. If no method names are provided all enumerable function
     * properties, own and inherited, of `object` are bound.
     *
     * **Note:** This method does not set the `length` property of bound functions.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Object} object The object to bind and assign the bound methods to.
     * @param {...(string|string[])} [methodNames] The object method names to bind,
     *  specified as individual method names or arrays of method names.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var view = {
     *   'label': 'docs',
     *   'onClick': function() {
     *     console.log('clicked ' + this.label);
     *   }
     * };
     *
     * _.bindAll(view);
     * jQuery('#docs').on('click', view.onClick);
     * // => logs 'clicked docs' when the element is clicked
     */
    function bindAll(object) {
      return baseBindAll(object,
        arguments.length > 1
          ? baseFlatten(arguments, false, false, 1)
          : functions(object)
      );
    }

    /**
     * Creates a function that invokes the method at `object[key]` and prepends
     * any additional `_.bindKey` arguments to those provided to the bound function.
     *
     * This method differs from `_.bind` by allowing bound functions to reference
     * methods that may be redefined or don't yet exist.
     * See [Peter Michaux's article](http://michaux.ca/articles/lazy-function-definition-pattern)
     * for more details.
     *
     * The `_.bindKey.placeholder` value, which defaults to `_` in monolithic
     * builds, may be used as a placeholder for partially applied arguments.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Object} object The object the method belongs to.
     * @param {string} key The key of the method.
     * @param {...*} [args] The arguments to be partially applied.
     * @returns {Function} Returns the new bound function.
     * @example
     *
     * var object = {
     *   'user': 'fred',
     *   'greet': function(greeting, punctuation) {
     *     return greeting + ' ' + this.user + punctuation;
     *   }
     * };
     *
     * var bound = _.bindKey(object, 'greet', 'hi');
     * bound('!');
     * // => 'hi fred!'
     *
     * object.greet = function(greeting, punctuation) {
     *   return greeting + 'ya ' + this.user + punctuation;
     * };
     *
     * bound('!');
     * // => 'hiya fred!'
     *
     * // using placeholders
     * var bound = _.bindKey(object, 'greet', _, '!');
     * bound('hi');
     * // => 'hiya fred!'
     */
    function bindKey(object, key) {
      var bitmask = BIND_FLAG | BIND_KEY_FLAG;
      if (arguments.length > 2) {
        var partials = baseSlice(arguments, 2),
            holders = replaceHolders(partials, bindKey.placeholder);

        bitmask |= PARTIAL_FLAG;
      }
      return createWrapper(key, bitmask, object, partials, holders);
    }

    /**
     * Creates a function that accepts one or more arguments of `func` that when
     * called either invokes `func` returning its result, if all `func` arguments
     * have been provided, or returns a function that accepts one or more of the
     * remaining `func` arguments, and so on. The arity of `func` may be specified
     * if `func.length` is not sufficient.
     *
     * The `_.curry.placeholder` value, which defaults to `_` in monolithic builds,
     * may be used as a placeholder for provided arguments.
     *
     * **Note:** This method does not set the `length` property of curried functions.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to curry.
     * @param {number} [arity=func.length] The arity of `func`.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {Function} Returns the new curried function.
     * @example
     *
     * var abc = function(a, b, c) {
     *   return [a, b, c];
     * };
     *
     * var curried = _.curry(abc);
     *
     * curried(1)(2)(3);
     * // => [1, 2, 3]
     *
     * curried(1, 2)(3);
     * // => [1, 2, 3]
     *
     * curried(1, 2, 3);
     * // => [1, 2, 3]
     *
     * // using placeholders
     * curried(1)(_, 3)(2);
     * // => [1, 2, 3]
     */
    function curry(func, arity, guard) {
      if (guard && isIterateeCall(func, arity, guard)) {
        arity = null;
      }
      var result = createWrapper(func, CURRY_FLAG, null, null, null, null, null, arity);
      result.placeholder = curry.placeholder;
      return result;
    }

    /**
     * This method is like `_.curry` except that arguments are applied to `func`
     * in the manner of `_.partialRight` instead of `_.partial`.
     *
     * The `_.curryRight.placeholder` value, which defaults to `_` in monolithic
     * builds, may be used as a placeholder for provided arguments.
     *
     * **Note:** This method does not set the `length` property of curried functions.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to curry.
     * @param {number} [arity=func.length] The arity of `func`.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {Function} Returns the new curried function.
     * @example
     *
     * var abc = function(a, b, c) {
     *   return [a, b, c];
     * };
     *
     * var curried = _.curryRight(abc);
     *
     * curried(3)(2)(1);
     * // => [1, 2, 3]
     *
     * curried(2, 3)(1);
     * // => [1, 2, 3]
     *
     * curried(1, 2, 3);
     * // => [1, 2, 3]
     *
     * // using placeholders
     * curried(3)(1, _)(2);
     * // => [1, 2, 3]
     */
    function curryRight(func, arity, guard) {
      if (guard && isIterateeCall(func, arity, guard)) {
        arity = null;
      }
      var result = createWrapper(func, CURRY_RIGHT_FLAG, null, null, null, null, null, arity);
      result.placeholder = curryRight.placeholder;
      return result;
    }

    /**
     * Creates a function that delays invoking `func` until after `wait` milliseconds
     * have elapsed since the last time it was invoked. The created function comes
     * with a `cancel` method to cancel delayed invocations. Provide an options
     * object to indicate that `func` should be invoked on the leading and/or
     * trailing edge of the `wait` timeout. Subsequent calls to the debounced
     * function return the result of the last `func` invocation.
     *
     * **Note:** If `leading` and `trailing` options are `true`, `func` is invoked
     * on the trailing edge of the timeout only if the the debounced function is
     * invoked more than once during the `wait` timeout.
     *
     * See [David Corbacho's article](http://drupalmotion.com/article/debounce-and-throttle-visual-explanation)
     * for details over the differences between `_.debounce` and `_.throttle`.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to debounce.
     * @param {number} [wait=0] The number of milliseconds to delay.
     * @param {Object} [options] The options object.
     * @param {boolean} [options.leading=false] Specify invoking on the leading
     *  edge of the timeout.
     * @param {number} [options.maxWait] The maximum time `func` is allowed to be
     *  delayed before it is invoked.
     * @param {boolean} [options.trailing=true] Specify invoking on the trailing
     *  edge of the timeout.
     * @returns {Function} Returns the new debounced function.
     * @example
     *
     * // avoid costly calculations while the window size is in flux
     * jQuery(window).on('resize', _.debounce(calculateLayout, 150));
     *
     * // invoke `sendMail` when the click event is fired, debouncing subsequent calls
     * jQuery('#postbox').on('click', _.debounce(sendMail, 300, {
     *   'leading': true,
     *   'trailing': false
     * }));
     *
     * // ensure `batchLog` is invoked once after 1 second of debounced calls
     * var source = new EventSource('/stream');
     * jQuery(source).on('message', _.debounce(batchLog, 250, {
     *   'maxWait': 1000
     * }));
     *
     * // cancel a debounced call
     * var todoChanges = _.debounce(batchLog, 1000);
     * Object.observe(models.todo, todoChanges);
     *
     * Object.observe(models, function(changes) {
     *   if (_.find(changes, { 'user': 'todo', 'type': 'delete'})) {
     *     todoChanges.cancel();
     *   }
     * }, ['delete']);
     *
     * // ...at some point `models.todo` is changed
     * models.todo.completed = true;
     *
     * // ...before 1 second has passed `models.todo` is deleted
     * // which cancels the debounced `todoChanges` call
     * delete models.todo;
     */
    function debounce(func, wait, options) {
      var args,
          maxTimeoutId,
          result,
          stamp,
          thisArg,
          timeoutId,
          trailingCall,
          lastCalled = 0,
          maxWait = false,
          trailing = true;

      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      wait = wait < 0 ? 0 : (+wait || 0);
      if (options === true) {
        var leading = true;
        trailing = false;
      } else if (isObject(options)) {
        leading = options.leading;
        maxWait = 'maxWait' in options && nativeMax(+options.maxWait || 0, wait);
        trailing = 'trailing' in options ? options.trailing : trailing;
      }

      function cancel() {
        if (timeoutId) {
          clearTimeout(timeoutId);
        }
        if (maxTimeoutId) {
          clearTimeout(maxTimeoutId);
        }
        maxTimeoutId = timeoutId = trailingCall = undefined;
      }

      function delayed() {
        var remaining = wait - (now() - stamp);
        if (remaining <= 0 || remaining > wait) {
          if (maxTimeoutId) {
            clearTimeout(maxTimeoutId);
          }
          var isCalled = trailingCall;
          maxTimeoutId = timeoutId = trailingCall = undefined;
          if (isCalled) {
            lastCalled = now();
            result = func.apply(thisArg, args);
            if (!timeoutId && !maxTimeoutId) {
              args = thisArg = null;
            }
          }
        } else {
          timeoutId = setTimeout(delayed, remaining);
        }
      }

      function maxDelayed() {
        if (timeoutId) {
          clearTimeout(timeoutId);
        }
        maxTimeoutId = timeoutId = trailingCall = undefined;
        if (trailing || (maxWait !== wait)) {
          lastCalled = now();
          result = func.apply(thisArg, args);
          if (!timeoutId && !maxTimeoutId) {
            args = thisArg = null;
          }
        }
      }

      function debounced() {
        args = arguments;
        stamp = now();
        thisArg = this;
        trailingCall = trailing && (timeoutId || !leading);

        if (maxWait === false) {
          var leadingCall = leading && !timeoutId;
        } else {
          if (!maxTimeoutId && !leading) {
            lastCalled = stamp;
          }
          var remaining = maxWait - (stamp - lastCalled),
              isCalled = remaining <= 0 || remaining > maxWait;

          if (isCalled) {
            if (maxTimeoutId) {
              maxTimeoutId = clearTimeout(maxTimeoutId);
            }
            lastCalled = stamp;
            result = func.apply(thisArg, args);
          }
          else if (!maxTimeoutId) {
            maxTimeoutId = setTimeout(maxDelayed, remaining);
          }
        }
        if (isCalled && timeoutId) {
          timeoutId = clearTimeout(timeoutId);
        }
        else if (!timeoutId && wait !== maxWait) {
          timeoutId = setTimeout(delayed, wait);
        }
        if (leadingCall) {
          isCalled = true;
          result = func.apply(thisArg, args);
        }
        if (isCalled && !timeoutId && !maxTimeoutId) {
          args = thisArg = null;
        }
        return result;
      }
      debounced.cancel = cancel;
      return debounced;
    }

    /**
     * Defers invoking the `func` until the current call stack has cleared. Any
     * additional arguments are provided to `func` when it is invoked.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to defer.
     * @param {...*} [args] The arguments to invoke the function with.
     * @returns {number} Returns the timer id.
     * @example
     *
     * _.defer(function(text) {
     *   console.log(text);
     * }, 'deferred');
     * // logs 'deferred' after one or more milliseconds
     */
    function defer(func) {
      return baseDelay(func, 1, arguments, 1);
    }

    /**
     * Invokes `func` after `wait` milliseconds. Any additional arguments are
     * provided to `func` when it is invoked.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to delay.
     * @param {number} wait The number of milliseconds to delay invocation.
     * @param {...*} [args] The arguments to invoke the function with.
     * @returns {number} Returns the timer id.
     * @example
     *
     * _.delay(function(text) {
     *   console.log(text);
     * }, 1000, 'later');
     * // => logs 'later' after one second
     */
    function delay(func, wait) {
      return baseDelay(func, wait, arguments, 2);
    }

    /**
     * Creates a function that returns the result of invoking the provided
     * functions with the `this` binding of the created function, where each
     * successive invocation is supplied the return value of the previous.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {...Function} [funcs] Functions to invoke.
     * @returns {Function} Returns the new function.
     * @example
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * var addSquare = _.flow(_.add, square);
     * addSquare(1, 2);
     * // => 9
     */
    var flow = createComposer();

    /**
     * This method is like `_.flow` except that it creates a function that
     * invokes the provided functions from right to left.
     *
     * @static
     * @memberOf _
     * @alias backflow, compose
     * @category Function
     * @param {...Function} [funcs] Functions to invoke.
     * @returns {Function} Returns the new function.
     * @example
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * var addSquare = _.flowRight(square, _.add);
     * addSquare(1, 2);
     * // => 9
     */
    var flowRight = createComposer(true);

    /**
     * Creates a function that memoizes the result of `func`. If `resolver` is
     * provided it determines the cache key for storing the result based on the
     * arguments provided to the memoized function. By default, the first argument
     * provided to the memoized function is coerced to a string and used as the
     * cache key. The `func` is invoked with the `this` binding of the memoized
     * function.
     *
     * **Note:** The cache is exposed as the `cache` property on the memoized
     * function. Its creation may be customized by replacing the `_.memoize.Cache`
     * constructor with one whose instances implement the ES `Map` method interface
     * of `get`, `has`, and `set`. See the
     * [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-properties-of-the-map-prototype-object)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to have its output memoized.
     * @param {Function} [resolver] The function to resolve the cache key.
     * @returns {Function} Returns the new memoizing function.
     * @example
     *
     * var upperCase = _.memoize(function(string) {
     *   return string.toUpperCase();
     * });
     *
     * upperCase('fred');
     * // => 'FRED'
     *
     * // modifying the result cache
     * upperCase.cache.set('fred', 'BARNEY');
     * upperCase('fred');
     * // => 'BARNEY'
     *
     * // replacing `_.memoize.Cache`
     * var object = { 'user': 'fred' };
     * var other = { 'user': 'barney' };
     * var identity = _.memoize(_.identity);
     *
     * identity(object);
     * // => { 'user': 'fred' }
     * identity(other);
     * // => { 'user': 'fred' }
     *
     * _.memoize.Cache = WeakMap;
     * var identity = _.memoize(_.identity);
     *
     * identity(object);
     * // => { 'user': 'fred' }
     * identity(other);
     * // => { 'user': 'barney' }
     */
    function memoize(func, resolver) {
      if (typeof func != 'function' || (resolver && typeof resolver != 'function')) {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      var memoized = function() {
        var args = arguments,
            cache = memoized.cache,
            key = resolver ? resolver.apply(this, args) : args[0];

        if (cache.has(key)) {
          return cache.get(key);
        }
        var result = func.apply(this, args);
        cache.set(key, result);
        return result;
      };
      memoized.cache = new memoize.Cache;
      return memoized;
    }

    /**
     * Creates a function that negates the result of the predicate `func`. The
     * `func` predicate is invoked with the `this` binding and arguments of the
     * created function.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} predicate The predicate to negate.
     * @returns {Function} Returns the new function.
     * @example
     *
     * function isEven(n) {
     *   return n % 2 == 0;
     * }
     *
     * _.filter([1, 2, 3, 4, 5, 6], _.negate(isEven));
     * // => [1, 3, 5]
     */
    function negate(predicate) {
      if (typeof predicate != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      return function() {
        return !predicate.apply(this, arguments);
      };
    }

    /**
     * Creates a function that is restricted to invoking `func` once. Repeat calls
     * to the function return the value of the first call. The `func` is invoked
     * with the `this` binding of the created function.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to restrict.
     * @returns {Function} Returns the new restricted function.
     * @example
     *
     * var initialize = _.once(createApplication);
     * initialize();
     * initialize();
     * // `initialize` invokes `createApplication` once
     */
    function once(func) {
      return before(func, 2);
    }

    /**
     * Creates a function that invokes `func` with `partial` arguments prepended
     * to those provided to the new function. This method is like `_.bind` except
     * it does **not** alter the `this` binding.
     *
     * The `_.partial.placeholder` value, which defaults to `_` in monolithic
     * builds, may be used as a placeholder for partially applied arguments.
     *
     * **Note:** This method does not set the `length` property of partially
     * applied functions.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to partially apply arguments to.
     * @param {...*} [args] The arguments to be partially applied.
     * @returns {Function} Returns the new partially applied function.
     * @example
     *
     * var greet = function(greeting, name) {
     *   return greeting + ' ' + name;
     * };
     *
     * var sayHelloTo = _.partial(greet, 'hello');
     * sayHelloTo('fred');
     * // => 'hello fred'
     *
     * // using placeholders
     * var greetFred = _.partial(greet, _, 'fred');
     * greetFred('hi');
     * // => 'hi fred'
     */
    function partial(func) {
      var partials = baseSlice(arguments, 1),
          holders = replaceHolders(partials, partial.placeholder);

      return createWrapper(func, PARTIAL_FLAG, null, partials, holders);
    }

    /**
     * This method is like `_.partial` except that partially applied arguments
     * are appended to those provided to the new function.
     *
     * The `_.partialRight.placeholder` value, which defaults to `_` in monolithic
     * builds, may be used as a placeholder for partially applied arguments.
     *
     * **Note:** This method does not set the `length` property of partially
     * applied functions.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to partially apply arguments to.
     * @param {...*} [args] The arguments to be partially applied.
     * @returns {Function} Returns the new partially applied function.
     * @example
     *
     * var greet = function(greeting, name) {
     *   return greeting + ' ' + name;
     * };
     *
     * var greetFred = _.partialRight(greet, 'fred');
     * greetFred('hi');
     * // => 'hi fred'
     *
     * // using placeholders
     * var sayHelloTo = _.partialRight(greet, 'hello', _);
     * sayHelloTo('fred');
     * // => 'hello fred'
     */
    function partialRight(func) {
      var partials = baseSlice(arguments, 1),
          holders = replaceHolders(partials, partialRight.placeholder);

      return createWrapper(func, PARTIAL_RIGHT_FLAG, null, partials, holders);
    }

    /**
     * Creates a function that invokes `func` with arguments arranged according
     * to the specified indexes where the argument value at the first index is
     * provided as the first argument, the argument value at the second index is
     * provided as the second argument, and so on.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to rearrange arguments for.
     * @param {...(number|number[])} indexes The arranged argument indexes,
     *  specified as individual indexes or arrays of indexes.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var rearged = _.rearg(function(a, b, c) {
     *   return [a, b, c];
     * }, 2, 0, 1);
     *
     * rearged('b', 'c', 'a')
     * // => ['a', 'b', 'c']
     *
     * var map = _.rearg(_.map, [1, 0]);
     * map(function(n) {
     *   return n * 3;
     * }, [1, 2, 3]);
     * // => [3, 6, 9]
     */
    function rearg(func) {
      var indexes = baseFlatten(arguments, false, false, 1);
      return createWrapper(func, REARG_FLAG, null, null, null, indexes);
    }

    /**
     * Creates a function that invokes `func` with the `this` binding of the
     * created function and the array of arguments provided to the created
     * function much like [Function#apply](http://es5.github.io/#x15.3.4.3).
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to spread arguments over.
     * @returns {*} Returns the new function.
     * @example
     *
     * var spread = _.spread(function(who, what) {
     *   return who + ' says ' + what;
     * });
     *
     * spread(['Fred', 'hello']);
     * // => 'Fred says hello'
     *
     * // with a Promise
     * var numbers = Promise.all([
     *   Promise.resolve(40),
     *   Promise.resolve(36)
     * ]);
     *
     * numbers.then(_.spread(function(x, y) {
     *   return x + y;
     * }));
     * // => a Promise of 76
     */
    function spread(func) {
      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      return function(array) {
        return func.apply(this, array);
      };
    }

    /**
     * Creates a function that only invokes `func` at most once per every `wait`
     * milliseconds. The created function comes with a `cancel` method to cancel
     * delayed invocations. Provide an options object to indicate that `func`
     * should be invoked on the leading and/or trailing edge of the `wait` timeout.
     * Subsequent calls to the throttled function return the result of the last
     * `func` call.
     *
     * **Note:** If `leading` and `trailing` options are `true`, `func` is invoked
     * on the trailing edge of the timeout only if the the throttled function is
     * invoked more than once during the `wait` timeout.
     *
     * See [David Corbacho's article](http://drupalmotion.com/article/debounce-and-throttle-visual-explanation)
     * for details over the differences between `_.throttle` and `_.debounce`.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {Function} func The function to throttle.
     * @param {number} [wait=0] The number of milliseconds to throttle invocations to.
     * @param {Object} [options] The options object.
     * @param {boolean} [options.leading=true] Specify invoking on the leading
     *  edge of the timeout.
     * @param {boolean} [options.trailing=true] Specify invoking on the trailing
     *  edge of the timeout.
     * @returns {Function} Returns the new throttled function.
     * @example
     *
     * // avoid excessively updating the position while scrolling
     * jQuery(window).on('scroll', _.throttle(updatePosition, 100));
     *
     * // invoke `renewToken` when the click event is fired, but not more than once every 5 minutes
     * jQuery('.interactive').on('click', _.throttle(renewToken, 300000, {
     *   'trailing': false
     * }));
     *
     * // cancel a trailing throttled call
     * jQuery(window).on('popstate', throttled.cancel);
     */
    function throttle(func, wait, options) {
      var leading = true,
          trailing = true;

      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      if (options === false) {
        leading = false;
      } else if (isObject(options)) {
        leading = 'leading' in options ? !!options.leading : leading;
        trailing = 'trailing' in options ? !!options.trailing : trailing;
      }
      debounceOptions.leading = leading;
      debounceOptions.maxWait = +wait;
      debounceOptions.trailing = trailing;
      return debounce(func, wait, debounceOptions);
    }

    /**
     * Creates a function that provides `value` to the wrapper function as its
     * first argument. Any additional arguments provided to the function are
     * appended to those provided to the wrapper function. The wrapper is invoked
     * with the `this` binding of the created function.
     *
     * @static
     * @memberOf _
     * @category Function
     * @param {*} value The value to wrap.
     * @param {Function} wrapper The wrapper function.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var p = _.wrap(_.escape, function(func, text) {
     *   return '<p>' + func(text) + '</p>';
     * });
     *
     * p('fred, barney, & pebbles');
     * // => '<p>fred, barney, &amp; pebbles</p>'
     */
    function wrap(value, wrapper) {
      wrapper = wrapper == null ? identity : wrapper;
      return createWrapper(wrapper, PARTIAL_FLAG, null, [value], []);
    }

    /*------------------------------------------------------------------------*/

    /**
     * Creates a clone of `value`. If `isDeep` is `true` nested objects are cloned,
     * otherwise they are assigned by reference. If `customizer` is provided it is
     * invoked to produce the cloned values. If `customizer` returns `undefined`
     * cloning is handled by the method instead. The `customizer` is bound to
     * `thisArg` and invoked with two argument; (value [, index|key, object]).
     *
     * **Note:** This method is loosely based on the structured clone algorithm.
     * The enumerable properties of `arguments` objects and objects created by
     * constructors other than `Object` are cloned to plain `Object` objects. An
     * empty object is returned for uncloneable values such as functions, DOM nodes,
     * Maps, Sets, and WeakMaps. See the [HTML5 specification](http://www.w3.org/TR/html5/infrastructure.html#internal-structured-cloning-algorithm)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to clone.
     * @param {boolean} [isDeep] Specify a deep clone.
     * @param {Function} [customizer] The function to customize cloning values.
     * @param {*} [thisArg] The `this` binding of `customizer`.
     * @returns {*} Returns the cloned value.
     * @example
     *
     * var users = [
     *   { 'user': 'barney' },
     *   { 'user': 'fred' }
     * ];
     *
     * var shallow = _.clone(users);
     * shallow[0] === users[0];
     * // => true
     *
     * var deep = _.clone(users, true);
     * deep[0] === users[0];
     * // => false
     *
     * // using a customizer callback
     * var el = _.clone(document.body, function(value) {
     *   if (_.isElement(value)) {
     *     return value.cloneNode(false);
     *   }
     * });
     *
     * el === document.body
     * // => false
     * el.nodeName
     * // => BODY
     * el.childNodes.length;
     * // => 0
     */
    function clone(value, isDeep, customizer, thisArg) {
      if (isDeep && typeof isDeep != 'boolean' && isIterateeCall(value, isDeep, customizer)) {
        isDeep = false;
      }
      else if (typeof isDeep == 'function') {
        thisArg = customizer;
        customizer = isDeep;
        isDeep = false;
      }
      customizer = typeof customizer == 'function' && bindCallback(customizer, thisArg, 1);
      return baseClone(value, isDeep, customizer);
    }

    /**
     * Creates a deep clone of `value`. If `customizer` is provided it is invoked
     * to produce the cloned values. If `customizer` returns `undefined` cloning
     * is handled by the method instead. The `customizer` is bound to `thisArg`
     * and invoked with two argument; (value [, index|key, object]).
     *
     * **Note:** This method is loosely based on the structured clone algorithm.
     * The enumerable properties of `arguments` objects and objects created by
     * constructors other than `Object` are cloned to plain `Object` objects. An
     * empty object is returned for uncloneable values such as functions, DOM nodes,
     * Maps, Sets, and WeakMaps. See the [HTML5 specification](http://www.w3.org/TR/html5/infrastructure.html#internal-structured-cloning-algorithm)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to deep clone.
     * @param {Function} [customizer] The function to customize cloning values.
     * @param {*} [thisArg] The `this` binding of `customizer`.
     * @returns {*} Returns the deep cloned value.
     * @example
     *
     * var users = [
     *   { 'user': 'barney' },
     *   { 'user': 'fred' }
     * ];
     *
     * var deep = _.cloneDeep(users);
     * deep[0] === users[0];
     * // => false
     *
     * // using a customizer callback
     * var el = _.cloneDeep(document.body, function(value) {
     *   if (_.isElement(value)) {
     *     return value.cloneNode(true);
     *   }
     * });
     *
     * el === document.body
     * // => false
     * el.nodeName
     * // => BODY
     * el.childNodes.length;
     * // => 20
     */
    function cloneDeep(value, customizer, thisArg) {
      customizer = typeof customizer == 'function' && bindCallback(customizer, thisArg, 1);
      return baseClone(value, true, customizer);
    }

    /**
     * Checks if `value` is classified as an `arguments` object.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.
     * @example
     *
     * _.isArguments(function() { return arguments; }());
     * // => true
     *
     * _.isArguments([1, 2, 3]);
     * // => false
     */
    function isArguments(value) {
      var length = isObjectLike(value) ? value.length : undefined;
      return (isLength(length) && objToString.call(value) == argsTag) || false;
    }

    /**
     * Checks if `value` is classified as an `Array` object.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.
     * @example
     *
     * _.isArray([1, 2, 3]);
     * // => true
     *
     * _.isArray(function() { return arguments; }());
     * // => false
     */
    var isArray = nativeIsArray || function(value) {
      return (isObjectLike(value) && isLength(value.length) && objToString.call(value) == arrayTag) || false;
    };

    /**
     * Checks if `value` is classified as a boolean primitive or object.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.
     * @example
     *
     * _.isBoolean(false);
     * // => true
     *
     * _.isBoolean(null);
     * // => false
     */
    function isBoolean(value) {
      return (value === true || value === false || isObjectLike(value) && objToString.call(value) == boolTag) || false;
    }

    /**
     * Checks if `value` is classified as a `Date` object.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.
     * @example
     *
     * _.isDate(new Date);
     * // => true
     *
     * _.isDate('Mon April 23 2012');
     * // => false
     */
    function isDate(value) {
      return (isObjectLike(value) && objToString.call(value) == dateTag) || false;
    }

    /**
     * Checks if `value` is a DOM element.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a DOM element, else `false`.
     * @example
     *
     * _.isElement(document.body);
     * // => true
     *
     * _.isElement('<body>');
     * // => false
     */
    function isElement(value) {
      return (value && value.nodeType === 1 && isObjectLike(value) &&
        objToString.call(value).indexOf('Element') > -1) || false;
    }
    // Fallback for environments without DOM support.
    if (!support.dom) {
      isElement = function(value) {
        return (value && value.nodeType === 1 && isObjectLike(value) && !isPlainObject(value)) || false;
      };
    }

    /**
     * Checks if a value is empty. A value is considered empty unless it is an
     * `arguments` object, array, string, or jQuery-like collection with a length
     * greater than `0` or an object with own enumerable properties.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {Array|Object|string} value The value to inspect.
     * @returns {boolean} Returns `true` if `value` is empty, else `false`.
     * @example
     *
     * _.isEmpty(null);
     * // => true
     *
     * _.isEmpty(true);
     * // => true
     *
     * _.isEmpty(1);
     * // => true
     *
     * _.isEmpty([1, 2, 3]);
     * // => false
     *
     * _.isEmpty({ 'a': 1 });
     * // => false
     */
    function isEmpty(value) {
      if (value == null) {
        return true;
      }
      var length = value.length;
      if (isLength(length) && (isArray(value) || isString(value) || isArguments(value) ||
          (isObjectLike(value) && isFunction(value.splice)))) {
        return !length;
      }
      return !keys(value).length;
    }

    /**
     * Performs a deep comparison between two values to determine if they are
     * equivalent. If `customizer` is provided it is invoked to compare values.
     * If `customizer` returns `undefined` comparisons are handled by the method
     * instead. The `customizer` is bound to `thisArg` and invoked with three
     * arguments; (value, other [, index|key]).
     *
     * **Note:** This method supports comparing arrays, booleans, `Date` objects,
     * numbers, `Object` objects, regexes, and strings. Objects are compared by
     * their own, not inherited, enumerable properties. Functions and DOM nodes
     * are **not** supported. Provide a customizer function to extend support
     * for comparing other values.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @param {Function} [customizer] The function to customize comparing values.
     * @param {*} [thisArg] The `this` binding of `customizer`.
     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
     * @example
     *
     * var object = { 'user': 'fred' };
     * var other = { 'user': 'fred' };
     *
     * object == other;
     * // => false
     *
     * _.isEqual(object, other);
     * // => true
     *
     * // using a customizer callback
     * var array = ['hello', 'goodbye'];
     * var other = ['hi', 'goodbye'];
     *
     * _.isEqual(array, other, function(value, other) {
     *   if (_.every([value, other], RegExp.prototype.test, /^h(?:i|ello)$/)) {
     *     return true;
     *   }
     * });
     * // => true
     */
    function isEqual(value, other, customizer, thisArg) {
      customizer = typeof customizer == 'function' && bindCallback(customizer, thisArg, 3);
      if (!customizer && isStrictComparable(value) && isStrictComparable(other)) {
        return value === other;
      }
      var result = customizer ? customizer(value, other) : undefined;
      return typeof result == 'undefined' ? baseIsEqual(value, other, customizer) : !!result;
    }

    /**
     * Checks if `value` is an `Error`, `EvalError`, `RangeError`, `ReferenceError`,
     * `SyntaxError`, `TypeError`, or `URIError` object.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an error object, else `false`.
     * @example
     *
     * _.isError(new Error);
     * // => true
     *
     * _.isError(Error);
     * // => false
     */
    function isError(value) {
      return (isObjectLike(value) && typeof value.message == 'string' && objToString.call(value) == errorTag) || false;
    }

    /**
     * Checks if `value` is a finite primitive number.
     *
     * **Note:** This method is based on ES `Number.isFinite`. See the
     * [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-number.isfinite)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a finite number, else `false`.
     * @example
     *
     * _.isFinite(10);
     * // => true
     *
     * _.isFinite('10');
     * // => false
     *
     * _.isFinite(true);
     * // => false
     *
     * _.isFinite(Object(10));
     * // => false
     *
     * _.isFinite(Infinity);
     * // => false
     */
    var isFinite = nativeNumIsFinite || function(value) {
      return typeof value == 'number' && nativeIsFinite(value);
    };

    /**
     * Checks if `value` is classified as a `Function` object.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.
     * @example
     *
     * _.isFunction(_);
     * // => true
     *
     * _.isFunction(/abc/);
     * // => false
     */
    var isFunction = !(baseIsFunction(/x/) || (Uint8Array && !baseIsFunction(Uint8Array))) ? baseIsFunction : function(value) {
      // The use of `Object#toString` avoids issues with the `typeof` operator
      // in older versions of Chrome and Safari which return 'function' for regexes
      // and Safari 8 equivalents which return 'object' for typed array constructors.
      return objToString.call(value) == funcTag;
    };

    /**
     * Checks if `value` is the language type of `Object`.
     * (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
     *
     * **Note:** See the [ES5 spec](https://es5.github.io/#x8) for more details.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an object, else `false`.
     * @example
     *
     * _.isObject({});
     * // => true
     *
     * _.isObject([1, 2, 3]);
     * // => true
     *
     * _.isObject(1);
     * // => false
     */
    function isObject(value) {
      // Avoid a V8 JIT bug in Chrome 19-20.
      // See https://code.google.com/p/v8/issues/detail?id=2291 for more details.
      var type = typeof value;
      return type == 'function' || (value && type == 'object') || false;
    }

    /**
     * Performs a deep comparison between `object` and `source` to determine if
     * `object` contains equivalent property values. If `customizer` is provided
     * it is invoked to compare values. If `customizer` returns `undefined`
     * comparisons are handled by the method instead. The `customizer` is bound
     * to `thisArg` and invoked with three arguments; (value, other, index|key).
     *
     * **Note:** This method supports comparing properties of arrays, booleans,
     * `Date` objects, numbers, `Object` objects, regexes, and strings. Functions
     * and DOM nodes are **not** supported. Provide a customizer function to extend
     * support for comparing other values.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {Object} object The object to inspect.
     * @param {Object} source The object of property values to match.
     * @param {Function} [customizer] The function to customize comparing values.
     * @param {*} [thisArg] The `this` binding of `customizer`.
     * @returns {boolean} Returns `true` if `object` is a match, else `false`.
     * @example
     *
     * var object = { 'user': 'fred', 'age': 40 };
     *
     * _.isMatch(object, { 'age': 40 });
     * // => true
     *
     * _.isMatch(object, { 'age': 36 });
     * // => false
     *
     * // using a customizer callback
     * var object = { 'greeting': 'hello' };
     * var source = { 'greeting': 'hi' };
     *
     * _.isMatch(object, source, function(value, other) {
     *   return _.every([value, other], RegExp.prototype.test, /^h(?:i|ello)$/) || undefined;
     * });
     * // => true
     */
    function isMatch(object, source, customizer, thisArg) {
      var props = keys(source),
          length = props.length;

      customizer = typeof customizer == 'function' && bindCallback(customizer, thisArg, 3);
      if (!customizer && length == 1) {
        var key = props[0],
            value = source[key];

        if (isStrictComparable(value)) {
          return object != null && value === object[key] && hasOwnProperty.call(object, key);
        }
      }
      var values = Array(length),
          strictCompareFlags = Array(length);

      while (length--) {
        value = values[length] = source[props[length]];
        strictCompareFlags[length] = isStrictComparable(value);
      }
      return baseIsMatch(object, props, values, strictCompareFlags, customizer);
    }

    /**
     * Checks if `value` is `NaN`.
     *
     * **Note:** This method is not the same as native `isNaN` which returns `true`
     * for `undefined` and other non-numeric values. See the [ES5 spec](https://es5.github.io/#x15.1.2.4)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is `NaN`, else `false`.
     * @example
     *
     * _.isNaN(NaN);
     * // => true
     *
     * _.isNaN(new Number(NaN));
     * // => true
     *
     * isNaN(undefined);
     * // => true
     *
     * _.isNaN(undefined);
     * // => false
     */
    function isNaN(value) {
      // An `NaN` primitive is the only value that is not equal to itself.
      // Perform the `toStringTag` check first to avoid errors with some host objects in IE.
      return isNumber(value) && value != +value;
    }

    /**
     * Checks if `value` is a native function.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a native function, else `false`.
     * @example
     *
     * _.isNative(Array.prototype.push);
     * // => true
     *
     * _.isNative(_);
     * // => false
     */
    function isNative(value) {
      if (value == null) {
        return false;
      }
      if (objToString.call(value) == funcTag) {
        return reNative.test(fnToString.call(value));
      }
      return (isObjectLike(value) && reHostCtor.test(value)) || false;
    }

    /**
     * Checks if `value` is `null`.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is `null`, else `false`.
     * @example
     *
     * _.isNull(null);
     * // => true
     *
     * _.isNull(void 0);
     * // => false
     */
    function isNull(value) {
      return value === null;
    }

    /**
     * Checks if `value` is classified as a `Number` primitive or object.
     *
     * **Note:** To exclude `Infinity`, `-Infinity`, and `NaN`, which are classified
     * as numbers, use the `_.isFinite` method.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.
     * @example
     *
     * _.isNumber(8.4);
     * // => true
     *
     * _.isNumber(NaN);
     * // => true
     *
     * _.isNumber('8.4');
     * // => false
     */
    function isNumber(value) {
      return typeof value == 'number' || (isObjectLike(value) && objToString.call(value) == numberTag) || false;
    }

    /**
     * Checks if `value` is a plain object, that is, an object created by the
     * `Object` constructor or one with a `[[Prototype]]` of `null`.
     *
     * **Note:** This method assumes objects created by the `Object` constructor
     * have no inherited enumerable properties.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     * }
     *
     * _.isPlainObject(new Foo);
     * // => false
     *
     * _.isPlainObject([1, 2, 3]);
     * // => false
     *
     * _.isPlainObject({ 'x': 0, 'y': 0 });
     * // => true
     *
     * _.isPlainObject(Object.create(null));
     * // => true
     */
    var isPlainObject = !getPrototypeOf ? shimIsPlainObject : function(value) {
      if (!(value && objToString.call(value) == objectTag)) {
        return false;
      }
      var valueOf = value.valueOf,
          objProto = isNative(valueOf) && (objProto = getPrototypeOf(valueOf)) && getPrototypeOf(objProto);

      return objProto
        ? (value == objProto || getPrototypeOf(value) == objProto)
        : shimIsPlainObject(value);
    };

    /**
     * Checks if `value` is classified as a `RegExp` object.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.
     * @example
     *
     * _.isRegExp(/abc/);
     * // => true
     *
     * _.isRegExp('/abc/');
     * // => false
     */
    function isRegExp(value) {
      return (isObjectLike(value) && objToString.call(value) == regexpTag) || false;
    }

    /**
     * Checks if `value` is classified as a `String` primitive or object.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.
     * @example
     *
     * _.isString('abc');
     * // => true
     *
     * _.isString(1);
     * // => false
     */
    function isString(value) {
      return typeof value == 'string' || (isObjectLike(value) && objToString.call(value) == stringTag) || false;
    }

    /**
     * Checks if `value` is classified as a typed array.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.
     * @example
     *
     * _.isTypedArray(new Uint8Array);
     * // => true
     *
     * _.isTypedArray([]);
     * // => false
     */
    function isTypedArray(value) {
      return (isObjectLike(value) && isLength(value.length) && typedArrayTags[objToString.call(value)]) || false;
    }

    /**
     * Checks if `value` is `undefined`.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is `undefined`, else `false`.
     * @example
     *
     * _.isUndefined(void 0);
     * // => true
     *
     * _.isUndefined(null);
     * // => false
     */
    function isUndefined(value) {
      return typeof value == 'undefined';
    }

    /**
     * Converts `value` to an array.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {Array} Returns the converted array.
     * @example
     *
     * (function() {
     *   return _.toArray(arguments).slice(1);
     * }(1, 2, 3));
     * // => [2, 3]
     */
    function toArray(value) {
      var length = value ? value.length : 0;
      if (!isLength(length)) {
        return values(value);
      }
      if (!length) {
        return [];
      }
      return arrayCopy(value);
    }

    /**
     * Converts `value` to a plain object flattening inherited enumerable
     * properties of `value` to own properties of the plain object.
     *
     * @static
     * @memberOf _
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {Object} Returns the converted plain object.
     * @example
     *
     * function Foo() {
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.assign({ 'a': 1 }, new Foo);
     * // => { 'a': 1, 'b': 2 }
     *
     * _.assign({ 'a': 1 }, _.toPlainObject(new Foo));
     * // => { 'a': 1, 'b': 2, 'c': 3 }
     */
    function toPlainObject(value) {
      return baseCopy(value, keysIn(value));
    }

    /*------------------------------------------------------------------------*/

    /**
     * Assigns own enumerable properties of source object(s) to the destination
     * object. Subsequent sources overwrite property assignments of previous sources.
     * If `customizer` is provided it is invoked to produce the assigned values.
     * The `customizer` is bound to `thisArg` and invoked with five arguments;
     * (objectValue, sourceValue, key, object, source).
     *
     * @static
     * @memberOf _
     * @alias extend
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} [sources] The source objects.
     * @param {Function} [customizer] The function to customize assigning values.
     * @param {*} [thisArg] The `this` binding of `customizer`.
     * @returns {Object} Returns `object`.
     * @example
     *
     * _.assign({ 'user': 'barney' }, { 'age': 40 }, { 'user': 'fred' });
     * // => { 'user': 'fred', 'age': 40 }
     *
     * // using a customizer callback
     * var defaults = _.partialRight(_.assign, function(value, other) {
     *   return typeof value == 'undefined' ? other : value;
     * });
     *
     * defaults({ 'user': 'barney' }, { 'age': 36 }, { 'user': 'fred' });
     * // => { 'user': 'barney', 'age': 36 }
     */
    var assign = createAssigner(baseAssign);

    /**
     * Creates an object that inherits from the given `prototype` object. If a
     * `properties` object is provided its own enumerable properties are assigned
     * to the created object.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} prototype The object to inherit from.
     * @param {Object} [properties] The properties to assign to the object.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {Object} Returns the new object.
     * @example
     *
     * function Shape() {
     *   this.x = 0;
     *   this.y = 0;
     * }
     *
     * function Circle() {
     *   Shape.call(this);
     * }
     *
     * Circle.prototype = _.create(Shape.prototype, {
     *   'constructor': Circle
     * });
     *
     * var circle = new Circle;
     * circle instanceof Circle;
     * // => true
     *
     * circle instanceof Shape;
     * // => true
     */
    function create(prototype, properties, guard) {
      var result = baseCreate(prototype);
      if (guard && isIterateeCall(prototype, properties, guard)) {
        properties = null;
      }
      return properties ? baseCopy(properties, result, keys(properties)) : result;
    }

    /**
     * Assigns own enumerable properties of source object(s) to the destination
     * object for all destination properties that resolve to `undefined`. Once a
     * property is set, additional values of the same property are ignored.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} [sources] The source objects.
     * @returns {Object} Returns `object`.
     * @example
     *
     * _.defaults({ 'user': 'barney' }, { 'age': 36 }, { 'user': 'fred' });
     * // => { 'user': 'barney', 'age': 36 }
     */
    function defaults(object) {
      if (object == null) {
        return object;
      }
      var args = arrayCopy(arguments);
      args.push(assignDefaults);
      return assign.apply(undefined, args);
    }

    /**
     * This method is like `_.findIndex` except that it returns the key of the
     * first element `predicate` returns truthy for, instead of the element itself.
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to search.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {string|undefined} Returns the key of the matched element, else `undefined`.
     * @example
     *
     * var users = {
     *   'barney':  { 'age': 36, 'active': true },
     *   'fred':    { 'age': 40, 'active': false },
     *   'pebbles': { 'age': 1,  'active': true }
     * };
     *
     * _.findKey(users, function(chr) {
     *   return chr.age < 40;
     * });
     * // => 'barney' (iteration order is not guaranteed)
     *
     * // using the `_.matches` callback shorthand
     * _.findKey(users, { 'age': 1, 'active': true });
     * // => 'pebbles'
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.findKey(users, 'active', false);
     * // => 'fred'
     *
     * // using the `_.property` callback shorthand
     * _.findKey(users, 'active');
     * // => 'barney'
     */
    function findKey(object, predicate, thisArg) {
      predicate = getCallback(predicate, thisArg, 3);
      return baseFind(object, predicate, baseForOwn, true);
    }

    /**
     * This method is like `_.findKey` except that it iterates over elements of
     * a collection in the opposite order.
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to search.
     * @param {Function|Object|string} [predicate=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {string|undefined} Returns the key of the matched element, else `undefined`.
     * @example
     *
     * var users = {
     *   'barney':  { 'age': 36, 'active': true },
     *   'fred':    { 'age': 40, 'active': false },
     *   'pebbles': { 'age': 1,  'active': true }
     * };
     *
     * _.findLastKey(users, function(chr) {
     *   return chr.age < 40;
     * });
     * // => returns `pebbles` assuming `_.findKey` returns `barney`
     *
     * // using the `_.matches` callback shorthand
     * _.findLastKey(users, { 'age': 36, 'active': true });
     * // => 'barney'
     *
     * // using the `_.matchesProperty` callback shorthand
     * _.findLastKey(users, 'active', false);
     * // => 'fred'
     *
     * // using the `_.property` callback shorthand
     * _.findLastKey(users, 'active');
     * // => 'pebbles'
     */
    function findLastKey(object, predicate, thisArg) {
      predicate = getCallback(predicate, thisArg, 3);
      return baseFind(object, predicate, baseForOwnRight, true);
    }

    /**
     * Iterates over own and inherited enumerable properties of an object invoking
     * `iteratee` for each property. The `iteratee` is bound to `thisArg` and invoked
     * with three arguments; (value, key, object). Iterator functions may exit
     * iteration early by explicitly returning `false`.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Object} Returns `object`.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.forIn(new Foo, function(value, key) {
     *   console.log(key);
     * });
     * // => logs 'a', 'b', and 'c' (iteration order is not guaranteed)
     */
    function forIn(object, iteratee, thisArg) {
      if (typeof iteratee != 'function' || typeof thisArg != 'undefined') {
        iteratee = bindCallback(iteratee, thisArg, 3);
      }
      return baseFor(object, iteratee, keysIn);
    }

    /**
     * This method is like `_.forIn` except that it iterates over properties of
     * `object` in the opposite order.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Object} Returns `object`.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.forInRight(new Foo, function(value, key) {
     *   console.log(key);
     * });
     * // => logs 'c', 'b', and 'a' assuming `_.forIn ` logs 'a', 'b', and 'c'
     */
    function forInRight(object, iteratee, thisArg) {
      iteratee = bindCallback(iteratee, thisArg, 3);
      return baseForRight(object, iteratee, keysIn);
    }

    /**
     * Iterates over own enumerable properties of an object invoking `iteratee`
     * for each property. The `iteratee` is bound to `thisArg` and invoked with
     * three arguments; (value, key, object). Iterator functions may exit iteration
     * early by explicitly returning `false`.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Object} Returns `object`.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.forOwn(new Foo, function(value, key) {
     *   console.log(key);
     * });
     * // => logs 'a' and 'b' (iteration order is not guaranteed)
     */
    function forOwn(object, iteratee, thisArg) {
      if (typeof iteratee != 'function' || typeof thisArg != 'undefined') {
        iteratee = bindCallback(iteratee, thisArg, 3);
      }
      return baseForOwn(object, iteratee);
    }

    /**
     * This method is like `_.forOwn` except that it iterates over properties of
     * `object` in the opposite order.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Object} Returns `object`.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.forOwnRight(new Foo, function(value, key) {
     *   console.log(key);
     * });
     * // => logs 'b' and 'a' assuming `_.forOwn` logs 'a' and 'b'
     */
    function forOwnRight(object, iteratee, thisArg) {
      iteratee = bindCallback(iteratee, thisArg, 3);
      return baseForRight(object, iteratee, keys);
    }

    /**
     * Creates an array of function property names from all enumerable properties,
     * own and inherited, of `object`.
     *
     * @static
     * @memberOf _
     * @alias methods
     * @category Object
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns the new array of property names.
     * @example
     *
     * _.functions(_);
     * // => ['after', 'ary', 'assign', ...]
     */
    function functions(object) {
      return baseFunctions(object, keysIn(object));
    }

    /**
     * Checks if `key` exists as a direct property of `object` instead of an
     * inherited property.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to inspect.
     * @param {string} key The key to check.
     * @returns {boolean} Returns `true` if `key` is a direct property, else `false`.
     * @example
     *
     * var object = { 'a': 1, 'b': 2, 'c': 3 };
     *
     * _.has(object, 'b');
     * // => true
     */
    function has(object, key) {
      return object ? hasOwnProperty.call(object, key) : false;
    }

    /**
     * Creates an object composed of the inverted keys and values of `object`.
     * If `object` contains duplicate values, subsequent values overwrite property
     * assignments of previous values unless `multiValue` is `true`.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to invert.
     * @param {boolean} [multiValue] Allow multiple values per key.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {Object} Returns the new inverted object.
     * @example
     *
     * var object = { 'a': 1, 'b': 2, 'c': 1 };
     *
     * _.invert(object);
     * // => { '1': 'c', '2': 'b' }
     *
     * // with `multiValue`
     * _.invert(object, true);
     * // => { '1': ['a', 'c'], '2': ['b'] }
     */
    function invert(object, multiValue, guard) {
      if (guard && isIterateeCall(object, multiValue, guard)) {
        multiValue = null;
      }
      var index = -1,
          props = keys(object),
          length = props.length,
          result = {};

      while (++index < length) {
        var key = props[index],
            value = object[key];

        if (multiValue) {
          if (hasOwnProperty.call(result, value)) {
            result[value].push(key);
          } else {
            result[value] = [key];
          }
        }
        else {
          result[value] = key;
        }
      }
      return result;
    }

    /**
     * Creates an array of the own enumerable property names of `object`.
     *
     * **Note:** Non-object values are coerced to objects. See the
     * [ES spec](https://people.mozilla.org/~jorendorff/es6-draft.html#sec-object.keys)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns the array of property names.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.keys(new Foo);
     * // => ['a', 'b'] (iteration order is not guaranteed)
     *
     * _.keys('hi');
     * // => ['0', '1']
     */
    var keys = !nativeKeys ? shimKeys : function(object) {
      if (object) {
        var Ctor = object.constructor,
            length = object.length;
      }
      if ((typeof Ctor == 'function' && Ctor.prototype === object) ||
         (typeof object != 'function' && (length && isLength(length)))) {
        return shimKeys(object);
      }
      return isObject(object) ? nativeKeys(object) : [];
    };

    /**
     * Creates an array of the own and inherited enumerable property names of `object`.
     *
     * **Note:** Non-object values are coerced to objects.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns the array of property names.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.keysIn(new Foo);
     * // => ['a', 'b', 'c'] (iteration order is not guaranteed)
     */
    function keysIn(object) {
      if (object == null) {
        return [];
      }
      if (!isObject(object)) {
        object = Object(object);
      }
      var length = object.length;
      length = (length && isLength(length) &&
        (isArray(object) || (support.nonEnumArgs && isArguments(object))) && length) || 0;

      var Ctor = object.constructor,
          index = -1,
          isProto = typeof Ctor == 'function' && Ctor.prototype === object,
          result = Array(length),
          skipIndexes = length > 0;

      while (++index < length) {
        result[index] = (index + '');
      }
      for (var key in object) {
        if (!(skipIndexes && isIndex(key, length)) &&
            !(key == 'constructor' && (isProto || !hasOwnProperty.call(object, key)))) {
          result.push(key);
        }
      }
      return result;
    }

    /**
     * Creates an object with the same keys as `object` and values generated by
     * running each own enumerable property of `object` through `iteratee`. The
     * iteratee function is bound to `thisArg` and invoked with three arguments;
     * (value, key, object).
     *
     * If a property name is provided for `iteratee` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `iteratee` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function|Object|string} [iteratee=_.identity] The function invoked
     *  per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Object} Returns the new mapped object.
     * @example
     *
     * _.mapValues({ 'a': 1, 'b': 2 }, function(n) {
     *   return n * 3;
     * });
     * // => { 'a': 3, 'b': 6 }
     *
     * var users = {
     *   'fred':    { 'user': 'fred',    'age': 40 },
     *   'pebbles': { 'user': 'pebbles', 'age': 1 }
     * };
     *
     * // using the `_.property` callback shorthand
     * _.mapValues(users, 'age');
     * // => { 'fred': 40, 'pebbles': 1 } (iteration order is not guaranteed)
     */
    function mapValues(object, iteratee, thisArg) {
      var result = {};
      iteratee = getCallback(iteratee, thisArg, 3);

      baseForOwn(object, function(value, key, object) {
        result[key] = iteratee(value, key, object);
      });
      return result;
    }

    /**
     * Recursively merges own enumerable properties of the source object(s), that
     * don't resolve to `undefined` into the destination object. Subsequent sources
     * overwrite property assignments of previous sources. If `customizer` is
     * provided it is invoked to produce the merged values of the destination and
     * source properties. If `customizer` returns `undefined` merging is handled
     * by the method instead. The `customizer` is bound to `thisArg` and invoked
     * with five arguments; (objectValue, sourceValue, key, object, source).
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} [sources] The source objects.
     * @param {Function} [customizer] The function to customize merging properties.
     * @param {*} [thisArg] The `this` binding of `customizer`.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var users = {
     *   'data': [{ 'user': 'barney' }, { 'user': 'fred' }]
     * };
     *
     * var ages = {
     *   'data': [{ 'age': 36 }, { 'age': 40 }]
     * };
     *
     * _.merge(users, ages);
     * // => { 'data': [{ 'user': 'barney', 'age': 36 }, { 'user': 'fred', 'age': 40 }] }
     *
     * // using a customizer callback
     * var object = {
     *   'fruits': ['apple'],
     *   'vegetables': ['beet']
     * };
     *
     * var other = {
     *   'fruits': ['banana'],
     *   'vegetables': ['carrot']
     * };
     *
     * _.merge(object, other, function(a, b) {
     *   if (_.isArray(a)) {
     *     return a.concat(b);
     *   }
     * });
     * // => { 'fruits': ['apple', 'banana'], 'vegetables': ['beet', 'carrot'] }
     */
    var merge = createAssigner(baseMerge);

    /**
     * The opposite of `_.pick`; this method creates an object composed of the
     * own and inherited enumerable properties of `object` that are not omitted.
     * Property names may be specified as individual arguments or as arrays of
     * property names. If `predicate` is provided it is invoked for each property
     * of `object` omitting the properties `predicate` returns truthy for. The
     * predicate is bound to `thisArg` and invoked with three arguments;
     * (value, key, object).
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The source object.
     * @param {Function|...(string|string[])} [predicate] The function invoked per
     *  iteration or property names to omit, specified as individual property
     *  names or arrays of property names.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {Object} Returns the new object.
     * @example
     *
     * var object = { 'user': 'fred', 'age': 40 };
     *
     * _.omit(object, 'age');
     * // => { 'user': 'fred' }
     *
     * _.omit(object, _.isNumber);
     * // => { 'user': 'fred' }
     */
    function omit(object, predicate, thisArg) {
      if (object == null) {
        return {};
      }
      if (typeof predicate != 'function') {
        var props = arrayMap(baseFlatten(arguments, false, false, 1), String);
        return pickByArray(object, baseDifference(keysIn(object), props));
      }
      predicate = bindCallback(predicate, thisArg, 3);
      return pickByCallback(object, function(value, key, object) {
        return !predicate(value, key, object);
      });
    }

    /**
     * Creates a two dimensional array of the key-value pairs for `object`,
     * e.g. `[[key1, value1], [key2, value2]]`.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns the new array of key-value pairs.
     * @example
     *
     * _.pairs({ 'barney': 36, 'fred': 40 });
     * // => [['barney', 36], ['fred', 40]] (iteration order is not guaranteed)
     */
    function pairs(object) {
      var index = -1,
          props = keys(object),
          length = props.length,
          result = Array(length);

      while (++index < length) {
        var key = props[index];
        result[index] = [key, object[key]];
      }
      return result;
    }

    /**
     * Creates an object composed of the picked `object` properties. Property
     * names may be specified as individual arguments or as arrays of property
     * names. If `predicate` is provided it is invoked for each property of `object`
     * picking the properties `predicate` returns truthy for. The predicate is
     * bound to `thisArg` and invoked with three arguments; (value, key, object).
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The source object.
     * @param {Function|...(string|string[])} [predicate] The function invoked per
     *  iteration or property names to pick, specified as individual property
     *  names or arrays of property names.
     * @param {*} [thisArg] The `this` binding of `predicate`.
     * @returns {Object} Returns the new object.
     * @example
     *
     * var object = { 'user': 'fred', 'age': 40 };
     *
     * _.pick(object, 'user');
     * // => { 'user': 'fred' }
     *
     * _.pick(object, _.isString);
     * // => { 'user': 'fred' }
     */
    function pick(object, predicate, thisArg) {
      if (object == null) {
        return {};
      }
      return typeof predicate == 'function'
        ? pickByCallback(object, bindCallback(predicate, thisArg, 3))
        : pickByArray(object, baseFlatten(arguments, false, false, 1));
    }

    /**
     * Resolves the value of property `key` on `object`. If the value of `key` is
     * a function it is invoked with the `this` binding of `object` and its result
     * is returned, else the property value is returned. If the property value is
     * `undefined` the `defaultValue` is used in its place.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to query.
     * @param {string} key The key of the property to resolve.
     * @param {*} [defaultValue] The value returned if the property value
     *  resolves to `undefined`.
     * @returns {*} Returns the resolved value.
     * @example
     *
     * var object = { 'user': 'fred', 'age': _.constant(40) };
     *
     * _.result(object, 'user');
     * // => 'fred'
     *
     * _.result(object, 'age');
     * // => 40
     *
     * _.result(object, 'status', 'busy');
     * // => 'busy'
     *
     * _.result(object, 'status', _.constant('busy'));
     * // => 'busy'
     */
    function result(object, key, defaultValue) {
      var value = object == null ? undefined : object[key];
      if (typeof value == 'undefined') {
        value = defaultValue;
      }
      return isFunction(value) ? value.call(object) : value;
    }

    /**
     * An alternative to `_.reduce`; this method transforms `object` to a new
     * `accumulator` object which is the result of running each of its own enumerable
     * properties through `iteratee`, with each invocation potentially mutating
     * the `accumulator` object. The `iteratee` is bound to `thisArg` and invoked
     * with four arguments; (accumulator, value, key, object). Iterator functions
     * may exit iteration early by explicitly returning `false`.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Array|Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [accumulator] The custom accumulator value.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {*} Returns the accumulated value.
     * @example
     *
     * _.transform([2, 3, 4], function(result, n) {
     *   result.push(n *= n);
     *   return n % 2 == 0;
     * });
     * // => [4, 9]
     *
     * _.transform({ 'a': 1, 'b': 2 }, function(result, n, key) {
     *   result[key] = n * 3;
     * });
     * // => { 'a': 3, 'b': 6 }
     */
    function transform(object, iteratee, accumulator, thisArg) {
      var isArr = isArray(object) || isTypedArray(object);
      iteratee = getCallback(iteratee, thisArg, 4);

      if (accumulator == null) {
        if (isArr || isObject(object)) {
          var Ctor = object.constructor;
          if (isArr) {
            accumulator = isArray(object) ? new Ctor : [];
          } else {
            accumulator = baseCreate(isFunction(Ctor) && Ctor.prototype);
          }
        } else {
          accumulator = {};
        }
      }
      (isArr ? arrayEach : baseForOwn)(object, function(value, index, object) {
        return iteratee(accumulator, value, index, object);
      });
      return accumulator;
    }

    /**
     * Creates an array of the own enumerable property values of `object`.
     *
     * **Note:** Non-object values are coerced to objects.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property values.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.values(new Foo);
     * // => [1, 2] (iteration order is not guaranteed)
     *
     * _.values('hi');
     * // => ['h', 'i']
     */
    function values(object) {
      return baseValues(object, keys(object));
    }

    /**
     * Creates an array of the own and inherited enumerable property values
     * of `object`.
     *
     * **Note:** Non-object values are coerced to objects.
     *
     * @static
     * @memberOf _
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property values.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.valuesIn(new Foo);
     * // => [1, 2, 3] (iteration order is not guaranteed)
     */
    function valuesIn(object) {
      return baseValues(object, keysIn(object));
    }

    /*------------------------------------------------------------------------*/

    /**
     * Checks if `n` is between `start` and up to but not including, `end`. If
     * `end` is not specified it is set to `start` with `start` then set to `0`.
     *
     * @static
     * @memberOf _
     * @category Number
     * @param {number} n The number to check.
     * @param {number} [start=0] The start of the range.
     * @param {number} end The end of the range.
     * @returns {boolean} Returns `true` if `n` is in the range, else `false`.
     * @example
     *
     * _.inRange(3, 2, 4);
     * // => true
     *
     * _.inRange(4, 8);
     * // => true
     *
     * _.inRange(4, 2);
     * // => false
     *
     * _.inRange(2, 2);
     * // => false
     *
     * _.inRange(1.2, 2);
     * // => true
     *
     * _.inRange(5.2, 4);
     * // => false
     */
    function inRange(value, start, end) {
      start = +start || 0;
      if (typeof end === 'undefined') {
        end = start;
        start = 0;
      } else {
        end = +end || 0;
      }
      return value >= start && value < end;
    }

    /**
     * Produces a random number between `min` and `max` (inclusive). If only one
     * argument is provided a number between `0` and the given number is returned.
     * If `floating` is `true`, or either `min` or `max` are floats, a floating-point
     * number is returned instead of an integer.
     *
     * @static
     * @memberOf _
     * @category Number
     * @param {number} [min=0] The minimum possible value.
     * @param {number} [max=1] The maximum possible value.
     * @param {boolean} [floating] Specify returning a floating-point number.
     * @returns {number} Returns the random number.
     * @example
     *
     * _.random(0, 5);
     * // => an integer between 0 and 5
     *
     * _.random(5);
     * // => also an integer between 0 and 5
     *
     * _.random(5, true);
     * // => a floating-point number between 0 and 5
     *
     * _.random(1.2, 5.2);
     * // => a floating-point number between 1.2 and 5.2
     */
    function random(min, max, floating) {
      if (floating && isIterateeCall(min, max, floating)) {
        max = floating = null;
      }
      var noMin = min == null,
          noMax = max == null;

      if (floating == null) {
        if (noMax && typeof min == 'boolean') {
          floating = min;
          min = 1;
        }
        else if (typeof max == 'boolean') {
          floating = max;
          noMax = true;
        }
      }
      if (noMin && noMax) {
        max = 1;
        noMax = false;
      }
      min = +min || 0;
      if (noMax) {
        max = min;
        min = 0;
      } else {
        max = +max || 0;
      }
      if (floating || min % 1 || max % 1) {
        var rand = nativeRandom();
        return nativeMin(min + (rand * (max - min + parseFloat('1e-' + ((rand + '').length - 1)))), max);
      }
      return baseRandom(min, max);
    }

    /*------------------------------------------------------------------------*/

    /**
     * Converts `string` to camel case.
     * See [Wikipedia](https://en.wikipedia.org/wiki/CamelCase) for more details.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the camel cased string.
     * @example
     *
     * _.camelCase('Foo Bar');
     * // => 'fooBar'
     *
     * _.camelCase('--foo-bar');
     * // => 'fooBar'
     *
     * _.camelCase('__foo_bar__');
     * // => 'fooBar'
     */
    var camelCase = createCompounder(function(result, word, index) {
      word = word.toLowerCase();
      return result + (index ? (word.charAt(0).toUpperCase() + word.slice(1)) : word);
    });

    /**
     * Capitalizes the first character of `string`.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to capitalize.
     * @returns {string} Returns the capitalized string.
     * @example
     *
     * _.capitalize('fred');
     * // => 'Fred'
     */
    function capitalize(string) {
      string = baseToString(string);
      return string && (string.charAt(0).toUpperCase() + string.slice(1));
    }

    /**
     * Deburrs `string` by converting latin-1 supplementary letters to basic latin letters.
     * See [Wikipedia](https://en.wikipedia.org/wiki/Latin-1_Supplement_(Unicode_block)#Character_table)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to deburr.
     * @returns {string} Returns the deburred string.
     * @example
     *
     * _.deburr('déjà vu');
     * // => 'deja vu'
     */
    function deburr(string) {
      string = baseToString(string);
      return string && string.replace(reLatin1, deburrLetter);
    }

    /**
     * Checks if `string` ends with the given target string.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to search.
     * @param {string} [target] The string to search for.
     * @param {number} [position=string.length] The position to search from.
     * @returns {boolean} Returns `true` if `string` ends with `target`, else `false`.
     * @example
     *
     * _.endsWith('abc', 'c');
     * // => true
     *
     * _.endsWith('abc', 'b');
     * // => false
     *
     * _.endsWith('abc', 'b', 2);
     * // => true
     */
    function endsWith(string, target, position) {
      string = baseToString(string);
      target = (target + '');

      var length = string.length;
      position = (typeof position == 'undefined' ? length : nativeMin(position < 0 ? 0 : (+position || 0), length)) - target.length;
      return position >= 0 && string.indexOf(target, position) == position;
    }

    /**
     * Converts the characters "&", "<", ">", '"', "'", and "\`", in `string` to
     * their corresponding HTML entities.
     *
     * **Note:** No other characters are escaped. To escape additional characters
     * use a third-party library like [_he_](https://mths.be/he).
     *
     * Though the ">" character is escaped for symmetry, characters like
     * ">" and "/" don't require escaping in HTML and have no special meaning
     * unless they're part of a tag or unquoted attribute value.
     * See [Mathias Bynens's article](https://mathiasbynens.be/notes/ambiguous-ampersands)
     * (under "semi-related fun fact") for more details.
     *
     * Backticks are escaped because in Internet Explorer < 9, they can break out
     * of attribute values or HTML comments. See [#102](https://html5sec.org/#102),
     * [#108](https://html5sec.org/#108), and [#133](https://html5sec.org/#133) of
     * the [HTML5 Security Cheatsheet](https://html5sec.org/) for more details.
     *
     * When working with HTML you should always quote attribute values to reduce
     * XSS vectors. See [Ryan Grove's article](http://wonko.com/post/html-escaping)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to escape.
     * @returns {string} Returns the escaped string.
     * @example
     *
     * _.escape('fred, barney, & pebbles');
     * // => 'fred, barney, &amp; pebbles'
     */
    function escape(string) {
      // Reset `lastIndex` because in IE < 9 `String#replace` does not.
      string = baseToString(string);
      return (string && reHasUnescapedHtml.test(string))
        ? string.replace(reUnescapedHtml, escapeHtmlChar)
        : string;
    }

    /**
     * Escapes the `RegExp` special characters "\", "^", "$", ".", "|", "?", "*",
     * "+", "(", ")", "[", "]", "{" and "}" in `string`.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to escape.
     * @returns {string} Returns the escaped string.
     * @example
     *
     * _.escapeRegExp('[lodash](https://lodash.com/)');
     * // => '\[lodash\]\(https://lodash\.com/\)'
     */
    function escapeRegExp(string) {
      string = baseToString(string);
      return (string && reHasRegExpChars.test(string))
        ? string.replace(reRegExpChars, '\\$&')
        : string;
    }

    /**
     * Converts `string` to kebab case.
     * See [Wikipedia](https://en.wikipedia.org/wiki/Letter_case#Special_case_styles) for
     * more details.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the kebab cased string.
     * @example
     *
     * _.kebabCase('Foo Bar');
     * // => 'foo-bar'
     *
     * _.kebabCase('fooBar');
     * // => 'foo-bar'
     *
     * _.kebabCase('__foo_bar__');
     * // => 'foo-bar'
     */
    var kebabCase = createCompounder(function(result, word, index) {
      return result + (index ? '-' : '') + word.toLowerCase();
    });

    /**
     * Pads `string` on the left and right sides if it is shorter then the given
     * padding length. The `chars` string may be truncated if the number of padding
     * characters can't be evenly divided by the padding length.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to pad.
     * @param {number} [length=0] The padding length.
     * @param {string} [chars=' '] The string used as padding.
     * @returns {string} Returns the padded string.
     * @example
     *
     * _.pad('abc', 8);
     * // => '  abc   '
     *
     * _.pad('abc', 8, '_-');
     * // => '_-abc_-_'
     *
     * _.pad('abc', 3);
     * // => 'abc'
     */
    function pad(string, length, chars) {
      string = baseToString(string);
      length = +length;

      var strLength = string.length;
      if (strLength >= length || !nativeIsFinite(length)) {
        return string;
      }
      var mid = (length - strLength) / 2,
          leftLength = floor(mid),
          rightLength = ceil(mid);

      chars = createPad('', rightLength, chars);
      return chars.slice(0, leftLength) + string + chars;
    }

    /**
     * Pads `string` on the left side if it is shorter then the given padding
     * length. The `chars` string may be truncated if the number of padding
     * characters exceeds the padding length.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to pad.
     * @param {number} [length=0] The padding length.
     * @param {string} [chars=' '] The string used as padding.
     * @returns {string} Returns the padded string.
     * @example
     *
     * _.padLeft('abc', 6);
     * // => '   abc'
     *
     * _.padLeft('abc', 6, '_-');
     * // => '_-_abc'
     *
     * _.padLeft('abc', 3);
     * // => 'abc'
     */
    function padLeft(string, length, chars) {
      string = baseToString(string);
      return string && (createPad(string, length, chars) + string);
    }

    /**
     * Pads `string` on the right side if it is shorter then the given padding
     * length. The `chars` string may be truncated if the number of padding
     * characters exceeds the padding length.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to pad.
     * @param {number} [length=0] The padding length.
     * @param {string} [chars=' '] The string used as padding.
     * @returns {string} Returns the padded string.
     * @example
     *
     * _.padRight('abc', 6);
     * // => 'abc   '
     *
     * _.padRight('abc', 6, '_-');
     * // => 'abc_-_'
     *
     * _.padRight('abc', 3);
     * // => 'abc'
     */
    function padRight(string, length, chars) {
      string = baseToString(string);
      return string && (string + createPad(string, length, chars));
    }

    /**
     * Converts `string` to an integer of the specified radix. If `radix` is
     * `undefined` or `0`, a `radix` of `10` is used unless `value` is a hexadecimal,
     * in which case a `radix` of `16` is used.
     *
     * **Note:** This method aligns with the ES5 implementation of `parseInt`.
     * See the [ES5 spec](https://es5.github.io/#E) for more details.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} string The string to convert.
     * @param {number} [radix] The radix to interpret `value` by.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {number} Returns the converted integer.
     * @example
     *
     * _.parseInt('08');
     * // => 8
     *
     * _.map(['6', '08', '10'], _.parseInt);
     * // => [6, 8, 10]
     */
    function parseInt(string, radix, guard) {
      if (guard && isIterateeCall(string, radix, guard)) {
        radix = 0;
      }
      return nativeParseInt(string, radix);
    }
    // Fallback for environments with pre-ES5 implementations.
    if (nativeParseInt(whitespace + '08') != 8) {
      parseInt = function(string, radix, guard) {
        // Firefox < 21 and Opera < 15 follow ES3 for `parseInt`.
        // Chrome fails to trim leading <BOM> whitespace characters.
        // See https://code.google.com/p/v8/issues/detail?id=3109 for more details.
        if (guard ? isIterateeCall(string, radix, guard) : radix == null) {
          radix = 0;
        } else if (radix) {
          radix = +radix;
        }
        string = trim(string);
        return nativeParseInt(string, radix || (reHexPrefix.test(string) ? 16 : 10));
      };
    }

    /**
     * Repeats the given string `n` times.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to repeat.
     * @param {number} [n=0] The number of times to repeat the string.
     * @returns {string} Returns the repeated string.
     * @example
     *
     * _.repeat('*', 3);
     * // => '***'
     *
     * _.repeat('abc', 2);
     * // => 'abcabc'
     *
     * _.repeat('abc', 0);
     * // => ''
     */
    function repeat(string, n) {
      var result = '';
      string = baseToString(string);
      n = +n;
      if (n < 1 || !string || !nativeIsFinite(n)) {
        return result;
      }
      // Leverage the exponentiation by squaring algorithm for a faster repeat.
      // See https://en.wikipedia.org/wiki/Exponentiation_by_squaring for more details.
      do {
        if (n % 2) {
          result += string;
        }
        n = floor(n / 2);
        string += string;
      } while (n);

      return result;
    }

    /**
     * Converts `string` to snake case.
     * See [Wikipedia](https://en.wikipedia.org/wiki/Snake_case) for more details.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the snake cased string.
     * @example
     *
     * _.snakeCase('Foo Bar');
     * // => 'foo_bar'
     *
     * _.snakeCase('fooBar');
     * // => 'foo_bar'
     *
     * _.snakeCase('--foo-bar');
     * // => 'foo_bar'
     */
    var snakeCase = createCompounder(function(result, word, index) {
      return result + (index ? '_' : '') + word.toLowerCase();
    });

    /**
     * Converts `string` to start case.
     * See [Wikipedia](https://en.wikipedia.org/wiki/Letter_case#Stylistic_or_specialised_usage)
     * for more details.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the start cased string.
     * @example
     *
     * _.startCase('--foo-bar');
     * // => 'Foo Bar'
     *
     * _.startCase('fooBar');
     * // => 'Foo Bar'
     *
     * _.startCase('__foo_bar__');
     * // => 'Foo Bar'
     */
    var startCase = createCompounder(function(result, word, index) {
      return result + (index ? ' ' : '') + (word.charAt(0).toUpperCase() + word.slice(1));
    });

    /**
     * Checks if `string` starts with the given target string.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to search.
     * @param {string} [target] The string to search for.
     * @param {number} [position=0] The position to search from.
     * @returns {boolean} Returns `true` if `string` starts with `target`, else `false`.
     * @example
     *
     * _.startsWith('abc', 'a');
     * // => true
     *
     * _.startsWith('abc', 'b');
     * // => false
     *
     * _.startsWith('abc', 'b', 1);
     * // => true
     */
    function startsWith(string, target, position) {
      string = baseToString(string);
      position = position == null ? 0 : nativeMin(position < 0 ? 0 : (+position || 0), string.length);
      return string.lastIndexOf(target, position) == position;
    }

    /**
     * Creates a compiled template function that can interpolate data properties
     * in "interpolate" delimiters, HTML-escape interpolated data properties in
     * "escape" delimiters, and execute JavaScript in "evaluate" delimiters. Data
     * properties may be accessed as free variables in the template. If a setting
     * object is provided it takes precedence over `_.templateSettings` values.
     *
     * **Note:** In the development build `_.template` utilizes sourceURLs for easier debugging.
     * See the [HTML5 Rocks article on sourcemaps](http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl)
     * for more details.
     *
     * For more information on precompiling templates see
     * [lodash's custom builds documentation](https://lodash.com/custom-builds).
     *
     * For more information on Chrome extension sandboxes see
     * [Chrome's extensions documentation](https://developer.chrome.com/extensions/sandboxingEval).
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The template string.
     * @param {Object} [options] The options object.
     * @param {RegExp} [options.escape] The HTML "escape" delimiter.
     * @param {RegExp} [options.evaluate] The "evaluate" delimiter.
     * @param {Object} [options.imports] An object to import into the template as free variables.
     * @param {RegExp} [options.interpolate] The "interpolate" delimiter.
     * @param {string} [options.sourceURL] The sourceURL of the template's compiled source.
     * @param {string} [options.variable] The data object variable name.
     * @param- {Object} [otherOptions] Enables the legacy `options` param signature.
     * @returns {Function} Returns the compiled template function.
     * @example
     *
     * // using the "interpolate" delimiter to create a compiled template
     * var compiled = _.template('hello <%= user %>!');
     * compiled({ 'user': 'fred' });
     * // => 'hello fred!'
     *
     * // using the HTML "escape" delimiter to escape data property values
     * var compiled = _.template('<b><%- value %></b>');
     * compiled({ 'value': '<script>' });
     * // => '<b>&lt;script&gt;</b>'
     *
     * // using the "evaluate" delimiter to execute JavaScript and generate HTML
     * var compiled = _.template('<% _.forEach(users, function(user) { %><li><%- user %></li><% }); %>');
     * compiled({ 'users': ['fred', 'barney'] });
     * // => '<li>fred</li><li>barney</li>'
     *
     * // using the internal `print` function in "evaluate" delimiters
     * var compiled = _.template('<% print("hello " + user); %>!');
     * compiled({ 'user': 'barney' });
     * // => 'hello barney!'
     *
     * // using the ES delimiter as an alternative to the default "interpolate" delimiter
     * var compiled = _.template('hello ${ user }!');
     * compiled({ 'user': 'pebbles' });
     * // => 'hello pebbles!'
     *
     * // using custom template delimiters
     * _.templateSettings.interpolate = /{{([\s\S]+?)}}/g;
     * var compiled = _.template('hello {{ user }}!');
     * compiled({ 'user': 'mustache' });
     * // => 'hello mustache!'
     *
     * // using backslashes to treat delimiters as plain text
     * var compiled = _.template('<%= "\\<%- value %\\>" %>');
     * compiled({ 'value': 'ignored' });
     * // => '<%- value %>'
     *
     * // using the `imports` option to import `jQuery` as `jq`
     * var text = '<% jq.each(users, function(user) { %><li><%- user %></li><% }); %>';
     * var compiled = _.template(text, { 'imports': { 'jq': jQuery } });
     * compiled({ 'users': ['fred', 'barney'] });
     * // => '<li>fred</li><li>barney</li>'
     *
     * // using the `sourceURL` option to specify a custom sourceURL for the template
     * var compiled = _.template('hello <%= user %>!', { 'sourceURL': '/basic/greeting.jst' });
     * compiled(data);
     * // => find the source of "greeting.jst" under the Sources tab or Resources panel of the web inspector
     *
     * // using the `variable` option to ensure a with-statement isn't used in the compiled template
     * var compiled = _.template('hi <%= data.user %>!', { 'variable': 'data' });
     * compiled.source;
     * // => function(data) {
     * //   var __t, __p = '';
     * //   __p += 'hi ' + ((__t = ( data.user )) == null ? '' : __t) + '!';
     * //   return __p;
     * // }
     *
     * // using the `source` property to inline compiled templates for meaningful
     * // line numbers in error messages and a stack trace
     * fs.writeFileSync(path.join(cwd, 'jst.js'), '\
     *   var JST = {\
     *     "main": ' + _.template(mainText).source + '\
     *   };\
     * ');
     */
    function template(string, options, otherOptions) {
      // Based on John Resig's `tmpl` implementation (http://ejohn.org/blog/javascript-micro-templating/)
      // and Laura Doktorova's doT.js (https://github.com/olado/doT).
      var settings = lodash.templateSettings;

      if (otherOptions && isIterateeCall(string, options, otherOptions)) {
        options = otherOptions = null;
      }
      string = baseToString(string);
      options = baseAssign(baseAssign({}, otherOptions || options), settings, assignOwnDefaults);

      var imports = baseAssign(baseAssign({}, options.imports), settings.imports, assignOwnDefaults),
          importsKeys = keys(imports),
          importsValues = baseValues(imports, importsKeys);

      var isEscaping,
          isEvaluating,
          index = 0,
          interpolate = options.interpolate || reNoMatch,
          source = "__p += '";

      // Compile the regexp to match each delimiter.
      var reDelimiters = RegExp(
        (options.escape || reNoMatch).source + '|' +
        interpolate.source + '|' +
        (interpolate === reInterpolate ? reEsTemplate : reNoMatch).source + '|' +
        (options.evaluate || reNoMatch).source + '|$'
      , 'g');

      // Use a sourceURL for easier debugging.
      var sourceURL = '//# sourceURL=' +
        ('sourceURL' in options
          ? options.sourceURL
          : ('lodash.templateSources[' + (++templateCounter) + ']')
        ) + '\n';

      string.replace(reDelimiters, function(match, escapeValue, interpolateValue, esTemplateValue, evaluateValue, offset) {
        interpolateValue || (interpolateValue = esTemplateValue);

        // Escape characters that can't be included in string literals.
        source += string.slice(index, offset).replace(reUnescapedString, escapeStringChar);

        // Replace delimiters with snippets.
        if (escapeValue) {
          isEscaping = true;
          source += "' +\n__e(" + escapeValue + ") +\n'";
        }
        if (evaluateValue) {
          isEvaluating = true;
          source += "';\n" + evaluateValue + ";\n__p += '";
        }
        if (interpolateValue) {
          source += "' +\n((__t = (" + interpolateValue + ")) == null ? '' : __t) +\n'";
        }
        index = offset + match.length;

        // The JS engine embedded in Adobe products requires returning the `match`
        // string in order to produce the correct `offset` value.
        return match;
      });

      source += "';\n";

      // If `variable` is not specified wrap a with-statement around the generated
      // code to add the data object to the top of the scope chain.
      var variable = options.variable;
      if (!variable) {
        source = 'with (obj) {\n' + source + '\n}\n';
      }
      // Cleanup code by stripping empty strings.
      source = (isEvaluating ? source.replace(reEmptyStringLeading, '') : source)
        .replace(reEmptyStringMiddle, '$1')
        .replace(reEmptyStringTrailing, '$1;');

      // Frame code as the function body.
      source = 'function(' + (variable || 'obj') + ') {\n' +
        (variable
          ? ''
          : 'obj || (obj = {});\n'
        ) +
        "var __t, __p = ''" +
        (isEscaping
           ? ', __e = _.escape'
           : ''
        ) +
        (isEvaluating
          ? ', __j = Array.prototype.join;\n' +
            "function print() { __p += __j.call(arguments, '') }\n"
          : ';\n'
        ) +
        source +
        'return __p\n}';

      var result = attempt(function() {
        return Function(importsKeys, sourceURL + 'return ' + source).apply(undefined, importsValues);
      });

      // Provide the compiled function's source by its `toString` method or
      // the `source` property as a convenience for inlining compiled templates.
      result.source = source;
      if (isError(result)) {
        throw result;
      }
      return result;
    }

    /**
     * Removes leading and trailing whitespace or specified characters from `string`.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to trim.
     * @param {string} [chars=whitespace] The characters to trim.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {string} Returns the trimmed string.
     * @example
     *
     * _.trim('  abc  ');
     * // => 'abc'
     *
     * _.trim('-_-abc-_-', '_-');
     * // => 'abc'
     *
     * _.map(['  foo  ', '  bar  '], _.trim);
     * // => ['foo', 'bar]
     */
    function trim(string, chars, guard) {
      var value = string;
      string = baseToString(string);
      if (!string) {
        return string;
      }
      if (guard ? isIterateeCall(value, chars, guard) : chars == null) {
        return string.slice(trimmedLeftIndex(string), trimmedRightIndex(string) + 1);
      }
      chars = (chars + '');
      return string.slice(charsLeftIndex(string, chars), charsRightIndex(string, chars) + 1);
    }

    /**
     * Removes leading whitespace or specified characters from `string`.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to trim.
     * @param {string} [chars=whitespace] The characters to trim.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {string} Returns the trimmed string.
     * @example
     *
     * _.trimLeft('  abc  ');
     * // => 'abc  '
     *
     * _.trimLeft('-_-abc-_-', '_-');
     * // => 'abc-_-'
     */
    function trimLeft(string, chars, guard) {
      var value = string;
      string = baseToString(string);
      if (!string) {
        return string;
      }
      if (guard ? isIterateeCall(value, chars, guard) : chars == null) {
        return string.slice(trimmedLeftIndex(string));
      }
      return string.slice(charsLeftIndex(string, (chars + '')));
    }

    /**
     * Removes trailing whitespace or specified characters from `string`.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to trim.
     * @param {string} [chars=whitespace] The characters to trim.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {string} Returns the trimmed string.
     * @example
     *
     * _.trimRight('  abc  ');
     * // => '  abc'
     *
     * _.trimRight('-_-abc-_-', '_-');
     * // => '-_-abc'
     */
    function trimRight(string, chars, guard) {
      var value = string;
      string = baseToString(string);
      if (!string) {
        return string;
      }
      if (guard ? isIterateeCall(value, chars, guard) : chars == null) {
        return string.slice(0, trimmedRightIndex(string) + 1);
      }
      return string.slice(0, charsRightIndex(string, (chars + '')) + 1);
    }

    /**
     * Truncates `string` if it is longer than the given maximum string length.
     * The last characters of the truncated string are replaced with the omission
     * string which defaults to "...".
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to truncate.
     * @param {Object|number} [options] The options object or maximum string length.
     * @param {number} [options.length=30] The maximum string length.
     * @param {string} [options.omission='...'] The string to indicate text is omitted.
     * @param {RegExp|string} [options.separator] The separator pattern to truncate to.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {string} Returns the truncated string.
     * @example
     *
     * _.trunc('hi-diddly-ho there, neighborino');
     * // => 'hi-diddly-ho there, neighbo...'
     *
     * _.trunc('hi-diddly-ho there, neighborino', 24);
     * // => 'hi-diddly-ho there, n...'
     *
     * _.trunc('hi-diddly-ho there, neighborino', {
     *   'length': 24,
     *   'separator': ' '
     * });
     * // => 'hi-diddly-ho there,...'
     *
     * _.trunc('hi-diddly-ho there, neighborino', {
     *   'length': 24,
     *   'separator': /,? +/
     * });
     * //=> 'hi-diddly-ho there...'
     *
     * _.trunc('hi-diddly-ho there, neighborino', {
     *   'omission': ' [...]'
     * });
     * // => 'hi-diddly-ho there, neig [...]'
     */
    function trunc(string, options, guard) {
      if (guard && isIterateeCall(string, options, guard)) {
        options = null;
      }
      var length = DEFAULT_TRUNC_LENGTH,
          omission = DEFAULT_TRUNC_OMISSION;

      if (options != null) {
        if (isObject(options)) {
          var separator = 'separator' in options ? options.separator : separator;
          length = 'length' in options ? +options.length || 0 : length;
          omission = 'omission' in options ? baseToString(options.omission) : omission;
        } else {
          length = +options || 0;
        }
      }
      string = baseToString(string);
      if (length >= string.length) {
        return string;
      }
      var end = length - omission.length;
      if (end < 1) {
        return omission;
      }
      var result = string.slice(0, end);
      if (separator == null) {
        return result + omission;
      }
      if (isRegExp(separator)) {
        if (string.slice(end).search(separator)) {
          var match,
              newEnd,
              substring = string.slice(0, end);

          if (!separator.global) {
            separator = RegExp(separator.source, (reFlags.exec(separator) || '') + 'g');
          }
          separator.lastIndex = 0;
          while ((match = separator.exec(substring))) {
            newEnd = match.index;
          }
          result = result.slice(0, newEnd == null ? end : newEnd);
        }
      } else if (string.indexOf(separator, end) != end) {
        var index = result.lastIndexOf(separator);
        if (index > -1) {
          result = result.slice(0, index);
        }
      }
      return result + omission;
    }

    /**
     * The inverse of `_.escape`; this method converts the HTML entities
     * `&amp;`, `&lt;`, `&gt;`, `&quot;`, `&#39;`, and `&#96;` in `string` to their
     * corresponding characters.
     *
     * **Note:** No other HTML entities are unescaped. To unescape additional HTML
     * entities use a third-party library like [_he_](https://mths.be/he).
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to unescape.
     * @returns {string} Returns the unescaped string.
     * @example
     *
     * _.unescape('fred, barney, &amp; pebbles');
     * // => 'fred, barney, & pebbles'
     */
    function unescape(string) {
      string = baseToString(string);
      return (string && reHasEscapedHtml.test(string))
        ? string.replace(reEscapedHtml, unescapeHtmlChar)
        : string;
    }

    /**
     * Splits `string` into an array of its words.
     *
     * @static
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to inspect.
     * @param {RegExp|string} [pattern] The pattern to match words.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {Array} Returns the words of `string`.
     * @example
     *
     * _.words('fred, barney, & pebbles');
     * // => ['fred', 'barney', 'pebbles']
     *
     * _.words('fred, barney, & pebbles', /[^, ]+/g);
     * // => ['fred', 'barney', '&', 'pebbles']
     */
    function words(string, pattern, guard) {
      if (guard && isIterateeCall(string, pattern, guard)) {
        pattern = null;
      }
      string = baseToString(string);
      return string.match(pattern || reWords) || [];
    }

    /*------------------------------------------------------------------------*/

    /**
     * Attempts to invoke `func`, returning either the result or the caught error
     * object. Any additional arguments are provided to `func` when it is invoked.
     *
     * @static
     * @memberOf _
     * @category Utility
     * @param {*} func The function to attempt.
     * @returns {*} Returns the `func` result or error object.
     * @example
     *
     * // avoid throwing errors for invalid selectors
     * var elements = _.attempt(function(selector) {
     *   return document.querySelectorAll(selector);
     * }, '>_>');
     *
     * if (_.isError(elements)) {
     *   elements = [];
     * }
     */
    function attempt() {
      var func = arguments[0],
          length = arguments.length,
          args = Array(length ? length - 1 : 0);

      while (--length > 0) {
        args[length - 1] = arguments[length];
      }
      try {
        return func.apply(undefined, args);
      } catch(e) {
        return isError(e) ? e : new Error(e);
      }
    }

    /**
     * Creates a function that invokes `func` with the `this` binding of `thisArg`
     * and arguments of the created function. If `func` is a property name the
     * created callback returns the property value for a given element. If `func`
     * is an object the created callback returns `true` for elements that contain
     * the equivalent object properties, otherwise it returns `false`.
     *
     * @static
     * @memberOf _
     * @alias iteratee
     * @category Utility
     * @param {*} [func=_.identity] The value to convert to a callback.
     * @param {*} [thisArg] The `this` binding of `func`.
     * @param- {Object} [guard] Enables use as a callback for functions like `_.map`.
     * @returns {Function} Returns the callback.
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36 },
     *   { 'user': 'fred',   'age': 40 }
     * ];
     *
     * // wrap to create custom callback shorthands
     * _.callback = _.wrap(_.callback, function(callback, func, thisArg) {
     *   var match = /^(.+?)__([gl]t)(.+)$/.exec(func);
     *   if (!match) {
     *     return callback(func, thisArg);
     *   }
     *   return function(object) {
     *     return match[2] == 'gt'
     *       ? object[match[1]] > match[3]
     *       : object[match[1]] < match[3];
     *   };
     * });
     *
     * _.filter(users, 'age__gt36');
     * // => [{ 'user': 'fred', 'age': 40 }]
     */
    function callback(func, thisArg, guard) {
      if (guard && isIterateeCall(func, thisArg, guard)) {
        thisArg = null;
      }
      return isObjectLike(func)
        ? matches(func)
        : baseCallback(func, thisArg);
    }

    /**
     * Creates a function that returns `value`.
     *
     * @static
     * @memberOf _
     * @category Utility
     * @param {*} value The value to return from the new function.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var object = { 'user': 'fred' };
     * var getter = _.constant(object);
     *
     * getter() === object;
     * // => true
     */
    function constant(value) {
      return function() {
        return value;
      };
    }

    /**
     * This method returns the first argument provided to it.
     *
     * @static
     * @memberOf _
     * @category Utility
     * @param {*} value Any value.
     * @returns {*} Returns `value`.
     * @example
     *
     * var object = { 'user': 'fred' };
     *
     * _.identity(object) === object;
     * // => true
     */
    function identity(value) {
      return value;
    }

    /**
     * Creates a function which performs a deep comparison between a given object
     * and `source`, returning `true` if the given object has equivalent property
     * values, else `false`.
     *
     * **Note:** This method supports comparing arrays, booleans, `Date` objects,
     * numbers, `Object` objects, regexes, and strings. Objects are compared by
     * their own, not inherited, enumerable properties. For comparing a single
     * own or inherited property value see `_.matchesProperty`.
     *
     * @static
     * @memberOf _
     * @category Utility
     * @param {Object} source The object of property values to match.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36, 'active': true },
     *   { 'user': 'fred',   'age': 40, 'active': false }
     * ];
     *
     * _.filter(users, _.matches({ 'age': 40, 'active': false }));
     * // => [{ 'user': 'fred', 'age': 40, 'active': false }]
     */
    function matches(source) {
      return baseMatches(baseClone(source, true));
    }

    /**
     * Creates a function which compares the property value of `key` on a given
     * object to `value`.
     *
     * **Note:** This method supports comparing arrays, booleans, `Date` objects,
     * numbers, `Object` objects, regexes, and strings. Objects are compared by
     * their own, not inherited, enumerable properties.
     *
     * @static
     * @memberOf _
     * @category Utility
     * @param {string} key The key of the property to get.
     * @param {*} value The value to compare.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var users = [
     *   { 'user': 'barney' },
     *   { 'user': 'fred' },
     *   { 'user': 'pebbles' }
     * ];
     *
     * _.find(users, _.matchesProperty('user', 'fred'));
     * // => { 'user': 'fred', 'age': 40 }
     */
    function matchesProperty(key, value) {
      return baseMatchesProperty(key + '', baseClone(value, true));
    }

    /**
     * Adds all own enumerable function properties of a source object to the
     * destination object. If `object` is a function then methods are added to
     * its prototype as well.
     *
     * @static
     * @memberOf _
     * @category Utility
     * @param {Function|Object} [object=this] object The destination object.
     * @param {Object} source The object of functions to add.
     * @param {Object} [options] The options object.
     * @param {boolean} [options.chain=true] Specify whether the functions added
     *  are chainable.
     * @returns {Function|Object} Returns `object`.
     * @example
     *
     * function vowels(string) {
     *   return _.filter(string, function(v) {
     *     return /[aeiou]/i.test(v);
     *   });
     * }
     *
     * // use `_.runInContext` to avoid potential conflicts (esp. in Node.js)
     * var _ = require('lodash').runInContext();
     *
     * _.mixin({ 'vowels': vowels });
     * _.vowels('fred');
     * // => ['e']
     *
     * _('fred').vowels().value();
     * // => ['e']
     *
     * _.mixin({ 'vowels': vowels }, { 'chain': false });
     * _('fred').vowels();
     * // => ['e']
     */
    function mixin(object, source, options) {
      if (options == null) {
        var isObj = isObject(source),
            props = isObj && keys(source),
            methodNames = props && props.length && baseFunctions(source, props);

        if (!(methodNames ? methodNames.length : isObj)) {
          methodNames = false;
          options = source;
          source = object;
          object = this;
        }
      }
      if (!methodNames) {
        methodNames = baseFunctions(source, keys(source));
      }
      var chain = true,
          index = -1,
          isFunc = isFunction(object),
          length = methodNames.length;

      if (options === false) {
        chain = false;
      } else if (isObject(options) && 'chain' in options) {
        chain = options.chain;
      }
      while (++index < length) {
        var methodName = methodNames[index],
            func = source[methodName];

        object[methodName] = func;
        if (isFunc) {
          object.prototype[methodName] = (function(func) {
            return function() {
              var chainAll = this.__chain__;
              if (chain || chainAll) {
                var result = object(this.__wrapped__);
                (result.__actions__ = arrayCopy(this.__actions__)).push({ 'func': func, 'args': arguments, 'thisArg': object });
                result.__chain__ = chainAll;
                return result;
              }
              var args = [this.value()];
              push.apply(args, arguments);
              return func.apply(object, args);
            };
          }(func));
        }
      }
      return object;
    }

    /**
     * Reverts the `_` variable to its previous value and returns a reference to
     * the `lodash` function.
     *
     * @static
     * @memberOf _
     * @category Utility
     * @returns {Function} Returns the `lodash` function.
     * @example
     *
     * var lodash = _.noConflict();
     */
    function noConflict() {
      context._ = oldDash;
      return this;
    }

    /**
     * A no-operation function which returns `undefined` regardless of the
     * arguments it receives.
     *
     * @static
     * @memberOf _
     * @category Utility
     * @example
     *
     * var object = { 'user': 'fred' };
     *
     * _.noop(object) === undefined;
     * // => true
     */
    function noop() {
      // No operation performed.
    }

    /**
     * Creates a function which returns the property value of `key` on a given object.
     *
     * @static
     * @memberOf _
     * @category Utility
     * @param {string} key The key of the property to get.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var users = [
     *   { 'user': 'fred' },
     *   { 'user': 'barney' }
     * ];
     *
     * var getName = _.property('user');
     *
     * _.map(users, getName);
     * // => ['fred', barney']
     *
     * _.pluck(_.sortBy(users, getName), 'user');
     * // => ['barney', 'fred']
     */
    function property(key) {
      return baseProperty(key + '');
    }

    /**
     * The inverse of `_.property`; this method creates a function which returns
     * the property value of a given key on `object`.
     *
     * @static
     * @memberOf _
     * @category Utility
     * @param {Object} object The object to inspect.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var object = { 'a': 3, 'b': 1, 'c': 2 };
     *
     * _.map(['a', 'c'], _.propertyOf(object));
     * // => [3, 2]
     *
     * _.sortBy(['a', 'b', 'c'], _.propertyOf(object));
     * // => ['b', 'c', 'a']
     */
    function propertyOf(object) {
      return function(key) {
        return object == null ? undefined : object[key];
      };
    }

    /**
     * Creates an array of numbers (positive and/or negative) progressing from
     * `start` up to, but not including, `end`. If `end` is not specified it is
     * set to `start` with `start` then set to `0`. If `start` is less than `end`
     * a zero-length range is created unless a negative `step` is specified.
     *
     * @static
     * @memberOf _
     * @category Utility
     * @param {number} [start=0] The start of the range.
     * @param {number} end The end of the range.
     * @param {number} [step=1] The value to increment or decrement by.
     * @returns {Array} Returns the new array of numbers.
     * @example
     *
     * _.range(4);
     * // => [0, 1, 2, 3]
     *
     * _.range(1, 5);
     * // => [1, 2, 3, 4]
     *
     * _.range(0, 20, 5);
     * // => [0, 5, 10, 15]
     *
     * _.range(0, -4, -1);
     * // => [0, -1, -2, -3]
     *
     * _.range(1, 4, 0);
     * // => [1, 1, 1]
     *
     * _.range(0);
     * // => []
     */
    function range(start, end, step) {
      if (step && isIterateeCall(start, end, step)) {
        end = step = null;
      }
      start = +start || 0;
      step = step == null ? 1 : (+step || 0);

      if (end == null) {
        end = start;
        start = 0;
      } else {
        end = +end || 0;
      }
      // Use `Array(length)` so engines like Chakra and V8 avoid slower modes.
      // See https://youtu.be/XAqIpGU8ZZk#t=17m25s for more details.
      var index = -1,
          length = nativeMax(ceil((end - start) / (step || 1)), 0),
          result = Array(length);

      while (++index < length) {
        result[index] = start;
        start += step;
      }
      return result;
    }

    /**
     * Invokes the iteratee function `n` times, returning an array of the results
     * of each invocation. The `iteratee` is bound to `thisArg` and invoked with
     * one argument; (index).
     *
     * @static
     * @memberOf _
     * @category Utility
     * @param {number} n The number of times to invoke `iteratee`.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {Array} Returns the array of results.
     * @example
     *
     * var diceRolls = _.times(3, _.partial(_.random, 1, 6, false));
     * // => [3, 6, 4]
     *
     * _.times(3, function(n) {
     *   mage.castSpell(n);
     * });
     * // => invokes `mage.castSpell(n)` three times with `n` of `0`, `1`, and `2` respectively
     *
     * _.times(3, function(n) {
     *   this.cast(n);
     * }, mage);
     * // => also invokes `mage.castSpell(n)` three times
     */
    function times(n, iteratee, thisArg) {
      n = +n;

      // Exit early to avoid a JSC JIT bug in Safari 8
      // where `Array(0)` is treated as `Array(1)`.
      if (n < 1 || !nativeIsFinite(n)) {
        return [];
      }
      var index = -1,
          result = Array(nativeMin(n, MAX_ARRAY_LENGTH));

      iteratee = bindCallback(iteratee, thisArg, 1);
      while (++index < n) {
        if (index < MAX_ARRAY_LENGTH) {
          result[index] = iteratee(index);
        } else {
          iteratee(index);
        }
      }
      return result;
    }

    /**
     * Generates a unique ID. If `prefix` is provided the ID is appended to it.
     *
     * @static
     * @memberOf _
     * @category Utility
     * @param {string} [prefix] The value to prefix the ID with.
     * @returns {string} Returns the unique ID.
     * @example
     *
     * _.uniqueId('contact_');
     * // => 'contact_104'
     *
     * _.uniqueId();
     * // => '105'
     */
    function uniqueId(prefix) {
      var id = ++idCounter;
      return baseToString(prefix) + id;
    }

    /*------------------------------------------------------------------------*/

    /**
     * Adds two numbers.
     *
     * @static
     * @memberOf _
     * @category Math
     * @param {number} augend The first number to add.
     * @param {number} addend The second number to add.
     * @returns {number} Returns the sum.
     * @example
     *
     * _.add(6, 4);
     * // => 10
     */
    function add(augend, addend) {
      return augend + addend;
    }

    /**
     * Gets the maximum value of `collection`. If `collection` is empty or falsey
     * `-Infinity` is returned. If an iteratee function is provided it is invoked
     * for each value in `collection` to generate the criterion by which the value
     * is ranked. The `iteratee` is bound to `thisArg` and invoked with three
     * arguments; (value, index, collection).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Math
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [iteratee] The function invoked per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {*} Returns the maximum value.
     * @example
     *
     * _.max([4, 2, 8, 6]);
     * // => 8
     *
     * _.max([]);
     * // => -Infinity
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36 },
     *   { 'user': 'fred',   'age': 40 }
     * ];
     *
     * _.max(users, function(chr) {
     *   return chr.age;
     * });
     * // => { 'user': 'fred', 'age': 40 };
     *
     * // using the `_.property` callback shorthand
     * _.max(users, 'age');
     * // => { 'user': 'fred', 'age': 40 };
     */
    var max = createExtremum(arrayMax);

    /**
     * Gets the minimum value of `collection`. If `collection` is empty or falsey
     * `Infinity` is returned. If an iteratee function is provided it is invoked
     * for each value in `collection` to generate the criterion by which the value
     * is ranked. The `iteratee` is bound to `thisArg` and invoked with three
     * arguments; (value, index, collection).
     *
     * If a property name is provided for `predicate` the created `_.property`
     * style callback returns the property value of the given element.
     *
     * If a value is also provided for `thisArg` the created `_.matchesProperty`
     * style callback returns `true` for elements that have a matching property
     * value, else `false`.
     *
     * If an object is provided for `predicate` the created `_.matches` style
     * callback returns `true` for elements that have the properties of the given
     * object, else `false`.
     *
     * @static
     * @memberOf _
     * @category Math
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [iteratee] The function invoked per iteration.
     * @param {*} [thisArg] The `this` binding of `iteratee`.
     * @returns {*} Returns the minimum value.
     * @example
     *
     * _.min([4, 2, 8, 6]);
     * // => 2
     *
     * _.min([]);
     * // => Infinity
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36 },
     *   { 'user': 'fred',   'age': 40 }
     * ];
     *
     * _.min(users, function(chr) {
     *   return chr.age;
     * });
     * // => { 'user': 'barney', 'age': 36 };
     *
     * // using the `_.property` callback shorthand
     * _.min(users, 'age');
     * // => { 'user': 'barney', 'age': 36 };
     */
    var min = createExtremum(arrayMin, true);

    /**
     * Gets the sum of the values in `collection`.
     *
     * @static
     * @memberOf _
     * @category Math
     * @param {Array|Object|string} collection The collection to iterate over.
     * @returns {number} Returns the sum.
     * @example
     *
     * _.sum([4, 6, 2]);
     * // => 12
     *
     * _.sum({ 'a': 4, 'b': 6, 'c': 2 });
     * // => 12
     */
    function sum(collection) {
      if (!isArray(collection)) {
        collection = toIterable(collection);
      }
      var length = collection.length,
          result = 0;

      while (length--) {
        result += +collection[length] || 0;
      }
      return result;
    }

    /*------------------------------------------------------------------------*/

    // Ensure wrappers are instances of `baseLodash`.
    lodash.prototype = baseLodash.prototype;

    LodashWrapper.prototype = baseCreate(baseLodash.prototype);
    LodashWrapper.prototype.constructor = LodashWrapper;

    LazyWrapper.prototype = baseCreate(baseLodash.prototype);
    LazyWrapper.prototype.constructor = LazyWrapper;

    // Add functions to the `Map` cache.
    MapCache.prototype['delete'] = mapDelete;
    MapCache.prototype.get = mapGet;
    MapCache.prototype.has = mapHas;
    MapCache.prototype.set = mapSet;

    // Add functions to the `Set` cache.
    SetCache.prototype.push = cachePush;

    // Assign cache to `_.memoize`.
    memoize.Cache = MapCache;

    // Add functions that return wrapped values when chaining.
    lodash.after = after;
    lodash.ary = ary;
    lodash.assign = assign;
    lodash.at = at;
    lodash.before = before;
    lodash.bind = bind;
    lodash.bindAll = bindAll;
    lodash.bindKey = bindKey;
    lodash.callback = callback;
    lodash.chain = chain;
    lodash.chunk = chunk;
    lodash.compact = compact;
    lodash.constant = constant;
    lodash.countBy = countBy;
    lodash.create = create;
    lodash.curry = curry;
    lodash.curryRight = curryRight;
    lodash.debounce = debounce;
    lodash.defaults = defaults;
    lodash.defer = defer;
    lodash.delay = delay;
    lodash.difference = difference;
    lodash.drop = drop;
    lodash.dropRight = dropRight;
    lodash.dropRightWhile = dropRightWhile;
    lodash.dropWhile = dropWhile;
    lodash.fill = fill;
    lodash.filter = filter;
    lodash.flatten = flatten;
    lodash.flattenDeep = flattenDeep;
    lodash.flow = flow;
    lodash.flowRight = flowRight;
    lodash.forEach = forEach;
    lodash.forEachRight = forEachRight;
    lodash.forIn = forIn;
    lodash.forInRight = forInRight;
    lodash.forOwn = forOwn;
    lodash.forOwnRight = forOwnRight;
    lodash.functions = functions;
    lodash.groupBy = groupBy;
    lodash.indexBy = indexBy;
    lodash.initial = initial;
    lodash.intersection = intersection;
    lodash.invert = invert;
    lodash.invoke = invoke;
    lodash.keys = keys;
    lodash.keysIn = keysIn;
    lodash.map = map;
    lodash.mapValues = mapValues;
    lodash.matches = matches;
    lodash.matchesProperty = matchesProperty;
    lodash.memoize = memoize;
    lodash.merge = merge;
    lodash.mixin = mixin;
    lodash.negate = negate;
    lodash.omit = omit;
    lodash.once = once;
    lodash.pairs = pairs;
    lodash.partial = partial;
    lodash.partialRight = partialRight;
    lodash.partition = partition;
    lodash.pick = pick;
    lodash.pluck = pluck;
    lodash.property = property;
    lodash.propertyOf = propertyOf;
    lodash.pull = pull;
    lodash.pullAt = pullAt;
    lodash.range = range;
    lodash.rearg = rearg;
    lodash.reject = reject;
    lodash.remove = remove;
    lodash.rest = rest;
    lodash.shuffle = shuffle;
    lodash.slice = slice;
    lodash.sortBy = sortBy;
    lodash.sortByAll = sortByAll;
    lodash.sortByOrder = sortByOrder;
    lodash.spread = spread;
    lodash.take = take;
    lodash.takeRight = takeRight;
    lodash.takeRightWhile = takeRightWhile;
    lodash.takeWhile = takeWhile;
    lodash.tap = tap;
    lodash.throttle = throttle;
    lodash.thru = thru;
    lodash.times = times;
    lodash.toArray = toArray;
    lodash.toPlainObject = toPlainObject;
    lodash.transform = transform;
    lodash.union = union;
    lodash.uniq = uniq;
    lodash.unzip = unzip;
    lodash.values = values;
    lodash.valuesIn = valuesIn;
    lodash.where = where;
    lodash.without = without;
    lodash.wrap = wrap;
    lodash.xor = xor;
    lodash.zip = zip;
    lodash.zipObject = zipObject;

    // Add aliases.
    lodash.backflow = flowRight;
    lodash.collect = map;
    lodash.compose = flowRight;
    lodash.each = forEach;
    lodash.eachRight = forEachRight;
    lodash.extend = assign;
    lodash.iteratee = callback;
    lodash.methods = functions;
    lodash.object = zipObject;
    lodash.select = filter;
    lodash.tail = rest;
    lodash.unique = uniq;

    // Add functions to `lodash.prototype`.
    mixin(lodash, lodash);

    /*------------------------------------------------------------------------*/

    // Add functions that return unwrapped values when chaining.
    lodash.add = add;
    lodash.attempt = attempt;
    lodash.camelCase = camelCase;
    lodash.capitalize = capitalize;
    lodash.clone = clone;
    lodash.cloneDeep = cloneDeep;
    lodash.deburr = deburr;
    lodash.endsWith = endsWith;
    lodash.escape = escape;
    lodash.escapeRegExp = escapeRegExp;
    lodash.every = every;
    lodash.find = find;
    lodash.findIndex = findIndex;
    lodash.findKey = findKey;
    lodash.findLast = findLast;
    lodash.findLastIndex = findLastIndex;
    lodash.findLastKey = findLastKey;
    lodash.findWhere = findWhere;
    lodash.first = first;
    lodash.has = has;
    lodash.identity = identity;
    lodash.includes = includes;
    lodash.indexOf = indexOf;
    lodash.inRange = inRange;
    lodash.isArguments = isArguments;
    lodash.isArray = isArray;
    lodash.isBoolean = isBoolean;
    lodash.isDate = isDate;
    lodash.isElement = isElement;
    lodash.isEmpty = isEmpty;
    lodash.isEqual = isEqual;
    lodash.isError = isError;
    lodash.isFinite = isFinite;
    lodash.isFunction = isFunction;
    lodash.isMatch = isMatch;
    lodash.isNaN = isNaN;
    lodash.isNative = isNative;
    lodash.isNull = isNull;
    lodash.isNumber = isNumber;
    lodash.isObject = isObject;
    lodash.isPlainObject = isPlainObject;
    lodash.isRegExp = isRegExp;
    lodash.isString = isString;
    lodash.isTypedArray = isTypedArray;
    lodash.isUndefined = isUndefined;
    lodash.kebabCase = kebabCase;
    lodash.last = last;
    lodash.lastIndexOf = lastIndexOf;
    lodash.max = max;
    lodash.min = min;
    lodash.noConflict = noConflict;
    lodash.noop = noop;
    lodash.now = now;
    lodash.pad = pad;
    lodash.padLeft = padLeft;
    lodash.padRight = padRight;
    lodash.parseInt = parseInt;
    lodash.random = random;
    lodash.reduce = reduce;
    lodash.reduceRight = reduceRight;
    lodash.repeat = repeat;
    lodash.result = result;
    lodash.runInContext = runInContext;
    lodash.size = size;
    lodash.snakeCase = snakeCase;
    lodash.some = some;
    lodash.sortedIndex = sortedIndex;
    lodash.sortedLastIndex = sortedLastIndex;
    lodash.startCase = startCase;
    lodash.startsWith = startsWith;
    lodash.sum = sum;
    lodash.template = template;
    lodash.trim = trim;
    lodash.trimLeft = trimLeft;
    lodash.trimRight = trimRight;
    lodash.trunc = trunc;
    lodash.unescape = unescape;
    lodash.uniqueId = uniqueId;
    lodash.words = words;

    // Add aliases.
    lodash.all = every;
    lodash.any = some;
    lodash.contains = includes;
    lodash.detect = find;
    lodash.foldl = reduce;
    lodash.foldr = reduceRight;
    lodash.head = first;
    lodash.include = includes;
    lodash.inject = reduce;

    mixin(lodash, (function() {
      var source = {};
      baseForOwn(lodash, function(func, methodName) {
        if (!lodash.prototype[methodName]) {
          source[methodName] = func;
        }
      });
      return source;
    }()), false);

    /*------------------------------------------------------------------------*/

    // Add functions capable of returning wrapped and unwrapped values when chaining.
    lodash.sample = sample;

    lodash.prototype.sample = function(n) {
      if (!this.__chain__ && n == null) {
        return sample(this.value());
      }
      return this.thru(function(value) {
        return sample(value, n);
      });
    };

    /*------------------------------------------------------------------------*/

    /**
     * The semantic version number.
     *
     * @static
     * @memberOf _
     * @type string
     */
    lodash.VERSION = VERSION;

    // Assign default placeholders.
    arrayEach(['bind', 'bindKey', 'curry', 'curryRight', 'partial', 'partialRight'], function(methodName) {
      lodash[methodName].placeholder = lodash;
    });

    // Add `LazyWrapper` methods that accept an `iteratee` value.
    arrayEach(['dropWhile', 'filter', 'map', 'takeWhile'], function(methodName, type) {
      var isFilter = type != LAZY_MAP_FLAG,
          isDropWhile = type == LAZY_DROP_WHILE_FLAG;

      LazyWrapper.prototype[methodName] = function(iteratee, thisArg) {
        var filtered = this.__filtered__,
            result = (filtered && isDropWhile) ? new LazyWrapper(this) : this.clone(),
            iteratees = result.__iteratees__ || (result.__iteratees__ = []);

        result.__filtered__ = filtered || isFilter;
        iteratees.push({ 'done': false, 'index': 0, 'iteratee': getCallback(iteratee, thisArg, 1), 'type': type });
        return result;
      };
    });

    // Add `LazyWrapper` methods for `_.drop` and `_.take` variants.
    arrayEach(['drop', 'take'], function(methodName, index) {
      var countName = '__' + methodName + 'Count__',
          whileName = methodName + 'While';

      LazyWrapper.prototype[methodName] = function(n) {
        n = n == null ? 1 : nativeMax(floor(n) || 0, 0);

        var result = this.clone();
        if (result.__filtered__) {
          var value = result[countName];
          result[countName] = index ? nativeMin(value, n) : (value + n);
        } else {
          var views = result.__views__ || (result.__views__ = []);
          views.push({ 'size': n, 'type': methodName + (result.__dir__ < 0 ? 'Right' : '') });
        }
        return result;
      };

      LazyWrapper.prototype[methodName + 'Right'] = function(n) {
        return this.reverse()[methodName](n).reverse();
      };

      LazyWrapper.prototype[methodName + 'RightWhile'] = function(predicate, thisArg) {
        return this.reverse()[whileName](predicate, thisArg).reverse();
      };
    });

    // Add `LazyWrapper` methods for `_.first` and `_.last`.
    arrayEach(['first', 'last'], function(methodName, index) {
      var takeName = 'take' + (index ? 'Right' : '');

      LazyWrapper.prototype[methodName] = function() {
        return this[takeName](1).value()[0];
      };
    });

    // Add `LazyWrapper` methods for `_.initial` and `_.rest`.
    arrayEach(['initial', 'rest'], function(methodName, index) {
      var dropName = 'drop' + (index ? '' : 'Right');

      LazyWrapper.prototype[methodName] = function() {
        return this[dropName](1);
      };
    });

    // Add `LazyWrapper` methods for `_.pluck` and `_.where`.
    arrayEach(['pluck', 'where'], function(methodName, index) {
      var operationName = index ? 'filter' : 'map',
          createCallback = index ? baseMatches : baseProperty;

      LazyWrapper.prototype[methodName] = function(value) {
        return this[operationName](createCallback(value));
      };
    });

    LazyWrapper.prototype.compact = function() {
      return this.filter(identity);
    };

    LazyWrapper.prototype.reject = function(predicate, thisArg) {
      predicate = getCallback(predicate, thisArg, 1);
      return this.filter(function(value) {
        return !predicate(value);
      });
    };

    LazyWrapper.prototype.slice = function(start, end) {
      start = start == null ? 0 : (+start || 0);
      var result = start < 0 ? this.takeRight(-start) : this.drop(start);

      if (typeof end != 'undefined') {
        end = (+end || 0);
        result = end < 0 ? result.dropRight(-end) : result.take(end - start);
      }
      return result;
    };

    LazyWrapper.prototype.toArray = function() {
      return this.drop(0);
    };

    // Add `LazyWrapper` methods to `lodash.prototype`.
    baseForOwn(LazyWrapper.prototype, function(func, methodName) {
      var lodashFunc = lodash[methodName],
          checkIteratee = /^(?:filter|map|reject)|While$/.test(methodName),
          retUnwrapped = /^(?:first|last)$/.test(methodName);

      lodash.prototype[methodName] = function() {
        var args = arguments,
            length = args.length,
            chainAll = this.__chain__,
            value = this.__wrapped__,
            isHybrid = !!this.__actions__.length,
            isLazy = value instanceof LazyWrapper;

        if (isLazy && checkIteratee) {
          // avoid lazy use if the iteratee has a `length` other than `1`
          var iteratee = args[0];
          isLazy = !(typeof iteratee == 'function' && iteratee.length != 1);
        }
        var onlyLazy = isLazy && !isHybrid;
        if (retUnwrapped && !chainAll) {
          return onlyLazy
            ? func.call(value)
            : lodashFunc.call(lodash, this.value());
        }
        var interceptor = function(value) {
          var otherArgs = [value];
          push.apply(otherArgs, args);
          return lodashFunc.apply(lodash, otherArgs);
        };
        if (isLazy || isArray(value)) {
          var wrapper = onlyLazy ? value : new LazyWrapper(this),
              result = func.apply(wrapper, args);

          if (!retUnwrapped && (isHybrid || result.__actions__)) {
            var actions = result.__actions__ || (result.__actions__ = []);
            actions.push({ 'func': thru, 'args': [interceptor], 'thisArg': lodash });
          }
          return new LodashWrapper(result, chainAll);
        }
        return this.thru(interceptor);
      };
    });

    // Add `Array.prototype` functions to `lodash.prototype`.
    arrayEach(['concat', 'join', 'pop', 'push', 'shift', 'sort', 'splice', 'unshift'], function(methodName) {
      var func = arrayProto[methodName],
          chainName = /^(?:push|sort|unshift)$/.test(methodName) ? 'tap' : 'thru',
          retUnwrapped = /^(?:join|pop|shift)$/.test(methodName);

      lodash.prototype[methodName] = function() {
        var args = arguments;
        if (retUnwrapped && !this.__chain__) {
          return func.apply(this.value(), args);
        }
        return this[chainName](function(value) {
          return func.apply(value, args);
        });
      };
    });

    // Add functions to the lazy wrapper.
    LazyWrapper.prototype.clone = lazyClone;
    LazyWrapper.prototype.reverse = lazyReverse;
    LazyWrapper.prototype.value = lazyValue;

    // Add chaining functions to the `lodash` wrapper.
    lodash.prototype.chain = wrapperChain;
    lodash.prototype.commit = wrapperCommit;
    lodash.prototype.plant = wrapperPlant;
    lodash.prototype.reverse = wrapperReverse;
    lodash.prototype.toString = wrapperToString;
    lodash.prototype.run = lodash.prototype.toJSON = lodash.prototype.valueOf = lodash.prototype.value = wrapperValue;

    // Add function aliases to the `lodash` wrapper.
    lodash.prototype.collect = lodash.prototype.map;
    lodash.prototype.head = lodash.prototype.first;
    lodash.prototype.select = lodash.prototype.filter;
    lodash.prototype.tail = lodash.prototype.rest;

    return lodash;
  }

  /*--------------------------------------------------------------------------*/

  // Export lodash.
  var _ = runInContext();

  // Some AMD build optimizers like r.js check for condition patterns like the following:
  if (typeof define == 'function' && typeof define.amd == 'object' && define.amd) {
    // Expose lodash to the global object when an AMD loader is present to avoid
    // errors in cases where lodash is loaded by a script tag and not intended
    // as an AMD module. See http://requirejs.org/docs/errors.html#mismatch for
    // more details.
    root._ = _;

    // Define as an anonymous module so, through path mapping, it can be
    // referenced as the "underscore" module.
    define(function() {
      return _;
    });
  }
  // Check for `exports` after `define` in case a build optimizer adds an `exports` object.
  else if (freeExports && freeModule) {
    // Export for Node.js or RingoJS.
    if (moduleExports) {
      (freeModule.exports = _)._ = _;
    }
    // Export for Narwhal or Rhino -require.
    else {
      freeExports._ = _;
    }
  }
  else {
    // Export for a browser or Rhino.
    root._ = _;
  }
}.call(this));
/* http://prismjs.com/download.html?themes=prism-okaidia&languages=markup+css+clike+javascript+ruby+git+haml+http+jade+json+less+markdown+php+python+sass+scss */
var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(){var e=/\blang(?:uage)?-(\w+)\b/i,t=0,n=_self.Prism={util:{encode:function(e){return e instanceof a?new a(e.type,n.util.encode(e.content),e.alias):"Array"===n.util.type(e)?e.map(n.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function(e){var t=n.util.type(e);switch(t){case"Object":var a={};for(var r in e)e.hasOwnProperty(r)&&(a[r]=n.util.clone(e[r]));return a;case"Array":return e.map&&e.map(function(e){return n.util.clone(e)})}return e}},languages:{extend:function(e,t){var a=n.util.clone(n.languages[e]);for(var r in t)a[r]=t[r];return a},insertBefore:function(e,t,a,r){r=r||n.languages;var i=r[e];if(2==arguments.length){a=arguments[1];for(var l in a)a.hasOwnProperty(l)&&(i[l]=a[l]);return i}var o={};for(var s in i)if(i.hasOwnProperty(s)){if(s==t)for(var l in a)a.hasOwnProperty(l)&&(o[l]=a[l]);o[s]=i[s]}return n.languages.DFS(n.languages,function(t,n){n===r[e]&&t!=e&&(this[t]=o)}),r[e]=o},DFS:function(e,t,a,r){r=r||{};for(var i in e)e.hasOwnProperty(i)&&(t.call(e,i,e[i],a||i),"Object"!==n.util.type(e[i])||r[n.util.objId(e[i])]?"Array"!==n.util.type(e[i])||r[n.util.objId(e[i])]||(r[n.util.objId(e[i])]=!0,n.languages.DFS(e[i],t,i,r)):(r[n.util.objId(e[i])]=!0,n.languages.DFS(e[i],t,null,r)))}},plugins:{},highlightAll:function(e,t){var a={callback:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};n.hooks.run("before-highlightall",a);for(var r,i=a.elements||document.querySelectorAll(a.selector),l=0;r=i[l++];)n.highlightElement(r,e===!0,a.callback)},highlightElement:function(t,a,r){for(var i,l,o=t;o&&!e.test(o.className);)o=o.parentNode;o&&(i=(o.className.match(e)||[,""])[1].toLowerCase(),l=n.languages[i]),t.className=t.className.replace(e,"").replace(/\s+/g," ")+" language-"+i,o=t.parentNode,/pre/i.test(o.nodeName)&&(o.className=o.className.replace(e,"").replace(/\s+/g," ")+" language-"+i);var s=t.textContent,u={element:t,language:i,grammar:l,code:s};if(n.hooks.run("before-sanity-check",u),!u.code||!u.grammar)return n.hooks.run("complete",u),void 0;if(n.hooks.run("before-highlight",u),a&&_self.Worker){var g=new Worker(n.filename);g.onmessage=function(e){u.highlightedCode=e.data,n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(u.element),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},g.postMessage(JSON.stringify({language:u.language,code:u.code,immediateClose:!0}))}else u.highlightedCode=n.highlight(u.code,u.grammar,u.language),n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(t),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},highlight:function(e,t,r){var i=n.tokenize(e,t);return a.stringify(n.util.encode(i),r)},tokenize:function(e,t){var a=n.Token,r=[e],i=t.rest;if(i){for(var l in i)t[l]=i[l];delete t.rest}e:for(var l in t)if(t.hasOwnProperty(l)&&t[l]){var o=t[l];o="Array"===n.util.type(o)?o:[o];for(var s=0;s<o.length;++s){var u=o[s],g=u.inside,c=!!u.lookbehind,h=!!u.greedy,f=0,d=u.alias;if(h&&!u.pattern.global){var p=u.pattern.toString().match(/[imuy]*$/)[0];u.pattern=RegExp(u.pattern.source,p+"g")}u=u.pattern||u;for(var m=0,y=0;m<r.length;y+=r[m].length,++m){var v=r[m];if(r.length>e.length)break e;if(!(v instanceof a)){u.lastIndex=0;var b=u.exec(v),k=1;if(!b&&h&&m!=r.length-1){if(u.lastIndex=y,b=u.exec(e),!b)break;for(var w=b.index+(c?b[1].length:0),_=b.index+b[0].length,A=m,P=y,j=r.length;j>A&&_>P;++A)P+=r[A].length,w>=P&&(++m,y=P);if(r[m]instanceof a||r[A-1].greedy)continue;k=A-m,v=e.slice(y,P),b.index-=y}if(b){c&&(f=b[1].length);var w=b.index+f,b=b[0].slice(f),_=w+b.length,O=v.slice(0,w),x=v.slice(_),S=[m,k];O&&S.push(O);var N=new a(l,g?n.tokenize(b,g):b,d,b,h);S.push(N),x&&S.push(x),Array.prototype.splice.apply(r,S)}}}}}return r},hooks:{all:{},add:function(e,t){var a=n.hooks.all;a[e]=a[e]||[],a[e].push(t)},run:function(e,t){var a=n.hooks.all[e];if(a&&a.length)for(var r,i=0;r=a[i++];)r(t)}}},a=n.Token=function(e,t,n,a,r){this.type=e,this.content=t,this.alias=n,this.length=0|(a||"").length,this.greedy=!!r};if(a.stringify=function(e,t,r){if("string"==typeof e)return e;if("Array"===n.util.type(e))return e.map(function(n){return a.stringify(n,t,e)}).join("");var i={type:e.type,content:a.stringify(e.content,t,r),tag:"span",classes:["token",e.type],attributes:{},language:t,parent:r};if("comment"==i.type&&(i.attributes.spellcheck="true"),e.alias){var l="Array"===n.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(i.classes,l)}n.hooks.run("wrap",i);var o=Object.keys(i.attributes).map(function(e){return e+'="'+(i.attributes[e]||"").replace(/"/g,"&quot;")+'"'}).join(" ");return"<"+i.tag+' class="'+i.classes.join(" ")+'"'+(o?" "+o:"")+">"+i.content+"</"+i.tag+">"},!_self.document)return _self.addEventListener?(_self.addEventListener("message",function(e){var t=JSON.parse(e.data),a=t.language,r=t.code,i=t.immediateClose;_self.postMessage(n.highlight(r,n.languages[a],a)),i&&_self.close()},!1),_self.Prism):_self.Prism;var r=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();return r&&(n.filename=r.src,document.addEventListener&&!r.hasAttribute("data-manual")&&("loading"!==document.readyState?window.requestAnimationFrame?window.requestAnimationFrame(n.highlightAll):window.setTimeout(n.highlightAll,16):document.addEventListener("DOMContentLoaded",n.highlightAll))),_self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism);
Prism.languages.markup={comment:/<!--[\w\W]*?-->/,prolog:/<\?[\w\W]+?\?>/,doctype:/<!DOCTYPE[\w\W]+?>/i,cdata:/<!\[CDATA\[[\w\W]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=$<]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\\1|\\?(?!\1)[\w\W])*\1|[^\s'">=]+))?)*\s*\/?>/i,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=(?:('|")[\w\W]*?(\1)|[^\s>]+)/i,inside:{punctuation:/[=>"']/}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:/&#?[\da-z]{1,8};/i},Prism.hooks.add("wrap",function(a){"entity"===a.type&&(a.attributes.title=a.content.replace(/&amp;/,"&"))}),Prism.languages.xml=Prism.languages.markup,Prism.languages.html=Prism.languages.markup,Prism.languages.mathml=Prism.languages.markup,Prism.languages.svg=Prism.languages.markup;
Prism.languages.css={comment:/\/\*[\w\W]*?\*\//,atrule:{pattern:/@[\w-]+?.*?(;|(?=\s*\{))/i,inside:{rule:/@[\w-]+/}},url:/url\((?:(["'])(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1|.*?)\)/i,selector:/[^\{\}\s][^\{\};]*?(?=\s*\{)/,string:{pattern:/("|')(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1/,greedy:!0},property:/(\b|\B)[\w-]+(?=\s*:)/i,important:/\B!important\b/i,"function":/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:]/},Prism.languages.css.atrule.inside.rest=Prism.util.clone(Prism.languages.css),Prism.languages.markup&&(Prism.languages.insertBefore("markup","tag",{style:{pattern:/(<style[\w\W]*?>)[\w\W]*?(?=<\/style>)/i,lookbehind:!0,inside:Prism.languages.css,alias:"language-css"}}),Prism.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/\s*style=("|').*?\1/i,inside:{"attr-name":{pattern:/^\s*style/i,inside:Prism.languages.markup.tag.inside},punctuation:/^\s*=\s*['"]|['"]\s*$/,"attr-value":{pattern:/.+/i,inside:Prism.languages.css}},alias:"language-css"}},Prism.languages.markup.tag));
Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\w\W]*?\*\//,lookbehind:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0}],string:{pattern:/(["'])(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/((?:\b(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[a-z0-9_\.\\]+/i,lookbehind:!0,inside:{punctuation:/(\.|\\)/}},keyword:/\b(if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,"boolean":/\b(true|false)\b/,"function":/[a-z0-9_]+(?=\()/i,number:/\b-?(?:0x[\da-f]+|\d*\.?\d+(?:e[+-]?\d+)?)\b/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/};
Prism.languages.javascript=Prism.languages.extend("clike",{keyword:/\b(as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/,number:/\b-?(0x[\dA-Fa-f]+|0b[01]+|0o[0-7]+|\d*\.?\d+([Ee][+-]?\d+)?|NaN|Infinity)\b/,"function":/[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*(?=\()/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*\*?|\/|~|\^|%|\.{3}/}),Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^\/])\/(?!\/)(\[.+?]|\\.|[^\/\\\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\\\|\\?[^\\])*?`/,greedy:!0,inside:{interpolation:{pattern:/\$\{[^}]+\}/,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}}}),Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{script:{pattern:/(<script[\w\W]*?>)[\w\W]*?(?=<\/script>)/i,lookbehind:!0,inside:Prism.languages.javascript,alias:"language-javascript"}}),Prism.languages.js=Prism.languages.javascript;
!function(e){e.languages.ruby=e.languages.extend("clike",{comment:/#(?!\{[^\r\n]*?\}).*/,keyword:/\b(alias|and|BEGIN|begin|break|case|class|def|define_method|defined|do|each|else|elsif|END|end|ensure|false|for|if|in|module|new|next|nil|not|or|raise|redo|require|rescue|retry|return|self|super|then|throw|true|undef|unless|until|when|while|yield)\b/});var n={pattern:/#\{[^}]+\}/,inside:{delimiter:{pattern:/^#\{|\}$/,alias:"tag"},rest:e.util.clone(e.languages.ruby)}};e.languages.insertBefore("ruby","keyword",{regex:[{pattern:/%r([^a-zA-Z0-9\s\{\(\[<])(?:[^\\]|\\[\s\S])*?\1[gim]{0,3}/,inside:{interpolation:n}},{pattern:/%r\((?:[^()\\]|\\[\s\S])*\)[gim]{0,3}/,inside:{interpolation:n}},{pattern:/%r\{(?:[^#{}\\]|#(?:\{[^}]+\})?|\\[\s\S])*\}[gim]{0,3}/,inside:{interpolation:n}},{pattern:/%r\[(?:[^\[\]\\]|\\[\s\S])*\][gim]{0,3}/,inside:{interpolation:n}},{pattern:/%r<(?:[^<>\\]|\\[\s\S])*>[gim]{0,3}/,inside:{interpolation:n}},{pattern:/(^|[^\/])\/(?!\/)(\[.+?]|\\.|[^\/\r\n])+\/[gim]{0,3}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0}],variable:/[@$]+[a-zA-Z_][a-zA-Z_0-9]*(?:[?!]|\b)/,symbol:/:[a-zA-Z_][a-zA-Z_0-9]*(?:[?!]|\b)/}),e.languages.insertBefore("ruby","number",{builtin:/\b(Array|Bignum|Binding|Class|Continuation|Dir|Exception|FalseClass|File|Stat|File|Fixnum|Float|Hash|Integer|IO|MatchData|Method|Module|NilClass|Numeric|Object|Proc|Range|Regexp|String|Struct|TMS|Symbol|ThreadGroup|Thread|Time|TrueClass)\b/,constant:/\b[A-Z][a-zA-Z_0-9]*(?:[?!]|\b)/}),e.languages.ruby.string=[{pattern:/%[qQiIwWxs]?([^a-zA-Z0-9\s\{\(\[<])(?:[^\\]|\\[\s\S])*?\1/,greedy:!0,inside:{interpolation:n}},{pattern:/%[qQiIwWxs]?\((?:[^()\\]|\\[\s\S])*\)/,greedy:!0,inside:{interpolation:n}},{pattern:/%[qQiIwWxs]?\{(?:[^#{}\\]|#(?:\{[^}]+\})?|\\[\s\S])*\}/,greedy:!0,inside:{interpolation:n}},{pattern:/%[qQiIwWxs]?\[(?:[^\[\]\\]|\\[\s\S])*\]/,greedy:!0,inside:{interpolation:n}},{pattern:/%[qQiIwWxs]?<(?:[^<>\\]|\\[\s\S])*>/,greedy:!0,inside:{interpolation:n}},{pattern:/("|')(#\{[^}]+\}|\\(?:\r?\n|\r)|\\?.)*?\1/,greedy:!0,inside:{interpolation:n}}]}(Prism);
Prism.languages.git={comment:/^#.*/m,deleted:/^[-–].*/m,inserted:/^\+.*/m,string:/("|')(\\?.)*?\1/m,command:{pattern:/^.*\$ git .*$/m,inside:{parameter:/\s(--|-)\w+/m}},coord:/^@@.*@@$/m,commit_sha1:/^commit \w{40}$/m};
!function(e){e.languages.haml={"multiline-comment":{pattern:/((?:^|\r?\n|\r)([\t ]*))(?:\/|-#).*((?:\r?\n|\r)\2[\t ]+.+)*/,lookbehind:!0,alias:"comment"},"multiline-code":[{pattern:/((?:^|\r?\n|\r)([\t ]*)(?:[~-]|[&!]?=)).*,[\t ]*((?:\r?\n|\r)\2[\t ]+.*,[\t ]*)*((?:\r?\n|\r)\2[\t ]+.+)/,lookbehind:!0,inside:{rest:e.languages.ruby}},{pattern:/((?:^|\r?\n|\r)([\t ]*)(?:[~-]|[&!]?=)).*\|[\t ]*((?:\r?\n|\r)\2[\t ]+.*\|[\t ]*)*/,lookbehind:!0,inside:{rest:e.languages.ruby}}],filter:{pattern:/((?:^|\r?\n|\r)([\t ]*)):[\w-]+((?:\r?\n|\r)(?:\2[\t ]+.+|\s*?(?=\r?\n|\r)))+/,lookbehind:!0,inside:{"filter-name":{pattern:/^:[\w-]+/,alias:"variable"}}},markup:{pattern:/((?:^|\r?\n|\r)[\t ]*)<.+/,lookbehind:!0,inside:{rest:e.languages.markup}},doctype:{pattern:/((?:^|\r?\n|\r)[\t ]*)!!!(?: .+)?/,lookbehind:!0},tag:{pattern:/((?:^|\r?\n|\r)[\t ]*)[%.#][\w\-#.]*[\w\-](?:\([^)]+\)|\{(?:\{[^}]+\}|[^}])+\}|\[[^\]]+\])*[\/<>]*/,lookbehind:!0,inside:{attributes:[{pattern:/(^|[^#])\{(?:\{[^}]+\}|[^}])+\}/,lookbehind:!0,inside:{rest:e.languages.ruby}},{pattern:/\([^)]+\)/,inside:{"attr-value":{pattern:/(=\s*)(?:"(?:\\?.)*?"|[^)\s]+)/,lookbehind:!0},"attr-name":/[\w:-]+(?=\s*!?=|\s*[,)])/,punctuation:/[=(),]/}},{pattern:/\[[^\]]+\]/,inside:{rest:e.languages.ruby}}],punctuation:/[<>]/}},code:{pattern:/((?:^|\r?\n|\r)[\t ]*(?:[~-]|[&!]?=)).+/,lookbehind:!0,inside:{rest:e.languages.ruby}},interpolation:{pattern:/#\{[^}]+\}/,inside:{delimiter:{pattern:/^#\{|\}$/,alias:"punctuation"},rest:e.languages.ruby}},punctuation:{pattern:/((?:^|\r?\n|\r)[\t ]*)[~=\-&!]+/,lookbehind:!0}};for(var t="((?:^|\\r?\\n|\\r)([\\t ]*)):{{filter_name}}((?:\\r?\\n|\\r)(?:\\2[\\t ]+.+|\\s*?(?=\\r?\\n|\\r)))+",r=["css",{filter:"coffee",language:"coffeescript"},"erb","javascript","less","markdown","ruby","scss","textile"],n={},a=0,i=r.length;i>a;a++){var l=r[a];l="string"==typeof l?{filter:l,language:l}:l,e.languages[l.language]&&(n["filter-"+l.filter]={pattern:RegExp(t.replace("{{filter_name}}",l.filter)),lookbehind:!0,inside:{"filter-name":{pattern:/^:[\w-]+/,alias:"variable"},rest:e.languages[l.language]}})}e.languages.insertBefore("haml","filter",n)}(Prism);
Prism.languages.http={"request-line":{pattern:/^(POST|GET|PUT|DELETE|OPTIONS|PATCH|TRACE|CONNECT)\b\shttps?:\/\/\S+\sHTTP\/[0-9.]+/m,inside:{property:/^(POST|GET|PUT|DELETE|OPTIONS|PATCH|TRACE|CONNECT)\b/,"attr-name":/:\w+/}},"response-status":{pattern:/^HTTP\/1.[01] [0-9]+.*/m,inside:{property:{pattern:/(^HTTP\/1.[01] )[0-9]+.*/i,lookbehind:!0}}},"header-name":{pattern:/^[\w-]+:(?=.)/m,alias:"keyword"}};var httpLanguages={"application/json":Prism.languages.javascript,"application/xml":Prism.languages.markup,"text/xml":Prism.languages.markup,"text/html":Prism.languages.markup};for(var contentType in httpLanguages)if(httpLanguages[contentType]){var options={};options[contentType]={pattern:new RegExp("(content-type:\\s*"+contentType+"[\\w\\W]*?)(?:\\r?\\n|\\r){2}[\\w\\W]*","i"),lookbehind:!0,inside:{rest:httpLanguages[contentType]}},Prism.languages.insertBefore("http","header-name",options)};
!function(e){e.languages.jade={comment:{pattern:/(^([\t ]*))\/\/.*((?:\r?\n|\r)\2[\t ]+.+)*/m,lookbehind:!0},"multiline-script":{pattern:/(^([\t ]*)script\b.*\.[\t ]*)((?:\r?\n|\r(?!\n))(?:\2[\t ]+.+|\s*?(?=\r?\n|\r)))+/m,lookbehind:!0,inside:{rest:e.languages.javascript}},filter:{pattern:/(^([\t ]*)):.+((?:\r?\n|\r(?!\n))(?:\2[\t ]+.+|\s*?(?=\r?\n|\r)))+/m,lookbehind:!0,inside:{"filter-name":{pattern:/^:[\w-]+/,alias:"variable"}}},"multiline-plain-text":{pattern:/(^([\t ]*)[\w\-#.]+\.[\t ]*)((?:\r?\n|\r(?!\n))(?:\2[\t ]+.+|\s*?(?=\r?\n|\r)))+/m,lookbehind:!0},markup:{pattern:/(^[\t ]*)<.+/m,lookbehind:!0,inside:{rest:e.languages.markup}},doctype:{pattern:/((?:^|\n)[\t ]*)doctype(?: .+)?/,lookbehind:!0},"flow-control":{pattern:/(^[\t ]*)(?:if|unless|else|case|when|default|each|while)\b(?: .+)?/m,lookbehind:!0,inside:{each:{pattern:/^each .+? in\b/,inside:{keyword:/\b(?:each|in)\b/,punctuation:/,/}},branch:{pattern:/^(?:if|unless|else|case|when|default|while)\b/,alias:"keyword"},rest:e.languages.javascript}},keyword:{pattern:/(^[\t ]*)(?:block|extends|include|append|prepend)\b.+/m,lookbehind:!0},mixin:[{pattern:/(^[\t ]*)mixin .+/m,lookbehind:!0,inside:{keyword:/^mixin/,"function":/\w+(?=\s*\(|\s*$)/,punctuation:/[(),.]/}},{pattern:/(^[\t ]*)\+.+/m,lookbehind:!0,inside:{name:{pattern:/^\+\w+/,alias:"function"},rest:e.languages.javascript}}],script:{pattern:/(^[\t ]*script(?:(?:&[^(]+)?\([^)]+\))*[\t ]+).+/m,lookbehind:!0,inside:{rest:e.languages.javascript}},"plain-text":{pattern:/(^[\t ]*(?!-)[\w\-#.]*[\w\-](?:(?:&[^(]+)?\([^)]+\))*\/?[\t ]+).+/m,lookbehind:!0},tag:{pattern:/(^[\t ]*)(?!-)[\w\-#.]*[\w\-](?:(?:&[^(]+)?\([^)]+\))*\/?:?/m,lookbehind:!0,inside:{attributes:[{pattern:/&[^(]+\([^)]+\)/,inside:{rest:e.languages.javascript}},{pattern:/\([^)]+\)/,inside:{"attr-value":{pattern:/(=\s*)(?:\{[^}]*\}|[^,)\r\n]+)/,lookbehind:!0,inside:{rest:e.languages.javascript}},"attr-name":/[\w-]+(?=\s*!?=|\s*[,)])/,punctuation:/[!=(),]+/}}],punctuation:/:/}},code:[{pattern:/(^[\t ]*(?:-|!?=)).+/m,lookbehind:!0,inside:{rest:e.languages.javascript}}],punctuation:/[.\-!=|]+/};for(var t="(^([\\t ]*)):{{filter_name}}((?:\\r?\\n|\\r(?!\\n))(?:\\2[\\t ]+.+|\\s*?(?=\\r?\\n|\\r)))+",n=[{filter:"atpl",language:"twig"},{filter:"coffee",language:"coffeescript"},"ejs","handlebars","hogan","less","livescript","markdown","mustache","plates",{filter:"sass",language:"scss"},"stylus","swig"],a={},i=0,r=n.length;r>i;i++){var s=n[i];s="string"==typeof s?{filter:s,language:s}:s,e.languages[s.language]&&(a["filter-"+s.filter]={pattern:RegExp(t.replace("{{filter_name}}",s.filter),"m"),lookbehind:!0,inside:{"filter-name":{pattern:/^:[\w-]+/,alias:"variable"},rest:e.languages[s.language]}})}e.languages.insertBefore("jade","filter",a)}(Prism);
Prism.languages.json={property:/"(?:\\.|[^|"])*"(?=\s*:)/gi,string:/"(?!:)(?:\\.|[^|"])*"(?!:)/g,number:/\b-?(0x[\dA-Fa-f]+|\d*\.?\d+([Ee][+-]?\d+)?)\b/g,punctuation:/[{}[\]);,]/g,operator:/:/g,"boolean":/\b(true|false)\b/gi,"null":/\bnull\b/gi},Prism.languages.jsonp=Prism.languages.json;
Prism.languages.less=Prism.languages.extend("css",{comment:[/\/\*[\w\W]*?\*\//,{pattern:/(^|[^\\])\/\/.*/,lookbehind:!0}],atrule:{pattern:/@[\w-]+?(?:\([^{}]+\)|[^(){};])*?(?=\s*\{)/i,inside:{punctuation:/[:()]/}},selector:{pattern:/(?:@\{[\w-]+\}|[^{};\s@])(?:@\{[\w-]+\}|\([^{}]*\)|[^{};@])*?(?=\s*\{)/,inside:{variable:/@+[\w-]+/}},property:/(?:@\{[\w-]+\}|[\w-])+(?:\+_?)?(?=\s*:)/i,punctuation:/[{}();:,]/,operator:/[+\-*\/]/}),Prism.languages.insertBefore("less","punctuation",{"function":Prism.languages.less.function}),Prism.languages.insertBefore("less","property",{variable:[{pattern:/@[\w-]+\s*:/,inside:{punctuation:/:/}},/@@?[\w-]+/],"mixin-usage":{pattern:/([{;]\s*)[.#](?!\d)[\w-]+.*?(?=[(;])/,lookbehind:!0,alias:"function"}});
Prism.languages.markdown=Prism.languages.extend("markup",{}),Prism.languages.insertBefore("markdown","prolog",{blockquote:{pattern:/^>(?:[\t ]*>)*/m,alias:"punctuation"},code:[{pattern:/^(?: {4}|\t).+/m,alias:"keyword"},{pattern:/``.+?``|`[^`\n]+`/,alias:"keyword"}],title:[{pattern:/\w+.*(?:\r?\n|\r)(?:==+|--+)/,alias:"important",inside:{punctuation:/==+$|--+$/}},{pattern:/(^\s*)#+.+/m,lookbehind:!0,alias:"important",inside:{punctuation:/^#+|#+$/}}],hr:{pattern:/(^\s*)([*-])([\t ]*\2){2,}(?=\s*$)/m,lookbehind:!0,alias:"punctuation"},list:{pattern:/(^\s*)(?:[*+-]|\d+\.)(?=[\t ].)/m,lookbehind:!0,alias:"punctuation"},"url-reference":{pattern:/!?\[[^\]]+\]:[\t ]+(?:\S+|<(?:\\.|[^>\\])+>)(?:[\t ]+(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\)))?/,inside:{variable:{pattern:/^(!?\[)[^\]]+/,lookbehind:!0},string:/(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\))$/,punctuation:/^[\[\]!:]|[<>]/},alias:"url"},bold:{pattern:/(^|[^\\])(\*\*|__)(?:(?:\r?\n|\r)(?!\r?\n|\r)|.)+?\2/,lookbehind:!0,inside:{punctuation:/^\*\*|^__|\*\*$|__$/}},italic:{pattern:/(^|[^\\])([*_])(?:(?:\r?\n|\r)(?!\r?\n|\r)|.)+?\2/,lookbehind:!0,inside:{punctuation:/^[*_]|[*_]$/}},url:{pattern:/!?\[[^\]]+\](?:\([^\s)]+(?:[\t ]+"(?:\\.|[^"\\])*")?\)| ?\[[^\]\n]*\])/,inside:{variable:{pattern:/(!?\[)[^\]]+(?=\]$)/,lookbehind:!0},string:{pattern:/"(?:\\.|[^"\\])*"(?=\)$)/}}}}),Prism.languages.markdown.bold.inside.url=Prism.util.clone(Prism.languages.markdown.url),Prism.languages.markdown.italic.inside.url=Prism.util.clone(Prism.languages.markdown.url),Prism.languages.markdown.bold.inside.italic=Prism.util.clone(Prism.languages.markdown.italic),Prism.languages.markdown.italic.inside.bold=Prism.util.clone(Prism.languages.markdown.bold);
Prism.languages.php=Prism.languages.extend("clike",{keyword:/\b(and|or|xor|array|as|break|case|cfunction|class|const|continue|declare|default|die|do|else|elseif|enddeclare|endfor|endforeach|endif|endswitch|endwhile|extends|for|foreach|function|include|include_once|global|if|new|return|static|switch|use|require|require_once|var|while|abstract|interface|public|implements|private|protected|parent|throw|null|echo|print|trait|namespace|final|yield|goto|instanceof|finally|try|catch)\b/i,constant:/\b[A-Z0-9_]{2,}\b/,comment:{pattern:/(^|[^\\])(?:\/\*[\w\W]*?\*\/|\/\/.*)/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("php","class-name",{"shell-comment":{pattern:/(^|[^\\])#.*/,lookbehind:!0,alias:"comment"}}),Prism.languages.insertBefore("php","keyword",{delimiter:/\?>|<\?(?:php)?/i,variable:/\$\w+\b/i,"package":{pattern:/(\\|namespace\s+|use\s+)[\w\\]+/,lookbehind:!0,inside:{punctuation:/\\/}}}),Prism.languages.insertBefore("php","operator",{property:{pattern:/(->)[\w]+/,lookbehind:!0}}),Prism.languages.markup&&(Prism.hooks.add("before-highlight",function(e){"php"===e.language&&(e.tokenStack=[],e.backupCode=e.code,e.code=e.code.replace(/(?:<\?php|<\?)[\w\W]*?(?:\?>)/gi,function(a){return e.tokenStack.push(a),"{{{PHP"+e.tokenStack.length+"}}}"}))}),Prism.hooks.add("before-insert",function(e){"php"===e.language&&(e.code=e.backupCode,delete e.backupCode)}),Prism.hooks.add("after-highlight",function(e){if("php"===e.language){for(var a,n=0;a=e.tokenStack[n];n++)e.highlightedCode=e.highlightedCode.replace("{{{PHP"+(n+1)+"}}}",Prism.highlight(a,e.grammar,"php").replace(/\$/g,"$$$$"));e.element.innerHTML=e.highlightedCode}}),Prism.hooks.add("wrap",function(e){"php"===e.language&&"markup"===e.type&&(e.content=e.content.replace(/(\{\{\{PHP[0-9]+\}\}\})/g,'<span class="token php">$1</span>'))}),Prism.languages.insertBefore("php","comment",{markup:{pattern:/<[^?]\/?(.*?)>/,inside:Prism.languages.markup},php:/\{\{\{PHP[0-9]+\}\}\}/}));
Prism.languages.python={"triple-quoted-string":{pattern:/"""[\s\S]+?"""|'''[\s\S]+?'''/,alias:"string"},comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0},string:{pattern:/("|')(?:\\\\|\\?[^\\\r\n])*?\1/,greedy:!0},"function":{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_][a-zA-Z0-9_]*(?=\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)[a-z0-9_]+/i,lookbehind:!0},keyword:/\b(?:as|assert|async|await|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|pass|print|raise|return|try|while|with|yield)\b/,"boolean":/\b(?:True|False)\b/,number:/\b-?(?:0[bo])?(?:(?:\d|0x[\da-f])[\da-f]*\.?\d*|\.\d+)(?:e[+-]?\d+)?j?\b/i,operator:/[-+%=]=?|!=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]|\b(?:or|and|not)\b/,punctuation:/[{}[\];(),.:]/};
!function(e){e.languages.sass=e.languages.extend("css",{comment:{pattern:/^([ \t]*)\/[\/*].*(?:(?:\r?\n|\r)\1[ \t]+.+)*/m,lookbehind:!0}}),e.languages.insertBefore("sass","atrule",{"atrule-line":{pattern:/^(?:[ \t]*)[@+=].+/m,inside:{atrule:/(?:@[\w-]+|[+=])/m}}}),delete e.languages.sass.atrule;var a=/((\$[-_\w]+)|(#\{\$[-_\w]+\}))/i,t=[/[+*\/%]|[=!]=|<=?|>=?|\b(?:and|or|not)\b/,{pattern:/(\s+)-(?=\s)/,lookbehind:!0}];e.languages.insertBefore("sass","property",{"variable-line":{pattern:/^[ \t]*\$.+/m,inside:{punctuation:/:/,variable:a,operator:t}},"property-line":{pattern:/^[ \t]*(?:[^:\s]+ *:.*|:[^:\s]+.*)/m,inside:{property:[/[^:\s]+(?=\s*:)/,{pattern:/(:)[^:\s]+/,lookbehind:!0}],punctuation:/:/,variable:a,operator:t,important:e.languages.sass.important}}}),delete e.languages.sass.property,delete e.languages.sass.important,delete e.languages.sass.selector,e.languages.insertBefore("sass","punctuation",{selector:{pattern:/([ \t]*)\S(?:,?[^,\r\n]+)*(?:,(?:\r?\n|\r)\1[ \t]+\S(?:,?[^,\r\n]+)*)*/,lookbehind:!0}})}(Prism);
Prism.languages.scss=Prism.languages.extend("css",{comment:{pattern:/(^|[^\\])(?:\/\*[\w\W]*?\*\/|\/\/.*)/,lookbehind:!0},atrule:{pattern:/@[\w-]+(?:\([^()]+\)|[^(])*?(?=\s+[{;])/,inside:{rule:/@[\w-]+/}},url:/(?:[-a-z]+-)*url(?=\()/i,selector:{pattern:/(?=\S)[^@;\{\}\(\)]?([^@;\{\}\(\)]|&|#\{\$[-_\w]+\})+(?=\s*\{(\}|\s|[^\}]+(:|\{)[^\}]+))/m,inside:{parent:{pattern:/&/,alias:"important"},placeholder:/%[-_\w]+/,variable:/\$[-_\w]+|#\{\$[-_\w]+\}/}}}),Prism.languages.insertBefore("scss","atrule",{keyword:[/@(?:if|else(?: if)?|for|each|while|import|extend|debug|warn|mixin|include|function|return|content)/i,{pattern:/( +)(?:from|through)(?= )/,lookbehind:!0}]}),Prism.languages.scss.property={pattern:/(?:[\w-]|\$[-_\w]+|#\{\$[-_\w]+\})+(?=\s*:)/i,inside:{variable:/\$[-_\w]+|#\{\$[-_\w]+\}/}},Prism.languages.insertBefore("scss","important",{variable:/\$[-_\w]+|#\{\$[-_\w]+\}/}),Prism.languages.insertBefore("scss","function",{placeholder:{pattern:/%[-_\w]+/,alias:"selector"},statement:{pattern:/\B!(?:default|optional)\b/i,alias:"keyword"},"boolean":/\b(?:true|false)\b/,"null":/\bnull\b/,operator:{pattern:/(\s)(?:[-+*\/%]|[=!]=|<=?|>=?|and|or|not)(?=\s)/,lookbehind:!0}}),Prism.languages.scss.atrule.inside.rest=Prism.util.clone(Prism.languages.scss);

;(function () {
  var root = this || Function('return this')();
/**
 * Shifty Core
 * By Jeremy Kahn - jeremyckahn@gmail.com
 */

var Tweenable = (function () {

  'use strict';

  var nextId = 1;
  var schedulingActivated = false;
  var activeTweenables = { };

  function animateTweens() {
    for (var id in activeTweenables) {
      activeTweenables[id]._timeoutHandler();
    }
    requestAnimationFrame(animateTweens);
  }
  animateTweens();

  // Aliases that get defined later in this function
  var formula;

  // CONSTANTS
  var DEFAULT_SCHEDULE_FUNCTION;
  var DEFAULT_EASING = 'linear';
  var DEFAULT_DURATION = 500;
  var UPDATE_TIME = 1000 / 60;

  var _now = Date.now
       ? Date.now
       : function () {return +new Date();};

  var now = typeof SHIFTY_DEBUG_NOW !== 'undefined' ? SHIFTY_DEBUG_NOW : _now;

  if (typeof window !== 'undefined') {
    // requestAnimationFrame() shim by Paul Irish (modified for Shifty)
    // http://paulirish.com/2011/requestanimationframe-for-smart-animating/
    DEFAULT_SCHEDULE_FUNCTION = window.requestAnimationFrame
       || window.webkitRequestAnimationFrame
       || window.oRequestAnimationFrame
       || window.msRequestAnimationFrame
       || (window.mozCancelRequestAnimationFrame
       && window.mozRequestAnimationFrame)
       || setTimeout;
  } else {
    DEFAULT_SCHEDULE_FUNCTION = setTimeout;
  }

  function noop () {
    // NOOP!
  }

  /**
   * Handy shortcut for doing a for-in loop. This is not a "normal" each
   * function, it is optimized for Shifty.  The iterator function only receives
   * the property name, not the value.
   * @param {Object} obj
   * @param {Function(string)} fn
   * @private
   */
  function each (obj, fn) {
    var key;
    for (key in obj) {
      if (Object.hasOwnProperty.call(obj, key)) {
        fn(key);
      }
    }
  }

  /**
   * Perform a shallow copy of Object properties.
   * @param {Object} targetObject The object to copy into
   * @param {Object} srcObject The object to copy from
   * @return {Object} A reference to the augmented `targetObj` Object
   * @private
   */
  function shallowCopy (targetObj, srcObj) {
    each(srcObj, function (prop) {
      targetObj[prop] = srcObj[prop];
    });

    return targetObj;
  }

  /**
   * Copies each property from src onto target, but only if the property to
   * copy to target is undefined.
   * @param {Object} target Missing properties in this Object are filled in
   * @param {Object} src
   * @private
   */
  function defaults (target, src) {
    each(src, function (prop) {
      if (typeof target[prop] === 'undefined') {
        target[prop] = src[prop];
      }
    });
  }

  /**
   * Calculates the interpolated tween values of an Object for a given
   * timestamp.
   * @param {Number} forPosition The position to compute the state for.
   * @param {Object} currentState Current state properties.
   * @param {Object} originalState: The original state properties the Object is
   * tweening from.
   * @param {Object} targetState: The destination state properties the Object
   * is tweening to.
   * @param {number} duration: The length of the tween in milliseconds.
   * @param {number} timestamp: The UNIX epoch time at which the tween began.
   * @param {Object} easing: This Object's keys must correspond to the keys in
   * targetState.
   * @private
   */
  function tweenProps (forPosition, currentState, originalState, targetState,
    duration, timestamp, easing) {
    var normalizedPosition =
        forPosition < timestamp ? 0 : (forPosition - timestamp) / duration;


    var prop;
    var easingObjectProp;
    var easingFn;
    for (prop in currentState) {
      if (currentState.hasOwnProperty(prop)) {
        easingObjectProp = easing[prop];
        easingFn = typeof easingObjectProp === 'function'
          ? easingObjectProp
          : formula[easingObjectProp];

        currentState[prop] = tweenProp(
          originalState[prop],
          targetState[prop],
          easingFn,
          normalizedPosition
        );
      }
    }

    return currentState;
  }

  /**
   * Tweens a single property.
   * @param {number} start The value that the tween started from.
   * @param {number} end The value that the tween should end at.
   * @param {Function} easingFunc The easing curve to apply to the tween.
   * @param {number} position The normalized position (between 0.0 and 1.0) to
   * calculate the midpoint of 'start' and 'end' against.
   * @return {number} The tweened value.
   * @private
   */
  function tweenProp (start, end, easingFunc, position) {
    return start + (end - start) * easingFunc(position);
  }

  /**
   * Applies a filter to Tweenable instance.
   * @param {Tweenable} tweenable The `Tweenable` instance to call the filter
   * upon.
   * @param {String} filterName The name of the filter to apply.
   * @private
   */
  function applyFilter (tweenable, filterName) {
    var filters = Tweenable.prototype.filter;
    var args = tweenable._filterArgs;

    each(filters, function (name) {
      if (typeof filters[name][filterName] !== 'undefined') {
        filters[name][filterName].apply(tweenable, args);
      }
    });
  }

  var timeoutHandler_endTime;
  var timeoutHandler_currentTime;
  var timeoutHandler_isEnded;
  var timeoutHandler_offset;
  /**
   * Handles the update logic for one step of a tween.
   * @param {Tweenable} tweenable
   * @param {number} timestamp
   * @param {number} delay
   * @param {number} duration
   * @param {Object} currentState
   * @param {Object} originalState
   * @param {Object} targetState
   * @param {Object} easing
   * @param {Function(Object, *, number)} step
   * @param {Function(Function,number)}} schedule
   * @param {number=} opt_currentTimeOverride Needed for accurate timestamp in
   * Tweenable#seek.
   * @private
   */
  function timeoutHandler (tweenable, timestamp, delay, duration, currentState,
    originalState, targetState, easing, step, schedule,
    opt_currentTimeOverride) {

    timeoutHandler_endTime = timestamp + delay + duration;

    timeoutHandler_currentTime =
    Math.min(opt_currentTimeOverride || now(), timeoutHandler_endTime);

    timeoutHandler_isEnded =
      timeoutHandler_currentTime >= timeoutHandler_endTime;

    timeoutHandler_offset = duration - (
      timeoutHandler_endTime - timeoutHandler_currentTime);

    if (tweenable.isPlaying()) {
      if (timeoutHandler_isEnded) {
        step(targetState, tweenable._attachment, timeoutHandler_offset);
        tweenable.stop(true);
      } else {
        // tweenable._scheduleId =
        //   schedule(tweenable._timeoutHandler, UPDATE_TIME);

        applyFilter(tweenable, 'beforeTween');

        // If the animation has not yet reached the start point (e.g., there was
        // delay that has not yet completed), just interpolate the starting
        // position of the tween.
        if (timeoutHandler_currentTime < (timestamp + delay)) {
          tweenProps(1, currentState, originalState, targetState, 1, 1, easing);
        } else {
          tweenProps(timeoutHandler_currentTime, currentState, originalState,
            targetState, duration, timestamp + delay, easing);
        }

        applyFilter(tweenable, 'afterTween');

        step(currentState, tweenable._attachment, timeoutHandler_offset);
      }
    }
  }


  /**
   * Creates a usable easing Object from a string, a function or another easing
   * Object.  If `easing` is an Object, then this function clones it and fills
   * in the missing properties with `"linear"`.
   * @param {Object.<string|Function>} fromTweenParams
   * @param {Object|string|Function} easing
   * @return {Object.<string|Function>}
   * @private
   */
  function composeEasingObject (fromTweenParams, easing) {
    var composedEasing = {};
    var typeofEasing = typeof easing;

    if (typeofEasing === 'string' || typeofEasing === 'function') {
      each(fromTweenParams, function (prop) {
        composedEasing[prop] = easing;
      });
    } else {
      each(fromTweenParams, function (prop) {
        if (!composedEasing[prop]) {
          composedEasing[prop] = easing[prop] || DEFAULT_EASING;
        }
      });
    }

    return composedEasing;
  }

  /**
   * Tweenable constructor.
   * @class Tweenable
   * @param {Object=} opt_initialState The values that the initial tween should
   * start at if a `from` object is not provided to `{{#crossLink
   * "Tweenable/tween:method"}}{{/crossLink}}` or `{{#crossLink
   * "Tweenable/setConfig:method"}}{{/crossLink}}`.
   * @param {Object=} opt_config Configuration object to be passed to
   * `{{#crossLink "Tweenable/setConfig:method"}}{{/crossLink}}`.
   * @module Tweenable
   * @constructor
   */
  function Tweenable (opt_initialState, opt_config) {
    this._currentState = opt_initialState || {};
    this._configured = false;
    this._scheduleFunction = DEFAULT_SCHEDULE_FUNCTION;
    this._id = 'id' + nextId++;

    // To prevent unnecessary calls to setConfig do not set default
    // configuration here.  Only set default configuration immediately before
    // tweening if none has been set.
    if (typeof opt_config !== 'undefined') {
      this.setConfig(opt_config);
    }
  }

  /**
   * Configure and start a tween.
   * @method tween
   * @param {Object=} opt_config Configuration object to be passed to
   * `{{#crossLink "Tweenable/setConfig:method"}}{{/crossLink}}`.
   * @chainable
   */
  Tweenable.prototype.tween = function (opt_config) {
    if (this._isTweening) {
      return this;
    }

    // Only set default config if no configuration has been set previously and
    // none is provided now.
    if (opt_config !== undefined || !this._configured) {
      this.setConfig(opt_config);
    }

    this._timestamp = now();
    this._start(this.get(), this._attachment);
    return this.resume();
  };

  /**
   * Configure a tween that will start at some point in the future.
   *
   * @method setConfig
   * @param {Object} config The following values are valid:
   * - __from__ (_Object=_): Starting position.  If omitted, `{{#crossLink
   *   "Tweenable/get:method"}}get(){{/crossLink}}` is used.
   * - __to__ (_Object=_): Ending position.
   * - __duration__ (_number=_): How many milliseconds to animate for.
   * - __delay__ (_delay=_): How many milliseconds to wait before starting the
   *   tween.
   * - __start__ (_Function(Object, *)_): Function to execute when the tween
   *   begins.  Receives the state of the tween as the first parameter and
   *   `attachment` as the second parameter.
   * - __step__ (_Function(Object, *, number)_): Function to execute on every
   *   tick.  Receives `{{#crossLink
   *   "Tweenable/get:method"}}get(){{/crossLink}}` as the first parameter,
   *   `attachment` as the second parameter, and the time elapsed since the
   *   start of the tween as the third. This function is not called on the
   *   final step of the animation, but `finish` is.
   * - __finish__ (_Function(Object, *)_): Function to execute upon tween
   *   completion.  Receives the state of the tween as the first parameter and
   *   `attachment` as the second parameter.
   * - __easing__ (_Object.<string|Function>|string|Function=_): Easing curve
   *   name(s) or function(s) to use for the tween.
   * - __attachment__ (_*_): Cached value that is passed to the
   *   `step`/`start`/`finish` methods.
   * @chainable
   */
  Tweenable.prototype.setConfig = function (config) {
    config = config || {};
    this._configured = true;

    // Attach something to this Tweenable instance (e.g.: a DOM element, an
    // object, a string, etc.);
    this._attachment = config.attachment;

    // Init the internal state
    this._pausedAtTime = null;
    this._scheduleId = null;
    this._delay = config.delay || 0;
    this._start = config.start || noop;
    this._step = config.step || noop;
    this._finish = config.finish || noop;
    this._duration = config.duration || DEFAULT_DURATION;
    this._currentState = shallowCopy({}, config.from) || this.get();
    this._originalState = this.get();
    this._targetState = shallowCopy({}, config.to) || this.get();

    var self = this;
    this._timeoutHandler = function () {
      timeoutHandler(self,
        self._timestamp,
        self._delay,
        self._duration,
        self._currentState,
        self._originalState,
        self._targetState,
        self._easing,
        self._step,
        self._scheduleFunction
      );
    };

    // Aliases used below
    var currentState = this._currentState;
    var targetState = this._targetState;

    // Ensure that there is always something to tween to.
    defaults(targetState, currentState);

    this._easing = composeEasingObject(
      currentState, config.easing || DEFAULT_EASING);

    this._filterArgs =
      [currentState, this._originalState, targetState, this._easing];

    applyFilter(this, 'tweenCreated');
    return this;
  };

  /**
   * @method get
   * @return {Object} The current state.
   */
  Tweenable.prototype.get = function () {
    return shallowCopy({}, this._currentState);
  };

  /**
   * @method set
   * @param {Object} state The current state.
   */
  Tweenable.prototype.set = function (state) {
    this._currentState = state;
  };

  /**
   * Pause a tween.  Paused tweens can be resumed from the point at which they
   * were paused.  This is different from `{{#crossLink
   * "Tweenable/stop:method"}}{{/crossLink}}`, as that method
   * causes a tween to start over when it is resumed.
   * @method pause
   * @chainable
   */
  Tweenable.prototype.pause = function () {
    this._pausedAtTime = now();
    this._isPaused = true;
    return this;
  };

  /**
   * Resume a paused tween.
   * @method resume
   * @chainable
   */
  Tweenable.prototype.resume = function () {
    if (this._isPaused) {
      this._timestamp += now() - this._pausedAtTime;
    }

    this._isPaused = false;
    this._isTweening = true;

    activeTweenables[this._id] = this;
    this._timeoutHandler();

    return this;
  };

  /**
   * Move the state of the animation to a specific point in the tween's
   * timeline.  If the animation is not running, this will cause the `step`
   * handlers to be called.
   * @method seek
   * @param {millisecond} millisecond The millisecond of the animation to seek
   * to.  This must not be less than `0`.
   * @chainable
   */
  Tweenable.prototype.seek = function (millisecond) {
    millisecond = Math.max(millisecond, 0);
    var currentTime = now();

    if ((this._timestamp + millisecond) === 0) {
      return this;
    }

    this._timestamp = currentTime - millisecond;

    if (!this.isPlaying()) {
      this._isTweening = true;
      this._isPaused = false;

      // If the animation is not running, call timeoutHandler to make sure that
      // any step handlers are run.
      timeoutHandler(this,
        this._timestamp,
        this._delay,
        this._duration,
        this._currentState,
        this._originalState,
        this._targetState,
        this._easing,
        this._step,
        this._scheduleFunction,
        currentTime
      );

      this.pause();
    }

    return this;
  };

  /**
   * Stops and cancels a tween.
   * @param {boolean=} gotoEnd If `false` or omitted, the tween just stops at
   * its current state, and the `finish` handler is not invoked.  If `true`,
   * the tweened object's values are instantly set to the target values, and
   * `finish` is invoked.
   * @method stop
   * @chainable
   */
  Tweenable.prototype.stop = function (gotoEnd) {
    this._isTweening = false;
    this._isPaused = false;
    this._timeoutHandler = noop;
    delete activeTweenables[this._id];

    (root.cancelAnimationFrame            ||
    root.webkitCancelAnimationFrame     ||
    root.oCancelAnimationFrame          ||
    root.msCancelAnimationFrame         ||
    root.mozCancelRequestAnimationFrame ||
    root.clearTimeout)(this._scheduleId);

    if (gotoEnd) {
      applyFilter(this, 'beforeTween');
      tweenProps(
        1,
        this._currentState,
        this._originalState,
        this._targetState,
        1,
        0,
        this._easing
      );
      applyFilter(this, 'afterTween');
      applyFilter(this, 'afterTweenEnd');
      this._finish.call(this, this._currentState, this._attachment);
    }

    return this;
  };

  /**
   * @method isPlaying
   * @return {boolean} Whether or not a tween is running.
   */
  Tweenable.prototype.isPlaying = function () {
    return this._isTweening && !this._isPaused;
  };

  /**
   * Set a custom schedule function.
   *
   * If a custom function is not set,
   * [`requestAnimationFrame`](https://developer.mozilla.org/en-US/docs/Web/API/window.requestAnimationFrame)
   * is used if available, otherwise
   * [`setTimeout`](https://developer.mozilla.org/en-US/docs/Web/API/Window.setTimeout)
   * is used.
   * @method setScheduleFunction
   * @param {Function(Function,number)} scheduleFunction The function to be
   * used to schedule the next frame to be rendered.
   */
  Tweenable.prototype.setScheduleFunction = function (scheduleFunction) {
    this._scheduleFunction = scheduleFunction;
  };

  /**
   * `delete` all "own" properties.  Call this when the `Tweenable` instance
   * is no longer needed to free memory.
   * @method dispose
   */
  Tweenable.prototype.dispose = function () {
    var prop;
    for (prop in this) {
      if (this.hasOwnProperty(prop)) {
        delete this[prop];
      }
    }
  };

  /**
   * Filters are used for transforming the properties of a tween at various
   * points in a Tweenable's life cycle.  See the README for more info on this.
   * @private
   */
  Tweenable.prototype.filter = {};

  /**
   * This object contains all of the tweens available to Shifty.  It is
   * extensible - simply attach properties to the `Tweenable.prototype.formula`
   * Object following the same format as `linear`.
   *
   * `pos` should be a normalized `number` (between 0 and 1).
   * @property formula
   * @type {Object(function)}
   */
  Tweenable.prototype.formula = {
    linear: function (pos) {
      return pos;
    }
  };

  formula = Tweenable.prototype.formula;

  shallowCopy(Tweenable, {
    'now': now
    ,'each': each
    ,'tweenProps': tweenProps
    ,'tweenProp': tweenProp
    ,'applyFilter': applyFilter
    ,'shallowCopy': shallowCopy
    ,'defaults': defaults
    ,'composeEasingObject': composeEasingObject
  });

  // `root` is provided in the intro/outro files.

  // A hook used for unit testing.
  if (typeof SHIFTY_DEBUG_NOW === 'function') {
    root.timeoutHandler = timeoutHandler;
  }

  // Bootstrap Tweenable appropriately for the environment.
  if (typeof exports === 'object') {
    // CommonJS
    module.exports = Tweenable;
  } else if (typeof define === 'function' && define.amd) {
    // AMD
    define(function () {return Tweenable;});
  } else if (typeof root.Tweenable === 'undefined') {
    // Browser: Make `Tweenable` globally accessible.
    root.Tweenable = Tweenable;
  }

  return Tweenable;

} ());


/*!
 * All equations are adapted from Thomas Fuchs'
 * [Scripty2](https://github.com/madrobby/scripty2/blob/master/src/effects/transitions/penner.js).
 *
 * Based on Easing Equations (c) 2003 [Robert
 * Penner](http://www.robertpenner.com/), all rights reserved. This work is
 * [subject to terms](http://www.robertpenner.com/easing_terms_of_use.html).
 */

/*!
 *  TERMS OF USE - EASING EQUATIONS
 *  Open source under the BSD License.
 *  Easing Equations (c) 2003 Robert Penner, all rights reserved.
 */

;(function () {

  Tweenable.shallowCopy(Tweenable.prototype.formula, {
    easeInQuad: function (pos) {
      return Math.pow(pos, 2);
    },

    easeOutQuad: function (pos) {
      return -(Math.pow((pos - 1), 2) - 1);
    },

    easeInOutQuad: function (pos) {
      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,2);}
      return -0.5 * ((pos -= 2) * pos - 2);
    },

    easeInCubic: function (pos) {
      return Math.pow(pos, 3);
    },

    easeOutCubic: function (pos) {
      return (Math.pow((pos - 1), 3) + 1);
    },

    easeInOutCubic: function (pos) {
      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,3);}
      return 0.5 * (Math.pow((pos - 2),3) + 2);
    },

    easeInQuart: function (pos) {
      return Math.pow(pos, 4);
    },

    easeOutQuart: function (pos) {
      return -(Math.pow((pos - 1), 4) - 1);
    },

    easeInOutQuart: function (pos) {
      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,4);}
      return -0.5 * ((pos -= 2) * Math.pow(pos,3) - 2);
    },

    easeInQuint: function (pos) {
      return Math.pow(pos, 5);
    },

    easeOutQuint: function (pos) {
      return (Math.pow((pos - 1), 5) + 1);
    },

    easeInOutQuint: function (pos) {
      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,5);}
      return 0.5 * (Math.pow((pos - 2),5) + 2);
    },

    easeInSine: function (pos) {
      return -Math.cos(pos * (Math.PI / 2)) + 1;
    },

    easeOutSine: function (pos) {
      return Math.sin(pos * (Math.PI / 2));
    },

    easeInOutSine: function (pos) {
      return (-0.5 * (Math.cos(Math.PI * pos) - 1));
    },

    easeInExpo: function (pos) {
      return (pos === 0) ? 0 : Math.pow(2, 10 * (pos - 1));
    },

    easeOutExpo: function (pos) {
      return (pos === 1) ? 1 : -Math.pow(2, -10 * pos) + 1;
    },

    easeInOutExpo: function (pos) {
      if (pos === 0) {return 0;}
      if (pos === 1) {return 1;}
      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(2,10 * (pos - 1));}
      return 0.5 * (-Math.pow(2, -10 * --pos) + 2);
    },

    easeInCirc: function (pos) {
      return -(Math.sqrt(1 - (pos * pos)) - 1);
    },

    easeOutCirc: function (pos) {
      return Math.sqrt(1 - Math.pow((pos - 1), 2));
    },

    easeInOutCirc: function (pos) {
      if ((pos /= 0.5) < 1) {return -0.5 * (Math.sqrt(1 - pos * pos) - 1);}
      return 0.5 * (Math.sqrt(1 - (pos -= 2) * pos) + 1);
    },

    easeOutBounce: function (pos) {
      if ((pos) < (1 / 2.75)) {
        return (7.5625 * pos * pos);
      } else if (pos < (2 / 2.75)) {
        return (7.5625 * (pos -= (1.5 / 2.75)) * pos + 0.75);
      } else if (pos < (2.5 / 2.75)) {
        return (7.5625 * (pos -= (2.25 / 2.75)) * pos + 0.9375);
      } else {
        return (7.5625 * (pos -= (2.625 / 2.75)) * pos + 0.984375);
      }
    },

    easeInBack: function (pos) {
      var s = 1.70158;
      return (pos) * pos * ((s + 1) * pos - s);
    },

    easeOutBack: function (pos) {
      var s = 1.70158;
      return (pos = pos - 1) * pos * ((s + 1) * pos + s) + 1;
    },

    easeInOutBack: function (pos) {
      var s = 1.70158;
      if ((pos /= 0.5) < 1) {
        return 0.5 * (pos * pos * (((s *= (1.525)) + 1) * pos - s));
      }
      return 0.5 * ((pos -= 2) * pos * (((s *= (1.525)) + 1) * pos + s) + 2);
    },


    elastic: function (pos) {
      // jshint maxlen:90
      return -1 * Math.pow(4,-8 * pos) * Math.sin((pos * 6 - 1) * (2 * Math.PI) / 2) + 1;
    },
    easeInElastic: function easeInElasticFunc(pos) {
      var p = 0.3;
      pos = 1 - pos;
      return 1 - (Math.pow(2,-10*pos) * Math.sin((pos-p/4)*(2*Math.PI)/p) + 1);
    },
    easeOutElastic: function easeOutElasticFunc(pos) {
      var p = 0.3;
      return Math.pow(2,-10*pos) * Math.sin((pos-p/4)*(2*Math.PI)/p) + 1;
    },
    easeInOutElastic:function (pos) {
      if (pos < 0.5) {
        pos = 2*pos
        return easeInElasticFunc(pos)/2;
      }
      pos = 2*(1-pos)
      return 1- easeInElasticFunc(pos)/2

    },

    swingFromTo: function (pos) {
      var s = 1.70158;
      return ((pos /= 0.5) < 1) ?
          0.5 * (pos * pos * (((s *= (1.525)) + 1) * pos - s)) :
          0.5 * ((pos -= 2) * pos * (((s *= (1.525)) + 1) * pos + s) + 2);
    },

    swingFrom: function (pos) {
      var s = 1.70158;
      return pos * pos * ((s + 1) * pos - s);
    },

    swingTo: function (pos) {
      var s = 1.70158;
      return (pos -= 1) * pos * ((s + 1) * pos + s) + 1;
    },

    bounce: function (pos) {
      if (pos < (1 / 2.75)) {
        return (7.5625 * pos * pos);
      } else if (pos < (2 / 2.75)) {
        return (7.5625 * (pos -= (1.5 / 2.75)) * pos + 0.75);
      } else if (pos < (2.5 / 2.75)) {
        return (7.5625 * (pos -= (2.25 / 2.75)) * pos + 0.9375);
      } else {
        return (7.5625 * (pos -= (2.625 / 2.75)) * pos + 0.984375);
      }
    },
    easeOutBounce: function (pos) {
      if (pos < (1 / 2.75)) {
        return (7.5625 * pos * pos);
      } else if (pos < (2 / 2.75)) {
        return (7.5625 * (pos -= (1.5 / 2.75)) * pos + 0.75);
      } else if (pos < (2.5 / 2.75)) {
        return (7.5625 * (pos -= (2.25 / 2.75)) * pos + 0.9375);
      } else {
        return (7.5625 * (pos -= (2.625 / 2.75)) * pos + 0.984375);
      }
    },
    easeInBounce: function (pos) {
      pos = 1-pos;
      return 1 - easeOutBounceFunc(pos);
    },
    easeInBounceReverse: function (pos) {
      return easeOutBounceFunc(1-pos);
    },
    easeInOutBounce: function(pos) {
      if (pos < 0.5) {
        pos = 2*pos
        return easeInBounceFunc(pos)/2;
      }
      pos = 2*(1-pos)
      return 1- easeInBounceFunc(pos)/2

      // return 1 - (1-easeOutBounceFunc((1-pos)*2)/2;
    },

    bouncePast: function (pos) {
      if (pos < (1 / 2.75)) {
        return (7.5625 * pos * pos);
      } else if (pos < (2 / 2.75)) {
        return 2 - (7.5625 * (pos -= (1.5 / 2.75)) * pos + 0.75);
      } else if (pos < (2.5 / 2.75)) {
        return 2 - (7.5625 * (pos -= (2.25 / 2.75)) * pos + 0.9375);
      } else {
        return 2 - (7.5625 * (pos -= (2.625 / 2.75)) * pos + 0.984375);
      }
    },

    easeFromTo: function (pos) {
      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,4);}
      return -0.5 * ((pos -= 2) * Math.pow(pos,3) - 2);
    },

    easeFrom: function (pos) {
      return Math.pow(pos,4);
    },

    easeTo: function (pos) {
      return Math.pow(pos,0.25);
    }
  });

}());

function easeOutBounceFunc(pos) {
    if (pos < (1 / 2.75)) {
      return (7.5625 * pos * pos);
    } else if (pos < (2 / 2.75)) {
      return (7.5625 * (pos -= (1.5 / 2.75)) * pos + 0.75);
    } else if (pos < (2.5 / 2.75)) {
      return (7.5625 * (pos -= (2.25 / 2.75)) * pos + 0.9375);
    } else {
      return (7.5625 * (pos -= (2.625 / 2.75)) * pos + 0.984375);
    }
}

function easeInBounceFunc(pos) {
      pos = 1-pos;
      return 1 - easeOutBounceFunc(pos);
}

function easeOutElasticFunc(pos) {
  var p = 0.3;
  return Math.pow(2,-10*pos) * Math.sin((pos-p/4)*(2*Math.PI)/p) + 1;
}

function easeInElasticFunc(pos) {
      var p = 0.3;
      pos = 1 - pos;
      return 1 - (Math.pow(2,-10*pos) * Math.sin((pos-p/4)*(2*Math.PI)/p) + 1);
}

// jshint maxlen:100
/**
 * The Bezier magic in this file is adapted/copied almost wholesale from
 * [Scripty2](https://github.com/madrobby/scripty2/blob/master/src/effects/transitions/cubic-bezier.js),
 * which was adapted from Apple code (which probably came from
 * [here](http://opensource.apple.com/source/WebCore/WebCore-955.66/platform/graphics/UnitBezier.h)).
 * Special thanks to Apple and Thomas Fuchs for much of this code.
 */

/**
 *  Copyright (c) 2006 Apple Computer, Inc. All rights reserved.
 *
 *  Redistribution and use in source and binary forms, with or without
 *  modification, are permitted provided that the following conditions are met:
 *
 *  1. Redistributions of source code must retain the above copyright notice,
 *  this list of conditions and the following disclaimer.
 *
 *  2. Redistributions in binary form must reproduce the above copyright notice,
 *  this list of conditions and the following disclaimer in the documentation
 *  and/or other materials provided with the distribution.
 *
 *  3. Neither the name of the copyright holder(s) nor the names of any
 *  contributors may be used to endorse or promote products derived from
 *  this software without specific prior written permission.
 *
 *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 *  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 *  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 *  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 *  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 *  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 *  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 *  POSSIBILITY OF SUCH DAMAGE.
 */
;(function () {
  // port of webkit cubic bezier handling by http://www.netzgesta.de/dev/
  function cubicBezierAtTime(t,p1x,p1y,p2x,p2y,duration) {
    var ax = 0,bx = 0,cx = 0,ay = 0,by = 0,cy = 0;
    function sampleCurveX(t) {
      return ((ax * t + bx) * t + cx) * t;
    }
    function sampleCurveY(t) {
      return ((ay * t + by) * t + cy) * t;
    }
    function sampleCurveDerivativeX(t) {
      return (3.0 * ax * t + 2.0 * bx) * t + cx;
    }
    function solveEpsilon(duration) {
      return 1.0 / (200.0 * duration);
    }
    function solve(x,epsilon) {
      return sampleCurveY(solveCurveX(x, epsilon));
    }
    function fabs(n) {
      if (n >= 0) {
        return n;
      } else {
        return 0 - n;
      }
    }
    function solveCurveX(x, epsilon) {
      var t0,t1,t2,x2,d2,i;
      for (t2 = x, i = 0; i < 8; i++) {
        x2 = sampleCurveX(t2) - x;
        if (fabs(x2) < epsilon) {
          return t2;
        }
        d2 = sampleCurveDerivativeX(t2);
        if (fabs(d2) < 1e-6) {
          break;
        }
        t2 = t2 - x2 / d2;
      }
      t0 = 0.0;
      t1 = 1.0;
      t2 = x;
      if (t2 < t0) {
        return t0;
      }
      if (t2 > t1) {
        return t1;
      }
      while (t0 < t1) {
        x2 = sampleCurveX(t2);
        if (fabs(x2 - x) < epsilon) {
          return t2;
        }
        if (x > x2) {
          t0 = t2;
        }else {
          t1 = t2;
        }
        t2 = (t1 - t0) * 0.5 + t0;
      }
      return t2; // Failure.
    }
    cx = 3.0 * p1x;
    bx = 3.0 * (p2x - p1x) - cx;
    ax = 1.0 - cx - bx;
    cy = 3.0 * p1y;
    by = 3.0 * (p2y - p1y) - cy;
    ay = 1.0 - cy - by;
    return solve(t, solveEpsilon(duration));
  }
  /**
   *  getCubicBezierTransition(x1, y1, x2, y2) -> Function
   *
   *  Generates a transition easing function that is compatible
   *  with WebKit's CSS transitions `-webkit-transition-timing-function`
   *  CSS property.
   *
   *  The W3C has more information about CSS3 transition timing functions:
   *  http://www.w3.org/TR/css3-transitions/#transition-timing-function_tag
   *
   *  @param {number} x1
   *  @param {number} y1
   *  @param {number} x2
   *  @param {number} y2
   *  @return {function}
   *  @private
   */
  function getCubicBezierTransition (x1, y1, x2, y2) {
    return function (pos) {
      return cubicBezierAtTime(pos,x1,y1,x2,y2,1);
    };
  }
  // End ported code

  /**
   * Create a Bezier easing function and attach it to `{{#crossLink
   * "Tweenable/formula:property"}}Tweenable#formula{{/crossLink}}`.  This
   * function gives you total control over the easing curve.  Matthew Lein's
   * [Ceaser](http://matthewlein.com/ceaser/) is a useful tool for visualizing
   * the curves you can make with this function.
   * @method setBezierFunction
   * @param {string} name The name of the easing curve.  Overwrites the old
   * easing function on `{{#crossLink
   * "Tweenable/formula:property"}}Tweenable#formula{{/crossLink}}` if it
   * exists.
   * @param {number} x1
   * @param {number} y1
   * @param {number} x2
   * @param {number} y2
   * @return {function} The easing function that was attached to
   * Tweenable.prototype.formula.
   */
  Tweenable.setBezierFunction = function (name, x1, y1, x2, y2) {
    var cubicBezierTransition = getCubicBezierTransition(x1, y1, x2, y2);
    cubicBezierTransition.displayName = name;
    cubicBezierTransition.x1 = x1;
    cubicBezierTransition.y1 = y1;
    cubicBezierTransition.x2 = x2;
    cubicBezierTransition.y2 = y2;

    return Tweenable.prototype.formula[name] = cubicBezierTransition;
  };


  /**
   * `delete` an easing function from `{{#crossLink
   * "Tweenable/formula:property"}}Tweenable#formula{{/crossLink}}`.  Be
   * careful with this method, as it `delete`s whatever easing formula matches
   * `name` (which means you can delete standard Shifty easing functions).
   * @method unsetBezierFunction
   * @param {string} name The name of the easing function to delete.
   * @return {function}
   */
  Tweenable.unsetBezierFunction = function (name) {
    delete Tweenable.prototype.formula[name];
  };

})();

;(function () {

  function getInterpolatedValues (
    from, current, targetState, position, easing, delay) {
    return Tweenable.tweenProps(
      position, current, from, targetState, 1, delay, easing);
  }

  // Fake a Tweenable and patch some internals.  This approach allows us to
  // skip uneccessary processing and object recreation, cutting down on garbage
  // collection pauses.
  var mockTweenable = new Tweenable();
  mockTweenable._filterArgs = [];

  /**
   * Compute the midpoint of two Objects.  This method effectively calculates a
   * specific frame of animation that `{{#crossLink
   * "Tweenable/tween:method"}}{{/crossLink}}` does many times over the course
   * of a full tween.
   *
   *     var interpolatedValues = Tweenable.interpolate({
   *       width: '100px',
   *       opacity: 0,
   *       color: '#fff'
   *     }, {
   *       width: '200px',
   *       opacity: 1,
   *       color: '#000'
   *     }, 0.5);
   *
   *     console.log(interpolatedValues);
   *     // {opacity: 0.5, width: "150px", color: "rgb(127,127,127)"}
   *
   * @static
   * @method interpolate
   * @param {Object} from The starting values to tween from.
   * @param {Object} targetState The ending values to tween to.
   * @param {number} position The normalized position value (between `0.0` and
   * `1.0`) to interpolate the values between `from` and `to` for.  `from`
   * represents `0` and `to` represents `1`.
   * @param {Object.<string|Function>|string|Function} easing The easing
   * curve(s) to calculate the midpoint against.  You can reference any easing
   * function attached to `Tweenable.prototype.formula`, or provide the easing
   * function(s) directly.  If omitted, this defaults to "linear".
   * @param {number=} opt_delay Optional delay to pad the beginning of the
   * interpolated tween with.  This increases the range of `position` from (`0`
   * through `1`) to (`0` through `1 + opt_delay`).  So, a delay of `0.5` would
   * increase all valid values of `position` to numbers between `0` and `1.5`.
   * @return {Object}
   */
  Tweenable.interpolate = function (
    from, targetState, position, easing, opt_delay) {

    var current = Tweenable.shallowCopy({}, from);
    var delay = opt_delay || 0;
    var easingObject = Tweenable.composeEasingObject(
      from, easing || 'linear');

    mockTweenable.set({});

    // Alias and reuse the _filterArgs array instead of recreating it.
    var filterArgs = mockTweenable._filterArgs;
    filterArgs.length = 0;
    filterArgs[0] = current;
    filterArgs[1] = from;
    filterArgs[2] = targetState;
    filterArgs[3] = easingObject;

    // Any defined value transformation must be applied
    Tweenable.applyFilter(mockTweenable, 'tweenCreated');
    Tweenable.applyFilter(mockTweenable, 'beforeTween');

    var interpolatedValues = getInterpolatedValues(
      from, current, targetState, position, easingObject, delay);

    // Transform values back into their original format
    Tweenable.applyFilter(mockTweenable, 'afterTween');

    return interpolatedValues;
  };

}());

/**
 * This module adds string interpolation support to Shifty.
 *
 * The Token extension allows Shifty to tween numbers inside of strings.  Among
 * other things, this allows you to animate CSS properties.  For example, you
 * can do this:
 *
 *     var tweenable = new Tweenable();
 *     tweenable.tween({
 *       from: { transform: 'translateX(45px)' },
 *       to: { transform: 'translateX(90xp)' }
 *     });
 *
 * `translateX(45)` will be tweened to `translateX(90)`.  To demonstrate:
 *
 *     var tweenable = new Tweenable();
 *     tweenable.tween({
 *       from: { transform: 'translateX(45px)' },
 *       to: { transform: 'translateX(90px)' },
 *       step: function (state) {
 *         console.log(state.transform);
 *       }
 *     });
 *
 * The above snippet will log something like this in the console:
 *
 *     translateX(60.3px)
 *     ...
 *     translateX(76.05px)
 *     ...
 *     translateX(90px)
 *
 * Another use for this is animating colors:
 *
 *     var tweenable = new Tweenable();
 *     tweenable.tween({
 *       from: { color: 'rgb(0,255,0)' },
 *       to: { color: 'rgb(255,0,255)' },
 *       step: function (state) {
 *         console.log(state.color);
 *       }
 *     });
 *
 * The above snippet will log something like this:
 *
 *     rgb(84,170,84)
 *     ...
 *     rgb(170,84,170)
 *     ...
 *     rgb(255,0,255)
 *
 * This extension also supports hexadecimal colors, in both long (`#ff00ff`)
 * and short (`#f0f`) forms.  Be aware that hexadecimal input values will be
 * converted into the equivalent RGB output values.  This is done to optimize
 * for performance.
 *
 *     var tweenable = new Tweenable();
 *     tweenable.tween({
 *       from: { color: '#0f0' },
 *       to: { color: '#f0f' },
 *       step: function (state) {
 *         console.log(state.color);
 *       }
 *     });
 *
 * This snippet will generate the same output as the one before it because
 * equivalent values were supplied (just in hexadecimal form rather than RGB):
 *
 *     rgb(84,170,84)
 *     ...
 *     rgb(170,84,170)
 *     ...
 *     rgb(255,0,255)
 *
 * ## Easing support
 *
 * Easing works somewhat differently in the Token extension.  This is because
 * some CSS properties have multiple values in them, and you might need to
 * tween each value along its own easing curve.  A basic example:
 *
 *     var tweenable = new Tweenable();
 *     tweenable.tween({
 *       from: { transform: 'translateX(0px) translateY(0px)' },
 *       to: { transform:   'translateX(100px) translateY(100px)' },
 *       easing: { transform: 'easeInQuad' },
 *       step: function (state) {
 *         console.log(state.transform);
 *       }
 *     });
 *
 * The above snippet will create values like this:
 *
 *     translateX(11.56px) translateY(11.56px)
 *     ...
 *     translateX(46.24px) translateY(46.24px)
 *     ...
 *     translateX(100px) translateY(100px)
 *
 * In this case, the values for `translateX` and `translateY` are always the
 * same for each step of the tween, because they have the same start and end
 * points and both use the same easing curve.  We can also tween `translateX`
 * and `translateY` along independent curves:
 *
 *     var tweenable = new Tweenable();
 *     tweenable.tween({
 *       from: { transform: 'translateX(0px) translateY(0px)' },
 *       to: { transform:   'translateX(100px) translateY(100px)' },
 *       easing: { transform: 'easeInQuad bounce' },
 *       step: function (state) {
 *         console.log(state.transform);
 *       }
 *     });
 *
 * The above snippet will create values like this:
 *
 *     translateX(10.89px) translateY(82.35px)
 *     ...
 *     translateX(44.89px) translateY(86.73px)
 *     ...
 *     translateX(100px) translateY(100px)
 *
 * `translateX` and `translateY` are not in sync anymore, because `easeInQuad`
 * was specified for `translateX` and `bounce` for `translateY`.  Mixing and
 * matching easing curves can make for some interesting motion in your
 * animations.
 *
 * The order of the space-separated easing curves correspond the token values
 * they apply to.  If there are more token values than easing curves listed,
 * the last easing curve listed is used.
 * @submodule Tweenable.token
 */

// token function is defined above only so that dox-foundation sees it as
// documentation and renders it.  It is never used, and is optimized away at
// build time.

;(function (Tweenable) {

  /**
   * @typedef {{
   *   formatString: string
   *   chunkNames: Array.<string>
   * }}
   * @private
   */
  var formatManifest;

  // CONSTANTS

  var R_NUMBER_COMPONENT = /(\d|\-|\.)/;
  var R_FORMAT_CHUNKS = /([^\-0-9\.]+)/g;
  var R_UNFORMATTED_VALUES = /[0-9.\-]+/g;
  var R_RGB = new RegExp(
    'rgb\\(' + R_UNFORMATTED_VALUES.source +
    (/,\s*/.source) + R_UNFORMATTED_VALUES.source +
    (/,\s*/.source) + R_UNFORMATTED_VALUES.source + '\\)', 'g');
  var R_RGB_PREFIX = /^.*\(/;
  var R_HEX = /#([0-9]|[a-f]){3,6}/gi;
  var VALUE_PLACEHOLDER = 'VAL';

  // HELPERS

  /**
   * @param {Array.number} rawValues
   * @param {string} prefix
   *
   * @return {Array.<string>}
   * @private
   */
  function getFormatChunksFrom (rawValues, prefix) {
    var accumulator = [];

    var rawValuesLength = rawValues.length;
    var i;

    for (i = 0; i < rawValuesLength; i++) {
      accumulator.push('_' + prefix + '_' + i);
    }

    return accumulator;
  }

  /**
   * @param {string} formattedString
   *
   * @return {string}
   * @private
   */
  function getFormatStringFrom (formattedString) {
    var chunks = formattedString.match(R_FORMAT_CHUNKS);

    if (!chunks) {
      // chunks will be null if there were no tokens to parse in
      // formattedString (for example, if formattedString is '2').  Coerce
      // chunks to be useful here.
      chunks = ['', ''];

      // If there is only one chunk, assume that the string is a number
      // followed by a token...
      // NOTE: This may be an unwise assumption.
    } else if (chunks.length === 1 ||
      // ...or if the string starts with a number component (".", "-", or a
      // digit)...
    formattedString[0].match(R_NUMBER_COMPONENT)) {
      // ...prepend an empty string here to make sure that the formatted number
      // is properly replaced by VALUE_PLACEHOLDER
      chunks.unshift('');
    }

    return chunks.join(VALUE_PLACEHOLDER);
  }

  /**
   * Convert all hex color values within a string to an rgb string.
   *
   * @param {Object} stateObject
   *
   * @return {Object} The modified obj
   * @private
   */
  function sanitizeObjectForHexProps (stateObject) {
    Tweenable.each(stateObject, function (prop) {
      var currentProp = stateObject[prop];

      if (typeof currentProp === 'string' && currentProp.match(R_HEX)) {
        stateObject[prop] = sanitizeHexChunksToRGB(currentProp);
      }
    });
  }

  /**
   * @param {string} str
   *
   * @return {string}
   * @private
   */
  function  sanitizeHexChunksToRGB (str) {
    return filterStringChunks(R_HEX, str, convertHexToRGB);
  }

  /**
   * @param {string} hexString
   *
   * @return {string}
   * @private
   */
  function convertHexToRGB (hexString) {
    var rgbArr = hexToRGBArray(hexString);
    return 'rgb(' + rgbArr[0] + ',' + rgbArr[1] + ',' + rgbArr[2] + ')';
  }

  var hexToRGBArray_returnArray = [];
  /**
   * Convert a hexadecimal string to an array with three items, one each for
   * the red, blue, and green decimal values.
   *
   * @param {string} hex A hexadecimal string.
   *
   * @returns {Array.<number>} The converted Array of RGB values if `hex` is a
   * valid string, or an Array of three 0's.
   * @private
   */
  function hexToRGBArray (hex) {

    hex = hex.replace(/#/, '');

    // If the string is a shorthand three digit hex notation, normalize it to
    // the standard six digit notation
    if (hex.length === 3) {
      hex = hex.split('');
      hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
    }

    hexToRGBArray_returnArray[0] = hexToDec(hex.substr(0, 2));
    hexToRGBArray_returnArray[1] = hexToDec(hex.substr(2, 2));
    hexToRGBArray_returnArray[2] = hexToDec(hex.substr(4, 2));

    return hexToRGBArray_returnArray;
  }

  /**
   * Convert a base-16 number to base-10.
   *
   * @param {Number|String} hex The value to convert
   *
   * @returns {Number} The base-10 equivalent of `hex`.
   * @private
   */
  function hexToDec (hex) {
    return parseInt(hex, 16);
  }

  /**
   * Runs a filter operation on all chunks of a string that match a RegExp
   *
   * @param {RegExp} pattern
   * @param {string} unfilteredString
   * @param {function(string)} filter
   *
   * @return {string}
   * @private
   */
  function filterStringChunks (pattern, unfilteredString, filter) {
    var pattenMatches = unfilteredString.match(pattern);
    var filteredString = unfilteredString.replace(pattern, VALUE_PLACEHOLDER);

    if (pattenMatches) {
      var pattenMatchesLength = pattenMatches.length;
      var currentChunk;

      for (var i = 0; i < pattenMatchesLength; i++) {
        currentChunk = pattenMatches.shift();
        filteredString = filteredString.replace(
          VALUE_PLACEHOLDER, filter(currentChunk));
      }
    }

    return filteredString;
  }

  /**
   * Check for floating point values within rgb strings and rounds them.
   *
   * @param {string} formattedString
   *
   * @return {string}
   * @private
   */
  function sanitizeRGBChunks (formattedString) {
    return filterStringChunks(R_RGB, formattedString, sanitizeRGBChunk);
  }

  /**
   * @param {string} rgbChunk
   *
   * @return {string}
   * @private
   */
  function sanitizeRGBChunk (rgbChunk) {
    var numbers = rgbChunk.match(R_UNFORMATTED_VALUES);
    var numbersLength = numbers.length;
    var sanitizedString = rgbChunk.match(R_RGB_PREFIX)[0];

    for (var i = 0; i < numbersLength; i++) {
      sanitizedString += parseInt(numbers[i], 10) + ',';
    }

    sanitizedString = sanitizedString.slice(0, -1) + ')';

    return sanitizedString;
  }

  /**
   * @param {Object} stateObject
   *
   * @return {Object} An Object of formatManifests that correspond to
   * the string properties of stateObject
   * @private
   */
  function getFormatManifests (stateObject) {
    var manifestAccumulator = {};

    Tweenable.each(stateObject, function (prop) {
      var currentProp = stateObject[prop];

      if (typeof currentProp === 'string') {
        var rawValues = getValuesFrom(currentProp);

        manifestAccumulator[prop] = {
          'formatString': getFormatStringFrom(currentProp)
          ,'chunkNames': getFormatChunksFrom(rawValues, prop)
        };
      }
    });

    return manifestAccumulator;
  }

  /**
   * @param {Object} stateObject
   * @param {Object} formatManifests
   * @private
   */
  function expandFormattedProperties (stateObject, formatManifests) {
    Tweenable.each(formatManifests, function (prop) {
      var currentProp = stateObject[prop];
      var rawValues = getValuesFrom(currentProp);
      var rawValuesLength = rawValues.length;

      for (var i = 0; i < rawValuesLength; i++) {
        stateObject[formatManifests[prop].chunkNames[i]] = +rawValues[i];
      }

      delete stateObject[prop];
    });
  }

  /**
   * @param {Object} stateObject
   * @param {Object} formatManifests
   * @private
   */
  function collapseFormattedProperties (stateObject, formatManifests) {
    Tweenable.each(formatManifests, function (prop) {
      var currentProp = stateObject[prop];
      var formatChunks = extractPropertyChunks(
        stateObject, formatManifests[prop].chunkNames);
      var valuesList = getValuesList(
        formatChunks, formatManifests[prop].chunkNames);
      currentProp = getFormattedValues(
        formatManifests[prop].formatString, valuesList);
      stateObject[prop] = sanitizeRGBChunks(currentProp);
    });
  }

  /**
   * @param {Object} stateObject
   * @param {Array.<string>} chunkNames
   *
   * @return {Object} The extracted value chunks.
   * @private
   */
  function extractPropertyChunks (stateObject, chunkNames) {
    var extractedValues = {};
    var currentChunkName, chunkNamesLength = chunkNames.length;

    for (var i = 0; i < chunkNamesLength; i++) {
      currentChunkName = chunkNames[i];
      extractedValues[currentChunkName] = stateObject[currentChunkName];
      delete stateObject[currentChunkName];
    }

    return extractedValues;
  }

  var getValuesList_accumulator = [];
  /**
   * @param {Object} stateObject
   * @param {Array.<string>} chunkNames
   *
   * @return {Array.<number>}
   * @private
   */
  function getValuesList (stateObject, chunkNames) {
    getValuesList_accumulator.length = 0;
    var chunkNamesLength = chunkNames.length;

    for (var i = 0; i < chunkNamesLength; i++) {
      getValuesList_accumulator.push(stateObject[chunkNames[i]]);
    }

    return getValuesList_accumulator;
  }

  /**
   * @param {string} formatString
   * @param {Array.<number>} rawValues
   *
   * @return {string}
   * @private
   */
  function getFormattedValues (formatString, rawValues) {
    var formattedValueString = formatString;
    var rawValuesLength = rawValues.length;

    for (var i = 0; i < rawValuesLength; i++) {
      formattedValueString = formattedValueString.replace(
        VALUE_PLACEHOLDER, +rawValues[i].toFixed(4));
    }

    return formattedValueString;
  }

  /**
   * Note: It's the duty of the caller to convert the Array elements of the
   * return value into numbers.  This is a performance optimization.
   *
   * @param {string} formattedString
   *
   * @return {Array.<string>|null}
   * @private
   */
  function getValuesFrom (formattedString) {
    return formattedString.match(R_UNFORMATTED_VALUES);
  }

  /**
   * @param {Object} easingObject
   * @param {Object} tokenData
   * @private
   */
  function expandEasingObject (easingObject, tokenData) {
    Tweenable.each(tokenData, function (prop) {
      var currentProp = tokenData[prop];
      var chunkNames = currentProp.chunkNames;
      var chunkLength = chunkNames.length;

      var easing = easingObject[prop];
      var i;

      if (typeof easing === 'string') {
        var easingChunks = easing.split(' ');
        var lastEasingChunk = easingChunks[easingChunks.length - 1];

        for (i = 0; i < chunkLength; i++) {
          easingObject[chunkNames[i]] = easingChunks[i] || lastEasingChunk;
        }

      } else {
        for (i = 0; i < chunkLength; i++) {
          easingObject[chunkNames[i]] = easing;
        }
      }

      delete easingObject[prop];
    });
  }

  /**
   * @param {Object} easingObject
   * @param {Object} tokenData
   * @private
   */
  function collapseEasingObject (easingObject, tokenData) {
    Tweenable.each(tokenData, function (prop) {
      var currentProp = tokenData[prop];
      var chunkNames = currentProp.chunkNames;
      var chunkLength = chunkNames.length;

      var firstEasing = easingObject[chunkNames[0]];
      var typeofEasings = typeof firstEasing;

      if (typeofEasings === 'string') {
        var composedEasingString = '';

        for (var i = 0; i < chunkLength; i++) {
          composedEasingString += ' ' + easingObject[chunkNames[i]];
          delete easingObject[chunkNames[i]];
        }

        easingObject[prop] = composedEasingString.substr(1);
      } else {
        easingObject[prop] = firstEasing;
      }
    });
  }

  Tweenable.prototype.filter.token = {
    'tweenCreated': function (currentState, fromState, toState, easingObject) {
      sanitizeObjectForHexProps(currentState);
      sanitizeObjectForHexProps(fromState);
      sanitizeObjectForHexProps(toState);
      this._tokenData = getFormatManifests(currentState);
    },

    'beforeTween': function (currentState, fromState, toState, easingObject) {
      expandEasingObject(easingObject, this._tokenData);
      expandFormattedProperties(currentState, this._tokenData);
      expandFormattedProperties(fromState, this._tokenData);
      expandFormattedProperties(toState, this._tokenData);
    },

    'afterTween': function (currentState, fromState, toState, easingObject) {
      collapseFormattedProperties(currentState, this._tokenData);
      collapseFormattedProperties(fromState, this._tokenData);
      collapseFormattedProperties(toState, this._tokenData);
      collapseEasingObject(easingObject, this._tokenData);
    }
  };

} (Tweenable));

}).call(null);
/**
 * Swiper 3.3.1
 * Most modern mobile touch slider and framework with hardware accelerated transitions
 *
 * http://www.idangero.us/swiper/
 *
 * Copyright 2016, Vladimir Kharlampidi
 * The iDangero.us
 * http://www.idangero.us/
 *
 * Licensed under MIT
 *
 * Released on: February 7, 2016
 */
!function(){"use strict";function e(e){e.fn.swiper=function(a){var r;return e(this).each(function(){var e=new t(this,a);r||(r=e)}),r}}var a,t=function(e,i){function s(e){return Math.floor(e)}function n(){b.autoplayTimeoutId=setTimeout(function(){b.params.loop?(b.fixLoop(),b._slideNext(),b.emit("onAutoplay",b)):b.isEnd?i.autoplayStopOnLast?b.stopAutoplay():(b._slideTo(0),b.emit("onAutoplay",b)):(b._slideNext(),b.emit("onAutoplay",b))},b.params.autoplay)}function o(e,t){var r=a(e.target);if(!r.is(t))if("string"==typeof t)r=r.parents(t);else if(t.nodeType){var i;return r.parents().each(function(e,a){a===t&&(i=t)}),i?t:void 0}if(0!==r.length)return r[0]}function l(e,a){a=a||{};var t=window.MutationObserver||window.WebkitMutationObserver,r=new t(function(e){e.forEach(function(e){b.onResize(!0),b.emit("onObserverUpdate",b,e)})});r.observe(e,{attributes:"undefined"==typeof a.attributes?!0:a.attributes,childList:"undefined"==typeof a.childList?!0:a.childList,characterData:"undefined"==typeof a.characterData?!0:a.characterData}),b.observers.push(r)}function p(e){e.originalEvent&&(e=e.originalEvent);var a=e.keyCode||e.charCode;if(!b.params.allowSwipeToNext&&(b.isHorizontal()&&39===a||!b.isHorizontal()&&40===a))return!1;if(!b.params.allowSwipeToPrev&&(b.isHorizontal()&&37===a||!b.isHorizontal()&&38===a))return!1;if(!(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey||document.activeElement&&document.activeElement.nodeName&&("input"===document.activeElement.nodeName.toLowerCase()||"textarea"===document.activeElement.nodeName.toLowerCase()))){if(37===a||39===a||38===a||40===a){var t=!1;if(b.container.parents(".swiper-slide").length>0&&0===b.container.parents(".swiper-slide-active").length)return;var r={left:window.pageXOffset,top:window.pageYOffset},i=window.innerWidth,s=window.innerHeight,n=b.container.offset();b.rtl&&(n.left=n.left-b.container[0].scrollLeft);for(var o=[[n.left,n.top],[n.left+b.width,n.top],[n.left,n.top+b.height],[n.left+b.width,n.top+b.height]],l=0;l<o.length;l++){var p=o[l];p[0]>=r.left&&p[0]<=r.left+i&&p[1]>=r.top&&p[1]<=r.top+s&&(t=!0)}if(!t)return}b.isHorizontal()?((37===a||39===a)&&(e.preventDefault?e.preventDefault():e.returnValue=!1),(39===a&&!b.rtl||37===a&&b.rtl)&&b.slideNext(),(37===a&&!b.rtl||39===a&&b.rtl)&&b.slidePrev()):((38===a||40===a)&&(e.preventDefault?e.preventDefault():e.returnValue=!1),40===a&&b.slideNext(),38===a&&b.slidePrev())}}function d(e){e.originalEvent&&(e=e.originalEvent);var a=b.mousewheel.event,t=0,r=b.rtl?-1:1;if("mousewheel"===a)if(b.params.mousewheelForceToAxis)if(b.isHorizontal()){if(!(Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)))return;t=e.wheelDeltaX*r}else{if(!(Math.abs(e.wheelDeltaY)>Math.abs(e.wheelDeltaX)))return;t=e.wheelDeltaY}else t=Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)?-e.wheelDeltaX*r:-e.wheelDeltaY;else if("DOMMouseScroll"===a)t=-e.detail;else if("wheel"===a)if(b.params.mousewheelForceToAxis)if(b.isHorizontal()){if(!(Math.abs(e.deltaX)>Math.abs(e.deltaY)))return;t=-e.deltaX*r}else{if(!(Math.abs(e.deltaY)>Math.abs(e.deltaX)))return;t=-e.deltaY}else t=Math.abs(e.deltaX)>Math.abs(e.deltaY)?-e.deltaX*r:-e.deltaY;if(0!==t){if(b.params.mousewheelInvert&&(t=-t),b.params.freeMode){var i=b.getWrapperTranslate()+t*b.params.mousewheelSensitivity,s=b.isBeginning,n=b.isEnd;if(i>=b.minTranslate()&&(i=b.minTranslate()),i<=b.maxTranslate()&&(i=b.maxTranslate()),b.setWrapperTransition(0),b.setWrapperTranslate(i),b.updateProgress(),b.updateActiveIndex(),(!s&&b.isBeginning||!n&&b.isEnd)&&b.updateClasses(),b.params.freeModeSticky?(clearTimeout(b.mousewheel.timeout),b.mousewheel.timeout=setTimeout(function(){b.slideReset()},300)):b.params.lazyLoading&&b.lazy&&b.lazy.load(),0===i||i===b.maxTranslate())return}else{if((new window.Date).getTime()-b.mousewheel.lastScrollTime>60)if(0>t)if(b.isEnd&&!b.params.loop||b.animating){if(b.params.mousewheelReleaseOnEdges)return!0}else b.slideNext();else if(b.isBeginning&&!b.params.loop||b.animating){if(b.params.mousewheelReleaseOnEdges)return!0}else b.slidePrev();b.mousewheel.lastScrollTime=(new window.Date).getTime()}return b.params.autoplay&&b.stopAutoplay(),e.preventDefault?e.preventDefault():e.returnValue=!1,!1}}function u(e,t){e=a(e);var r,i,s,n=b.rtl?-1:1;r=e.attr("data-swiper-parallax")||"0",i=e.attr("data-swiper-parallax-x"),s=e.attr("data-swiper-parallax-y"),i||s?(i=i||"0",s=s||"0"):b.isHorizontal()?(i=r,s="0"):(s=r,i="0"),i=i.indexOf("%")>=0?parseInt(i,10)*t*n+"%":i*t*n+"px",s=s.indexOf("%")>=0?parseInt(s,10)*t+"%":s*t+"px",e.transform("translate3d("+i+", "+s+",0px)")}function c(e){return 0!==e.indexOf("on")&&(e=e[0]!==e[0].toUpperCase()?"on"+e[0].toUpperCase()+e.substring(1):"on"+e),e}if(!(this instanceof t))return new t(e,i);var m={direction:"horizontal",touchEventsTarget:"container",initialSlide:0,speed:300,autoplay:!1,autoplayDisableOnInteraction:!0,autoplayStopOnLast:!1,iOSEdgeSwipeDetection:!1,iOSEdgeSwipeThreshold:20,freeMode:!1,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeSticky:!1,freeModeMinimumVelocity:.02,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",coverflow:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},flip:{slideShadows:!0,limitRotation:!0},cube:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94},fade:{crossFade:!1},parallax:!1,scrollbar:null,scrollbarHide:!0,scrollbarDraggable:!1,scrollbarSnapOnRelease:!1,keyboardControl:!1,mousewheelControl:!1,mousewheelReleaseOnEdges:!1,mousewheelInvert:!1,mousewheelForceToAxis:!1,mousewheelSensitivity:1,hashnav:!1,breakpoints:void 0,spaceBetween:0,slidesPerView:1,slidesPerColumn:1,slidesPerColumnFill:"column",slidesPerGroup:1,centeredSlides:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,onlyExternal:!1,threshold:0,touchMoveStopPropagation:!0,uniqueNavElements:!0,pagination:null,paginationElement:"span",paginationClickable:!1,paginationHide:!1,paginationBulletRender:null,paginationProgressRender:null,paginationFractionRender:null,paginationCustomRender:null,paginationType:"bullets",resistance:!0,resistanceRatio:.85,nextButton:null,prevButton:null,watchSlidesProgress:!1,watchSlidesVisibility:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,lazyLoading:!1,lazyLoadingInPrevNext:!1,lazyLoadingInPrevNextAmount:1,lazyLoadingOnTransitionStart:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,control:void 0,controlInverse:!1,controlBy:"slide",allowSwipeToPrev:!0,allowSwipeToNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",buttonDisabledClass:"swiper-button-disabled",paginationCurrentClass:"swiper-pagination-current",paginationTotalClass:"swiper-pagination-total",paginationHiddenClass:"swiper-pagination-hidden",paginationProgressbarClass:"swiper-pagination-progressbar",observer:!1,observeParents:!1,a11y:!1,prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",runCallbacksOnInit:!0},h=i&&i.virtualTranslate;i=i||{};var f={};for(var g in i)if("object"!=typeof i[g]||null===i[g]||(i[g].nodeType||i[g]===window||i[g]===document||"undefined"!=typeof r&&i[g]instanceof r||"undefined"!=typeof jQuery&&i[g]instanceof jQuery))f[g]=i[g];else{f[g]={};for(var v in i[g])f[g][v]=i[g][v]}for(var w in m)if("undefined"==typeof i[w])i[w]=m[w];else if("object"==typeof i[w])for(var y in m[w])"undefined"==typeof i[w][y]&&(i[w][y]=m[w][y]);var b=this;if(b.params=i,b.originalParams=f,b.classNames=[],"undefined"!=typeof a&&"undefined"!=typeof r&&(a=r),("undefined"!=typeof a||(a="undefined"==typeof r?window.Dom7||window.Zepto||window.jQuery:r))&&(b.$=a,b.currentBreakpoint=void 0,b.getActiveBreakpoint=function(){if(!b.params.breakpoints)return!1;var e,a=!1,t=[];for(e in b.params.breakpoints)b.params.breakpoints.hasOwnProperty(e)&&t.push(e);t.sort(function(e,a){return parseInt(e,10)>parseInt(a,10)});for(var r=0;r<t.length;r++)e=t[r],e>=window.innerWidth&&!a&&(a=e);return a||"max"},b.setBreakpoint=function(){var e=b.getActiveBreakpoint();if(e&&b.currentBreakpoint!==e){var a=e in b.params.breakpoints?b.params.breakpoints[e]:b.originalParams,t=b.params.loop&&a.slidesPerView!==b.params.slidesPerView;for(var r in a)b.params[r]=a[r];b.currentBreakpoint=e,t&&b.destroyLoop&&b.reLoop(!0)}},b.params.breakpoints&&b.setBreakpoint(),b.container=a(e),0!==b.container.length)){if(b.container.length>1){var x=[];return b.container.each(function(){x.push(new t(this,i))}),x}b.container[0].swiper=b,b.container.data("swiper",b),b.classNames.push("swiper-container-"+b.params.direction),b.params.freeMode&&b.classNames.push("swiper-container-free-mode"),b.support.flexbox||(b.classNames.push("swiper-container-no-flexbox"),b.params.slidesPerColumn=1),b.params.autoHeight&&b.classNames.push("swiper-container-autoheight"),(b.params.parallax||b.params.watchSlidesVisibility)&&(b.params.watchSlidesProgress=!0),["cube","coverflow","flip"].indexOf(b.params.effect)>=0&&(b.support.transforms3d?(b.params.watchSlidesProgress=!0,b.classNames.push("swiper-container-3d")):b.params.effect="slide"),"slide"!==b.params.effect&&b.classNames.push("swiper-container-"+b.params.effect),"cube"===b.params.effect&&(b.params.resistanceRatio=0,b.params.slidesPerView=1,b.params.slidesPerColumn=1,b.params.slidesPerGroup=1,b.params.centeredSlides=!1,b.params.spaceBetween=0,b.params.virtualTranslate=!0,b.params.setWrapperSize=!1),("fade"===b.params.effect||"flip"===b.params.effect)&&(b.params.slidesPerView=1,b.params.slidesPerColumn=1,b.params.slidesPerGroup=1,b.params.watchSlidesProgress=!0,b.params.spaceBetween=0,b.params.setWrapperSize=!1,"undefined"==typeof h&&(b.params.virtualTranslate=!0)),b.params.grabCursor&&b.support.touch&&(b.params.grabCursor=!1),b.wrapper=b.container.children("."+b.params.wrapperClass),b.params.pagination&&(b.paginationContainer=a(b.params.pagination),b.params.uniqueNavElements&&"string"==typeof b.params.pagination&&b.paginationContainer.length>1&&1===b.container.find(b.params.pagination).length&&(b.paginationContainer=b.container.find(b.params.pagination)),"bullets"===b.params.paginationType&&b.params.paginationClickable?b.paginationContainer.addClass("swiper-pagination-clickable"):b.params.paginationClickable=!1,b.paginationContainer.addClass("swiper-pagination-"+b.params.paginationType)),(b.params.nextButton||b.params.prevButton)&&(b.params.nextButton&&(b.nextButton=a(b.params.nextButton),b.params.uniqueNavElements&&"string"==typeof b.params.nextButton&&b.nextButton.length>1&&1===b.container.find(b.params.nextButton).length&&(b.nextButton=b.container.find(b.params.nextButton))),b.params.prevButton&&(b.prevButton=a(b.params.prevButton),b.params.uniqueNavElements&&"string"==typeof b.params.prevButton&&b.prevButton.length>1&&1===b.container.find(b.params.prevButton).length&&(b.prevButton=b.container.find(b.params.prevButton)))),b.isHorizontal=function(){return"horizontal"===b.params.direction},b.rtl=b.isHorizontal()&&("rtl"===b.container[0].dir.toLowerCase()||"rtl"===b.container.css("direction")),b.rtl&&b.classNames.push("swiper-container-rtl"),b.rtl&&(b.wrongRTL="-webkit-box"===b.wrapper.css("display")),b.params.slidesPerColumn>1&&b.classNames.push("swiper-container-multirow"),b.device.android&&b.classNames.push("swiper-container-android"),b.container.addClass(b.classNames.join(" ")),b.translate=0,b.progress=0,b.velocity=0,b.lockSwipeToNext=function(){b.params.allowSwipeToNext=!1},b.lockSwipeToPrev=function(){b.params.allowSwipeToPrev=!1},b.lockSwipes=function(){b.params.allowSwipeToNext=b.params.allowSwipeToPrev=!1},b.unlockSwipeToNext=function(){b.params.allowSwipeToNext=!0},b.unlockSwipeToPrev=function(){b.params.allowSwipeToPrev=!0},b.unlockSwipes=function(){b.params.allowSwipeToNext=b.params.allowSwipeToPrev=!0},b.params.grabCursor&&(b.container[0].style.cursor="move",b.container[0].style.cursor="-webkit-grab",b.container[0].style.cursor="-moz-grab",b.container[0].style.cursor="grab"),b.imagesToLoad=[],b.imagesLoaded=0,b.loadImage=function(e,a,t,r,i){function s(){i&&i()}var n;e.complete&&r?s():a?(n=new window.Image,n.onload=s,n.onerror=s,t&&(n.srcset=t),a&&(n.src=a)):s()},b.preloadImages=function(){function e(){"undefined"!=typeof b&&null!==b&&(void 0!==b.imagesLoaded&&b.imagesLoaded++,b.imagesLoaded===b.imagesToLoad.length&&(b.params.updateOnImagesReady&&b.update(),b.emit("onImagesReady",b)))}b.imagesToLoad=b.container.find("img");for(var a=0;a<b.imagesToLoad.length;a++)b.loadImage(b.imagesToLoad[a],b.imagesToLoad[a].currentSrc||b.imagesToLoad[a].getAttribute("src"),b.imagesToLoad[a].srcset||b.imagesToLoad[a].getAttribute("srcset"),!0,e)},b.autoplayTimeoutId=void 0,b.autoplaying=!1,b.autoplayPaused=!1,b.startAutoplay=function(){return"undefined"!=typeof b.autoplayTimeoutId?!1:b.params.autoplay?b.autoplaying?!1:(b.autoplaying=!0,b.emit("onAutoplayStart",b),void n()):!1},b.stopAutoplay=function(e){b.autoplayTimeoutId&&(b.autoplayTimeoutId&&clearTimeout(b.autoplayTimeoutId),b.autoplaying=!1,b.autoplayTimeoutId=void 0,b.emit("onAutoplayStop",b))},b.pauseAutoplay=function(e){b.autoplayPaused||(b.autoplayTimeoutId&&clearTimeout(b.autoplayTimeoutId),b.autoplayPaused=!0,0===e?(b.autoplayPaused=!1,n()):b.wrapper.transitionEnd(function(){b&&(b.autoplayPaused=!1,b.autoplaying?n():b.stopAutoplay())}))},b.minTranslate=function(){return-b.snapGrid[0]},b.maxTranslate=function(){return-b.snapGrid[b.snapGrid.length-1]},b.updateAutoHeight=function(){var e=b.slides.eq(b.activeIndex)[0];if("undefined"!=typeof e){var a=e.offsetHeight;a&&b.wrapper.css("height",a+"px")}},b.updateContainerSize=function(){var e,a;e="undefined"!=typeof b.params.width?b.params.width:b.container[0].clientWidth,a="undefined"!=typeof b.params.height?b.params.height:b.container[0].clientHeight,0===e&&b.isHorizontal()||0===a&&!b.isHorizontal()||(e=e-parseInt(b.container.css("padding-left"),10)-parseInt(b.container.css("padding-right"),10),a=a-parseInt(b.container.css("padding-top"),10)-parseInt(b.container.css("padding-bottom"),10),b.width=e,b.height=a,b.size=b.isHorizontal()?b.width:b.height)},b.updateSlidesSize=function(){b.slides=b.wrapper.children("."+b.params.slideClass),b.snapGrid=[],b.slidesGrid=[],b.slidesSizesGrid=[];var e,a=b.params.spaceBetween,t=-b.params.slidesOffsetBefore,r=0,i=0;if("undefined"!=typeof b.size){"string"==typeof a&&a.indexOf("%")>=0&&(a=parseFloat(a.replace("%",""))/100*b.size),b.virtualSize=-a,b.rtl?b.slides.css({marginLeft:"",marginTop:""}):b.slides.css({marginRight:"",marginBottom:""});var n;b.params.slidesPerColumn>1&&(n=Math.floor(b.slides.length/b.params.slidesPerColumn)===b.slides.length/b.params.slidesPerColumn?b.slides.length:Math.ceil(b.slides.length/b.params.slidesPerColumn)*b.params.slidesPerColumn,"auto"!==b.params.slidesPerView&&"row"===b.params.slidesPerColumnFill&&(n=Math.max(n,b.params.slidesPerView*b.params.slidesPerColumn)));var o,l=b.params.slidesPerColumn,p=n/l,d=p-(b.params.slidesPerColumn*p-b.slides.length);for(e=0;e<b.slides.length;e++){o=0;var u=b.slides.eq(e);if(b.params.slidesPerColumn>1){var c,m,h;"column"===b.params.slidesPerColumnFill?(m=Math.floor(e/l),h=e-m*l,(m>d||m===d&&h===l-1)&&++h>=l&&(h=0,m++),c=m+h*n/l,u.css({"-webkit-box-ordinal-group":c,"-moz-box-ordinal-group":c,"-ms-flex-order":c,"-webkit-order":c,order:c})):(h=Math.floor(e/p),m=e-h*p),u.css({"margin-top":0!==h&&b.params.spaceBetween&&b.params.spaceBetween+"px"}).attr("data-swiper-column",m).attr("data-swiper-row",h)}"none"!==u.css("display")&&("auto"===b.params.slidesPerView?(o=b.isHorizontal()?u.outerWidth(!0):u.outerHeight(!0),b.params.roundLengths&&(o=s(o))):(o=(b.size-(b.params.slidesPerView-1)*a)/b.params.slidesPerView,b.params.roundLengths&&(o=s(o)),b.isHorizontal()?b.slides[e].style.width=o+"px":b.slides[e].style.height=o+"px"),b.slides[e].swiperSlideSize=o,b.slidesSizesGrid.push(o),b.params.centeredSlides?(t=t+o/2+r/2+a,0===e&&(t=t-b.size/2-a),Math.abs(t)<.001&&(t=0),i%b.params.slidesPerGroup===0&&b.snapGrid.push(t),b.slidesGrid.push(t)):(i%b.params.slidesPerGroup===0&&b.snapGrid.push(t),b.slidesGrid.push(t),t=t+o+a),b.virtualSize+=o+a,r=o,i++)}b.virtualSize=Math.max(b.virtualSize,b.size)+b.params.slidesOffsetAfter;var f;if(b.rtl&&b.wrongRTL&&("slide"===b.params.effect||"coverflow"===b.params.effect)&&b.wrapper.css({width:b.virtualSize+b.params.spaceBetween+"px"}),(!b.support.flexbox||b.params.setWrapperSize)&&(b.isHorizontal()?b.wrapper.css({width:b.virtualSize+b.params.spaceBetween+"px"}):b.wrapper.css({height:b.virtualSize+b.params.spaceBetween+"px"})),b.params.slidesPerColumn>1&&(b.virtualSize=(o+b.params.spaceBetween)*n,b.virtualSize=Math.ceil(b.virtualSize/b.params.slidesPerColumn)-b.params.spaceBetween,b.wrapper.css({width:b.virtualSize+b.params.spaceBetween+"px"}),b.params.centeredSlides)){for(f=[],e=0;e<b.snapGrid.length;e++)b.snapGrid[e]<b.virtualSize+b.snapGrid[0]&&f.push(b.snapGrid[e]);b.snapGrid=f}if(!b.params.centeredSlides){for(f=[],e=0;e<b.snapGrid.length;e++)b.snapGrid[e]<=b.virtualSize-b.size&&f.push(b.snapGrid[e]);b.snapGrid=f,Math.floor(b.virtualSize-b.size)-Math.floor(b.snapGrid[b.snapGrid.length-1])>1&&b.snapGrid.push(b.virtualSize-b.size)}0===b.snapGrid.length&&(b.snapGrid=[0]),0!==b.params.spaceBetween&&(b.isHorizontal()?b.rtl?b.slides.css({marginLeft:a+"px"}):b.slides.css({marginRight:a+"px"}):b.slides.css({marginBottom:a+"px"})),b.params.watchSlidesProgress&&b.updateSlidesOffset()}},b.updateSlidesOffset=function(){for(var e=0;e<b.slides.length;e++)b.slides[e].swiperSlideOffset=b.isHorizontal()?b.slides[e].offsetLeft:b.slides[e].offsetTop},b.updateSlidesProgress=function(e){if("undefined"==typeof e&&(e=b.translate||0),0!==b.slides.length){"undefined"==typeof b.slides[0].swiperSlideOffset&&b.updateSlidesOffset();var a=-e;b.rtl&&(a=e),b.slides.removeClass(b.params.slideVisibleClass);for(var t=0;t<b.slides.length;t++){var r=b.slides[t],i=(a-r.swiperSlideOffset)/(r.swiperSlideSize+b.params.spaceBetween);if(b.params.watchSlidesVisibility){var s=-(a-r.swiperSlideOffset),n=s+b.slidesSizesGrid[t],o=s>=0&&s<b.size||n>0&&n<=b.size||0>=s&&n>=b.size;o&&b.slides.eq(t).addClass(b.params.slideVisibleClass)}r.progress=b.rtl?-i:i}}},b.updateProgress=function(e){"undefined"==typeof e&&(e=b.translate||0);var a=b.maxTranslate()-b.minTranslate(),t=b.isBeginning,r=b.isEnd;0===a?(b.progress=0,b.isBeginning=b.isEnd=!0):(b.progress=(e-b.minTranslate())/a,b.isBeginning=b.progress<=0,b.isEnd=b.progress>=1),b.isBeginning&&!t&&b.emit("onReachBeginning",b),b.isEnd&&!r&&b.emit("onReachEnd",b),b.params.watchSlidesProgress&&b.updateSlidesProgress(e),b.emit("onProgress",b,b.progress)},b.updateActiveIndex=function(){var e,a,t,r=b.rtl?b.translate:-b.translate;for(a=0;a<b.slidesGrid.length;a++)"undefined"!=typeof b.slidesGrid[a+1]?r>=b.slidesGrid[a]&&r<b.slidesGrid[a+1]-(b.slidesGrid[a+1]-b.slidesGrid[a])/2?e=a:r>=b.slidesGrid[a]&&r<b.slidesGrid[a+1]&&(e=a+1):r>=b.slidesGrid[a]&&(e=a);(0>e||"undefined"==typeof e)&&(e=0),t=Math.floor(e/b.params.slidesPerGroup),t>=b.snapGrid.length&&(t=b.snapGrid.length-1),e!==b.activeIndex&&(b.snapIndex=t,b.previousIndex=b.activeIndex,b.activeIndex=e,b.updateClasses())},b.updateClasses=function(){b.slides.removeClass(b.params.slideActiveClass+" "+b.params.slideNextClass+" "+b.params.slidePrevClass);var e=b.slides.eq(b.activeIndex);e.addClass(b.params.slideActiveClass);var t=e.next("."+b.params.slideClass).addClass(b.params.slideNextClass);b.params.loop&&0===t.length&&b.slides.eq(0).addClass(b.params.slideNextClass);var r=e.prev("."+b.params.slideClass).addClass(b.params.slidePrevClass);if(b.params.loop&&0===r.length&&b.slides.eq(-1).addClass(b.params.slidePrevClass),b.paginationContainer&&b.paginationContainer.length>0){var i,s=b.params.loop?Math.ceil((b.slides.length-2*b.loopedSlides)/b.params.slidesPerGroup):b.snapGrid.length;if(b.params.loop?(i=Math.ceil((b.activeIndex-b.loopedSlides)/b.params.slidesPerGroup),i>b.slides.length-1-2*b.loopedSlides&&(i-=b.slides.length-2*b.loopedSlides),i>s-1&&(i-=s),0>i&&"bullets"!==b.params.paginationType&&(i=s+i)):i="undefined"!=typeof b.snapIndex?b.snapIndex:b.activeIndex||0,"bullets"===b.params.paginationType&&b.bullets&&b.bullets.length>0&&(b.bullets.removeClass(b.params.bulletActiveClass),b.paginationContainer.length>1?b.bullets.each(function(){a(this).index()===i&&a(this).addClass(b.params.bulletActiveClass)}):b.bullets.eq(i).addClass(b.params.bulletActiveClass)),"fraction"===b.params.paginationType&&(b.paginationContainer.find("."+b.params.paginationCurrentClass).text(i+1),b.paginationContainer.find("."+b.params.paginationTotalClass).text(s)),"progress"===b.params.paginationType){var n=(i+1)/s,o=n,l=1;b.isHorizontal()||(l=n,o=1),b.paginationContainer.find("."+b.params.paginationProgressbarClass).transform("translate3d(0,0,0) scaleX("+o+") scaleY("+l+")").transition(b.params.speed)}"custom"===b.params.paginationType&&b.params.paginationCustomRender&&(b.paginationContainer.html(b.params.paginationCustomRender(b,i+1,s)),b.emit("onPaginationRendered",b,b.paginationContainer[0]))}b.params.loop||(b.params.prevButton&&b.prevButton&&b.prevButton.length>0&&(b.isBeginning?(b.prevButton.addClass(b.params.buttonDisabledClass),b.params.a11y&&b.a11y&&b.a11y.disable(b.prevButton)):(b.prevButton.removeClass(b.params.buttonDisabledClass),b.params.a11y&&b.a11y&&b.a11y.enable(b.prevButton))),b.params.nextButton&&b.nextButton&&b.nextButton.length>0&&(b.isEnd?(b.nextButton.addClass(b.params.buttonDisabledClass),b.params.a11y&&b.a11y&&b.a11y.disable(b.nextButton)):(b.nextButton.removeClass(b.params.buttonDisabledClass),b.params.a11y&&b.a11y&&b.a11y.enable(b.nextButton))))},b.updatePagination=function(){if(b.params.pagination&&b.paginationContainer&&b.paginationContainer.length>0){var e="";if("bullets"===b.params.paginationType){for(var a=b.params.loop?Math.ceil((b.slides.length-2*b.loopedSlides)/b.params.slidesPerGroup):b.snapGrid.length,t=0;a>t;t++)e+=b.params.paginationBulletRender?b.params.paginationBulletRender(t,b.params.bulletClass):"<"+b.params.paginationElement+' class="'+b.params.bulletClass+'"></'+b.params.paginationElement+">";b.paginationContainer.html(e),b.bullets=b.paginationContainer.find("."+b.params.bulletClass),b.params.paginationClickable&&b.params.a11y&&b.a11y&&b.a11y.initPagination()}"fraction"===b.params.paginationType&&(e=b.params.paginationFractionRender?b.params.paginationFractionRender(b,b.params.paginationCurrentClass,b.params.paginationTotalClass):'<span class="'+b.params.paginationCurrentClass+'"></span> / <span class="'+b.params.paginationTotalClass+'"></span>',b.paginationContainer.html(e)),"progress"===b.params.paginationType&&(e=b.params.paginationProgressRender?b.params.paginationProgressRender(b,b.params.paginationProgressbarClass):'<span class="'+b.params.paginationProgressbarClass+'"></span>',b.paginationContainer.html(e)),"custom"!==b.params.paginationType&&b.emit("onPaginationRendered",b,b.paginationContainer[0])}},b.update=function(e){function a(){r=Math.min(Math.max(b.translate,b.maxTranslate()),b.minTranslate()),b.setWrapperTranslate(r),b.updateActiveIndex(),b.updateClasses()}if(b.updateContainerSize(),b.updateSlidesSize(),b.updateProgress(),b.updatePagination(),b.updateClasses(),b.params.scrollbar&&b.scrollbar&&b.scrollbar.set(),e){var t,r;b.controller&&b.controller.spline&&(b.controller.spline=void 0),b.params.freeMode?(a(),b.params.autoHeight&&b.updateAutoHeight()):(t=("auto"===b.params.slidesPerView||b.params.slidesPerView>1)&&b.isEnd&&!b.params.centeredSlides?b.slideTo(b.slides.length-1,0,!1,!0):b.slideTo(b.activeIndex,0,!1,!0),t||a())}else b.params.autoHeight&&b.updateAutoHeight()},b.onResize=function(e){b.params.breakpoints&&b.setBreakpoint();var a=b.params.allowSwipeToPrev,t=b.params.allowSwipeToNext;b.params.allowSwipeToPrev=b.params.allowSwipeToNext=!0,b.updateContainerSize(),b.updateSlidesSize(),("auto"===b.params.slidesPerView||b.params.freeMode||e)&&b.updatePagination(),b.params.scrollbar&&b.scrollbar&&b.scrollbar.set(),b.controller&&b.controller.spline&&(b.controller.spline=void 0);var r=!1;if(b.params.freeMode){var i=Math.min(Math.max(b.translate,b.maxTranslate()),b.minTranslate());b.setWrapperTranslate(i),b.updateActiveIndex(),b.updateClasses(),b.params.autoHeight&&b.updateAutoHeight()}else b.updateClasses(),r=("auto"===b.params.slidesPerView||b.params.slidesPerView>1)&&b.isEnd&&!b.params.centeredSlides?b.slideTo(b.slides.length-1,0,!1,!0):b.slideTo(b.activeIndex,0,!1,!0);b.params.lazyLoading&&!r&&b.lazy&&b.lazy.load(),b.params.allowSwipeToPrev=a,b.params.allowSwipeToNext=t};var T=["mousedown","mousemove","mouseup"];window.navigator.pointerEnabled?T=["pointerdown","pointermove","pointerup"]:window.navigator.msPointerEnabled&&(T=["MSPointerDown","MSPointerMove","MSPointerUp"]),b.touchEvents={start:b.support.touch||!b.params.simulateTouch?"touchstart":T[0],move:b.support.touch||!b.params.simulateTouch?"touchmove":T[1],end:b.support.touch||!b.params.simulateTouch?"touchend":T[2]},(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&("container"===b.params.touchEventsTarget?b.container:b.wrapper).addClass("swiper-wp8-"+b.params.direction),b.initEvents=function(e){var a=e?"off":"on",t=e?"removeEventListener":"addEventListener",r="container"===b.params.touchEventsTarget?b.container[0]:b.wrapper[0],s=b.support.touch?r:document,n=b.params.nested?!0:!1;b.browser.ie?(r[t](b.touchEvents.start,b.onTouchStart,!1),s[t](b.touchEvents.move,b.onTouchMove,n),s[t](b.touchEvents.end,b.onTouchEnd,!1)):(b.support.touch&&(r[t](b.touchEvents.start,b.onTouchStart,!1),r[t](b.touchEvents.move,b.onTouchMove,n),r[t](b.touchEvents.end,b.onTouchEnd,!1)),!i.simulateTouch||b.device.ios||b.device.android||(r[t]("mousedown",b.onTouchStart,!1),document[t]("mousemove",b.onTouchMove,n),document[t]("mouseup",b.onTouchEnd,!1))),window[t]("resize",b.onResize),b.params.nextButton&&b.nextButton&&b.nextButton.length>0&&(b.nextButton[a]("click",b.onClickNext),b.params.a11y&&b.a11y&&b.nextButton[a]("keydown",b.a11y.onEnterKey)),b.params.prevButton&&b.prevButton&&b.prevButton.length>0&&(b.prevButton[a]("click",b.onClickPrev),b.params.a11y&&b.a11y&&b.prevButton[a]("keydown",b.a11y.onEnterKey)),b.params.pagination&&b.params.paginationClickable&&(b.paginationContainer[a]("click","."+b.params.bulletClass,b.onClickIndex),b.params.a11y&&b.a11y&&b.paginationContainer[a]("keydown","."+b.params.bulletClass,b.a11y.onEnterKey)),(b.params.preventClicks||b.params.preventClicksPropagation)&&r[t]("click",b.preventClicks,!0)},b.attachEvents=function(){b.initEvents()},b.detachEvents=function(){b.initEvents(!0)},b.allowClick=!0,b.preventClicks=function(e){b.allowClick||(b.params.preventClicks&&e.preventDefault(),b.params.preventClicksPropagation&&b.animating&&(e.stopPropagation(),e.stopImmediatePropagation()))},b.onClickNext=function(e){e.preventDefault(),(!b.isEnd||b.params.loop)&&b.slideNext()},b.onClickPrev=function(e){e.preventDefault(),(!b.isBeginning||b.params.loop)&&b.slidePrev()},b.onClickIndex=function(e){e.preventDefault();var t=a(this).index()*b.params.slidesPerGroup;b.params.loop&&(t+=b.loopedSlides),b.slideTo(t)},b.updateClickedSlide=function(e){var t=o(e,"."+b.params.slideClass),r=!1;if(t)for(var i=0;i<b.slides.length;i++)b.slides[i]===t&&(r=!0);if(!t||!r)return b.clickedSlide=void 0,void(b.clickedIndex=void 0);if(b.clickedSlide=t,b.clickedIndex=a(t).index(),b.params.slideToClickedSlide&&void 0!==b.clickedIndex&&b.clickedIndex!==b.activeIndex){var s,n=b.clickedIndex;if(b.params.loop){if(b.animating)return;s=a(b.clickedSlide).attr("data-swiper-slide-index"),b.params.centeredSlides?n<b.loopedSlides-b.params.slidesPerView/2||n>b.slides.length-b.loopedSlides+b.params.slidesPerView/2?(b.fixLoop(),n=b.wrapper.children("."+b.params.slideClass+'[data-swiper-slide-index="'+s+'"]:not(.swiper-slide-duplicate)').eq(0).index(),setTimeout(function(){b.slideTo(n)},0)):b.slideTo(n):n>b.slides.length-b.params.slidesPerView?(b.fixLoop(),n=b.wrapper.children("."+b.params.slideClass+'[data-swiper-slide-index="'+s+'"]:not(.swiper-slide-duplicate)').eq(0).index(),setTimeout(function(){b.slideTo(n)},0)):b.slideTo(n)}else b.slideTo(n)}};var S,C,z,M,E,P,k,I,L,B,D="input, select, textarea, button",H=Date.now(),A=[];b.animating=!1,b.touches={startX:0,startY:0,currentX:0,currentY:0,diff:0};var G,O;if(b.onTouchStart=function(e){if(e.originalEvent&&(e=e.originalEvent),G="touchstart"===e.type,G||!("which"in e)||3!==e.which){if(b.params.noSwiping&&o(e,"."+b.params.noSwipingClass))return void(b.allowClick=!0);if(!b.params.swipeHandler||o(e,b.params.swipeHandler)){var t=b.touches.currentX="touchstart"===e.type?e.targetTouches[0].pageX:e.pageX,r=b.touches.currentY="touchstart"===e.type?e.targetTouches[0].pageY:e.pageY;if(!(b.device.ios&&b.params.iOSEdgeSwipeDetection&&t<=b.params.iOSEdgeSwipeThreshold)){if(S=!0,C=!1,z=!0,E=void 0,O=void 0,b.touches.startX=t,b.touches.startY=r,M=Date.now(),b.allowClick=!0,b.updateContainerSize(),b.swipeDirection=void 0,b.params.threshold>0&&(I=!1),"touchstart"!==e.type){var i=!0;a(e.target).is(D)&&(i=!1),document.activeElement&&a(document.activeElement).is(D)&&document.activeElement.blur(),i&&e.preventDefault()}b.emit("onTouchStart",b,e)}}}},b.onTouchMove=function(e){if(e.originalEvent&&(e=e.originalEvent),!G||"mousemove"!==e.type){if(e.preventedByNestedSwiper)return b.touches.startX="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,void(b.touches.startY="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY);if(b.params.onlyExternal)return b.allowClick=!1,void(S&&(b.touches.startX=b.touches.currentX="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,b.touches.startY=b.touches.currentY="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,M=Date.now()));if(G&&document.activeElement&&e.target===document.activeElement&&a(e.target).is(D))return C=!0,void(b.allowClick=!1);if(z&&b.emit("onTouchMove",b,e),!(e.targetTouches&&e.targetTouches.length>1)){if(b.touches.currentX="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,b.touches.currentY="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,"undefined"==typeof E){var t=180*Math.atan2(Math.abs(b.touches.currentY-b.touches.startY),Math.abs(b.touches.currentX-b.touches.startX))/Math.PI;E=b.isHorizontal()?t>b.params.touchAngle:90-t>b.params.touchAngle}if(E&&b.emit("onTouchMoveOpposite",b,e),"undefined"==typeof O&&b.browser.ieTouch&&(b.touches.currentX!==b.touches.startX||b.touches.currentY!==b.touches.startY)&&(O=!0),S){if(E)return void(S=!1);if(O||!b.browser.ieTouch){b.allowClick=!1,b.emit("onSliderMove",b,e),e.preventDefault(),b.params.touchMoveStopPropagation&&!b.params.nested&&e.stopPropagation(),C||(i.loop&&b.fixLoop(),k=b.getWrapperTranslate(),b.setWrapperTransition(0),b.animating&&b.wrapper.trigger("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd msTransitionEnd"),b.params.autoplay&&b.autoplaying&&(b.params.autoplayDisableOnInteraction?b.stopAutoplay():b.pauseAutoplay()),B=!1,b.params.grabCursor&&(b.container[0].style.cursor="move",b.container[0].style.cursor="-webkit-grabbing",b.container[0].style.cursor="-moz-grabbin",b.container[0].style.cursor="grabbing")),C=!0;var r=b.touches.diff=b.isHorizontal()?b.touches.currentX-b.touches.startX:b.touches.currentY-b.touches.startY;r*=b.params.touchRatio,b.rtl&&(r=-r),b.swipeDirection=r>0?"prev":"next",P=r+k;var s=!0;if(r>0&&P>b.minTranslate()?(s=!1,b.params.resistance&&(P=b.minTranslate()-1+Math.pow(-b.minTranslate()+k+r,b.params.resistanceRatio))):0>r&&P<b.maxTranslate()&&(s=!1,b.params.resistance&&(P=b.maxTranslate()+1-Math.pow(b.maxTranslate()-k-r,b.params.resistanceRatio))),
s&&(e.preventedByNestedSwiper=!0),!b.params.allowSwipeToNext&&"next"===b.swipeDirection&&k>P&&(P=k),!b.params.allowSwipeToPrev&&"prev"===b.swipeDirection&&P>k&&(P=k),b.params.followFinger){if(b.params.threshold>0){if(!(Math.abs(r)>b.params.threshold||I))return void(P=k);if(!I)return I=!0,b.touches.startX=b.touches.currentX,b.touches.startY=b.touches.currentY,P=k,void(b.touches.diff=b.isHorizontal()?b.touches.currentX-b.touches.startX:b.touches.currentY-b.touches.startY)}(b.params.freeMode||b.params.watchSlidesProgress)&&b.updateActiveIndex(),b.params.freeMode&&(0===A.length&&A.push({position:b.touches[b.isHorizontal()?"startX":"startY"],time:M}),A.push({position:b.touches[b.isHorizontal()?"currentX":"currentY"],time:(new window.Date).getTime()})),b.updateProgress(P),b.setWrapperTranslate(P)}}}}}},b.onTouchEnd=function(e){if(e.originalEvent&&(e=e.originalEvent),z&&b.emit("onTouchEnd",b,e),z=!1,S){b.params.grabCursor&&C&&S&&(b.container[0].style.cursor="move",b.container[0].style.cursor="-webkit-grab",b.container[0].style.cursor="-moz-grab",b.container[0].style.cursor="grab");var t=Date.now(),r=t-M;if(b.allowClick&&(b.updateClickedSlide(e),b.emit("onTap",b,e),300>r&&t-H>300&&(L&&clearTimeout(L),L=setTimeout(function(){b&&(b.params.paginationHide&&b.paginationContainer.length>0&&!a(e.target).hasClass(b.params.bulletClass)&&b.paginationContainer.toggleClass(b.params.paginationHiddenClass),b.emit("onClick",b,e))},300)),300>r&&300>t-H&&(L&&clearTimeout(L),b.emit("onDoubleTap",b,e))),H=Date.now(),setTimeout(function(){b&&(b.allowClick=!0)},0),!S||!C||!b.swipeDirection||0===b.touches.diff||P===k)return void(S=C=!1);S=C=!1;var i;if(i=b.params.followFinger?b.rtl?b.translate:-b.translate:-P,b.params.freeMode){if(i<-b.minTranslate())return void b.slideTo(b.activeIndex);if(i>-b.maxTranslate())return void(b.slides.length<b.snapGrid.length?b.slideTo(b.snapGrid.length-1):b.slideTo(b.slides.length-1));if(b.params.freeModeMomentum){if(A.length>1){var s=A.pop(),n=A.pop(),o=s.position-n.position,l=s.time-n.time;b.velocity=o/l,b.velocity=b.velocity/2,Math.abs(b.velocity)<b.params.freeModeMinimumVelocity&&(b.velocity=0),(l>150||(new window.Date).getTime()-s.time>300)&&(b.velocity=0)}else b.velocity=0;A.length=0;var p=1e3*b.params.freeModeMomentumRatio,d=b.velocity*p,u=b.translate+d;b.rtl&&(u=-u);var c,m=!1,h=20*Math.abs(b.velocity)*b.params.freeModeMomentumBounceRatio;if(u<b.maxTranslate())b.params.freeModeMomentumBounce?(u+b.maxTranslate()<-h&&(u=b.maxTranslate()-h),c=b.maxTranslate(),m=!0,B=!0):u=b.maxTranslate();else if(u>b.minTranslate())b.params.freeModeMomentumBounce?(u-b.minTranslate()>h&&(u=b.minTranslate()+h),c=b.minTranslate(),m=!0,B=!0):u=b.minTranslate();else if(b.params.freeModeSticky){var f,g=0;for(g=0;g<b.snapGrid.length;g+=1)if(b.snapGrid[g]>-u){f=g;break}u=Math.abs(b.snapGrid[f]-u)<Math.abs(b.snapGrid[f-1]-u)||"next"===b.swipeDirection?b.snapGrid[f]:b.snapGrid[f-1],b.rtl||(u=-u)}if(0!==b.velocity)p=b.rtl?Math.abs((-u-b.translate)/b.velocity):Math.abs((u-b.translate)/b.velocity);else if(b.params.freeModeSticky)return void b.slideReset();b.params.freeModeMomentumBounce&&m?(b.updateProgress(c),b.setWrapperTransition(p),b.setWrapperTranslate(u),b.onTransitionStart(),b.animating=!0,b.wrapper.transitionEnd(function(){b&&B&&(b.emit("onMomentumBounce",b),b.setWrapperTransition(b.params.speed),b.setWrapperTranslate(c),b.wrapper.transitionEnd(function(){b&&b.onTransitionEnd()}))})):b.velocity?(b.updateProgress(u),b.setWrapperTransition(p),b.setWrapperTranslate(u),b.onTransitionStart(),b.animating||(b.animating=!0,b.wrapper.transitionEnd(function(){b&&b.onTransitionEnd()}))):b.updateProgress(u),b.updateActiveIndex()}return void((!b.params.freeModeMomentum||r>=b.params.longSwipesMs)&&(b.updateProgress(),b.updateActiveIndex()))}var v,w=0,y=b.slidesSizesGrid[0];for(v=0;v<b.slidesGrid.length;v+=b.params.slidesPerGroup)"undefined"!=typeof b.slidesGrid[v+b.params.slidesPerGroup]?i>=b.slidesGrid[v]&&i<b.slidesGrid[v+b.params.slidesPerGroup]&&(w=v,y=b.slidesGrid[v+b.params.slidesPerGroup]-b.slidesGrid[v]):i>=b.slidesGrid[v]&&(w=v,y=b.slidesGrid[b.slidesGrid.length-1]-b.slidesGrid[b.slidesGrid.length-2]);var x=(i-b.slidesGrid[w])/y;if(r>b.params.longSwipesMs){if(!b.params.longSwipes)return void b.slideTo(b.activeIndex);"next"===b.swipeDirection&&(x>=b.params.longSwipesRatio?b.slideTo(w+b.params.slidesPerGroup):b.slideTo(w)),"prev"===b.swipeDirection&&(x>1-b.params.longSwipesRatio?b.slideTo(w+b.params.slidesPerGroup):b.slideTo(w))}else{if(!b.params.shortSwipes)return void b.slideTo(b.activeIndex);"next"===b.swipeDirection&&b.slideTo(w+b.params.slidesPerGroup),"prev"===b.swipeDirection&&b.slideTo(w)}}},b._slideTo=function(e,a){return b.slideTo(e,a,!0,!0)},b.slideTo=function(e,a,t,r){"undefined"==typeof t&&(t=!0),"undefined"==typeof e&&(e=0),0>e&&(e=0),b.snapIndex=Math.floor(e/b.params.slidesPerGroup),b.snapIndex>=b.snapGrid.length&&(b.snapIndex=b.snapGrid.length-1);var i=-b.snapGrid[b.snapIndex];b.params.autoplay&&b.autoplaying&&(r||!b.params.autoplayDisableOnInteraction?b.pauseAutoplay(a):b.stopAutoplay()),b.updateProgress(i);for(var s=0;s<b.slidesGrid.length;s++)-Math.floor(100*i)>=Math.floor(100*b.slidesGrid[s])&&(e=s);return!b.params.allowSwipeToNext&&i<b.translate&&i<b.minTranslate()?!1:!b.params.allowSwipeToPrev&&i>b.translate&&i>b.maxTranslate()&&(b.activeIndex||0)!==e?!1:("undefined"==typeof a&&(a=b.params.speed),b.previousIndex=b.activeIndex||0,b.activeIndex=e,b.rtl&&-i===b.translate||!b.rtl&&i===b.translate?(b.params.autoHeight&&b.updateAutoHeight(),b.updateClasses(),"slide"!==b.params.effect&&b.setWrapperTranslate(i),!1):(b.updateClasses(),b.onTransitionStart(t),0===a?(b.setWrapperTranslate(i),b.setWrapperTransition(0),b.onTransitionEnd(t)):(b.setWrapperTranslate(i),b.setWrapperTransition(a),b.animating||(b.animating=!0,b.wrapper.transitionEnd(function(){b&&b.onTransitionEnd(t)}))),!0))},b.onTransitionStart=function(e){"undefined"==typeof e&&(e=!0),b.params.autoHeight&&b.updateAutoHeight(),b.lazy&&b.lazy.onTransitionStart(),e&&(b.emit("onTransitionStart",b),b.activeIndex!==b.previousIndex&&(b.emit("onSlideChangeStart",b),b.activeIndex>b.previousIndex?b.emit("onSlideNextStart",b):b.emit("onSlidePrevStart",b)))},b.onTransitionEnd=function(e){b.animating=!1,b.setWrapperTransition(0),"undefined"==typeof e&&(e=!0),b.lazy&&b.lazy.onTransitionEnd(),e&&(b.emit("onTransitionEnd",b),b.activeIndex!==b.previousIndex&&(b.emit("onSlideChangeEnd",b),b.activeIndex>b.previousIndex?b.emit("onSlideNextEnd",b):b.emit("onSlidePrevEnd",b))),b.params.hashnav&&b.hashnav&&b.hashnav.setHash()},b.slideNext=function(e,a,t){if(b.params.loop){if(b.animating)return!1;b.fixLoop();b.container[0].clientLeft;return b.slideTo(b.activeIndex+b.params.slidesPerGroup,a,e,t)}return b.slideTo(b.activeIndex+b.params.slidesPerGroup,a,e,t)},b._slideNext=function(e){return b.slideNext(!0,e,!0)},b.slidePrev=function(e,a,t){if(b.params.loop){if(b.animating)return!1;b.fixLoop();b.container[0].clientLeft;return b.slideTo(b.activeIndex-1,a,e,t)}return b.slideTo(b.activeIndex-1,a,e,t)},b._slidePrev=function(e){return b.slidePrev(!0,e,!0)},b.slideReset=function(e,a,t){return b.slideTo(b.activeIndex,a,e)},b.setWrapperTransition=function(e,a){b.wrapper.transition(e),"slide"!==b.params.effect&&b.effects[b.params.effect]&&b.effects[b.params.effect].setTransition(e),b.params.parallax&&b.parallax&&b.parallax.setTransition(e),b.params.scrollbar&&b.scrollbar&&b.scrollbar.setTransition(e),b.params.control&&b.controller&&b.controller.setTransition(e,a),b.emit("onSetTransition",b,e)},b.setWrapperTranslate=function(e,a,t){var r=0,i=0,n=0;b.isHorizontal()?r=b.rtl?-e:e:i=e,b.params.roundLengths&&(r=s(r),i=s(i)),b.params.virtualTranslate||(b.support.transforms3d?b.wrapper.transform("translate3d("+r+"px, "+i+"px, "+n+"px)"):b.wrapper.transform("translate("+r+"px, "+i+"px)")),b.translate=b.isHorizontal()?r:i;var o,l=b.maxTranslate()-b.minTranslate();o=0===l?0:(e-b.minTranslate())/l,o!==b.progress&&b.updateProgress(e),a&&b.updateActiveIndex(),"slide"!==b.params.effect&&b.effects[b.params.effect]&&b.effects[b.params.effect].setTranslate(b.translate),b.params.parallax&&b.parallax&&b.parallax.setTranslate(b.translate),b.params.scrollbar&&b.scrollbar&&b.scrollbar.setTranslate(b.translate),b.params.control&&b.controller&&b.controller.setTranslate(b.translate,t),b.emit("onSetTranslate",b,b.translate)},b.getTranslate=function(e,a){var t,r,i,s;return"undefined"==typeof a&&(a="x"),b.params.virtualTranslate?b.rtl?-b.translate:b.translate:(i=window.getComputedStyle(e,null),window.WebKitCSSMatrix?(r=i.transform||i.webkitTransform,r.split(",").length>6&&(r=r.split(", ").map(function(e){return e.replace(",",".")}).join(", ")),s=new window.WebKitCSSMatrix("none"===r?"":r)):(s=i.MozTransform||i.OTransform||i.MsTransform||i.msTransform||i.transform||i.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),t=s.toString().split(",")),"x"===a&&(r=window.WebKitCSSMatrix?s.m41:16===t.length?parseFloat(t[12]):parseFloat(t[4])),"y"===a&&(r=window.WebKitCSSMatrix?s.m42:16===t.length?parseFloat(t[13]):parseFloat(t[5])),b.rtl&&r&&(r=-r),r||0)},b.getWrapperTranslate=function(e){return"undefined"==typeof e&&(e=b.isHorizontal()?"x":"y"),b.getTranslate(b.wrapper[0],e)},b.observers=[],b.initObservers=function(){if(b.params.observeParents)for(var e=b.container.parents(),a=0;a<e.length;a++)l(e[a]);l(b.container[0],{childList:!1}),l(b.wrapper[0],{attributes:!1})},b.disconnectObservers=function(){for(var e=0;e<b.observers.length;e++)b.observers[e].disconnect();b.observers=[]},b.createLoop=function(){b.wrapper.children("."+b.params.slideClass+"."+b.params.slideDuplicateClass).remove();var e=b.wrapper.children("."+b.params.slideClass);"auto"!==b.params.slidesPerView||b.params.loopedSlides||(b.params.loopedSlides=e.length),b.loopedSlides=parseInt(b.params.loopedSlides||b.params.slidesPerView,10),b.loopedSlides=b.loopedSlides+b.params.loopAdditionalSlides,b.loopedSlides>e.length&&(b.loopedSlides=e.length);var t,r=[],i=[];for(e.each(function(t,s){var n=a(this);t<b.loopedSlides&&i.push(s),t<e.length&&t>=e.length-b.loopedSlides&&r.push(s),n.attr("data-swiper-slide-index",t)}),t=0;t<i.length;t++)b.wrapper.append(a(i[t].cloneNode(!0)).addClass(b.params.slideDuplicateClass));for(t=r.length-1;t>=0;t--)b.wrapper.prepend(a(r[t].cloneNode(!0)).addClass(b.params.slideDuplicateClass))},b.destroyLoop=function(){b.wrapper.children("."+b.params.slideClass+"."+b.params.slideDuplicateClass).remove(),b.slides.removeAttr("data-swiper-slide-index")},b.reLoop=function(e){var a=b.activeIndex-b.loopedSlides;b.destroyLoop(),b.createLoop(),b.updateSlidesSize(),e&&b.slideTo(a+b.loopedSlides,0,!1)},b.fixLoop=function(){var e;b.activeIndex<b.loopedSlides?(e=b.slides.length-3*b.loopedSlides+b.activeIndex,e+=b.loopedSlides,b.slideTo(e,0,!1,!0)):("auto"===b.params.slidesPerView&&b.activeIndex>=2*b.loopedSlides||b.activeIndex>b.slides.length-2*b.params.slidesPerView)&&(e=-b.slides.length+b.activeIndex+b.loopedSlides,e+=b.loopedSlides,b.slideTo(e,0,!1,!0))},b.appendSlide=function(e){if(b.params.loop&&b.destroyLoop(),"object"==typeof e&&e.length)for(var a=0;a<e.length;a++)e[a]&&b.wrapper.append(e[a]);else b.wrapper.append(e);b.params.loop&&b.createLoop(),b.params.observer&&b.support.observer||b.update(!0)},b.prependSlide=function(e){b.params.loop&&b.destroyLoop();var a=b.activeIndex+1;if("object"==typeof e&&e.length){for(var t=0;t<e.length;t++)e[t]&&b.wrapper.prepend(e[t]);a=b.activeIndex+e.length}else b.wrapper.prepend(e);b.params.loop&&b.createLoop(),b.params.observer&&b.support.observer||b.update(!0),b.slideTo(a,0,!1)},b.removeSlide=function(e){b.params.loop&&(b.destroyLoop(),b.slides=b.wrapper.children("."+b.params.slideClass));var a,t=b.activeIndex;if("object"==typeof e&&e.length){for(var r=0;r<e.length;r++)a=e[r],b.slides[a]&&b.slides.eq(a).remove(),t>a&&t--;t=Math.max(t,0)}else a=e,b.slides[a]&&b.slides.eq(a).remove(),t>a&&t--,t=Math.max(t,0);b.params.loop&&b.createLoop(),b.params.observer&&b.support.observer||b.update(!0),b.params.loop?b.slideTo(t+b.loopedSlides,0,!1):b.slideTo(t,0,!1)},b.removeAllSlides=function(){for(var e=[],a=0;a<b.slides.length;a++)e.push(a);b.removeSlide(e)},b.effects={fade:{setTranslate:function(){for(var e=0;e<b.slides.length;e++){var a=b.slides.eq(e),t=a[0].swiperSlideOffset,r=-t;b.params.virtualTranslate||(r-=b.translate);var i=0;b.isHorizontal()||(i=r,r=0);var s=b.params.fade.crossFade?Math.max(1-Math.abs(a[0].progress),0):1+Math.min(Math.max(a[0].progress,-1),0);a.css({opacity:s}).transform("translate3d("+r+"px, "+i+"px, 0px)")}},setTransition:function(e){if(b.slides.transition(e),b.params.virtualTranslate&&0!==e){var a=!1;b.slides.transitionEnd(function(){if(!a&&b){a=!0,b.animating=!1;for(var e=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],t=0;t<e.length;t++)b.wrapper.trigger(e[t])}})}}},flip:{setTranslate:function(){for(var e=0;e<b.slides.length;e++){var t=b.slides.eq(e),r=t[0].progress;b.params.flip.limitRotation&&(r=Math.max(Math.min(t[0].progress,1),-1));var i=t[0].swiperSlideOffset,s=-180*r,n=s,o=0,l=-i,p=0;if(b.isHorizontal()?b.rtl&&(n=-n):(p=l,l=0,o=-n,n=0),t[0].style.zIndex=-Math.abs(Math.round(r))+b.slides.length,b.params.flip.slideShadows){var d=b.isHorizontal()?t.find(".swiper-slide-shadow-left"):t.find(".swiper-slide-shadow-top"),u=b.isHorizontal()?t.find(".swiper-slide-shadow-right"):t.find(".swiper-slide-shadow-bottom");0===d.length&&(d=a('<div class="swiper-slide-shadow-'+(b.isHorizontal()?"left":"top")+'"></div>'),t.append(d)),0===u.length&&(u=a('<div class="swiper-slide-shadow-'+(b.isHorizontal()?"right":"bottom")+'"></div>'),t.append(u)),d.length&&(d[0].style.opacity=Math.max(-r,0)),u.length&&(u[0].style.opacity=Math.max(r,0))}t.transform("translate3d("+l+"px, "+p+"px, 0px) rotateX("+o+"deg) rotateY("+n+"deg)")}},setTransition:function(e){if(b.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),b.params.virtualTranslate&&0!==e){var t=!1;b.slides.eq(b.activeIndex).transitionEnd(function(){if(!t&&b&&a(this).hasClass(b.params.slideActiveClass)){t=!0,b.animating=!1;for(var e=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],r=0;r<e.length;r++)b.wrapper.trigger(e[r])}})}}},cube:{setTranslate:function(){var e,t=0;b.params.cube.shadow&&(b.isHorizontal()?(e=b.wrapper.find(".swiper-cube-shadow"),0===e.length&&(e=a('<div class="swiper-cube-shadow"></div>'),b.wrapper.append(e)),e.css({height:b.width+"px"})):(e=b.container.find(".swiper-cube-shadow"),0===e.length&&(e=a('<div class="swiper-cube-shadow"></div>'),b.container.append(e))));for(var r=0;r<b.slides.length;r++){var i=b.slides.eq(r),s=90*r,n=Math.floor(s/360);b.rtl&&(s=-s,n=Math.floor(-s/360));var o=Math.max(Math.min(i[0].progress,1),-1),l=0,p=0,d=0;r%4===0?(l=4*-n*b.size,d=0):(r-1)%4===0?(l=0,d=4*-n*b.size):(r-2)%4===0?(l=b.size+4*n*b.size,d=b.size):(r-3)%4===0&&(l=-b.size,d=3*b.size+4*b.size*n),b.rtl&&(l=-l),b.isHorizontal()||(p=l,l=0);var u="rotateX("+(b.isHorizontal()?0:-s)+"deg) rotateY("+(b.isHorizontal()?s:0)+"deg) translate3d("+l+"px, "+p+"px, "+d+"px)";if(1>=o&&o>-1&&(t=90*r+90*o,b.rtl&&(t=90*-r-90*o)),i.transform(u),b.params.cube.slideShadows){var c=b.isHorizontal()?i.find(".swiper-slide-shadow-left"):i.find(".swiper-slide-shadow-top"),m=b.isHorizontal()?i.find(".swiper-slide-shadow-right"):i.find(".swiper-slide-shadow-bottom");0===c.length&&(c=a('<div class="swiper-slide-shadow-'+(b.isHorizontal()?"left":"top")+'"></div>'),i.append(c)),0===m.length&&(m=a('<div class="swiper-slide-shadow-'+(b.isHorizontal()?"right":"bottom")+'"></div>'),i.append(m)),c.length&&(c[0].style.opacity=Math.max(-o,0)),m.length&&(m[0].style.opacity=Math.max(o,0))}}if(b.wrapper.css({"-webkit-transform-origin":"50% 50% -"+b.size/2+"px","-moz-transform-origin":"50% 50% -"+b.size/2+"px","-ms-transform-origin":"50% 50% -"+b.size/2+"px","transform-origin":"50% 50% -"+b.size/2+"px"}),b.params.cube.shadow)if(b.isHorizontal())e.transform("translate3d(0px, "+(b.width/2+b.params.cube.shadowOffset)+"px, "+-b.width/2+"px) rotateX(90deg) rotateZ(0deg) scale("+b.params.cube.shadowScale+")");else{var h=Math.abs(t)-90*Math.floor(Math.abs(t)/90),f=1.5-(Math.sin(2*h*Math.PI/360)/2+Math.cos(2*h*Math.PI/360)/2),g=b.params.cube.shadowScale,v=b.params.cube.shadowScale/f,w=b.params.cube.shadowOffset;e.transform("scale3d("+g+", 1, "+v+") translate3d(0px, "+(b.height/2+w)+"px, "+-b.height/2/v+"px) rotateX(-90deg)")}var y=b.isSafari||b.isUiWebView?-b.size/2:0;b.wrapper.transform("translate3d(0px,0,"+y+"px) rotateX("+(b.isHorizontal()?0:t)+"deg) rotateY("+(b.isHorizontal()?-t:0)+"deg)")},setTransition:function(e){b.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),b.params.cube.shadow&&!b.isHorizontal()&&b.container.find(".swiper-cube-shadow").transition(e)}},coverflow:{setTranslate:function(){for(var e=b.translate,t=b.isHorizontal()?-e+b.width/2:-e+b.height/2,r=b.isHorizontal()?b.params.coverflow.rotate:-b.params.coverflow.rotate,i=b.params.coverflow.depth,s=0,n=b.slides.length;n>s;s++){var o=b.slides.eq(s),l=b.slidesSizesGrid[s],p=o[0].swiperSlideOffset,d=(t-p-l/2)/l*b.params.coverflow.modifier,u=b.isHorizontal()?r*d:0,c=b.isHorizontal()?0:r*d,m=-i*Math.abs(d),h=b.isHorizontal()?0:b.params.coverflow.stretch*d,f=b.isHorizontal()?b.params.coverflow.stretch*d:0;Math.abs(f)<.001&&(f=0),Math.abs(h)<.001&&(h=0),Math.abs(m)<.001&&(m=0),Math.abs(u)<.001&&(u=0),Math.abs(c)<.001&&(c=0);var g="translate3d("+f+"px,"+h+"px,"+m+"px)  rotateX("+c+"deg) rotateY("+u+"deg)";if(o.transform(g),o[0].style.zIndex=-Math.abs(Math.round(d))+1,b.params.coverflow.slideShadows){var v=b.isHorizontal()?o.find(".swiper-slide-shadow-left"):o.find(".swiper-slide-shadow-top"),w=b.isHorizontal()?o.find(".swiper-slide-shadow-right"):o.find(".swiper-slide-shadow-bottom");0===v.length&&(v=a('<div class="swiper-slide-shadow-'+(b.isHorizontal()?"left":"top")+'"></div>'),o.append(v)),0===w.length&&(w=a('<div class="swiper-slide-shadow-'+(b.isHorizontal()?"right":"bottom")+'"></div>'),o.append(w)),v.length&&(v[0].style.opacity=d>0?d:0),w.length&&(w[0].style.opacity=-d>0?-d:0)}}if(b.browser.ie){var y=b.wrapper[0].style;y.perspectiveOrigin=t+"px 50%"}},setTransition:function(e){b.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e)}}},b.lazy={initialImageLoaded:!1,loadImageInSlide:function(e,t){if("undefined"!=typeof e&&("undefined"==typeof t&&(t=!0),0!==b.slides.length)){var r=b.slides.eq(e),i=r.find(".swiper-lazy:not(.swiper-lazy-loaded):not(.swiper-lazy-loading)");!r.hasClass("swiper-lazy")||r.hasClass("swiper-lazy-loaded")||r.hasClass("swiper-lazy-loading")||(i=i.add(r[0])),0!==i.length&&i.each(function(){var e=a(this);e.addClass("swiper-lazy-loading");var i=e.attr("data-background"),s=e.attr("data-src"),n=e.attr("data-srcset");b.loadImage(e[0],s||i,n,!1,function(){if(i?(e.css("background-image",'url("'+i+'")'),e.removeAttr("data-background")):(n&&(e.attr("srcset",n),e.removeAttr("data-srcset")),s&&(e.attr("src",s),e.removeAttr("data-src"))),e.addClass("swiper-lazy-loaded").removeClass("swiper-lazy-loading"),r.find(".swiper-lazy-preloader, .preloader").remove(),b.params.loop&&t){var a=r.attr("data-swiper-slide-index");if(r.hasClass(b.params.slideDuplicateClass)){var o=b.wrapper.children('[data-swiper-slide-index="'+a+'"]:not(.'+b.params.slideDuplicateClass+")");b.lazy.loadImageInSlide(o.index(),!1)}else{var l=b.wrapper.children("."+b.params.slideDuplicateClass+'[data-swiper-slide-index="'+a+'"]');b.lazy.loadImageInSlide(l.index(),!1)}}b.emit("onLazyImageReady",b,r[0],e[0])}),b.emit("onLazyImageLoad",b,r[0],e[0])})}},load:function(){var e;if(b.params.watchSlidesVisibility)b.wrapper.children("."+b.params.slideVisibleClass).each(function(){b.lazy.loadImageInSlide(a(this).index())});else if(b.params.slidesPerView>1)for(e=b.activeIndex;e<b.activeIndex+b.params.slidesPerView;e++)b.slides[e]&&b.lazy.loadImageInSlide(e);else b.lazy.loadImageInSlide(b.activeIndex);if(b.params.lazyLoadingInPrevNext)if(b.params.slidesPerView>1||b.params.lazyLoadingInPrevNextAmount&&b.params.lazyLoadingInPrevNextAmount>1){var t=b.params.lazyLoadingInPrevNextAmount,r=b.params.slidesPerView,i=Math.min(b.activeIndex+r+Math.max(t,r),b.slides.length),s=Math.max(b.activeIndex-Math.max(r,t),0);for(e=b.activeIndex+b.params.slidesPerView;i>e;e++)b.slides[e]&&b.lazy.loadImageInSlide(e);for(e=s;e<b.activeIndex;e++)b.slides[e]&&b.lazy.loadImageInSlide(e)}else{var n=b.wrapper.children("."+b.params.slideNextClass);n.length>0&&b.lazy.loadImageInSlide(n.index());var o=b.wrapper.children("."+b.params.slidePrevClass);o.length>0&&b.lazy.loadImageInSlide(o.index())}},onTransitionStart:function(){b.params.lazyLoading&&(b.params.lazyLoadingOnTransitionStart||!b.params.lazyLoadingOnTransitionStart&&!b.lazy.initialImageLoaded)&&b.lazy.load()},onTransitionEnd:function(){b.params.lazyLoading&&!b.params.lazyLoadingOnTransitionStart&&b.lazy.load()}},b.scrollbar={isTouched:!1,setDragPosition:function(e){var a=b.scrollbar,t=b.isHorizontal()?"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].pageX:e.pageX||e.clientX:"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].pageY:e.pageY||e.clientY,r=t-a.track.offset()[b.isHorizontal()?"left":"top"]-a.dragSize/2,i=-b.minTranslate()*a.moveDivider,s=-b.maxTranslate()*a.moveDivider;i>r?r=i:r>s&&(r=s),r=-r/a.moveDivider,b.updateProgress(r),b.setWrapperTranslate(r,!0)},dragStart:function(e){var a=b.scrollbar;a.isTouched=!0,e.preventDefault(),e.stopPropagation(),a.setDragPosition(e),clearTimeout(a.dragTimeout),a.track.transition(0),b.params.scrollbarHide&&a.track.css("opacity",1),b.wrapper.transition(100),a.drag.transition(100),b.emit("onScrollbarDragStart",b)},dragMove:function(e){var a=b.scrollbar;a.isTouched&&(e.preventDefault?e.preventDefault():e.returnValue=!1,a.setDragPosition(e),b.wrapper.transition(0),a.track.transition(0),a.drag.transition(0),b.emit("onScrollbarDragMove",b))},dragEnd:function(e){var a=b.scrollbar;a.isTouched&&(a.isTouched=!1,b.params.scrollbarHide&&(clearTimeout(a.dragTimeout),a.dragTimeout=setTimeout(function(){a.track.css("opacity",0),a.track.transition(400)},1e3)),b.emit("onScrollbarDragEnd",b),b.params.scrollbarSnapOnRelease&&b.slideReset())},enableDraggable:function(){var e=b.scrollbar,t=b.support.touch?e.track:document;a(e.track).on(b.touchEvents.start,e.dragStart),a(t).on(b.touchEvents.move,e.dragMove),a(t).on(b.touchEvents.end,e.dragEnd)},disableDraggable:function(){var e=b.scrollbar,t=b.support.touch?e.track:document;a(e.track).off(b.touchEvents.start,e.dragStart),a(t).off(b.touchEvents.move,e.dragMove),a(t).off(b.touchEvents.end,e.dragEnd)},set:function(){if(b.params.scrollbar){var e=b.scrollbar;e.track=a(b.params.scrollbar),b.params.uniqueNavElements&&"string"==typeof b.params.scrollbar&&e.track.length>1&&1===b.container.find(b.params.scrollbar).length&&(e.track=b.container.find(b.params.scrollbar)),e.drag=e.track.find(".swiper-scrollbar-drag"),0===e.drag.length&&(e.drag=a('<div class="swiper-scrollbar-drag"></div>'),e.track.append(e.drag)),e.drag[0].style.width="",e.drag[0].style.height="",e.trackSize=b.isHorizontal()?e.track[0].offsetWidth:e.track[0].offsetHeight,e.divider=b.size/b.virtualSize,e.moveDivider=e.divider*(e.trackSize/b.size),e.dragSize=e.trackSize*e.divider,b.isHorizontal()?e.drag[0].style.width=e.dragSize+"px":e.drag[0].style.height=e.dragSize+"px",e.divider>=1?e.track[0].style.display="none":e.track[0].style.display="",b.params.scrollbarHide&&(e.track[0].style.opacity=0)}},setTranslate:function(){if(b.params.scrollbar){var e,a=b.scrollbar,t=(b.translate||0,a.dragSize);e=(a.trackSize-a.dragSize)*b.progress,b.rtl&&b.isHorizontal()?(e=-e,e>0?(t=a.dragSize-e,e=0):-e+a.dragSize>a.trackSize&&(t=a.trackSize+e)):0>e?(t=a.dragSize+e,e=0):e+a.dragSize>a.trackSize&&(t=a.trackSize-e),b.isHorizontal()?(b.support.transforms3d?a.drag.transform("translate3d("+e+"px, 0, 0)"):a.drag.transform("translateX("+e+"px)"),a.drag[0].style.width=t+"px"):(b.support.transforms3d?a.drag.transform("translate3d(0px, "+e+"px, 0)"):a.drag.transform("translateY("+e+"px)"),a.drag[0].style.height=t+"px"),b.params.scrollbarHide&&(clearTimeout(a.timeout),a.track[0].style.opacity=1,a.timeout=setTimeout(function(){a.track[0].style.opacity=0,a.track.transition(400)},1e3))}},setTransition:function(e){b.params.scrollbar&&b.scrollbar.drag.transition(e)}},b.controller={LinearSpline:function(e,a){this.x=e,this.y=a,this.lastIndex=e.length-1;var t,r;this.x.length;this.interpolate=function(e){return e?(r=i(this.x,e),t=r-1,(e-this.x[t])*(this.y[r]-this.y[t])/(this.x[r]-this.x[t])+this.y[t]):0};var i=function(){var e,a,t;return function(r,i){for(a=-1,e=r.length;e-a>1;)r[t=e+a>>1]<=i?a=t:e=t;return e}}()},getInterpolateFunction:function(e){b.controller.spline||(b.controller.spline=b.params.loop?new b.controller.LinearSpline(b.slidesGrid,e.slidesGrid):new b.controller.LinearSpline(b.snapGrid,e.snapGrid))},setTranslate:function(e,a){function r(a){e=a.rtl&&"horizontal"===a.params.direction?-b.translate:b.translate,"slide"===b.params.controlBy&&(b.controller.getInterpolateFunction(a),s=-b.controller.spline.interpolate(-e)),s&&"container"!==b.params.controlBy||(i=(a.maxTranslate()-a.minTranslate())/(b.maxTranslate()-b.minTranslate()),s=(e-b.minTranslate())*i+a.minTranslate()),b.params.controlInverse&&(s=a.maxTranslate()-s),a.updateProgress(s),a.setWrapperTranslate(s,!1,b),a.updateActiveIndex()}var i,s,n=b.params.control;if(b.isArray(n))for(var o=0;o<n.length;o++)n[o]!==a&&n[o]instanceof t&&r(n[o]);else n instanceof t&&a!==n&&r(n)},setTransition:function(e,a){function r(a){a.setWrapperTransition(e,b),0!==e&&(a.onTransitionStart(),a.wrapper.transitionEnd(function(){s&&(a.params.loop&&"slide"===b.params.controlBy&&a.fixLoop(),a.onTransitionEnd())}))}var i,s=b.params.control;if(b.isArray(s))for(i=0;i<s.length;i++)s[i]!==a&&s[i]instanceof t&&r(s[i]);else s instanceof t&&a!==s&&r(s)}},b.hashnav={init:function(){if(b.params.hashnav){b.hashnav.initialized=!0;var e=document.location.hash.replace("#","");if(e)for(var a=0,t=0,r=b.slides.length;r>t;t++){var i=b.slides.eq(t),s=i.attr("data-hash");if(s===e&&!i.hasClass(b.params.slideDuplicateClass)){var n=i.index();b.slideTo(n,a,b.params.runCallbacksOnInit,!0)}}}},setHash:function(){b.hashnav.initialized&&b.params.hashnav&&(document.location.hash=b.slides.eq(b.activeIndex).attr("data-hash")||"")}},b.disableKeyboardControl=function(){b.params.keyboardControl=!1,a(document).off("keydown",p)},b.enableKeyboardControl=function(){b.params.keyboardControl=!0,a(document).on("keydown",p)},b.mousewheel={event:!1,lastScrollTime:(new window.Date).getTime()},b.params.mousewheelControl){try{new window.WheelEvent("wheel"),b.mousewheel.event="wheel"}catch(N){(window.WheelEvent||b.container[0]&&"wheel"in b.container[0])&&(b.mousewheel.event="wheel")}!b.mousewheel.event&&window.WheelEvent,b.mousewheel.event||void 0===document.onmousewheel||(b.mousewheel.event="mousewheel"),b.mousewheel.event||(b.mousewheel.event="DOMMouseScroll")}b.disableMousewheelControl=function(){return b.mousewheel.event?(b.container.off(b.mousewheel.event,d),!0):!1},b.enableMousewheelControl=function(){return b.mousewheel.event?(b.container.on(b.mousewheel.event,d),!0):!1},b.parallax={setTranslate:function(){b.container.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){u(this,b.progress)}),b.slides.each(function(){var e=a(this);e.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var a=Math.min(Math.max(e[0].progress,-1),1);u(this,a)})})},setTransition:function(e){"undefined"==typeof e&&(e=b.params.speed),b.container.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var t=a(this),r=parseInt(t.attr("data-swiper-parallax-duration"),10)||e;0===e&&(r=0),t.transition(r)})}},b._plugins=[];for(var R in b.plugins){var W=b.plugins[R](b,b.params[R]);W&&b._plugins.push(W)}return b.callPlugins=function(e){for(var a=0;a<b._plugins.length;a++)e in b._plugins[a]&&b._plugins[a][e](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},b.emitterEventListeners={},b.emit=function(e){b.params[e]&&b.params[e](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);var a;if(b.emitterEventListeners[e])for(a=0;a<b.emitterEventListeners[e].length;a++)b.emitterEventListeners[e][a](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);b.callPlugins&&b.callPlugins(e,arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},b.on=function(e,a){return e=c(e),b.emitterEventListeners[e]||(b.emitterEventListeners[e]=[]),b.emitterEventListeners[e].push(a),b},b.off=function(e,a){var t;if(e=c(e),"undefined"==typeof a)return b.emitterEventListeners[e]=[],b;if(b.emitterEventListeners[e]&&0!==b.emitterEventListeners[e].length){for(t=0;t<b.emitterEventListeners[e].length;t++)b.emitterEventListeners[e][t]===a&&b.emitterEventListeners[e].splice(t,1);return b}},b.once=function(e,a){e=c(e);var t=function(){a(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),b.off(e,t)};return b.on(e,t),b},b.a11y={makeFocusable:function(e){return e.attr("tabIndex","0"),e},addRole:function(e,a){return e.attr("role",a),e},addLabel:function(e,a){return e.attr("aria-label",a),e},disable:function(e){return e.attr("aria-disabled",!0),e},enable:function(e){return e.attr("aria-disabled",!1),e},onEnterKey:function(e){13===e.keyCode&&(a(e.target).is(b.params.nextButton)?(b.onClickNext(e),b.isEnd?b.a11y.notify(b.params.lastSlideMessage):b.a11y.notify(b.params.nextSlideMessage)):a(e.target).is(b.params.prevButton)&&(b.onClickPrev(e),b.isBeginning?b.a11y.notify(b.params.firstSlideMessage):b.a11y.notify(b.params.prevSlideMessage)),a(e.target).is("."+b.params.bulletClass)&&a(e.target)[0].click())},liveRegion:a('<span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span>'),notify:function(e){var a=b.a11y.liveRegion;0!==a.length&&(a.html(""),a.html(e))},init:function(){b.params.nextButton&&b.nextButton&&b.nextButton.length>0&&(b.a11y.makeFocusable(b.nextButton),b.a11y.addRole(b.nextButton,"button"),b.a11y.addLabel(b.nextButton,b.params.nextSlideMessage)),b.params.prevButton&&b.prevButton&&b.prevButton.length>0&&(b.a11y.makeFocusable(b.prevButton),b.a11y.addRole(b.prevButton,"button"),b.a11y.addLabel(b.prevButton,b.params.prevSlideMessage)),a(b.container).append(b.a11y.liveRegion)},initPagination:function(){b.params.pagination&&b.params.paginationClickable&&b.bullets&&b.bullets.length&&b.bullets.each(function(){var e=a(this);b.a11y.makeFocusable(e),b.a11y.addRole(e,"button"),b.a11y.addLabel(e,b.params.paginationBulletMessage.replace(/{{index}}/,e.index()+1))})},destroy:function(){b.a11y.liveRegion&&b.a11y.liveRegion.length>0&&b.a11y.liveRegion.remove()}},b.init=function(){b.params.loop&&b.createLoop(),b.updateContainerSize(),b.updateSlidesSize(),b.updatePagination(),b.params.scrollbar&&b.scrollbar&&(b.scrollbar.set(),b.params.scrollbarDraggable&&b.scrollbar.enableDraggable()),"slide"!==b.params.effect&&b.effects[b.params.effect]&&(b.params.loop||b.updateProgress(),b.effects[b.params.effect].setTranslate()),b.params.loop?b.slideTo(b.params.initialSlide+b.loopedSlides,0,b.params.runCallbacksOnInit):(b.slideTo(b.params.initialSlide,0,b.params.runCallbacksOnInit),0===b.params.initialSlide&&(b.parallax&&b.params.parallax&&b.parallax.setTranslate(),b.lazy&&b.params.lazyLoading&&(b.lazy.load(),b.lazy.initialImageLoaded=!0))),b.attachEvents(),b.params.observer&&b.support.observer&&b.initObservers(),b.params.preloadImages&&!b.params.lazyLoading&&b.preloadImages(),b.params.autoplay&&b.startAutoplay(),b.params.keyboardControl&&b.enableKeyboardControl&&b.enableKeyboardControl(),b.params.mousewheelControl&&b.enableMousewheelControl&&b.enableMousewheelControl(),
b.params.hashnav&&b.hashnav&&b.hashnav.init(),b.params.a11y&&b.a11y&&b.a11y.init(),b.emit("onInit",b)},b.cleanupStyles=function(){b.container.removeClass(b.classNames.join(" ")).removeAttr("style"),b.wrapper.removeAttr("style"),b.slides&&b.slides.length&&b.slides.removeClass([b.params.slideVisibleClass,b.params.slideActiveClass,b.params.slideNextClass,b.params.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-column").removeAttr("data-swiper-row"),b.paginationContainer&&b.paginationContainer.length&&b.paginationContainer.removeClass(b.params.paginationHiddenClass),b.bullets&&b.bullets.length&&b.bullets.removeClass(b.params.bulletActiveClass),b.params.prevButton&&a(b.params.prevButton).removeClass(b.params.buttonDisabledClass),b.params.nextButton&&a(b.params.nextButton).removeClass(b.params.buttonDisabledClass),b.params.scrollbar&&b.scrollbar&&(b.scrollbar.track&&b.scrollbar.track.length&&b.scrollbar.track.removeAttr("style"),b.scrollbar.drag&&b.scrollbar.drag.length&&b.scrollbar.drag.removeAttr("style"))},b.destroy=function(e,a){b.detachEvents(),b.stopAutoplay(),b.params.scrollbar&&b.scrollbar&&b.params.scrollbarDraggable&&b.scrollbar.disableDraggable(),b.params.loop&&b.destroyLoop(),a&&b.cleanupStyles(),b.disconnectObservers(),b.params.keyboardControl&&b.disableKeyboardControl&&b.disableKeyboardControl(),b.params.mousewheelControl&&b.disableMousewheelControl&&b.disableMousewheelControl(),b.params.a11y&&b.a11y&&b.a11y.destroy(),b.emit("onDestroy"),e!==!1&&(b=null)},b.init(),b}};t.prototype={isSafari:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("safari")>=0&&e.indexOf("chrome")<0&&e.indexOf("android")<0}(),isUiWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},browser:{ie:window.navigator.pointerEnabled||window.navigator.msPointerEnabled,ieTouch:window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>1||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>1},device:function(){var e=navigator.userAgent,a=e.match(/(Android);?[\s\/]+([\d.]+)?/),t=e.match(/(iPad).*OS\s([\d_]+)/),r=e.match(/(iPod)(.*OS\s([\d_]+))?/),i=!t&&e.match(/(iPhone\sOS)\s([\d_]+)/);return{ios:t||i||r,android:a}}(),support:{touch:window.Modernizr&&Modernizr.touch===!0||function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}(),transforms3d:window.Modernizr&&Modernizr.csstransforms3d===!0||function(){var e=document.createElement("div").style;return"webkitPerspective"in e||"MozPerspective"in e||"OPerspective"in e||"MsPerspective"in e||"perspective"in e}(),flexbox:function(){for(var e=document.createElement("div").style,a="alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient".split(" "),t=0;t<a.length;t++)if(a[t]in e)return!0}(),observer:function(){return"MutationObserver"in window||"WebkitMutationObserver"in window}()},plugins:{}};for(var r=(function(){var e=function(e){var a=this,t=0;for(t=0;t<e.length;t++)a[t]=e[t];return a.length=e.length,this},a=function(a,t){var r=[],i=0;if(a&&!t&&a instanceof e)return a;if(a)if("string"==typeof a){var s,n,o=a.trim();if(o.indexOf("<")>=0&&o.indexOf(">")>=0){var l="div";for(0===o.indexOf("<li")&&(l="ul"),0===o.indexOf("<tr")&&(l="tbody"),(0===o.indexOf("<td")||0===o.indexOf("<th"))&&(l="tr"),0===o.indexOf("<tbody")&&(l="table"),0===o.indexOf("<option")&&(l="select"),n=document.createElement(l),n.innerHTML=a,i=0;i<n.childNodes.length;i++)r.push(n.childNodes[i])}else for(s=t||"#"!==a[0]||a.match(/[ .<>:~]/)?(t||document).querySelectorAll(a):[document.getElementById(a.split("#")[1])],i=0;i<s.length;i++)s[i]&&r.push(s[i])}else if(a.nodeType||a===window||a===document)r.push(a);else if(a.length>0&&a[0].nodeType)for(i=0;i<a.length;i++)r.push(a[i]);return new e(r)};return e.prototype={addClass:function(e){if("undefined"==typeof e)return this;for(var a=e.split(" "),t=0;t<a.length;t++)for(var r=0;r<this.length;r++)this[r].classList.add(a[t]);return this},removeClass:function(e){for(var a=e.split(" "),t=0;t<a.length;t++)for(var r=0;r<this.length;r++)this[r].classList.remove(a[t]);return this},hasClass:function(e){return this[0]?this[0].classList.contains(e):!1},toggleClass:function(e){for(var a=e.split(" "),t=0;t<a.length;t++)for(var r=0;r<this.length;r++)this[r].classList.toggle(a[t]);return this},attr:function(e,a){if(1===arguments.length&&"string"==typeof e)return this[0]?this[0].getAttribute(e):void 0;for(var t=0;t<this.length;t++)if(2===arguments.length)this[t].setAttribute(e,a);else for(var r in e)this[t][r]=e[r],this[t].setAttribute(r,e[r]);return this},removeAttr:function(e){for(var a=0;a<this.length;a++)this[a].removeAttribute(e);return this},data:function(e,a){if("undefined"!=typeof a){for(var t=0;t<this.length;t++){var r=this[t];r.dom7ElementDataStorage||(r.dom7ElementDataStorage={}),r.dom7ElementDataStorage[e]=a}return this}if(this[0]){var i=this[0].getAttribute("data-"+e);return i?i:this[0].dom7ElementDataStorage&&e in this[0].dom7ElementDataStorage?this[0].dom7ElementDataStorage[e]:void 0}},transform:function(e){for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransform=t.MsTransform=t.msTransform=t.MozTransform=t.OTransform=t.transform=e}return this},transition:function(e){"string"!=typeof e&&(e+="ms");for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransitionDuration=t.MsTransitionDuration=t.msTransitionDuration=t.MozTransitionDuration=t.OTransitionDuration=t.transitionDuration=e}return this},on:function(e,t,r,i){function s(e){var i=e.target;if(a(i).is(t))r.call(i,e);else for(var s=a(i).parents(),n=0;n<s.length;n++)a(s[n]).is(t)&&r.call(s[n],e)}var n,o,l=e.split(" ");for(n=0;n<this.length;n++)if("function"==typeof t||t===!1)for("function"==typeof t&&(r=arguments[1],i=arguments[2]||!1),o=0;o<l.length;o++)this[n].addEventListener(l[o],r,i);else for(o=0;o<l.length;o++)this[n].dom7LiveListeners||(this[n].dom7LiveListeners=[]),this[n].dom7LiveListeners.push({listener:r,liveListener:s}),this[n].addEventListener(l[o],s,i);return this},off:function(e,a,t,r){for(var i=e.split(" "),s=0;s<i.length;s++)for(var n=0;n<this.length;n++)if("function"==typeof a||a===!1)"function"==typeof a&&(t=arguments[1],r=arguments[2]||!1),this[n].removeEventListener(i[s],t,r);else if(this[n].dom7LiveListeners)for(var o=0;o<this[n].dom7LiveListeners.length;o++)this[n].dom7LiveListeners[o].listener===t&&this[n].removeEventListener(i[s],this[n].dom7LiveListeners[o].liveListener,r);return this},once:function(e,a,t,r){function i(n){t(n),s.off(e,a,i,r)}var s=this;"function"==typeof a&&(a=!1,t=arguments[1],r=arguments[2]),s.on(e,a,i,r)},trigger:function(e,a){for(var t=0;t<this.length;t++){var r;try{r=new window.CustomEvent(e,{detail:a,bubbles:!0,cancelable:!0})}catch(i){r=document.createEvent("Event"),r.initEvent(e,!0,!0),r.detail=a}this[t].dispatchEvent(r)}return this},transitionEnd:function(e){function a(s){if(s.target===this)for(e.call(this,s),t=0;t<r.length;t++)i.off(r[t],a)}var t,r=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],i=this;if(e)for(t=0;t<r.length;t++)i.on(r[t],a);return this},width:function(){return this[0]===window?window.innerWidth:this.length>0?parseFloat(this.css("width")):null},outerWidth:function(e){return this.length>0?e?this[0].offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this[0].offsetWidth:null},height:function(){return this[0]===window?window.innerHeight:this.length>0?parseFloat(this.css("height")):null},outerHeight:function(e){return this.length>0?e?this[0].offsetHeight+parseFloat(this.css("margin-top"))+parseFloat(this.css("margin-bottom")):this[0].offsetHeight:null},offset:function(){if(this.length>0){var e=this[0],a=e.getBoundingClientRect(),t=document.body,r=e.clientTop||t.clientTop||0,i=e.clientLeft||t.clientLeft||0,s=window.pageYOffset||e.scrollTop,n=window.pageXOffset||e.scrollLeft;return{top:a.top+s-r,left:a.left+n-i}}return null},css:function(e,a){var t;if(1===arguments.length){if("string"!=typeof e){for(t=0;t<this.length;t++)for(var r in e)this[t].style[r]=e[r];return this}if(this[0])return window.getComputedStyle(this[0],null).getPropertyValue(e)}if(2===arguments.length&&"string"==typeof e){for(t=0;t<this.length;t++)this[t].style[e]=a;return this}return this},each:function(e){for(var a=0;a<this.length;a++)e.call(this[a],a,this[a]);return this},html:function(e){if("undefined"==typeof e)return this[0]?this[0].innerHTML:void 0;for(var a=0;a<this.length;a++)this[a].innerHTML=e;return this},text:function(e){if("undefined"==typeof e)return this[0]?this[0].textContent.trim():null;for(var a=0;a<this.length;a++)this[a].textContent=e;return this},is:function(t){if(!this[0])return!1;var r,i;if("string"==typeof t){var s=this[0];if(s===document)return t===document;if(s===window)return t===window;if(s.matches)return s.matches(t);if(s.webkitMatchesSelector)return s.webkitMatchesSelector(t);if(s.mozMatchesSelector)return s.mozMatchesSelector(t);if(s.msMatchesSelector)return s.msMatchesSelector(t);for(r=a(t),i=0;i<r.length;i++)if(r[i]===this[0])return!0;return!1}if(t===document)return this[0]===document;if(t===window)return this[0]===window;if(t.nodeType||t instanceof e){for(r=t.nodeType?[t]:t,i=0;i<r.length;i++)if(r[i]===this[0])return!0;return!1}return!1},index:function(){if(this[0]){for(var e=this[0],a=0;null!==(e=e.previousSibling);)1===e.nodeType&&a++;return a}},eq:function(a){if("undefined"==typeof a)return this;var t,r=this.length;return a>r-1?new e([]):0>a?(t=r+a,new e(0>t?[]:[this[t]])):new e([this[a]])},append:function(a){var t,r;for(t=0;t<this.length;t++)if("string"==typeof a){var i=document.createElement("div");for(i.innerHTML=a;i.firstChild;)this[t].appendChild(i.firstChild)}else if(a instanceof e)for(r=0;r<a.length;r++)this[t].appendChild(a[r]);else this[t].appendChild(a);return this},prepend:function(a){var t,r;for(t=0;t<this.length;t++)if("string"==typeof a){var i=document.createElement("div");for(i.innerHTML=a,r=i.childNodes.length-1;r>=0;r--)this[t].insertBefore(i.childNodes[r],this[t].childNodes[0])}else if(a instanceof e)for(r=0;r<a.length;r++)this[t].insertBefore(a[r],this[t].childNodes[0]);else this[t].insertBefore(a,this[t].childNodes[0]);return this},insertBefore:function(e){for(var t=a(e),r=0;r<this.length;r++)if(1===t.length)t[0].parentNode.insertBefore(this[r],t[0]);else if(t.length>1)for(var i=0;i<t.length;i++)t[i].parentNode.insertBefore(this[r].cloneNode(!0),t[i])},insertAfter:function(e){for(var t=a(e),r=0;r<this.length;r++)if(1===t.length)t[0].parentNode.insertBefore(this[r],t[0].nextSibling);else if(t.length>1)for(var i=0;i<t.length;i++)t[i].parentNode.insertBefore(this[r].cloneNode(!0),t[i].nextSibling)},next:function(t){return new e(this.length>0?t?this[0].nextElementSibling&&a(this[0].nextElementSibling).is(t)?[this[0].nextElementSibling]:[]:this[0].nextElementSibling?[this[0].nextElementSibling]:[]:[])},nextAll:function(t){var r=[],i=this[0];if(!i)return new e([]);for(;i.nextElementSibling;){var s=i.nextElementSibling;t?a(s).is(t)&&r.push(s):r.push(s),i=s}return new e(r)},prev:function(t){return new e(this.length>0?t?this[0].previousElementSibling&&a(this[0].previousElementSibling).is(t)?[this[0].previousElementSibling]:[]:this[0].previousElementSibling?[this[0].previousElementSibling]:[]:[])},prevAll:function(t){var r=[],i=this[0];if(!i)return new e([]);for(;i.previousElementSibling;){var s=i.previousElementSibling;t?a(s).is(t)&&r.push(s):r.push(s),i=s}return new e(r)},parent:function(e){for(var t=[],r=0;r<this.length;r++)e?a(this[r].parentNode).is(e)&&t.push(this[r].parentNode):t.push(this[r].parentNode);return a(a.unique(t))},parents:function(e){for(var t=[],r=0;r<this.length;r++)for(var i=this[r].parentNode;i;)e?a(i).is(e)&&t.push(i):t.push(i),i=i.parentNode;return a(a.unique(t))},find:function(a){for(var t=[],r=0;r<this.length;r++)for(var i=this[r].querySelectorAll(a),s=0;s<i.length;s++)t.push(i[s]);return new e(t)},children:function(t){for(var r=[],i=0;i<this.length;i++)for(var s=this[i].childNodes,n=0;n<s.length;n++)t?1===s[n].nodeType&&a(s[n]).is(t)&&r.push(s[n]):1===s[n].nodeType&&r.push(s[n]);return new e(a.unique(r))},remove:function(){for(var e=0;e<this.length;e++)this[e].parentNode&&this[e].parentNode.removeChild(this[e]);return this},add:function(){var e,t,r=this;for(e=0;e<arguments.length;e++){var i=a(arguments[e]);for(t=0;t<i.length;t++)r[r.length]=i[t],r.length++}return r}},a.fn=e.prototype,a.unique=function(e){for(var a=[],t=0;t<e.length;t++)-1===a.indexOf(e[t])&&a.push(e[t]);return a},a}()),i=["jQuery","Zepto","Dom7"],s=0;s<i.length;s++)window[i[s]]&&e(window[i[s]]);var n;n="undefined"==typeof r?window.Dom7||window.Zepto||window.jQuery:r,n&&("transitionEnd"in n.fn||(n.fn.transitionEnd=function(e){function a(s){if(s.target===this)for(e.call(this,s),t=0;t<r.length;t++)i.off(r[t],a)}var t,r=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],i=this;if(e)for(t=0;t<r.length;t++)i.on(r[t],a);return this}),"transform"in n.fn||(n.fn.transform=function(e){for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransform=t.MsTransform=t.msTransform=t.MozTransform=t.OTransform=t.transform=e}return this}),"transition"in n.fn||(n.fn.transition=function(e){"string"!=typeof e&&(e+="ms");for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransitionDuration=t.MsTransitionDuration=t.msTransitionDuration=t.MozTransitionDuration=t.OTransitionDuration=t.transitionDuration=e}return this})),window.Swiper=t}(),"undefined"!=typeof module?module.exports=window.Swiper:"function"==typeof define&&define.amd&&define([],function(){"use strict";return window.Swiper});
//# sourceMappingURL=maps/swiper.min.js.map
angular.module('uguru.ui', [])
.controller('UIMainController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  function($scope, $state, $timeout) {

  }
])

var logOb;
angular.module('uguru.shared.services', [])
angular.module('uguru.shared.services')

.factory('$localstorage', ['$window', '$timeout',
  function($window, $timeout) {

  var downloadRecords = JSON.parse($window.localStorage['download_records'] || '{"files": []}');
  var downloadPromise = null;

  var isLocalStorageSupported = true;
  try {
    $window.localStorage["test"] = "test";
    $window.localStorage.removeItem('test');
  } catch (error) {
    //alert('Your web browser does not support storing settings locally. In Safari, the most common cause of this is using "Private Browsing Mode". Some settings may not save or some features may not work properly for you.');
    isLocalStorageSupported = false;
  }

  return {
    set: function(key, value) {
      if(isLocalStorageSupported)
      $window.localStorage[key] = value;
    },
    get: function(key, defaultValue) {
      return $window.localStorage[key] || defaultValue;
    },
    setObject: function(key, value) {
      if(isLocalStorageSupported)
      $window.localStorage[key] = JSON.stringify(value);
    },
    getObject: function(key) {
      return JSON.parse($window.localStorage[key] || '[]');
    },
    removeObject: function(key) {
      $window.localStorage.removeItem(key);
    },

    // TODO: Seems like mixpanel allows up to 255 properties per object, so we'll need to create
    // additional logs to store as the count reaches the limit
    storeDownloadRecords: function(obj) {

      downloadRecords.files.push(obj);
      if(downloadPromise) {
        $timeout.cancel(downloadPromise);
      }
      downloadPromise = $timeout(function() {

        var totalSize = 0;
        var totalTime = 0;
        for(var i=0; i<downloadRecords.files.length; i++) {
          totalSize += downloadRecords.files[i].size_kb;
          totalTime += (downloadRecords.files[i].time_ms / 1000);
        }
        var downloadSpeed = (totalSize/totalTime).toFixed(2);

        downloadRecords.downloadSpeed = downloadSpeed;
        $window.localStorage['download_records'] = JSON.stringify(downloadRecords);

        downloadPromise = null;

        // uTracker.track(tracker, 'Network Info', {
        //   "$Download_Speed": downloadSpeed,
        //   "$Network_Type": navigator.connection.type
        // });

      }, 7000);
    },

    init: function()
    {

        window.resolveLocalFileSystemURL(cordova.file.dataDirectory, function(dir) {
        dir.getFile("log.txt", {create:true}, function(file) {
          logOb = file;
        var str = "App started";
        if(!logOb) return;
        var log = str + " [" + (new Date()) + "]\n";
        logOb.createWriter(function(fileWriter) {

          fileWriter.seek(fileWriter.length);

          var blob = new Blob([log], {type:'text/plain'});
          fileWriter.write(blob);
        }, fail);
        });
      });
    },
    writeLog: function(str)
    {
      if(!logOb) return;
      var log = str + " [" + (new Date()) + "]\n";
      logOb.createWriter(function(fileWriter) {

        fileWriter.seek(fileWriter.length);

        var blob = new Blob([log], {type:'text/plain'});
        fileWriter.write(blob);
  }, fail);
    }


  };
}]);
angular
.module('uguru.shared.services')
.factory('LoaderService', [
    '$rootScope',
    'CompService',
    LoaderService
    ]);

function LoaderService($rootScope, CompService) {
    var loaderAttrs = ['min-ms', 'enter-ms', 'exit-ms'];
    return {
        getDefaultLoader: getDefaultLoader,
        getParentBgColor: getParentBgColor,
        setInheritedCSS: setInheritedCSS,
        renderLoaderAttrs: renderLoaderAttrs
    }

    function getDefaultLoader() {

    }

    function renderLoaderAttrs(scope, attr, loader_info) {

        var attrDict = loader_info || {};
        for (attr_name in attr.$attr) {

            if (loaderAttrs.indexOf(attr.$attr[attr_name]) > -1) {


                attrDict[attr_name] = attr[attr_name];
            }
        }
        if (attrDict.minMs) {
            attrDict.minMs = parseInt(attrDict.minMs);
        }

        if (attrDict.exitMs) {
            attrDict.exitMs = parseInt(attrDict.exitMs);
        }
        if (attrDict.enterMs) {
            attrDict.enterMs = parseInt(attrDict.enterMs);
        }


        return attrDict;
    }

    function setInheritedCSS(elem, info_dict){

        // info_dict.width = info_dict.width + 100
        for (prop in info_dict) {
            CompService.css.apply(elem, prop, info_dict[prop]);
        }
    }

    function getParentBgColor(elem, attr, bg_opacity) {
        bg_opacity = bg_opacity || 0.8
        var bgColor = CompService.getParentBackgroundColor(elem);

        if ('background' in bgColor && bgColor.background.indexOf('rgba(0, 0, 0, 0)') === -1
                && ((bgColor.background.indexOf('rgb') > -1) || (bgColor.background.indexOf('rgba') > -1))
            ) {

            return bgColor.background;
        } else {
            var bodyBackground = window.getComputedStyle(document.body)['background'];
            if (bodyBackground.indexOf('rgb(') > -1) {
                var rgbStr = 'rgba(' + bodyBackground.split('rgb(')[1].split(')')[0] + ', ' + bg_opacity + ')';
                return rgbStr;
            }
        }
    }


}
angular.module('uguru.shared.services')
.factory("AnimationService", [
    '$ionicViewSwitcher',
    '$timeout',
    '$state',
    'RootService',
    AnimationService
        ]);

function AnimationService($ionicViewSwitcher, $timeout, $state, RootService) {

    return {
        // slide: slide,
        flip: flip,
        animateIn: animateIn,
        animate: animate,
        initAnimationObj: initAnimationObj,
        animateOut: animateOut,
        applyAnimateInDirective: applyAnimateInDirective,
        applyAnimateOutDirective: applyAnimateOutDirective,
        initCSSAnimation: initCSSAnimation,
        getCSSAnimationFromClassName: getCSSAnimationFromClassName,
        getAnimationObjFromAnimationName: getAnimationObjFromAnimationName,
        getAnimatableTemplateFunc: getAnimatableTemplateFunc,
        injectAnimationWithPlayer: injectAnimationWithPlayer,
        getStartListener: getStartListener,
        getEndListener: getEndListener
    }

    function getAnimatableTemplateFunc(element, attr) {
      var styleStr = '';
      if (attr.size) {
          styleStr += 'width:' + attr.size + 'px;'
          styleStr += 'height:' + attr.size + 'px;'
      }
      if (attr.stroke) {
          styleStr += 'stroke:' + attr.stroke + 'px;'
          element.children().css('stroke', attr.stroke);
      }
      styleStr += RootService.formatBrowserCSSProperty('animation-name') +':{{anim.name}};'
      styleStr += RootService.formatBrowserCSSProperty('animation-iteration-count') +':{{anim.iter}} !important;'
      styleStr += RootService.formatBrowserCSSProperty('animation-fill-mode') +':{{anim.fill}} !important;'
      styleStr += RootService.formatBrowserCSSProperty('animation-duration') +':{{anim.duration}}ms !important;'
      styleStr += RootService.formatBrowserCSSProperty('animation-timing-function') +':{{anim.func}} !important;'
      styleStr += RootService.formatBrowserCSSProperty('animation-delay') +':{{anim.delay}}ms !important;'
      styleStr += RootService.formatBrowserCSSProperty('animation-play-state') +':{{anim.playState}}'
      attr.$set('style', styleStr);
      return attr.template
    }

    function getStartListener(anim, element) {
      return function(cb) {
        var browserPrefix = RootService.getBrowserPrefix();
        var startAnimationEvent = 'animationStart';
        if (browserPrefix && browserPrefix.length) {
          startAnimationEvent = browserPrefix + 'AnimationStart';
        }
        return element.addEventListener(startAnimationEvent, function(e) {
            cb && cb(e);
        })
      }
    }

    function getEndListener(anim, element) {

      return function(cb) {
        var browserPrefix = RootService.getBrowserPrefix();
        var startAnimationEvent = 'animationEnd';
        if (browserPrefix && browserPrefix.length) {
          startAnimationEvent = browserPrefix + 'AnimationEnd';
        }
        return element.addEventListener(startAnimationEvent, function(e) {
            cb && cb();

            if (browserPrefix) {
              console.log('pausing');
              e.target.style[browserPrefix + 'AnimationPlayState'] = 'paused';
            } else {
              e.target.style['animationPlayState'] = 'paused';
            }
            e.target.style.offsetWidth = e.target.style.offsetWidth;
            console.log('animation ending', e.target);
        })
      }

    }

    function initAnimationObj() {

      return {
        name: null,
        template: null,
        duration: null,
        css: {
          name: RootService.formatBrowserCSSProperty('animation-name'),
          iter: RootService.formatBrowserCSSProperty('animation-iteration-count'),
          fill: RootService.formatBrowserCSSProperty('animation-fill-mode'),
          duration: RootService.formatBrowserCSSProperty('animation-duration'),
          tf: RootService.formatBrowserCSSProperty('animation-timing-function'),
          direction: RootService.formatBrowserCSSProperty('animation-direction'),
          delay: RootService.formatBrowserCSSProperty('animation-delay'),
          play: RootService.formatBrowserCSSProperty('animation-play-state')
        }
      }
    }

    function getBrowserPrefix() {
        var browserPrefix;
        navigator.sayswho= (function(){
          var N = navigator.appName, ua = navigator.userAgent, tem;
          var M = ua.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);
          if(M && (tem = ua.match(/version\/([\.\d]+)/i))!= null) M[2] = tem[1];
          M = M? [M[1], M[2]]: [N, navigator.appVersion,'-?'];
          M = M[0];
          if(M == "Chrome") { browserPrefix = "webkit"; }
          if(M == "Firefox") { browserPrefix = "moz"; }
          if(M == "Safari") { browserPrefix = "webkit"; }
          if(M == "MSIE") { browserPrefix = "ms"; }
        })();
        return browserPrefix;


    }

    function getCSSAnimationFromClassName(anim_class) {
      var ss = document.styleSheets;
      for (var i = 0; i < ss.length; ++i) {
          if (ss[i].cssRules && ss[i].cssRules.length) {

              var animationName;
              for (var j = 0; j < ss[i].cssRules.length; ++j) {
                if (ss[i].cssRules[j].type == window.CSSRule.STYLE_RULE) {
                  if (ss[i].cssRules[j].selectorText === '.' + anim_class) {
                    if (ss[i].cssRules[j].style && (ss[i].cssRules[j].style.animation || ss[i].cssRules[j].style.webkitAnimation)) {
                      var animationString = ss[i].cssRules[j].style.animation || ss[i].cssRules[j].style.webkitAnimation

                      if (animationString.split(' ').length >= 2) {
                        animationName = animationString.split(' ')[0];
                        animationObj = getAnimationObjFromAnimationName(animationName)
                        if (animationObj) {
                          return animationObj;
                        }
                      }
                    }
                  }
                }
              }
              // if (!animationName) return;
              // console.log('found', animationName);
          }
      }
    }

    function getAnimationObjFromAnimationName(anim_name) {
      var ss = document.styleSheets;
      for (var i = 0; i < ss.length; ++i) {
        if (!ss[i] || !ss[i].cssRules) {
          continue;
        }
        for (var j = 0; j < ss[i].cssRules.length; ++j) {
            if (ss[i].cssRules[j].type == window.CSSRule.WEBKIT_KEYFRAMES_RULE) {
              if (ss[i].cssRules[j].name === anim_name) {
                return ss[i].cssRules[j];
              }
            }
          }
      }
    }

    function injectAnimationWithPlayer(anim_obj, elem, cb, _window) {
        var elemCoords = elem[0].getBoundingClientRect();
        elemCoords.height = elemCoords.height/10.0;
        elemCoords.width =  elemCoords.width/10.0;
        var dx = Math.abs(elemCoords.width - _window.width);
        var dy = Math.abs(elemCoords.height - _window.height);

        div = document.createElement('div');
        div.innerHTML = '<animation-player anim=anim></player>'
        div.style.zIndex = 100000;

        if (dx/_window.width < 0.1) {
          div.classList.add('bottom-0', 'left-0', 'full-x', 'fixed');
          var elem = document.querySelector('ui-view');
          elem.appendChild(div);
        } else {
          div.classList.add('relative', 'animated', 'slideInUp');
          elem[0].parentNode.appendChild(div);
        }
        cb && cb(div);
    }

    function initCSSAnimation(anim_name, options) {
        var browserPrefix = getBrowserPrefix();
        var lastSheet = document.styleSheets[document.styleSheets.length - 1];
        var indexOfRuleInSheet = lastSheet.insertRule("@-" + browserPrefix + "-keyframes " + anim_name + " { } ");
        return lastSheet.cssRules[indexOfRuleInSheet];
    }

    function prefixedEventListener(element, type, callback) {
      var pfx = ["webkit", "moz", "MS", "o", ""];
      for (var p = 0; p < pfx.length; p++) {
          if (!pfx[p]) type = type.toLowerCase();
          element.addEventListener(pfx[p]+type, callback, false);
      }
    }

    // function initSlide() {
    //  if(DeviceService.isMobile() && window.plugins.nativepagetransitions) {
    //      window.plugins.nativepagetransitions.slide({
    //          "direction": "right",
    //          "duration" : 10,
    //          "slowdownfactor": 1,
    //          "iosdelay": 10,
    //          "androiddelay": 10
    //      }, successMsg, errorMsg);
    //  }

    // }

     function activateSectionAnimations(elements, css_arr, delay_arr) {
        if (!elements || !elements.length) {
            return;
        }
        for (var i = 0; i < elements.length; i ++) {
          animateIn(elements[i], css_arr[i], delay_arr[i]);
        }
      }

    function initializeSectionComponents(section_var, selector_arr, css_arr, delay_arr) {
        for (var i = 0; i < selector_arr.length; i++) {
          var indexSelector = selector_arr[i];
          var elem = document.querySelector(indexSelector);
          if (!elem) {
            continue
          }
          if (!section_var.elements) {
            section_var.elements = [elem];
          } else {
            section_var.elements.push(elem);
          }
        }
     }

    function applyAnimateOutDirective(element, type) {
        var children = element.querySelectorAll("[anim-" + type + "-child]");
        if (children.length) {
            for (var i = 0; i < children.length; i++) {
                var indexChild = children[i];
                var animationClassesToInject = indexChild.getAttribute('anim-' + type +'-class') && indexChild.getAttribute('anim-' + type +'-class').split(', ');
                var animationDelaysToInject = indexChild.getAttribute('anim-' + type +'-delay') && indexChild.getAttribute('anim-' + type +'-delay').split(', ');
                if (!animationClassesToInject) {
                    continue;
                }
                if (!animationDelaysToInject) {
                    animationDelaysToInject = [0,0,0,0,0];
                }
                for (var j = 0; j < animationClassesToInject.length; j++) {
                    var indexClassOfChild = animationClassesToInject[j] || '';
                    var indexOffsetOfChild = animationDelaysToInject[j] || 0;
                    if (indexClassOfChild && indexClassOfChild.length) {
                        animateOut(indexChild, indexClassOfChild, indexOffsetOfChild || 0 );
                    }
                }
                // var animationOnCompleteExpr = indexChild.getAttribute('anim-exit-up-complete');
            }
        } else {
              var animationClassToInject = element.attributes['anim-' + type +'-class'] && element.getAttribute('anim-' + type + '-class').split(', ');
              var animationDelaysToInject = element.attributes['anim-' + type + '-delay'] && element.getAttribute('anim-' + type + '-delay').split(', ');
              if (!animationClassToInject || !animationClassToInject.length) {
                return;
              }
              if (!animationDelaysToInject) {
                    animationDelaysToInject = [0,0,0,0,0];
                }
              for (var i = 0; i < animationClassToInject.length; i++) {
                var indexClassOfParent= animationClassToInject[i] || '';
                var indexOffsetOfParent = animationDelaysToInject[i] || 0;
                if (indexClassOfParent && indexClassOfParent.length) {
                    animateOut(element, indexClassOfParent, indexOffsetOfParent || 0 );
                }
              }
        }
    }

    function applyAnimateInDirective(element, type) {
        var children = element.querySelectorAll("[anim-" + type + "-child]");
        if (children.length) {
            for (var i = 0; i < children.length; i++) {
                var indexChild = children[i];
                var animationClassesToInject = indexChild.getAttribute('anim-' + type +'-class') && indexChild.getAttribute('anim-' + type +'-class').split(', ');
                var animationDelaysToInject = indexChild.getAttribute('anim-' + type +'-delay') && indexChild.getAttribute('anim-' + type +'-delay').split(', ');
                if (!animationClassesToInject) {
                    continue;
                }
                if (!animationDelaysToInject) {
                    animationDelaysToInject = [0,0,0,0,0];
                }
                for (var j = 0; j < animationClassesToInject.length; j++) {
                    var indexClassOfChild = animationClassesToInject[j] || '';
                    var indexOffsetOfChild = animationDelaysToInject[j] || 0;
                    if (indexClassOfChild && indexClassOfChild.length) {
                        animateIn(indexChild, indexClassOfChild, indexOffsetOfChild || 0 );
                    }
                }
                // var animationOnCompleteExpr = indexChild.getAttribute('anim-exit-up-complete');
            }
        } else {
              var animationClassToInject = element.attributes['anim-' + type +'-class'] && element.getAttribute('anim-' + type + '-class').split(', ')
              var animationDelaysToInject = element.attributes['anim-' + type + '-delay'] && element.getAttribute('anim-' + type + '-delay').split(', ')

              if (!animationClassToInject || !animationClassToInject.length) {
                return;
              }
              if (!animationDelaysToInject) {
                    animationDelaysToInject = [0,0,0,0,0];
                }
              for (var i = 0; i < animationClassToInject.length; i++) {
                var indexClassOfParent= animationClassToInject[i] || '';
                var indexOffsetOfParent = animationDelaysToInject[i] || 0;
                if (indexClassOfParent && indexClassOfParent.length) {
                    animateIn(element, indexClassOfParent, indexOffsetOfParent || 0 );
                }
              }
        }
    }

    function animate(elem, css_class, anim_obj, delay) {
      if (delay) {
        $timeout(function() {
          console.log('DELAY: ' + delay + ' applying w/ delay', elem, css_class, anim_obj, 'n\n\n\n');
          prefixedEventListener(elem,"AnimationStart", animationStartListener);
          prefixedEventListener(elem,"AnimationEnd", animationEndListener);
          elem.classList.add('animated', css_class);
        }, delay)
      } else {
        prefixedEventListener(elem,"AnimationStart", animationStartListener);
        prefixedEventListener(elem,"AnimationEnd", animationEndListener);
        elem.classList.add('animated', css_class);
      }

      function animationStartListener(e)
      {
        // console.log('animation has began');
        var lastKFSorted = getLastKFsorted(anim_obj.cssRules)
        var formattedKFCssText = lastKFSorted.cssText.split('{')[1].replace('}', '').trim();
        elem.style.cssText +=formattedKFCssText;
        elem.removeEventListener( e.type, animationStartListener);
      }
      function animationEndListener(e)
      {

        elem.classList.remove(css_class, "animated");
        elem.removeEventListener( e.type, animationEndListener);
      }
    }

    function getLastKFsorted(css_rules) {
      var keyFrames = [];

      for (property in css_rules) {
        if ((property || property === 0) && css_rules[property].type === window.CSSRule.WEBKIT_KEYFRAME_RULE) {
          keyFrames.push(css_rules[property]);
        }
      }
      keyFrames.sort(function(kf_a, kf_b) {
        return parseFloat(kf_b.keyText.replace("%")) - parseFloat(kf_b.keyText.replace("%"))
      }).reverse()
      if (keyFrames.length) {
        // console.log('last keyframe', keyFrames[0]);
        return keyFrames[0]
      }
    }

    function animateIn(elem, css_class, delay) {
        if (!elem || !css_class) {
            return;
        }
        var cssClassArgs = getCSSArgs(css_class)
        elem.classList.remove('animated');
        if (delay) {
          $timeout(function() {
              elem.classList.add('animated', cssClassArgs.class);
              prefixedEventListener(elem,"AnimationStart",function(e){
                elem.style.opacity = 1;
                e.target.removeEventListener(e.type, false);
              });
              prefixedEventListener(elem,"AnimationEnd",function(e){
                  if (cssClassArgs.keep) {
                      elem.classList.remove("animated");
                  } else {
                      elem.classList.remove(cssClassArgs.class, "animated");
                  }
                  e.target.removeEventListener(e.type, false);
              });
          }, delay || 0);
        }
      }

    function animateIn(elem, css_class, delay) {
        if (!elem || !css_class) {
            return;
        }
        var cssClassArgs = getCSSArgs(css_class)
        elem.classList.remove('animated');
        if (delay) {
          $timeout(function() {
              elem.classList.add('animated', cssClassArgs.class);
              prefixedEventListener(elem,"AnimationStart",function(e){
                elem.style.opacity = 1;
                e.target.removeEventListener(e.type, false);
              });
              prefixedEventListener(elem,"AnimationEnd",function(e){
                  if (cssClassArgs.keep) {
                      elem.classList.remove("animated");
                  } else {
                      elem.classList.remove(cssClassArgs.class, "animated");
                  }
                  e.target.removeEventListener(e.type, false);
              });
          }, delay || 0);
        } else {
            elem.classList.add('animated', cssClassArgs.class);
            prefixedEventListener(elem,"AnimationStart",function(e){
              elem.style.opacity = 1;
              e.target.removeEventListener(e.type, false);
            });
            prefixedEventListener(elem,"AnimationEnd",function(e){
                if (cssClassArgs.keep) {
                    elem.classList.remove("animated");
                } else {
                    elem.classList.remove(cssClassArgs.class, "animated");
                }
                e.target.removeEventListener(e.type, false);
            });
        }
    }

    function animateOut(elem, css_class, delay) {

        if (!elem || !css_class) {
            return;
        }
        var cssClassArgs = getCSSArgs(css_class)

        if (delay) {
          $timeout(function() {
              elem.classList.add('animated', cssClassArgs.class);
              prefixedEventListener(elem,"AnimationStart",function(e){
                  elem.style.opacity = 0;
                  e.target.removeEventListener(e.type, false);
              });

              prefixedEventListener(elem,"AnimationEnd",function(e){
                  if (cssClassArgs.keep) {
                          elem.classList.remove("animated");
                  } else {
                      elem.classList.remove(cssClassArgs.class, "animated");
                  }
                  e.target.removeEventListener(e.type, false);
              })

          }, delay || 0);
        } else {
            elem.classList.add('animated', cssClassArgs.class);
            prefixedEventListener(elem,"AnimationStart",function(e){
                elem.style.opacity = 0;
                e.target.removeEventListener(e.type, false);
            });

            prefixedEventListener(elem,"AnimationEnd",function(e){
                if (cssClassArgs.keep) {
                        elem.classList.remove("animated");
                } else {
                    elem.classList.remove(cssClassArgs.class, "animated");
                }
                e.target.removeEventListener(e.type, false);
            })
        }
    }

    function getCSSArgs(class_name) {
        var class_split = class_name.split(':');
        class_name = class_split[0];
        var css_args_dict = {}
        if (class_split.length > 1) {
            css_args_dict.class = class_name;
            class_args = class_split.splice(1);
            for (var i = 0; i < class_args.length; i++) {
                var indexArg  = class_args[i];
                css_args_dict[indexArg] = true;
            }
            return css_args_dict;
        } else {
            return {class: class_name};
        }
    }




    function shakeElem(elem, duration, callback) {

        Velocity(elem, "transition.expandIn", {duration:duration});
        callback && callback();
    }

    function fadeOutElem(elem, duration) {
        Velocity(elem, "fadeOut", {duration:duration});
    }



    //customOptions is optional, if none are set then default options will be used
    function flip(target, customOptions, params, cb) {

        var pane = document.querySelectorAll('body')[0];

        pane.style.transition = '.400s';
        pane.style.transform = 'rotateY(90deg)';
        pane.style.webkitkitTransition = '.400s';
        pane.style.webkitTransform = 'rotateY(90deg)';

        $timeout(function() {
            pane.style.transition = '0.00s';
            pane.style.transform = 'rotateY(-90deg)';
            pane.style.webkitTtransition = '0.00s';
            pane.style.webkitTransform = 'rotateY(-90deg)';
            $ionicViewSwitcher.nextDirection('none');
            if (!params) {
                $state.go(target);
            } else {
                $state.go(target, params);
            }
            $timeout(function() {

                pane.style.transition = '.400s';
                pane.style.transform = 'rotateY(0deg)';
                pane.style.webkitTransition = '.400s';
                pane.style.webkitTransform = 'rotateY(0deg)';
            }, 40);
        }, 440);
        $timeout(function() {
            cb && cb();
        }, 500)

    }

    function successMsg() {
    }

    function errorMsg(error) {
        console.error("Error with AnimationService: " + error);
    }

}


// Generated by CoffeeScript 1.7.1
(function() {
  var Color, DecomposedMatrix, DecomposedMatrix2D, InterpolableArray, InterpolableColor, InterpolableNumber, InterpolableObject, InterpolableString, Matrix, Matrix2D, Set, Vector, addTimeout, animationTick, animations, animationsTimeouts, applyDefaults, applyFrame, applyProperties, baseSVG, cacheFn, cancelTimeout, clone, createInterpolable, defaultValueForKey, degProperties, dynamics, getCurrentProperties, interpolate, isDocumentVisible, isSVGElement, lastTime, leftDelayForTimeout, makeArrayFn, observeVisibilityChange, parseProperties, prefixFor, propertyWithPrefix, pxProperties, rAF, roundf, runLoopPaused, runLoopRunning, runLoopTick, setRealTimeout, slow, slowRatio, startAnimation, startRunLoop, svgProperties, timeBeforeVisibilityChange, timeoutLastId, timeouts, toDashed, transformProperties, transformValueForProperty, unitForProperty,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  isDocumentVisible = function() {
    return document.visibilityState === "visible" || (dynamics.tests != null);
  };

  observeVisibilityChange = (function() {
    var fns;
    fns = [];
    if (typeof document !== "undefined" && document !== null) {
      document.addEventListener("visibilitychange", function() {
        var fn, _i, _len, _results;
        _results = [];
        for (_i = 0, _len = fns.length; _i < _len; _i++) {
          fn = fns[_i];
          _results.push(fn(isDocumentVisible()));
        }
        return _results;
      });
    }
    return function(fn) {
      return fns.push(fn);
    };
  })();

  clone = function(o) {
    var k, newO, v;
    newO = {};
    for (k in o) {
      v = o[k];
      newO[k] = v;
    }
    return newO;
  };

  cacheFn = function(func) {
    var data;
    data = {};
    return function() {
      var k, key, result, _i, _len;
      key = "";
      for (_i = 0, _len = arguments.length; _i < _len; _i++) {
        k = arguments[_i];
        key += k.toString() + ",";
      }
      result = data[key];
      if (!result) {
        data[key] = result = func.apply(this, arguments);
      }
      return result;
    };
  };

  makeArrayFn = function(fn) {
    return function(el) {
      var args, i, res;
      if (el instanceof Array || el instanceof NodeList || el instanceof HTMLCollection) {
        res = (function() {
          var _i, _ref, _results;
          _results = [];
          for (i = _i = 0, _ref = el.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
            args = Array.prototype.slice.call(arguments, 1);
            args.splice(0, 0, el[i]);
            _results.push(fn.apply(this, args));
          }
          return _results;
        }).apply(this, arguments);
        return res;
      }
      return fn.apply(this, arguments);
    };
  };

  applyDefaults = function(options, defaults) {
    var k, v, _results;
    _results = [];
    for (k in defaults) {
      v = defaults[k];
      _results.push(options[k] != null ? options[k] : options[k] = v);
    }
    return _results;
  };

  applyFrame = function(el, properties) {
    var k, v, _results;
    if ((el.style != null)) {
      return applyProperties(el, properties);
    } else {
      _results = [];
      for (k in properties) {
        v = properties[k];
        _results.push(el[k] = v.format());
      }
      return _results;
    }
  };

  applyProperties = function(el, properties) {
    var isSVG, k, matrix, transforms, v;
    properties = parseProperties(properties);
    transforms = [];
    isSVG = isSVGElement(el);
    for (k in properties) {
      v = properties[k];
      if (transformProperties.contains(k)) {
        transforms.push([k, v]);
      } else {
        if (v.format != null) {
          v = v.format();
        }
        if (typeof v === 'number') {
          v = "" + v + (unitForProperty(k, v));
        }
        if (isSVG && svgProperties.contains(k)) {
          el.setAttribute(k, v);
        } else {
          el.style[propertyWithPrefix(k)] = v;
        }
      }
    }
    if (transforms.length > 0) {
      if (isSVG) {
        matrix = new Matrix2D();
        matrix.applyProperties(transforms);
        return el.setAttribute("transform", matrix.decompose().format());
      } else {
        v = (transforms.map(function(transform) {
          return transformValueForProperty(transform[0], transform[1]);
        })).join(" ");
        return el.style[propertyWithPrefix("transform")] = v;
      }
    }
  };

  isSVGElement = function(el) {
    var _ref, _ref1;
    if ((typeof SVGElement !== "undefined" && SVGElement !== null) && (typeof SVGSVGElement !== "undefined" && SVGSVGElement !== null)) {
      return el instanceof SVGElement && !(el instanceof SVGSVGElement);
    } else {
      return (_ref = (_ref1 = dynamics.tests) != null ? typeof _ref1.isSVG === "function" ? _ref1.isSVG(el) : void 0 : void 0) != null ? _ref : false;
    }
  };

  roundf = function(v, decimal) {
    var d;
    d = Math.pow(10, decimal);
    return Math.round(v * d) / d;
  };

  Set = (function() {
    function Set(array) {
      var v, _i, _len;
      this.obj = {};
      for (_i = 0, _len = array.length; _i < _len; _i++) {
        v = array[_i];
        this.obj[v] = 1;
      }
    }

    Set.prototype.contains = function(v) {
      return this.obj[v] === 1;
    };

    return Set;

  })();

  toDashed = function(str) {
    return str.replace(/([A-Z])/g, function($1) {
      return "-" + $1.toLowerCase();
    });
  };

  pxProperties = new Set('marginTop,marginLeft,marginBottom,marginRight,paddingTop,paddingLeft,paddingBottom,paddingRight,top,left,bottom,right,translateX,translateY,translateZ,perspectiveX,perspectiveY,perspectiveZ,width,height,maxWidth,maxHeight,minWidth,minHeight,borderRadius'.split(','));

  degProperties = new Set('rotate,rotateX,rotateY,rotateZ,skew,skewX,skewY,skewZ'.split(','));

  transformProperties = new Set('translate,translateX,translateY,translateZ,scale,scaleX,scaleY,scaleZ,rotate,rotateX,rotateY,rotateZ,rotateC,rotateCX,rotateCY,skew,skewX,skewY,skewZ,perspective'.split(','));

  svgProperties = new Set('accent-height,ascent,azimuth,baseFrequency,baseline-shift,bias,cx,cy,d,diffuseConstant,divisor,dx,dy,elevation,filterRes,fx,fy,gradientTransform,height,k1,k2,k3,k4,kernelMatrix,kernelUnitLength,letter-spacing,limitingConeAngle,markerHeight,markerWidth,numOctaves,order,overline-position,overline-thickness,pathLength,points,pointsAtX,pointsAtY,pointsAtZ,r,radius,rx,ry,seed,specularConstant,specularExponent,stdDeviation,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,surfaceScale,target,targetX,targetY,transform,underline-position,underline-thickness,viewBox,width,x,x1,x2,y,y1,y2,z'.split(','));

  unitForProperty = function(k, v) {
    if (typeof v !== 'number') {
      return '';
    }
    if (pxProperties.contains(k)) {
      return 'px';
    } else if (degProperties.contains(k)) {
      return 'deg';
    }
    return '';
  };

  transformValueForProperty = function(k, v) {
    var match, unit;
    match = ("" + v).match(/^([0-9.-]*)([^0-9]*)$/);
    if (match != null) {
      v = match[1];
      unit = match[2];
    } else {
      v = parseFloat(v);
    }
    v = roundf(parseFloat(v), 10);
    if ((unit == null) || unit === "") {
      unit = unitForProperty(k, v);
    }
    return "" + k + "(" + v + unit + ")";
  };

  parseProperties = function(properties) {
    var axis, match, parsed, property, value, _i, _len, _ref;
    parsed = {};
    for (property in properties) {
      value = properties[property];
      if (transformProperties.contains(property)) {
        match = property.match(/(translate|rotateC|rotate|skew|scale|perspective)(X|Y|Z|)/);
        if (match && match[2].length > 0) {
          parsed[property] = value;
        } else {
          _ref = ['X', 'Y', 'Z'];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            axis = _ref[_i];
            parsed[match[1] + axis] = value;
          }
        }
      } else {
        parsed[property] = value;
      }
    }
    return parsed;
  };

  defaultValueForKey = function(key) {
    var v;
    v = key === 'opacity' ? 1 : 0;
    return "" + v + (unitForProperty(key, v));
  };

  getCurrentProperties = function(el, keys) {
    var isSVG, key, matrix, properties, style, v, _i, _j, _len, _len1, _ref;
    properties = {};
    isSVG = isSVGElement(el);
    if (el.style != null) {
      style = window.getComputedStyle(el, null);
      for (_i = 0, _len = keys.length; _i < _len; _i++) {
        key = keys[_i];
        if (transformProperties.contains(key)) {
          if (properties['transform'] == null) {
            if (isSVG) {
              matrix = new Matrix2D((_ref = el.transform.baseVal.consolidate()) != null ? _ref.matrix : void 0);
            } else {
              matrix = Matrix.fromTransform(style[propertyWithPrefix('transform')]);
            }
            properties['transform'] = matrix.decompose();
          }
        } else {
          v = style[key];
          if ((v == null) && svgProperties.contains(key)) {
            v = el.getAttribute(key);
          }
          if (v === "" || (v == null)) {
            v = defaultValueForKey(key);
          }
          properties[key] = createInterpolable(v);
        }
      }
    } else {
      for (_j = 0, _len1 = keys.length; _j < _len1; _j++) {
        key = keys[_j];
        properties[key] = createInterpolable(el[key]);
      }
    }
    return pxProperties;
  };

  createInterpolable = function(value) {
    var interpolable, klass, klasses, _i, _len;
    klasses = [InterpolableArray, InterpolableObject, InterpolableNumber, InterpolableString];
    for (_i = 0, _len = klasses.length; _i < _len; _i++) {
      klass = klasses[_i];
      interpolable = klass.create(value);
      if (interpolable != null) {
        return interpolable;
      }
    }
    return null;
  };

  InterpolableString = (function() {
    function InterpolableString(parts) {
      this.parts = parts;
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
    }

    InterpolableString.prototype.interpolate = function(endInterpolable, t) {
      var end, i, newParts, start, _i, _ref;
      start = this.parts;
      end = endInterpolable.parts;
      newParts = [];
      for (i = _i = 0, _ref = Math.min(start.length, end.length); 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        if (start[i].interpolate != null) {
          newParts.push(start[i].interpolate(end[i], t));
        } else {
          newParts.push(start[i]);
        }
      }
      return new InterpolableString(newParts);
    };

    InterpolableString.prototype.format = function() {
      var parts;
      parts = this.parts.map(function(val) {
        if (val.format != null) {
          return val.format();
        } else {
          return val;
        }
      });
      return parts.join('');
    };

    InterpolableString.create = function(value) {
      var index, match, matches, parts, re, type, types, _i, _j, _len, _len1;
      value = "" + value;
      matches = [];
      types = [
        {
          re: /(#[a-f\d]{3,6})/ig,
          klass: InterpolableColor,
          parse: function(v) {
            return v;
          }
        }, {
          re: /(rgba?\([0-9.]*, ?[0-9.]*, ?[0-9.]*(?:, ?[0-9.]*)?\))/ig,
          klass: InterpolableColor,
          parse: function(v) {
            return v;
          }
        }, {
          re: /([-+]?[\d.]+)/ig,
          klass: InterpolableNumber,
          parse: parseFloat
        }
      ];
      for (_i = 0, _len = types.length; _i < _len; _i++) {
        type = types[_i];
        re = type.re;
        while (match = re.exec(value)) {
          matches.push({
            index: match.index,
            length: match[1].length,
            interpolable: type.klass.create(type.parse(match[1]))
          });
        }
      }
      matches = matches.sort(function(a, b) {
        return a.index > b.index;
      });
      parts = [];
      index = 0;
      for (_j = 0, _len1 = matches.length; _j < _len1; _j++) {
        match = matches[_j];
        if (match.index < index) {
          continue;
        }
        if (match.index > index) {
          parts.push(value.substring(index, match.index));
        }
        parts.push(match.interpolable);
        index = match.index + match.length;
      }
      if (index < value.length) {
        parts.push(value.substring(index));
      }
      return new InterpolableString(parts);
    };

    return InterpolableString;

  })();

  InterpolableObject = (function() {
    function InterpolableObject(obj) {
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
      this.obj = obj;
    }

    InterpolableObject.prototype.interpolate = function(endInterpolable, t) {
      var end, k, newObj, start, v;
      start = this.obj;
      end = endInterpolable.obj;
      newObj = {};
      for (k in start) {
        v = start[k];
        if (v.interpolate != null) {
          newObj[k] = v.interpolate(end[k], t);
        } else {
          newObj[k] = v;
        }
      }
      return new InterpolableObject(newObj);
    };

    InterpolableObject.prototype.format = function() {
      return this.obj;
    };

    InterpolableObject.create = function(value) {
      var k, obj, v;
      if (value instanceof Object) {
        obj = {};
        for (k in value) {
          v = value[k];
          obj[k] = createInterpolable(v);
        }
        return new InterpolableObject(obj);
      }
      return null;
    };

    return InterpolableObject;

  })();

  InterpolableNumber = (function() {
    function InterpolableNumber(value) {
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
      this.value = parseFloat(value);
    }

    InterpolableNumber.prototype.interpolate = function(endInterpolable, t) {
      var end, start;
      start = this.value;
      end = endInterpolable.value;
      return new InterpolableNumber((end - start) * t + start);
    };

    InterpolableNumber.prototype.format = function() {
      return roundf(this.value, 5);
    };

    InterpolableNumber.create = function(value) {
      if (typeof value === 'number') {
        return new InterpolableNumber(value);
      }
      return null;
    };

    return InterpolableNumber;

  })();

  InterpolableArray = (function() {
    function InterpolableArray(values) {
      this.values = values;
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
    }

    InterpolableArray.prototype.interpolate = function(endInterpolable, t) {
      var end, i, newValues, start, _i, _ref;
      start = this.values;
      end = endInterpolable.values;
      newValues = [];
      for (i = _i = 0, _ref = Math.min(start.length, end.length); 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        if (start[i].interpolate != null) {
          newValues.push(start[i].interpolate(end[i], t));
        } else {
          newValues.push(start[i]);
        }
      }
      return new InterpolableArray(newValues);
    };

    InterpolableArray.prototype.format = function() {
      return this.values.map(function(val) {
        if (val.format != null) {
          return val.format();
        } else {
          return val;
        }
      });
    };

    InterpolableArray.createFromArray = function(arr) {
      var values;
      values = arr.map(function(val) {
        return createInterpolable(val) || val;
      });
      values = values.filter(function(val) {
        return val != null;
      });
      return new InterpolableArray(values);
    };

    InterpolableArray.create = function(value) {
      if (value instanceof Array) {
        return InterpolableArray.createFromArray(value);
      }
      return null;
    };

    return InterpolableArray;

  })();

  Color = (function() {
    function Color(rgb, format) {
      this.rgb = rgb != null ? rgb : {};
      this.format = format;
      this.toRgba = __bind(this.toRgba, this);
      this.toRgb = __bind(this.toRgb, this);
      this.toHex = __bind(this.toHex, this);
    }

    Color.fromHex = function(hex) {
      var hex3, result;
      hex3 = hex.match(/^#([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i);
      if (hex3 != null) {
        hex = "#" + hex3[1] + hex3[1] + hex3[2] + hex3[2] + hex3[3] + hex3[3];
      }
      result = hex.match(/^#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);
      if (result != null) {
        return new Color({
          r: parseInt(result[1], 16),
          g: parseInt(result[2], 16),
          b: parseInt(result[3], 16),
          a: 1
        }, "hex");
      }
      return null;
    };

    Color.fromRgb = function(rgb) {
      var match, _ref;
      match = rgb.match(/^rgba?\(([0-9.]*), ?([0-9.]*), ?([0-9.]*)(?:, ?([0-9.]*))?\)$/);
      if (match != null) {
        return new Color({
          r: parseFloat(match[1]),
          g: parseFloat(match[2]),
          b: parseFloat(match[3]),
          a: parseFloat((_ref = match[4]) != null ? _ref : 1)
        }, match[4] != null ? "rgba" : "rgb");
      }
      return null;
    };

    Color.componentToHex = function(c) {
      var hex;
      hex = c.toString(16);
      if (hex.length === 1) {
        return "0" + hex;
      } else {
        return hex;
      }
    };

    Color.prototype.toHex = function() {
      return "#" + Color.componentToHex(this.rgb.r) + Color.componentToHex(this.rgb.g) + Color.componentToHex(this.rgb.b);
    };

    Color.prototype.toRgb = function() {
      return "rgb(" + this.rgb.r + ", " + this.rgb.g + ", " + this.rgb.b + ")";
    };

    Color.prototype.toRgba = function() {
      return "rgba(" + this.rgb.r + ", " + this.rgb.g + ", " + this.rgb.b + ", " + this.rgb.a + ")";
    };

    return Color;

  })();

  InterpolableColor = (function() {
    function InterpolableColor(color) {
      this.color = color;
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
    }

    InterpolableColor.prototype.interpolate = function(endInterpolable, t) {
      var end, k, rgb, start, v, _i, _len, _ref;
      start = this.color;
      end = endInterpolable.color;
      rgb = {};
      _ref = ['r', 'g', 'b'];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        k = _ref[_i];
        v = Math.round((end.rgb[k] - start.rgb[k]) * t + start.rgb[k]);
        rgb[k] = Math.min(255, Math.max(0, v));
      }
      k = "a";
      v = roundf((end.rgb[k] - start.rgb[k]) * t + start.rgb[k], 5);
      rgb[k] = Math.min(1, Math.max(0, v));
      return new InterpolableColor(new Color(rgb, end.format));
    };

    InterpolableColor.prototype.format = function() {
      if (this.color.format === "hex") {
        return this.color.toHex();
      } else if (this.color.format === "rgb") {
        return this.color.toRgb();
      } else if (this.color.format === "rgba") {
        return this.color.toRgba();
      }
    };

    InterpolableColor.create = function(value) {
      var color;
      if (typeof value !== "string") {
        return;
      }
      color = Color.fromHex(value) || Color.fromRgb(value);
      if (color != null) {
        return new InterpolableColor(color);
      }
      return null;
    };
    return InterpolableColor;

  })();

  DecomposedMatrix2D = (function() {
    function DecomposedMatrix2D(props) {
      this.props = props;
      this.applyRotateCenter = __bind(this.applyRotateCenter, this);
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
    }

    DecomposedMatrix2D.prototype.interpolate = function(endMatrix, t) {
      var i, k, newProps, _i, _j, _k, _l, _len, _len1, _ref, _ref1, _ref2;
      newProps = {};
      _ref = ['translate', 'scale', 'rotate'];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        k = _ref[_i];
        newProps[k] = [];
        for (i = _j = 0, _ref1 = this.props[k].length; 0 <= _ref1 ? _j < _ref1 : _j > _ref1; i = 0 <= _ref1 ? ++_j : --_j) {
          newProps[k][i] = (endMatrix.props[k][i] - this.props[k][i]) * t + this.props[k][i];
        }
      }
      for (i = _k = 1; _k <= 2; i = ++_k) {
        newProps['rotate'][i] = endMatrix.props['rotate'][i];
      }
      _ref2 = ['skew'];
      for (_l = 0, _len1 = _ref2.length; _l < _len1; _l++) {
        k = _ref2[_l];
        newProps[k] = (endMatrix.props[k] - this.props[k]) * t + this.props[k];
      }
      return new DecomposedMatrix2D(newProps);
    };

    DecomposedMatrix2D.prototype.format = function() {
      return "translate(" + (this.props.translate.join(',')) + ") rotate(" + (this.props.rotate.join(',')) + ") skewX(" + this.props.skew + ") scale(" + (this.props.scale.join(',')) + ")";
    };

    DecomposedMatrix2D.prototype.applyRotateCenter = function(rotateC) {
      var i, m, m2d, negativeTranslate, _i, _results;
      m = baseSVG.createSVGMatrix();
      m = m.translate(rotateC[0], rotateC[1]);
      m = m.rotate(this.props.rotate[0]);
      m = m.translate(-rotateC[0], -rotateC[1]);
      m2d = new Matrix2D(m);
      negativeTranslate = m2d.decompose().props.translate;
      _results = [];
      for (i = _i = 0; _i <= 1; i = ++_i) {
        _results.push(this.props.translate[i] -= negativeTranslate[i]);
      }
      return _results;
    };

    return DecomposedMatrix2D;

  })();

  baseSVG = typeof document !== "undefined" && document !== null ? document.createElementNS("http://www.w3.org/2000/svg", "svg") : void 0;

  Matrix2D = (function() {
    function Matrix2D(m) {
      this.m = m;
      this.applyProperties = __bind(this.applyProperties, this);
      this.decompose = __bind(this.decompose, this);
      if (!this.m) {
        this.m = baseSVG.createSVGMatrix();
      }
    }

    Matrix2D.prototype.decompose = function() {
      var kx, ky, kz, r0, r1;
      r0 = new Vector([this.m.a, this.m.b]);
      r1 = new Vector([this.m.c, this.m.d]);
      kx = r0.length();
      kz = r0.dot(r1);
      r0 = r0.normalize();
      ky = r1.combine(r0, 1, -kz).length();
      return new DecomposedMatrix2D({
        translate: [this.m.e, this.m.f],
        rotate: [Math.atan2(this.m.b, this.m.a) * 180 / Math.PI, this.rotateCX, this.rotateCY],
        scale: [kx, ky],
        skew: kz / ky * 180 / Math.PI
      });
    };

    Matrix2D.prototype.applyProperties = function(properties) {
      var hash, k, props, v, _i, _len, _ref, _ref1;
      hash = {};
      for (_i = 0, _len = properties.length; _i < _len; _i++) {
        props = properties[_i];
        hash[props[0]] = props[1];
      }
      for (k in hash) {
        v = hash[k];
        if (k === "translateX") {
          this.m = this.m.translate(v, 0);
        } else if (k === "translateY") {
          this.m = this.m.translate(0, v);
        } else if (k === "scaleX") {
          this.m = this.m.scale(v, 1);
        } else if (k === "scaleY") {
          this.m = this.m.scale(1, v);
        } else if (k === "rotateZ") {
          this.m = this.m.rotate(v);
        } else if (k === "skewX") {
          this.m = this.m.skewX(v);
        } else if (k === "skewY") {
          this.m = this.m.skewY(v);
        }
      }
      this.rotateCX = (_ref = hash.rotateCX) != null ? _ref : 0;
      return this.rotateCY = (_ref1 = hash.rotateCY) != null ? _ref1 : 0;
    };

    return Matrix2D;

  })();

  Vector = (function() {
    function Vector(els) {
      this.els = els;
      this.combine = __bind(this.combine, this);
      this.normalize = __bind(this.normalize, this);
      this.length = __bind(this.length, this);
      this.cross = __bind(this.cross, this);
      this.dot = __bind(this.dot, this);
      this.e = __bind(this.e, this);
    }

    Vector.prototype.e = function(i) {
      if (i < 1 || i > this.els.length) {
        return null;
      } else {
        return this.els[i - 1];
      }
    };

    Vector.prototype.dot = function(vector) {
      var V, n, product;
      V = vector.els || vector;
      product = 0;
      n = this.els.length;
      if (n !== V.length) {
        return null;
      }
      n += 1;
      while (--n) {
        product += this.els[n - 1] * V[n - 1];
      }
      return product;
    };

    Vector.prototype.cross = function(vector) {
      var A, B;
      B = vector.els || vector;
      if (this.els.length !== 3 || B.length !== 3) {
        return null;
      }
      A = this.els;
      return new Vector([(A[1] * B[2]) - (A[2] * B[1]), (A[2] * B[0]) - (A[0] * B[2]), (A[0] * B[1]) - (A[1] * B[0])]);
    };

    Vector.prototype.length = function() {
      var a, e, _i, _len, _ref;
      a = 0;
      _ref = this.els;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        e = _ref[_i];
        a += Math.pow(e, 2);
      }
      return Math.sqrt(a);
    };

    Vector.prototype.normalize = function() {
      var e, i, length, newElements, _ref;
      length = this.length();
      newElements = [];
      _ref = this.els;
      for (i in _ref) {
        e = _ref[i];
        newElements[i] = e / length;
      }
      return new Vector(newElements);
    };

    Vector.prototype.combine = function(b, ascl, bscl) {
      var i, result, _i, _ref;
      result = [];
      for (i = _i = 0, _ref = this.els.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        result[i] = (ascl * this.els[i]) + (bscl * b.els[i]);
      }
      return new Vector(result);
    };

    return Vector;

  })();

  DecomposedMatrix = (function() {
    function DecomposedMatrix() {
      this.toMatrix = __bind(this.toMatrix, this);
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
    }

    DecomposedMatrix.prototype.interpolate = function(decomposedB, t, only) {
      var angle, decomposed, decomposedA, i, invscale, invth, k, qa, qb, scale, th, _i, _j, _k, _l, _len, _ref, _ref1;
      if (only == null) {
        only = null;
      }
      decomposedA = this;
      decomposed = new DecomposedMatrix;
      _ref = ['translate', 'scale', 'skew', 'perspective'];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        k = _ref[_i];
        decomposed[k] = [];
        for (i = _j = 0, _ref1 = decomposedA[k].length - 1; 0 <= _ref1 ? _j <= _ref1 : _j >= _ref1; i = 0 <= _ref1 ? ++_j : --_j) {
          if ((only == null) || only.indexOf(k) > -1 || only.indexOf("" + k + ['x', 'y', 'z'][i]) > -1) {
            decomposed[k][i] = (decomposedB[k][i] - decomposedA[k][i]) * t + decomposedA[k][i];
          } else {
            decomposed[k][i] = decomposedA[k][i];
          }
        }
      }
      if ((only == null) || only.indexOf('rotate') !== -1) {
        qa = decomposedA.quaternion;
        qb = decomposedB.quaternion;
        angle = qa[0] * qb[0] + qa[1] * qb[1] + qa[2] * qb[2] + qa[3] * qb[3];
        if (angle < 0.0) {
          for (i = _k = 0; _k <= 3; i = ++_k) {
            qa[i] = -qa[i];
          }
          angle = -angle;
        }
        if (angle + 1.0 > .05) {
          if (1.0 - angle >= .05) {
            th = Math.acos(angle);
            invth = 1.0 / Math.sin(th);
            scale = Math.sin(th * (1.0 - t)) * invth;
            invscale = Math.sin(th * t) * invth;
          } else {
            scale = 1.0 - t;
            invscale = t;
          }
        } else {
          qb[0] = -qa[1];
          qb[1] = qa[0];
          qb[2] = -qa[3];
          qb[3] = qa[2];
          scale = Math.sin(piDouble * (.5 - t));
          invscale = Math.sin(piDouble * t);
        }
        decomposed.quaternion = [];
        for (i = _l = 0; _l <= 3; i = ++_l) {
          decomposed.quaternion[i] = qa[i] * scale + qb[i] * invscale;
        }
      } else {
        decomposed.quaternion = decomposedA.quaternion;
      }
      return decomposed;
    };

    DecomposedMatrix.prototype.format = function() {
      return this.toMatrix().toString();
    };

    DecomposedMatrix.prototype.toMatrix = function() {
      var decomposedMatrix, i, j, match, matrix, quaternion, skew, temp, w, x, y, z, _i, _j, _k, _l;
      decomposedMatrix = this;
      matrix = Matrix.I(4);
      for (i = _i = 0; _i <= 3; i = ++_i) {
        matrix.els[i][3] = decomposedMatrix.perspective[i];
      }
      quaternion = decomposedMatrix.quaternion;
      x = quaternion[0];
      y = quaternion[1];
      z = quaternion[2];
      w = quaternion[3];
      skew = decomposedMatrix.skew;
      match = [[1, 0], [2, 0], [2, 1]];
      for (i = _j = 2; _j >= 0; i = --_j) {
        if (skew[i]) {
          temp = Matrix.I(4);
          temp.els[match[i][0]][match[i][1]] = skew[i];
          matrix = matrix.multiply(temp);
        }
      }
      matrix = matrix.multiply(new Matrix([[1 - 2 * (y * y + z * z), 2 * (x * y - z * w), 2 * (x * z + y * w), 0], [2 * (x * y + z * w), 1 - 2 * (x * x + z * z), 2 * (y * z - x * w), 0], [2 * (x * z - y * w), 2 * (y * z + x * w), 1 - 2 * (x * x + y * y), 0], [0, 0, 0, 1]]));
      for (i = _k = 0; _k <= 2; i = ++_k) {
        for (j = _l = 0; _l <= 2; j = ++_l) {
          matrix.els[i][j] *= decomposedMatrix.scale[i];
        }
        matrix.els[3][i] = decomposedMatrix.translate[i];
      }
      return matrix;
    };

    return DecomposedMatrix;

  })();

  Matrix = (function() {
    function Matrix(els) {
      this.els = els;
      this.toString = __bind(this.toString, this);
      this.decompose = __bind(this.decompose, this);
      this.inverse = __bind(this.inverse, this);
      this.augment = __bind(this.augment, this);
      this.toRightTriangular = __bind(this.toRightTriangular, this);
      this.transpose = __bind(this.transpose, this);
      this.multiply = __bind(this.multiply, this);
      this.dup = __bind(this.dup, this);
      this.e = __bind(this.e, this);
    }

    Matrix.prototype.e = function(i, j) {
      if (i < 1 || i > this.els.length || j < 1 || j > this.els[0].length) {
        return null;
      }
      return this.els[i - 1][j - 1];
    };

    Matrix.prototype.dup = function() {
      return new Matrix(this.els);
    };

    Matrix.prototype.multiply = function(matrix) {
      var M, c, cols, elements, i, j, ki, kj, nc, ni, nj, returnVector, sum;
      returnVector = matrix.modulus ? true : false;
      M = matrix.els || matrix;
      if (typeof M[0][0] === 'undefined') {
        M = new Matrix(M).els;
      }
      ni = this.els.length;
      ki = ni;
      kj = M[0].length;
      cols = this.els[0].length;
      elements = [];
      ni += 1;
      while (--ni) {
        i = ki - ni;
        elements[i] = [];
        nj = kj;
        nj += 1;
        while (--nj) {
          j = kj - nj;
          sum = 0;
          nc = cols;
          nc += 1;
          while (--nc) {
            c = cols - nc;
            sum += this.els[i][c] * M[c][j];
          }
          elements[i][j] = sum;
        }
      }
      M = new Matrix(elements);
      if (returnVector) {
        return M.col(1);
      } else {
        return M;
      }
    };

    Matrix.prototype.transpose = function() {
      var cols, elements, i, j, ni, nj, rows;
      rows = this.els.length;
      cols = this.els[0].length;
      elements = [];
      ni = cols;
      ni += 1;
      while (--ni) {
        i = cols - ni;
        elements[i] = [];
        nj = rows;
        nj += 1;
        while (--nj) {
          j = rows - nj;
          elements[i][j] = this.els[j][i];
        }
      }
      return new Matrix(elements);
    };

    Matrix.prototype.toRightTriangular = function() {
      var M, els, i, j, k, kp, multiplier, n, np, p, _i, _j, _ref, _ref1;
      M = this.dup();
      n = this.els.length;
      k = n;
      kp = this.els[0].length;
      while (--n) {
        i = k - n;
        if (M.els[i][i] === 0) {
          for (j = _i = _ref = i + 1; _ref <= k ? _i < k : _i > k; j = _ref <= k ? ++_i : --_i) {
            if (M.els[j][i] !== 0) {
              els = [];
              np = kp;
              np += 1;
              while (--np) {
                p = kp - np;
                els.push(M.els[i][p] + M.els[j][p]);
              }
              M.els[i] = els;
              break;
            }
          }
        }
        if (M.els[i][i] !== 0) {
          for (j = _j = _ref1 = i + 1; _ref1 <= k ? _j < k : _j > k; j = _ref1 <= k ? ++_j : --_j) {
            multiplier = M.els[j][i] / M.els[i][i];
            els = [];
            np = kp;
            np += 1;
            while (--np) {
              p = kp - np;
              els.push(p <= i ? 0 : M.els[j][p] - M.els[i][p] * multiplier);
            }
            M.els[j] = els;
          }
        }
      }
      return M;
    };

    Matrix.prototype.augment = function(matrix) {
      var M, T, cols, i, j, ki, kj, ni, nj;
      M = matrix.els || matrix;
      if (typeof M[0][0] === 'undefined') {
        M = new Matrix(M).els;
      }
      T = this.dup();
      cols = T.els[0].length;
      ni = T.els.length;
      ki = ni;
      kj = M[0].length;
      if (ni !== M.length) {
        return null;
      }
      ni += 1;
      while (--ni) {
        i = ki - ni;
        nj = kj;
        nj += 1;
        while (--nj) {
          j = kj - nj;
          T.els[i][cols + j] = M[i][j];
        }
      }
      return T;
    };

    Matrix.prototype.inverse = function() {
      var M, divisor, els, i, inverse_elements, j, ki, kp, new_element, ni, np, p, _i;
      ni = this.els.length;
      ki = ni;
      M = this.augment(Matrix.I(ni)).toRightTriangular();
      kp = M.els[0].length;
      inverse_elements = [];
      ni += 1;
      while (--ni) {
        i = ni - 1;
        els = [];
        np = kp;
        inverse_elements[i] = [];
        divisor = M.els[i][i];
        np += 1;
        while (--np) {
          p = kp - np;
          new_element = M.els[i][p] / divisor;
          els.push(new_element);
          if (p >= ki) {
            inverse_elements[i].push(new_element);
          }
        }
        M.els[i] = els;
        for (j = _i = 0; 0 <= i ? _i < i : _i > i; j = 0 <= i ? ++_i : --_i) {
          els = [];
          np = kp;
          np += 1;
          while (--np) {
            p = kp - np;
            els.push(M.els[j][p] - M.els[i][p] * M.els[j][i]);
          }
          M.els[j] = els;
        }
      }
      return new Matrix(inverse_elements);
    };

    Matrix.I = function(n) {
      var els, i, j, k, nj;
      els = [];
      k = n;
      n += 1;
      while (--n) {
        i = k - n;
        els[i] = [];
        nj = k;
        nj += 1;
        while (--nj) {
          j = k - nj;
          els[i][j] = i === j ? 1 : 0;
        }
      }
      return new Matrix(els);
    };

    Matrix.prototype.decompose = function() {
      var els, i, inversePerspectiveMatrix, j, k, matrix, pdum3, perspective, perspectiveMatrix, quaternion, result, rightHandSide, rotate, row, rowElement, s, scale, skew, t, translate, transposedInversePerspectiveMatrix, type, typeKey, v, w, x, y, z, _i, _j, _k, _l, _m, _n, _o, _p, _q, _r;
      matrix = this;
      translate = [];
      scale = [];
      skew = [];
      quaternion = [];
      perspective = [];
      els = [];
      for (i = _i = 0; _i <= 3; i = ++_i) {
        els[i] = [];
        for (j = _j = 0; _j <= 3; j = ++_j) {
          els[i][j] = matrix.els[i][j];
        }
      }
      if (els[3][3] === 0) {
        return false;
      }
      for (i = _k = 0; _k <= 3; i = ++_k) {
        for (j = _l = 0; _l <= 3; j = ++_l) {
          els[i][j] /= els[3][3];
        }
      }
      perspectiveMatrix = matrix.dup();
      for (i = _m = 0; _m <= 2; i = ++_m) {
        perspectiveMatrix.els[i][3] = 0;
      }
      perspectiveMatrix.els[3][3] = 1;
      if (els[0][3] !== 0 || els[1][3] !== 0 || els[2][3] !== 0) {
        rightHandSide = new Vector(els.slice(0, 4)[3]);
        inversePerspectiveMatrix = perspectiveMatrix.inverse();
        transposedInversePerspectiveMatrix = inversePerspectiveMatrix.transpose();
        perspective = transposedInversePerspectiveMatrix.multiply(rightHandSide).els;
        for (i = _n = 0; _n <= 2; i = ++_n) {
          els[i][3] = 0;
        }
        els[3][3] = 1;
      } else {
        perspective = [0, 0, 0, 1];
      }
      for (i = _o = 0; _o <= 2; i = ++_o) {
        translate[i] = els[3][i];
        els[3][i] = 0;
      }
      row = [];
      for (i = _p = 0; _p <= 2; i = ++_p) {
        row[i] = new Vector(els[i].slice(0, 3));
      }
      scale[0] = row[0].length();
      row[0] = row[0].normalize();
      skew[0] = row[0].dot(row[1]);
      row[1] = row[1].combine(row[0], 1.0, -skew[0]);
      scale[1] = row[1].length();
      row[1] = row[1].normalize();
      skew[0] /= scale[1];
      skew[1] = row[0].dot(row[2]);
      row[2] = row[2].combine(row[0], 1.0, -skew[1]);
      skew[2] = row[1].dot(row[2]);
      row[2] = row[2].combine(row[1], 1.0, -skew[2]);
      scale[2] = row[2].length();
      row[2] = row[2].normalize();
      skew[1] /= scale[2];
      skew[2] /= scale[2];
      pdum3 = row[1].cross(row[2]);
      if (row[0].dot(pdum3) < 0) {
        for (i = _q = 0; _q <= 2; i = ++_q) {
          scale[i] *= -1;
          for (j = _r = 0; _r <= 2; j = ++_r) {
            row[i].els[j] *= -1;
          }
        }
      }
      rowElement = function(index, elementIndex) {
        return row[index].els[elementIndex];
      };
      rotate = [];
      rotate[1] = Math.asin(-rowElement(0, 2));
      if (Math.cos(rotate[1]) !== 0) {
        rotate[0] = Math.atan2(rowElement(1, 2), rowElement(2, 2));
        rotate[2] = Math.atan2(rowElement(0, 1), rowElement(0, 0));
      } else {
        rotate[0] = Math.atan2(-rowElement(2, 0), rowElement(1, 1));
        rotate[1] = 0;
      }
      t = rowElement(0, 0) + rowElement(1, 1) + rowElement(2, 2) + 1.0;
      if (t > 1e-4) {
        s = 0.5 / Math.sqrt(t);
        w = 0.25 / s;
        x = (rowElement(2, 1) - rowElement(1, 2)) * s;
        y = (rowElement(0, 2) - rowElement(2, 0)) * s;
        z = (rowElement(1, 0) - rowElement(0, 1)) * s;
      } else if ((rowElement(0, 0) > rowElement(1, 1)) && (rowElement(0, 0) > rowElement(2, 2))) {
        s = Math.sqrt(1.0 + rowElement(0, 0) - rowElement(1, 1) - rowElement(2, 2)) * 2.0;
        x = 0.25 * s;
        y = (rowElement(0, 1) + rowElement(1, 0)) / s;
        z = (rowElement(0, 2) + rowElement(2, 0)) / s;
        w = (rowElement(2, 1) - rowElement(1, 2)) / s;
      } else if (rowElement(1, 1) > rowElement(2, 2)) {
        s = Math.sqrt(1.0 + rowElement(1, 1) - rowElement(0, 0) - rowElement(2, 2)) * 2.0;
        x = (rowElement(0, 1) + rowElement(1, 0)) / s;
        y = 0.25 * s;
        z = (rowElement(1, 2) + rowElement(2, 1)) / s;
        w = (rowElement(0, 2) - rowElement(2, 0)) / s;
      } else {
        s = Math.sqrt(1.0 + rowElement(2, 2) - rowElement(0, 0) - rowElement(1, 1)) * 2.0;
        x = (rowElement(0, 2) + rowElement(2, 0)) / s;
        y = (rowElement(1, 2) + rowElement(2, 1)) / s;
        z = 0.25 * s;
        w = (rowElement(1, 0) - rowElement(0, 1)) / s;
      }
      quaternion = [x, y, z, w];
      result = new DecomposedMatrix;
      result.translate = translate;
      result.scale = scale;
      result.skew = skew;
      result.quaternion = quaternion;
      result.perspective = perspective;
      result.rotate = rotate;
      for (typeKey in result) {
        type = result[typeKey];
        for (k in type) {
          v = type[k];
          if (isNaN(v)) {
            type[k] = 0;
          }
        }
      }
      return result;
    };

    Matrix.prototype.toString = function() {
      var i, j, str, _i, _j;
      str = 'matrix3d(';
      for (i = _i = 0; _i <= 3; i = ++_i) {
        for (j = _j = 0; _j <= 3; j = ++_j) {
          str += roundf(this.els[i][j], 10);
          if (!(i === 3 && j === 3)) {
            str += ',';
          }
        }
      }
      str += ')';
      return str;
    };

    Matrix.matrixForTransform = cacheFn(function(transform) {
      var matrixEl, result, style, _ref, _ref1, _ref2;
      matrixEl = document.createElement('div');
      matrixEl.style.position = 'absolute';
      matrixEl.style.visibility = 'hidden';
      matrixEl.style[propertyWithPrefix("transform")] = transform;
      document.body.appendChild(matrixEl);
      style = window.getComputedStyle(matrixEl, null);
      result = (_ref = (_ref1 = style.transform) != null ? _ref1 : style[propertyWithPrefix("transform")]) != null ? _ref : (_ref2 = dynamics.tests) != null ? _ref2.matrixForTransform(transform) : void 0;
      document.body.removeChild(matrixEl);
      return result;
    });

    Matrix.fromTransform = function(transform) {
      var digits, elements, i, match, matrixElements, _i;
      match = transform != null ? transform.match(/matrix3?d?\(([-0-9,e \.]*)\)/) : void 0;
      if (match) {
        digits = match[1].split(',');
        digits = digits.map(parseFloat);
        if (digits.length === 6) {
          elements = [digits[0], digits[1], 0, 0, digits[2], digits[3], 0, 0, 0, 0, 1, 0, digits[4], digits[5], 0, 1];
        } else {
          elements = digits;
        }
      } else {
        elements = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];
      }
      matrixElements = [];
      for (i = _i = 0; _i <= 3; i = ++_i) {
        matrixElements.push(elements.slice(i * 4, i * 4 + 4));
      }
      return new Matrix(matrixElements);
    };

    return Matrix;

  })();

  prefixFor = cacheFn(function(property) {
    var k, prefix, prop, propArray, propertyName, _i, _j, _len, _len1, _ref;
    if (document.body.style[property] !== void 0) {
      return '';
    }
    propArray = property.split('-');
    propertyName = "";
    for (_i = 0, _len = propArray.length; _i < _len; _i++) {
      prop = propArray[_i];
      propertyName += prop.substring(0, 1).toUpperCase() + prop.substring(1);
    }
    _ref = ["Webkit", "Moz", "ms"];
    for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
      prefix = _ref[_j];
      k = prefix + propertyName;
      if (document.body.style[k] !== void 0) {
        return prefix;
      }
    }
    return '';
  });

  propertyWithPrefix = cacheFn(function(property) {
    var prefix;
    prefix = prefixFor(property);
    if (prefix === 'Moz') {
      return "" + prefix + (property.substring(0, 1).toUpperCase() + property.substring(1));
    }
    if (prefix !== '') {
      return "-" + (prefix.toLowerCase()) + "-" + (toDashed(property));
    }
    return toDashed(property);
  });

  rAF = typeof window !== "undefined" && window !== null ? window.requestAnimationFrame : void 0;

  animations = [];

  animationsTimeouts = [];

  slow = false;

  slowRatio = 1;

  if (typeof window !== "undefined" && window !== null) {
    window.addEventListener('keyup', function(e) {
      if (e.keyCode === 68 && e.shiftKey && e.ctrlKey) {
        return dynamics.toggleSlow();
      }
    });
  }

  if (rAF == null) {
    lastTime = 0;
    rAF = function(callback) {
      var currTime, id, timeToCall;
      currTime = Date.now();
      timeToCall = Math.max(0, 16 - (currTime - lastTime));
      id = window.setTimeout(function() {
        return callback(currTime + timeToCall);
      }, timeToCall);
      lastTime = currTime + timeToCall;
      return id;
    };
  }

  runLoopRunning = false;

  runLoopPaused = false;

  startRunLoop = function() {
    if (!runLoopRunning) {
      runLoopRunning = true;
      return rAF(runLoopTick);
    }
  };

  runLoopTick = function(t) {
    var animation, toRemoveAnimations, _i, _len;
    if (runLoopPaused) {
      rAF(runLoopTick);
      return;
    }
    toRemoveAnimations = [];
    for (_i = 0, _len = animations.length; _i < _len; _i++) {
      animation = animations[_i];
      if (!animationTick(t, animation)) {
        toRemoveAnimations.push(animation);
      }
    }
    animations = animations.filter(function(animation) {
      return toRemoveAnimations.indexOf(animation) === -1;
    });
    if (animations.length === 0) {
      return runLoopRunning = false;
    } else {
      return rAF(runLoopTick);
    }
  };

  animationTick = function(t, animation) {
    var key, properties, property, tt, y, _base, _base1, _ref;
    if (animation.tStart == null) {
      animation.tStart = t;
    }
    tt = (t - animation.tStart) / animation.options.duration;
    y = animation.curve(tt);
    properties = {};
    if (tt >= 1) {
      if (animation.curve.returnsToSelf) {
        properties = animation.properties.start;
      } else {
        properties = animation.properties.end;
      }
    } else {
      _ref = animation.properties.start;
      for (key in _ref) {
        property = _ref[key];
        properties[key] = interpolate(property, animation.properties.end[key], y);
      }
    }
    applyFrame(animation.el, properties);
    if (typeof (_base = animation.options).change === "function") {
      _base.change(animation.el);
    }
    if (tt >= 1) {
      if (typeof (_base1 = animation.options).complete === "function") {
        _base1.complete(animation.el);
      }
    }
    return tt < 1;
  };

  interpolate = function(start, end, y) {
    if ((start != null) && (start.interpolate != null)) {
      return start.interpolate(end, y);
    }
    return null;
  };

  startAnimation = function(el, properties, options, timeoutId) {
    var endProperties, interpolable, isSVG, k, matrix, startProperties, transforms, v;
    if (timeoutId != null) {
      animationsTimeouts = animationsTimeouts.filter(function(timeout) {
        return timeout.id !== timeoutId;
      });
    }
    dynamics.stop(el, {
      timeout: false
    });
    if (!options.animated) {
      dynamics.css(el, properties);
      if (typeof options.complete === "function") {
        options.complete(this);
      }
      return;
    }
    properties = parseProperties(properties);
    startProperties = getCurrentProperties(el, Object.keys(properties));
    endProperties = {};
    transforms = [];
    for (k in properties) {
      v = properties[k];
      if ((el.style != null) && transformProperties.contains(k)) {
        transforms.push([k, v]);
      } else {
        interpolable = createInterpolable(v);
        if (interpolable instanceof InterpolableNumber && (el.style != null)) {
          interpolable = new InterpolableString([interpolable, unitForProperty(k, 0)]);
        }
        endProperties[k] = interpolable;
      }
    }
    if (transforms.length > 0) {
      isSVG = isSVGElement(el);
      if (isSVG) {
        matrix = new Matrix2D();
        matrix.applyProperties(transforms);
      } else {
        v = (transforms.map(function(transform) {
          return transformValueForProperty(transform[0], transform[1]);
        })).join(" ");
        matrix = Matrix.fromTransform(Matrix.matrixForTransform(v));
      }
      endProperties['transform'] = matrix.decompose();
      if (isSVG) {
        startProperties.transform.applyRotateCenter([endProperties.transform.props.rotate[1], endProperties.transform.props.rotate[2]]);
      }
    }
    animations.push({
      el: el,
      properties: {
        start: startProperties,
        end: endProperties
      },
      options: options,
      curve: options.type.call(options.type, options)
    });
    return startRunLoop();
  };

  timeouts = [];

  timeoutLastId = 0;

  setRealTimeout = function(timeout) {
    if (!isDocumentVisible()) {
      return;
    }
    return timeout.realTimeoutId = setTimeout(function() {
      timeout.fn();
      return cancelTimeout(timeout.id);
    }, timeout.delay);
  };

  addTimeout = function(fn, delay) {
    var timeout;
    timeoutLastId += 1;
    timeout = {
      id: timeoutLastId,
      tStart: Date.now(),
      fn: fn,
      delay: delay,
      originalDelay: delay
    };
    setRealTimeout(timeout);
    timeouts.push(timeout);
    return timeoutLastId;
  };

  cancelTimeout = function(id) {
    return timeouts = timeouts.filter(function(timeout) {
      if (timeout.id === id) {
        clearTimeout(timeout.realTimeoutId);
      }
      return timeout.id !== id;
    });
  };

  leftDelayForTimeout = function(time, timeout) {
    var consumedDelay;
    if (time != null) {
      consumedDelay = time - timeout.tStart;
      return timeout.originalDelay - consumedDelay;
    } else {
      return timeout.originalDelay;
    }
  };

  if (typeof window !== "undefined" && window !== null) {
    window.addEventListener('unload', function() {});
  }

  timeBeforeVisibilityChange = null;

  observeVisibilityChange(function(visible) {
    var animation, difference, timeout, _i, _j, _k, _len, _len1, _len2, _results;
    runLoopPaused = !visible;
    if (!visible) {
      timeBeforeVisibilityChange = Date.now();
      _results = [];
      for (_i = 0, _len = timeouts.length; _i < _len; _i++) {
        timeout = timeouts[_i];
        _results.push(clearTimeout(timeout.realTimeoutId));
      }
      return _results;
    } else {
      if (runLoopRunning) {
        difference = Date.now() - timeBeforeVisibilityChange;
        for (_j = 0, _len1 = animations.length; _j < _len1; _j++) {
          animation = animations[_j];
          if (animation.tStart != null) {
            animation.tStart += difference;
          }
        }
      }
      for (_k = 0, _len2 = timeouts.length; _k < _len2; _k++) {
        timeout = timeouts[_k];
        timeout.delay = leftDelayForTimeout(timeBeforeVisibilityChange, timeout);
        setRealTimeout(timeout);
      }
      return timeBeforeVisibilityChange = null;
    }
  });

  dynamics = {};

  dynamics.linear = function() {
    return function(t) {
      return t;
    };
  };

  dynamics.spring = function(options) {
    var A1, A2, decal, frequency, friction, s;
    if (options == null) {
      options = {};
    }
    applyDefaults(options, dynamics.spring.defaults);
    frequency = Math.max(1, options.frequency / 20);
    friction = Math.pow(20, options.friction / 100);
    s = options.anticipationSize / 1000;
    decal = Math.max(0, s);
    A1 = function(t) {
      var M, a, b, x0, x1;
      M = 0.8;
      x0 = s / (1 - s);
      x1 = 0;
      b = (x0 - (M * x1)) / (x0 - x1);
      a = (M - b) / x0;
      return (a * t * options.anticipationStrength / 100) + b;
    };
    A2 = function(t) {
      return Math.pow(friction / 10, -t) * (1 - t);
    };
    return function(t) {
      var A, At, a, angle, b, frictionT, y0, yS;
      frictionT = (t / (1 - s)) - (s / (1 - s));
      if (t < s) {
        yS = (s / (1 - s)) - (s / (1 - s));
        y0 = (0 / (1 - s)) - (s / (1 - s));
        b = Math.acos(1 / A1(yS));
        a = (Math.acos(1 / A1(y0)) - b) / (frequency * (-s));
        A = A1;
      } else {
        A = A2;
        b = 0;
        a = 1;
      }
      At = A(frictionT);
      angle = frequency * (t - s) * a + b;
      return 1 - (At * Math.cos(angle));
    };
  };

  dynamics.bounce = function(options) {
    var A, fn, frequency, friction;
    if (options == null) {
      options = {};
    }
    applyDefaults(options, dynamics.bounce.defaults);
    frequency = Math.max(1, options.frequency / 20);
    friction = Math.pow(20, options.friction / 100);
    A = function(t) {
      return Math.pow(friction / 10, -t) * (1 - t);
    };
    fn = function(t) {
      var At, a, angle, b;
      b = -3.14 / 2;
      a = 1;
      At = A(t);
      angle = frequency * t * a + b;
      return At * Math.cos(angle);
    };
    fn.returnsToSelf = true;
    return fn;
  };

  dynamics.gravity = function(options) {
    var L, bounciness, curves, elasticity, fn, getPointInCurve, gravity;
    if (options == null) {
      options = {};
    }
    applyDefaults(options, dynamics.gravity.defaults);
    bounciness = Math.min(options.bounciness / 1250, 0.8);
    elasticity = options.elasticity / 1000;
    gravity = 100;
    curves = [];
    L = (function() {
      var b, curve;
      b = Math.sqrt(2 / gravity);
      curve = {
        a: -b,
        b: b,
        H: 1
      };
      if (options.returnsToSelf) {
        curve.a = 0;
        curve.b = curve.b * 2;
      }
      while (curve.H > 0.001) {
        L = curve.b - curve.a;
        curve = {
          a: curve.b,
          b: curve.b + L * bounciness,
          H: curve.H * bounciness * bounciness
        };
      }
      return curve.b;
    })();
    getPointInCurve = function(a, b, H, t) {
      var c, t2;
      L = b - a;
      t2 = (2 / L) * t - 1 - (a * 2 / L);
      c = t2 * t2 * H - H + 1;
      if (options.returnsToSelf) {
        c = 1 - c;
      }
      return c;
    };
    (function() {
      var L2, b, curve, _results;
      b = Math.sqrt(2 / (gravity * L * L));
      curve = {
        a: -b,
        b: b,
        H: 1
      };
      if (options.returnsToSelf) {
        curve.a = 0;
        curve.b = curve.b * 2;
      }
      curves.push(curve);
      L2 = L;
      _results = [];
      while (curve.b < 1 && curve.H > 0.001) {
        L2 = curve.b - curve.a;
        curve = {
          a: curve.b,
          b: curve.b + L2 * bounciness,
          H: curve.H * elasticity
        };
        _results.push(curves.push(curve));
      }
      return _results;
    })();
    fn = function(t) {
      var curve, i, v;
      i = 0;
      curve = curves[i];
      while (!(t >= curve.a && t <= curve.b)) {
        i += 1;
        curve = curves[i];
        if (!curve) {
          break;
        }
      }
      if (!curve) {
        v = options.returnsToSelf ? 0 : 1;
      } else {
        v = getPointInCurve(curve.a, curve.b, curve.H, t);
      }
      return v;
    };
    fn.returnsToSelf = options.returnsToSelf;
    return fn;
  };

  dynamics.forceWithGravity = function(options) {
    if (options == null) {
      options = {};
    }
    applyDefaults(options, dynamics.forceWithGravity.defaults);
    options.returnsToSelf = true;
    return dynamics.gravity(options);
  };

  dynamics.bezier = (function() {
    var Bezier, Bezier_, yForX;
    Bezier_ = function(t, p0, p1, p2, p3) {
      return (Math.pow(1 - t, 3) * p0) + (3 * Math.pow(1 - t, 2) * t * p1) + (3 * (1 - t) * Math.pow(t, 2) * p2) + Math.pow(t, 3) * p3;
    };
    Bezier = function(t, p0, p1, p2, p3) {
      return {
        x: Bezier_(t, p0.x, p1.x, p2.x, p3.x),
        y: Bezier_(t, p0.y, p1.y, p2.y, p3.y)
      };
    };
    yForX = function(xTarget, Bs, returnsToSelf) {
      var B, aB, i, lower, percent, upper, x, xTolerance, _i, _len;
      B = null;
      for (_i = 0, _len = Bs.length; _i < _len; _i++) {
        aB = Bs[_i];
        if (xTarget >= aB(0).x && xTarget <= aB(1).x) {
          B = aB;
        }
        if (B !== null) {
          break;
        }
      }
      if (!B) {
        if (returnsToSelf) {
          return 0;
        } else {
          return 1;
        }
      }
      xTolerance = 0.0001;
      lower = 0;
      upper = 1;
      percent = (upper + lower) / 2;
      x = B(percent).x;
      i = 0;
      while (Math.abs(xTarget - x) > xTolerance && i < 100) {
        if (xTarget > x) {
          lower = percent;
        } else {
          upper = percent;
        }
        percent = (upper + lower) / 2;
        x = B(percent).x;
        i += 1;
      }
      return B(percent).y;
    };
    return function(options) {
      var Bs, fn, points;
      if (options == null) {
        options = {};
      }
      points = options.points;
      Bs = (function() {
        var i, k, _fn;
        Bs = [];
        _fn = function(pointA, pointB) {
          var B2;
          B2 = function(t) {
            return Bezier(t, pointA, pointA.cp[pointA.cp.length - 1], pointB.cp[0], pointB);
          };
          return Bs.push(B2);
        };
        for (i in points) {
          k = parseInt(i);
          if (k >= points.length - 1) {
            break;
          }
          _fn(points[k], points[k + 1]);
        }
        return Bs;
      })();
      fn = function(t) {
        if (t === 0) {
          return 0;
        } else if (t === 1) {
          return 1;
        } else {
          return yForX(t, Bs, this.returnsToSelf);
        }
      };
      fn.returnsToSelf = points[points.length - 1].y === 0;
      return fn;
    };
  })();

  dynamics.easeInOut = function(options) {
    var friction, _ref;
    if (options == null) {
      options = {};
    }
    friction = (_ref = options.friction) != null ? _ref : dynamics.easeInOut.defaults.friction;
    return dynamics.bezier({
      points: [
        {
          x: 0,
          y: 0,
          cp: [
            {
              x: 0.92 - (friction / 1000),
              y: 0
            }
          ]
        }, {
          x: 1,
          y: 1,
          cp: [
            {
              x: 0.08 + (friction / 1000),
              y: 1
            }
          ]
        }
      ]
    });
  };

  dynamics.easeIn = function(options) {
    var friction, _ref;
    if (options == null) {
      options = {};
    }
    friction = (_ref = options.friction) != null ? _ref : dynamics.easeIn.defaults.friction;
    return dynamics.bezier({
      points: [
        {
          x: 0,
          y: 0,
          cp: [
            {
              x: 0.92 - (friction / 1000),
              y: 0
            }
          ]
        }, {
          x: 1,
          y: 1,
          cp: [
            {
              x: 1,
              y: 1
            }
          ]
        }
      ]
    });
  };

  dynamics.easeOut = function(options) {
    var friction, _ref;
    if (options == null) {
      options = {};
    }
    friction = (_ref = options.friction) != null ? _ref : dynamics.easeOut.defaults.friction;
    return dynamics.bezier({
      points: [
        {
          x: 0,
          y: 0,
          cp: [
            {
              x: 0,
              y: 0
            }
          ]
        }, {
          x: 1,
          y: 1,
          cp: [
            {
              x: 0.08 + (friction / 1000),
              y: 1
            }
          ]
        }
      ]
    });
  };

  dynamics.spring.defaults = {
    frequency: 300,
    friction: 200,
    anticipationSize: 0,
    anticipationStrength: 0
  };

  dynamics.bounce.defaults = {
    frequency: 300,
    friction: 200
  };

  dynamics.forceWithGravity.defaults = dynamics.gravity.defaults = {
    bounciness: 400,
    elasticity: 200
  };

  dynamics.easeInOut.defaults = dynamics.easeIn.defaults = dynamics.easeOut.defaults = {
    friction: 500
  };

  dynamics.css = makeArrayFn(function(el, properties) {
    return applyProperties(el, properties, true);
  });

  dynamics.animate = makeArrayFn(function(el, properties, options) {
    var id;
    if (options == null) {
      options = {};
    }
    options = clone(options);
    applyDefaults(options, {
      type: dynamics.easeInOut,
      duration: 1000,
      delay: 0,
      animated: true
    });
    options.duration = Math.max(0, options.duration * slowRatio);
    options.delay = Math.max(0, options.delay);
    if (options.delay === 0) {
      return startAnimation(el, properties, options);
    } else {
      id = dynamics.setTimeout(function() {
        return startAnimation(el, properties, options, id);
      }, options.delay);
      return animationsTimeouts.push({
        id: id,
        el: el
      });
    }
  });

  dynamics.stop = makeArrayFn(function(el, options) {
    if (options == null) {
      options = {};
    }
    if (options.timeout == null) {
      options.timeout = true;
    }
    if (options.timeout) {
      animationsTimeouts = animationsTimeouts.filter(function(timeout) {
        if (timeout.el === el && ((options.filter == null) || options.filter(timeout))) {
          dynamics.clearTimeout(timeout.id);
          return false;
        }
        return true;
      });
    }
    return animations = animations.filter(function(animation) {
      return animation.el !== el;
    });
  });

  dynamics.setTimeout = function(fn, delay) {
    return addTimeout(fn, delay * slowRatio);
  };

  dynamics.initMatrixFromTransform = function(transform, cb) {

    var matrix = Matrix.fromTransform(Matrix.matrixForTransform(transform)).decompose();

    return matrix;
  }

  dynamics.clearTimeout = function(id) {
    return cancelTimeout(id);
  };

  dynamics.toggleSlow = function() {
    slow = !slow;
    if (slow) {
      slowRatio = 3;
    } else {
      slowRatio = 1;
    }
    return typeof console !== "undefined" && console !== null ? typeof console.log === "function" ? console.log("dynamics.js: slow animations " + (slow ? "enabled" : "disabled")) : void 0 : void 0;
  };

  if (typeof module === "object" && typeof module.exports === "object") {
    module.exports = dynamics;
  } else if (typeof define === "function") {
    define('dynamics', function() {
      return dynamics;
    });
  } else {
    window.dynamics = dynamics;
  }

}).call(this);

angular.module('uguru.shared.services')
.factory("AnimationFrameService", [
    '$timeout',
    '$state',
    'UtilitiesService',
    'TweenService',
    'PropertyService',
    'RootService',
    '$interval',
    AnimationFrameService
        ]);

function AnimationFrameService($timeout, $state, UtilitiesService, TweenService, PropertyService, RootService, $interval) {
    // https://developer.chrome.com/devtools/docs/demos/too-much-layout/index
    var player = initRAFPlayer();
    // var statePlayer = initStatePlayer();
    var state = getStateObj();
    var init = {state: state.init}
    var propOptions = getPropOptions();
    var cache = {states: [], elements: [], properties: []};
    var animUrlShortcuts = getanimUrlShortcuts(RootService);
    var animPropShortcuts
    $timeout(function() {
      animPropShortcuts = RootService.getAnimShortcuts('animProps');
    })

    return {
      init:init,
      getDebugFormat: getDebugFormat,
      getPlayer: getRAFPlayer,
      animUrlShortcuts:animUrlShortcuts
    };


    function getDebugFormat(arg_name, value) {
      value = value + ''
      if (arg_name === 'direction') {
        return {
          'f': 'forward',
          'r': 'reverse',
          'a': 'alternate',
          'ar': 'reverse alternate'
        }[value]
      }
      if (arg_name === 'iter') {

        if (value === 'i' || value === '-1') {
          return 'inf'
        } else {
          return value
        }
      }
      if (arg_name === 'easingFunc' && value.indexOf('(') > -1) {
        return 'cb(' +  value + ')';
      }
      if (arg_name === 'duration' || arg_name === 'delay') {
        return value + 'ms'
      }

    }

    // function initStatePlayer() {


    // }
    function getRAFPlayer() {
      return player;
    }

    function initRAFPlayer()  {
      window.requestAnimFrame = (function(){
      return  window.requestAnimationFrame       ||
          window.webkitRequestAnimationFrame ||
          window.mozRequestAnimationFrame    ||
          function( callback ){
            window.setTimeout(callback, 1000 / 60);
          };
      })();
      // return window.requestAnimationFrame
      var animationFrame = new AnimationFrame();

      return getPlayActiveAnimationsFunc(animationFrame, executeActiveStreams);


      // return animationFrame;
    }

    function executeActiveStreams(player, frame) {
      // console.log(player.schedule.streams)
      return function(time) {

        if (player.tick.current > -2 && player.active) {
          player.schedule.lastTimeDelta = time - player.time.delta;
          player.stepForward(player.schedule);
          player.time.delta = time;
          player.rAF_id = player.rAF.request(player.animFunc);
        } else {
          player.pause();
        }
      }
    }

    function initStreamTick(stream, defaults) {

        var tick = {
          infinite: false,
          start:Math.ceil(calcTickLength(stream.offset) * -1),
          end: 0,
          cycleIndex: 0
        };
        tick.reset= resetCycleFunc(tick);
        tick.init = getTickInitFunc(tick)
        tick.current = tick.start;

        return initTickFromStream(stream, tick);

        function getTickInitFunc(tick) {
          return function(stream) {
            tick.direction.current = getTickDirection(tick.cycleIndex, tick.direction);
            tick.direction.current === 'r' && stream.values.reverse();
          }
        }

        function initTickFromStream(stream, tick) {

          tick.infinite = stream.iter.infinite;
          if (tick.infinite) {
            // @jeselle-infinite, @gabrielle-infinite
            stream.iter.count.total = 10;
          }
          tick.cycle = {
            repeats: stream.iter.count.total,
            increment: incrementCycleFunc(stream, tick),
            decrement: decrementCycleFunc(stream, tick),
            isComplete: isCurrentCycleCompleteFunc(tick),
            reset: resetCycleFunc(tick),
            btwn: stream.iter.btwn,
            c_duration: stream.duration + stream.iter.btwn
          }


          tick.duration = {ms: (tick.cycle.c_duration * tick.cycle.repeats)}

          tick.duration.cycles = calcTickLength(tick.duration.ms)
          tick.direction = stream.direction;
          tick.offset = stream.offset;

          tick.end = Math.ceil(calcTickLength(tick.cycle.c_duration));
          // if (tick.direction.current === 'r') {

          //   tick.start = (tick.end - Math.abs(tick.start) - Math.ceil(calcTickLength(stream.duration))) * -1;
          //   // tick.start = tick.current;
          //   // console.log(tick.start, tick.end, calcTickLength(stream.duration))
          // }
          return tick;
        }

        function incrementCycleFunc(stream, tick) {
          return function() {

            if (tick.cycleIndex < tick.cycle.repeats || tick.infinite) {
              tick.cycleIndex += 1;


              tick.direction.current = getTickDirection(tick.cycleIndex, tick.direction);
              ['ar', 'a'].indexOf(tick.direction.value) > -1 && reverseStreamValues(stream, tick)
              tick.current = tick.start;
              // if (['ar', 'a'].indexOf(tick.direction.value) > -1) {

              //   // tick.current = calcTickLength(stream.offset) * -1;
              //   tick.start = (tick.end - Math.abs(tick.start) - Math.ceil(calcTickLength(stream.duration))) * -1;
              // } else {
              //   tick.current = tick.start;
              // }
            }
          }
        }

        function reverseStreamValues(stream, tick) {
          // if (tick.cycle.btwn && tick.direction.current === 'r') {
          //   // tick.current = (tick.end + tick.start)
          //   // (tick.end + tick.start) * -1
          //   var duration = tick.end - tick.start
          //   var frameLength = stream.values.length;
          //   // tick.current, tick.start, tick.end, Math.ceil(calcTickLength(stream.offset) * -1)
          //   // tick.current =
          //   console.log(stream.name, frameLength, tick.start, tick.end)
          // }
          stream.values.reverse();
        }

        function getTickDirection(cycle_index, direction) {

          if (['r', 'f'].indexOf(direction.value) > -1) {
            return direction.value
          }
          var directionValIndex = ['a', 'ar'].indexOf(direction.value);

          //best line of code ever!! SM 9/21/2016
          return ['f', 'r'][(directionValIndex + cycle_index) % 2]

        }

        function resetCycleFunc(tick) {
          return function() {
            tick.cycleIndex = 0;
            tick.current = tick.start;
          }
        }

        function isCurrentCycleCompleteFunc(tick) {
          return function() {
            return tick.current === tick.end;
          }
        }

        function decrementCycleFunc(stream, tick) {
          return function() {
            if (tick.cycleIndex > -1 && tick.cycleIndex < tick.cycle.repeats || tick.infinite) {
              tick.cycleIndex -= 1;
              tick.current = tick.end -1;
              tick.direction.current = getTickDirection(tick.cycleIndex, tick.direction);
            }
          }
        }

      }

    function getPlayActiveAnimationsFunc(frame, exec_anim_func) {
      var player = {rAF: frame, schedule:{upcoming:[], streams:[], streamCache:[], status:{direction: 'f', iter:1, fps:60}, queued:[]}, tick:0, activeStreamIDs:[]};
      player.pause = function(player) {
        return function() {
          player.rAF.cancel(player.rAF_id);
          player.rAF_id  = 0;
        };
      }(player)
      player.play = function() {

          if (!player.animFunc) {
            player.animFunc = exec_anim_func(player, player.rAF);
          }

          if (player.needsReset) {
            player.needsReset = false;
            player.reset(player);
          }

          player.active = true;

          //starting
          if (player.tick.current === player.tick.start) {

            // player.applyArgs(player.schedule.streams, player.debug);
            player.time = {start: window.performance.now(), delta: window.performance.now()};

          }

          player.rAF_id = player.rAF.request(player.animFunc);
        }


      player.focusStream = function(_player, _stream) {
        player.activeStreamID = _stream.id;

        player.schedule.streams.forEach(function(stream, id) {
          if (stream.id === player.activeStreamID)  {
            player.schedule.streams[id].active = true;
          } else {
            player.schedule.streams[id].active = false;
          }
        })
      }

      player.unFocusStream = function(_player, stream) {
        player.activeStreamID = null;
        player.schedule.streams.forEach(function(stream, id) {
          player.schedule.streams[id].active = false;
        })
        // player.reset(player)
      }

      player.scheduleStream = function(player, state_obj, offset, debug) {
        var streams = state_obj.events;


        if (!player.tick) {
          player.tick = {start: 0, end:0, current:0};
        }


        // if (debug && state_obj.playerProps) {


          if (state_obj.playerProps && debug) {
            player.playerProps = state_obj.playerProps
            player.playerProps.iter.count.current = player.playerProps.iter.count.current + 0;
          }
        // }
        if (!player.playerProps) {
          player.playerProps = state_obj.playerProps;
          player.playerProps.duration = 0;
        }

        var shallowCopyStreams = [];
        var currentMax = 0;
        for (var i = 0; i < streams.length; i++) {
          // console.log(streams[i].values)
          var globalOffsetTicks = calculateStreamTickLength({duration: 0, offset:offset});
          var totalDurationAndDelayTicks = calculateStreamTickLength(streams[i]);
          var durationOnlyTicks = calculateStreamTickLength(streams[i], 0, 60, true);
          var delayOnlyTicks = calculateStreamTickLength({duration:0, offset:streams[i].offset})

          values = streams[i].values

          if (values[values.length - 1] === null) {

            values = values.slice(0, values.length - 1);
          }


          var newStream = {applyProp:streams[i].applyAtT, active:true, childProps:streams[i].childProps, easing:streams[i].ease, duration:streams[i].duration, iter:streams[i].iter, name:streams[i].property || streams[i].name, direction: streams[i].direction, time: {total: streams[i].duration, elapsed: 0}, offset: streams[i].offset, values:values}

          newStream.tick = initStreamTick(newStream);


          newStream.time.total = newStream.tick.duration.ms + newStream.offset;


          newStream.tick.init(newStream);
          newStream.easing = streams[i].easing;
          shallowCopyStreams.push(newStream);

          // var maxStreamDuration =   Math.max(Math.round(newStream.time.total), player.playerProps.duration);
          var currentMax = Math.max(Math.ceil(newStream.time.total), currentMax);
        }

        var allStreamsTickDurationTicks = Math.ceil(calcTickLength(currentMax) * 62/60.0);
        if (!player.playerProps.duration && currentMax) {
          player.playerProps.duration = currentMax;
          player.tick.start = allStreamsTickDurationTicks;
          player.tick.current = player.tick.start;
        }


        // if (allStreamsTickDurationTicks > player.tick.current)  {
        //   player.tick.start = player.tick.current + allStreamsTickDurationTicks;
        // }

        var alreadyPassed = player.tick.start - player.tick.current;
        var remaining = player.tick.start - alreadyPassed;
        if (allStreamsTickDurationTicks > remaining) {
          player.tick.current += allStreamsTickDurationTicks - remaining;
          if (player.tick.current > player.tick.start) {
            player.tick.start = player.tick.current;
          }
        }



        // player.tick.current =  Math.ceil(player.tick.current * 1.016);
        // if (!player.tick.start) {

        //   state_obj.duration = player.playerProps.duration;
        //   player.tick.current = player.tick.start;
        // }

        // )
        player.schedule.streams.push.apply(player.schedule.streams, shallowCopyStreams);

        if (debug) {

          enablePlayerDebugMode(player, state_obj, debug)
        }
        return player;
      }
      player.getSchedule = function() {
        return player.schedule;
      }

      player.togglePropStreams = function(player, prop_name) {
        player.schedule.streams.forEach(function(stream, i) {
          console.log(stream.name, stream)
        });
        if (player.debug) {
          player.debug.propArr.forEach(function(prop) {
            console.log(prop)
          })
        }
      }


      function enablePlayerDebugMode(player, state, defaults) {


        if (!player.debug) {
          player.debug = {states: [], props:{}, defaults: defaults}
        }

        player.debug.stateName = defaults.stateName;
        player.debug.defaults.showAll = !defaults.hidePlot;
        player.debug.defaults.autoPlay = defaults.autoPlay;

        player.debug.defaults.startAt = defaults.startAt && parseStartAt(defaults.startAt, state.duration);
        delete player.debug.defaults['hidePlot'];



        player.debug.states.push(state);

        player.debug.selectedState = state;
        player.debug.totalStreams = 0;
        player.debug.elemPlayer = {
          update: getElemPlayerElemFunc(player),
          ball: document.querySelector('[inspector-ball]'),
          bar: document.querySelector('[inspector-bar]'),
          duration: document.querySelector('[inspector-duration]'),
          count: document.querySelector('[inspector-count]'),
          direction: document.querySelector('[inspector-direction]'),
          time: {duration: state.duration, offset: state.offset, elapsed:0}
        }
        player.debug.propArr = [];

        player.debug.states.forEach(function(state, i) {
            var props = state.props;
              for (prop in props) {
                player.debug.totalStreams += props[prop].length;
                if (! (prop in player.debug.props)){
                  player.debug.props[prop] = {values:[], name:prop, stateOffset: state.offset, stateDuration:state.duration};
                }
                if (!('easingFunc' in player.debug.props[prop])) {
                  player.debug.props[prop].easingFunc = 'linear'
                }
                if (!('iter' in player.debug.props[prop])) {

                  player.debug.props[prop].iter = 1
                }
                if (!('direction' in player.debug.props[prop])) {
                  player.debug.props[prop].direction = 'forwards';
                }
                var arraySections = props[prop];
                for (var j = 0; j < arraySections.length; j++) {
                  player.debug.props[prop].values.push(getSectionObj(arraySections[j], state.duration, state.offset));
                }
              }
              for (prop in props) {
                var totalDuration = 0;
                for (stream in props[prop]) {
                  totalDuration += props[prop][stream].duration;
                };
                player.debug.propArr.push({name: props[prop][0].name, duration:totalDuration, streams: props[prop], show:player.debug.defaults.showAll});
              }
        })



        player.debug.toggleAllPlots = toggleAllPlots(player.debug.propArr);
        $timeout(function() {
          updatePlayerArgs(player, true);
          var delay = 500;
          if (player.debug.defaults.startAt) {
            delay += (player.debug.defaults.startAt.percent * state.duration)/player.debug.defaults.startAt.speed
            player.play(player.schedule)
            player.pause();
            $timeout(function() {
              player.jump(player, player.debug.defaults.startAt.percent, player.debug.defaults.startAt.speed)
            }, 250)
            console.log(delay)
          }

          $timeout(function() {
              if (player.debug.defaults.startAt) {
                player.active = false;
              }

              $timeout(function() {
                if (player.debug.defaults.autoPlay) {
                  player.play(player.schedule);
                }
              }, 500)
          }, 1000 + delay);
          player.debug.propStreamValueUpdate = {};
          $timeout(function() {
            var elem_arr = [];
            player.debug.propArr.forEach(function(propDict, i) {
              var name = propDict.name;
              var propStreamValue = document.querySelector('#' + name + '-value');
              var propStreamPlotCircle = document.querySelectorAll('.' + name + '-plot-ball');
              propStreamValue && elem_arr.push(propStreamValue);
              if (propStreamPlotCircle && propStreamPlotCircle.length) {
                propStreamPlotCircle.forEach(function(elem, i) {elem_arr.push(elem)});
              }
              var isTransform = false;
              ['rotate', 'scale', 'translate', 'skew'].forEach(function(t_type, i) {
                if (name.indexOf(t_type) > -1) {
                  isTransform = true;
                  name = 'transform'
                }
              })
              player.debug.propStreamValueUpdate[name] =  updatePropStreamPlotValue(player, elem_arr);
            });
          }, 1000)
        })

        function updatePropStreamPlotValue(player, elem_arr) {
          return function(prop_name, value, tick, cycle_index) {
            cycle_index = cycle_index || 0
            elem_arr.forEach(function(elem) {

              if (elem.nodeName.toLowerCase() !== 'circle') {

                elem.innerHTML = value;
              } else {
                player.debug.propArr.forEach(function(prop_dict, i) {
                  // if (prop_dict.name === 'scaleX' || prop_dict.name === 'scaleY') {

                    elem.setAttribute('cx', (prop_dict.streams[0].plot.values.length *cycle_index) +  tick * prop_dict.streams[0].duration/prop_dict.streams[0].plot.values.length);
                    elem.setAttribute('cy', normalizeValue(prop_dict.streams[0].plot.values[tick] , prop_dict.streams[0].plot.range , 150));
                  //
                })



              }

            })
            function normalizeValue(val, range, height, padding) {
              if (!padding) padding = 10;
              return ((height) - (val/range) * (height)).toFixed(1)
            }
          }
        }

        function getSectionObj(section, duration, offset) {
          section.html = {width: 0, left: 0}
          var totalAnimLength = duration;
          section.html.width = parseInt((section.duration)/(totalAnimLength *1.0) * 10000)/100
          section.html.left = 10 + (parseInt((section.offset)/(totalAnimLength) * 10000)/100);
          return section;
        }


        function parseStartAt(start_str, duration) {
          duration = duration || 1000;
          var percent = 0.5;
          var speed = 20;
          var skip = start_str.indexOf(':skip') > -1;
          var hasMilli = start_str.indexOf('ms') > -1;
          var hasPercent = start_str.indexOf('%') > -1;

          if (hasMilli || !hasPercent) {
            percent =  parseInt(start_str.split('ms').join(""))/duration
          } else {
            percent = parseInt(start_str)/100;
          }
          var resultDict = {
            speed: speed,
            percent: percent
          }
          return resultDict;
        }

        function getElemPlayerElemFunc(player) {
          return function(tick, time_delta) {

            player.debug.elemPlayer.time.elapsed += time_delta;
            var percent = parseInt((100 -  100 * tick.current/(tick.start)) * 100) / 100;
            player.debug.elemPlayer.bar.style.width = percent + '%';
            player.debug.elemPlayer.ball.style.left = percent + '%';
            player.debug.elemPlayer.duration.innerHTML = parseInt((player.debug.elemPlayer.time.duration + player.debug.elemPlayer.time.offset) * percent/100.0) + 'ms';

          }
        }

        function toggleAllPlots(plot_arr) {
          return function() {
            var val = plot_arr[0].show;
            console.log(val);
            plot_arr.forEach(function(p_dict, i) {
              plot_arr[i].show = !val;
            })
          }
        }

      }



      function updatePlayerArgs(player, skip_first) {
        if (!skip_first && player.playerProps) {

          if (!player.playerProps.iter.infinite) {
            player.playerProps.iter.count.current = player.playerProps.iter.count.current - 1;
          } else {
            player.playerProps.iter.count.current = player.playerProps.iter.count.current + 1;
          }

        }

            player.debug.elemPlayer.time.elapsed = 0;
            if (player.debug.elemPlayer.duration) {

              player.debug.elemPlayer.duration.innerHTML = 0 + '';
            }
            if (player.debug.elemPlayer.bar) {
              player.debug.elemPlayer.bar.style.width = '0%';
            }
            if (player.debug.elemPlayer.ball) {
              player.debug.elemPlayer.ball.style.left = '0%';
            }
            if (player.debug.elemPlayer.count) {
              var iterVal;
              if (!player.playerProps) {
                iterVal = player.schedule.streams[0].iter.count.current;
              } else {
                if (player.playerProps.iter.infinite) {
                  iterVal = getDebugFormat('iter', 'i') + '&nbsp;&nbsp;|&nbsp;&nbsp;' + player.playerProps.iter.count.current;
                } else {
                  iterVal = player.playerProps.iter.count.current;
                }
              }
              player.debug.elemPlayer.count.innerHTML = iterVal;
            }
            if (player.debug.elemPlayer.direction) {
              var direction;
              if (!player.playerProps) {
                direction = player.schedule.streams[0].direction.current;
              } else {
                direction = player.playerProps.direction.current;
              }

              player.debug.elemPlayer.direction.innerHTML = getDebugFormat('direction',  (direction + ''));
            }
            if (!skip_first && player.playerProps) {
              if (['ar', 'a'].indexOf(player.playerProps.direction.value) > -1) {
                if (player.playerProps.direction.current === 'f') {
                  player.playerProps.direction.current = 'r';
                } else {
                  player.playerProps.direction.current = 'f';
                }
              }
            }
        }

      player.stepForward = function(schedule) {
        time_delta = schedule.lastTimeDelta;

        applyTickDeltaToStreams(player, schedule, time_delta, 1);
      }

      player.onStreamsComplete = onStreamsComplete;

      player.stepBack = function(schedule) {
        time_delta = schedule.lastTimeDelta;
        applyTickDeltaToStreams(player, schedule, time_delta * -1, -1);
      }

      player.jump = function(player, percent, speed) {
        var intervalLength = (1000/60)/speed;
        var playerTickDelta = player.tick.current + Math.round(player.tick.start*percent) - player.tick.start;
        var playerStepFunc;
        //stepping forward
        if (playerTickDelta > 0) {
          playerStepFunc = player.stepForward;
        }
        else {
          playerStepFunc = player.stepBack;
        }
        var count = Math.abs(playerTickDelta);
        player.jumpInterval = $interval(function() {
          count--;
          playerStepFunc(player.schedule);
          if (count < 0) {
            $interval.cancel(player.jumpInterval);
          }
        }, intervalLength)
      }

      player.jumpFromClick = function(player, $event) {


        var playerBarElem = getHrParent($event.target);
        var playerBarCoords = playerBarElem.getBoundingClientRect();
        var delta = Math.abs($event.layerX - $event.offsetX);
        var xOffset = $event.offsetX - delta;
        var percentPlayer = xOffset/playerBarCoords.width;

        player.jump(player, percentPlayer, (player.debug && player.debug.defaults.speed) || 5);
        // -1 * (playerTickDelta - player.tick.current)
        // console.log(player.tick.current, )

        function getHrParent(elem) {
          if (['hr'].indexOf(elem.nodeName.toLowerCase()) > -1) {
            elem = elem.parentNode;
          }
          return elem;
        }
      }

      player.applyArgs = function(streams) {
        var propStreams = {};
        streams.forEach(function(stream, index) {
          if (['ar', 'r'].indexOf(stream.direction.current) > -1) {
            stream.values.reverse();
          }
        });
      }
      player.reset = function(player, and_play) {
        var schedule = player.schedule;
        player.tick.current = player.tick.start;
        if (player.playerProps) {
          player.playerProps.iter.count.current = player.playerProps.iter.count.total + 1;

        }
        player.activeStreamID = false;
        player.schedule.streams.forEach(function(stream, i) {

            stream.time.elapsed = 0;
            stream.active = true;

            // set back to original
            // stream.tick.current = stream.tick.start;
            stream.tick.reset();

            stream.iter.count.current = stream.iter.count.total + 1;
            if (['ar', 'r'].indexOf(stream.direction.value) > -1) {
              stream.direction.current = 'r';
            } else {
              stream.direction.current = 'f';
            }
        })

        player.animFunc = exec_anim_func(player, player.rAF);
        updatePlayerArgs(player, true)
        player.active = false;
      }



      function onStreamsComplete(player) {
          console.log('streams are complete')
          player.pause();
          player.active = false;
          if (player.debug) {
            var elem = document.querySelector('#pause-element')
            angular.element(elem).triggerHandler('click');
            player.needsReset = true;
          }
      }


      //dont touch
      function applyTickDeltaToStreams(player, schedule, time_delta, tick_delta, scale_delta) {

        schedule.streams.forEach(function(stream, i) {
          if (!stream.active) return;
          if (stream.tick.current <= stream.tick.end && stream.active) {

            if (stream.tick.current <= stream.values.length && stream.tick.current >= 0) {
              // console.log(stream.values[stream.tick.current])
              stream.applyProp  && stream.applyProp(stream.values[stream.tick.current]);
              // player.debug && player.debug.propStreamValueUpdate[stream.name](stream.name, stream.values[stream.tick.current], stream.tick.current, stream.tick.cycleIndex)
            }
            stream.tick.current += tick_delta;

            stream.time.elapsed += time_delta;
          }
          if (stream.tick.current > stream.tick.end && stream.tick.cycle.repeats > (stream.tick.cycleIndex + 1)) {

            if (tick_delta > 0) {
              stream.tick.cycle.increment();
            } else {
              stream.tick.cycle.decrement();
            }
          }
          // if (stream.time.elapsed > stream.time.total) {
          //   stream.active = false;
          //   console.log('time lapsed')
          //   return;
          // }

        })



        // console.log(player.tick.current)

        if (player.debug) {
          player.debug.elemPlayer.update(player.tick, schedule.lastTimeDelta);
        }
        if (player.tick.current < 0) {
            player.active = false;
            if (player.debug) {
              var elem = document.querySelector('#pause-element')
              angular.element(elem).triggerHandler('click');
              player.needsReset = true;
            }
            player.pause();
            return;
        }
        player.tick.current -= (tick_delta);


      }

      return player;

    }



    function calcTickLength(num_ms, max_fps) {
        max_fps = max_fps || 60;
        tickLengthMS = 1000/max_fps;
        return Math.ceil(num_ms*1.0)/(tickLengthMS);
    }

    function calculateStreamTickLength(stream, g_offset, max_fps, ignore_offset) {
      max_fps = max_fps || 60;
      var tickLengthMS = 1000/max_fps;
      return Math.ceil(((stream.duration || 0)+ ((!ignore_offset && stream.offset) || 0) + (g_offset || 0)))/tickLengthMS;
    }


    function getStateObj() {
      return {
        init: initStateObj
      }
    }

    function filterParentheticals(str) {
      // console.log(filterParentheticals(str));
      var firstPortion = '';
      var checkForSinglePropStr = str.split(':');

      if (checkForSinglePropStr.length > 6) {
        firstPortion = checkForSinglePropStr.splice(0,3);
        str = checkForSinglePropStr.join(':')
      } else {
        firstPortion = checkForSinglePropStr.splice(0,1);
        str = checkForSinglePropStr.join(':')
      }
      var strSplit = str.split('(');
      if (strSplit.length > 1) {

        firstPortion = firstPortion.join(':') + ':' + strSplit.splice(0, 1).join(":").trim();

        var parsedParenPortion = processParentheticals(strSplit).trim();
        var result = UtilitiesService.replaceAll(firstPortion + parsedParenPortion, '::', ':');
        return result
      } else {
        str = firstPortion.join(':') + ':' +  str;
      }
      return str;

      function processParentheticals(arr_parentheticals) {

        var endTrimmings = arr_parentheticals.join('(').split(')') || [];
        if (endTrimmings.length) {
          endTrimmings = endTrimmings[endTrimmings.length - 1]
        } else {
          endTrimmings = '';
        }
        var parenArgs = [];
        arr_parentheticals.forEach(function(p_arg, i) {
          var innerArg = p_arg.split(')')[0];
          var innerArg = UtilitiesService.replaceAll(innerArg, ':', '|');
          parenArgs.push(innerArg);
        })
        if (endTrimmings.length) {
          parenArgs.push(endTrimmings);
        }
        // arr_parentheticals.join()
        return parenArgs.join(':');
      }

    }

      function decomposeMatrixStr(str) {
        var dMatrix = dynamics.initMatrixFromTransform(str);
        var args = ['rotate', 'translate', 'scale', 'skew'];
        var defaults = [['0deg'], ['0px', '0%'], '', 'deg' ];
        var results = [];
        results.push(parseTranslate(dMatrix.translate))
        results.push(parseScale(dMatrix.scale));
        var dMatrix = dynamics.initMatrixFromTransform(str, true);
        results.push(parseRotate(dMatrix.rotate))


        // console.log(dMatrix.quaternion[3]*(180/Math.PI), dMatrix.quaternion[2]*(180/Math.PI))
        function parseTranslate(arr) {
          var values = ['X', 'Y', 'Z'];
          var results = [];
          arr.forEach(function(val, i) {
            if (val) {
              results.push('translate' + values[i] + '(' + val +  'px)');
            }
          })
          if (results.length) {
            return results.join(" ");
          }
        }



        function parseSkew(arr) {
          var values = ['X', 'Y', 'Z'];
          var results = [];
          arr.forEach(function(val, i) {
            if (val) {
              results.push('skew' + values[i] + '(' + val*(180/Math.PI) +  'deg)');
            }
          })
          if (results.length) {
            return results.join(" ");
          }
        }

        function parseRotate(arr) {
          var values = ['', '', ''];
          var results = [];
          if (arr[2]) {
            results.push('rotate(' + arr[2] * (180/Math.PI) + 'deg)');
            return results.join(" ")
          } else {
            arr.forEach(function(val, i) {
              if (val > 0 || (val + "").length) {
                results.push('rotate' + values[i] + '(' + (val*(180/Math.PI)).toFixed(4) +  'deg)');
              }
            })
            if (results.length) {
              return results.slice(1,2).join(" ").trim();
            }
          }


        }

        function parseScale(arr) {
          var values = ['X', 'Y', 'Z'];
          var results = [];
          arr.forEach(function(val, i) {
            if (val || (val + "").length) {
              // if (values[i] === 'Z' && val === 1) return;
              results.push('scale' + values[i] + '(' + val.toFixed(4) +  ')');
            }
          })
          if (results.length) {
            return results.join(" ");
          }
        }
        if (results.length) return results.join(" ")
        return str;
      }

      function condenseStartEndValues(prop) {

        var count = 0;
        if (prop.property === 'transform') {
          var startSplit = prop.start.trim().split(' ')
          var endSplit = prop.end.trim().split(' ')
          startSplit.forEach(function(start_arg, i) {
            if (startSplit[i] === endSplit[i]) {

              startSplit[i] = "";
              endSplit[i] = "";
            } else {
              count += 1;
            }
          });
          startSplit = startSplit.filter(function(start_arg, i) {return start_arg && start_arg.length})
          endSplit = endSplit.filter(function(end_arg, i) {return end_arg && end_arg.length})
          if (count && (startSplit.length && endSplit.length)) {
            prop.start = startSplit.join(" ").trim();
            prop.end = endSplit.join(" ").trim()
            prop.start = UtilitiesService.replaceAll(UtilitiesService.replaceAll(prop.start, ') ', ')').split(')').join(') '), '  ', ' ');
            prop.end = UtilitiesService.replaceAll(UtilitiesService.replaceAll(prop.end, ') ', ')').split(')').join(') '), '  ', ' ')
            prop.start = prop.start.trim();
            prop.end = prop.end.trim();

            if (startSplit.length !== endSplit.length) {
              var transformDict = {};
              prop.start.split(' ').forEach(function(prop_val, i) {prop_val = prop_val.split('(')[0].trim(); if (!(prop_val in transformDict)) {transformDict[prop_val] = 0};transformDict[prop_val] += 1;})
              prop.end.split(' ').forEach(function(prop_val, i) {prop_val = prop_val.split('(')[0].trim(); if (!(prop_val in transformDict)) {transformDict[prop_val] = 0};transformDict[prop_val] += 1;})
              var unevenProps = [];
              for (key in transformDict) {
                if (transformDict[key] === 1) {
                  unevenProps.push(key);
                }
              }
              unevenProps.forEach(function(uneven_prop, i) {
                var defaultPropDict = {'translateX': '0px', 'translateY': '0px', 'translateZ':'0px', 'scaleX': 1, 'scaleY': 1, 'skewX': '0deg', 'skewY': '0deg', 'scaleZ': 1, 'rotate': '0deg', 'scale': 1, 'skew': '0deg'};
                var extension = (uneven_prop + '(' + defaultPropDict[uneven_prop] + ')');

                if (prop.start.indexOf(uneven_prop) === -1) {
                  prop.start += ' ' + extension;
                } else if (prop.end.indexOf(uneven_prop) === -1) {

                  prop.end += ' ' + extension;
                }
              })
            }

          }
          prop.start = prop.start.split(' ').sort().join(' ').trim();
          prop.end = prop.end.split(' ').sort().join(' ').trim();
        }

      }

      function replaceShortcutSyntax(str) {
        var strSplit = str.split(':');
        if (strSplit.length <= 5) return str;

        var firstArgs = strSplit.splice(0,3);
        var formattedArgs = checkAndParseTransform(firstArgs[0], firstArgs[1], firstArgs[2]);
        var formattedArgs = checkAndParseShortcuts(formattedArgs[0], formattedArgs[1], formattedArgs[2]);
        var result = formattedArgs.join(':') + ':' + strSplit.join(':');
        return result;

        function checkAndParseTransform(prop, start, end) {
          if (start.indexOf('matrix3d') > -1) {
            start = decomposeMatrixStr(start);
            start = start.split(' ').filter(function(tr_arg, i) {return tr_arg.length} ).join(" ");
          }
          if (end.indexOf('matrix3d') > -1) {
            end = decomposeMatrixStr(end);
            end = end.split(' ').filter(function(tr_arg, i) {return tr_arg.length} ).join(" ");
          }
          if (start.split(' ').length !== end.split(' ').length) {
            var endSplit = end.split(' ');
            var newEnd = [];
            start.split(' ').slice().forEach(function(tr_arg, i) {
              var origStart = tr_arg;
              var tr_arg = (tr_arg + "").split('(')[0];

              if (end.indexOf(tr_arg) === -1) {
                var tr_arg_units = (origStart).split('(')[1];
                console.log(str)
                if (tr_arg_units.indexOf('px') > -1) {
                  tr_arg_units = 'px';
                }
                else if (tr_arg_units.indexOf('%') > -1) {
                  tr_arg_units = '%';
                }
                else if (tr_arg_units.indexOf('deg') > -1) {
                  tr_arg_units = 'deg';
                }
                end = endSplit.slice(0, i).join(" ") + tr_arg.split('(')[0] + '(0' + tr_arg_units + ') ' +  endSplit.slice(i, endSplit.length).join(' ');

              }
            })
          }
          return animUrlShortcuts.func.transform(prop,start,end);
        }
        function checkAndParseShortcuts(prop, start, end) {
          var start = animUrlShortcuts.func.valueStrMatch(start);
          var end = animUrlShortcuts.func.valueStrMatch(end);

          return [prop, start, end];
        }
      }

      function initStateObj(stateName, str, elem, debug) {
        if (elem.nodeName === '#comment') {
          console.log('is comment')
        }
        kf = debug && debug.kf || 60
        str = str && UtilitiesService.replaceAll(str, ', ', ',') || '';
        var cbArr = [];
        if (debug && debug.stateName) {
          var stateNameStr = elem.getAttribute(stateName);
          var stateNameStr = stateNameStr.split('[')[1].split('|')[0].split(']')[0].trim()
          var stateNameStrSplit = [];
          stateNameStr.split(',').forEach(function(stream, i) {
            var iStreamSplit = stream.split(':');
            if (iStreamSplit.length === 5) {
              stream += ':0:1:f';
              stateNameStrSplit.push(stream);
            }
          })
        } else {
          var stateNameStr = str
          var strSplit = str.split(':');
          strSplit.forEach(function(str, i) {
            var arrDecimals = UtilitiesService.getArrayOfDecimals(str);
            if (arrDecimals.length === 4) {
              strSplit[i] = "cb-" + cbArr.length;
              cbArr.push(arrDecimals)
            }
          })
          str = strSplit.join(":");
          var stateNameStrSplit = str.split(',');

        }




        var stateArgs = filterTransformAndShortcutStr(stateNameStrSplit);

        stateArgs = splitCustomAnimationsIntoStreams(stateArgs);



        var resultState = {duration: 0};
        var timeline = {events:[], props:{}, stateName: stateName};
        for (var i = 0; i < stateArgs.length; i++) {
          var iAnim = stateArgs[i];

          cbArr.forEach(function(cb_vals, i) {
            if (iAnim.indexOf('cb-' + i) > -1) {
              iAnim = iAnim.replace('cb-' + i, cbArr[i].join("|"));
            }
          })



            iAnim = iAnim && filterParentheticals(iAnim);

            iAnim = iAnim && replaceShortcutSyntax(iAnim);

            var iPropObj = initPropObj(iAnim);

            if (iAnim.split(':')[0] === 'transform') {
                condenseStartEndValues(iPropObj);
            }
            //
            // console.log(iPropObj.property, iPropObj.start, iPropObj.end)
            if (iPropObj.start === iPropObj.end) {
              continue;
            }

            timeline.playerProps = {
              direction: iPropObj.direction,
              iter: iPropObj.iter,
              duration: iPropObj.duration
            }
            var offset = iPropObj.delay;
            var values = TweenService.preComputeValues(iPropObj.property, iPropObj.duration, iPropObj.start, iPropObj.end, iPropObj.easingFunc, {cache:[]}, kf).cache;


            if (!(iPropObj.property in timeline.props)) {
              timeline.props[iPropObj.property] = [];
              if (iPropObj.property === 'transform') {
                transformExists = true;
              }
            }


            var result = {
              duration: iPropObj.duration,
              id: timeline.events.length + 1,
              offset: iPropObj.delay,
              direction: iPropObj.direction,
              iter: iPropObj.iter,
              name: iPropObj.property,
              values: values,
              easing: iPropObj.easingFunc,
              applyAtT: getApplyPropertyFunc(elem, iPropObj.property)
            }

            if (result.name === 'counter') {
              convertStreamEventIntoCounter(elem, result);
            }


            timeline.events.push(result);
          // }
        }


        // timeline.events.slice(1).forEach(function(_event, i) {
        timeline = compareAndMergeWithPrevious(timeline);
        // if (debug) {
        //   timeline.events.forEach(function(result, i) {

        //       if (result.name === 'transform' && result.values[0].indexOf('matrix3d') === -1) {


        //         delete timeline.props['transform'];
        //         addIndependentTransformPropsToTimeline(result, timeline);

        //         // timeline.props[iPropObj.property].push(result);
        //       } else {
        //         timeline.props[iPropObj.property].push(result);
        //       }


        //   })
        // }

        // })
        // if (streams.length) {
        //   timeline.events = streams;
        // }

        debug &&scaleTimelineValuesForPlot(player, timeline.props, null,  debug, timeline);
        normalizeStateDurationAndDelay(timeline);
        if (debug) {
          cache.states.push(timeline);
          timeline.debug = true;
          timeline.id = cache.states.length;
        }
        return timeline;
      }

      function compareAndMergeWithPrevious(timeline) {
        // if (!timeline.events || !timeline.events.length) {
        //   timeline.events.push(result);
        //   return;
        // }
        streamDict = {};
        // var prevFirst = prev_result.values[prev_result.values.length - 2];
        // var currentFirst = result.values[0];
        timeline.events.forEach(function(_event, i) {

          if (!(_event.name in streamDict)) {
            streamDict[_event.name] = [_event];
            return;
          }

          var propArr = streamDict[_event.name];
          // if (propArr.length < 2) {
          //   streamDict[_event.name].push(_event)
          // }

          var numEventsOfType = propArr.length;
          if (numEventsOfType >= 1) {
            var prev = propArr[numEventsOfType - 1];
            var current = _event;
            if (Math.abs((prev.offset + prev.duration) - current.offset) < 5 && prev.direction.value === current.direction.value && prev.easing === current.easing) {
              prev.duration += current.duration;
              prev.values.push.apply(prev.values, current.values);
              prev.iter.btwn = current.iter.btwn;
              streamDict[_event.name] = propArr.splice(0, propArr.length);
            }
          } else {
            streamDict[_event.name].push(_event)
          }
        });
        timeline.events = [];
        for (key in streamDict) {

          var streamArr = streamDict[key];
          streamArr.forEach(function(stream, i) {
            // var filteredValues = [];
            stream.values = stream.values.filter(function(val, j) {
              if (!val && val !== 0) return;
              if ( j > 1 && val === stream.values[j - 2] && stream.values[j - 1] === null) {
                  return false;
              }
              return true;
            })
            stream.values.push(null);
            stream.iter.btwn = 0;
            stream.duration = 1000.00/60 * stream.values.length;
            timeline.events.push(stream);
          })
        }
        return timeline
      }

      function convertStreamEventIntoCounter(elem, result) {
        var options = {prefix: '', suffix:''};

              result.values.forEach(function(val, i) {

                  if (!val) return;
                  var decimalValues = UtilitiesService.getArrayOfDecimals(val)[0];
                  var nonDecimal = val.split(decimalValues).filter(function(val) {return val.length})

                  if (nonDecimal.length === 1 && val.indexOf(nonDecimal) === 0) {
                    options.prefix = nonDecimal
                  } else if (nonDecimal.length === 1) {
                    options.suffix = nonDecimal;
                  }
                  if (nonDecimal.length === 2) {
                    options.prefix = nonDecimal[0];
                    options.suffix = nonDecimal[1];
                  }
                  if (decimalValues.length) {
                    result.values[i] = Math.round(decimalValues);
                  }
              })
              result.applyAtT = getApplyInnerHTMLFunc(elem, options)
      }

      function getApplyInnerHTMLFunc(elem, options, debug) {
        options = options || {};
        options.prefix = options.prefix || '';
        options.suffix = options.suffix || '';

        return function(value) {
          if (!value && value !== 0) return;
          elem.innerHTML = options.prefix + value + options.suffix;
        }
      }

      function getApplyPropertyFunc(elem, prop, debug) {

        return function(value) {

          if (value === null) return;
          elem.style[prop] = value;
        }
      }



      function normalizeStateDurationAndDelay(timeline) {
        var delays = [];
        var maxLength = 0;
        var maxSpanEvent;
        for (var i = 0; i < timeline.events.length; i++) {
          delays.push(timeline.events[i].offset);

          var eventSum = timeline.events[i].duration * timeline.events[i].iter.count.total;
          if (eventSum > maxLength) {
            maxLength = eventSum;
            maxSpanEvent = timeline.events[i];
          }
        }
        timeline.duration = maxLength;
        timeline.offset = 0;
      }

      function isCustomAnimation(anim_str) {
        var animStrArgs = anim_str.split(':');

        if (animStrArgs.length <= 3) {
          return false;
        }
        var animName = animStrArgs[0].trim();
        var allCustomAnimations = RootService.getCustomAnimations();
        var customAnimationNames = allCustomAnimations.customNameOnly;
        var customAnimIndex = customAnimationNames.indexOf(animName);

        if (customAnimIndex >= 0) {
          var customAnimObj = allCustomAnimations.custom[customAnimIndex];
          return PropertyService.parseAnimObjToPropArr(customAnimObj.cssRules).props;
        }
        return;
      }

      // function addCustomAnimPropsToTimeline(elem, anim_str, custom_props, timeline, debug) {

      //   var animArgs = anim_str.split(':');

      //   var animDict = {};

      //   animDict.duration = parseInt(animArgs[1]);
      //   animDict.delay = parseInt(animArgs[3]) || 0;
      //   animDict.easingFunc = animArgs[2] || 'linear'

      //   animDict.iter = parseIteration(animArgs[4]) || parseIteration("1");
      //   animDict.direction = parseDirection(animArgs[5]) || parseDirection("f");
      //   timeline.playerProps = {iter: animDict.iter, direction:animDict.direction, duration: animDict.duration};

      //   for (var prop in custom_props) {

      //     var propValues = [];

      //     var propBreakpoints = custom_props[prop].sort(function(bp1, bp2) {return bp1.percent - bp2.percent });
      //     for (var i = 0; i < propBreakpoints.length - 1; i++) {
      //       if (!(prop in timeline.props)) {
      //         timeline.props[prop] = [];
      //       }
      //       var result = constructPropObjFromCustomBP(elem, prop, animDict, propBreakpoints[i], propBreakpoints[i + 1])

      //       if (debug) {

      //         if (result.name === 'transform' && result.values[0].indexOf('matrix3d') === -1) {
      //           delete timeline.props['transform']
      //           addIndependentTransformPropsToTimeline(result, timeline);
      //         } else {
      //           timeline.props[prop].push(result);
      //         }

      //       }
      //       timeline.events.push(result);
      //     }
      //   }
      //   if (debug) {
      //     console.log(animDict)
      //     scaleTimelineValuesForPlot(timeline.props, animDict.direction);
      //   }
      // }

      function scaleTimelineValuesForPlot(player, props, direction, debug) {

        for (var prop in props) {
          var propStreams = props[prop];
          var plotStats = {max: 0, min: 100000000000};
          var totalDuration = 0;
          propStreams.forEach(function(stream, i) {totalDuration += stream.duration});
          propStreams.forEach(function(stream, i) {

            stream.plot = {max: 0, min: 100000000000, duration: 0, values:[], sections:[]};
            var streamTick = initStreamTick(stream)
            stream.values = stream.values.slice(0, stream.values.length - 1);
            streamDuration = (streamTick.cycle.c_duration * streamTick.cycle.repeats) + stream.offset;
            streamAllValues = [];
            var maxVal = 0;
            var streamSections = [];
            var ratioWidthDuration = stream.duration/2000;


            stream.plot.html = {width: (ratioWidthDuration*RootService.viewPortSize.width).toFixed(2) + 'px'};

            for (var i = 0; i < streamTick.cycle.repeats; i++) {
              var directionDict = {'f': 'forward', 'r':'reverse'};
              var section = {html:{}, pathValues:[], scaledValues:[], values: [], cycleIndex:i + 1, direction: directionDict[streamTick.direction.current], start: stream.values[0], end: stream.values[stream.values.length - 1], duration:stream.duration, btwn:stream.iter.btwn};


              var sectionMax = 0;
              var sectionMin = stream.values[0];
              stream.values.forEach(function(value, j) {
                var scaled_value = parseFloat(UtilitiesService.getArrayOfDecimals(value)[0]);
                maxVal = Math.max(maxVal, scaled_value);
                plotStats.max = Math.max(plotStats.max, scaled_value);
                plotStats.min = Math.min(plotStats.min, scaled_value);
                stream.plot.values.push(scaled_value);

                section.values.push({value: scaled_value});
                section.pathValues.push(scaled_value)
              });
              streamTick.cycle.increment();
            }
          })
          propStreams.forEach(function(stream, i) {
            if (!debug.chartOptions) {
              debug.chartOptions = {buffer: 10, height:150};
              debug.chartOptions.height -= debug.chartOptions.buffer;
            }
            stream.plot.height = debug.chartOptions.height;
            stream.plot.max = plotStats.max;
            stream.plot.min = plotStats.min;
            stream.plot.range = Math.abs(stream.plot.max - stream.plot.min);
            var vbMax = stream.plot.max/stream.plot.range * debug.chartOptions.height;
            var vbMin = stream.plot.min/stream.plot.range * debug.chartOptions.height;
            stream.plot.vb = {y1: debug.chartOptions.height-vbMax, y2: debug.chartOptions.height-vbMin, x1: 0,x2: stream.duration};


            stream.plot.path = constructBezierStream(stream, null, debug );
          })
        }
      }


      function constructBezierStream(stream, start, debug) {

        var options = debug && debug.chartOptions || {height:150, width:stream.duration};
        values = stream.plot.values
        var max = stream.plot.max;
        var min = stream.plot.min;
        var range = Math.abs(max - min);
        var scaleXFactor = stream.duration/values.length;
        var bzStreams = []
        var bzPointArr = [];
        var startIndex = 0;
        var startStr = start;
        if (!startStr) {
          startIndex = 1;
          var firstValue = normalizeValue(values.slice(0,1), range, options.height)
          startStr = "M0 " + firstValue + ", "
          bzPointArr.push([{x:0, y:firstValue}]);
          bzStreams.push(startStr)
        }
        values.slice(1, values.length-2).forEach(function(y1, x1) {
          var x1 = x1 + 1;

          var bzPoints = [ {x: x1, y: normalizeValue(y1, range, options.height)}, {x: x1 + 1, y: normalizeValue(values[x1 + 1], range, options.height)}, {x: x1 + 2, y: normalizeValue(values[x1 + 2], range, options.height)} ];
          bzPoints.forEach(function(point, i) {
            point.x = (point.x * scaleXFactor).toFixed(2);
          })
          var bzString = formatBZCurve(bzPoints[0], bzPoints[1], bzPoints[2], ",");
          bzPointArr.push(bzPoints)
          bzStreams.push(bzString);
        })

        bzPath = bzStreams.join(" ");
        return {points: bzPointArr, path: bzPath}

        function formatBZCurve(p1, p2, p3, delimiter) {
          delimiter = delimiter || ','
          return "C" + p1.x + " " + p1.y + delimiter + p2.x + " " + p2.y + delimiter + p3.x + " " + p3.y
        }
        function normalizeValue(val, range, height, padding) {
          if (!padding) padding = 10;
          return ((height) - (val/range) * (height)).toFixed(1)
        }
      }



      function splitCustomAnimationsIntoStreams(state_args) {
        var customArgs = [];
        var stateArgsCopy = state_args.slice();
        stateArgsCopy.forEach(function(state_str, i) {
          result = isCustomAnimation(state_str)

          if (result) {
            state_args.splice(i, 1)
            var argSplit = state_str.split(':').splice(1);
            argSplit.forEach(function(arg, i) {var hasInt = parseInt(argSplit[i]); if (hasInt || hasInt > -1) {argSplit[i] = hasInt } });
            customArgs.push({propDict: result, args: argSplit});
          }
        })
        if (customArgs.length) {
          var uniquePropStreams = [];
          customArgs.forEach(function(c_anim_dict, index) {
            var genDuration = c_anim_dict.args[0];
            var genDelay = c_anim_dict.args[2];

            for (prop in c_anim_dict.propDict) {
              var propStreams = c_anim_dict.propDict[prop];
              if (propStreams.length) {
                var accumulatedDelay =
                propStreams.forEach(function(_prop, stream_index) {
                  if (stream_index === 0 || stream_index === propStreams.length) return;
                  var genArgsCopy = c_anim_dict.args.slice();
                  // console.log(genArgsCopy);
                  var duration = genArgsCopy[0]
                  var deltaPercent = (propStreams[stream_index].percent - propStreams[stream_index - 1].percent)
                  var delay = (_prop.percent/100.0) * genDuration;
                  var startVal = propStreams[stream_index - 1].value;
                  var endVal = _prop.value;
                  deltaPercent = deltaPercent/100;
                  genArgsCopy[0] = (deltaPercent*duration) + "";
                  genArgsCopy[2] = (delay + genDelay - genArgsCopy[0]) + "";

                  // if ((genArgsCopy[2] + genArgsCopy[0]) < duration) {
                    genArgsCopy[3] = (genArgsCopy[3] + '+' + (duration - genArgsCopy[0])) + "";
                    // console.log(genArgsCopy)
                  // }

                  // console.log(_prop.prop + ':' + startVal + ':' + endVal + ':' + genArgsCopy.join(":"));
                  uniquePropStreams.push(_prop.prop + ':' + startVal + ':' + endVal + ':' + genArgsCopy.join(":"));
                })
              }
            }
          })

          uniquePropStreams.forEach(function(stream, i) {

            state_args.push(stream)
          })
        }
        function calculateDelayForPropStreamsBefore(prop_arr, duration, percent) {
          if (!prop_arr || !prop_arr.length) {
            return 0;
          }
          if (prop_arr && prop_arr.length) {
            var sumPercent = 0;
            prop_arr.forEach(function(prop, i) {
              sumPercent += prop.percent
            })
            console.log(sumPercent)
          }
          return 0;
        }
        return state_args;
      }

      function filterTransformAndShortcutStr(state_args) {
        var defaultTransformProps = ['translateX', 'translateY', 'translateZ', 'scaleX', 'scaleY', 'rotate', 'skewX', 'skewY', 'scaleZ', 'rotateX', 'rotateY', 'rotateZ', 'perspective', 'rotate3d'];
        var transform_state_arg = [];
        var state_args_final = [];
        state_args.slice().forEach(function(state_prop, i) {
          var statePropSplit = state_prop.split('p:');
          statePropSplit.forEach(function(str, i) {
            if (parseInt(str.charAt(str.length - 1))) {
              statePropSplit[i] = state_prop + '%:'
            }
          })
          state_prop = statePropSplit.join("p:");
          var propName = state_prop.split(':')[0].trim();
          if (defaultTransformProps.indexOf(propName) > -1) {
            transform_state_arg.push(state_prop)
          } else {
            state_args_final.push(state_prop)
          }
        })
        if (transform_state_arg.length) {
          var single_transform_str = "transform:"
          var resultTransformDict = {name: [], start: [], end: [], duration: [], easingFunc: [], delay:[], iter: [], direction:[] };
          transform_state_arg.forEach(function(transform_prop, i) {

            var splitArgs = transform_prop.split(':');
            resultTransformDict.name.push(splitArgs[0])
            resultTransformDict.start.push(splitArgs[1]);
            resultTransformDict.end.push(splitArgs[2]);
            resultTransformDict.duration.push(splitArgs[3]);
            resultTransformDict.easingFunc.push(splitArgs[4]);
            resultTransformDict.delay.push(splitArgs[5]);
            resultTransformDict.iter.push(splitArgs[6]);
            resultTransformDict.direction.push(splitArgs[7]);
          })

          single_transform_str = formatTransformStrFromTransformProps(resultTransformDict);

          state_args_final.unshift(single_transform_str);
        }

        return state_args_final
      }

      function formatTransformStrFromTransformProps(_dict) {
        var resultStr = 'transform:';
        _dict.name.forEach(function(prop_name, i) {
          resultStr += prop_name + '(' + _dict.start[i] + ') ';
        })
        resultStr = resultStr.trim() + ':';
        _dict.name.forEach(function(prop_name, i) {
          resultStr += prop_name + '(' + _dict.end[i] + ') ';
        })
        resultStr = resultStr.trim() + ':';
        var maxDuration = 0;
        _dict.duration.forEach(function(duration, i) {
          if (parseFloat(duration) > maxDuration) {
            maxDuration = duration;
          }
        })
        resultStr = resultStr.trim() + maxDuration + ':';
        _dict.easingFunc.forEach(function(ease, i) {
          resultStr = resultStr + ease + ' ';
        })
        resultStr = resultStr.trim() + ':';
        var maxDelay = 0;
        _dict.delay.forEach(function(delay, i) {
          if (parseFloat(delay) > maxDelay) {
            maxDelay = delay;
          }
        })
        resultStr += maxDelay + ':';
        var minIter = 1000000;
        _dict.iter.forEach(function(iter, i) {
          if (iter === 'i') {
            minIter = 'i';
            return;
          } else {
            if (minIter > parseFloat(iter)) {
              minIter = iter;
            }
          }
        })
        resultStr += minIter + ':' + _dict.direction[0];
        return resultStr
      }

      function addIndependentTransformPropsToTimeline(result, timeline) {
        // console.log('split timeline props for', result, timeline.events.length);
        var propNames = detectTransformProps(result.values[0])
        var detectAllNumbers = UtilitiesService.getArrayOfDecimals(result.values[0]);
        propNames.forEach(function(prop, i) {
            var values = [];
            var transformSingleProp = {};
            result.values.forEach(function(value, j) {
              if (!value) return;
              valueArr = result.values[j].split(' ');
              oneTransformPropValue = valueArr[i];
              values.push(oneTransformPropValue);
            })
            values.length && values.push(null);
            for (key in result) {
              transformSingleProp[key] = result[key];
            }
            transformSingleProp['values'] = values;
            transformSingleProp.name = propNames[i]
            transformSingleProp.applyAtT = null;
            transformSingleProp.skipPlot = false;
            if (!(prop in timeline.props)) {
              timeline.props[prop] = [];
            }
            timeline.props[propNames[i]].push(transformSingleProp);
        })
        // for (prop in result[props])
        // console.log(timeline.events)


        // for (var i = 0; result.values.length; i++) {

        // }



        function detectTransformProps(trans_value) {
          var propNames = (trans_value + "").split(' ')
          propNames.forEach(function(prop, i) {
            propNames[i] = prop.split('(')[0].trim();
          })
          return propNames
        }

      }

        function constructPropObjFromCustomBP(elem, prop_name, anim_info, bp_start, bp_end) {
          var bpDeltaDuration = ((bp_end.percent - bp_start.percent)/100.0) * anim_info.duration;
          var bpDeltaDelay = (bp_start.percent/100.0) * anim_info.duration + anim_info.delay;
          // var values = TweenService.preComputeValues(prop_name, bpDeltaDuration, bp_start.value, bp_end.value, 'linear', {cache:[]}).cache;

          var result = {
            offset: bpDeltaDelay,
            duration: bpDeltaDuration,
            name: prop_name,
            easingFunc: anim_info.easingFunc,
            values: values,
            direction: anim_info.direction,
            iter:anim_info.iter,
            applyAtT: getApplyPropertyFunc(elem, prop_name),
            property: prop_name
          }

          return result;
          // var values =

        }




    function checkAndReplaceShortcuts(str, type) {
      if (animPropShortcuts && str in animPropShortcuts[type]) {
        str = animPropShortcuts[type][str];
      }
      return str;
    }

    /*** Init Obj functions
    ****
    */

    function initPropObj(str) {
      var strArgs = str.split(':');
      var strArgLength = strArgs.length;
      if (strArgLength < 8) {
        for (var i = 0; i < 8 - strArgLength; i++) {
          strArgs.push(null);
        }
        strArgLength = 8;
      }
      var prop = {};
      for (var i = 0; i < strArgLength; i++)  {
        var iArg = strArgs.shift();

        if (!prop.property)  {
          prop.property = checkAndReplaceShortcuts(iArg, 'name') || 'transform'

          continue;
        }
        if (!('start' in prop)) {
          prop.start = checkAndReplaceShortcuts(iArg, 'start') || 0;
          if (prop.property === 'opacity') {
            prop.start = parseFloat(prop.start);
          }
          continue
        }
        if (!('end' in prop)) {
          prop.end = checkAndReplaceShortcuts(iArg, 'end') || 1;
          if (prop.property === 'opacity') {
            prop.end = parseFloat(prop.end);
          }
          continue
        }
        if (!prop.duration) {
          prop.duration = parseMSValue(checkAndReplaceShortcuts(iArg, 'duration')) || 1000;
          continue
        }
        if (!prop.easingFunc) {
          prop.easingFunc = checkAndReplaceShortcuts(iArg, 'easingFunc') || 1000;
          continue
        }
        if (!('delay' in prop)) {
          prop.delay = parseMSValue(checkAndReplaceShortcuts(iArg, 'delay')) || 0;
          continue
        }
        if (!prop.iter) {

          prop.iter = iArg && parseIteration(checkAndReplaceShortcuts(iArg, 'iter')) || parseIteration('1');

          continue
        }
        if (!prop.direction) {
          prop.direction = iArg && parseDirection(checkAndReplaceShortcuts(iArg, 'direction')) || parseDirection('f');
          continue
        }
      }
      return prop
    }

    function parseMSValue(str_ms) {
      return parseInt(str_ms);
    }

    function getanimUrlShortcuts(root_service) {
      return {
        func: {
          transform: mapTransformPropToStartEnd,
          valueStrMatch: mapPropValueAndReplace
        }
      }

      function mapPropValueAndReplace(val) {
        var defaultReplaceDict = getDefaultReplaceDict(val)

        for (var key in defaultReplaceDict) {
          var iMatch = (val + ':').indexOf(key);
          if (iMatch > -1) {
            var valWithoutMatch = (val + ':').split(key)
            val = valWithoutMatch[0] + defaultReplaceDict[key] + valWithoutMatch[1];

            if (val.length) {
              break;
            }

          }
        }
        return val.split(':').join('');
      }

      function mapTransformPropToStartEnd(prop, start, end) {
        var defaultTransformProps = ['translateX', 'translateY', 'translateZ', 'scaleX', 'scaleY', 'rotate', 'skewX', 'skewY', 'scaleZ', 'rotateX', 'rotateY', 'rotateZ', 'perspective', 'rotate3d'];
        var isTransformProp = defaultTransformProps.indexOf(prop);

        if (isTransformProp > -1) {
          return ['transform', prop + '(' + start + ')', prop + '(' + end + ')'];
        }



        return [prop, start, end];
      }
    }

    function getDefaultReplaceDict() {
      return {
        'p:': '%:',
        'p):': '%):'
      }
    }

    function parseIteration(iter) {
      var iObj = {infinite: false, count: {current: 1, total: 1}, btwn:0}

      iter = iter.replace('plus', '+');
      var inBetween = 0;
      var iterSplit = iter.split('+')
      var iterVal = iterSplit[0].trim();
      if (iterVal === 'i') {
        iObj.infinite = true;
      }
      if (iter.indexOf('+') > -1 && iterSplit.length > 1) {
        iObj.btwn = parseFloat(iterSplit[1]);
      }
      if (!iObj.infinite) {
        iObj.count.total = parseFloat(iterVal);
        iObj.count.current = iObj.count.total;
      }
      return iObj
    }

    function parseDirection(direction) {
      var directionIndex = propOptions.direction.indexOf(direction);
      if (directionIndex === -1) {
        direction = 'f';
      };
      var dObj = {current: propOptions.firstDirection[directionIndex], value: direction}
      return dObj;
    }

    function getArrProperties(property, start, end, duration) {

    }

    function getPropOptions() {
      return {
        direction: ['f', 'a', 'r', 'ar'],
        firstDirection: ['f', 'f', 'r', 'r'],
        debug: {}
      }
    }

}

angular
.module('uguru.shared.services')
.factory("StyleService", [
  StyleService
    ]);

function StyleService() {
  return {
    templates: getBaseTemplates(),
    css: getCSSmodules()
  }

  function getBaseTemplates() {
    return {
      svg: '<svg style="flex-grow:1;" preserveAspectRatio="xMidYMid meet"  viewBox="0 0 100 100"> <rect stroke="#637074" stroke-width="3" x="1.5" y="1.5" width="97" height="97" rx="10" ></rect><g ng-transclude></ng-transclude></svg>',
      container: '<div style="display:flex" ng-transclude></div>',
      view: '<div style="display:flex; width:100%; height:100%;" ng-transclude></div>',
    }
  }

  function getCSSmodules() {
    return {
      flexItem: {'align-self': 'space-between'},
      column: {'display': 'flex', 'flex-direction': 'row', 'width': '100%', 'align-content': 'space-between', 'justify-content': 'center'},
      view: {'display': 'flex', 'flex-direction': 'column', 'justify-content':'center', 'align-items': 'space-between', 'width':'100%', 'height':'100%'}
    }
  }
}

angular.module('uguru.shared.services')
.factory("AnimationPlotService", [
    '$timeout',
    AnimationPlotService
        ]);

function AnimationPlotService($timeout) {
  var normalizeChart, initChart, initStreamUtilFunc;
  return {

  }
}

angular.module('uguru.shared.services')
.factory("DirectiveService", [
    '$ionicViewSwitcher',
    '$timeout',
    '$state',
    'UtilitiesService',
    'AnimationService',
    'RootService',
    'TransformService',
    'PropertyService',
    'TweenService',
    DirectiveService
        ]);

function DirectiveService($ionicViewSwitcher, $timeout, $state, UtilitiesService, AnimationService, RootService, TransformService, PropertyService, TweenService) {
    var argNames = ['prop', 'anim', 'send', 'tween', 'class', 'trigger', 'eval', 'transform', 'ttt'];
    var argShortNames = ['p', 'a', 's', 't', 'c', 't', 'ttt'];
    var shortcuts;
    var cssPropertyMappings = {
      'o': 'opacity',
    }
    var defaultArgProps = ['delay', 'send', 'post', 'trigger'];
    var defaults = {
      activate: {hover: 250}
    }
    var defaultSecondaryArgs = {
      _class: ['add', 'remove', 'set']
    }



    return {
        // slide: slide,
        parseArgs: parseArgs,
        activateArg: activateArg,
        activateArgDelay: activateArgDelay,
        supportedCommands: argNames,
        sendMessage: sendMessageViaDropdown,
        setShortcutDict: setShortcutDict,
        getShortcuts: getShortcuts,
        getSupportedOnStates: getSupportedOnStates,
        getSupportedAsStates: getSupportedAsStates,
        parseCustomStateAttr: parseCustomStateAttr,
        detectExternalStates: detectExternalStates,
        initCustomStateWatcher: initCustomStateWatcher,
        defaults: defaults,
        parseSwitchesAttr: parseSwitchesAttr,
        parseSwitchAttr: parseSwitchAttr,
        processAnimArr: processAnimArr,
        parseAfterArgs: parseAfterArgs,
        processSetExtraArgs: processSetExtraArgs,
        processStaggerArgs: processStaggerArgs,
        verifyStaggerChildSelector: verifyStaggerChildSelector,
        applyMappingDelayFuncToFutureChildren: applyMappingDelayFuncToFutureChildren
    }

    function verifyStaggerChildSelector(constraints, elem) {
      var result = true;
      if (constraints.all) {
        return true;
      } else
      if (constraints.classes && constraints.classes.length) {
        var className = elem.classList.value || elem.className

        constraints.classes.forEach(function(_class, i) {
          if (className.indexOf(_class) === -1) {
            result = false;
          }
        })
      }
      return result;
    }

    function processStaggerArgs(attr_arr) {
      var resultDict = {};
      var attrKeys = Object.keys(attr_arr).filter(function(attr, i) {return attr.indexOf('$') === -1})

      for (var i = 0; i < attrKeys.length; i++) {
        var stateName = attrKeys[i];
        var stateValue = attr_arr[stateName];

        var staggerArgsDict = processStaggerString(stateName, stateValue.split(':'))

        resultDict[stateName] = staggerArgsDict
      }
      // processSelectors(attr_arr)
      return resultDict
    }


    function processStaggerString(state_name, arg_arr) {
      var resultDict = {};
      if (arg_arr.length < 2) {
        if (arg_arr.length === 1 && (arg_arr[0].indexOf('[') > -1 || arg_arr[0].indexOf('+') > -1 || arg_arr[0].indexOf('-') > -1)) {
          arg_arr.unshift('*')
        } else {
          return {}
        }
      }
      resultDict.selector = processSelectors(arg_arr.shift());
      // resultDict.selector =
      // there's a start and end
      resultDict.time = {};
      resultDict.time = processTime(arg_arr.shift(), arg_arr, resultDict, state_name);

      if (arg_arr.length) {
        console.log('easing');
      } else {
        // if (resultDict.time && resultDict.time.values) {
        //   resultDict.easing = 'custom'
        // }
      }
      return resultDict //resultDict
    }
    function applyMappingDelayFuncToFutureChildren(state_name, options) {
      return function(children_arr, time_dict, selector) {
        var childCount = 0;
        for (var i = 0; i < children_arr.length; i++) {
          var iChild = children_arr[i]

          if (iChild.attributes
            && iChild.hasAttribute(UtilitiesService.camelToDash(state_name))
            && verifyStaggerChildSelector(selector || (options && options.selector && options.selector[0]), iChild)) {
            childCount += 1;
          }
        }
        if (!time_dict.delay && time_dict.delay !== 0) {
          time_dict.delay = 0;
        }
        if (time_dict.linearConst && childCount && !time_dict.values.length) {
          for (var i = 0; i < childCount; i++) {
            time_dict.values.push(i*Math.abs(time_dict.linearConst))
          }
        }
        else if (options.easing && options.duration) {
          var resultArr = TweenService.preComputeValues('time', childCount * 16, {'time':0}, {'time': 1},time_dict.options.easing, {}).cache;
          //@jeselle un-comment the line below
          // resultArr = resultArr.slice(1)

          resultArr.forEach(function(val, i) {
            if (val && val >= 0) {
              var value = val * time_dict.options.duration;

              time_dict.values.push(value);
            }
          })
        }


        //ordering
        if (time_dict.order === 'reverse') {
          time_dict.values = time_dict.values.reverse();
        }
        // if (time_dict.)
        // console.log(state_name, order, options)
        // console.log(elem)
      }
    }

    function processTime(arg1, arg_arr, result_dict, state_name) {
      var timeDict = {values:[], formattedValues:[]};
      //
        if (arg1.indexOf('[') > -1) {
          time = UtilitiesService.removeAllOccurrancesArr(arg1, ['[', ']', ' '])
          var time_arr = time.split(', ');
          timeDict.values = time_arr;
        } else
        //easing or there is a delay w/o easing
        if (arg_arr.length === 1) {
           result_dict.duration = arg1;
           var lastArg = arg_arr.shift();
           result_dict.easing = lastArg.replace('-', '').replace('+', '')
           if (TweenService.getAllEasing().indexOf(result_dict.easing) > -1) {

            // result_dict.easing = lastArg;
            result_dict.delay = 0;
            timeDict.values = [];
            if (lastArg.indexOf('-') > -1) {
                timeDict.order = 'reverse';
            }
            else if (lastArg.indexOf('+') > -1) {
                timeDict.order = 'normal';
            }
            else if (lastArg.indexOf('+') === -1 || ((lastArg.indexOf('+') + lastArg.indexOf('-')) === -2)) {
              timeDict.order = 'normal';
            }
            timeDict.options = {
              easing: result_dict.easing,
              duration: result_dict.duration,
              order: timeDict.order,
              selector: result_dict.selector
            }
            timeDict.valueFunc = applyMappingDelayFuncToFutureChildren(state_name, timeDict.options);
          }
        }
        //linear
        else if (!arg_arr.length) {
          result_dict.easing = 'linear';
          result_dict.delay = 0;
          timeDict.linearConst = arg1;
          timeDict.values = [];
          timeDict.valueFunc;
          if (arg1.indexOf('-') > -1) {
            var directionIndex = arg1.indexOf('-');
            if (directionIndex === 0) {
              timeDict.order = 'reverse';
            } else {
              timeDict.order = 'custom';
            }
          } else
          if (arg1.indexOf('+') > -1 || ((arg1.indexOf('+') + arg1.indexOf('-')) === -2)) {
            timeDict.order = 'normal';
          }
          timeDict.options = {
            easing: 'linear',
            order: timeDict.order,
            selector: result_dict.selector
          }
          timeDict.valueFunc = applyMappingDelayFuncToFutureChildren(state_name, timeDict.options);
        }
        // timeDict.formattedValues = [];
        // console.log(timeDict.values);
        // if (timeDict.values && timeDict.values.length) {
        //   timeDict.values.forEach(function(val, i) {

        //     timeDict.values[i] = val
        //     console.log(val)
        //   })
        // }

      return timeDict
    }

    function processSelectors(selector) {
      var resultArr = []
      selectors = selector.split(', ');
      for (var i = 0; i < selectors.length; i++) {

        resultArr.push(processOneSelector(selectors[i]))


      }
      return resultArr

      function processOneSelector(str) {
        resultDict = {};
        if (str === '*') {
          resultDict.all = true;
          resultDict.str = str;
          return resultDict
        }
        if (str.indexOf('.') > -1) {
          classSplit = str.split('.').filter(function(str, i) {return str && str.length});
          var classArr = [];
          classSplit.forEach(function(c, i) {
            if (c[0] === '[') {
              c = c.split(']')[1];
            }
            if (c.indexOf('[') > -1) {
              c = c.split('[')[0]
            }
            c && c.length && classArr.push(c.trim())
          })
          if (classArr.length) {
            resultDict.classes = classArr
          }
        }
        if (str.indexOf('[') > -1) {
          attrSplit = str.split('[').filter(function(_str,i) {return str && _str.indexOf(']') > -1})
          var attrArr = [];
          attrSplit.forEach(function(attr, i) {
            if (attr.indexOf(']') > -1) {
              attr = attr.split(']')[0]
              attrArr.push(attr.trim())
            }
          })
          if (attrArr.length) {
            resultDict.attrs = attrArr
          }
          // console.log(attrSplit)
        }
        return resultDict
      }
    }
    function parseSwitchAttr(scope, element, attr) {
      if (attr && attr.switch) {
        console.log(attr.switch);
        var switch_arr_str = attr.switch.split('|');
        var switchObj = {};
        for (var i = 0; i < switch_arr_str.length; i++) {
          var indexSwitchStr = switch_arr_str[0];
          var indexSwitchSplit = indexSwitchStr.split(':')

          var switchName = indexSwitchSplit[0];
          switchObj.name = switchName;
          switchObj.active = false;
          if (indexSwitchSplit.length > 1) {
            var switchValue = indexSwitchSplit.splice(1);
          }
        }
        return switchObj;
      }
    }
    function parseSwitchesAttr(scope, element, attr) {
      if (!('switches' in attr)) return;
      var switches_str = attr.switches
      var switches_arr_str = attr.switches.split('|')
      var switch_objs = [];
      if (switches_arr_str.length >= 1) {
        for (var i = 0; i < switches_arr_str.length; i++) {
          var indexSwitchStr = switches_arr_str[i];
          var indexSwitchObj = parseSwitchStrToObj(indexSwitchStr)
          if (indexSwitchObj) {
            switch_objs.push(indexSwitchObj)
          }
        }
      }
      return switch_objs;
      function parseSwitchStrToObj(switch_str) {
        resultObj = {};
        var switch_str_split = switch_str.split(':');
        if (switch_str_split.length > 1) {
          var name = switch_str_split[0];
          var value = switch_str_split.splice(1).join(":")
          if (value.indexOf(']') > -1 && value.indexOf('[') > -1) {
            value = UtilitiesService.removeAllOccurrancesArr(value, ['[', ']']);
            if (value.indexOf(', ') > -1) UtilitiesService.replaceAll(value, ', ', ',');
            value = value.split(',')
            for (var i = 0; i < value.length; i++) {
              var indexVal = value[i];
              var indexValSplit = indexVal.split(':');
              if (indexVal && indexVal.length && indexValSplit.length > 1) {
                var argName = indexValSplit[0].trim();
                var argValue = indexValSplit[1].trim();
                var argResult = parseSwitchValueArg(scope, element, argName, argValue);
                if (argResult && argResult.key && argResult.value) {
                  resultObj[argResult.key] = argResult.value;
                }
              }
            }
            if (Object.keys(resultObj) && Object.keys(resultObj).length) {
              resultObj.name = name;
              resultObj.switches = [];
              resultObj.activeSwitches = [];
              return resultObj;
            }
          }
        }
        return
      }

      function parseSwitchValueArg(scope, element, arg, value) {
        switch(arg) {
          case ("change-delay"):
            return {key: 'changeDelay', value: parseInt(value)};
            break;
          case ("active-limit"):
            return {key: 'activeLimit', value: parseInt(value)};
            break;
          case ("data"):
            return {key: 'data', value: value};
            break;
        }
      }
    }

    function setShortcutDict(_shortcuts) {
      shortcuts = _shortcuts
    }

    function sendMessageViaDropdown(scope, arg_type, event_name, attr, message, index) {
      if (!arg_type) arg_type = 'send';
      if (arg_type !== 'send') return;
      if (!arg_type || !arg_type.length || !message || !message.length) return;

      var camelMsg = UtilitiesService.camelCase('when-' + message);
      var dataAttrName = UtilitiesService.camelCase(event_name.toLowerCase() + '-data');
      if (dataAttrName in attr) {
          var sendVars = UtilitiesService.replaceAll(attr[dataAttrName] + "", ' ', '').split(',')
          scope.root.public.customStates['when'][camelMsg] = {};
          for (var i = 0; i < sendVars.length; i++) {
            UtilitiesService.replaceAll(attr[dataAttrName] + "", '_', '-');
            var indexKeyFormatted =  UtilitiesService.camelCase(sendVars[i]);
            scope.root.public.customStates['when'][camelMsg][indexKeyFormatted] = scope.dropdown.options[index][sendVars[i]];
          }
      } else {
          scope.root.public.customStates['when'][camelMsg] =scope.dropdown.options[index][attr[dataAttrName]];
      }
      // console.log('sending message', dataAttrName, message, 'with data format', scope.root.public.customStates['when'][camelMsg])
    }

    function getShortcuts() {
      return shortcuts;
    }

    function getSupportedOnStates() {
      return ['on-init', 'on-enter', 'on-exit', 'init-with', 'init-later', 'on-click', 'on-mouse-enter', 'on-mouse-leave']
    }
    function getSupportedAsStates() {
      return ['as-init', 'as-enter', 'as-exit', 'as-init-later', 'as-click', 'as-mouse-enter', 'as-mouse-leave'];
    }

    function getDefaultSecondaryArgs(arg_type) {
      switch (arg_type) {
        case("class"):
          return defaultSecondaryArgs['_class'];
          break
      }
    }

    function initCustomStateWatcher(scope, element, type, args, attr_value) {
      if (element[0].hasAttribute('u') && !element[0].hasAttribute('stagger-children')) return;
      if (scope.root && scope.root.public && !(type in scope.root.public.customStates)) {
              scope.root.public.customStates[type] = {};
      }
      var watchState = 'root.public.customStates.' + type + '.' + args.camel;
      scope.$watch(watchState, function(new_value, old_value) {

        if (new_value) {
          $timeout(function() {
            scope.root.public.customStates[type][args.camel] = false;
          })
          var formattedAttrValue = attr_value + "";
          if (typeof(new_value) === "object") {
            for (objKey in new_value) {
              var formattedObjKey = '^' + objKey;
              if (formattedAttrValue.indexOf(formattedObjKey) > -1) {
                formattedAttrValue = formattedAttrValue.replace(formattedObjKey, new_value[objKey])
              }

            }
          }
          var elemArgs = parseArgs(formattedAttrValue, args && args.dashed || type, element);

          for (key in elemArgs) {
            if ((argNames || supportedCommands).indexOf(key) > -1) {

              activateArg(key, elemArgs[key], scope, element);
            }
          }
        }
      })
    }

    function detectExternalStates(attr_dict) {
      var resultArr = [];
      var supportedExternalStates = ['when', 'as'];
      for (attr in attr_dict) {
        for (var i = 0; i < supportedExternalStates.length; i++) {
          var indexSupportState = supportedExternalStates[i] + '-';
          var dashedAttr = UtilitiesService.camelToDash(attr).toLowerCase();
          if (dashedAttr.indexOf(indexSupportState) > -1) {
            resultArr.push({type: indexSupportState.replace('-', ''), attr: {camel: attr, dashed: dashedAttr}})
          }
        }
      }
      return resultArr
    }

    function parseCustomStateAttr(attr) {
      var customStateDict = {}
      if ('when' in attr) {
        customStateDict.when = [];
        var whenAttr = attr.when && attr.when.replace(', ', ',');
        var whenAttrArr = whenAttr.split(',');
        for (var i = 0; i < whenAttrArr.length; i++) {
          var indexWhenAttr = whenAttrArr[i];
          customStateDict.when.push('when-' + indexWhenAttr);
        }
      }
      return customStateDict;
    }

    function parseArgs(string_args, state_name, elem) {
      if (window.location.href.indexOf('/admin/api/animations/prop/') > -1 && !elem[0].hasAttribute('player-control')) {
        return {};
      }
      string_args = UtilitiesService.replaceAll(string_args, ', ',  ',');
      string_args = UtilitiesService.replaceAll(string_args, '| ',  '| ');
      string_args = UtilitiesService.replaceAll(string_args, ' | ',  ' | ');
      var argArr = string_args.split('|');

      var processedArgResults = argArr && processArgArr(argArr);

      var className = (elem && elem[0].className && typeof(elem[0].className) === 'string' && elem[0].className.replace(' ', '-')) || '';
      var processedArgDict = {};
      for (secondary_arg in processedArgResults) {
        var _type = processedArgResults[secondary_arg].type;
        var _value = processedArgResults[secondary_arg].value;

        processedArgResults[secondary_arg] = processSecondaryArgsByType(_type, _value, processedArgResults[secondary_arg], state_name, elem);
        processedArgDict[_type] = processedArgResults[secondary_arg];
      }

      return processedArgDict;
    }

    function setAnimationWithPreviousStyle(new_anim, index, style, value, state_name) {
      var resultStr = '';
      var newAnimStyle = '';

      if (style.split(' ')[1] === '0s' && style.split(',').length === 1) {
        style=''
      }
      if (new_anim && new_anim.Animation[index] && new_anim.Animation[index].length) {
        newAnimStyle = new_anim.Animation[index];
      }
      if (new_anim.Duration[index] && new_anim.Duration[index].length) {
        newAnimStyle += (' ' + new_anim.Duration[index])
      }
      if (new_anim.TimingFunction[index] && new_anim.TimingFunction[index].length) {
        newAnimStyle += (' ' + new_anim.TimingFunction[index])
      }
      if (new_anim.Delay[index] && new_anim.Delay[index].length) {
        newAnimStyle += (' ' + new_anim.Delay[index])
      }

      if (new_anim.IterationCount[index] && new_anim.IterationCount[index].length) {
        newAnimStyle += (' ' + new_anim.IterationCount[index])
      }

      if (new_anim.Direction[index] && new_anim.Direction[index].length) {
        newAnimStyle += (' ' + new_anim.Direction[index])
      }


      if (new_anim.FillMode[index] && new_anim.FillMode[index].length) {
        newAnimStyle += (' ' + new_anim.FillMode[index])
      }

      if (newAnimStyle.split(' ').length === 7) {
        newAnimStyle += ' paused'
      }
      if (style && style.length) {
          style += ', ' + newAnimStyle
      } else {
        style = newAnimStyle.replace('running', 'paused');
      }
      console.log(style);
      return style;
    }


    function processArgArr(arg_arr) {
      //trim extra space
      var resultArr = [];
      arg_arr.forEach(function(item) {item.trim()});
      for (var i = 0; i < arg_arr.length; i++) {
        var indexArg = arg_arr[i];
        var indexSupportedArg = getSupportedArg(indexArg);

        if (indexSupportedArg) {
          resultArr.push(indexSupportedArg);
        }
      }
      return resultArr;
    }

    function activateArgDelay(arg_type, arg_dict, scope, elem, delay, cb) {
      $timeout(function() {
        console.log('triggering after', delay, 'delay', typeof delay);
        activateArg(arg_type, arg_dict, scope, elem)
        cb && cb();
        $timeout(function() {

          console.log('current switches active', scope.$parent.switchDict[scope.switch.name].activeSwitches);
        }, 1000)
      }, delay)
    }



    function activateArg(arg_type, arg_dict, scope, elem) {
      switch(arg_type) {
        case("prop"):
          if (arg_dict.ttt) {
            return;
          }
          evalPropertyArgs(arg_dict, scope, elem);
          break;
        case("class"):
          evalClassArgs(arg_dict, scope, elem);
          break
        case("send"):
          evalSendArgs(arg_dict, scope, elem);
          break;
        case("anim"):
          evalAnimArgs(arg_dict, scope, elem);
          break;
        case("trigger"):
          evalTriggerArgs(arg_dict, scope, elem);
          break
        case("eval"):
          evalArgsWithScope(arg_dict, scope, elem);
          break
        case("transform"):
          var response = evalTransformArgs(arg_dict, scope, elem);
          if (!response || !response.length) {
            $timeout(function() {
                evalTransformArgs(arg_dict, scope, elem);
                scope.$apply();
            })
          }
      }
    }


    function evalArgsWithScope(arg_dict, scope, elem) {
      console.log(arg_dict, scope, elem)
    }

    function evalTransformArgs(arg_dict, scope, elem) {
      var transformArr = arg_dict.transforms;
      var resultArr = [];
      for (var i = 0; i < transformArr.length; i++) {
        var indexTransform = transformArr[i];
        var extensions = [];
        var resultPropDict = {properties:[], type:'prop'};
        var transformPrefix = formatBrowserCSSProperty('transform');
        var transitionObj = {duration: 0, properties:[], timingFunction: 'ease'};
        var transformPropDict = TransformService.parseTransformArgs(indexTransform, elem);
        if (transformPropDict.ext) {
          for (key in transformPropDict['ext']) {
            var propDict = {};
            propDict[key] = transformPropDict['ext'][key];
            extensions.push(propDict);
          }
          delete transformPropDict['ext']
        }
        if (transformPropDict.delay || transformPropDict.delay === 0) {
          resultPropDict.delay = transformPropDict.delay;
          delete transformPropDict['delay']
        }


        if (!transformPropDict) return;
        if (transformPropDict.duration) {
          transitionObj.duration = transformPropDict.duration;
          delete transformPropDict['duration'];
        }
        if (transformPropDict.timingFunction) {
          transitionObj.timingFunction = transformPropDict.timingFunction;
          delete transformPropDict['timingFunction'];
        }



        //break if none exist;

        if (Object.keys(transformPropDict).length) {
          var transformValueStr = '';
          for (key in transformPropDict) {
            if (transformPropDict[key] && (transformPropDict[key].length) || typeof(transformPropDict[key]) === 'number' ) {
              transformValueStr += key + '(' + transformPropDict[key] + ') ';
            }

          }

          var browserProperty = formatBrowserCSSProperty('transform');
          var transformDict = {};
          transformDict[browserProperty] = transformValueStr;
          resultPropDict.properties.push(transformDict);
        }
        if (extensions && extensions.length) {
          for (var i = 0; i < extensions.length; i++) {
            var key = Object.keys(extensions[i])[0];
            var value = extensions[i][key];
            var keyBrowserFormatted = RootService.formatBrowserCSSProperty(key);
            var propDict = {};
            propDict[keyBrowserFormatted] = value;
            resultPropDict.properties.push(propDict);
          }
        }


        if (transitionObj.duration || transitionObj.timingFunction) {
          var transitionDict = formatTransitionString(transitionObj, elem);
          resultPropDict.properties.push(transitionDict);
        }
        if (resultPropDict.properties && resultPropDict.properties.length) {
          evalPropertyArgs(resultPropDict, scope, elem);
          resultArr.push(resultPropDict);
        }
      }

      return resultArr;
    }

    function formatBrowserCSSProperty(property) {
      var dashedPrefixedProps = ['transition', 'transform']
      var browserPrefix = RootService.getBrowserPrefix();
      if (browserPrefix && browserPrefix.length && dashedPrefixedProps.indexOf(property.toLowerCase()) > -1) {
        property = '-' + browserPrefix + '-' + property
      }
      return property
    }
    function formatTransitionString(obj, elem) {
      var elemTransitionDurationStyle = elem[0].style['transitionDuration'] || elem[0].style['webkitTransitionDuration'];
      var properties = obj.properties.join(" ") || 'all';
      var propName = formatBrowserCSSProperty('transition');
      var propDelay = obj.delay && (obj.delay + 'ms');
      var propDuration = (obj.duration && (obj.duration + 'ms')) || elemTransitionDurationStyle || '1000ms';
      var propTimingFunc = obj.timingFunction || 'ease'

      var valueString = [properties, propDuration, propTimingFunc, propDelay].join(" ").trim()
      var resultDict = {};
      resultDict[propName] = valueString
      return resultDict;
    }

    function findReplaceParens(string_args) {
      var resultDict = {}
      var parentheticalArr = string_args.match(/\((.*?)\)/g);
      parentheticalArr.forEach(function(value, index) {resultDict[index + ""] = UtilitiesService.removeAllOccurrancesArr(value, ['(', ')']); string_args = UtilitiesService.replaceAll(string_args, value, '<<>>')});
      return resultDict
    }

    function processTransformArgs(string_args) {
      var resultDict = {};
      var parentheticalArr = string_args.match(/\((.*?)\)/g);
      var supportedKeys = TransformService.getSupported();
      var hasParens = parentheticalArr;
      var parenthesisDict = hasParens && findReplaceParens(string_args);

      string_args = UtilitiesService.removeAllOccurrancesArr(string_args, ['[', ']']);
      string_args = UtilitiesService.replaceAll(string_args, ', ', ',');
      var kvPairs = string_args.split(',');

      for (var i = 0; i < kvPairs.length; i++) {
        var kvIndexSplit = kvPairs[i].split(':')
        if (hasParens) {
          var paramString =  ((i + '') in parenthesisDict && parenthesisDict[i + '']) || ''
          var kvIndexSplit = UtilitiesService.replaceAll(kvPairs[i], '<<>>', paramString ).split(':');
        }
        var indexKey = kvIndexSplit[0];

        var indexValue;
        if (kvIndexSplit.length > 1) {
          indexValue = kvIndexSplit[1];


          indexValue = UtilitiesService.removeAllOccurrancesArr(indexValue, ['(', ')']);
          if (supportedKeys.indexOf(indexKey.toLowerCase()) > -1) {
            if (indexKey === 'delay' || indexKey === 'duration') {
              indexValue = parseInt(indexValue);
            }
            resultDict[indexKey] = indexValue;

          }
        }
      }
      for (key in resultDict) {
        if (['rotate', 'scale', 'translate', 'to', 'timingFunc', 'tf'].indexOf(key) > -1) {
          if (key === 'timingFunc' || key === 'tf') {
            resultDict[key] = resultDict[key].replace('cb', 'cubic-bezier').replace('cubic-bezier', 'cubic-bezier ').split(' ')[0] + hasParens[0];
          } else {
            resultDict[key] = UtilitiesService.removeAllOccurrancesArr(hasParens[0], ['(', ')']);
          }

        }
      }
      return {type: 'transform', transforms: [resultDict]}
    }

    function processSecondaryArgsByType(type, string_args, processed_args, state_name, elem) {
      switch(type) {
        case ("transform"):
          return processTransformArgs(string_args)
          break;
        case ("prop"):

          return formatAndProcessArgs(type, string_args, {properties:[]}, 'properties', processCSSPropValue, ['transition'], state_name, elem);
          break;

        case ("class"):

          return formatAndProcessArgs(type, string_args, {classes:[]}, 'classes', processClassSecondaryArgs, ['add', 'remove', 'set']);
          break;

        case ("send"):
          var sendArgs = formatAndProcessArgs(type, string_args, {messages:[]}, 'messages', processSendSecondaryArgs, ['public', 'children']);

          return sendArgs
          break;

        case ("anim"):
          return formatAndProcessArgs(type, string_args, {animations:[]}, 'animations', processAnimSecondaryArgs, ['type', 'force']);
          break;

        case ("ttt"):
          return formatTTTArgs(type, string_args)

        case ("eval"):
          return formatAndProcessArgs(type, string_args, {functions: []}, 'functions',processEvalSecondaryArgs, [])
          break;

        case ("tween"):
          return formatTweenArgs(string_args);
          break;

        case ("trigger"):
          return formatAndProcessArgs(type, string_args, {states:[]}, 'states', processTriggerSecondaryArgs, ['state'])
      }

      function formatTTTArgs(type, string_args) {
        string_args = string_args.replace('[', '').replace(']', '');
        var animationProperties = ['Property', 'Duration',  'TimingFunction', 'Delay', 'IterationCount',  'Direction', 'FillMode', 'Animation'];
        var prefixes = ['p','dur','tf', 'del', 'i', 'dir', 'fm', 'a'];
        var argSplit = string_args.split(' ');
        var validPrefixArr = argSplit.filter(function(pre, i) {return  pre.split(':').length > 1 && prefixes.indexOf(pre.split(':')[0]) > -1});
        var animArr = [];
        var animDict = {};
        animationProperties.forEach(function(a, i) {animDict[a] = []});
        validPrefixArr.forEach(function(pre, i) {
          var preSplit = validPrefixArr[i].split(':');

          var prefixName = preSplit[0].trim()
          var iValue = UtilitiesService.removeAllOccurrancesArr(preSplit[1].trim(), ["(", ')']);
          var formalPrefixName = animationProperties[prefixes.indexOf(prefixName)];
          var values = iValue.split(',');
          values.forEach(function(val, j) {
            var parsedValue = parsePrefix(formalPrefixName, val);
            animDict[formalPrefixName].push(parsedValue);
          });
        })
        var numUniqueAnimations = animDict['Property'].length;
        for (var i = 0; i < numUniqueAnimations; i++) {

          for (key in animDict) {
            if (animDict[key].length > 1) {
              continue;
            } else
            if (animDict[key].length === 1) {
              animDict[key].push(getDefaultAnimationPropertyValue(key));
            } else
            if (!animDict[key].length || animDict[key] === 0) {
              animDict[key].push(getDefaultAnimationPropertyValue(key))
            } else
            if (animDict[key].length && animDict[key].length <= numUniqueAnimations) {
              animDict[key].push(animDict[key][i- 1])
            }
            else if (!animDict[key]) {
                // animDict[key].push(previousKey);
              console.log('else', key)
            }
          }
        }

        console.log(animDict);
        return animDict;

      }

      function getDefaultAnimationPropertyValue(prop) {
        prop = prop.toLowerCase();
        switch (prop) {
          case ("delay"):
            return "0s"
            break;
          case ("iterationcount"):
            return "1"
            break;
          case ("direction"):
            return "normal"
            break;
          case ("fillmode"):
            return "none";
            break
          case ("timingfunction"):
            return "ease"
            break;
          case ("duration"):
            return "1000ms"
            break;
        }
      }

      function parsePrefix(pre, val, animationProperties) {
        if (pre === 'TimingFunction' && val.split('cb').length > 1) {
          val = UtilitiesService.replaceAll(val.replace('cb','cubic-bezier('), '#', ',') + ')';
          return val;
        }
        return val;
        // if (pre === '') {
        //   console.log
        // }
      }

      function initAnimationObjWithProperty(prop, tf, anim_name) {
        return function(state_name, from, to) {
            var anim;
            var name;
            var state_name = state_name && ('-' + state_name) || ''
            if (!anim_name) {
              anim = AnimationService.initCSSAnimation(name);
              name = UtilitiesService.camelCase('anim-' + prop + state_name);
              anim.appendRule(0 + "% {" + prop + ':' + from + ";}", 0);
              anim.appendRule(100 + "% {" + prop + ':' + to + " }", 1);
            } else {
              var name = UtilitiesService.camelCase('anim-' + '-' + anim_name + state_name);
              anim = AnimationService.getAnimationObjFromAnimationName(anim_name)
            }
            anim.name = name;
            return anim
        }
      }


      function processAnimSecondaryArgs(msg_name, arg, prop_dict, orig_str, i) {

        if (!arg || arg.indexOf('set') > -1 || arg.indexOf('delay-') > -1 || arg.indexOf('before') > -1 || arg.indexOf('after') > -1) {
          arg = 'obj';

            prop_dict.custom = orig_str[i].replace(msg_name + ':', '');


        }
        return arg
      }

      function processEvalSecondaryArgs(trigger_name, arg, prop_dict, orig_str, i) {
        if (!arg) {
          arg = 'self'
        }
        prop_dict.custom = orig_str.join(",");
        return null
      }

      function processTriggerSecondaryArgs(trigger_name, arg) {
        if (!arg) {
          arg = 'self'
        }
        return arg.trim();
      }

      function processSendSecondaryArgs(msg_name, arg, prop_dict, orig_str) {
        if (!arg || !arg.length) {
          arg = 'public'
        }
        if (arg.indexOf('delay-') > -1) {
          arg = 'public'
        }
        return arg.trim();
      }

      function processClassSecondaryArgs(class_name, arg) {
        class_name = class_name.trim();
        arg = arg.trim();
        return arg;
      }
    }

    function processCSSPropValue(name, value, prop_dict, orig_str) {


      //2nd arg of if --> fill:#;
      if (value && value.indexOf('#') > -1 && value.indexOf('#') > 0) {
        value = value && UtilitiesService.replaceAll(value, '#', ',');
      }
      name = (name && name.trim()) || '';
      value = (value && value.trim()) || '';
      var propertiesToConvertInt = [];
      if (propertiesToConvertInt.indexOf(name) > -1 && typeof(name) === 'string') {
        if (value.indexOf('.') > -1) {
          return parseFloat(value);
        } else {
          return parseInt(value);
        }
      }
      return value
    }






    //todo modularize
    function formatAndProcessArgs(type, string_args, base_dict, base_dict_key, custom_func, custom_args, state_name, elem) {
      var customAnimations = RootService.getCustomAnimations();
      var customAnimNameOnly = customAnimations.customNameOnly;
      var propDict = base_dict
      propDict.type = type;
      var generalArgs = '';
      if (isFirstArgAnArr(string_args)) {
        //array case
        var stringPropArgs = processStrArrToObj(string_args);
        var hasPlayer = false;

        for (var i = 0; i < stringPropArgs.length; i++) {
          var parsedPropDict = {};

          var kvPairSplit = stringPropArgs[i].split(':');

          var key = kvPairSplit[0];
          var value = kvPairSplit[1];


          parsedPropDict[key] = custom_func(key, value, parsedPropDict, stringPropArgs, i);


          if (kvPairSplit.length > 2) {


            parsedPropDict = processGeneralArgsArray(type, kvPairSplit.splice(2), parsedPropDict, custom_args);

            // if (key in PropertyService.defaultPropAnimations) {

            //   if (!('custom' in parsedPropDict)) {
            //     parsedPropDict['custom'] = '';
            //   }
            //   parsedPropDict['default'] = true;
            // }

            // if (type === 'prop' &&  customAnimNameOnly.indexOf(key) > -1) {
            //   var animObjIndex = customAnimNameOnly.indexOf(key);
            //   var animObj = customAnimations.custom[animObjIndex];
            //   var propFrames = PropertyService.parseAnimObjToPropArr(animObj.cssRules);
            //   console.log('\n-----------------------\n**', animObj.name, '**\n');
            //   for (key in propFrames.props) {
            //     var frames = propFrames.props[key];
            //     console.log(key, '-' , frames.length, 'frames')
            //     for (var i = 0; i < propFrames.props[key].length; i++) {
            //       var propObj = propFrames.props[key][i];
            //       console.log('|' , propObj.percent + '%', propObj.prop, '==>' ,propObj.value)
            //     }
            //     console.log('\n------------------------\n')
            //   }
            //   console.log(parsedPropDict);
            // }

            processCustomArgsArray(type, key, value, string_args, parsedPropDict, custom_args, state_name, elem, hasPlayer);
            // if (type === 'prop' &&  customAnimNameOnly.indexOf(key) > -1) {
            //   var animPropCopy = parsedPropDict.animProp
            //   var animObjIndex = customAnimNameOnly.indexOf(key);
            //   var animObj = customAnimations.custom[animObjIndex];
            //   var propFrames = PropertyService.parseAnimObjToPropArr(animObj.cssRules);
            //   var stringsToAdd = [];
            //   for (key in propFrames.props) {
            //     var valArr = propFrames.props[key];
            //     for (var j = 0; j < valArr.length - 1; j++) {
            //       var duration = animPropCopy.duration * (valArr[j + 1].percent - valArr[j].percent)/100;
            //       var delay = duration * j
            //       var resultStr = key.replace('rgb', 'rgba') + ':' + valArr[j].value + ':' + valArr[j + 1].value + ':' + duration + ':' + animPropCopy.ease + ':' + delay;
            //       console.log(resultStr)
            //       stringsToAdd.push(resultStr);
            //     }
            //   }
            //   stringsToAdd.forEach(function(prop, i) {
            //       stringPropArgs.push(prop);
            //     // stringPropArgs
            //   })
            //   continue;
            // }

          }

          if (parsedPropDict.animProp) {



              hasPlayer = parsedPropDict.animProp.player;
              var baseDelay = base_dict.delay || 0;
              var animPropDelay = parsedPropDict.animProp.delay;
              if (!parsedPropDict.animProp.delay) {
                var finalCheckDelay = string_args.split(']:');
                if (finalCheckDelay.length > 1 && finalCheckDelay[1].indexOf('delay-') > -1) {
                  var delayStr = parseInt(finalCheckDelay[1].replace('delay-', ''));
                  parsedPropDict.animProp.delay = delayStr;
                  // if ()
                }
              }


            // if (base_dict.delay > 0 && parsedPropDict.animProp.delay === NaN) {
            //   console.log('resolve the delay')
            // }
            // console.log(base_dict, string_args, base_dict, base_dict_key)
          }



          propDict[base_dict_key].push(parsedPropDict);
        }
      }
      //parseGeneralArgs

      processGeneralArgs(type, string_args, propDict, custom_args);

      return propDict

    }

    function processCustomArgsArray(type, split_key, split_value, orig_str, arg_dict, d_custom_args, state_name, elem, hasPlayer) {
      var hasDefault = 'default' in arg_dict;

      if (areCustomArgsPropertyAnimation(type, arg_dict)) {

        var startArgs = arg_dict[split_key];
        var customArgs = arg_dict['custom'];
        var endArgs = split_value;


        delete arg_dict['default'];
        delete arg_dict['custom'];
        delete arg_dict['group']


        if ((orig_str.indexOf('rgba') > -1 || orig_str.indexOf(':#') > -1) && ('background' in arg_dict || 'background-color' in arg_dict ))  {
          var endArgsReconstruct = customArgs.split('):')
          var customArgs = endArgsReconstruct[1].trim();
          var endArgs = UtilitiesService.replaceAll(endArgsReconstruct[0] + ')', '#', ',').trim();
          console.log(startArgs, customArgs, endArgs)
        }

        if (((orig_str.indexOf('text-shadow') > -1 || orig_str.indexOf('box-shadow') > -1)) &&
              orig_str.indexOf(' #') > -1) {
          startArgs = startArgs.replace(',', '#').trim();
          endArgs = customArgs.split(':')[0].trim();
          customArgs = customArgs.split(':').splice(1).join(":");
          console.log(startArgs, endArgs);
        }


        var arg_arr = [];
        var propName = split_key;

        startArgs && arg_arr.push(startArgs);
        endArgs && !(endArgs === startArgs) && arg_arr.push(endArgs);

        customArgs && customArgs.split(':').filter(function(a) {return a.length}).forEach(function(a) {arg_arr.push(a)})

        arg_dict.animProp = PropertyService.getFrameAnimationFunc(elem, propName, arg_arr, state_name, hasDefault, hasPlayer);
      }


      function areCustomArgsPropertyAnimation(type, arg_dict) {
        return type === 'prop' && 'custom' in arg_dict && arg_dict.custom.length && arg_dict.custom.split(':').length > 1
      }

      return arg_dict;
    }

    function processGeneralArgs(type,string_args, prop_dict, custom_args) {
      var propDict = prop_dict;//lazy cutnpaste
      var generalArgs = string_args.substring(string_args.indexOf(']') + 1).split(':').filter(function(a) {return a.length});
      if (generalArgs && generalArgs.length) {
        var processedGeneralArgs = processGeneralArgsArray(type, generalArgs, prop_dict, custom_args);
        if (processedGeneralArgs) {
          for (g_arg in processedGeneralArgs) {
            propDict[g_arg] = processedGeneralArgs[g_arg];
          }
        }
      }
    }

    function isFirstArgAnArr(string_args) {
      return string_args[0] === '['
    }

    function processStrArrToObj(string_args) {
      var propArrEndIndex = string_args.indexOf(']');
      var stringPropArgs = string_args.substring(1, propArrEndIndex).split(',');
      return stringPropArgs;
    }

    function processGeneralArgsArray(type, arg_arr, result_dict, custom_args) {

      var resultDict = result_dict || {};
      var notProcessed = [];
      for (var i = 0; i < arg_arr.length; i++) {
        var indexArg = arg_arr[i];
        if (indexArg && indexArg.length) {
          indexArg.trim();
          if (indexArg.indexOf('delay-') > -1) {
            indexArg = indexArg.replace('delay-', '');
            resultDict.delay = parseInt(indexArg);
          }
          else {
            notProcessed.push(indexArg);
          }
        }
      }
      if (notProcessed && notProcessed.length && !resultDict.custom) {
        resultDict.custom = notProcessed.join(":");
      }
      if (Object.keys(resultDict).length) {
        return resultDict;
      }
      return
    }


    function formatSendArgs(string_args, support_args) {

    }

    function formatAnimArgs(string_args, support_args) {

    }

    function formatTweenArgs(string_args, support_args) {

    }

    function evalTriggerArgs(arg_dict, scope, elem) {
      // console.log('should be evaluating trigger', arg_dict, scope, elem);
      if (arg_dict.delay) {
        $timeout(function() {
          processTriggerArr(arg_dict.states, scope, elem);
        })
      } else {
          processTriggerArr(arg_dict.states, scope, elem);
      }
    }

    function processTriggerArr(state_arr, scope, elem) {
      for (var i = 0; i < state_arr.length; i++) {
        var indexStateObj = state_arr[i];
        var delay = indexStateObj.delay || 0;
        delete indexStateObj['delay'];
        var stateName = Object.keys(indexStateObj)[0];
        var stateScope = indexStateObj[stateName];
        triggerStateWithinScope(stateName, stateScope, delay, scope, elem);
        // sendMessageWithinScope(formatMessage(messageName), messageScope, delay, scope, elem)
      }

      function triggerStateWithinScope(stateName, stateScope, delay, scope, elem) {
        // if (stateName.indexOf('when-') > -1) {
        //   console.log()
        // }
        if (delay) {

          $timeout(function() {
            dispatchTrigger(stateName, stateScope, elem, scope);
            $timeout(function() {
              scope.$apply();
            })
          }, delay)
        } else {
          dispatchTrigger(stateName, stateScope, elem, scope);

          $timeout(function() {
              scope.$apply();
          })
        }

        function dispatchTrigger(trig_name, trigger_scope, elem, reg_scope) {
          if (trigger_scope === 'self' && trig_name.indexOf('when-') > -1) {
            trigger_type = 'when';
            // trigger_msg = trig_name.replace('when-', '');
            var triggerCamel = UtilitiesService.camelCase(trig_name);
            console.log(elem[0].getAttribute(trig_name))
            var elemArgs = parseArgs(elem[0].getAttribute(trig_name), trig_name, elem);

            for (key in elemArgs) {

              if ((argNames || supportedCommands).indexOf(key) > -1) {
                activateArg(key, elemArgs[key], scope, elem);
              }
            }
          } else
          if (trigger_scope === 'self') {
            triggerActionOnElem(trig_name, elem[0]);
          } else if (trigger_scope === 'parent') {
            triggerActionOnElem(trig_name, elem[0].parentNode);
            // elem[0].parentNode.classList.add(trig_name);
          } else if (trig_name === 'switch' && trigger_scope && trigger_scope.length) {
            var className = UtilitiesService.camelToDash(trigger_scope.toLowerCase());
            triggerActionOnElem('switch' + '-' + className, elem[0]);
          }
          else if (trigger_scope === 'children') {
            var children = elem[0].children;
            for (var i = 0; i < children.length; i++) {
              var indexChild = children[i];
              indexChild && triggerActionOnElem(trig_name, indexChild)
            }
          } else if (trigger_scope === 'siblings') {

            var siblings = elem[0].parentNode.children;
            for (var i = 0; i < siblings.length; i++) {
              var indexSibling = siblings[i];
              if (indexSibling !== elem[0]) {
                indexSibling && triggerActionOnElem(trig_name, indexSibling);
              }
            }
          }

          function triggerActionOnElem(trig_name, elem) {
            var implementedTriggers = ['on-click', 'on-hover', 'on-mouse-leave', 'on-mouse-enter'];
            if (implementedTriggers.indexOf(trig_name) > -1) {
              angular.element(elem).triggerHandler(trig_name);
            } else if (trig_name === 'switch') {
              elem.classList.add('switch-toggle');
            }
            else {
              elem.classList.add(trig_name);
            }
          }
        }
     }
  }

    function evalSendArgs(arg_dict, scope, elem) {
      // var toDashed = UtilitiesService.camelToDash(msg_name).toLowerCase();

      if (arg_dict.delay) {
        $timeout(function() {
          processMessageArr(arg_dict.messages, scope, elem);

        }, arg_dict.delay)
      } else {

        processMessageArr(arg_dict.messages, scope, elem);
      }
    }

    function processMessageArr(message_arr, scope, elem) {
      for (var i = 0; i < message_arr.length; i++) {
        var indexMessageObj = message_arr[i];
        var dataDict;
        if (indexMessageObj.custom && indexMessageObj.custom.indexOf('data:') === 0) {
          var dataVar = UtilitiesService.removeAllOccurrancesArr(indexMessageObj.custom.split('data:')[1], ['(', ')']);
          var dataVarArgs = dataVar.split('#');
          for (var j = 0; j < dataVarArgs.length; j++) {
            var dataVarArr = dataVarArgs[j].split('.')
            var resultDict = {};
            if (dataVarArr.length > 1 && dataVarArr[0] in scope) {
              var nextDict = scope[dataVarArr.splice(0, 1)];

              for (var k = 0; k < dataVarArr.length; k++) {
                indexVar = dataVarArr[k];
                if (indexVar in nextDict) {
                  nextDict = nextDict[indexVar];
                } else {
                  break;
                }
              }
              if (nextDict && typeof nextDict === 'string') {
                // scope.root.public.customStates['when'][camelMsg][indexKeyFormatted]
                // console.log(scope.root.public.customStates)
                if (!dataDict) dataDict = {};
                dataDict[dataVarArgs[j]] = nextDict
              }

            }
          }
          delete indexMessageObj['custom']
        }

        var delay = indexMessageObj.delay || 0;
        delete indexMessageObj['delay'];
        var messageName = Object.keys(indexMessageObj)[0];
        var messageScope = indexMessageObj[messageName];
        var messageDashedName = 'when-' + messageName;

        // console.log(elem)
        sendMessageWithinScope(formatMessage(messageName), messageScope, dataDict, delay, scope, elem)
      }

      function formatMessage(message_name) {
        return UtilitiesService.camelCase('when-' + message_name);
      }

      function sendMessageWithinScope(msg_name, msg_scope, msg_data, delay, scope, elem) {

        // console.log('sending..', , 'with scope', msg_scope, delay, scope.root.public.customStates);

        if (delay) {
          $timeout(function() {
            activateScopedMessageState(msg_name, msg_data,msg_scope, scope);
            $timeout(function() {
              scope.$apply();
            })
          }, delay)
        } else {
          activateScopedMessageState(msg_name, msg_data, msg_scope, scope);
          $timeout(function() {
              scope.$apply();
          })
        }
        function activateScopedMessageState(msg_name, msg_data, env, scope) {
          var msgType = UtilitiesService.camelToDash(msg_name).toLowerCase().split('-')[0];
          if (!(msgType in scope.root.public.customStates)) {
            scope.root.public.customStates[msgType] = {};
          }
          scope.root.public.customStates[msgType][msg_name] = msg_data ||true;
        }
      }

    }

    function evalAnimArgs(arg_dict, scope, elem) {

      if (arg_dict.delay) {
        $timeout(function() {
          processAnimArr(arg_dict.animations, scope, elem);
        })
      } else {
        processAnimArr(arg_dict.animations, scope, elem);
      }
    }


    function parseAfterArgs(arg_string, scope, elem) {
        var argSplit = arg_string.split(':');

        if (argSplit.length > 1) {
          var argName = argSplit[0].toLowerCase();
          var argValue = '[' + argSplit.splice(1).join(":") + ']'
          var processedValueDict = parseArgs(argName + ':' + argValue);
          return function() {
            for (key in processedValueDict) {
              activateArg(key, processedValueDict[key], scope, elem);
            }
          }

        }
      }

      function processSetExtraArgs(set_str) {
      if (!(set_str.split('(').length > 1)) {
          set_str = UtilitiesService.removeAllOccurrancesArr(set_str, ['(', ')'])
      }
      set_str = UtilitiesService.replaceAll(set_str, ', ', '');
      set_str = UtilitiesService.replaceAll(set_str, '##', ',');
      var setPropertyArr = set_str.split('#');
      var resultArr = [];
      for (var i = 0; i < setPropertyArr.length; i++)  {
        var setPropIndex = setPropertyArr[i];
        var propDict = {};
        if (setPropIndex.indexOf(':impt') > -1) {
          setPropIndex = setPropIndex.replace(':impt', '');
          propDict.important = true;
        }
        setPropIndexSplit = setPropIndex.split(':');
        if (setPropIndexSplit.length === 2) {
          var name = setPropIndexSplit[0];
          var value = setPropIndexSplit[1]
          propDict[name] = processCSSPropValue(name, value);
        }
        resultArr.push(propDict);
      }
      return resultArr;
    }

    function processAnimArr(anim_arr, scope, elem) {

      for (var i = 0; i < anim_arr.length; i++) {
        var indexAnimObj = anim_arr[i];
        var delay = indexAnimObj.delay || 0;
        delete indexAnimObj['delay'];

        var custom = indexAnimObj.custom;
        var customDict = {};
        delete indexAnimObj['custom'];
        if (custom) {
          processAnimCustomArgs(custom, customDict);
        }

        var animName = Object.keys(indexAnimObj)[0];
        var animType = indexAnimObj[animName];
        runOneAnimation(animName, animType, delay, scope, elem, customDict);

        if (delay) {
          indexAnimObj['delay'] = delay;
        }
        if (custom) {
          indexAnimObj['custom'] = customDict;
        }

        function processAnimCustomArgs(custom_str, custom_dict) {
          if (typeof custom_str === 'object') {
            return;
          }
          if (custom_str && custom_str.indexOf('set:') > -1) {
            var setString = custom_str + "";
            setString = setString.split('set:(')[1];
            var endParenthesis = setString.indexOf('):') || setString.indexOf('),') || setString.indexOf(')');
            setString = setString.substring(0, endParenthesis);
            custom_dict.set = processSetExtraArgs(setString);

          }
          if (custom_str &&  custom_str.indexOf(':before') > -1) {
            custom_dict.before = true;
          }
          if (custom_str && custom_str.indexOf(':after') > -1) {
            var afterArgs = custom_str.split(':after:')
            if (afterArgs.length > 1 && afterArgs[1].length && afterArgs[1].indexOf('(') > -1 && afterArgs[1].indexOf(')') > -1) {
              afterArgs = UtilitiesService.removeAllOccurrancesArr(afterArgs[1], ['(', ')']);
              var afterArgsType = afterArgs.split(':')[0];
              custom_dict.after = {value: true, type: afterArgsType, func: parseAfterArgs(afterArgs, scope, elem)}
            } else {
              custom_dict.after = {value: true, type: 'set' in custom_dict};
            }
          }
          if (custom_str && custom_str.indexOf(':in') > -1) {
            custom_dict.in = true;
          }
          if (custom_str && custom_str.indexOf(':out') > -1) {
            custom_dict.out = true;
          }
        }
      }



      function runOneAnimation(anim_name, anim_type, delay, scope, elem, custom_args) {
        var animStartCb;
        var animEndCb;

        if (animType === 'obj') {
          var animObj = AnimationService.getAnimationObjFromAnimationName(anim_name);
          if (animObj) {
            if (custom_args.out) {

              animStartCb = function() {
                // $timeout(function() {
                  elem[0].style.opacity = 0;
                // })
              }
            }
            if (custom_args.after && custom_args.after.value) {
              animEndCb = function() {
                if (custom_args.after.func) {
                  custom_args.after.func();
                }
                var propDict = {properties:custom_args.set};
                evalPropertyArgs(propDict, scope, elem);
              }
            }
            var start_cb = animStartCb(elem, custom_args)
            if (delay) {
              $timeout(function() {
                if (custom_args && custom_args.set && (!custom_args.after || !custom_args.after.value || custom_args.before)) {
                  var propDict = {properties:custom_args.set};
                  evalPropertyArgs(propDict, scope, elem);
                }

                execAnimation(elem, anim_name, animObj, delay, start_cb, animEndCb)
              }, delay)
              return;
            }
            if (custom_args && custom_args.set && (!custom_args.after || custom_args.before)) {
              var propDict = {properties:custom_args.set};
              evalPropertyArgs(propDict, scope, elem);
            }
            execAnimation(elem, anim_name, animObj, delay, start_cb, animEndCb)
            // AnimationService.animate(elem[0], anim_name, animObj, delay, animStartCb, animEndCb);
          }
          return;
        }
        function animStartCb(elem, custom_args) {

            return function() {
              if (custom_args.in) {
                elem[0].style.opacity = 1;
              }
              if (custom_args.out){
                elem[0].style.opacity = 0;
              }
            }
        }
      }

      function execAnimation(elem, anim_name, anim_obj, delay, start_cb, end_cb) {
        var browser_prefix = RootService.getBrowserPrefix();
          initAndTriggerAndRemoveAnimStartFunc(elem, browser_prefix, start_cb);
          initAndTriggerAndRemoveAnimEndFunc(elem, browser_prefix, end_cb)
        if (browser_prefix === 'webkit') {
          browser_prefix = '-' + browser_prefix + '-'
        }
        elem.css('animation-name', anim_name);

      }

      function getAnimEventName(prefix, _type) {
        if (['ms', 'moz', 'webkit', 'o'].indexOf(prefix.toLowerCase()) > -1) {
            return prefix + 'Animation' + _type
        }
        return "animation" + _type.toLowerCase();
      }

      function initAndTriggerAndRemoveAnimStartFunc(elem, browser_prefix, start_cb) {
        var animStartEventName = getAnimEventName(browser_prefix, 'Start');
          var animStartFunc = function(e) {
            start_cb && start_cb();
            elem[0].removeEventListener(animStartEventName, animStartFunc);
          }
          elem[0].addEventListener(animStartEventName, animStartFunc);
      }

      function initAndTriggerAndRemoveAnimEndFunc(elem, browser_prefix, end_cb) {

        var animEndEventName = getAnimEventName(browser_prefix, 'End');
          var animEndFunc = function(e) {

            end_cb && end_cb();
            elem[0].removeEventListener(animEndEventName, animEndFunc);
            elem[0].offsetWidth = elem[0].offsetWidth;
            if (!browser_prefix) {
              elem[0].style.animationName = null;
            } else {
               var animationNameFormatted = UtilitiesService.camelCase(browser_prefix + '-animation-name')
               elem[0].style[animationNameFormatted] = null;
            }
          }
          elem[0].addEventListener(animEndEventName, animEndFunc);
      }

    }



    function evalClassArgs(arg_dict, scope, elem) {
      if (arg_dict.delay) {
        $timeout(function() {
          processClassArr(arg_dict.classes, scope, elem);
        })
      } else {
        processClassArr(arg_dict.classes, scope, elem);
      }
    }

    function processClassArr(class_arr, scope, elem) {
      for (var i = 0; i < class_arr.length; i++) {
        var indexClassObj = class_arr[i];
        var delay = indexClassObj.delay || 0;
        delete indexClassObj['delay']

        var custom = indexClassObj.custom;
        var customDict = {};
        delete indexClassObj['custom'];
        if (custom) {
          processClassCustomArgs(custom, customDict);
        }

        var className = Object.keys(indexClassObj)[0];
        var actionName = indexClassObj[className]
        applyClassActionWithValue(className, actionName, delay, scope, elem, customDict);
        if (delay) {
          indexClassObj['delay'] = delay;
        }
        if (custom) {
          indexClassObj['custom'] = custom;
        }
      }



      function applyClassActionWithValue(className, actionName, delay, scope, elem, customArgs) {
        var defaultClassArgs = getDefaultSecondaryArgs('class');
        if (defaultClassArgs.indexOf(actionName) > -1) {
          if (delay) {
            // console.log(actionName + 'ing class', className, 'after', typeof delay);
            $timeout(function() {
              // console.log(elem[0].classList, className, delay);
              execClassAction(className, actionName, scope, elem, customArgs);
              scope.$apply();
            }, delay)
          } else {
            execClassAction(className, actionName, scope, elem, customArgs);
            $timeout(function() {
              scope.$apply();
            })
          }
        }

        function execClassAction(class_name, action_name, scope, elem, custom_args) {
          if (custom_args && custom_args.set) {
            var propDict = {properties:custom_args.set};
            evalPropertyArgs(propDict, scope, elem);
          }
          if (action_name === 'add') {
            elem[0].classList.add(class_name);
          } else if (action_name === 'remove') {
            elem[0].classList.remove(class_name);
          }
        }

      }

      function processClassCustomArgs(custom_str, custom_dict) {
        //todo refactor
        if (custom_str.indexOf('set:') > -1) {
          var setString = custom_str + "";
          setString = setString.split('set:(')[1];
          var endParenthesis = setString.indexOf('):') || setString.indexOf('),') || setString.indexOf(')');
          setString = setString.substring(0, endParenthesis);
          custom_dict.set = processSetExtraArgs(setString);
        }
      }
    }



    function evalPropertyArgs(arg_dict, scope, elem) {

      if (arg_dict.delay) {
        $timeout(function() {
          processCSSPropArr(arg_dict.properties, scope, elem);
        }, arg_dict.delay)
      } else {
          processCSSPropArr(arg_dict.properties, scope, elem);
      }
    }
    function processCSSPropArr(prop_arr, scope, elem)  {
      for (var i = 0; i < prop_arr.length; i++) {
        var indexPropDict = prop_arr[i];
        if (indexPropDict.animProp && indexPropDict.animProp.player) {
          if (elem[0].getAttribute('inspector-elem') === indexPropDict.animProp.stateName) {
            $timeout(function() {
              if (indexPropDict.animProp.player.prefs && indexPropDict.animProp.player.prefs.autoPlay) {
                indexPropDict.animProp.player.play()
              }
            }, 100)
          }
          else {


            indexPropDict.animProp && indexPropDict.animProp.player && indexPropDict.animProp.player.play &&  indexPropDict.animProp.player.play();
          }
          return;
        }
        if (indexPropDict.custom) {
          processCSSCustomArgs(indexPropDict.custom, indexPropDict);
          delete indexPropDict['custom'];
        }
        var delay = indexPropDict.delay;
        var important = indexPropDict.important || false;
        delete indexPropDict['delay'];
        delete indexPropDict['important'];
        var propName = Object.keys(indexPropDict)[0];
        var propValue = indexPropDict[propName];

        var propValShortcut;
        if (propName in shortcuts.cssPropValues) {

          propValShortcut = shortcuts.cssPropValues[propName];
          if (propValShortcut.split(':').length > 1) {
            propName = propValShortcut.split(':')[0]
            propValue = propValShortcut.split(':')[1]
          }
        }
        if ((propName && propValue) || (propName && propValue === 0)) {

          setCSSProperty(propName, propValue, delay, important, scope, elem)
        } else {
          // console.log('ERROR: css propValue or css propName not defined', propName, propValue, '\nelem:', elem)
          continue;
        }
        if (delay)  {
          indexPropDict['delay'] = delay;
        }
        if (important) {
          indexPropDict['important'] = important;
        }
      }

      function processCSSCustomArgs(custom_str, indexPropDict) {
        if (custom_str.indexOf('impt') > -1) {
          indexPropDict.important = true;
        }
      }

      function setCSSProperty(prop, value, delay, impt, scope, elem) {

        if (prop in shortcuts.cssProps) {
          prop = shortcuts.cssProps[prop];
        }
        if (prop === 'transition') {
          if (prop === 'transition' || prop.indexOf('transition') > -1) {
            scope.root.transitionCounter += 1;
          }
        }

        var priority;
        if (impt) {
          priority = 'important';
        }
        if (delay) {
          $timeout(function() {
            elem.css(prop, value, priority);
            $timeout(function() {
              scope && scope.$apply();
            })
          }, delay)
        } else {
          if (!prop && !value) {
            console.log(prop, value, delay, impt, scope, elem);
          }
          // console.log(prop, value);
          elem.css(prop, value, priority);
          $timeout(function() {
              scope && scope.$apply();
          })
        }
      }
    }


    function getSupportedArg(indexArg) {
      if (indexArg && typeof(indexArg) === 'string') {
        indexArg = indexArg.trim();
        if (indexArg in shortcuts.cmds) {
          indexArg = shortcuts.cmds[indexArg]
        }
      }

      var indexArgSplit = indexArg.split(':');

      if (indexArgSplit.length > 1) {
        var argName = indexArgSplit[0];
        var argValues = indexArgSplit.splice(1);
        if (argName.length) {
          if (argName in shortcuts.args) {
            argName = shortcuts.args[argName];
          }
          var supportedArgIndex = argNames.indexOf(argName);
          var supportedShorthandArgIndex = argShortNames.indexOf(argName);
          if (supportedArgIndex > -1) {
            return {type: argName, value: argValues.join(":")}
          }

        }
      }
    }

}

angular.module('uguru.shared.services')
.factory("SwitchService", [
    '$timeout',
    '$state',
    'UtilitiesService',
    'AnimationService',
    'RootService',
    'DirectiveService',
    SwitchService
        ]);

function SwitchService($timeout, $state, UtilitiesService, AnimationService, RootService, DirectiveService) {
      var parseElemAttrs;
      var isPartOfSwitchSet;
      /*todo
             --> notify siblings + delay
             --> refactor code + apply to on-enter, etc
             --> does delay work?
             --> docs+demo
      */
      return {

        parseElemAttrs: parseElemAttrs,
        isPartOfSwitcheSet: isPartOfSwitchSet,
        parseSwitches: parseSwitches

      };

      function parseSwitches(element, attr) {
        var switchDict = {};
        var switchesMainAttrArray = parseSwitchesMainAttr(attr);
        var allPossibleSwitchAttrArr = [];
        var validClassesToWatch = [];
        switchesMainAttrArray.forEach(function(str, i) {switchesMainAttrArray[i] = {name: str, on:{args: null, }, nameDashed: 'switch-' + str.toLowerCase()}});
        for (var i = 0; i < switchesMainAttrArray.length; i++) {
          var iSwitchObj = switchesMainAttrArray[i];
          iSwitchObj.value = false;
          var iSwitchCamelName = UtilitiesService.camelCase(iSwitchObj.nameDashed);
          var className;

          var attrKeys = Object.keys(attr).slice();
          for (var j = 0; j < attrKeys.length; j++) {
            var indexKey = attrKeys[j].toLowerCase();
            var onArg = (iSwitchCamelName.toLowerCase() + 'on').trim();
            var offArg = (iSwitchCamelName.toLowerCase() + 'off').trim();

            if (indexKey === onArg) {
              className = attrKeys[j].replace('Off', '').replace('On', '').replace('off', '').replace('on', '');
              className = UtilitiesService.camelToDash(className).toLowerCase();
              validClassesToWatch.indexOf(className) === -1 && validClassesToWatch.push(className)
              iSwitchObj.on = {args: DirectiveService.parseArgs(attr[attrKeys[j]]), camel:attrKeys[j], dashed: UtilitiesService.camelToDash(attrKeys[j])}
            }
            if (indexKey === offArg) {
              className = attrKeys[j].replace('Off', '').replace('On', '').replace('off', '').replace('on', '');
              className = UtilitiesService.camelToDash(className).toLowerCase();
              validClassesToWatch.indexOf(className) === -1 && validClassesToWatch.push(className)
              iSwitchObj.off = {args: DirectiveService.parseArgs(attr[attrKeys[j]]), camel:attrKeys[j], dashed: UtilitiesService.camelToDash(attrKeys[j])}
            }

          }


          switchDict[switchesMainAttrArray[i].name] = iSwitchObj;
        }
        switchDict.classes = validClassesToWatch;
        console.log(switchDict);
        return switchDict;

        function getSwitchAttr(name) {

        }

        function parseSwitchesMainAttr(attr) {
          var switchesNameStr = UtilitiesService.removeAllOccurrancesArr(attr.switches, ['[', ']']);
          switchesNameStr = UtilitiesService.replaceAll(switchesNameStr, ', ', ',');
          switchNameArr = switchesNameStr.split(',');
          return switchNameArr
        }

      }


      function parseElemAttrs(scope, elem, attr) {

        if (attr && 'switch' in attr && attr.switch.length) {
          var switch_arr_str = attr.switch.split(',');
          var switchObj = {};
          for (var i = 0; i < switch_arr_str.length; i++) {
            var indexSwitchStr = switch_arr_str[0];
            var indexSwitchSplit = indexSwitchStr.split(':')
            var switchName = indexSwitchSplit[0];
            switchObj.name = switchName;
            if (indexSwitchSplit.length > 1) {
              var switchAttrArgs = indexSwitchSplit.splice(1).join(':');
              var parsedSwitchOptions = parseSwitchAttrOptions(switchAttrArgs);
              switchObj.default = parsedSwitchOptions.default;
              switchObj.active = switchObj.default.indexOf('inactive') === -1
            } else {
              switchObj.active = false;
              switchObj.default = 'inactive';
            }

          }
          return switchObj;
        }
      }

      function parseSwitchAttrOptions(option_str) {
        var resultObj = {};
        if (option_str.indexOf('active') > -1) {
          resultObj.default = 'active';
          resultObj.active = true;
        }
        if (option_str.indexOf('inactive') > -1) {
          resultObj.default = 'inactive';
          resultObj.active = false;
        }
        return resultObj;
      }

      function isPartOfSwitchSet() {};

  }

angular.module('uguru.shared.services')
.factory("DateService", [
    '$timeout',
    '$state',
    DateService
        ]);

function DateService($timeout, $state) {
      return {getShortDayName: getShortDayName}

      function getShortDayName(day){
        return ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][day];
      }
  }

angular
.module('uguru.shared.services')
.factory("SVGService", [
  'AnimationService',
  SVGService
    ]);

function SVGService(AnimationService) {
  var supportedShapes = ['circle', 'rect', 'polygon', 'path', 'line']

  return {
    getTotalPathLength: getTotalPathLength,
    computeDrawDuration:computeDrawDuration,
    supportedShapes: supportedShapes,
    drawOneShape: drawOneShape,
    convertPolyToPath: convertPolyToPath,
    getShapeWidthHeight: getShapeWidthHeight,
    generateCSSObjFromPath: generateCSSObjFromPath,
    svgShapeToPath: svgShapeToPath,
    initSVGElem: initSVGElem
  }

  //step two
  //addEventToCalendar

  function initSVGElem(x, x2, y, y2) {
    var svg = document.createElementNS('http://www.w3.org/2000/svg',"svg");
    svg.setAttributeNS('http://www.w3.org/2000/svg', 'viewBox', [x, y, x2, y2].join(" "));
    return svg
  }

  function generateCSSObjFromPath(anim_name, path, shape_offset, rotate) {
    var numKeyframes = 60;
    var startPoint = path.getPointAtLength(0);
    var totalPathLength = path.getTotalLength();
    var shapeOffset = shape_offset;
    // console.log(startPoint, path, shapeOffset);
    if (!startPoint || !path || (!shapeOffset && shapeOffset !== 0)) return;

    var cssAnimObj = AnimationService.initCSSAnimation(anim_name);
    // cssAnimObj.appendRule('0% {transform: translate(' + (startPoint.x - shapeOffset) + 'px, ' + (startPoint.y-shapeOffset) +'px) rotate(' +180 + 'deg);}', i);
    // console.log('starting animation obj...');
    for (var i = 0; i < numKeyframes; i++) {
       var indexPoint = path.getPointAtLength(i/numKeyframes *totalPathLength);
       var indexPreviousPoint = path.getPointAtLength((i+1)/numKeyframes * totalPathLength);


       var translateX = indexPoint.x - shapeOffset;
       var translateY = indexPoint.y - shapeOffset;
       var translateAng = Math.atan2(indexPoint.y - indexPreviousPoint.y, indexPoint.x - indexPreviousPoint.x) * (180/Math.PI);
       var cssRuleString = (100/60.0 * i) + '% {transform: translate(' + translateX + 'px, ' + translateY +'px)';
       if (rotate) {
        cssRuleString = cssRuleString + ' rotate(' + (translateAng + 180) + 'deg);}';
       } else {
        cssRuleString = cssRuleString + ';}';
       }
        cssAnimObj.appendRule(cssRuleString, i);
    }
    cssAnimObj.appendRule('100% {transform: translate(' + (startPoint.x - shapeOffset) + 'px, ' + (startPoint.y-shapeOffset) +'px);}', i);
    return cssAnimObj;
  }

  function getShapeWidthHeight(shape_elem) {
    if (shape_elem.nodeName === 'circle') {
      return {width: shape_elem.r.animVal.value, height: shape_elem.r.animVal.value};
    } else {
      return {width: shape_elem.getBoundingClientRect().width/2, height: shape_elem.getBoundingClientRect().height/2}
    }
  }

  function getTotalPathLength(elem) {
    var elemType = elem && elem.nodeName && elem.nodeName.toLowerCase();
    switch (elemType) {
      case "circle":
        return getCircleLength(elem);
        break
      case "path":
        return getPathLength(elem);
        break
      case "rect":
        return getRectLength(elem);
        break
      case "polygon":
        return getPolygonLength(elem);
        break
      case "line":
        return getLineLength(elem);
        break
    }
  }

  function drawOneShape(elem, current_frame, total_frames, path_length) {
      drawShape();

      var requestFrameHandle = 0;
      function drawShape() {
        var progress = current_frame/total_frames;
          if (progress > 1) {
             window.cancelAnimationFrame(requestFrameHandle);
          } else {
            current_frame++;
            elem.style.strokeDashoffset = Math.floor(path_length * (1 - progress));
            requestFrameHandle = window.requestAnimationFrame(drawShape);
          }
        }
    }

  function computeDrawDuration(time_str) {

    if (!time_str || !time_str.length) return;

    if (time_str.indexOf('ms') > -1) {
      time_str = time_str.replace('ms', '');
      time_str = parseInt(time_str)
      return (time_str / 1000.0) * 60
    }

    if (time_str.indexOf('s') > -1) {
      time_str = time_str.replace('s', '');
      time_str = parseInt(time_str)
      return (time_str * 60);
    }
  }

  function getCircleLength(elem){
      var r = elem.getAttribute('r');
      var circleLength = 2 * Math.PI * r;
      return circleLength;
  }

  function getLineLength(elem){
      var x1 = elem.getAttribute('x1');
      var x2 = elem.getAttribute('x2');
      var y1 = elem.getAttribute('y1');
      var y2 = elem.getAttribute('y2');
      var lineLength = Math.sqrt(Math.pow((x2-x1), 2)+Math.pow((y2-y1),2));
      return lineLength;
  }

  function convertPolyToPath(poly){
    var svgNS = poly.ownerSVGElement.namespaceURI;
    var path = document.createElementNS(svgNS,'path');
    var points = poly.getAttribute('points').split(/\s+|,/);
    var x0=points.shift(), y0=points.shift();
    var pathdata = 'M'+x0+','+y0+'L'+points.join(' ');
    if (poly.tagName=='polygon') pathdata+='z';
    path.setAttribute('d',pathdata);
    // poly.parentNode.replaceChild(path,poly);
    return path;
  }

  function convertPointStringToPathString(point_str) {
    var path = "";
    var p = point_str;
    for( var i = 0, len = p.length; i < len; i++ ){
        path += (i && "L" || "M") + p[i]
    }
    return path.replace(',', ' ') + 'z';
  }

  function getPolygonLength(elem){
      var points = elem.getAttribute('points');
          points = points.split(" ");
          var x1 = null, x2, y1 = null, y2 , lineLength = 0, x3, y3;
          for(var i = 0; i < points.length; i++){
              var coords = points[i].split(",");
              if(x1 == null && y1 == null){

                  if(/(\r\n|\n|\r)/gm.test(coords[0])){
                      coords[0] = coords[0].replace(/(\r\n|\n|\r)/gm,"");
                      coords[0] = coords[0].replace(/\s+/g,"");
                  }

                  if(/(\r\n|\n|\r)/gm.test(coords[1])){
                      coords[0] = coords[1].replace(/(\r\n|\n|\r)/gm,"");
                      coords[0] = coords[1].replace(/\s+/g,"");
                  }

                  x1 = coords[0];
                  y1 = coords[1];
                  x3 = coords[0];
                  y3 = coords[1];

              }else{

                  if(coords[0] != "" && coords[1] != ""){

                      if(/(\r\n|\n|\r)/gm.test(coords[0])){
                          coords[0] = coords[0].replace(/(\r\n|\n|\r)/gm,"");
                          coords[0] = coords[0].replace(/\s+/g,"");
                      }

                      if(/(\r\n|\n|\r)/gm.test(coords[1])){
                          coords[0] = coords[1].replace(/(\r\n|\n|\r)/gm,"");
                          coords[0] = coords[1].replace(/\s+/g,"");
                      }

                      x2 = coords[0];
                      y2 = coords[1];

                      lineLength += Math.sqrt(Math.pow((x2-x1), 2)+Math.pow((y2-y1),2));

                      x1 = x2;
                      y1 = y2;
                      if(i == points.length-2){
                          lineLength += Math.sqrt(Math.pow((x3-x1), 2)+Math.pow((y3-y1),2));
                      }

                  }
              }

          }
          return lineLength;
  }

  function getRectLength(el){
      var w = el.getAttribute('width');
      var h = el.getAttribute('height');
      return (w*2)+(h*2);
  }

  function getPathLength(elem){
      var pathLength = elem.getTotalLength();
      return pathLength;
  }
}

function findParentSVG(elem) {
    return (elem.nodeName === 'svg' && elem) || findParentSVG(elem.parentNode);
}

function svgShapeToPath(elem, parent) {
  if (!parent) {
    parent = findParentSVG(elem);
    if (!parent) return;
  }
  return pathify(elem, parent);
}

// Takes any arbitrary element sub-tree(s) and converts it/them into an array of
// <path> elements suitable for appending on `root` (the <svg> root, by default)
// Original implementation by Phrogz -- http://phrogz.net/SVG/transformations.js
function pathify(elem, root) {
  var node   = 'nodeType' in elem ? elem : elem[0]
    , doc    = node.ownerDocument
    , svg    = node.ownerSVGElement
    , svg_ns = svg.getAttribute('xmlns')
    , normal = (root||svg).getScreenCTM().inverse() // root scaling compensation
    , matrix = normal.multiply(node.getCTM()) // transform, relative to svg root

    , output = []
    , makers = { path: function() {
                         path.setAttribute('d', elem.getAttribute('d'));
                       }
               , line: line
               , rect: rect
               , circle: circle
               , ellipse: ellipse
               , polygon: polygon
               , polyline: polygon
               }
    , i, len, path, make, transform
    ;

  if (elem.tagName == 'g' || 'function' === typeof elem.push) {
    for (i = 0; node = (elem.childNodes || elem)[i]; i++) {
      if (node.nodeType == 1) {
        output = output.concat(pathify(node, root));
      }
    }
  }
  else {
    path = document.createElementNS(elem.parentNode.namespaceURI || 'http://www.w3.org/2000/svg' ,"path");
    make = makers[elem.tagName];
    if (make) make(); else path = null;
    if (path) {
      // console.log(path)
      // transform = svg.createSVGTransform();
      // transform.setMatrix(matrix);
      // if (path.transform) {
      //   path.transform.baseVal.initialize(transform);
      // }

      // temp: set its reference environment so applyTransforms knows what to do
      // elem.parentNode.appendChild(path);
      // path.setAttribute('d', applyTransforms(path));
      // path.removeAttribute('transform');
      // elem.parentNode.removeChild(path);

      copyPresentation(elem, path);
      output.push(path);
    }
  }
  return output;

  function line() {
    var x1 = +elem.getAttribute('x1')
      , y1 = +elem.getAttribute('y1')
      , x2 = +elem.getAttribute('x2')
      , y2 = +elem.getAttribute('y2')
      ;
    path.setAttribute('d', 'M'+ x1 +','+ y1 +'L'+ x2 +','+ y2);
  }

  function rect() {
    var x  = +elem.getAttribute('x')
      , y  = +elem.getAttribute('y')
      , w  = +elem.getAttribute('width')
      , h  = +elem.getAttribute('height')
      , rx = Math.min(w/2, +elem.getAttribute('rx') || 0)
      , ry = Math.min(h/2, +elem.getAttribute('ry') || 0)
      , r  = rx || ry
      , arc_to;
    if (rx && !elem.hasAttribute('ry')) ry = rx;
    else if (ry && !elem.hasAttribute('rx')) rx = ry;
    arc_to = 'A '+ rx +','+ ry +',0,0,'+ (rx * ry < 0 ? 0 : 1) +',';
    var pathString = 'M '+ (x+rx) +' '+ y + ' '
                     + 'H '+ (x+w-rx) + ' '
                          + (r ? arc_to + (x+w) +','+ (y+ry) + ' ': ' ')
                     + 'V '+ (y+h-ry) + ' '
                          + (r ? arc_to + (x+w-rx) +','+ (y+h) + ' ' : ' ')
                     + 'H '+ (x+rx) + ' '
                          + (r ? arc_to + x +','+ (y+h-ry) + ' ' : ' ')
                     + 'V '+ (y+ry)+ ' '
                          + (r ? arc_to + (x+rx) +','+ y : '') + ' Z';
    pathString = pathString.split(',').join(' ');
    path.setAttribute( 'd'
                     , pathString
                     );
  }

  function circle() {
    var cx = +elem.getAttribute('cx')
      , cy = +elem.getAttribute('cy')
      , r  = +elem.getAttribute('r')
      , y0 = cy - r, y1 = cy + r
      ;
      path.setAttribute( 'd'
                       , 'M' + cx +','+ y0
                       + 'A' + [r,r,0,0,0,cx,y1,r,r,0,0,0,cx,y0].join(',')
                       );
  }

  function ellipse() {
    var cx = +elem.getAttribute('cx')
      , cy = +elem.getAttribute('cy')
      , rx = +elem.getAttribute('rx')
      , ry = +elem.getAttribute('ry')
      , y0 = cy - ry, y1 = cy + ry
      ;
    path.setAttribute( 'd'
                     , 'M' + cx +','+ y0
                     + 'A' + [rx,ry,0,0,0,cx,y1,rx,ry,0,0,0,cx,y0].join(',')
                     );
  }

  function polygon() {
    for (var i = 0, l = [], pts = elem.points, p; i < path.numberOfItems; i++) {
      p = pts.getItem(i);
      l[i] = p.x+','+p.y;
    }
    path.setAttribute( 'd'
                     , 'M' + l.shift()
                     + 'L' + l.join(' ')
                     + (elem.tagName == 'polygon') ? 'Z' : ''
                     );
  }
}

// Copies all presentational-only attributes of element `src` to `dst`.
// NOTE: when using stylesheets with node or id selectors, those styles are lost
function copyPresentation(src, dst) {
  [ 'alignment-baseline'
  , 'baseline-shift'
  , 'clip'
  , 'clip-path'
  , 'clip-rule'
  , 'color'
  , 'color-interpolation'
  , 'color-interpolation-filters'
  , 'color-profile'
  , 'color-rendering'
  , 'cursor'
  , 'direction'
  , 'display'
  , 'dominant-baseline'
  , 'enable-background'
  , 'fill'
  , 'fill-opacity'
  , 'fill-rule'
  , 'filter'
  , 'flood-color'
  , 'flood-opacity'
  , 'font-family'
  , 'font-size'
  , 'font-size-adjust'
  , 'font-stretch'
  , 'font-style'
  , 'font-variant'
  , 'font-weight'
  , 'glyph-orientation-horizontal'
  , 'glyph-orientation-vertical'
  , 'image-rendering'
  , 'kerning'
  , 'letter-spacing'
  , 'lighting-color'
  , 'marker-end'
  , 'marker-mid'
  , 'marker-start'
  , 'mask'
  , 'opacity'
  , 'overflow'
  , 'pointer-events'
  , 'shape-rendering'
  , 'stop-color'
  , 'stop-opacity'
  , 'stroke'
  , 'stroke-dasharray'
  , 'stroke-dashoffset'
  , 'stroke-linecap'
  , 'stroke-linejoin'
  , 'stroke-miterlimit'
  , 'stroke-opacity'
  , 'stroke-width'
  , 'text-anchor'
  , 'text-decoration'
  , 'text-rendering'
  , 'unicode-bidi'
  , 'visibility'
  , 'word-spacing'
  , 'writing-mode'
  , 'class'
  , 'style'
  ].forEach(function(attr) {
    if (src.hasAttribute(attr)) dst.setAttribute(attr, src.getAttribute(attr));
  });
}
angular.module('uguru.shared.services')
.factory("RootService", [
    '$timeout',
    '$state',
    RootService
        ]);

function RootService($timeout, $state) {
    var base_url = '';
    var docItems = [];
    var pauseElement;
    var viewportSize;
    var setInspectableElem;
    var animations = {custom: [], customNameOnly: []};
    var addElemToInspector;
    var _window;
    var elemIdCache = {};
    var customShortcuts = {animProps: {}};
    var getInspectorPreferences = function() {};
    initBaseUrlByEnv();
    return {
        // slide: slide,
        flip: flip,
        animateIn: animateIn,
        animate: animate,
        animateOut: animateOut,
        applyAnimateInDirective: applyAnimateInDirective,
        applyAnimateOutDirective: applyAnimateOutDirective,
        initCSSAnimation: initCSSAnimation,
        getBaseUrl: getBaseUrl,
        getDocItems: getDocItems,
        getCSSAnimationFromClassName: getCSSAnimationFromClassName,
        getBrowserPrefix:getBrowserPrefix,
        appendDocItem: appendDocItem,
        formatBrowserCSSProperty: formatBrowserCSSProperty,
        setPauseElementFunc: setPauseElementFunc,
        pauseElement: pauseElement,
        setInspectableElem: setInspectableElem,
        setInspectableElements: setInspectableElements,
        addElemToInspector: addElemToInspector,
        setGetInspector: setGetInspector,
        getInspectorPreferences: returnInspectorPreferences,
        getCustomEasingAnimations: getCustomEasingAnimations,
        getCustomAnimations: getCustomAnimations,
        getAnimShortcuts: getAnimShortcuts,
        customShortcuts: customShortcuts,
        animations: animations,
        elemIdCache: elemIdCache,
        activeElem: activeElem,
        camelCase: camelCase
    }

    function camelCase(input) {
        return input.toLowerCase().replace(/-(.)/g, function(match, group1) {
            return group1.toUpperCase();
        });
    }

    function getAnimShortcuts(prop) {
      var rootShortcuts = customShortcuts.getAnimProps();
      return rootShortcuts[prop];
    }

    function activeElem() {
      return document.activeElement;
    }

    function setActiveElem(elem) {
      document.activeElement = elem;
    }

    function getCustomAnimations() {
      return animations;
    }

    function getCustomEasingAnimations(scope) {

      scope.animations = animations;
      return function() {
        var ss = document.styleSheets;

        for (var i = 0; i < ss.length; ++i) {
          if (!ss[i].cssRules ) {
            console.log('preventing disaster')
            continue;
          }
          for (var j = 0; j < ss[i].cssRules.length; ++j) {
              if (ss[i].cssRules[j].type == window.CSSRule.WEBKIT_KEYFRAMES_RULE) {

                if (ss[i].cssRules[j].cssRules.length >= 2) {

                  scope.animations.custom.push(ss[i].cssRules[j])
                  scope.animations.customNameOnly.push(ss[i].cssRules[j].name)
                }
              }
            }
        }
      }
    }

    function setInspectableElements(func) {
      setInspectableElem = func;
    }


    function setGetInspector(func) {
      getInspectorPreferences = func;
    }

    function appendDocItem(item) {
      docItems.push(item);
    }

    function setPauseElementFunc(func) {
      pauseElement = func;
    }

    function returnInspectorPreferences() {
      return getInspectorPreferences();
    }

    function addElemToInspector(elem) {

      setInspectableElem(elem);
      // inspectableElements.push(elem);
    }


    function formatBrowserCSSProperty(property) {
      var dashedPrefixedProps = ['transition', 'transform', 'backface-visibility', 'perspective', 'perspective-origin', 'animation-start', 'transform-style', 'transform-origin', 'animation-timing-function', 'animation-duration', 'animation-name', 'animation-play-state', 'animation-fill-mode', 'animation-iteration-count', 'animation-direction', 'animation-delay', 'transition-delay', 'transition-timing-function']
      var browserPrefix = getBrowserPrefix();
      if (browserPrefix && browserPrefix.length && dashedPrefixedProps.indexOf(property.toLowerCase()) > -1) {
        property = '-' + browserPrefix + '-' + property
      }
      return property
    }

    function getDocItems() {
      return docItems;
    }


    function getBrowserPrefix() {
        var browserPrefix;
        navigator.sayswho= (function(){
          var N = navigator.appName, ua = navigator.userAgent, tem;
          var M = ua.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);
          if(M && (tem = ua.match(/version\/([\.\d]+)/i))!= null) M[2] = tem[1];
          M = M? [M[1], M[2]]: [N, navigator.appVersion,'-?'];
          M = M[0];
          if(M == "Chrome") { browserPrefix = "webkit"; }
          if(M == "Firefox") { browserPrefix = "moz"; }
          if(M == "Safari") { browserPrefix = "webkit"; }
          if(M == "MSIE") { browserPrefix = "ms"; }
        })();
        return browserPrefix;
    }

    function initBaseUrlByEnv() {
      if (window.location.href.split(':5000').length > 1 || window.location.href.split('uguru').length > 1) {
        base_url = '/static/remote/min/'
      }
      else  {
        base_url = '';
      }
    }

    function getBaseUrl() {
      return base_url
    }

    function getCSSAnimationFromClassName(anim_class) {
      var ss = document.styleSheets;
      for (var i = 0; i < ss.length; ++i) {
          if (ss[i].cssRules && ss[i].cssRules.length) {

              var animationName;
              for (var j = 0; j < ss[i].cssRules.length; ++j) {
                if (ss[i].cssRules[j].type == window.CSSRule.STYLE_RULE) {
                  if (ss[i].cssRules[j].selectorText === '.' + anim_class) {
                    if (ss[i].cssRules[j].style && (ss[i].cssRules[j].style.animation || ss[i].cssRules[j].style.webkitAnimation)) {
                      console.log(ss[i].cssRules[j].style.animation);
                      var animationString = ss[i].cssRules[j].style.animation || ss[i].cssRules[j].style.webkitAnimation

                      if (animationString.split(' ').length >= 2) {
                        animationName = animationString.split(' ')[0];
                        animationObj = getAnimationObjFromAnimationName(animationName)
                        if (animationObj) {
                          return animationObj;
                        }
                      }
                    }
                  }
                }
              }
              // if (!animationName) return;
              // console.log('found', animationName);
          }
      }
    }

    function getAnimationObjFromAnimationName(anim_name) {

      var ss = document.styleSheets;
      for (var i = 0; i < ss.length; ++i) {
        for (var j = 0; j < ss[i].cssRules.length; ++j) {
            if (ss[i].cssRules[j].type == window.CSSRule.WEBKIT_KEYFRAMES_RULE) {
              if (ss[i].cssRules[j].name === anim_name) {
                return ss[i].cssRules[j];
              }
            }
          }
      }
    }

    function initCSSAnimation(anim_name, options) {
        var browserPrefix = getBrowserPrefix();
        var lastSheet = document.styleSheets[document.styleSheets.length - 1];
        var indexOfRuleInSheet = lastSheet.insertRule("@-" + browserPrefix + "-keyframes " + anim_name + " { } ");
        return lastSheet.cssRules[indexOfRuleInSheet];
    }

    function prefixedEventListener(element, type, callback) {
      var pfx = ["webkit", "moz", "MS", "o", ""];
      for (var p = 0; p < pfx.length; p++) {
          if (!pfx[p]) type = type.toLowerCase();
          element.addEventListener(pfx[p]+type, callback, false);
      }
    }

    // function initSlide() {
    //  if(DeviceService.isMobile() && window.plugins.nativepagetransitions) {
    //      window.plugins.nativepagetransitions.slide({
    //          "direction": "right",
    //          "duration" : 10,
    //          "slowdownfactor": 1,
    //          "iosdelay": 10,
    //          "androiddelay": 10
    //      }, successMsg, errorMsg);
    //  }

    // }

     function activateSectionAnimations(elements, css_arr, delay_arr) {
        if (!elements || !elements.length) {
            return;
        }
        for (var i = 0; i < elements.length; i ++) {
          animateIn(elements[i], css_arr[i], delay_arr[i]);
        }
      }

    function initializeSectionComponents(section_var, selector_arr, css_arr, delay_arr) {
        for (var i = 0; i < selector_arr.length; i++) {
          var indexSelector = selector_arr[i];
          var elem = document.querySelector(indexSelector);
          if (!elem) {
            continue
          }
          if (!section_var.elements) {
            section_var.elements = [elem];
          } else {
            section_var.elements.push(elem);
          }
        }
     }

    function applyAnimateOutDirective(element, type) {
        var children = element.querySelectorAll("[anim-" + type + "-child]");
        if (children.length) {
            for (var i = 0; i < children.length; i++) {
                var indexChild = children[i];
                var animationClassesToInject = indexChild.getAttribute('anim-' + type +'-class') && indexChild.getAttribute('anim-' + type +'-class').split(', ');
                var animationDelaysToInject = indexChild.getAttribute('anim-' + type +'-delay') && indexChild.getAttribute('anim-' + type +'-delay').split(', ');
                if (!animationClassesToInject) {
                    continue;
                }
                if (!animationDelaysToInject) {
                    animationDelaysToInject = [0,0,0,0,0];
                }
                for (var j = 0; j < animationClassesToInject.length; j++) {
                    var indexClassOfChild = animationClassesToInject[j] || '';
                    var indexOffsetOfChild = animationDelaysToInject[j] || 0;
                    if (indexClassOfChild && indexClassOfChild.length) {
                        animateOut(indexChild, indexClassOfChild, indexOffsetOfChild || 0 );
                    }
                }
                // var animationOnCompleteExpr = indexChild.getAttribute('anim-exit-up-complete');
            }
        } else {
              var animationClassToInject = element.attributes['anim-' + type +'-class'] && element.getAttribute('anim-' + type + '-class').split(', ');
              var animationDelaysToInject = element.attributes['anim-' + type + '-delay'] && element.getAttribute('anim-' + type + '-delay').split(', ');
              if (!animationClassToInject || !animationClassToInject.length) {
                return;
              }
              if (!animationDelaysToInject) {
                    animationDelaysToInject = [0,0,0,0,0];
                }
              for (var i = 0; i < animationClassToInject.length; i++) {
                var indexClassOfParent= animationClassToInject[i] || '';
                var indexOffsetOfParent = animationDelaysToInject[i] || 0;
                if (indexClassOfParent && indexClassOfParent.length) {
                    animateOut(element, indexClassOfParent, indexOffsetOfParent || 0 );
                }
              }
        }
    }

    function applyAnimateInDirective(element, type) {
        var children = element.querySelectorAll("[anim-" + type + "-child]");
        if (children.length) {
            for (var i = 0; i < children.length; i++) {
                var indexChild = children[i];
                var animationClassesToInject = indexChild.getAttribute('anim-' + type +'-class') && indexChild.getAttribute('anim-' + type +'-class').split(', ');
                var animationDelaysToInject = indexChild.getAttribute('anim-' + type +'-delay') && indexChild.getAttribute('anim-' + type +'-delay').split(', ');
                if (!animationClassesToInject) {
                    continue;
                }
                if (!animationDelaysToInject) {
                    animationDelaysToInject = [0,0,0,0,0];
                }
                for (var j = 0; j < animationClassesToInject.length; j++) {
                    var indexClassOfChild = animationClassesToInject[j] || '';
                    var indexOffsetOfChild = animationDelaysToInject[j] || 0;
                    if (indexClassOfChild && indexClassOfChild.length) {
                        animateIn(indexChild, indexClassOfChild, indexOffsetOfChild || 0 );
                    }
                }
                // var animationOnCompleteExpr = indexChild.getAttribute('anim-exit-up-complete');
            }
        } else {
              var animationClassToInject = element.attributes['anim-' + type +'-class'] && element.getAttribute('anim-' + type + '-class').split(', ')
              var animationDelaysToInject = element.attributes['anim-' + type + '-delay'] && element.getAttribute('anim-' + type + '-delay').split(', ')

              if (!animationClassToInject || !animationClassToInject.length) {
                return;
              }
              if (!animationDelaysToInject) {
                    animationDelaysToInject = [0,0,0,0,0];
                }
              for (var i = 0; i < animationClassToInject.length; i++) {
                var indexClassOfParent= animationClassToInject[i] || '';
                var indexOffsetOfParent = animationDelaysToInject[i] || 0;
                if (indexClassOfParent && indexClassOfParent.length) {
                    animateIn(element, indexClassOfParent, indexOffsetOfParent || 0 );
                }
              }
        }
    }

    function animate(elem, css_class, anim_obj, delay) {
      if (delay) {
        $timeout(function() {
          elem.classList.add('animated', css_class);
        }, delay)
      } else {
        elem.classList.add('animated', css_class);
      }
      prefixedEventListener(elem,"AnimationStart", animationStartListener);
      prefixedEventListener(elem,"AnimationEnd", animationEndListener);
      function animationStartListener(e)
      {
        console.log('animation has began');
        var lastKFSorted = getLastKFsorted(anim_obj.cssRules)
        var formattedKFCssText = lastKFSorted.cssText.split('{')[1].replace('}', '').trim();
        elem.style.cssText +=formattedKFCssText;
        elem.removeEventListener( e.type, animationStartListener);
      }
      function animationEndListener(e)
      {

        elem.classList.remove(css_class, "animated");
        elem.removeEventListener( e.type, animationEndListener);
      }
    }

    function getLastKFsorted(css_rules) {
      var keyFrames = [];

      for (property in css_rules) {
        if ((property || property === 0) && css_rules[property].type === window.CSSRule.WEBKIT_KEYFRAME_RULE) {
          keyFrames.push(css_rules[property]);
        }
      }
      keyFrames.sort(function(kf_a, kf_b) {
        return parseFloat(kf_b.keyText.replace("%")) - parseFloat(kf_b.keyText.replace("%"))
      }).reverse()
      if (keyFrames.length) {
        console.log('last keyframe', keyFrames[0]);
        return keyFrames[0]
      }
    }

    function animateIn(elem, css_class, delay) {
        if (!elem || !css_class) {
            return;
        }
        var cssClassArgs = getCSSArgs(css_class)
        elem.classList.remove('animated');
        if (delay) {
          $timeout(function() {
              elem.classList.add('animated', cssClassArgs.class);
              prefixedEventListener(elem,"AnimationStart",function(e){
                elem.style.opacity = 1;
                e.target.removeEventListener(e.type, false);
              });
              prefixedEventListener(elem,"AnimationEnd",function(e){
                  if (cssClassArgs.keep) {
                      elem.classList.remove("animated");
                  } else {
                      elem.classList.remove(cssClassArgs.class, "animated");
                  }
                  e.target.removeEventListener(e.type, false);
              });
          }, delay || 0);
        }
      }

    function animateIn(elem, css_class, delay) {
        if (!elem || !css_class) {
            return;
        }
        var cssClassArgs = getCSSArgs(css_class)
        elem.classList.remove('animated');
        if (delay) {
          $timeout(function() {
              elem.classList.add('animated', cssClassArgs.class);
              prefixedEventListener(elem,"AnimationStart",function(e){
                elem.style.opacity = 1;
                e.target.removeEventListener(e.type, false);
              });
              prefixedEventListener(elem,"AnimationEnd",function(e){
                  if (cssClassArgs.keep) {
                      elem.classList.remove("animated");
                  } else {
                      elem.classList.remove(cssClassArgs.class, "animated");
                  }
                  e.target.removeEventListener(e.type, false);
              });
          }, delay || 0);
        } else {
            elem.classList.add('animated', cssClassArgs.class);
            prefixedEventListener(elem,"AnimationStart",function(e){
              elem.style.opacity = 1;
              e.target.removeEventListener(e.type, false);
            });
            prefixedEventListener(elem,"AnimationEnd",function(e){
                if (cssClassArgs.keep) {
                    elem.classList.remove("animated");
                } else {
                    elem.classList.remove(cssClassArgs.class, "animated");
                }
                e.target.removeEventListener(e.type, false);
            });
        }
    }

    function animateOut(elem, css_class, delay) {

        if (!elem || !css_class) {
            return;
        }
        var cssClassArgs = getCSSArgs(css_class)

        if (delay) {
          $timeout(function() {
              elem.classList.add('animated', cssClassArgs.class);
              prefixedEventListener(elem,"AnimationStart",function(e){
                  elem.style.opacity = 0;
                  e.target.removeEventListener(e.type, false);
              });

              prefixedEventListener(elem,"AnimationEnd",function(e){
                  if (cssClassArgs.keep) {
                          elem.classList.remove("animated");
                  } else {
                      elem.classList.remove(cssClassArgs.class, "animated");
                  }
                  e.target.removeEventListener(e.type, false);
              })

          }, delay || 0);
        } else {
            elem.classList.add('animated', cssClassArgs.class);
            prefixedEventListener(elem,"AnimationStart",function(e){
                elem.style.opacity = 0;
                e.target.removeEventListener(e.type, false);
            });

            prefixedEventListener(elem,"AnimationEnd",function(e){
                if (cssClassArgs.keep) {
                        elem.classList.remove("animated");
                } else {
                    elem.classList.remove(cssClassArgs.class, "animated");
                }
                e.target.removeEventListener(e.type, false);
            })
        }
    }

    function getCSSArgs(class_name) {
        var class_split = class_name.split(':');
        class_name = class_split[0];
        var css_args_dict = {}
        if (class_split.length > 1) {
            css_args_dict.class = class_name;
            class_args = class_split.splice(1);
            for (var i = 0; i < class_args.length; i++) {
                var indexArg  = class_args[i];
                css_args_dict[indexArg] = true;
            }
            return css_args_dict;
        } else {
            return {class: class_name};
        }
    }




    function shakeElem(elem, duration, callback) {

        Velocity(elem, "transition.expandIn", {duration:duration});
        callback && callback();
    }

    function fadeOutElem(elem, duration) {
        Velocity(elem, "fadeOut", {duration:duration});
    }



    //customOptions is optional, if none are set then default options will be used
    function flip(target, customOptions, params, cb) {

        var pane = document.querySelectorAll('body')[0];

        pane.style.transition = '.400s';
        pane.style.transform = 'rotateY(90deg)';
        pane.style.webkitkitTransition = '.400s';
        pane.style.webkitTransform = 'rotateY(90deg)';

        $timeout(function() {
            pane.style.transition = '0.00s';
            pane.style.transform = 'rotateY(-90deg)';
            pane.style.webkitTtransition = '0.00s';
            pane.style.webkitTransform = 'rotateY(-90deg)';
            $ionicViewSwitcher.nextDirection('none');
            if (!params) {
                $state.go(target);
            } else {
                $state.go(target, params);
            }
            $timeout(function() {

                pane.style.transition = '.400s';
                pane.style.transform = 'rotateY(0deg)';
                pane.style.webkitTransition = '.400s';
                pane.style.webkitTransform = 'rotateY(0deg)';
            }, 40);
        }, 440);
        $timeout(function() {
            cb && cb();
        }, 500)

    }

    function successMsg() {
    }

    function errorMsg(error) {
        console.error("Error with RootService: " + error);
    }

}


// Generated by CoffeeScript 1.7.1
(function() {
  var Color, DecomposedMatrix, DecomposedMatrix2D, InterpolableArray, InterpolableColor, InterpolableNumber, InterpolableObject, InterpolableString, Matrix, Matrix2D, Set, Vector, addTimeout, animationTick, animations, animationsTimeouts, applyDefaults, applyFrame, applyProperties, baseSVG, cacheFn, cancelTimeout, clone, createInterpolable, defaultValueForKey, degProperties, dynamics, getCurrentProperties, interpolate, isDocumentVisible, isSVGElement, lastTime, leftDelayForTimeout, makeArrayFn, observeVisibilityChange, parseProperties, prefixFor, propertyWithPrefix, pxProperties, rAF, roundf, runLoopPaused, runLoopRunning, runLoopTick, setRealTimeout, slow, slowRatio, startAnimation, startRunLoop, svgProperties, timeBeforeVisibilityChange, timeoutLastId, timeouts, toDashed, transformProperties, transformValueForProperty, unitForProperty,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  isDocumentVisible = function() {
    return document.visibilityState === "visible" || (dynamics.tests != null);
  };

  observeVisibilityChange = (function() {
    var fns;
    fns = [];
    if (typeof document !== "undefined" && document !== null) {
      document.addEventListener("visibilitychange", function() {
        var fn, _i, _len, _results;
        _results = [];
        for (_i = 0, _len = fns.length; _i < _len; _i++) {
          fn = fns[_i];
          _results.push(fn(isDocumentVisible()));
        }
        return _results;
      });
    }
    return function(fn) {
      return fns.push(fn);
    };
  })();

  clone = function(o) {
    var k, newO, v;
    newO = {};
    for (k in o) {
      v = o[k];
      newO[k] = v;
    }
    return newO;
  };

  cacheFn = function(func) {
    var data;
    data = {};
    return function() {
      var k, key, result, _i, _len;
      key = "";
      for (_i = 0, _len = arguments.length; _i < _len; _i++) {
        k = arguments[_i];
        key += k.toString() + ",";
      }
      result = data[key];
      if (!result) {
        data[key] = result = func.apply(this, arguments);
      }
      return result;
    };
  };

  makeArrayFn = function(fn) {
    return function(el) {
      var args, i, res;
      if (el instanceof Array || el instanceof NodeList || el instanceof HTMLCollection) {
        res = (function() {
          var _i, _ref, _results;
          _results = [];
          for (i = _i = 0, _ref = el.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
            args = Array.prototype.slice.call(arguments, 1);
            args.splice(0, 0, el[i]);
            _results.push(fn.apply(this, args));
          }
          return _results;
        }).apply(this, arguments);
        return res;
      }
      return fn.apply(this, arguments);
    };
  };

  applyDefaults = function(options, defaults) {
    var k, v, _results;
    _results = [];
    for (k in defaults) {
      v = defaults[k];
      _results.push(options[k] != null ? options[k] : options[k] = v);
    }
    return _results;
  };

  applyFrame = function(el, properties) {
    var k, v, _results;
    if ((el.style != null)) {
      return applyProperties(el, properties);
    } else {
      _results = [];
      for (k in properties) {
        v = properties[k];
        _results.push(el[k] = v.format());
      }
      return _results;
    }
  };

  applyProperties = function(el, properties) {
    var isSVG, k, matrix, transforms, v;
    properties = parseProperties(properties);
    transforms = [];
    isSVG = isSVGElement(el);
    for (k in properties) {
      v = properties[k];
      if (transformProperties.contains(k)) {
        transforms.push([k, v]);
      } else {
        if (v.format != null) {
          v = v.format();
        }
        if (typeof v === 'number') {
          v = "" + v + (unitForProperty(k, v));
        }
        if (isSVG && svgProperties.contains(k)) {
          el.setAttribute(k, v);
        } else {
          el.style[propertyWithPrefix(k)] = v;
        }
      }
    }
    if (transforms.length > 0) {
      if (isSVG) {
        matrix = new Matrix2D();
        matrix.applyProperties(transforms);
        return el.setAttribute("transform", matrix.decompose().format());
      } else {
        v = (transforms.map(function(transform) {
          return transformValueForProperty(transform[0], transform[1]);
        })).join(" ");
        return el.style[propertyWithPrefix("transform")] = v;
      }
    }
  };

  isSVGElement = function(el) {
    var _ref, _ref1;
    if ((typeof SVGElement !== "undefined" && SVGElement !== null) && (typeof SVGSVGElement !== "undefined" && SVGSVGElement !== null)) {
      return el instanceof SVGElement && !(el instanceof SVGSVGElement);
    } else {
      return (_ref = (_ref1 = dynamics.tests) != null ? typeof _ref1.isSVG === "function" ? _ref1.isSVG(el) : void 0 : void 0) != null ? _ref : false;
    }
  };

  roundf = function(v, decimal) {
    var d;
    d = Math.pow(10, decimal);
    return Math.round(v * d) / d;
  };

  Set = (function() {
    function Set(array) {
      var v, _i, _len;
      this.obj = {};
      for (_i = 0, _len = array.length; _i < _len; _i++) {
        v = array[_i];
        this.obj[v] = 1;
      }
    }

    Set.prototype.contains = function(v) {
      return this.obj[v] === 1;
    };

    return Set;

  })();

  toDashed = function(str) {
    return str.replace(/([A-Z])/g, function($1) {
      return "-" + $1.toLowerCase();
    });
  };

  pxProperties = new Set('marginTop,marginLeft,marginBottom,marginRight,paddingTop,paddingLeft,paddingBottom,paddingRight,top,left,bottom,right,translateX,translateY,translateZ,perspectiveX,perspectiveY,perspectiveZ,width,height,maxWidth,maxHeight,minWidth,minHeight,borderRadius'.split(','));

  degProperties = new Set('rotate,rotateX,rotateY,rotateZ,skew,skewX,skewY,skewZ'.split(','));

  transformProperties = new Set('translate,translateX,translateY,translateZ,scale,scaleX,scaleY,scaleZ,rotate,rotateX,rotateY,rotateZ,rotateC,rotateCX,rotateCY,skew,skewX,skewY,skewZ,perspective'.split(','));

  svgProperties = new Set('accent-height,ascent,azimuth,baseFrequency,baseline-shift,bias,cx,cy,d,diffuseConstant,divisor,dx,dy,elevation,filterRes,fx,fy,gradientTransform,height,k1,k2,k3,k4,kernelMatrix,kernelUnitLength,letter-spacing,limitingConeAngle,markerHeight,markerWidth,numOctaves,order,overline-position,overline-thickness,pathLength,points,pointsAtX,pointsAtY,pointsAtZ,r,radius,rx,ry,seed,specularConstant,specularExponent,stdDeviation,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,surfaceScale,target,targetX,targetY,transform,underline-position,underline-thickness,viewBox,width,x,x1,x2,y,y1,y2,z'.split(','));

  unitForProperty = function(k, v) {
    if (typeof v !== 'number') {
      return '';
    }
    if (pxProperties.contains(k)) {
      return 'px';
    } else if (degProperties.contains(k)) {
      return 'deg';
    }
    return '';
  };

  transformValueForProperty = function(k, v) {
    var match, unit;
    match = ("" + v).match(/^([0-9.-]*)([^0-9]*)$/);
    if (match != null) {
      v = match[1];
      unit = match[2];
    } else {
      v = parseFloat(v);
    }
    v = roundf(parseFloat(v), 10);
    if ((unit == null) || unit === "") {
      unit = unitForProperty(k, v);
    }
    return "" + k + "(" + v + unit + ")";
  };

  parseProperties = function(properties) {
    var axis, match, parsed, property, value, _i, _len, _ref;
    parsed = {};
    for (property in properties) {
      value = properties[property];
      if (transformProperties.contains(property)) {
        match = property.match(/(translate|rotateC|rotate|skew|scale|perspective)(X|Y|Z|)/);
        if (match && match[2].length > 0) {
          parsed[property] = value;
        } else {
          _ref = ['X', 'Y', 'Z'];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            axis = _ref[_i];
            parsed[match[1] + axis] = value;
          }
        }
      } else {
        parsed[property] = value;
      }
    }
    return parsed;
  };

  defaultValueForKey = function(key) {
    var v;
    v = key === 'opacity' ? 1 : 0;
    return "" + v + (unitForProperty(key, v));
  };

  getCurrentProperties = function(el, keys) {
    var isSVG, key, matrix, properties, style, v, _i, _j, _len, _len1, _ref;
    properties = {};
    isSVG = isSVGElement(el);
    if (el.style != null) {
      style = window.getComputedStyle(el, null);
      for (_i = 0, _len = keys.length; _i < _len; _i++) {
        key = keys[_i];
        if (transformProperties.contains(key)) {
          if (properties['transform'] == null) {
            if (isSVG) {
              matrix = new Matrix2D((_ref = el.transform.baseVal.consolidate()) != null ? _ref.matrix : void 0);
            } else {
              matrix = Matrix.fromTransform(style[propertyWithPrefix('transform')]);
            }
            properties['transform'] = matrix.decompose();
          }
        } else {
          v = style[key];
          if ((v == null) && svgProperties.contains(key)) {
            v = el.getAttribute(key);
          }
          if (v === "" || (v == null)) {
            v = defaultValueForKey(key);
          }
          properties[key] = createInterpolable(v);
        }
      }
    } else {
      for (_j = 0, _len1 = keys.length; _j < _len1; _j++) {
        key = keys[_j];
        properties[key] = createInterpolable(el[key]);
      }
    }
    return pxProperties;
  };

  createInterpolable = function(value) {
    var interpolable, klass, klasses, _i, _len;
    klasses = [InterpolableArray, InterpolableObject, InterpolableNumber, InterpolableString];
    for (_i = 0, _len = klasses.length; _i < _len; _i++) {
      klass = klasses[_i];
      interpolable = klass.create(value);
      if (interpolable != null) {
        return interpolable;
      }
    }
    return null;
  };

  InterpolableString = (function() {
    function InterpolableString(parts) {
      this.parts = parts;
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
    }

    InterpolableString.prototype.interpolate = function(endInterpolable, t) {
      var end, i, newParts, start, _i, _ref;
      start = this.parts;
      end = endInterpolable.parts;
      newParts = [];
      for (i = _i = 0, _ref = Math.min(start.length, end.length); 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        if (start[i].interpolate != null) {
          newParts.push(start[i].interpolate(end[i], t));
        } else {
          newParts.push(start[i]);
        }
      }
      return new InterpolableString(newParts);
    };

    InterpolableString.prototype.format = function() {
      var parts;
      parts = this.parts.map(function(val) {
        if (val.format != null) {
          return val.format();
        } else {
          return val;
        }
      });
      return parts.join('');
    };

    InterpolableString.create = function(value) {
      var index, match, matches, parts, re, type, types, _i, _j, _len, _len1;
      value = "" + value;
      matches = [];
      types = [
        {
          re: /(#[a-f\d]{3,6})/ig,
          klass: InterpolableColor,
          parse: function(v) {
            return v;
          }
        }, {
          re: /(rgba?\([0-9.]*, ?[0-9.]*, ?[0-9.]*(?:, ?[0-9.]*)?\))/ig,
          klass: InterpolableColor,
          parse: function(v) {
            return v;
          }
        }, {
          re: /([-+]?[\d.]+)/ig,
          klass: InterpolableNumber,
          parse: parseFloat
        }
      ];
      for (_i = 0, _len = types.length; _i < _len; _i++) {
        type = types[_i];
        re = type.re;
        while (match = re.exec(value)) {
          matches.push({
            index: match.index,
            length: match[1].length,
            interpolable: type.klass.create(type.parse(match[1]))
          });
        }
      }
      matches = matches.sort(function(a, b) {
        return a.index > b.index;
      });
      parts = [];
      index = 0;
      for (_j = 0, _len1 = matches.length; _j < _len1; _j++) {
        match = matches[_j];
        if (match.index < index) {
          continue;
        }
        if (match.index > index) {
          parts.push(value.substring(index, match.index));
        }
        parts.push(match.interpolable);
        index = match.index + match.length;
      }
      if (index < value.length) {
        parts.push(value.substring(index));
      }
      return new InterpolableString(parts);
    };

    return InterpolableString;

  })();

  InterpolableObject = (function() {
    function InterpolableObject(obj) {
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
      this.obj = obj;
    }

    InterpolableObject.prototype.interpolate = function(endInterpolable, t) {
      var end, k, newObj, start, v;
      start = this.obj;
      end = endInterpolable.obj;
      newObj = {};
      for (k in start) {
        v = start[k];
        if (v.interpolate != null) {
          newObj[k] = v.interpolate(end[k], t);
        } else {
          newObj[k] = v;
        }
      }
      return new InterpolableObject(newObj);
    };

    InterpolableObject.prototype.format = function() {
      return this.obj;
    };

    InterpolableObject.create = function(value) {
      var k, obj, v;
      if (value instanceof Object) {
        obj = {};
        for (k in value) {
          v = value[k];
          obj[k] = createInterpolable(v);
        }
        return new InterpolableObject(obj);
      }
      return null;
    };

    return InterpolableObject;

  })();

  InterpolableNumber = (function() {
    function InterpolableNumber(value) {
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
      this.value = parseFloat(value);
    }

    InterpolableNumber.prototype.interpolate = function(endInterpolable, t) {
      var end, start;
      start = this.value;
      end = endInterpolable.value;
      return new InterpolableNumber((end - start) * t + start);
    };

    InterpolableNumber.prototype.format = function() {
      return roundf(this.value, 5);
    };

    InterpolableNumber.create = function(value) {
      if (typeof value === 'number') {
        return new InterpolableNumber(value);
      }
      return null;
    };

    return InterpolableNumber;

  })();

  InterpolableArray = (function() {
    function InterpolableArray(values) {
      this.values = values;
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
    }

    InterpolableArray.prototype.interpolate = function(endInterpolable, t) {
      var end, i, newValues, start, _i, _ref;
      start = this.values;
      end = endInterpolable.values;
      newValues = [];
      for (i = _i = 0, _ref = Math.min(start.length, end.length); 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        if (start[i].interpolate != null) {
          newValues.push(start[i].interpolate(end[i], t));
        } else {
          newValues.push(start[i]);
        }
      }
      return new InterpolableArray(newValues);
    };

    InterpolableArray.prototype.format = function() {
      return this.values.map(function(val) {
        if (val.format != null) {
          return val.format();
        } else {
          return val;
        }
      });
    };

    InterpolableArray.createFromArray = function(arr) {
      var values;
      values = arr.map(function(val) {
        return createInterpolable(val) || val;
      });
      values = values.filter(function(val) {
        return val != null;
      });
      return new InterpolableArray(values);
    };

    InterpolableArray.create = function(value) {
      if (value instanceof Array) {
        return InterpolableArray.createFromArray(value);
      }
      return null;
    };

    return InterpolableArray;

  })();

  Color = (function() {
    function Color(rgb, format) {
      this.rgb = rgb != null ? rgb : {};
      this.format = format;
      this.toRgba = __bind(this.toRgba, this);
      this.toRgb = __bind(this.toRgb, this);
      this.toHex = __bind(this.toHex, this);
    }

    Color.fromHex = function(hex) {
      var hex3, result;
      hex3 = hex.match(/^#([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i);
      if (hex3 != null) {
        hex = "#" + hex3[1] + hex3[1] + hex3[2] + hex3[2] + hex3[3] + hex3[3];
      }
      result = hex.match(/^#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);
      if (result != null) {
        return new Color({
          r: parseInt(result[1], 16),
          g: parseInt(result[2], 16),
          b: parseInt(result[3], 16),
          a: 1
        }, "hex");
      }
      return null;
    };

    Color.fromRgb = function(rgb) {
      var match, _ref;
      match = rgb.match(/^rgba?\(([0-9.]*), ?([0-9.]*), ?([0-9.]*)(?:, ?([0-9.]*))?\)$/);
      if (match != null) {
        return new Color({
          r: parseFloat(match[1]),
          g: parseFloat(match[2]),
          b: parseFloat(match[3]),
          a: parseFloat((_ref = match[4]) != null ? _ref : 1)
        }, match[4] != null ? "rgba" : "rgb");
      }
      return null;
    };

    Color.componentToHex = function(c) {
      var hex;
      hex = c.toString(16);
      if (hex.length === 1) {
        return "0" + hex;
      } else {
        return hex;
      }
    };

    Color.prototype.toHex = function() {
      return "#" + Color.componentToHex(this.rgb.r) + Color.componentToHex(this.rgb.g) + Color.componentToHex(this.rgb.b);
    };

    Color.prototype.toRgb = function() {
      return "rgb(" + this.rgb.r + ", " + this.rgb.g + ", " + this.rgb.b + ")";
    };

    Color.prototype.toRgba = function() {
      return "rgba(" + this.rgb.r + ", " + this.rgb.g + ", " + this.rgb.b + ", " + this.rgb.a + ")";
    };

    return Color;

  })();

  InterpolableColor = (function() {
    function InterpolableColor(color) {
      this.color = color;
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
    }

    InterpolableColor.prototype.interpolate = function(endInterpolable, t) {
      var end, k, rgb, start, v, _i, _len, _ref;
      start = this.color;
      end = endInterpolable.color;
      rgb = {};
      _ref = ['r', 'g', 'b'];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        k = _ref[_i];
        v = Math.round((end.rgb[k] - start.rgb[k]) * t + start.rgb[k]);
        rgb[k] = Math.min(255, Math.max(0, v));
      }
      k = "a";
      v = roundf((end.rgb[k] - start.rgb[k]) * t + start.rgb[k], 5);
      rgb[k] = Math.min(1, Math.max(0, v));
      return new InterpolableColor(new Color(rgb, end.format));
    };

    InterpolableColor.prototype.format = function() {
      if (this.color.format === "hex") {
        return this.color.toHex();
      } else if (this.color.format === "rgb") {
        return this.color.toRgb();
      } else if (this.color.format === "rgba") {
        return this.color.toRgba();
      }
    };

    InterpolableColor.create = function(value) {
      var color;
      if (typeof value !== "string") {
        return;
      }
      color = Color.fromHex(value) || Color.fromRgb(value);
      if (color != null) {
        return new InterpolableColor(color);
      }
      return null;
    };

    return InterpolableColor;

  })();

  DecomposedMatrix2D = (function() {
    function DecomposedMatrix2D(props) {
      this.props = props;
      this.applyRotateCenter = __bind(this.applyRotateCenter, this);
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
    }

    DecomposedMatrix2D.prototype.interpolate = function(endMatrix, t) {
      var i, k, newProps, _i, _j, _k, _l, _len, _len1, _ref, _ref1, _ref2;
      newProps = {};
      _ref = ['translate', 'scale', 'rotate'];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        k = _ref[_i];
        newProps[k] = [];
        for (i = _j = 0, _ref1 = this.props[k].length; 0 <= _ref1 ? _j < _ref1 : _j > _ref1; i = 0 <= _ref1 ? ++_j : --_j) {
          newProps[k][i] = (endMatrix.props[k][i] - this.props[k][i]) * t + this.props[k][i];
        }
      }
      for (i = _k = 1; _k <= 2; i = ++_k) {
        newProps['rotate'][i] = endMatrix.props['rotate'][i];
      }
      _ref2 = ['skew'];
      for (_l = 0, _len1 = _ref2.length; _l < _len1; _l++) {
        k = _ref2[_l];
        newProps[k] = (endMatrix.props[k] - this.props[k]) * t + this.props[k];
      }
      return new DecomposedMatrix2D(newProps);
    };

    DecomposedMatrix2D.prototype.format = function() {
      return "translate(" + (this.props.translate.join(',')) + ") rotate(" + (this.props.rotate.join(',')) + ") skewX(" + this.props.skew + ") scale(" + (this.props.scale.join(',')) + ")";
    };

    DecomposedMatrix2D.prototype.applyRotateCenter = function(rotateC) {
      var i, m, m2d, negativeTranslate, _i, _results;
      m = baseSVG.createSVGMatrix();
      m = m.translate(rotateC[0], rotateC[1]);
      m = m.rotate(this.props.rotate[0]);
      m = m.translate(-rotateC[0], -rotateC[1]);
      m2d = new Matrix2D(m);
      negativeTranslate = m2d.decompose().props.translate;
      _results = [];
      for (i = _i = 0; _i <= 1; i = ++_i) {
        _results.push(this.props.translate[i] -= negativeTranslate[i]);
      }
      return _results;
    };

    return DecomposedMatrix2D;

  })();

  baseSVG = typeof document !== "undefined" && document !== null ? document.createElementNS("http://www.w3.org/2000/svg", "svg") : void 0;

  Matrix2D = (function() {
    function Matrix2D(m) {
      this.m = m;
      this.applyProperties = __bind(this.applyProperties, this);
      this.decompose = __bind(this.decompose, this);
      if (!this.m) {
        this.m = baseSVG.createSVGMatrix();
      }
    }

    Matrix2D.prototype.decompose = function() {
      var kx, ky, kz, r0, r1;
      r0 = new Vector([this.m.a, this.m.b]);
      r1 = new Vector([this.m.c, this.m.d]);
      kx = r0.length();
      kz = r0.dot(r1);
      r0 = r0.normalize();
      ky = r1.combine(r0, 1, -kz).length();
      return new DecomposedMatrix2D({
        translate: [this.m.e, this.m.f],
        rotate: [Math.atan2(this.m.b, this.m.a) * 180 / Math.PI, this.rotateCX, this.rotateCY],
        scale: [kx, ky],
        skew: kz / ky * 180 / Math.PI
      });
    };

    Matrix2D.prototype.applyProperties = function(properties) {
      var hash, k, props, v, _i, _len, _ref, _ref1;
      hash = {};
      for (_i = 0, _len = properties.length; _i < _len; _i++) {
        props = properties[_i];
        hash[props[0]] = props[1];
      }
      for (k in hash) {
        v = hash[k];
        if (k === "translateX") {
          this.m = this.m.translate(v, 0);
        } else if (k === "translateY") {
          this.m = this.m.translate(0, v);
        } else if (k === "scaleX") {
          this.m = this.m.scale(v, 1);
        } else if (k === "scaleY") {
          this.m = this.m.scale(1, v);
        } else if (k === "rotateZ") {
          this.m = this.m.rotate(v);
        } else if (k === "skewX") {
          this.m = this.m.skewX(v);
        } else if (k === "skewY") {
          this.m = this.m.skewY(v);
        }
      }
      this.rotateCX = (_ref = hash.rotateCX) != null ? _ref : 0;
      return this.rotateCY = (_ref1 = hash.rotateCY) != null ? _ref1 : 0;
    };

    return Matrix2D;

  })();

  Vector = (function() {
    function Vector(els) {
      this.els = els;
      this.combine = __bind(this.combine, this);
      this.normalize = __bind(this.normalize, this);
      this.length = __bind(this.length, this);
      this.cross = __bind(this.cross, this);
      this.dot = __bind(this.dot, this);
      this.e = __bind(this.e, this);
    }

    Vector.prototype.e = function(i) {
      if (i < 1 || i > this.els.length) {
        return null;
      } else {
        return this.els[i - 1];
      }
    };

    Vector.prototype.dot = function(vector) {
      var V, n, product;
      V = vector.els || vector;
      product = 0;
      n = this.els.length;
      if (n !== V.length) {
        return null;
      }
      n += 1;
      while (--n) {
        product += this.els[n - 1] * V[n - 1];
      }
      return product;
    };

    Vector.prototype.cross = function(vector) {
      var A, B;
      B = vector.els || vector;
      if (this.els.length !== 3 || B.length !== 3) {
        return null;
      }
      A = this.els;
      return new Vector([(A[1] * B[2]) - (A[2] * B[1]), (A[2] * B[0]) - (A[0] * B[2]), (A[0] * B[1]) - (A[1] * B[0])]);
    };

    Vector.prototype.length = function() {
      var a, e, _i, _len, _ref;
      a = 0;
      _ref = this.els;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        e = _ref[_i];
        a += Math.pow(e, 2);
      }
      return Math.sqrt(a);
    };

    Vector.prototype.normalize = function() {
      var e, i, length, newElements, _ref;
      length = this.length();
      newElements = [];
      _ref = this.els;
      for (i in _ref) {
        e = _ref[i];
        newElements[i] = e / length;
      }
      return new Vector(newElements);
    };

    Vector.prototype.combine = function(b, ascl, bscl) {
      var i, result, _i, _ref;
      result = [];
      for (i = _i = 0, _ref = this.els.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        result[i] = (ascl * this.els[i]) + (bscl * b.els[i]);
      }
      return new Vector(result);
    };

    return Vector;

  })();

  DecomposedMatrix = (function() {
    function DecomposedMatrix() {
      this.toMatrix = __bind(this.toMatrix, this);
      this.format = __bind(this.format, this);
      this.interpolate = __bind(this.interpolate, this);
    }

    DecomposedMatrix.prototype.interpolate = function(decomposedB, t, only) {
      var angle, decomposed, decomposedA, i, invscale, invth, k, qa, qb, scale, th, _i, _j, _k, _l, _len, _ref, _ref1;
      if (only == null) {
        only = null;
      }
      decomposedA = this;
      decomposed = new DecomposedMatrix;
      _ref = ['translate', 'scale', 'skew', 'perspective'];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        k = _ref[_i];
        decomposed[k] = [];
        for (i = _j = 0, _ref1 = decomposedA[k].length - 1; 0 <= _ref1 ? _j <= _ref1 : _j >= _ref1; i = 0 <= _ref1 ? ++_j : --_j) {
          if ((only == null) || only.indexOf(k) > -1 || only.indexOf("" + k + ['x', 'y', 'z'][i]) > -1) {
            decomposed[k][i] = (decomposedB[k][i] - decomposedA[k][i]) * t + decomposedA[k][i];
          } else {
            decomposed[k][i] = decomposedA[k][i];
          }
        }
      }
      if ((only == null) || only.indexOf('rotate') !== -1) {
        qa = decomposedA.quaternion;
        qb = decomposedB.quaternion;
        angle = qa[0] * qb[0] + qa[1] * qb[1] + qa[2] * qb[2] + qa[3] * qb[3];
        if (angle < 0.0) {
          for (i = _k = 0; _k <= 3; i = ++_k) {
            qa[i] = -qa[i];
          }
          angle = -angle;
        }
        if (angle + 1.0 > .05) {
          if (1.0 - angle >= .05) {
            th = Math.acos(angle);
            invth = 1.0 / Math.sin(th);
            scale = Math.sin(th * (1.0 - t)) * invth;
            invscale = Math.sin(th * t) * invth;
          } else {
            scale = 1.0 - t;
            invscale = t;
          }
        } else {
          qb[0] = -qa[1];
          qb[1] = qa[0];
          qb[2] = -qa[3];
          qb[3] = qa[2];
          scale = Math.sin(piDouble * (.5 - t));
          invscale = Math.sin(piDouble * t);
        }
        decomposed.quaternion = [];
        for (i = _l = 0; _l <= 3; i = ++_l) {
          decomposed.quaternion[i] = qa[i] * scale + qb[i] * invscale;
        }
      } else {
        decomposed.quaternion = decomposedA.quaternion;
      }
      return decomposed;
    };

    DecomposedMatrix.prototype.format = function() {
      return this.toMatrix().toString();
    };

    DecomposedMatrix.prototype.toMatrix = function() {
      var decomposedMatrix, i, j, match, matrix, quaternion, skew, temp, w, x, y, z, _i, _j, _k, _l;
      decomposedMatrix = this;
      matrix = Matrix.I(4);
      for (i = _i = 0; _i <= 3; i = ++_i) {
        matrix.els[i][3] = decomposedMatrix.perspective[i];
      }
      quaternion = decomposedMatrix.quaternion;
      x = quaternion[0];
      y = quaternion[1];
      z = quaternion[2];
      w = quaternion[3];
      skew = decomposedMatrix.skew;
      match = [[1, 0], [2, 0], [2, 1]];
      for (i = _j = 2; _j >= 0; i = --_j) {
        if (skew[i]) {
          temp = Matrix.I(4);
          temp.els[match[i][0]][match[i][1]] = skew[i];
          matrix = matrix.multiply(temp);
        }
      }
      matrix = matrix.multiply(new Matrix([[1 - 2 * (y * y + z * z), 2 * (x * y - z * w), 2 * (x * z + y * w), 0], [2 * (x * y + z * w), 1 - 2 * (x * x + z * z), 2 * (y * z - x * w), 0], [2 * (x * z - y * w), 2 * (y * z + x * w), 1 - 2 * (x * x + y * y), 0], [0, 0, 0, 1]]));
      for (i = _k = 0; _k <= 2; i = ++_k) {
        for (j = _l = 0; _l <= 2; j = ++_l) {
          matrix.els[i][j] *= decomposedMatrix.scale[i];
        }
        matrix.els[3][i] = decomposedMatrix.translate[i];
      }
      return matrix;
    };

    return DecomposedMatrix;

  })();

  Matrix = (function() {
    function Matrix(els) {
      this.els = els;
      this.toString = __bind(this.toString, this);
      this.decompose = __bind(this.decompose, this);
      this.inverse = __bind(this.inverse, this);
      this.augment = __bind(this.augment, this);
      this.toRightTriangular = __bind(this.toRightTriangular, this);
      this.transpose = __bind(this.transpose, this);
      this.multiply = __bind(this.multiply, this);
      this.dup = __bind(this.dup, this);
      this.e = __bind(this.e, this);
    }

    Matrix.prototype.e = function(i, j) {
      if (i < 1 || i > this.els.length || j < 1 || j > this.els[0].length) {
        return null;
      }
      return this.els[i - 1][j - 1];
    };

    Matrix.prototype.dup = function() {
      return new Matrix(this.els);
    };

    Matrix.prototype.multiply = function(matrix) {
      var M, c, cols, elements, i, j, ki, kj, nc, ni, nj, returnVector, sum;
      returnVector = matrix.modulus ? true : false;
      M = matrix.els || matrix;
      if (typeof M[0][0] === 'undefined') {
        M = new Matrix(M).els;
      }
      ni = this.els.length;
      ki = ni;
      kj = M[0].length;
      cols = this.els[0].length;
      elements = [];
      ni += 1;
      while (--ni) {
        i = ki - ni;
        elements[i] = [];
        nj = kj;
        nj += 1;
        while (--nj) {
          j = kj - nj;
          sum = 0;
          nc = cols;
          nc += 1;
          while (--nc) {
            c = cols - nc;
            sum += this.els[i][c] * M[c][j];
          }
          elements[i][j] = sum;
        }
      }
      M = new Matrix(elements);
      if (returnVector) {
        return M.col(1);
      } else {
        return M;
      }
    };

    Matrix.prototype.transpose = function() {
      var cols, elements, i, j, ni, nj, rows;
      rows = this.els.length;
      cols = this.els[0].length;
      elements = [];
      ni = cols;
      ni += 1;
      while (--ni) {
        i = cols - ni;
        elements[i] = [];
        nj = rows;
        nj += 1;
        while (--nj) {
          j = rows - nj;
          elements[i][j] = this.els[j][i];
        }
      }
      return new Matrix(elements);
    };

    Matrix.prototype.toRightTriangular = function() {
      var M, els, i, j, k, kp, multiplier, n, np, p, _i, _j, _ref, _ref1;
      M = this.dup();
      n = this.els.length;
      k = n;
      kp = this.els[0].length;
      while (--n) {
        i = k - n;
        if (M.els[i][i] === 0) {
          for (j = _i = _ref = i + 1; _ref <= k ? _i < k : _i > k; j = _ref <= k ? ++_i : --_i) {
            if (M.els[j][i] !== 0) {
              els = [];
              np = kp;
              np += 1;
              while (--np) {
                p = kp - np;
                els.push(M.els[i][p] + M.els[j][p]);
              }
              M.els[i] = els;
              break;
            }
          }
        }
        if (M.els[i][i] !== 0) {
          for (j = _j = _ref1 = i + 1; _ref1 <= k ? _j < k : _j > k; j = _ref1 <= k ? ++_j : --_j) {
            multiplier = M.els[j][i] / M.els[i][i];
            els = [];
            np = kp;
            np += 1;
            while (--np) {
              p = kp - np;
              els.push(p <= i ? 0 : M.els[j][p] - M.els[i][p] * multiplier);
            }
            M.els[j] = els;
          }
        }
      }
      return M;
    };

    Matrix.prototype.augment = function(matrix) {
      var M, T, cols, i, j, ki, kj, ni, nj;
      M = matrix.els || matrix;
      if (typeof M[0][0] === 'undefined') {
        M = new Matrix(M).els;
      }
      T = this.dup();
      cols = T.els[0].length;
      ni = T.els.length;
      ki = ni;
      kj = M[0].length;
      if (ni !== M.length) {
        return null;
      }
      ni += 1;
      while (--ni) {
        i = ki - ni;
        nj = kj;
        nj += 1;
        while (--nj) {
          j = kj - nj;
          T.els[i][cols + j] = M[i][j];
        }
      }
      return T;
    };

    Matrix.prototype.inverse = function() {
      var M, divisor, els, i, inverse_elements, j, ki, kp, new_element, ni, np, p, _i;
      ni = this.els.length;
      ki = ni;
      M = this.augment(Matrix.I(ni)).toRightTriangular();
      kp = M.els[0].length;
      inverse_elements = [];
      ni += 1;
      while (--ni) {
        i = ni - 1;
        els = [];
        np = kp;
        inverse_elements[i] = [];
        divisor = M.els[i][i];
        np += 1;
        while (--np) {
          p = kp - np;
          new_element = M.els[i][p] / divisor;
          els.push(new_element);
          if (p >= ki) {
            inverse_elements[i].push(new_element);
          }
        }
        M.els[i] = els;
        for (j = _i = 0; 0 <= i ? _i < i : _i > i; j = 0 <= i ? ++_i : --_i) {
          els = [];
          np = kp;
          np += 1;
          while (--np) {
            p = kp - np;
            els.push(M.els[j][p] - M.els[i][p] * M.els[j][i]);
          }
          M.els[j] = els;
        }
      }
      return new Matrix(inverse_elements);
    };

    Matrix.I = function(n) {
      var els, i, j, k, nj;
      els = [];
      k = n;
      n += 1;
      while (--n) {
        i = k - n;
        els[i] = [];
        nj = k;
        nj += 1;
        while (--nj) {
          j = k - nj;
          els[i][j] = i === j ? 1 : 0;
        }
      }
      return new Matrix(els);
    };

    Matrix.prototype.decompose = function() {
      var els, i, inversePerspectiveMatrix, j, k, matrix, pdum3, perspective, perspectiveMatrix, quaternion, result, rightHandSide, rotate, row, rowElement, s, scale, skew, t, translate, transposedInversePerspectiveMatrix, type, typeKey, v, w, x, y, z, _i, _j, _k, _l, _m, _n, _o, _p, _q, _r;
      matrix = this;
      translate = [];
      scale = [];
      skew = [];
      quaternion = [];
      perspective = [];
      els = [];
      for (i = _i = 0; _i <= 3; i = ++_i) {
        els[i] = [];
        for (j = _j = 0; _j <= 3; j = ++_j) {
          els[i][j] = matrix.els[i][j];
        }
      }
      if (els[3][3] === 0) {
        return false;
      }
      for (i = _k = 0; _k <= 3; i = ++_k) {
        for (j = _l = 0; _l <= 3; j = ++_l) {
          els[i][j] /= els[3][3];
        }
      }
      perspectiveMatrix = matrix.dup();
      for (i = _m = 0; _m <= 2; i = ++_m) {
        perspectiveMatrix.els[i][3] = 0;
      }
      perspectiveMatrix.els[3][3] = 1;
      if (els[0][3] !== 0 || els[1][3] !== 0 || els[2][3] !== 0) {
        rightHandSide = new Vector(els.slice(0, 4)[3]);
        inversePerspectiveMatrix = perspectiveMatrix.inverse();
        transposedInversePerspectiveMatrix = inversePerspectiveMatrix.transpose();
        perspective = transposedInversePerspectiveMatrix.multiply(rightHandSide).els;
        for (i = _n = 0; _n <= 2; i = ++_n) {
          els[i][3] = 0;
        }
        els[3][3] = 1;
      } else {
        perspective = [0, 0, 0, 1];
      }
      for (i = _o = 0; _o <= 2; i = ++_o) {
        translate[i] = els[3][i];
        els[3][i] = 0;
      }
      row = [];
      for (i = _p = 0; _p <= 2; i = ++_p) {
        row[i] = new Vector(els[i].slice(0, 3));
      }
      scale[0] = row[0].length();
      row[0] = row[0].normalize();
      skew[0] = row[0].dot(row[1]);
      row[1] = row[1].combine(row[0], 1.0, -skew[0]);
      scale[1] = row[1].length();
      row[1] = row[1].normalize();
      skew[0] /= scale[1];
      skew[1] = row[0].dot(row[2]);
      row[2] = row[2].combine(row[0], 1.0, -skew[1]);
      skew[2] = row[1].dot(row[2]);
      row[2] = row[2].combine(row[1], 1.0, -skew[2]);
      scale[2] = row[2].length();
      row[2] = row[2].normalize();
      skew[1] /= scale[2];
      skew[2] /= scale[2];
      pdum3 = row[1].cross(row[2]);
      if (row[0].dot(pdum3) < 0) {
        for (i = _q = 0; _q <= 2; i = ++_q) {
          scale[i] *= -1;
          for (j = _r = 0; _r <= 2; j = ++_r) {
            row[i].els[j] *= -1;
          }
        }
      }
      rowElement = function(index, elementIndex) {
        return row[index].els[elementIndex];
      };
      rotate = [];
      rotate[1] = Math.asin(-rowElement(0, 2));
      if (Math.cos(rotate[1]) !== 0) {
        rotate[0] = Math.atan2(rowElement(1, 2), rowElement(2, 2));
        rotate[2] = Math.atan2(rowElement(0, 1), rowElement(0, 0));
      } else {
        rotate[0] = Math.atan2(-rowElement(2, 0), rowElement(1, 1));
        rotate[1] = 0;
      }
      t = rowElement(0, 0) + rowElement(1, 1) + rowElement(2, 2) + 1.0;
      if (t > 1e-4) {
        s = 0.5 / Math.sqrt(t);
        w = 0.25 / s;
        x = (rowElement(2, 1) - rowElement(1, 2)) * s;
        y = (rowElement(0, 2) - rowElement(2, 0)) * s;
        z = (rowElement(1, 0) - rowElement(0, 1)) * s;
      } else if ((rowElement(0, 0) > rowElement(1, 1)) && (rowElement(0, 0) > rowElement(2, 2))) {
        s = Math.sqrt(1.0 + rowElement(0, 0) - rowElement(1, 1) - rowElement(2, 2)) * 2.0;
        x = 0.25 * s;
        y = (rowElement(0, 1) + rowElement(1, 0)) / s;
        z = (rowElement(0, 2) + rowElement(2, 0)) / s;
        w = (rowElement(2, 1) - rowElement(1, 2)) / s;
      } else if (rowElement(1, 1) > rowElement(2, 2)) {
        s = Math.sqrt(1.0 + rowElement(1, 1) - rowElement(0, 0) - rowElement(2, 2)) * 2.0;
        x = (rowElement(0, 1) + rowElement(1, 0)) / s;
        y = 0.25 * s;
        z = (rowElement(1, 2) + rowElement(2, 1)) / s;
        w = (rowElement(0, 2) - rowElement(2, 0)) / s;
      } else {
        s = Math.sqrt(1.0 + rowElement(2, 2) - rowElement(0, 0) - rowElement(1, 1)) * 2.0;
        x = (rowElement(0, 2) + rowElement(2, 0)) / s;
        y = (rowElement(1, 2) + rowElement(2, 1)) / s;
        z = 0.25 * s;
        w = (rowElement(1, 0) - rowElement(0, 1)) / s;
      }
      quaternion = [x, y, z, w];
      result = new DecomposedMatrix;
      result.translate = translate;
      result.scale = scale;
      result.skew = skew;
      result.quaternion = quaternion;
      result.perspective = perspective;
      result.rotate = rotate;
      for (typeKey in result) {
        type = result[typeKey];
        for (k in type) {
          v = type[k];
          if (isNaN(v)) {
            type[k] = 0;
          }
        }
      }
      return result;
    };

    Matrix.prototype.toString = function() {
      var i, j, str, _i, _j;
      str = 'matrix3d(';
      for (i = _i = 0; _i <= 3; i = ++_i) {
        for (j = _j = 0; _j <= 3; j = ++_j) {
          str += roundf(this.els[i][j], 10);
          if (!(i === 3 && j === 3)) {
            str += ',';
          }
        }
      }
      str += ')';
      return str;
    };

    Matrix.matrixForTransform = cacheFn(function(transform) {
      var matrixEl, result, style, _ref, _ref1, _ref2;
      matrixEl = document.createElement('div');
      matrixEl.style.position = 'absolute';
      matrixEl.style.visibility = 'hidden';
      matrixEl.style[propertyWithPrefix("transform")] = transform;
      document.body.appendChild(matrixEl);
      style = window.getComputedStyle(matrixEl, null);
      result = (_ref = (_ref1 = style.transform) != null ? _ref1 : style[propertyWithPrefix("transform")]) != null ? _ref : (_ref2 = dynamics.tests) != null ? _ref2.matrixForTransform(transform) : void 0;
      document.body.removeChild(matrixEl);
      return result;
    });

    Matrix.fromTransform = function(transform) {
      var digits, elements, i, match, matrixElements, _i;
      match = transform != null ? transform.match(/matrix3?d?\(([-0-9,e \.]*)\)/) : void 0;
      if (match) {
        digits = match[1].split(',');
        digits = digits.map(parseFloat);
        if (digits.length === 6) {
          elements = [digits[0], digits[1], 0, 0, digits[2], digits[3], 0, 0, 0, 0, 1, 0, digits[4], digits[5], 0, 1];
        } else {
          elements = digits;
        }
      } else {
        elements = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];
      }
      matrixElements = [];
      for (i = _i = 0; _i <= 3; i = ++_i) {
        matrixElements.push(elements.slice(i * 4, i * 4 + 4));
      }
      return new Matrix(matrixElements);
    };

    return Matrix;

  })();

  prefixFor = cacheFn(function(property) {
    var k, prefix, prop, propArray, propertyName, _i, _j, _len, _len1, _ref;
    if (document.body.style[property] !== void 0) {
      return '';
    }
    propArray = property.split('-');
    propertyName = "";
    for (_i = 0, _len = propArray.length; _i < _len; _i++) {
      prop = propArray[_i];
      propertyName += prop.substring(0, 1).toUpperCase() + prop.substring(1);
    }
    _ref = ["Webkit", "Moz", "ms"];
    for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
      prefix = _ref[_j];
      k = prefix + propertyName;
      if (document.body.style[k] !== void 0) {
        return prefix;
      }
    }
    return '';
  });

  propertyWithPrefix = cacheFn(function(property) {
    var prefix;
    prefix = prefixFor(property);
    if (prefix === 'Moz') {
      return "" + prefix + (property.substring(0, 1).toUpperCase() + property.substring(1));
    }
    if (prefix !== '') {
      return "-" + (prefix.toLowerCase()) + "-" + (toDashed(property));
    }
    return toDashed(property);
  });

  rAF = typeof window !== "undefined" && window !== null ? window.requestAnimationFrame : void 0;

  animations = [];

  animationsTimeouts = [];

  slow = false;

  slowRatio = 1;

  if (typeof window !== "undefined" && window !== null) {
    window.addEventListener('keyup', function(e) {
      if (e.keyCode === 68 && e.shiftKey && e.ctrlKey) {
        return dynamics.toggleSlow();
      }
    });
  }

  if (rAF == null) {
    lastTime = 0;
    rAF = function(callback) {
      var currTime, id, timeToCall;
      currTime = Date.now();
      timeToCall = Math.max(0, 16 - (currTime - lastTime));
      id = window.setTimeout(function() {
        return callback(currTime + timeToCall);
      }, timeToCall);
      lastTime = currTime + timeToCall;
      return id;
    };
  }

  runLoopRunning = false;

  runLoopPaused = false;

  startRunLoop = function() {
    if (!runLoopRunning) {
      runLoopRunning = true;
      return rAF(runLoopTick);
    }
  };

  runLoopTick = function(t) {
    var animation, toRemoveAnimations, _i, _len;
    if (runLoopPaused) {
      rAF(runLoopTick);
      return;
    }
    toRemoveAnimations = [];
    for (_i = 0, _len = animations.length; _i < _len; _i++) {
      animation = animations[_i];
      if (!animationTick(t, animation)) {
        toRemoveAnimations.push(animation);
      }
    }
    animations = animations.filter(function(animation) {
      return toRemoveAnimations.indexOf(animation) === -1;
    });
    if (animations.length === 0) {
      return runLoopRunning = false;
    } else {
      return rAF(runLoopTick);
    }
  };

  animationTick = function(t, animation) {
    var key, properties, property, tt, y, _base, _base1, _ref;
    if (animation.tStart == null) {
      animation.tStart = t;
    }
    tt = (t - animation.tStart) / animation.options.duration;
    y = animation.curve(tt);
    properties = {};
    if (tt >= 1) {
      if (animation.curve.returnsToSelf) {
        properties = animation.properties.start;
      } else {
        properties = animation.properties.end;
      }
    } else {
      _ref = animation.properties.start;
      for (key in _ref) {
        property = _ref[key];
        properties[key] = interpolate(property, animation.properties.end[key], y);
      }
    }
    applyFrame(animation.el, properties);
    if (typeof (_base = animation.options).change === "function") {
      _base.change(animation.el);
    }
    if (tt >= 1) {
      if (typeof (_base1 = animation.options).complete === "function") {
        _base1.complete(animation.el);
      }
    }
    return tt < 1;
  };

  interpolate = function(start, end, y) {
    if ((start != null) && (start.interpolate != null)) {
      return start.interpolate(end, y);
    }
    return null;
  };

  startAnimation = function(el, properties, options, timeoutId) {
    var endProperties, interpolable, isSVG, k, matrix, startProperties, transforms, v;
    if (timeoutId != null) {
      animationsTimeouts = animationsTimeouts.filter(function(timeout) {
        return timeout.id !== timeoutId;
      });
    }
    dynamics.stop(el, {
      timeout: false
    });
    if (!options.animated) {
      dynamics.css(el, properties);
      if (typeof options.complete === "function") {
        options.complete(this);
      }
      return;
    }
    properties = parseProperties(properties);
    startProperties = getCurrentProperties(el, Object.keys(properties));
    endProperties = {};
    transforms = [];
    for (k in properties) {
      v = properties[k];
      if ((el.style != null) && transformProperties.contains(k)) {
        transforms.push([k, v]);
      } else {
        interpolable = createInterpolable(v);
        if (interpolable instanceof InterpolableNumber && (el.style != null)) {
          interpolable = new InterpolableString([interpolable, unitForProperty(k, 0)]);
        }
        endProperties[k] = interpolable;
      }
    }
    if (transforms.length > 0) {
      isSVG = isSVGElement(el);
      if (isSVG) {
        matrix = new Matrix2D();
        matrix.applyProperties(transforms);
      } else {
        v = (transforms.map(function(transform) {
          return transformValueForProperty(transform[0], transform[1]);
        })).join(" ");
        matrix = Matrix.fromTransform(Matrix.matrixForTransform(v));
      }
      endProperties['transform'] = matrix.decompose();
      if (isSVG) {
        startProperties.transform.applyRotateCenter([endProperties.transform.props.rotate[1], endProperties.transform.props.rotate[2]]);
      }
    }
    animations.push({
      el: el,
      properties: {
        start: startProperties,
        end: endProperties
      },
      options: options,
      curve: options.type.call(options.type, options)
    });
    return startRunLoop();
  };

  timeouts = [];

  timeoutLastId = 0;

  setRealTimeout = function(timeout) {
    if (!isDocumentVisible()) {
      return;
    }
    return timeout.realTimeoutId = setTimeout(function() {
      timeout.fn();
      return cancelTimeout(timeout.id);
    }, timeout.delay);
  };

  addTimeout = function(fn, delay) {
    var timeout;
    timeoutLastId += 1;
    timeout = {
      id: timeoutLastId,
      tStart: Date.now(),
      fn: fn,
      delay: delay,
      originalDelay: delay
    };
    setRealTimeout(timeout);
    timeouts.push(timeout);
    return timeoutLastId;
  };

  cancelTimeout = function(id) {
    return timeouts = timeouts.filter(function(timeout) {
      if (timeout.id === id) {
        clearTimeout(timeout.realTimeoutId);
      }
      return timeout.id !== id;
    });
  };

  leftDelayForTimeout = function(time, timeout) {
    var consumedDelay;
    if (time != null) {
      consumedDelay = time - timeout.tStart;
      return timeout.originalDelay - consumedDelay;
    } else {
      return timeout.originalDelay;
    }
  };

  if (typeof window !== "undefined" && window !== null) {
    window.addEventListener('unload', function() {});
  }

  timeBeforeVisibilityChange = null;

  observeVisibilityChange(function(visible) {
    var animation, difference, timeout, _i, _j, _k, _len, _len1, _len2, _results;
    runLoopPaused = !visible;
    if (!visible) {
      timeBeforeVisibilityChange = Date.now();
      _results = [];
      for (_i = 0, _len = timeouts.length; _i < _len; _i++) {
        timeout = timeouts[_i];
        _results.push(clearTimeout(timeout.realTimeoutId));
      }
      return _results;
    } else {
      if (runLoopRunning) {
        difference = Date.now() - timeBeforeVisibilityChange;
        for (_j = 0, _len1 = animations.length; _j < _len1; _j++) {
          animation = animations[_j];
          if (animation.tStart != null) {
            animation.tStart += difference;
          }
        }
      }
      for (_k = 0, _len2 = timeouts.length; _k < _len2; _k++) {
        timeout = timeouts[_k];
        timeout.delay = leftDelayForTimeout(timeBeforeVisibilityChange, timeout);
        setRealTimeout(timeout);
      }
      return timeBeforeVisibilityChange = null;
    }
  });

  dynamics = {};

  dynamics.linear = function() {
    return function(t) {
      return t;
    };
  };

  dynamics.spring = function(options) {
    var A1, A2, decal, frequency, friction, s;
    if (options == null) {
      options = {};
    }
    applyDefaults(options, dynamics.spring.defaults);
    frequency = Math.max(1, options.frequency / 20);
    friction = Math.pow(20, options.friction / 100);
    s = options.anticipationSize / 1000;
    decal = Math.max(0, s);
    A1 = function(t) {
      var M, a, b, x0, x1;
      M = 0.8;
      x0 = s / (1 - s);
      x1 = 0;
      b = (x0 - (M * x1)) / (x0 - x1);
      a = (M - b) / x0;
      return (a * t * options.anticipationStrength / 100) + b;
    };
    A2 = function(t) {
      return Math.pow(friction / 10, -t) * (1 - t);
    };
    return function(t) {
      var A, At, a, angle, b, frictionT, y0, yS;
      frictionT = (t / (1 - s)) - (s / (1 - s));
      if (t < s) {
        yS = (s / (1 - s)) - (s / (1 - s));
        y0 = (0 / (1 - s)) - (s / (1 - s));
        b = Math.acos(1 / A1(yS));
        a = (Math.acos(1 / A1(y0)) - b) / (frequency * (-s));
        A = A1;
      } else {
        A = A2;
        b = 0;
        a = 1;
      }
      At = A(frictionT);
      angle = frequency * (t - s) * a + b;
      return 1 - (At * Math.cos(angle));
    };
  };

  dynamics.bounce = function(options) {
    var A, fn, frequency, friction;
    if (options == null) {
      options = {};
    }
    applyDefaults(options, dynamics.bounce.defaults);
    frequency = Math.max(1, options.frequency / 20);
    friction = Math.pow(20, options.friction / 100);
    A = function(t) {
      return Math.pow(friction / 10, -t) * (1 - t);
    };
    fn = function(t) {
      var At, a, angle, b;
      b = -3.14 / 2;
      a = 1;
      At = A(t);
      angle = frequency * t * a + b;
      return At * Math.cos(angle);
    };
    fn.returnsToSelf = true;
    return fn;
  };

  dynamics.gravity = function(options) {
    var L, bounciness, curves, elasticity, fn, getPointInCurve, gravity;
    if (options == null) {
      options = {};
    }
    applyDefaults(options, dynamics.gravity.defaults);
    bounciness = Math.min(options.bounciness / 1250, 0.8);
    elasticity = options.elasticity / 1000;
    gravity = 100;
    curves = [];
    L = (function() {
      var b, curve;
      b = Math.sqrt(2 / gravity);
      curve = {
        a: -b,
        b: b,
        H: 1
      };
      if (options.returnsToSelf) {
        curve.a = 0;
        curve.b = curve.b * 2;
      }
      while (curve.H > 0.001) {
        L = curve.b - curve.a;
        curve = {
          a: curve.b,
          b: curve.b + L * bounciness,
          H: curve.H * bounciness * bounciness
        };
      }
      return curve.b;
    })();
    getPointInCurve = function(a, b, H, t) {
      var c, t2;
      L = b - a;
      t2 = (2 / L) * t - 1 - (a * 2 / L);
      c = t2 * t2 * H - H + 1;
      if (options.returnsToSelf) {
        c = 1 - c;
      }
      return c;
    };
    (function() {
      var L2, b, curve, _results;
      b = Math.sqrt(2 / (gravity * L * L));
      curve = {
        a: -b,
        b: b,
        H: 1
      };
      if (options.returnsToSelf) {
        curve.a = 0;
        curve.b = curve.b * 2;
      }
      curves.push(curve);
      L2 = L;
      _results = [];
      while (curve.b < 1 && curve.H > 0.001) {
        L2 = curve.b - curve.a;
        curve = {
          a: curve.b,
          b: curve.b + L2 * bounciness,
          H: curve.H * elasticity
        };
        _results.push(curves.push(curve));
      }
      return _results;
    })();
    fn = function(t) {
      var curve, i, v;
      i = 0;
      curve = curves[i];
      while (!(t >= curve.a && t <= curve.b)) {
        i += 1;
        curve = curves[i];
        if (!curve) {
          break;
        }
      }
      if (!curve) {
        v = options.returnsToSelf ? 0 : 1;
      } else {
        v = getPointInCurve(curve.a, curve.b, curve.H, t);
      }
      return v;
    };
    fn.returnsToSelf = options.returnsToSelf;
    return fn;
  };

  dynamics.forceWithGravity = function(options) {
    if (options == null) {
      options = {};
    }
    applyDefaults(options, dynamics.forceWithGravity.defaults);
    options.returnsToSelf = true;
    return dynamics.gravity(options);
  };

  dynamics.bezier = (function() {
    var Bezier, Bezier_, yForX;
    Bezier_ = function(t, p0, p1, p2, p3) {
      return (Math.pow(1 - t, 3) * p0) + (3 * Math.pow(1 - t, 2) * t * p1) + (3 * (1 - t) * Math.pow(t, 2) * p2) + Math.pow(t, 3) * p3;
    };
    Bezier = function(t, p0, p1, p2, p3) {
      return {
        x: Bezier_(t, p0.x, p1.x, p2.x, p3.x),
        y: Bezier_(t, p0.y, p1.y, p2.y, p3.y)
      };
    };
    yForX = function(xTarget, Bs, returnsToSelf) {
      var B, aB, i, lower, percent, upper, x, xTolerance, _i, _len;
      B = null;
      for (_i = 0, _len = Bs.length; _i < _len; _i++) {
        aB = Bs[_i];
        if (xTarget >= aB(0).x && xTarget <= aB(1).x) {
          B = aB;
        }
        if (B !== null) {
          break;
        }
      }
      if (!B) {
        if (returnsToSelf) {
          return 0;
        } else {
          return 1;
        }
      }
      xTolerance = 0.0001;
      lower = 0;
      upper = 1;
      percent = (upper + lower) / 2;
      x = B(percent).x;
      i = 0;
      while (Math.abs(xTarget - x) > xTolerance && i < 100) {
        if (xTarget > x) {
          lower = percent;
        } else {
          upper = percent;
        }
        percent = (upper + lower) / 2;
        x = B(percent).x;
        i += 1;
      }
      return B(percent).y;
    };
    return function(options) {
      var Bs, fn, points;
      if (options == null) {
        options = {};
      }
      points = options.points;
      Bs = (function() {
        var i, k, _fn;
        Bs = [];
        _fn = function(pointA, pointB) {
          var B2;
          B2 = function(t) {
            return Bezier(t, pointA, pointA.cp[pointA.cp.length - 1], pointB.cp[0], pointB);
          };
          return Bs.push(B2);
        };
        for (i in points) {
          k = parseInt(i);
          if (k >= points.length - 1) {
            break;
          }
          _fn(points[k], points[k + 1]);
        }
        return Bs;
      })();
      fn = function(t) {
        if (t === 0) {
          return 0;
        } else if (t === 1) {
          return 1;
        } else {
          return yForX(t, Bs, this.returnsToSelf);
        }
      };
      fn.returnsToSelf = points[points.length - 1].y === 0;
      return fn;
    };
  })();

  dynamics.easeInOut = function(options) {
    var friction, _ref;
    if (options == null) {
      options = {};
    }
    friction = (_ref = options.friction) != null ? _ref : dynamics.easeInOut.defaults.friction;
    return dynamics.bezier({
      points: [
        {
          x: 0,
          y: 0,
          cp: [
            {
              x: 0.92 - (friction / 1000),
              y: 0
            }
          ]
        }, {
          x: 1,
          y: 1,
          cp: [
            {
              x: 0.08 + (friction / 1000),
              y: 1
            }
          ]
        }
      ]
    });
  };

  dynamics.easeIn = function(options) {
    var friction, _ref;
    if (options == null) {
      options = {};
    }
    friction = (_ref = options.friction) != null ? _ref : dynamics.easeIn.defaults.friction;
    return dynamics.bezier({
      points: [
        {
          x: 0,
          y: 0,
          cp: [
            {
              x: 0.92 - (friction / 1000),
              y: 0
            }
          ]
        }, {
          x: 1,
          y: 1,
          cp: [
            {
              x: 1,
              y: 1
            }
          ]
        }
      ]
    });
  };

  dynamics.easeOut = function(options) {
    var friction, _ref;
    if (options == null) {
      options = {};
    }
    friction = (_ref = options.friction) != null ? _ref : dynamics.easeOut.defaults.friction;
    return dynamics.bezier({
      points: [
        {
          x: 0,
          y: 0,
          cp: [
            {
              x: 0,
              y: 0
            }
          ]
        }, {
          x: 1,
          y: 1,
          cp: [
            {
              x: 0.08 + (friction / 1000),
              y: 1
            }
          ]
        }
      ]
    });
  };

  dynamics.spring.defaults = {
    frequency: 300,
    friction: 200,
    anticipationSize: 0,
    anticipationStrength: 0
  };

  dynamics.bounce.defaults = {
    frequency: 300,
    friction: 200
  };

  dynamics.forceWithGravity.defaults = dynamics.gravity.defaults = {
    bounciness: 400,
    elasticity: 200
  };

  dynamics.easeInOut.defaults = dynamics.easeIn.defaults = dynamics.easeOut.defaults = {
    friction: 500
  };

  dynamics.css = makeArrayFn(function(el, properties) {
    return applyProperties(el, properties, true);
  });

  dynamics.animate = makeArrayFn(function(el, properties, options) {
    var id;
    if (options == null) {
      options = {};
    }
    options = clone(options);
    applyDefaults(options, {
      type: dynamics.easeInOut,
      duration: 1000,
      delay: 0,
      animated: true
    });
    options.duration = Math.max(0, options.duration * slowRatio);
    options.delay = Math.max(0, options.delay);
    if (options.delay === 0) {
      return startAnimation(el, properties, options);
    } else {
      id = dynamics.setTimeout(function() {
        return startAnimation(el, properties, options, id);
      }, options.delay);
      return animationsTimeouts.push({
        id: id,
        el: el
      });
    }
  });

  dynamics.stop = makeArrayFn(function(el, options) {
    if (options == null) {
      options = {};
    }
    if (options.timeout == null) {
      options.timeout = true;
    }
    if (options.timeout) {
      animationsTimeouts = animationsTimeouts.filter(function(timeout) {
        if (timeout.el === el && ((options.filter == null) || options.filter(timeout))) {
          dynamics.clearTimeout(timeout.id);
          return false;
        }
        return true;
      });
    }
    return animations = animations.filter(function(animation) {
      return animation.el !== el;
    });
  });

  dynamics.setTimeout = function(fn, delay) {
    return addTimeout(fn, delay * slowRatio);
  };

  dynamics.initMatrixFromTransform = function(transform, inverse) {
    if (!inverse) {
      var matrix = Matrix.fromTransform(Matrix.matrixForTransform(transform)).decompose();
    } else {
      var matrix = Matrix.fromTransform(Matrix.matrixForTransform(transform)).inverse().decompose();
    }
    // setTimeout(function() {
    //         cb && cb(matrix);
    // }, 250)
    return matrix;
  }

  dynamics.clearTimeout = function(id) {
    return cancelTimeout(id);
  };

  dynamics.toggleSlow = function() {
    slow = !slow;
    if (slow) {
      slowRatio = 3;
    } else {
      slowRatio = 1;
    }
    return typeof console !== "undefined" && console !== null ? typeof console.log === "function" ? console.log("dynamics.js: slow animations " + (slow ? "enabled" : "disabled")) : void 0 : void 0;
  };

  if (typeof module === "object" && typeof module.exports === "object") {
    module.exports = dynamics;
  } else if (typeof define === "function") {
    define('dynamics', function() {
      return dynamics;
    });
  } else {
    window.dynamics = dynamics;
  }

}).call(this);



angular.module('uguru.shared.services')
.factory('CategoryService', ['Restangular', function(Restangular) {
    var Category;
    var categories;
    CategoryService = {
        categories:[],
        get: function() {
            return Restangular
                .one('categories').get();
        },
        getAcademic: function() {
            if (Category.categories && Category.categories.length) {
                copied_categories = Category.categories.slice();
                for (var i = 0; i < copied_categories.length; i ++) {
                    var indexCategory = copied_categories[i]
                    if (indexCategory.hex_color === 'academic') {
                        return indexCategory;
                    }
                }
            }
        },
        getLocalCategories: function() {
            return [{"name":"academic","background_url":"./img/categories/bg/academic.jpg","description":"Share your wisdom by tutoring courses you've mastered","hex_color":"#e6389b", "rgb_color":"rgb(230#56#155)", "bg_hex_color":"academic","icon_url":"./img/categories/icon/academic.svg","id":5,"is_active":true,"is_approved":true,"num_gurus":103,"num_subcategories":4,"subcategories":[{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Share your wisdom by tutoring courses you've mastered","icon_url":"templates/svg/subcategories/academic/tutoring.svg","id":26,"is_active":true,"is_approved":true,"name":"In Person","num_gurus":45,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Share your wisdom by tutoring courses you've mastered","icon_url":"templates/svg/subcategories/academic/video-outline.svg","id":27,"is_active":true,"is_approved":true,"name":"Remote (Video Chat)","num_gurus":99,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Share your wisdom by tutoring courses you've mastered","icon_url":"templates/svg/subcategories/academic/answerquestions.svg","id":28,"is_active":true,"is_approved":true,"name":"Q&A","num_gurus":96,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Share your wisdom by tutoring courses you've mastered","icon_url":"templates/svg/subcategories/academic/tutorpeers.svg","id":29,"is_active":true,"is_approved":true,"name":"Office Hours","num_gurus":38,"unit_name":"hour"}]},{"name":"baking","background_url":"./img/categories/bg/baking.jpg","description":"Treat your fellow peers with homemade recipes cooked with love","hex_color":"#F6C64E", "rgb_color":"rgb(246#298#78)", "bg_hex_color":"baking","icon_url":"./img/categories/icon/baking-small.svg","id":2,"is_active":true,"is_approved":true,"num_gurus":60,"num_subcategories":7,"subcategories":[{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Treat your fellow peers with homemade recipes cooked with love","icon_url":"templates/svg/subcategories/baking/cake.svg","id":8,"is_active":true,"is_approved":true,"name":"Cake","num_gurus":33,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Treat your fellow peers with homemade recipes cooked with love","icon_url":"templates/svg/subcategories/baking/cupcake.svg","id":9,"is_active":true,"is_approved":true,"name":"Cupcakes","num_gurus":52,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Treat your fellow peers with homemade recipes cooked with love","icon_url":"templates/svg/subcategories/baking/donut.svg","id":10,"is_active":true,"is_approved":true,"name":"Donuts","num_gurus":45,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Treat your fellow peers with homemade recipes cooked with love","icon_url":"templates/svg/subcategories/baking/coffee.svg","id":11,"is_active":true,"is_approved":true,"name":"Coffee","num_gurus":24,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Treat your fellow peers with homemade recipes cooked with love","icon_url":"templates/svg/subcategories/baking/flan.svg","id":12,"is_active":true,"is_approved":true,"name":"Flan","num_gurus":19,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Treat your fellow peers with homemade recipes cooked with love","icon_url":"templates/svg/subcategories/baking/cookie.svg","id":13,"is_active":true,"is_approved":true,"name":"Cookies","num_gurus":20,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Treat your fellow peers with homemade recipes cooked with love","icon_url":"templates/svg/subcategories/baking/brownie.svg","id":14,"is_active":true,"is_approved":true,"name":"Brownies","num_gurus":14,"unit_name":"hour"}]},{"name":"household","background_url":"./img/categories/bg/sports.jpg","description":"College students can be lazy. Earn by doing simple household chores.","hex_color":"#7872e3", "rgb_color":"rgb(120#114#227)", "bg_hex_color":"household","icon_url":"./img/categories/icon/sports-small.svg","id":7,"is_active":true,"is_approved":true,"num_gurus":29,"num_subcategories":5,"subcategories":[{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"College students can be lazy. Earn by doing simple household chores.","icon_url":"templates/svg/subcategories/household/laundry.svg","id":39,"is_active":true,"is_approved":true,"name":"Laundry","num_gurus":22,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"College students can be lazy. Earn by doing simple household chores.","icon_url":"templates/svg/subcategories/household/vacuum.svg","id":40,"is_active":true,"is_approved":true,"name":"Vacuuming","num_gurus":22,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"College students can be lazy. Earn by doing simple household chores.","icon_url":"templates/svg/subcategories/household/house_cleaning.svg","id":41,"is_active":true,"is_approved":true,"name":"House Cleaning","num_gurus":22,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"College students can be lazy. Earn by doing simple household chores.","icon_url":"templates/svg/subcategories/household/dishes.svg","id":42,"is_active":true,"is_approved":true,"name":"Dishes","num_gurus":18,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"College students can be lazy. Earn by doing simple household chores.","icon_url":"templates/svg/subcategories/household/furniture.svg","id":43,"is_active":true,"is_approved":true,"name":"Build Ikea Furniture","num_gurus":18,"unit_name":"hour"}]},{"name":"photography","background_url":"./img/categories/bg/photography.jpg","description":"Help your peers look great @ a college-friendly price (Not $100+/hr).","hex_color":"#81B566", "rgb_color":"rgb(129#181#102)", "bg_hex_color":"photography","icon_url":"./img/categories/icon/photography-small.svg","id":8,"is_active":true,"is_approved":true,"num_gurus":19,"num_subcategories":4,"subcategories":[{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Help your peers look great @ a college-friendly price (Not $100+/hr).","icon_url":"templates/svg/subcategories/photography/graduate.svg","id":44,"is_active":true,"is_approved":true,"name":"Graduation Photos","num_gurus":16,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Help your peers look great @ a college-friendly price (Not $100+/hr).","icon_url":"templates/svg/subcategories/photography/headshots.svg","id":45,"is_active":true,"is_approved":true,"name":"Professional Headshots","num_gurus":17,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Help your peers look great @ a college-friendly price (Not $100+/hr).","icon_url":"templates/svg/subcategories/photography/athlete.svg","id":46,"is_active":true,"is_approved":true,"name":"Athletic & Action Images","num_gurus":15,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Help your peers look great @ a college-friendly price (Not $100+/hr).","icon_url":"templates/svg/subcategories/photography/outdoor.svg","id":47,"is_active":true,"is_approved":true,"name":"Outdoor & Scenery","num_gurus":17,"unit_name":"hour"}]},{"name":"tech","background_url":"./img/categories/bg/delivery.jpg","description":"Save the day for peers who don't live & breath tech (yet...).","hex_color":"#55A4B7", "rgb_color":"rgb(230#56#155)", "bg_hex_color":"tech","icon_url":"./img/categories/icon/delivery-small.svg","id":4,"is_active":true,"is_approved":true,"num_gurus":20,"num_subcategories":5,"subcategories":[{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Save the day for peers who don't live & breath tech (yet...).","icon_url":"templates/svg/subcategories/tech/wifi.svg","id":21,"is_active":true,"is_approved":true,"name":"Wifi setup","num_gurus":18,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Save the day for peers who don't live & breath tech (yet...).","icon_url":"templates/svg/subcategories/tech/phonerepair.svg","id":22,"is_active":true,"is_approved":true,"name":"Phone Screen Repair","num_gurus":18,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Save the day for peers who don't live & breath tech (yet...).","icon_url":"templates/svg/subcategories/tech/computerrepair.svg","id":23,"is_active":true,"is_approved":true,"name":"Computer Repair","num_gurus":18,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Save the day for peers who don't live & breath tech (yet...).","icon_url":"templates/svg/subcategories/tech/virusremoval.svg","id":24,"is_active":true,"is_approved":true,"name":"Virus Removal","num_gurus":16,"unit_name":"hour"},{"avg_hourly":6,"avg_hourly_higher":8,"avg_hourly_lower":0,"description":"Save the day for peers who don't live & breath tech (yet...).","icon_url":"templates/svg/subcategories/tech/cd.svg","id":25,"is_active":true,"is_approved":true,"name":"Software Setup","num_gurus":19,"unit_name":"hour"}]}] ;
        },
        mapActiveToSubcategories: function(categories, user) {
            categories_sliced = categories.slice();
            for (var i = 0; i < categories_sliced.length; i ++) {
                var indexCategory = categories_sliced[i];
                indexCategory.active_subcategories = 0;
            }
            if (!user.guru_subcategories || !user.guru_subcategories.length) {
                return;
            }
            for (var i = 0; i < user.guru_subcategories.length; i ++) {
                for (var j = 0; j < categories_sliced.length; j ++) {

                    var userSubcategory = user.guru_subcategories[i];
                    indexCategory = categories_sliced[j];
                    if (!userSubcategory.category || !indexCategory) {
                        continue;
                    }
                    if (indexCategory.id === userSubcategory.category.id) {
                        indexCategory.active_subcategories += 1
                        for (var k = 0; k < indexCategory.subcategories.length; k++) {
                            var indexSubcategory = indexCategory.subcategories[k];

                            if (indexSubcategory.id === userSubcategory.id)
                                categories[j].subcategories[k].active = true;

                        }
                    }
                }
            }
        }
    };
    return CategoryService;
}]);

angular.module('uguru.shared.services')
.factory('UniversityService', ['Restangular', '$timeout', '$localstorage', 'GUtilService',
    function(Restangular, $timeout, $localstorage, GUtilService) {
    var University;
    var source = {
        majors: [],
        courses: [],
        popularCourses: []
    };
    var selectedID = null;
    var selected = {};
    UniversityService = {
        refresh: function() {
            $timeout(function() {
                source.majors.push({});
                source.courses.push({});

            }, 0);
            $timeout(function() {
                source.majors.pop();
                source.courses.pop();
            }, 300);
        },
        filterByAlreadyStarted: function(universities) {
            var resultArr = [];
            var currentDate = new Date();
            for (var i = 0; i < universities.length; i++) {
                var indexUniversity = universities[i];

                //continue if it doesnt exist
                if (!indexUniversity.sp16_start) {
                    continue;
                }

                var universityJSDate =  new Date(Date.parse(indexUniversity.sp16_start));
                if (universityJSDate <= currentDate) {
                    indexUniversity.sp16_js_date = universityJSDate;
                    indexUniversity.sp16_utc_date = universityJSDate.toUTCString();
                    resultArr.push(JSON.parse(JSON.stringify(indexUniversity)))
                }
            }
            resultArr.sort(function(a,b){
                return new Date(b.sp16_js_date) - new Date(a.sp16_js_date);
            });
            return resultArr;
        },
        getUniversityDateDist : function(universities) {

                var dateDistribution = {};
                for (var i = 0; i < universities.length; i++) {
                    var indexUniversity = universities[i];
                    if (!dateDistribution[indexUniversity.sp16_utc_date]) {
                        dateDistribution[indexUniversity.sp16_utc_date]= [indexUniversity];
                    } else {
                        dateDistribution[indexUniversity.sp16_utc_date].push(indexUniversity)
                    }
                }
                return dateDistribution;
        },
        printUniversityDateDist : function(universities_dist_dict) {
                for (var j = 0; j < Object.keys(universities_dist_dict).length; j++) {
                    var indexKey = Object.keys(universities_dist_dict)[j];
                }
        },
        initUniversitiesSplash : function(scope, map_options) {
            scope.featured_universities = [];
            scope.universities = University.getTargetted().slice();
            if (!scope.selectedUniversity) {
                scope.selectedUniversity = scope.user.university || University.getTargetted().slice()[0]; //berkeley
            }
            scope.featured_uni_ids = [1714, 2318, 1632, 702, 1853];
            scope.featured_universities = [scope.selectedUniversity];
            for (var i = 0; i < scope.universities.length; i++) {
                var indexUniversity = scope.universities[i];
                var isFeaturedByIndex = scope.featured_uni_ids.indexOf(indexUniversity.id)
                if (isFeaturedByIndex > - 1) {
                    scope.featured_universities.push(indexUniversity);
                    GUtilService.generateStaticMapUrls(scope.featured_universities, map_options)
                }
            }
        },
        getUniversityDateDistArrFromDict : function(universities_dist_dict) {
                var resultArr = []
                for (var j = 0; j < Object.keys(universities_dist_dict).length; j++) {
                    var indexKey = Object.keys(universities_dist_dict)[j];
                    resultArr.push(universities_dist_dict[indexKey]);
                }
                return resultArr;
        },
        getBerkeleyLocal: function() {
            return targettedUniversities[0];
        },
        clearSelected: function() {
            $timeout(function() {
                source.majors = [];
                source.courses = [];
            }, 0);
        },
        get: function() {
            return Restangular
                .one('universities').get();
        },
        getMajors: function(uni_id) {
            // $timeout(function() {
                return $timeout(function() { Restangular
                    .one('universities', uni_id).customGET('departments').then(

                    function(response) {

                        source.majors = response.plain();
                        $timeout(function() {
                            $localstorage.set(uni_id + ' majors', source.majors);
                        }, 1000);
                    }, function(err) {
                        console.error("Error getting majors: " + err);
                    });
            }, 0);

        },
        getPopularCourses: function(uni_id, scope, callback) {
             if (!uni_id) {
                return;
             }
             return $timeout(function() {
                  Restangular
                     .one('universities', uni_id).customGET('popular_courses').then(function(response) {



                             source.courses = response.plain();

                             if (scope && callback) {
                                callback(scope, source.courses.slice());
                             }

                     }, function(err) {
                         console.error("Error getting popularCourses: " + err);
                     });
             }, 0);
         },
         getPopularCoursesPromise: function(uni_id, scope, callback) {
             if (!uni_id) {
                return;
             }
             return Restangular.one('universities', uni_id).customGET('popular_courses');
         },
        getCourses: function(uni_id, callback) {
            return $timeout(function() {
                 Restangular
                    .one('universities', uni_id).customGET('courses').then(function(response) {
                        // source.courses = response.plain();
                        callback && callback(response.plain());
                        // $timeout(function() {

                    }, function(err) {
                        console.error("Error getting courses: " + err);
                    });
            }, 0);
        },
        getTargetted: function() {
            return targettedUniversities.sort(function(a, b){ return a.rank-b.rank});;
        },
        getTargettedAccessCodes: function(){
            var allAccessCodes = [];
            var targettedUniversitiesCopy = targettedUniversities.slice();
            for (var i = 0 ; i < targettedUniversitiesCopy.length; i++) {
                indexTargetAccess = targettedUniversitiesCopy[i].school_mascot_name;
                if (indexTargetAccess && indexTargetAccess.length) {
                    var formattedCode = (indexTargetAccess + '2015').replace(" ", "").replace(" ", "").toLowerCase();
                    allAccessCodes.push(formattedCode);
                }
            }
            return allAccessCodes;
        },
        getSorted: function() {
            return sortByRank(targettedUniversities);
        },
        // majors: majors,
        // courses: courses,
        source: source,
        hasNoMajors:hasNoMajors,
        hasNoCourses:hasNoCourses,
        selected: selected

    };
    return UniversityService;
}]);

function sortByRank(list) {
  function compareRank(a, b) {
    if (a.id === 2307) {
        return 1;
    }
    if (a.us_news_ranking < b.us_news_ranking)
      return -1;
    if (a.us_news_ranking > b.us_news_ranking)
      return 1;
    return 0;
  }
  return list.sort(compareRank);
}

function hasNoCourses(list) {
    return University.courses.length === 0;
}

function hasNoMajors(list) {
    return University.majors.length === 0;
}


function removeAlreadyAddedCourses(user_courses) {
    return
}

var targettedUniversities = [{
        "school_casual_name": "Cal",
        "school_color_one": "#023360",
        "banner_url": "https://farm8.staticflickr.com/7318/9357094656_965041bc2b_k.jpg",
        "sp16_start": "Tue, 12 Jan 2016 00:00:00 -0000",
        "rank": 1,
        "school_tiny_name": "UCB",
        "id": 2307,
        "city": "Berkeley",
        "num_popular_courses": 842,
        "state": "CA",
        "latitude": "37.8718992",
        "population": 35893,
        "website": "berkeley.edu",
        "banner_url_confirmed": true,
        "short_name": "UC Berkeley",
        "seal_url": "//upload.wikimedia.org/wikipedia/commons/thumb/a/a1/Seal_of_University_of_California%2C_Berkeley.svg/200px-Seal_of_University_of_California%2C_Berkeley.svg.png",
        "school_mascot_name": "Golden Bears",
        "school_color_light": "#FBB431",
        "departments_sanitized": true,
        "school_color_dark": "#023360",
        "school_color_primary": null,
        "school_color_two": "#FBB431",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-california-berkeley_50x50.jpg",
        "num_depts": 175,
        "name": "University of California at Berkeley",
        "num_emails": 41,
        "num_courses": 12328,
        "variations": "golden bears cal uc uc berkeley",
        "longitude": "-122.2585399",
        "courses_sanitized": true,
        "popular_courses": [
            "ESPM 165",
            "IAS 115",
            "ECON 119",
            "ANTHRO 139",
            "PSYCH 125",
            "PACS 94",
            "MUSIC 142",
            "MATH 98",
            "FILM 50",
            "GEOG 130",
            "CHEM 103",
            "ART 8",
            "GREEK 10",
            "STAT 157",
            "UGBA 103",
            "EPS 3",
            "DUTCH 166",
            "GWS 103",
            "ISF 61",
            "UGIS 112"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/a/a1/Seal_of_University_of_California%2C_Berkeley.svg"
    },
    {
        "school_casual_name": null,
        "school_color_one": "#602D89",
        "banner_url": "https://farm3.staticflickr.com/2201/1920823208_231b39f33b_z.jpg",
        "sp16_start": "Tue, 26 Jan 2016 00:00:00 -0000",
        "rank": 53,
        "school_tiny_name": "",
        "id": 2356,
        "city": "Worcester",
        "num_popular_courses": 254,
        "state": "MA",
        "latitude": "42.2378888",
        "population": 2926,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Crusader",
        "school_color_light": null,
        "departments_sanitized": true,
        "school_color_dark": null,
        "school_color_primary": null,
        "school_color_two": null,
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/college-of-the-holy-cross_50x50.jpg",
        "num_depts": 76,
        "name": "College of The Holy Cross",
        "num_emails": 0,
        "num_courses": 516,
        "variations": " cthc",
        "longitude": "-71.8052464",
        "courses_sanitized": true,
        "popular_courses": [
            "HIST 121",
            "ENGL 142",
            "RELS 151",
            "PHYS 115",
            "EDUC 167",
            "ECOA 277",
            "CHEM 222",
            "MATH 362",
            "SOCL 277",
            "MUSC 142",
            "ACCT 277",
            "ECON 256",
            "FREN 301",
            "ENG 101",
            "PSYC 101",
            "AFST 110",
            "GERM 101",
            "LALS 299",
            "RUSS 101",
            "POLS 101"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Eagles",
        "school_color_one": "#910039",
        "banner_url": "https://farm3.staticflickr.com/2868/12435132395_dfc89ebb71_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 36,
        "school_tiny_name": "BC",
        "id": 320,
        "city": "Chestnut hill",
        "num_popular_courses": 51,
        "state": "MA",
        "latitude": "42.3355488",
        "population": 14605,
        "website": "bc.edu",
        "banner_url_confirmed": false,
        "short_name": "BC",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/5/5b/Boston_College_Seal.svg/220px-Boston_College_Seal.svg.png",
        "school_mascot_name": "Baldwin the Eagle",
        "school_color_light": "#B38F59",
        "departments_sanitized": true,
        "school_color_dark": "#910039",
        "school_color_primary": null,
        "school_color_two": "#B38F59",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/boston-college_50x50.jpg",
        "num_depts": 1,
        "name": "Boston College",
        "num_emails": 5,
        "num_courses": 189,
        "variations": "baldwin the eagle eagles bc",
        "longitude": "-71.1684945",
        "courses_sanitized": true,
        "popular_courses": [
            "EN 010",
            "RM 410",
            "PL 070",
            "ECON 201",
            "GM 050",
            "HP 001",
            "MKT 101",
            "MT 3800",
            "GE 167",
            "RL 110",
            "HS 082",
            "PY 4650",
            "SC 043",
            "TH 161",
            "CHEM 101",
            "ILPR 2006",
            "MA 726",
            "HIST 081",
            "MD 707",
            "PSY 101"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/4/42/BostonCollegeEagles.svg"
    },
    {
        "school_casual_name": "Diplomats",
        "school_color_one": "#602D89",
        "banner_url": "https://farm9.staticflickr.com/8066/8210408862_594abf8719_b.jpg",
        "sp16_start": "Sun, 17 Jan 2016 00:00:00 -0000",
        "rank": 56,
        "school_tiny_name": "F&M",
        "id": 940,
        "city": "Lancaster",
        "num_popular_courses": 403,
        "state": "PA",
        "latitude": "40.04748",
        "population": 2365,
        "website": "www.fandm.edu",
        "banner_url_confirmed": false,
        "short_name": "F&M",
        "seal_url": null,
        "school_mascot_name": "Ben and John",
        "school_color_light": null,
        "departments_sanitized": true,
        "school_color_dark": null,
        "school_color_primary": null,
        "school_color_two": null,
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/franklin-and-marshall-college_50x50.jpg",
        "num_depts": 83,
        "name": "Franklin and Marshall College",
        "num_emails": 0,
        "num_courses": 1974,
        "variations": "diplomats f&m",
        "longitude": "-76.317913",
        "courses_sanitized": true,
        "popular_courses": [
            "CPS 150",
            "AMS 110",
            "BOS 341",
            "NTW 119",
            "ENG 107",
            "CLS 113",
            "MSS 109",
            "ECO 130",
            "FIN 302",
            "WGS 210",
            "PSY 230",
            "CCS 125",
            "BUS 360",
            "PHY 223",
            "RST 114",
            "FND 180",
            "SOC 302",
            "CHM 375",
            "ECON 350",
            "MUS 104"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": null,
        "school_color_one": "#40484B",
        "banner_url": "https://farm4.staticflickr.com/3498/3210094985_3e2e917898_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 207,
        "school_tiny_name": "SMCM",
        "id": 945,
        "city": "Saint mary's city",
        "num_popular_courses": 64,
        "state": "MD",
        "latitude": "38.1874875",
        "population": 1933,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Seahawk",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/st-marys-college-of-maryland_50x50.jpg",
        "num_depts": 51,
        "name": "St Marys College of Maryland",
        "num_emails": 0,
        "num_courses": 1009,
        "variations": "",
        "longitude": "-76.4253163",
        "courses_sanitized": true,
        "popular_courses": [
            "SOAN 101",
            "EDUC 204",
            "FRENCH 102",
            "HIST 362",
            "ENG 106",
            "BIO 101",
            "THEA 106",
            "POB 105",
            "ENGL 230",
            "ART 101",
            "PHYS 131",
            "SPANISH 110",
            "IDIS 101",
            "BIOL 100",
            "SOC 101",
            "PYSCH 101",
            "LIT 106",
            "PHILOSOPHY 101",
            "TFMS 101",
            "PHIL 304"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "UMD",
        "school_color_one": "#00274c",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/8/89/UniversityofMichDearbornEng.jpg",
        "sp16_start": "Wed, 06 Jan 2016 00:00:00 -0000",
        "rank": 45,
        "school_tiny_name": "UMD",
        "id": 1334,
        "city": "Dearborn",
        "num_popular_courses": 20,
        "state": "MI",
        "latitude": "42.318409",
        "population": 43426,
        "website": null,
        "banner_url_confirmed": true,
        "short_name": "UM Dearborn",
        "seal_url": null,
        "school_mascot_name": "Wolverine",
        "school_color_light": "#ffcb05",
        "departments_sanitized": true,
        "school_color_dark": "#00274c",
        "school_color_primary": null,
        "school_color_two": "#ffcb05",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-michigan-ann-arbor_50x50.jpg",
        "num_depts": 194,
        "name": "University of Michigan, Dearborn",
        "num_emails": 0,
        "num_courses": 3308,
        "variations": "",
        "longitude": "-83.233202",
        "courses_sanitized": false,
        "popular_courses": [
            "BIO 357",
            "MUS 100",
            "MUSIC 100",
            "ETHICS 240",
            "ANT 101",
            "PSY 440",
            "ANTHRO 101",
            "HISTORY 356",
            "PSYCH 4275"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "UC Santa Cruz",
        "school_color_one": "#00458c",
        "banner_url": "https://farm1.staticflickr.com/8/9005836_dae2c1ec06_b.jpg",
        "sp16_start": "Wed, 23 Mar 2016 00:00:00 -0000",
        "rank": 218,
        "school_tiny_name": "UCSC",
        "id": 36,
        "city": "Santa cruz",
        "num_popular_courses": 58,
        "state": "CA",
        "latitude": "36.9913856",
        "population": 17404,
        "website": "www.ucsc.edu",
        "banner_url_confirmed": false,
        "short_name": "UCSC",
        "seal_url": null,
        "school_mascot_name": "Banana Slugs",
        "school_color_light": "#F1B521",
        "departments_sanitized": true,
        "school_color_dark": "#00458c",
        "school_color_primary": null,
        "school_color_two": "#F1B521",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-california-santa-cruz_50x50.jpg",
        "num_depts": 260,
        "name": "University of California Santa Cruz",
        "num_emails": 10274,
        "num_courses": 14552,
        "variations": "banana slugs uc santa cruz ucsc",
        "longitude": "-122.0608718",
        "courses_sanitized": true,
        "popular_courses": [
            "LING 52",
            "ASTRO 1",
            "ECON 12",
            "CE 185",
            "THEA 160",
            "PSYCH 80",
            "MUSC 9",
            "PHIL 91",
            "LALS 173",
            "CMMU 148",
            "MATH 23",
            "ENVS 144",
            "HIST 117",
            "BALLET 1",
            "SPAN 56",
            "ISM 158",
            "LGST 133",
            "SOCY 01",
            "CMPE 220",
            "LTPR 107"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": null,
        "school_color_one": "#8b9476",
        "banner_url": "https://farm6.staticflickr.com/5163/5200159021_4b3d2cae6a_z.jpg",
        "sp16_start": null,
        "rank": 69,
        "school_tiny_name": "SCRP",
        "id": 1859,
        "city": "Claremont",
        "num_popular_courses": 27,
        "state": "CA",
        "latitude": "34.1042118",
        "population": 962,
        "website": "www.scrippscollege.edu/",
        "banner_url_confirmed": false,
        "short_name": "Scripps",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/c/c7/Scripps_College_Seal.png/200px-Scripps_College_Seal.png",
        "school_mascot_name": "La Semeuse (\"she who sows\")",
        "school_color_light": "#8b9476",
        "departments_sanitized": true,
        "school_color_dark": "#757575",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/scripps-college_50x50.jpg",
        "num_depts": 51,
        "name": "Scripps College",
        "num_emails": 0,
        "num_courses": 946,
        "variations": "la semeuse (\"she who sows\") sc scripps",
        "longitude": "-117.710379",
        "courses_sanitized": true,
        "popular_courses": [
            "ECON 51",
            "PHIL 155",
            "FRENCH 100",
            "ART 141",
            "POLI 100",
            "MATH 57",
            "BIO 43",
            "WRITI 50",
            "ITAL 44",
            "DANCE 103",
            "HMSC 123",
            "CORE 1",
            "CLASS 19",
            "WRI 50",
            "SPAN 44",
            "PSYC 52",
            "WR 50",
            "FREN 33"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "union",
        "school_color_one": "#822433",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/6/62/Union_Library_Lane_2.JPG",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 57,
        "school_tiny_name": "U",
        "id": 851,
        "city": "Schenectady",
        "num_popular_courses": 161,
        "state": "NY",
        "latitude": "42.8177427",
        "population": 2241,
        "website": "http://union.edu",
        "banner_url_confirmed": true,
        "short_name": "Union",
        "seal_url": "//upload.wikimedia.org/wikipedia/commons/thumb/a/aa/UnionCollegeSeal.svg/200px-UnionCollegeSeal.svg.png",
        "school_mascot_name": "dutch",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#822433",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/union-college_50x50.jpg",
        "num_depts": 46,
        "name": "Union College",
        "num_emails": 0,
        "num_courses": 598,
        "variations": "dutchmen/dutchwomen uc",
        "longitude": "-73.9305222",
        "courses_sanitized": true,
        "popular_courses": [
            "ECO 226",
            "PSY 200",
            "PS 12",
            "CHM 102",
            "PHY 120",
            "PHL 110",
            "CALC 113",
            "MER 232",
            "ANT 100",
            "SOC 202",
            "HST 35",
            "MTH 102",
            "PSC 340",
            "SPN 202",
            "MBA 506",
            "BIO 378",
            "ECON 242",
            "CSC 148",
            "EGL 100",
            "FYP 100"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/a/aa/UnionCollegeSeal.svg"
    },
    {
        "school_casual_name": "pittsburgh",
        "school_color_one": "#012C5C",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/6/67/Children's_Hospital_Pittsburgh.jpg",
        "sp16_start": "Wed, 06 Jan 2016 00:00:00 -0000",
        "rank": 198,
        "school_tiny_name": "Pitt",
        "id": 141,
        "city": "Pittsburgh",
        "num_popular_courses": 644,
        "state": "PA",
        "latitude": "40.4443533",
        "population": 28769,
        "website": "www.pitt.edu",
        "banner_url_confirmed": true,
        "short_name": "Pittsburgh",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/2/2d/University_of_Pittsburgh_Seal_%28official%29.svg/200px-University_of_Pittsburgh_Seal_%28official%29.svg.png",
        "school_mascot_name": "Panthers",
        "school_color_light": "#CCB77F",
        "departments_sanitized": true,
        "school_color_dark": "#012C5C",
        "school_color_primary": null,
        "school_color_two": "#CCB77F",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-pittsburgh-pittsburgh-campus_50x50.jpg",
        "num_depts": 79,
        "name": "University of Pittsburgh",
        "num_emails": 0,
        "num_courses": 2983,
        "variations": "panthers pitt up",
        "longitude": "-79.960835",
        "courses_sanitized": true,
        "popular_courses": [
            "CS 1555",
            "MATH 0025",
            "ANTH 0630",
            "ITAL 0080",
            "BIOSC 1250",
            "HIST 0200",
            "GEOL 0870",
            "PS 1351",
            "NROSCI 0081",
            "CHEM 0250",
            "PHYS 0476",
            "ADMJ 1210",
            "SOC 0432",
            "CHIN 0002",
            "SLAV 0880",
            "PSY 310",
            "ECON 1420",
            "GER 1500",
            "HAA 0470",
            "LING 1777"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/2/25/University_of_Pittsburgh_Seal.svg"
    },
    {
        "school_casual_name": "Golden Gophers",
        "school_color_one": "#7A0019",
        "banner_url": "https://farm4.staticflickr.com/3324/3508672267_94850769c3_b.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 108,
        "school_tiny_name": "UM",
        "id": 1332,
        "city": "Minneapolis",
        "num_popular_courses": 27,
        "state": "MN",
        "latitude": "44.97399",
        "population": 51853,
        "website": "www.umn.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/68/Umnseal.png/200px-Umnseal.png",
        "school_mascot_name": "Goldy Gopher",
        "school_color_light": "#FFCC33",
        "departments_sanitized": true,
        "school_color_dark": "#7A0019",
        "school_color_primary": null,
        "school_color_two": "#FFCC33",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-minnesota-twin-cities_50x50.jpg",
        "num_depts": 208,
        "name": "University of Minnesota, Twin Cities",
        "num_emails": 0,
        "num_courses": 9507,
        "variations": "goldy gopher golden gophers umtc",
        "longitude": "-93.2277285",
        "courses_sanitized": false,
        "popular_courses": [
            "SMGT 1701",
            "MATS 2001",
            "PHYS 1302",
            "MATH 1051",
            "ARTH 1921",
            "HIST 1302",
            "MUS 1021",
            "CHM 1061",
            "POL 4481",
            "ENGC 1013",
            "BIOLOGY 1001",
            "MBA 6230",
            "BIOC 3201",
            "CNES 0000",
            "SOC 3090"
        ],
        "svg_url": "https://conservancy.umn.edu/std/image/blockm.svg"
    },
    {
        "school_casual_name": null,
        "school_color_one": "#40484B",
        "banner_url": "https://farm4.staticflickr.com/3418/3796957926_4e84089e4c_z.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 159,
        "school_tiny_name": "",
        "id": 1228,
        "city": "Sparkill",
        "num_popular_courses": 75,
        "state": "NY",
        "latitude": "41.042084",
        "population": 370,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Spartans",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/thomas-aquinas-college_50x50.jpg",
        "num_depts": 45,
        "name": "St Thomas Aquinas College",
        "num_emails": 0,
        "num_courses": 602,
        "variations": " stac",
        "longitude": "-73.936432",
        "courses_sanitized": true,
        "popular_courses": [
            "ED 212",
            "ENG 354",
            "BIO 101",
            "CHEM 401",
            "PHIL 101",
            "EDSP 241",
            "MATH 108",
            "ENGL 354",
            "CA 101",
            "CIS 101",
            "RELS 101",
            "BUSA 202",
            "ECON 101",
            "HIST 102",
            "SOC 101",
            "SPAN 210",
            "ACCT 101",
            "CJ 101",
            "EDEL 240",
            "MKTG 102"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "UP",
        "school_color_one": "purple",
        "banner_url": "http://www.pdxcru.com/wp-content/uploads/2009/12/university-of-portland-campus-156ca1f292f3aef1.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 187,
        "school_tiny_name": "P",
        "id": 1371,
        "city": "Portland",
        "num_popular_courses": 1435,
        "state": "OR",
        "latitude": "45.5721069",
        "population": 3981,
        "website": "www.up.edu",
        "banner_url_confirmed": true,
        "short_name": "Portland",
        "seal_url": null,
        "school_mascot_name": "pilot",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "purple",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-portland_50x50.jpg",
        "num_depts": 47,
        "name": "University of Portland",
        "num_emails": 50,
        "num_courses": 3517,
        "variations": "wally pilot pilots up",
        "longitude": "-122.7258785",
        "courses_sanitized": true,
        "popular_courses": [
            "CS 162",
            "ECE 171",
            "PHE 363",
            "CCJ 380",
            "EC 314",
            "UNST 134",
            "PSY 348",
            "WR 227",
            "CE 371",
            "SOC 301",
            "TA 370",
            "MKTG 363",
            "PR 399",
            "BI 301",
            "PS 422",
            "ENG 254",
            "PSYCH 310",
            "ME 122",
            "CR 510",
            "EAS 211"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/b/b3/Portland_State_University_Logo.svg"
    },
    {
        "school_casual_name": "Jaspers and Lady Jaspers",
        "school_color_one": "#4cbb17",
        "banner_url": "https://farm1.staticflickr.com/265/18690604185_a5462a95e6_z.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 199,
        "school_tiny_name": "",
        "id": 947,
        "city": "Bronx",
        "num_popular_courses": 318,
        "state": "NY",
        "latitude": "40.889897",
        "population": 3800,
        "website": "www.manhattan.edu",
        "banner_url_confirmed": false,
        "short_name": "Manhattan",
        "seal_url": "//upload.wikimedia.org/wikipedia/commons/thumb/a/af/Manhattan_College_Green_Seal.JPG/150px-Manhattan_College_Green_Seal.JPG",
        "school_mascot_name": null,
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#4cbb17",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/manhattan-college_50x50.jpg",
        "num_depts": 76,
        "name": "Manhattan College",
        "num_emails": 0,
        "num_courses": 1066,
        "variations": "jaspers and lady jaspers mc",
        "longitude": "-73.901076",
        "courses_sanitized": true,
        "popular_courses": [
            "BIOL 207",
            "RELS 311",
            "LAW 203",
            "HIST 217",
            "CIS 210",
            "BIO 207",
            "ENGL 211",
            "SOC 304",
            "MATH 106",
            "COMM 110",
            "ENGS 205",
            "ECON 227",
            "SPAN 202",
            "MGMT 201",
            "EDUC 205",
            "ENG 365",
            "MECH 210",
            "FREN 101",
            "KIN 403",
            "CMPT 114"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "SIU",
        "school_color_one": "#7E0106",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/1/1b/Pulliam_Hall_(SIU).JPG",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 189,
        "school_tiny_name": "S IL",
        "id": 1149,
        "city": "Carbondale",
        "num_popular_courses": 314,
        "state": "IL",
        "latitude": "37.7138335",
        "population": 0,
        "website": "http://www.siusystem.edu/",
        "banner_url_confirmed": true,
        "short_name": "S Illinois",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/0/08/Siuseal.gif",
        "school_mascot_name": "dawg",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#7E0106",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "//upload.wikimedia.org/wikipedia/en/0/08/Siuseal.gif",
        "num_depts": 121,
        "name": "Southern Illinois University",
        "num_emails": 0,
        "num_courses": 6999,
        "variations": "salukis siu carbondale sriu niu",
        "longitude": "-89.2116506",
        "courses_sanitized": true,
        "popular_courses": [
            "JRNL 311",
            "PSYC 301",
            "IST 232",
            "ZOOL 115",
            "PHIL 104",
            "MATH 480",
            "CS 306",
            "REHB 574",
            "ACCT 321",
            "MKTG 390",
            "AH 241",
            "FIN 331",
            "GEOL 220",
            "MCMA 201",
            "MUS 103",
            "AD 227",
            "CHEM 106",
            "ENGL 119",
            "PHYS 101",
            "MGMT 318"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "stanford",
        "school_color_one": "#8C1515",
        "banner_url": "https://farm3.staticflickr.com/2577/3758541889_41a6fd1bd7_o.jpg",
        "sp16_start": "Sat, 09 Jan 2016 00:00:00 -0000",
        "rank": 2,
        "school_tiny_name": "S",
        "id": 249,
        "city": "Stanford",
        "num_popular_courses": 356,
        "state": "CA",
        "latitude": "37.4274745",
        "population": 18519,
        "website": "www.stanford.edu",
        "banner_url_confirmed": true,
        "short_name": "Stanford",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/b/b7/Stanford_University_seal_2003.svg/200px-Stanford_University_seal_2003.svg.png",
        "school_mascot_name": "cardinal",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#8C1515",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/stanford-university_50x50.jpg",
        "num_depts": 243,
        "name": "Stanford University",
        "num_emails": 8218,
        "num_courses": 679,
        "variations": "cardinal (official), stanford tree (unofficial, mascot of lsjumb) cardinal su",
        "longitude": "-122.169719",
        "courses_sanitized": true,
        "popular_courses": [
            "BUS 195",
            "BIO 150",
            "ITAL 1",
            "E 40",
            "CS 229",
            "WRT 150",
            "CHEM 36",
            "ETHIC 157",
            "EE 263",
            "PS 1",
            "LAW 219",
            "PHYSICS 51",
            "AA 256",
            "ECON 50",
            "HPS 154",
            "MATH 4142",
            "MUSIC 123",
            "COURSERAALGO 1",
            "SLE 91",
            "ENG 123"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/b/b7/Stanford_University_seal_2003.svg"
    },
    {
        "school_casual_name": "Midshipmen",
        "school_color_one": "#00205B",
        "banner_url": "https://farm5.staticflickr.com/4082/4884285162_5fb0d0fc9e_b.jpg",
        "sp16_start": null,
        "rank": 27,
        "school_tiny_name": "USNA",
        "id": 355,
        "city": "Annapolis",
        "num_popular_courses": 285,
        "state": "MD",
        "latitude": "38.9836483",
        "population": 4536,
        "website": "www.usna.eduu.s. naval academyu.s. national register of historic placesu.s. national historic landmark districtlocationmaryland ave. and hanover st., annapolis, marylandbuilt1845\\u00a0(1845)architecternest flaggarchitectural\\u00a0stylebeaux arts[2]governing bodyfederalnrhp\\u00a0reference\\u00a0#66000386[1]significant datesadded to nrhpoctober 15, 1966designated\\u00a0nhldjuly 4, 1961[3]",
        "banner_url_confirmed": false,
        "short_name": "Annapolis",
        "seal_url": "//upload.wikimedia.org/wikipedia/commons/thumb/d/dd/USNA_Gold_Seal.png/200px-USNA_Gold_Seal.png",
        "school_mascot_name": "Bill the Goat",
        "school_color_light": "#C5B783",
        "departments_sanitized": true,
        "school_color_dark": "#00205B",
        "school_color_primary": null,
        "school_color_two": "#C5B783",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/united-states-naval-academy_50x50.jpg",
        "num_depts": 35,
        "name": "United States Naval Academy",
        "num_emails": 0,
        "num_courses": 653,
        "variations": "bill the goat midshipmen usna annapolis",
        "longitude": "-76.482335",
        "courses_sanitized": true,
        "popular_courses": [
            "SP 221",
            "EA 301",
            "FP 314",
            "HH 327",
            "EM 232",
            "EE 302",
            "EN 475",
            "FE 431",
            "SB 251",
            "SO 234",
            "ACCT 4001",
            "HE 2003",
            "NL 101",
            "ES 450",
            "FF 202",
            "FG 101",
            "SI 472",
            "SM 233",
            "Fa 102",
            "NN 204"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Golden Eagles",
        "school_color_one": "#003366",
        "banner_url": "https://farm9.staticflickr.com/8036/8038178584_76c72162bd_b.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 208,
        "school_tiny_name": "",
        "id": 385,
        "city": "Milwaukee",
        "num_popular_courses": 273,
        "state": "WI",
        "latitude": "43.0388508",
        "population": 11749,
        "website": "www.marquette.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/a/a3/Marquette_University_Seal.svg/200px-Marquette_University_Seal.svg.png",
        "school_mascot_name": "Golden eagle",
        "school_color_light": "#FFCC00",
        "departments_sanitized": true,
        "school_color_dark": "#003366",
        "school_color_primary": null,
        "school_color_two": "#FFCC00",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/marquette-university_50x50.jpg",
        "num_depts": 128,
        "name": "Marquette University",
        "num_emails": 0,
        "num_courses": 5466,
        "variations": "golden eagle golden eagles mu",
        "longitude": "-87.9304238",
        "courses_sanitized": true,
        "popular_courses": [
            "LEAD 1000",
            "BISC 2135",
            "COSC 1010",
            "CEEN 2130",
            "HIST 1501",
            "MATH 3100",
            "PHYS 1007",
            "ANTH 1001",
            "BIOL 1001",
            "MANA 2028",
            "COMM 2500",
            "ACCO 3001",
            "SOWJ 2200",
            "CHEM 2111",
            "ADPR 1800",
            "BIEN 1120",
            "POSC 4241",
            "SPAN 2003",
            "COEN 4730",
            "ITAL 1001"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/a/a3/Marquette_University_Seal.svg"
    },
    {
        "school_casual_name": "Purple Knights",
        "school_color_one": "#652d8a",
        "banner_url": "https://farm8.staticflickr.com/7436/12710028105_930a414e78_z.jpg",
        "sp16_start": "Mon, 18 Jan 2016 00:00:00 -0000",
        "rank": 151,
        "school_tiny_name": "ST.M",
        "id": 818,
        "city": "Colchester",
        "num_popular_courses": 1,
        "state": "VT",
        "latitude": "44.4957789",
        "population": 2410,
        "website": "smcvt.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/f/f1/Saint_Michael%27s_College_seal.png",
        "school_mascot_name": "Purple Knights",
        "school_color_light": "#cfab7a",
        "departments_sanitized": true,
        "school_color_dark": "#652d8a",
        "school_color_primary": null,
        "school_color_two": "#cfab7a",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/saint-michaels-college_50x50.jpg",
        "num_depts": 51,
        "name": "Saint Michaels College",
        "num_emails": 0,
        "num_courses": 967,
        "variations": "purple knights smc",
        "longitude": "-73.1663288",
        "courses_sanitized": false,
        "popular_courses": [
            "CALC 1"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "UC",
        "school_color_one": "#DE0A2A",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/5/56/University_of_Cincinnati_Solar_Decathlon_2007.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 24,
        "school_tiny_name": "C",
        "id": 121,
        "city": "Cincinnati",
        "num_popular_courses": 760,
        "state": "OH",
        "latitude": "39.1329219",
        "population": 15245,
        "website": "www.uc.edu",
        "banner_url_confirmed": true,
        "short_name": "Cincinnati",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/7/79/UC_Seal.svg/200px-UC_Seal.svg.png",
        "school_mascot_name": "bearcat",
        "school_color_light": "#DE0A2A",
        "departments_sanitized": null,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#000000",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-chicago_50x50.jpg",
        "num_depts": 272,
        "name": "University of Cincinnati",
        "num_emails": 0,
        "num_courses": 11589,
        "variations": "bearcats uc uc",
        "longitude": "-84.5149504",
        "courses_sanitized": true,
        "popular_courses": [
            "COMM 348",
            "INTB 380",
            "SPED 250",
            "CHEM 1041",
            "ACCT 373",
            "MKTG 2080",
            "POL 110",
            "CHE 421",
            "GEOG 102",
            "MGMT 1051",
            "PHIL 121",
            "FIN 380",
            "FAM 2061",
            "PHYS 132",
            "HIST 171",
            "WGS 2010",
            "BIOL 2081",
            "CS 2011",
            "ANTH 106",
            "ECE 430"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/5/59/University_of_Cincinnati_logo.svg"
    },
    {
        "school_casual_name": "Mules",
        "school_color_one": "#c41e3a",
        "banner_url": "https://farm3.staticflickr.com/2834/13744608114_3abc7aa858_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 121,
        "school_tiny_name": "Mulh",
        "id": 1037,
        "city": "Allentown",
        "num_popular_courses": 204,
        "state": "PA",
        "latitude": "40.5963928",
        "population": 2422,
        "website": "muhlenberg.edu",
        "banner_url_confirmed": false,
        "short_name": "Muhlenberg",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/3/34/Muhlenberg_College_seal.png",
        "school_mascot_name": "The Mule",
        "school_color_light": "#808080",
        "departments_sanitized": true,
        "school_color_dark": "#c41e3a",
        "school_color_primary": null,
        "school_color_two": "#808080",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/muhlenberg-college_50x50.jpg",
        "num_depts": 132,
        "name": "Muhlenberg College",
        "num_emails": 0,
        "num_courses": 1601,
        "variations": "the mule mules mc",
        "longitude": "-75.5084673",
        "courses_sanitized": true,
        "popular_courses": [
            "BIO 150",
            "AAS 101",
            "ESC 111",
            "ACT 101",
            "ECN 101",
            "HBW 101",
            "PHL 105",
            "PHY 121",
            "COM 240",
            "FYS 113",
            "PSC 101",
            "PSY 103",
            "SPN 204",
            "CALC 2",
            "DRAWING 1",
            "THR 101",
            "CHM 104",
            "ENG 331",
            "ARS 110",
            "ATH 112"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Bulldogs",
        "school_color_one": "#004477",
        "banner_url": "https://farm5.staticflickr.com/4090/4843369753_0f982a7b20_z.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 143,
        "school_tiny_name": "D",
        "id": 96,
        "city": "Des moines",
        "num_popular_courses": 339,
        "state": "IA",
        "latitude": "41.6012173",
        "population": 5270,
        "website": "www.drake.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/9/99/DrakeSeal.png",
        "school_mascot_name": "Spike",
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "#004477",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/drake-university_50x50.jpg",
        "num_depts": 80,
        "name": "Drake University",
        "num_emails": 0,
        "num_courses": 1968,
        "variations": "spike bulldogs du",
        "longitude": "-93.652187",
        "courses_sanitized": true,
        "popular_courses": [
            "BUS 073",
            "FIN 102",
            "JMC 030",
            "BIO 18",
            "PHIL 90",
            "CHEM 1",
            "ECON 105",
            "IS 101",
            "SCSG 003",
            "ACTS 121",
            "ENG 173",
            "MATH 20",
            "MKTG 106",
            "MUS 149",
            "CS 65",
            "SCSS 130",
            "HIST 076",
            "MGMT 120",
            "ACCT 041",
            "EDUC 107"
        ],
        "svg_url": "http://alumni.drake.edu/file/drakeLogo.svg"
    },
    {
        "school_casual_name": "Ephs",
        "school_color_one": "#330067",
        "banner_url": "https://farm8.staticflickr.com/7005/6590277403_fb6ec9ba1a_z.jpg",
        "sp16_start": "Wed, 03 Feb 2016 00:00:00 -0000",
        "rank": 1,
        "school_tiny_name": "Will",
        "id": 785,
        "city": "Williamstown",
        "num_popular_courses": 57,
        "state": "MA",
        "latitude": "42.7134709",
        "population": 2124,
        "website": "www.williams.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/1/19/Williams_College_Seal.svg/200px-Williams_College_Seal.svg.png",
        "school_mascot_name": "The Purple Cow[3]",
        "school_color_light": "#FFD700",
        "departments_sanitized": true,
        "school_color_dark": "#330067",
        "school_color_primary": null,
        "school_color_two": "#FFD700",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/williams-college_50x50.jpg",
        "num_depts": 68,
        "name": "Williams College",
        "num_emails": 0,
        "num_courses": 2581,
        "variations": "the purple cow[3] ephs wc",
        "longitude": "-73.2049942",
        "courses_sanitized": true,
        "popular_courses": [
            "MATH 105",
            "ARTH 101",
            "PHIL 102",
            "ECON 110",
            "PSYC 322",
            "GOVT 2305",
            "ENGL 204",
            "ENVI 101",
            "ENG 145",
            "AMST 201",
            "CHEM 156",
            "CLAS 101",
            "COMP 111",
            "HIST 166",
            "PHYS 202",
            "PSCI 201",
            "RLIT 101",
            "RLSP 200",
            "REL 301",
            "CS 237"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/1/19/Williams_College_Seal.svg"
    },
    {
        "school_casual_name": "Thoroughbreds (\"T-Breds\")",
        "school_color_one": "#1f6855",
        "banner_url": "https://farm8.staticflickr.com/7292/12524824074_47b9db92af_z.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 102,
        "school_tiny_name": "Skid",
        "id": 107,
        "city": "Saratoga springs",
        "num_popular_courses": 236,
        "state": "NY",
        "latitude": "43.0961489",
        "population": 2689,
        "website": "skidmore.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Thoroughbreds",
        "school_color_light": "#ffcc00",
        "departments_sanitized": true,
        "school_color_dark": "#1f6855",
        "school_color_primary": null,
        "school_color_two": "#ffcc00",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/skidmore-college_50x50.jpg",
        "num_depts": 67,
        "name": "Skidmore College",
        "num_emails": 0,
        "num_courses": 1798,
        "variations": "thoroughbreds thoroughbreds (\"t-breds\") sc",
        "longitude": "-73.7817705",
        "courses_sanitized": true,
        "popular_courses": [
            "AH 103",
            "ED 215",
            "PS 207",
            "AR 132",
            "CH 221",
            "HI 211",
            "PY 207",
            "EC 237",
            "ES 105",
            "MB 107",
            "RE 220",
            "FF 203",
            "SO 226",
            "TH 101",
            "AM 101",
            "AN 102",
            "BI 105",
            "EX 119",
            "GE 102",
            "MU 315"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "NW",
        "school_color_one": "#4E2A84",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/f/f4/Northwestern_University_Library,_Evanston,_IL.JPG",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 19,
        "school_tiny_name": "NW",
        "id": 138,
        "city": "Evanston",
        "num_popular_courses": 84,
        "state": "IL",
        "latitude": "42.0564594",
        "population": 21215,
        "website": "northwestern.edu",
        "banner_url_confirmed": true,
        "short_name": "Northwestern",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/69/Northwestern_University_Seal.svg/220px-Northwestern_University_Seal.svg.png",
        "school_mascot_name": "wildcat",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#4E2A84",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/northwestern-university_50x50.jpg",
        "num_depts": 234,
        "name": "Northwestern University",
        "num_emails": 0,
        "num_courses": 8674,
        "variations": "willie the wildcat wildcats nu nw",
        "longitude": "-87.675267",
        "courses_sanitized": true,
        "popular_courses": [
            "PSYCH 110",
            "FINC 430",
            "MORS 452",
            "EA 3",
            "PREDICT 401",
            "GS 390",
            "MSC 593",
            "CIS 414",
            "JOUR 370",
            "ENG 273",
            "NUIN 401",
            "CHEM 101",
            "AAL 105",
            "SOC 101",
            "CSD 309",
            "HIST 275",
            "COMM 360",
            "RTVF 230",
            "ECON 3",
            "ARA 102"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/6/69/Northwestern_University_Seal.svg"
    },
    {
        "school_casual_name": "rhodes",
        "school_color_one": "#EF3A41",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/d/db/Paul-barret-library-rhodes-college.jpg",
        "sp16_start": "Wed, 13 Jan 2016 00:00:00 -0000",
        "rank": 93,
        "school_tiny_name": "RC",
        "id": 993,
        "city": "Memphis",
        "num_popular_courses": 211,
        "state": "TN",
        "latitude": "35.1527477",
        "population": 1927,
        "website": "www.rhodes.edu",
        "banner_url_confirmed": true,
        "short_name": "Rhodes",
        "seal_url": null,
        "school_mascot_name": "lynx",
        "school_color_light": "#EF3A41",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#000000",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/rhodes-college_50x50.jpg",
        "num_depts": 87,
        "name": "Rhodes College",
        "num_emails": 0,
        "num_courses": 2544,
        "variations": "lynx rc",
        "longitude": "-89.9926269",
        "courses_sanitized": true,
        "popular_courses": [
            "MUSC 191",
            "ART 232",
            "PS 151",
            "BIO 301",
            "ECON 290",
            "PHIL 250",
            "HIST 212",
            "RELS 256",
            "SPAN 101",
            "ENG 155",
            "IS 100",
            "SOC 101",
            "BIOL 200",
            "CHEM 211",
            "FREN 201",
            "HUM 201",
            "MATH 121",
            "PHYS 111",
            "POLS 340",
            "PSYC 200"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "IU Bloomington",
        "school_color_one": "#F8F3D4",
        "banner_url": "https://farm6.staticflickr.com/5477/12739534105_5ee0a82d32_o.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 107,
        "school_tiny_name": "UI-B",
        "id": 1025,
        "city": "Bloomington",
        "num_popular_courses": 530,
        "state": "IN",
        "latitude": "39.1691355",
        "population": 42133,
        "website": null,
        "banner_url_confirmed": true,
        "short_name": "IU Bloomington",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/5/5d/Indiana_University_seal.svg/200px-Indiana_University_seal.svg.png",
        "school_mascot_name": "Hoosier",
        "school_color_light": "#F8F3D4",
        "departments_sanitized": true,
        "school_color_dark": "#7B1211",
        "school_color_primary": null,
        "school_color_two": "#7B1211",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/indiana-university-bloomington_50x50.jpg",
        "num_depts": 298,
        "name": "Indiana University",
        "num_emails": 0,
        "num_courses": 9931,
        "variations": "hoosiers iu bloomington iu",
        "longitude": "-86.5149053",
        "courses_sanitized": true,
        "popular_courses": [
            "ECONE 370",
            "MATHA 118",
            "ECON 370",
            "E 370",
            "C 127",
            "BUSA 200",
            "CHEMC 127",
            "A 100",
            "POLSY 100",
            "ANTHL 200",
            "RELB 210",
            "CHEM 341",
            "HISTB 226",
            "BUSX 202",
            "MUSZ 101",
            "HISTA 382",
            "HPERH 160",
            "HPERP 212",
            "ENGL 314",
            "SPEAV 160"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/5/5d/Indiana_University_seal.svg"
    },
    {
        "school_casual_name": "Tigers",
        "school_color_one": "#111C24",
        "banner_url": "https://farm6.staticflickr.com/5189/5739477809_9014beae1f_b.jpg",
        "sp16_start": "Mon, 01 Feb 2016 00:00:00 -0000",
        "rank": 91,
        "school_tiny_name": "DPU",
        "id": 1215,
        "city": "Greencastle",
        "num_popular_courses": 196,
        "state": "IN",
        "latitude": "39.640397",
        "population": 2336,
        "website": "depauw.edu",
        "banner_url_confirmed": false,
        "short_name": "DPU",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/b/bb/DePauw_University_seal.png/200px-DePauw_University_seal.png",
        "school_mascot_name": "Tyler the Tiger[4]",
        "school_color_light": "#FFCF01",
        "departments_sanitized": true,
        "school_color_dark": "#111C24",
        "school_color_primary": null,
        "school_color_two": "#FFCF01",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/depauw-university_50x50.jpg",
        "num_depts": 51,
        "name": "Depauw University",
        "num_emails": 0,
        "num_courses": 1119,
        "variations": "tyler the tiger[4] tigers du dpu",
        "longitude": "-86.861622",
        "courses_sanitized": true,
        "popular_courses": [
            "CHEM 130",
            "POLS 150",
            "BIO 215",
            "ECON 220",
            "HIST 107",
            "COMM 223",
            "SOC 222",
            "ENG 283",
            "ARTH 131",
            "EDUC 222",
            "PSY 100",
            "PHIL 100",
            "MUS 130",
            "REL 130",
            "SPAN 232",
            "ANTH 151",
            "MATH 331",
            "PHYS 120",
            "CALC 2",
            "DOTA 197"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "vmi",
        "school_color_one": "#C3403C",
        "banner_url": "https://farm3.staticflickr.com/2551/5758069231_e33e89bc04_z.jpg",
        "sp16_start": "Wed, 13 Jan 2016 00:00:00 -0000",
        "rank": 129,
        "school_tiny_name": "VM",
        "id": 1005,
        "city": "Lexington",
        "num_popular_courses": 38,
        "state": "VA",
        "latitude": "37.789819",
        "population": 1664,
        "website": "vmi.edu",
        "banner_url_confirmed": false,
        "short_name": "Virginia Military",
        "seal_url": null,
        "school_mascot_name": "kangaroos",
        "school_color_light": "#F9F5EF",
        "departments_sanitized": true,
        "school_color_dark": "#C3403C",
        "school_color_primary": null,
        "school_color_two": "#F9F5EF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/virginia-military-institute_50x50.jpg",
        "num_depts": 32,
        "name": "Virginia Military Institute",
        "num_emails": 0,
        "num_courses": 772,
        "variations": "moe the kangaroo keydets vmi",
        "longitude": "-79.4352256",
        "courses_sanitized": false,
        "popular_courses": [
            "CH 137",
            "EE 222",
            "BU 471",
            "CS 121",
            "PH 202",
            "EN 102",
            "MA 307",
            "SP 202",
            "HI 103",
            "PO 201",
            "CHEM 137",
            "HIST 101",
            "BIO 101",
            "CE 333",
            "EC 201",
            "ME 203",
            "PS 344"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/4/44/UMiamiSeal.svg"
    },
    {
        "school_casual_name": null,
        "school_color_one": "#40484B",
        "banner_url": "https://farm8.staticflickr.com/7242/14070186173_d73139edde_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 70,
        "school_tiny_name": "UWM",
        "id": 113,
        "city": "Madison",
        "num_popular_courses": 2157,
        "state": "WI",
        "latitude": "43.076592",
        "population": 42269,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": "Wisc",
        "seal_url": null,
        "school_mascot_name": "Bucky Badger",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-wisconsin-madison_50x50.jpg",
        "num_depts": 377,
        "name": "University of Wisconsin-Madison",
        "num_emails": 25694,
        "num_courses": 22481,
        "variations": " uwm",
        "longitude": "-89.4124875",
        "courses_sanitized": true,
        "popular_courses": [
            "SOC 160",
            "NS 132",
            "NUTRISCI 132",
            "MKT 440",
            "PSYCH 450",
            "NUTRI 132",
            "ECON 330",
            "HIST 460",
            "MUSIC 42",
            "BACT 101",
            "GEO 107",
            "MATH 321",
            "ILS 252",
            "IB 200",
            "CS 354",
            "GWS 103",
            "ENT 302",
            "MSE 350",
            "GB 303",
            "FS 120"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/ru/e/ed/UW-Madison_logo.svg"
    },
    {
        "school_casual_name": "Tigers",
        "school_color_one": "#FFA500",
        "banner_url": "https://farm8.staticflickr.com/7263/13192503784_853a5e065e_b.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 80,
        "school_tiny_name": "OCC",
        "id": 1056,
        "city": "Los angeles",
        "num_popular_courses": 223,
        "state": "CA",
        "latitude": "34.126615",
        "population": 2178,
        "website": "www.oxy.edu",
        "banner_url_confirmed": false,
        "short_name": "Oxy",
        "seal_url": "https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/Occidental_College_Seal_-_Transparent.png/64px-Occidental_College_Seal_-_Transparent.png",
        "school_mascot_name": "Oswald the Tiger",
        "school_color_light": "#FFA500",
        "departments_sanitized": true,
        "school_color_dark": "black",
        "school_color_primary": null,
        "school_color_two": "black",
        "forbes_url": null,
        "logo_url": "https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/Occidental_College_Seal_-_Transparent.png/64px-Occidental_College_Seal_-_Transparent.png",
        "num_depts": 45,
        "name": "Occidental College",
        "num_emails": 0,
        "num_courses": 1057,
        "variations": "oswald the tiger tigers oc oxy",
        "longitude": "-118.212392",
        "courses_sanitized": true,
        "popular_courses": [
            "HIST 151",
            "CTSJ 180",
            "CHEM 130",
            "BIO 240",
            "ECON 272",
            "ARAB 101",
            "UEP 301",
            "THEA 110",
            "CSP 11",
            "MATH 128",
            "AMST 295",
            "ENWR 201",
            "PHYS 106",
            "GEO 150",
            "RELS 150",
            "SPAN 202",
            "ARTS 103",
            "SOC 205",
            "ARTH 170",
            "ARTF 146"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Mariners",
        "school_color_one": "#0247FE",
        "banner_url": "https://farm8.staticflickr.com/7577/16136329807_0a3ec813d8_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 211,
        "school_tiny_name": "USMM",
        "id": 1208,
        "city": "Great neck",
        "num_popular_courses": 32,
        "state": "NY",
        "latitude": "40.8122336",
        "population": 1012,
        "website": "www.usmma.edu",
        "banner_url_confirmed": false,
        "short_name": "Merchant Marine, Kings Point",
        "seal_url": "//upload.wikimedia.org/wikipedia/commons/thumb/0/07/United_States_Merchant_Marine_Academy_seal.png/220px-United_States_Merchant_Marine_Academy_seal.png",
        "school_mascot_name": "Salty the Sea Eagle",
        "school_color_light": "#0247FE",
        "departments_sanitized": true,
        "school_color_dark": "#666666",
        "school_color_primary": null,
        "school_color_two": "#666666",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/united-states-merchant-marine-academy_50x50.jpg",
        "num_depts": 27,
        "name": "United States Merchant Marine Academy",
        "num_emails": 0,
        "num_courses": 218,
        "variations": "salty the sea eagle mariners usmma merchant marine, kings point",
        "longitude": "-73.7624723",
        "courses_sanitized": false,
        "popular_courses": [
            "DN 420",
            "EE 401",
            "KP 100",
            "CO 2",
            "ES 100",
            "MP 101",
            "LEAD 101",
            "DB 210",
            "HH 100",
            "HP 101",
            "MC 300",
            "MM 101",
            "EG 100",
            "CALC 1",
            "NA 110",
            "EM 100",
            "ME 101",
            "PHYS 11",
            "DRILL 000",
            "CH 100"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Case Western",
        "school_color_one": "#184c8c",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/d/d2/Case_Western_University_sky.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 127,
        "school_tiny_name": "CW",
        "id": 1400,
        "city": "Cleveland",
        "num_popular_courses": 603,
        "state": "OH",
        "latitude": "41.5043413",
        "population": 10026,
        "website": "www.case.edu",
        "banner_url_confirmed": true,
        "short_name": "Case Western",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/0/08/Case_Western_Reserve_University_seal.svg/200px-Case_Western_Reserve_University_seal.svg.png",
        "school_mascot_name": "spartan",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#184c8c",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/case-western-reserve-university_50x50.jpg",
        "num_depts": 9,
        "name": "Case Western Reserve University",
        "num_emails": 1417,
        "num_courses": 807,
        "variations": "spartans[5] cwru reserve",
        "longitude": "-81.6083838",
        "courses_sanitized": true,
        "popular_courses": [
            "COGS 102",
            "EMAC 270",
            "PSCL 230",
            "EBME 202",
            "EECS 132",
            "MATH 303",
            "PHIL 201",
            "ECON 307",
            "BETH 271",
            "EMAE 172",
            "MAND 420",
            "ENGL 367",
            "ECHE 360",
            "MKMR 403",
            "BIOL 116",
            "ENGR 200",
            "PHYS 124",
            "STAT 332",
            "CALC 2",
            "FSNA 116"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/0/08/Case_Western_Reserve_University_seal.svg"
    },
    {
        "school_casual_name": "UT Martin",
        "school_color_one": "#FDF9D8",
        "banner_url": "https://farm4.staticflickr.com/3191/2916429415_07266e9154_o.jpg",
        "sp16_start": "Thu, 14 Jan 2016 00:00:00 -0000",
        "rank": 53,
        "school_tiny_name": "UT-M",
        "id": 1338,
        "city": "Martin",
        "num_popular_courses": 6,
        "state": "TN",
        "latitude": "36.3417954",
        "population": 7025,
        "website": "www.utm.edu",
        "banner_url_confirmed": true,
        "short_name": "UT Martin",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/9/9f/University_of_Tennessee_seal.png",
        "school_mascot_name": "skyhawk",
        "school_color_light": "#FDF9D8",
        "departments_sanitized": true,
        "school_color_dark": "#000080",
        "school_color_primary": null,
        "school_color_two": "#000080",
        "forbes_url": null,
        "logo_url": "//upload.wikimedia.org/wikipedia/en/9/9f/University_of_Tennessee_seal.png",
        "num_depts": 112,
        "name": "University of Tennessee, Martin",
        "num_emails": 0,
        "num_courses": 2516,
        "variations": "skyhawks ut martin utm",
        "longitude": "-88.8648062",
        "courses_sanitized": false,
        "popular_courses": [
            "COM 230",
            "ZOOLOGY 251",
            "SPANISH 115"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Tigers",
        "school_color_one": "#000000",
        "banner_url": "https://farm1.staticflickr.com/168/444949876_810b0932f7_z.jpg",
        "sp16_start": "Mon, 29 Aug 2016 00:00:00 -0000",
        "rank": 51,
        "school_tiny_name": "CC",
        "id": 181,
        "city": "Colorado spgs",
        "num_popular_courses": 131,
        "state": "CO",
        "latitude": "38.8484298",
        "population": 2022,
        "website": "www.coloradocollege.edu",
        "banner_url_confirmed": false,
        "short_name": "CC",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/e/e6/Colorado_College_seal.png/200px-Colorado_College_seal.png",
        "school_mascot_name": "Prowler",
        "school_color_light": "#F59C00",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#F59C00",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/colorado-college_50x50.jpg",
        "num_depts": 45,
        "name": "Colorado College",
        "num_emails": 0,
        "num_courses": 1573,
        "variations": "tigers cc",
        "longitude": "-104.8228753",
        "courses_sanitized": true,
        "popular_courses": [
            "RU 101",
            "ED 220",
            "BY 100",
            "AS 103",
            "FS 215",
            "SW 175",
            "GY 130",
            "AN 102",
            "EN 259",
            "JA 101",
            "SO 116",
            "PY 100",
            "CH 251",
            "PS 209",
            "CO 100",
            "HY 109",
            "FE 120",
            "MU 222",
            "MA 126",
            "EC 152"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": null,
        "school_color_one": "#40484B",
        "banner_url": "https://farm4.staticflickr.com/3752/11423415545_f941425e97_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 205,
        "school_tiny_name": "CC",
        "id": 1443,
        "city": "Helena",
        "num_popular_courses": 26,
        "state": "MT",
        "latitude": "46.6008648",
        "population": 1463,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Halo",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/carroll-college_50x50.jpg",
        "num_depts": 54,
        "name": "Carroll College",
        "num_emails": 0,
        "num_courses": 636,
        "variations": " cc",
        "longitude": "-112.0391321",
        "courses_sanitized": false,
        "popular_courses": [
            "ENWR 102",
            "SOC 101",
            "CO 289",
            "CHEM 101",
            "ART 112",
            "FR 101",
            "MA 121",
            "TH 101",
            "BIO 202",
            "PHIL 118",
            "COM 101",
            "EN 102",
            "SP 204",
            "CH 101",
            "PHYS 201",
            "PO 115",
            "PSY 105"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Red Devils",
        "school_color_one": "red",
        "banner_url": "https://farm4.staticflickr.com/3827/11996676325_d34ffa1fb4_z.jpg",
        "sp16_start": "Mon, 29 Aug 2016 00:00:00 -0000",
        "rank": 88,
        "school_tiny_name": "D",
        "id": 1365,
        "city": "Carlisle",
        "num_popular_courses": 239,
        "state": "PA",
        "latitude": "40.2022641",
        "population": 2386,
        "website": "dickinson.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": null,
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "red",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/dickinson-college_50x50.jpg",
        "num_depts": 119,
        "name": "Dickinson College",
        "num_emails": 0,
        "num_courses": 2600,
        "variations": "red devils dc",
        "longitude": "-77.2007682",
        "courses_sanitized": true,
        "popular_courses": [
            "IBM 220",
            "HIST 254",
            "BIO 125",
            "INBM 220",
            "PHIL 111",
            "POSC 120",
            "PSYCH 110",
            "GEO 101",
            "GEOL 101",
            "MATH 225",
            "CHEM 242",
            "ACCT 220",
            "ECON 100",
            "ITAL 101",
            "PSYC 165",
            "FR 230",
            "COSCI 131",
            "IBNM 200",
            "ENVST 132",
            "ARCH 223"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/3/31/Dickinson_College_seal.svg"
    },
    {
        "school_casual_name": "W&L",
        "school_color_one": "#003399",
        "banner_url": "https://farm4.staticflickr.com/3224/3019690857_e294ccccd3_o.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 33,
        "school_tiny_name": "W&L",
        "id": 1427,
        "city": "Lexington",
        "num_popular_courses": 256,
        "state": "VA",
        "latitude": "37.7915097",
        "population": 2302,
        "website": "www.wlu.edu",
        "banner_url_confirmed": true,
        "short_name": "W&L",
        "seal_url": null,
        "school_mascot_name": "general",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#003399",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/washington-and-lee-university_50x50.jpg",
        "num_depts": 77,
        "name": "Washington and Lee University",
        "num_emails": 0,
        "num_courses": 998,
        "variations": "the generals w&l",
        "longitude": "-79.4445139",
        "courses_sanitized": true,
        "popular_courses": [
            "ECON 210",
            "REL 103",
            "PHIL 141",
            "BUS 221",
            "LACS 101",
            "PSYCH 114",
            "ARTH 180",
            "ENGN 207",
            "POL 201",
            "PSYC 150",
            "CHEM 111",
            "MUS 120",
            "BIO 220",
            "POV 101",
            "FRENCH 111",
            "HIST 109",
            "CHIN 111",
            "ENGL 261",
            "SPAN 211",
            "NEUR 120"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "ncsu",
        "school_color_one": "#FF0000",
        "banner_url": "https://internationallife.files.wordpress.com/2008/06/old-well-005.jpg",
        "sp16_start": "Wed, 06 Jan 2016 00:00:00 -0000",
        "rank": 167,
        "school_tiny_name": "NCSU",
        "id": 188,
        "city": "Raleigh",
        "num_popular_courses": 620,
        "state": "NC",
        "latitude": "35.7846633",
        "population": 34340,
        "website": "www.ncsu.edu",
        "banner_url_confirmed": true,
        "short_name": "NC State",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/d/db/NC_State_Seal.svg/175px-NC_State_Seal.svg.png",
        "school_mascot_name": "Wolfpack",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#FF0000",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/north-carolina-state-university-at-raleigh_50x50.jpg",
        "num_depts": 155,
        "name": "North Carolina State University",
        "num_emails": 0,
        "num_courses": 4884,
        "variations": "wolfpack nc state university ncsu",
        "longitude": "-78.6820946",
        "courses_sanitized": true,
        "popular_courses": [
            "ARE 306",
            "E 115",
            "ENT 201",
            "MIE 201",
            "NTR 301",
            "PHI 340",
            "CH 100",
            "STS 323",
            "GN 301",
            "BIO 212",
            "CSC 573",
            "FL 222",
            "FS 201",
            "PS 362",
            "ANT 254",
            "HS 100",
            "BCH 351",
            "FLS 101",
            "MSE 200",
            "HSS 120"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": null,
        "school_color_one": "#40484B",
        "banner_url": "https://farm8.staticflickr.com/7457/9906904856_1ee86fee2f_z.jpg",
        "sp16_start": "Sat, 16 Jan 2016 00:00:00 -0000",
        "rank": 175,
        "school_tiny_name": "WC",
        "id": 1492,
        "city": "Norton",
        "num_popular_courses": 149,
        "state": "MA",
        "latitude": "41.8685135",
        "population": 1616,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Stertorous Tor Thunder",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/wheaton-college-ma_50x50.jpg",
        "num_depts": 62,
        "name": "Wheaton College",
        "num_emails": 0,
        "num_courses": 2421,
        "variations": " wc",
        "longitude": "-88.099602",
        "courses_sanitized": true,
        "popular_courses": [
            "COMP 115",
            "PSY 247",
            "HIST 102",
            "ENG 376",
            "BIO 112",
            "FR 221",
            "SOC 190",
            "MATH 221",
            "PHIL 101",
            "MACRO 101",
            "REL 277",
            "POLS 298",
            "PHILO 101",
            "CHEM 153",
            "ART 101",
            "LATIN 101",
            "SEM 400",
            "PHYS 171",
            "ECON 222",
            "THEA 275"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Camels",
        "school_color_one": "#024990",
        "banner_url": "https://farm4.staticflickr.com/3015/3444405927_a2692d6442_z.jpg",
        "sp16_start": "Thu, 21 Jan 2016 00:00:00 -0000",
        "rank": 84,
        "school_tiny_name": "Conn",
        "id": 966,
        "city": "New london",
        "num_popular_courses": 70,
        "state": "CT",
        "latitude": "41.3786877",
        "population": 1933,
        "website": "official website",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/b/bb/Conncoll_seal.gif/175px-Conncoll_seal.gif",
        "school_mascot_name": "Camel",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#024990",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/connecticut-college_50x50.jpg",
        "num_depts": 126,
        "name": "Connecticut College",
        "num_emails": 0,
        "num_courses": 4914,
        "variations": "camel camels cc",
        "longitude": "-72.1045869",
        "courses_sanitized": true,
        "popular_courses": [
            "ENG 104",
            "PHY 111",
            "ART 106",
            "LIN 103",
            "FYS 106",
            "HIS 237",
            "COM 114",
            "FRE 103",
            "ITL 401",
            "BOT 200",
            "HIST 107",
            "MATH 107",
            "LING 103",
            "ES 494",
            "GER 210",
            "GOV 323",
            "REL 244",
            "CHEM 104",
            "HST 113",
            "SOC 403"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Yeomen / Yeowomen",
        "school_color_one": "#990033",
        "banner_url": "https://farm9.staticflickr.com/8661/16105151564_5be10cfa74_z.jpg",
        "sp16_start": null,
        "rank": 43,
        "school_tiny_name": "OC",
        "id": 1508,
        "city": "Oberlin",
        "num_popular_courses": 410,
        "state": "OH",
        "latitude": "41.2923124",
        "population": 2944,
        "website": "home.oberlin.eduoberlin collegeu.s. national register of historic placesu.s. national historic landmarklocationtappan square, oberlin, ohioarea440 acres (178.1\\u00a0ha)built1833governing bodyprivatenrhp\\u00a0reference\\u00a0#66000615[4]added to nrhpoctober 15, 1966",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/5/5c/Oberlin_College_Seal.png",
        "school_mascot_name": null,
        "school_color_light": "#FFB310",
        "departments_sanitized": true,
        "school_color_dark": "#990033",
        "school_color_primary": null,
        "school_color_two": "#FFB310",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/oberlin-college_50x50.jpg",
        "num_depts": 84,
        "name": "Oberlin College",
        "num_emails": 0,
        "num_courses": 3348,
        "variations": "yeomen / yeowomen oc",
        "longitude": "-82.2164729",
        "courses_sanitized": true,
        "popular_courses": [
            "POLT 105",
            "CHEM 205",
            "HISP 101",
            "PHIL 121",
            "FYSP 187",
            "PSYC 200",
            "NSCI 204",
            "GEOL 161",
            "HIST 101",
            "CMPL 200",
            "ECON 251",
            "SOCI 125",
            "AAST 101",
            "ANTH 103",
            "ASTR 100",
            "MATH 234",
            "RELG 233",
            "THEA 100",
            "ARTS 206",
            "ITAL 101"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "LSU",
        "school_color_one": "#45217A",
        "banner_url": "https://farm1.staticflickr.com/28/47137952_a11b8d70dc_z.jpg",
        "sp16_start": "Wed, 13 Jan 2016 00:00:00 -0000",
        "rank": 190,
        "school_tiny_name": "LS",
        "id": 1493,
        "city": "Baton rouge",
        "num_popular_courses": 55,
        "state": "LA",
        "latitude": "30.4132579",
        "population": 30225,
        "website": "www.lsu.edu",
        "banner_url_confirmed": false,
        "short_name": "Louisiana State",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/4/40/Louisiana_State_University_%28seal%29.png",
        "school_mascot_name": "tiger",
        "school_color_light": "#FCCF3B",
        "departments_sanitized": true,
        "school_color_dark": "#45217A",
        "school_color_primary": null,
        "school_color_two": "#FCCF3B",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/louisiana-state-university-and-agricultural-mechanical-college_50x50.jpg",
        "num_depts": 113,
        "name": "Louisiana State University",
        "num_emails": 0,
        "num_courses": 6698,
        "variations": "tigers and lady tigers lsu lsu",
        "longitude": "-91.1800023",
        "courses_sanitized": false,
        "popular_courses": [
            "PSYCH 3050",
            "BIO 1002",
            "ART 1440",
            "CH 108",
            "ENGLISH 2000",
            "PSYC 3",
            "CHEM 12011202",
            "PSYCHOLOGY 2000",
            "MUSIC 2000",
            "BIOLOGY 1001",
            "BIOL 1",
            "ENGL 1002",
            "ENG 2012",
            "MUSC 1751",
            "MGMT 3200",
            "MASS 2000",
            "THEAT 1001",
            "ASTR 1001",
            "HISTORY 1001",
            "GEOG 1"
        ],
        "svg_url": "https://www.math.lsu.edu/nt2014/LSU_text_logo.svg"
    },
    {
        "school_casual_name": "kzoo",
        "school_color_one": "#000000",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/0/0d/Hoben_Hall.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 111,
        "school_tiny_name": "K",
        "id": 2550,
        "city": "Kalamazoo",
        "num_popular_courses": 302,
        "state": "MI",
        "latitude": "42.2903036",
        "population": 1379,
        "website": "www.kzoo.edu",
        "banner_url_confirmed": true,
        "short_name": "Kalamazoo",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/d/dc/Kcollegeseal.png",
        "school_mascot_name": "Hornet",
        "school_color_light": "#e17000",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "black",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/kalamazoo-college_50x50.jpg",
        "num_depts": 35,
        "name": "Kalamazoo College",
        "num_emails": 0,
        "num_courses": 817,
        "variations": "hornet hornets kc",
        "longitude": "-85.6018965",
        "courses_sanitized": true,
        "popular_courses": [
            "ENG 206",
            "HUM 200",
            "HCR 120",
            "MATH 216",
            "SOC 205",
            "ECO 201",
            "LEN 102",
            "BIO 104",
            "PHI 100",
            "CHEM 120",
            "TRS 105",
            "MUS 101",
            "ECON 202",
            "BUS 160",
            "HRY 212",
            "PSY 190",
            "CIS 115",
            "PHY 124",
            "WPE 177",
            "ART 105"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "MSU",
        "school_color_one": "#006B42",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/a/a2/MSU_Beaumont_Tower_1.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 169,
        "school_tiny_name": "MSU",
        "id": 1503,
        "city": "East lansing",
        "num_popular_courses": 437,
        "state": "MI",
        "latitude": "42.701848",
        "population": 48783,
        "website": "www.msu.edu",
        "banner_url_confirmed": true,
        "short_name": "MSU",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/60/MSU_Seal_2010.svg/200px-MSU_Seal_2010.svg.png",
        "school_mascot_name": "spartan",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#006B42",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/michigan-state-university_50x50.jpg",
        "num_depts": 196,
        "name": "Michigan State University",
        "num_emails": 1904,
        "num_courses": 707,
        "variations": "spartans msu msu",
        "longitude": "-84.4821719",
        "courses_sanitized": true,
        "popular_courses": [
            "ACC 201",
            "COM 100",
            "CSE 131",
            "ANS 110",
            "GEO 204",
            "KIN 173",
            "EC 202",
            "PSL 250",
            "PLS 170",
            "MSE 454",
            "FW 100",
            "WRA 008",
            "MSC 300",
            "CEP 930",
            "ECON 201",
            "MUS 114",
            "ME 180",
            "MTH 116",
            "ZOL 328",
            "CAS 110"
        ],
        "svg_url": "https://msu.edu/_files/images/rwd2014/masthead-helmet-white.svg"
    },
    {
        "school_casual_name": "Pioneers",
        "school_color_one": "#FF2400",
        "banner_url": "https://farm4.staticflickr.com/3251/2373398560_8b610a9aec_z.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 58,
        "school_tiny_name": "GC",
        "id": 1661,
        "city": "Grinnell",
        "num_popular_courses": 239,
        "state": "IA",
        "latitude": "41.7508439",
        "population": 1674,
        "website": "grinnell.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": null,
        "school_color_light": "#FF2400",
        "departments_sanitized": true,
        "school_color_dark": "black",
        "school_color_primary": null,
        "school_color_two": "black",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/grinnell-college_50x50.jpg",
        "num_depts": 39,
        "name": "Grinnell College",
        "num_emails": 0,
        "num_courses": 792,
        "variations": "pioneers gc",
        "longitude": "-92.7191666",
        "courses_sanitized": true,
        "popular_courses": [
            "ECN 233",
            "POL 250",
            "FRN 221",
            "ANT 101",
            "PSY 214",
            "SOC 265",
            "MAT 209",
            "ENG 224",
            "Art 140",
            "EDU 101",
            "GRE 101",
            "HIS 105",
            "HUM 295",
            "ARB 101",
            "PHY 132",
            "AMS 130",
            "CSC 161",
            "MUS 116",
            "SPAN 217",
            "THE 117"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "hope",
        "school_color_one": "#f46a1f",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/0/0f/HopeDimnentChapel9.jpg",
        "sp16_start": "Sat, 09 Jan 2016 00:00:00 -0000",
        "rank": 172,
        "school_tiny_name": "HC",
        "id": 1718,
        "city": "Holland",
        "num_popular_courses": 266,
        "state": "MI",
        "latitude": "42.7873976",
        "population": 3343,
        "website": "www.hope.edu",
        "banner_url_confirmed": true,
        "short_name": "Hope",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/1/10/Hope_College_seal.png",
        "school_mascot_name": "flying dutch",
        "school_color_light": "#f46a1f",
        "departments_sanitized": true,
        "school_color_dark": "#002244",
        "school_color_primary": null,
        "school_color_two": "#002244",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/hope-college_50x50.jpg",
        "num_depts": 50,
        "name": "Hope College",
        "num_emails": 0,
        "num_courses": 1005,
        "variations": "flying dutchmen[2]flying dutch hc",
        "longitude": "-86.0999876",
        "courses_sanitized": true,
        "popular_courses": [
            "BIO 280",
            "REL 100",
            "HIST 207",
            "PHIL 230",
            "MGMT 100",
            "KIN 383",
            "LATIN 171",
            "PSY 200",
            "SPAN 221",
            "POL 151",
            "IDS 200",
            "SWK 232",
            "ENG 248",
            "MUS 192",
            "PSYC 321",
            "COMM 151",
            "GEMS 153",
            "GERM 311",
            "PSYCH 321",
            "MIN 201"
        ],
        "svg_url": "http://wikipediaexplorer.com/static/images/wikipedia/en/thumb/5/58/236px-Hope_College_wordmark.svg.png"
    },
    {
        "school_casual_name": "(\"Columbia University\",columbia)",
        "school_color_one": "#75AADB",
        "banner_url": "https://farm6.staticflickr.com/5306/5563467708_8e9380c6d6_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 20,
        "school_tiny_name": "C",
        "id": 1146,
        "city": "New york",
        "num_popular_courses": 120,
        "state": "NY",
        "latitude": "40.8075355",
        "population": 26471,
        "website": "www.columbia.edu",
        "banner_url_confirmed": false,
        "short_name": "Columbia",
        "seal_url": null,
        "school_mascot_name": "Columbia Lions",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#75AADB",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/columbia-university-in-the-city-of-new-york_50x50.jpg",
        "num_depts": 127,
        "name": "Columbia University",
        "num_emails": 22468,
        "num_courses": 2096,
        "variations": "columbia lions cu",
        "longitude": "-73.9625727",
        "courses_sanitized": true,
        "popular_courses": [
            "ARE 101",
            "ARC 101",
            "ROBIN 101",
            "ECON 305",
            "ENG 1009",
            "COS 126",
            "NURS 5270",
            "LEED 101",
            "ARCT 101",
            "ARCHITECTURE 101",
            "HIST 101",
            "MTH 4657",
            "FINC 9301",
            "PSYCH 1010",
            "ARCHI 101",
            "INAF 4600",
            "SOC 101",
            "BMEN 4894",
            "ADVOC 7103",
            "U 8213"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/a/a6/Columbia_University_Shield.svg"
    },
    {
        "school_casual_name": "(\"Hampshire College\",hampshire)",
        "school_color_one": "purple",
        "banner_url": "https://farm9.staticflickr.com/8870/17339502026_f4e48ebfdc_z.jpg",
        "sp16_start": "Sat, 16 Jan 2016 00:00:00 -0000",
        "rank": 110,
        "school_tiny_name": "HC",
        "id": 1720,
        "city": "Amherst",
        "num_popular_courses": 89,
        "state": "MA",
        "latitude": "42.326348",
        "population": 1461,
        "website": "hampshire.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/4/44/HampshireCollegeSeal.png/200px-HampshireCollegeSeal.png",
        "school_mascot_name": null,
        "school_color_light": "blue",
        "departments_sanitized": true,
        "school_color_dark": "purple",
        "school_color_primary": null,
        "school_color_two": "blue",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/hampshire-college_50x50.jpg",
        "num_depts": 36,
        "name": "Hampshire College",
        "num_emails": 0,
        "num_courses": 365,
        "variations": " hc",
        "longitude": "-72.5328326",
        "courses_sanitized": true,
        "popular_courses": [
            "SS 110",
            "IA 236",
            "CS 117",
            "PHOTO 1",
            "NS 101",
            "HIST 118",
            "HACU 244",
            "CSI 239",
            "ORGO 1",
            "MUSIC 101",
            "ASL 1",
            "IMA 1",
            "VIDEO 1",
            "LS 0123",
            "PSYCH 0186",
            "ARCH 1",
            "SPAN 201",
            "QMECH 183",
            "SOC 101",
            "DRAWING 101"
        ],
        "svg_url": "http://www.unh.edu/sites/all/themes/custom/unh7_2b/images/logo.svg"
    },
    {
        "school_casual_name": "USF",
        "school_color_one": "#00543C",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/8/8b/Gleeson_Library_atrium,_interior.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 214,
        "school_tiny_name": "USF",
        "id": 63,
        "city": "San francisco",
        "num_popular_courses": 2160,
        "state": "CA",
        "latitude": "37.7757492",
        "population": 10040,
        "website": null,
        "banner_url_confirmed": true,
        "short_name": "USF",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/5/5e/USFseal1.png/200px-USFseal1.png",
        "school_mascot_name": "don",
        "school_color_light": "#FDBB30",
        "departments_sanitized": null,
        "school_color_dark": "#00543C",
        "school_color_primary": null,
        "school_color_two": "#FDBB30",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-san-francisco_50x50.jpg",
        "num_depts": 138,
        "name": "University of San Francisco",
        "num_emails": 0,
        "num_courses": 6324,
        "variations": " usf usfca",
        "longitude": "-122.4503856",
        "courses_sanitized": true,
        "popular_courses": [
            "LABR 251",
            "PSYCH 200",
            "SXS 400",
            "HH 380",
            "HMSX 320",
            "SS 105",
            "PSY 450",
            "BIO 330",
            "CW 512",
            "MUS 512",
            "PHIL 383",
            "PLS 310",
            "DAI 324",
            "REC 380",
            "SOC 400",
            "IBUS 592",
            "ENGR 101",
            "JAPN 200",
            "BECA 460",
            "AAS 456"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/a/af/Flag_of_San_Francisco.svg"
    },
    {
        "school_casual_name": "Brewers",
        "school_color_one": "#8B0000",
        "banner_url": "https://farm1.staticflickr.com/21/30954442_5bb55db04a_b.jpg",
        "sp16_start": "Wed, 27 Jan 2016 00:00:00 -0000",
        "rank": 26,
        "school_tiny_name": "V",
        "id": 1729,
        "city": "Poughkeepsie",
        "num_popular_courses": 299,
        "state": "NY",
        "latitude": "41.686662",
        "population": 2406,
        "website": "www.vassar.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/b/b8/Vassar_College_Seal.png/200px-Vassar_College_Seal.png",
        "school_mascot_name": "The Brewer[5]",
        "school_color_light": "#DCDCDC",
        "departments_sanitized": true,
        "school_color_dark": "#8B0000",
        "school_color_primary": null,
        "school_color_two": "#DCDCDC",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/vassar-college_50x50.jpg",
        "num_depts": 77,
        "name": "Vassar College",
        "num_emails": 0,
        "num_courses": 3888,
        "variations": "the brewer[5] brewers vc",
        "longitude": "-73.894944",
        "courses_sanitized": true,
        "popular_courses": [
            "PHIL 110",
            "RELI 150",
            "ENGL 170",
            "HIST 123",
            "PHYS 200",
            "ECON 238",
            "EDUC 160",
            "POLI 170",
            "ASTR 105",
            "PSYC 253",
            "MEDS 160",
            "AMCL 105",
            "BIOL 202",
            "FILM 392",
            "URBS 200",
            "ANTH 140",
            "ART 236",
            "CHEM 245",
            "CHIN 105",
            "COGS 110"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "rochester",
        "school_color_one": "#40484B",
        "banner_url": "https://farm7.staticflickr.com/6034/6221471226_413a12e379_b.jpg",
        "sp16_start": "Wed, 13 Jan 2016 00:00:00 -0000",
        "rank": 62,
        "school_tiny_name": "UR",
        "id": 1785,
        "city": "Rochester",
        "num_popular_courses": 218,
        "state": "NY",
        "latitude": "43.1305531",
        "population": 10510,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": "Rochester",
        "seal_url": null,
        "school_mascot_name": "yellow jacket",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-rochester_50x50.jpg",
        "num_depts": 174,
        "name": "University Of Rochester",
        "num_emails": 0,
        "num_courses": 3275,
        "variations": " uor",
        "longitude": "-77.6260033",
        "courses_sanitized": true,
        "popular_courses": [
            "BIO 111",
            "STT 211",
            "PSY 181",
            "CHE 243",
            "PHY 143",
            "ENG 135",
            "PSC 240",
            "REL 106",
            "CSC 108",
            "ECE 210",
            "ECO 236",
            "LIN 105",
            "EES 201",
            "HIS 100",
            "OPT 241",
            "CHM 204",
            "IT 102",
            "AH 100",
            "BME 210",
            "FR 153"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/c/c8/University_of_Rochester_seal.svg"
    },
    {
        "school_casual_name": "Lyons",
        "school_color_one": "#0180C3",
        "banner_url": "https://farm4.staticflickr.com/3085/2553957002_ed38b392a1_b.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 97,
        "school_tiny_name": "MoHo",
        "id": 1756,
        "city": "South hadley",
        "num_popular_courses": 571,
        "state": "MA",
        "latitude": "42.2579399",
        "population": 2347,
        "website": "mtholyoke.edu",
        "banner_url_confirmed": false,
        "short_name": "MoHo",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/69/MountHolyokeSeal.png/200px-MountHolyokeSeal.png",
        "school_mascot_name": "Paws",
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "#0180C3",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/mount-holyoke-college_50x50.jpg",
        "num_depts": 47,
        "name": "Mount Holyoke College",
        "num_emails": 0,
        "num_courses": 1613,
        "variations": "lyons mhc moho",
        "longitude": "-72.5763912",
        "courses_sanitized": true,
        "popular_courses": [
            "GEO 105",
            "GEOG 106",
            "ECON 215",
            "HIST 120",
            "LATAM 180",
            "PHIL 201",
            "BIO 151",
            "POL 106",
            "PSYCH 250",
            "FREN 230",
            "CHEM 202",
            "ENG 102",
            "EC 215",
            "PHYS 103",
            "REL 250",
            "ASIAN 222",
            "ED 205",
            "ARTH 110",
            "ASTR 100",
            "GEOL 201"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": null,
        "school_color_one": "#40484B",
        "banner_url": "https://farm9.staticflickr.com/8155/7179698254_11811bfbe1_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 11,
        "school_tiny_name": "HC",
        "id": 1839,
        "city": "Haverford",
        "num_popular_courses": 31,
        "state": "PA",
        "latitude": "40.0078604",
        "population": 1205,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Black Squirrel",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/haverford-college_50x50.jpg",
        "num_depts": 38,
        "name": "Haverford College",
        "num_emails": 0,
        "num_courses": 708,
        "variations": " hc",
        "longitude": "-75.3062377",
        "courses_sanitized": false,
        "popular_courses": [
            "SOC 101",
            "SPAN 101",
            "ECON 203",
            "MATH 215",
            "HIST 101",
            "PHIL 109",
            "PSYCH 260",
            "PHYS 303",
            "MUSIC 111",
            "PSYC 101",
            "CSTS 119",
            "ENG 202",
            "PEAC 101",
            "CHEM 100",
            "ENGL 150",
            "PSY 238",
            "BIOL 221",
            "JNSEH 001"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "samford",
        "school_color_one": "#C4161D",
        "banner_url": "https://farm5.staticflickr.com/4063/4515927995_a5f8d0ac93_o.jpg",
        "sp16_start": "Sun, 03 Jan 2016 00:00:00 -0000",
        "rank": 203,
        "school_tiny_name": "Sam",
        "id": 1745,
        "city": "Birmingham",
        "num_popular_courses": 174,
        "state": "AL",
        "latitude": "33.4645529",
        "population": 4758,
        "website": "www.samford.edu",
        "banner_url_confirmed": true,
        "short_name": "Samford",
        "seal_url": null,
        "school_mascot_name": "bulldog",
        "school_color_light": "#C4161D",
        "departments_sanitized": true,
        "school_color_dark": "#002649",
        "school_color_primary": null,
        "school_color_two": "#002649",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/samford-university_50x50.jpg",
        "num_depts": 139,
        "name": "Samford University",
        "num_emails": 0,
        "num_courses": 3679,
        "variations": "bulldogs su",
        "longitude": "-86.7946088",
        "courses_sanitized": true,
        "popular_courses": [
            "JRNL 105",
            "ACCT 211",
            "PSYC 205",
            "BUSA 100",
            "PHIL 241",
            "MATH 240",
            "PHED 231",
            "PHYS 150",
            "RELG 201",
            "ECON 202",
            "MNGT 303",
            "BIOL 225",
            "SPAN 201",
            "JMC 202",
            "GEO 101",
            "CHEM 205",
            "COMS 205",
            "UCCA 102",
            "UCCP 101",
            "MPPG 123"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "duke",
        "school_color_one": "#0736A4",
        "banner_url": "https://farm3.staticflickr.com/2335/5744250215_18e6f1e0f4_o.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 23,
        "school_tiny_name": "Duke",
        "id": 1856,
        "city": "Durham",
        "num_popular_courses": 949,
        "state": "NC",
        "latitude": "41.9197689",
        "population": 15386,
        "website": "www.duke.edu",
        "banner_url_confirmed": true,
        "short_name": "Duke",
        "seal_url": null,
        "school_mascot_name": "Blue Devil",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#0736A4",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/duke-university_50x50.jpg",
        "num_depts": 202,
        "name": "Duke University",
        "num_emails": 0,
        "num_courses": 5866,
        "variations": "blue devils du",
        "longitude": "-91.649501",
        "courses_sanitized": true,
        "popular_courses": [
            "CHEM 101",
            "BIO 46",
            "ENV 811",
            "PSY 11",
            "EGR 103",
            "LING 102",
            "ECON 157",
            "CS 201",
            "COMPSCI 101",
            "MUSIC 74",
            "BME 110",
            "ECE 64",
            "STAT 111",
            "PUBPOL 182",
            "SOC 164",
            "EOS 41",
            "REL 129",
            "NEURO 277",
            "MATH 106",
            "CPS 108"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "transy",
        "school_color_one": "#990000",
        "banner_url": "https://farm4.staticflickr.com/3310/3245594440_2bbf292c37_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 184,
        "school_tiny_name": "TU",
        "id": 2096,
        "city": "Lexington",
        "num_popular_courses": 50,
        "state": "KY",
        "latitude": "38.052156",
        "population": 1074,
        "website": "http://www.transy.edu/",
        "banner_url_confirmed": false,
        "short_name": "Transylvania",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/3/34/Transylvania_University_seal.png/200px-Transylvania_University_seal.png",
        "school_mascot_name": "pioneer",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#990000",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/transylvania-university_50x50.jpg",
        "num_depts": 42,
        "name": "Transylvania University",
        "num_emails": 0,
        "num_courses": 573,
        "variations": "pioneers tu",
        "longitude": "-84.4936137",
        "courses_sanitized": true,
        "popular_courses": [
            "SOC 1004",
            "PS 1014",
            "ECON 2024",
            "EDU 1004",
            "HIST 1024",
            "STATS 1",
            "CHEM 1014",
            "FRENCH 3",
            "ANTH 1024",
            "ART 2304",
            "ARTH 1114",
            "BA 1044",
            "BIO 1044",
            "FA 1004",
            "FLA 1004",
            "MATH 1304",
            "MUS 1864",
            "PHIL 1024",
            "SPAN 1034",
            "WS 1004"
        ],
        "svg_url": "https://worldvectorlogo.com/logos/transylvania-university-1.svg"
    },
    {
        "school_casual_name": null,
        "school_color_one": "#40484B",
        "banner_url": "https://farm3.staticflickr.com/2826/10898228495_8bf554e60b_z.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 83,
        "school_tiny_name": "TC",
        "id": 56,
        "city": "Fairfield",
        "num_popular_courses": 2,
        "state": "CA",
        "latitude": "41.747078",
        "population": 2371,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Bantam",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/trinity-college_50x50.jpg",
        "num_depts": 64,
        "name": "Trinity College",
        "num_emails": 0,
        "num_courses": 1259,
        "variations": " tc",
        "longitude": "-72.690375",
        "courses_sanitized": false,
        "popular_courses": [
            "ENGL 110",
            "HIST 239"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/4/4d/Trinity_College_Connecticut_Seal.svg"
    },
    {
        "school_casual_name": null,
        "school_color_one": "#40484B",
        "banner_url": "https://farm9.staticflickr.com/8595/15987971739_6b6e9c77be_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 55,
        "school_tiny_name": "HC",
        "id": 1866,
        "city": "Clinton",
        "num_popular_courses": 163,
        "state": "NY",
        "latitude": "43.050318",
        "population": 1884,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Alex",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/hamilton-college_50x50.jpg",
        "num_depts": 69,
        "name": "Hamilton College",
        "num_emails": 0,
        "num_courses": 1682,
        "variations": " hc",
        "longitude": "-75.4049028",
        "courses_sanitized": true,
        "popular_courses": [
            "BIO 101",
            "ECON 432",
            "HIST 109",
            "COMM 101",
            "THTR 101",
            "CHEM 125",
            "CHNSE 110",
            "APP 1",
            "GOVT 241",
            "GEO 105",
            "ART 104",
            "PHIL 101",
            "ANTHR 126",
            "FRNCH 250",
            "ENG 205",
            "MATH 113",
            "ANTH 126",
            "HSPST 211",
            "PHYS 200",
            "STATS 253"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "",
        "school_color_one": "#af1e2d",
        "banner_url": "https://farm8.staticflickr.com/7419/10575562683_b5c02697c3_z.jpg",
        "sp16_start": "Wed, 20 Jan 2016 00:00:00 -0000",
        "rank": 138,
        "school_tiny_name": "SLU",
        "id": 1907,
        "city": "Canton",
        "num_popular_courses": 151,
        "state": "NY",
        "latitude": "44.5890632",
        "population": 2488,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/b/b2/SLU_Seal.gif",
        "school_mascot_name": "Saints",
        "school_color_light": "#af1e2d",
        "departments_sanitized": true,
        "school_color_dark": "#633826",
        "school_color_primary": null,
        "school_color_two": "#633826",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/st-lawrence-university_50x50.jpg",
        "num_depts": 92,
        "name": "St Lawrence University",
        "num_emails": 0,
        "num_courses": 1443,
        "variations": " slu",
        "longitude": "-75.1621818",
        "courses_sanitized": true,
        "popular_courses": [
            "ANTH 205",
            "ENG 243",
            "CHEM 221",
            "GOVT 105",
            "SOC 101",
            "GS 102",
            "ARAB 101",
            "CNS 101",
            "CS 140",
            "EDUC 203",
            "ECON 252",
            "HIST 104",
            "MATH 136",
            "PHYS 103",
            "REL 100",
            "FYP 100",
            "FA 116",
            "GER 103",
            "MUS 100",
            "PSYC 207"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Little Giants",
        "school_color_one": "#FF2400",
        "banner_url": "https://farm3.staticflickr.com/2536/4024930014_5c5d3eb5d2_z.jpg",
        "sp16_start": "Sat, 16 Jan 2016 00:00:00 -0000",
        "rank": 179,
        "school_tiny_name": "WU",
        "id": 257,
        "city": "Crawfordsvlle",
        "num_popular_courses": 1,
        "state": "IN",
        "latitude": "40.0351229",
        "population": 906,
        "website": "wabash.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/f/f3/Official_Wabash_College_Seal.jpg",
        "school_mascot_name": "Wally Wabash",
        "school_color_light": null,
        "departments_sanitized": true,
        "school_color_dark": null,
        "school_color_primary": null,
        "school_color_two": null,
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/wabash-college_50x50.jpg",
        "num_depts": 30,
        "name": "Wabash College",
        "num_emails": 0,
        "num_courses": 568,
        "variations": "wally wabash little giants wc",
        "longitude": "-86.9070911",
        "courses_sanitized": false,
        "popular_courses": [
            "BIO 101"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "villanova",
        "school_color_one": "#003366",
        "banner_url": "https://farm9.staticflickr.com/8196/8392505471_b4d4fbb36d_b.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 71,
        "school_tiny_name": "V",
        "id": 53,
        "city": "Villanova",
        "num_popular_courses": 2,
        "state": "PA",
        "latitude": "40.0349011",
        "population": 10583,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": "Villanova",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/9/92/Villanova_University_Seal.svg/200px-Villanova_University_Seal.svg.png",
        "school_mascot_name": "wildcat",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#003366",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/villanova-university_50x50.jpg",
        "num_depts": 204,
        "name": "Villanova University",
        "num_emails": 0,
        "num_courses": 2818,
        "variations": " vu",
        "longitude": "-75.3373504",
        "courses_sanitized": false,
        "popular_courses": [
            "MATH 1500"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/c/c0/Vls_logo.gif"
    },
    {
        "school_casual_name": "madison",
        "school_color_one": "#450084",
        "banner_url": "https://farm3.staticflickr.com/2177/1804819201_09bf8078ac_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 188,
        "school_tiny_name": "JMU",
        "id": 283,
        "city": "Harrisonburg",
        "num_popular_courses": 609,
        "state": "VA",
        "latitude": "38.435092",
        "population": 19927,
        "website": "www.jmu.edu",
        "banner_url_confirmed": false,
        "short_name": "Madison",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/e/ef/James_MadisonU_seal.png/200px-James_MadisonU_seal.png",
        "school_mascot_name": "duke",
        "school_color_light": "#CBB677",
        "departments_sanitized": true,
        "school_color_dark": "#450084",
        "school_color_primary": null,
        "school_color_two": "#CBB677",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/james-madison-university_50x50.jpg",
        "num_depts": 170,
        "name": "James Madison University",
        "num_emails": 64,
        "num_courses": 609,
        "variations": "duke dog dukes jmu madison",
        "longitude": "-78.8697548",
        "courses_sanitized": false,
        "popular_courses": [
            "GMUS 203",
            "GISAT 160",
            "SMAD 101",
            "SCOM 240",
            "GANTH 195",
            "COB 218",
            "GARTH 205",
            "GMAD 150",
            "BIO 214",
            "MATH 156",
            "GSCI 102",
            "ECON 201",
            "GPOSC 225",
            "PSYC 275",
            "GHIST 225",
            "GPSYC 160",
            "CHEM 120",
            "GEIC 101",
            "POSC 230",
            "HTH 320"
        ],
        "svg_url": "http://www.dvsngroup.com/images/James_MadisonU_seal.svg"
    },
    {
        "school_casual_name": "lawrence",
        "school_color_one": "#00009C",
        "banner_url": "https://farm5.staticflickr.com/4038/4241828985_d7f494dafb_o.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 106,
        "school_tiny_name": "LU",
        "id": 187,
        "city": "Appleton",
        "num_popular_courses": 112,
        "state": "WI",
        "latitude": "44.2615753",
        "population": 1518,
        "website": "www.lawrence.edu",
        "banner_url_confirmed": true,
        "short_name": "Lawrence",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/4/44/Lawrence_University_seal.png",
        "school_mascot_name": "Viking",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#00009C",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/lawrence-university_50x50.jpg",
        "num_depts": 40,
        "name": "Lawrence University",
        "num_emails": 0,
        "num_courses": 1061,
        "variations": "vikings - (1926)[15] lu",
        "longitude": "-88.3979663",
        "courses_sanitized": true,
        "popular_courses": [
            "GOVT 340",
            "BIO 120",
            "ENG 400",
            "MUHI 201",
            "PHIL 100",
            "HIST 101",
            "FRST 102",
            "PSYCH 100",
            "CHEM 250",
            "ANTH 140",
            "CMSC 150",
            "ECON 320",
            "PSYC 260",
            "RLST 420",
            "SPAN 101",
            "MUIN 314",
            "ART 100",
            "CHJA 111",
            "LING 150",
            "MATH 140"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "bates",
        "school_color_one": "#000000",
        "banner_url": "https://farm8.staticflickr.com/7300/8727497151_75771ca2a7_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 60,
        "school_tiny_name": "Bate",
        "id": 285,
        "city": "Lewiston",
        "num_popular_courses": 183,
        "state": "ME",
        "latitude": "44.1057216",
        "population": 1753,
        "website": "bates.edu",
        "banner_url_confirmed": false,
        "short_name": "Bates",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/b/bf/Bates_College_seal.png/220px-Bates_College_seal.png",
        "school_mascot_name": "bobcat",
        "school_color_light": "maroon",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "black",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/bates-college_50x50.jpg",
        "num_depts": 147,
        "name": "Bates College",
        "num_emails": 0,
        "num_courses": 1372,
        "variations": "bobcat bc",
        "longitude": "-70.2021865",
        "courses_sanitized": true,
        "popular_courses": [
            "PE 101",
            "BIO 118",
            "PSYC 218",
            "ECON 101",
            "RHET 155",
            "THEA 101",
            "ANTHR 101",
            "FYS 271",
            "GEO 104",
            "EN 112",
            "POLS 171",
            "AVC 219",
            "REL 102",
            "ID 315",
            "HIST 222",
            "ASTRO 110",
            "CHI 101",
            "PHIL 321",
            "PHYS 106",
            "PLTC 191"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/0/0e/Bates_College_wordmark.svg"
    },
    {
        "school_casual_name": "uu",
        "school_color_one": "#CA0612",
        "banner_url": "https://farm8.staticflickr.com/7011/6812566041_990877646a_b.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 141,
        "school_tiny_name": "UU",
        "id": 287,
        "city": "Salt lake city",
        "num_popular_courses": 499,
        "state": "UT",
        "latitude": "40.7649368",
        "population": 32388,
        "website": "www.utah.edu",
        "banner_url_confirmed": false,
        "short_name": "Utah",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/b/ba/UofU_official_seal.png",
        "school_mascot_name": "swoop",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": null,
        "school_color_dark": "#CA0612",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-utah_50x50.jpg",
        "num_depts": 192,
        "name": "University of Utah",
        "num_emails": 0,
        "num_courses": 23288,
        "variations": "utes u of u uu",
        "longitude": "-111.8421021",
        "courses_sanitized": true,
        "popular_courses": [
            "MUSC 2100",
            "ETHNC 2590",
            "MGT 3410",
            "BIOEN 1102",
            "SW 2300",
            "ANTH 2040",
            "ART 2400",
            "GEO 1000",
            "BIOL 2210",
            "CHEM 1200",
            "ASTR 1050",
            "BUS 1051",
            "ENGL 3703",
            "GEOG 1000",
            "OIS 5650",
            "PHYS 3110",
            "POLS 2200",
            "SOC 1015",
            "LING 1069",
            "MKTG 4510"
        ],
        "svg_url": "http://dataviscourse.net/2015/assets/i/utah.svg"
    },
    {
        "school_casual_name": "air force",
        "school_color_one": "#00308F",
        "banner_url": "https://farm4.staticflickr.com/3365/3647906556_e2a9a98011_b.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 34,
        "school_tiny_name": "USAF",
        "id": 26,
        "city": "Usafa",
        "num_popular_courses": 32,
        "state": "CO",
        "latitude": "38.9983573",
        "population": 4120,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": "US Air Force",
        "seal_url": null,
        "school_mascot_name": "gyrfalcon",
        "school_color_light": "#A6A6A8",
        "departments_sanitized": true,
        "school_color_dark": "#00308F",
        "school_color_primary": null,
        "school_color_two": "#A6A6A8",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/united-states-air-force-academy_50x50.jpg",
        "num_depts": 47,
        "name": "Us Air Force Academy",
        "num_emails": 0,
        "num_courses": 623,
        "variations": " uafa",
        "longitude": "-104.8617533",
        "courses_sanitized": false,
        "popular_courses": [
            "ENGR 101",
            "ENG 101",
            "EM 220",
            "CHEM 110",
            "ENGRMECH 220",
            "BS 110",
            "BEHSCI 110",
            "BEHSC 101",
            "HIST 101",
            "BEHSCT 2",
            "BIO 215",
            "MATH 245",
            "PHYS 215",
            "ME 490",
            "CHEMM 3",
            "ASTRO 410",
            "ENGL 111",
            "HISTORY 202",
            "ECON 465"
        ],
        "svg_url": "http://upload.wikimedia.org/wikipedia/commons/e/ec/US-AirForceAcademy-Shield.svg"
    },
    {
        "school_casual_name": "Bears",
        "school_color_one": "#007360",
        "banner_url": "https://farm3.staticflickr.com/2470/3534425009_d6cc0c0748_b.jpg",
        "sp16_start": "Sun, 17 Jan 2016 00:00:00 -0000",
        "rank": 63,
        "school_tiny_name": "WshU",
        "id": 75,
        "city": "Saint louis",
        "num_popular_courses": 520,
        "state": "MO",
        "latitude": "38.6487895",
        "population": 13952,
        "website": "www.wustl.edu",
        "banner_url_confirmed": false,
        "short_name": "Wash U",
        "seal_url": null,
        "school_mascot_name": "Bear",
        "school_color_light": "#9D0917",
        "departments_sanitized": true,
        "school_color_dark": "#007360",
        "school_color_primary": null,
        "school_color_two": "#9D0917",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/washington-university-in-st-louis_50x50.jpg",
        "num_depts": 218,
        "name": "Washington University in St. Louis",
        "num_emails": 0,
        "num_courses": 5018,
        "variations": "bear bears wuisl wash u",
        "longitude": "-90.3107962",
        "courses_sanitized": true,
        "popular_courses": [
            "BME 140",
            "ECON 201",
            "PSYCH 330",
            "CHEM 252",
            "MECO 290",
            "OSCM 356",
            "HIST 101",
            "ANTHRO 150",
            "BIO 478",
            "ME 232",
            "SPAN 301",
            "MATH 128",
            "CALC 128",
            "MKT 373",
            "CS 101",
            "QBA 120",
            "ENG 111",
            "GER 340",
            "CSE 240",
            "AMPOL 101"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/7/7b/WashUShielding.svg"
    },
    {
        "school_casual_name": "(\"Reed College\",reed)",
        "school_color_one": "#ff007f",
        "banner_url": "https://farm9.staticflickr.com/8404/8671009300_ed727d0b7b_z.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 46,
        "school_tiny_name": "Reed",
        "id": 29,
        "city": "Portland",
        "num_popular_courses": 104,
        "state": "OR",
        "latitude": "45.4805713",
        "population": 1455,
        "website": "reed.edu",
        "banner_url_confirmed": false,
        "short_name": "Reed",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/0/01/Reed_College_Seal.png",
        "school_mascot_name": "Griffin",
        "school_color_light": "#ff007f",
        "departments_sanitized": true,
        "school_color_dark": "#757575",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/reed-college_50x50.jpg",
        "num_depts": 50,
        "name": "Reed College",
        "num_emails": 0,
        "num_courses": 851,
        "variations": "griffin rc",
        "longitude": "-122.6300908",
        "courses_sanitized": true,
        "popular_courses": [
            "PHIL 201",
            "MATH 141",
            "POL 210",
            "ANTH 211",
            "ECON 201",
            "REL 201",
            "SPAN 110",
            "FRENCH 210",
            "BIO 101",
            "CHEM 102",
            "ENG 211",
            "HIST 275",
            "HST 275",
            "CHIN 110",
            "FREN 110",
            "HUM 110",
            "LAT 210",
            "PHYS 101",
            "PSY 122",
            "RUSS 120"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Terrapins, Terps",
        "school_color_one": "#F0163A",
        "banner_url": "https://farm5.staticflickr.com/4141/4892068913_7d11d69dc0_b.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 170,
        "school_tiny_name": "UM",
        "id": 1932,
        "city": "College park",
        "num_popular_courses": 347,
        "state": "MD",
        "latitude": "38.9869183",
        "population": 5978,
        "website": "www.umd.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/5/51/University_of_Maryland_Seal.svg/200px-University_of_Maryland_Seal.svg.png",
        "school_mascot_name": "Testudo",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#F0163A",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/loyola-university-maryland_50x50.jpg",
        "num_depts": 175,
        "name": "University of Maryland",
        "num_emails": 0,
        "num_courses": 10217,
        "variations": "testudo terrapins, terps",
        "longitude": "-76.9425543",
        "courses_sanitized": true,
        "popular_courses": [
            "EDPS 210",
            "NFSC 100",
            "MUET 200",
            "GEOL 120",
            "ECON 330",
            "CHEM 113",
            "THET 110",
            "HIST 111",
            "GEOG 130",
            "ANTH 260",
            "BSCI 222",
            "GVPT 100",
            "CMSC 132",
            "BMGT 340",
            "PHYS 121",
            "CCJS 200",
            "ASTR 101",
            "KNES 287",
            "FMSC 341",
            "MATH 113"
        ],
        "svg_url": "http://img3.wikia.nocookie.net/__cb20100926165751/logopedia/images/3/30/University_of_Maryland.svg"
    },
    {
        "school_casual_name": "Blue Jays",
        "school_color_one": "#CBA052",
        "banner_url": "https://farm1.staticflickr.com/66/160766534_d0509f0752_b.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 67,
        "school_tiny_name": "JHU",
        "id": 1949,
        "city": "Baltimore",
        "num_popular_courses": 165,
        "state": "MD",
        "latitude": "39.3249281",
        "population": 20871,
        "website": "www.jhu.edu",
        "banner_url_confirmed": false,
        "short_name": "JHU",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/6d/Johns_Hopkins_University%27s_Academic_Seal.png/200px-Johns_Hopkins_University%27s_Academic_Seal.png",
        "school_mascot_name": "Blue Jay",
        "school_color_light": "#CBA052",
        "departments_sanitized": true,
        "school_color_dark": "black",
        "school_color_primary": null,
        "school_color_two": "black",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/johns-hopkins-university_50x50.jpg",
        "num_depts": 355,
        "name": "Johns Hopkins University",
        "num_emails": 0,
        "num_courses": 6637,
        "variations": "blue jays jhu",
        "longitude": "-76.6233538",
        "courses_sanitized": true,
        "popular_courses": [
            "ECON 102",
            "CS 226",
            "CHEM 105",
            "CALC 211",
            "PSYCH 101",
            "NEURO 305",
            "IP 213",
            "ORGO 205",
            "AS 030105",
            "MICRO 101",
            "ENG 101",
            "MATH 302",
            "THERM 203",
            "IFP 101",
            "BIO 315",
            "PHYS 113",
            "NF 231",
            "STATS 111",
            "PHYSICS 101",
            "BUS 101"
        ],
        "svg_url": "http://upload.wikimedia.org/wikipedia/en/c/cb/Johns_Hopkins_University_seal.svg"
    },
    {
        "school_casual_name": "colby",
        "school_color_one": "#002366",
        "banner_url": "https://farm1.staticflickr.com/772/20932834149_cc499ca77c_k.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 39,
        "school_tiny_name": "CC",
        "id": 191,
        "city": "Waterville",
        "num_popular_courses": 223,
        "state": "ME",
        "latitude": "40.5058961",
        "population": 1863,
        "website": "colby.edu",
        "banner_url_confirmed": true,
        "short_name": "Colby",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/b/b7/Colby_College_Seal.svg/200px-Colby_College_Seal.svg.png",
        "school_mascot_name": "Mule",
        "school_color_light": "#858C8C",
        "departments_sanitized": true,
        "school_color_dark": "#002366",
        "school_color_primary": null,
        "school_color_two": "#858C8C",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/colby-college_50x50.jpg",
        "num_depts": 48,
        "name": "Colby College",
        "num_emails": 0,
        "num_courses": 1221,
        "variations": "mule cc",
        "longitude": "-88.993794",
        "courses_sanitized": true,
        "popular_courses": [
            "SP 231",
            "GO 111",
            "FR 125",
            "PH 143",
            "MA 161",
            "PL 151",
            "AS 151",
            "CH 242",
            "PS 232",
            "MU 118",
            "HI 183",
            "RE 120",
            "TD 135",
            "HIST 386",
            "EN 278",
            "BI 279",
            "BIO 163",
            "CS 151",
            "LA 173",
            "AR 131"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "brown",
        "school_color_one": "#321414",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/1/1e/Brown_university_robinson_hall_2009a.JPG",
        "sp16_start": "Wed, 06 Jan 2016 00:00:00 -0000",
        "rank": 13,
        "school_tiny_name": "BU",
        "id": 175,
        "city": "Providence",
        "num_popular_courses": 324,
        "state": "RI",
        "latitude": "41.8267718",
        "population": 8885,
        "website": "brown.edu",
        "banner_url_confirmed": true,
        "short_name": "Brown",
        "seal_url": null,
        "school_mascot_name": "bear",
        "school_color_light": "#C41E3A",
        "departments_sanitized": true,
        "school_color_dark": "#321414",
        "school_color_primary": null,
        "school_color_two": "#C41E3A",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/brown-university_50x50.jpg",
        "num_depts": 85,
        "name": "Brown University",
        "num_emails": 0,
        "num_courses": 4408,
        "variations": "bruno the bear brown bears bu",
        "longitude": "-71.4025482",
        "courses_sanitized": true,
        "popular_courses": [
            "PS 22",
            "AN 80",
            "EN 9",
            "CG 42",
            "POLS 0010",
            "PY 55",
            "EC 162",
            "HA 88",
            "CS 15",
            "CH 33",
            "PL 35",
            "FR 151",
            "ED 80",
            "BI 0020",
            "HI 126",
            "EL 16",
            "ENGLISH 1010",
            "BIO 20",
            "BN 1",
            "MA 35"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/0/07/BrownU-CoA.svg"
    },
    {
        "school_casual_name": "(\"Centre College\",centre)",
        "school_color_one": "#FFCC00",
        "banner_url": "https://farm3.staticflickr.com/2398/1777897557_35d56fb0ac_z.jpg",
        "sp16_start": "Mon, 01 Feb 2016 00:00:00 -0000",
        "rank": 81,
        "school_tiny_name": "CC",
        "id": 293,
        "city": "Danville",
        "num_popular_courses": 106,
        "state": "KY",
        "latitude": "37.6446298",
        "population": 1344,
        "website": "www.centre.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/61/Centrecollegeseal.png/200px-Centrecollegeseal.png",
        "school_mascot_name": "Colonels",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#FFCC00",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/centre-college_50x50.jpg",
        "num_depts": 36,
        "name": "Centre College",
        "num_emails": 0,
        "num_courses": 525,
        "variations": "colonels cc",
        "longitude": "-84.7781853",
        "courses_sanitized": true,
        "popular_courses": [
            "SPA 220",
            "REL 340",
            "BIO 210",
            "ANT 110",
            "ENG 230",
            "HIS 110",
            "MAT 140",
            "ECO 220",
            "GOV 210",
            "PHI 110",
            "PSY 210",
            "CSC 117",
            "CHE 241",
            "ECON 365",
            "PHY 210",
            "CLA 110",
            "DRA 150",
            "FRE 260",
            "HUM 110",
            "BMB 320"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "The Warriors",
        "school_color_one": "maroon",
        "banner_url": "http://blogs.westmont.edu/wp-content/uploads/2014/03/TC_1167.jpg",
        "sp16_start": "Sun, 10 Jan 2016 00:00:00 -0000",
        "rank": 161,
        "school_tiny_name": "WC",
        "id": 358,
        "city": "Santa barbara",
        "num_popular_courses": 79,
        "state": "CA",
        "latitude": "34.4485027",
        "population": 1353,
        "website": "www.westmont.edu",
        "banner_url_confirmed": true,
        "short_name": "Westmont",
        "seal_url": null,
        "school_mascot_name": "Warrior",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "maroon",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/westmont-college_50x50.jpg",
        "num_depts": 79,
        "name": "Westmont College",
        "num_emails": 0,
        "num_courses": 2980,
        "variations": "warrior the warriors wc",
        "longitude": "-119.6616697",
        "courses_sanitized": true,
        "popular_courses": [
            "CS 30",
            "CHM 101",
            "RS 151",
            "EB 003",
            "KNS 011",
            "ART 001",
            "PHI 006",
            "AN 155",
            "MA 19",
            "BIO 005",
            "PO 10",
            "PEA 032",
            "COMM 006",
            "CHEM 005",
            "ENG 117",
            "SOC 155",
            "HIS 142",
            "HIST 007",
            "SP 003",
            "SPANISH 1"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Big Red",
        "school_color_one": "red",
        "banner_url": "https://farm5.staticflickr.com/4129/4973492453_53bb724f5d_z.jpg",
        "sp16_start": "Mon, 18 Jan 2016 00:00:00 -0000",
        "rank": 95,
        "school_tiny_name": "DU",
        "id": 329,
        "city": "Granville",
        "num_popular_courses": 178,
        "state": "OH",
        "latitude": "40.0740253",
        "population": 2339,
        "website": "[2]",
        "banner_url_confirmed": false,
        "short_name": "DU",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/b/b8/DenisonUniversitySeal.png",
        "school_mascot_name": "Big Red",
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "red",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/denison-university_50x50.jpg",
        "num_depts": 47,
        "name": "Denison University",
        "num_emails": 0,
        "num_courses": 1397,
        "variations": "big red du",
        "longitude": "-82.5226425",
        "courses_sanitized": true,
        "popular_courses": [
            "POSC 212",
            "PHYS 126",
            "GERM 111",
            "CINE 310",
            "ENG 215",
            "SOC 100",
            "CHEM 231",
            "COMM 225",
            "CS 111",
            "ENGL 215",
            "FREN 214",
            "MATH 102",
            "MUS 104",
            "CALC 1",
            "OCHEM 223",
            "HIST 204",
            "ECON 302",
            "ENVS 101",
            "GEOS 111",
            "PHIL 121"
        ],
        "svg_url": "https://d2mfqolawl485u.cloudfront.net/sites/all/themes/denison/images/denison-logo.svg"
    },
    {
        "school_casual_name": "tulane",
        "school_color_one": "#00331A",
        "banner_url": "https://farm2.staticflickr.com/1287/544239087_9306316ebd_b.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 147,
        "school_tiny_name": "TU",
        "id": 48,
        "city": "New orleans",
        "num_popular_courses": 268,
        "state": "LA",
        "latitude": "29.9403477",
        "population": 12958,
        "website": "tulane.edu",
        "banner_url_confirmed": false,
        "short_name": "Tulane",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/e/ef/TulaneSealColor.png/200px-TulaneSealColor.png",
        "school_mascot_name": "pelican",
        "school_color_light": "#224568",
        "departments_sanitized": null,
        "school_color_dark": "#00331A",
        "school_color_primary": null,
        "school_color_two": "#224568",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/tulane-university-of-louisiana_50x50.jpg",
        "num_depts": 178,
        "name": "Tulane University",
        "num_emails": 0,
        "num_courses": 2545,
        "variations": "riptide the pelican green wave tu",
        "longitude": "-90.1207279",
        "courses_sanitized": true,
        "popular_courses": [
            "CELL 2050",
            "MGMT 7100",
            "EENS 1110",
            "ACCN 2010",
            "CHEM 1070",
            "EBIO 2050",
            "PSYC 3090",
            "SOCI 1300",
            "GEHS 6030",
            "CLAS 1040",
            "CENG 2500",
            "INFO 1010",
            "MUSC 1090",
            "SPAN 1020",
            "MATH 1230",
            "ARBC 1010",
            "COMM 2550",
            "NSCI 3310",
            "PHIL 1210",
            "SPHU 3120"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/7/7e/Tulane_logo.svg"
    },
    {
        "school_casual_name": "Harvard Crimson",
        "school_color_one": "#A41034",
        "banner_url": "https://farm4.staticflickr.com/3045/2693102248_8dd31bb0db_b.jpg",
        "sp16_start": "Sat, 23 Jan 2016 00:00:00 -0000",
        "rank": 7,
        "school_tiny_name": "Hrvd",
        "id": 381,
        "city": "Cambridge",
        "num_popular_courses": 125,
        "state": "MA",
        "latitude": "42.3770029",
        "population": 28147,
        "website": "harvard.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "John Harvard the Pilgrim",
        "school_color_light": null,
        "departments_sanitized": true,
        "school_color_dark": null,
        "school_color_primary": null,
        "school_color_two": null,
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/harvard-university_50x50.jpg",
        "num_depts": 1630,
        "name": "Harvard University",
        "num_emails": 0,
        "num_courses": 2618,
        "variations": "harvard crimson hu",
        "longitude": "-71.1166601",
        "courses_sanitized": true,
        "popular_courses": [
            "EXPOS 20",
            "CS 50",
            "SCIB 29",
            "PHYS 16",
            "PSY 1553",
            "STAT 110",
            "DRAMA 117",
            "MR 22",
            "PSYCS 1507",
            "GOV 1060",
            "MATH 55",
            "EXPOE 25",
            "FC 70",
            "GREEK 134",
            "EXPO 25",
            "GOVT 1733",
            "PSYCH 1",
            "HIST 1602",
            "DRAM 140",
            "ECON 1010"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/a/ab/Harvard_Crimson.svg"
    },
    {
        "school_casual_name": "cua",
        "school_color_one": "#AD2624",
        "banner_url": "https://farm3.staticflickr.com/2700/5810582700_acfc293577_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 206,
        "school_tiny_name": "CUA",
        "id": 2016,
        "city": "Washington",
        "num_popular_courses": 219,
        "state": "DC",
        "latitude": "38.9368811",
        "population": 6838,
        "website": "www.cua.edu",
        "banner_url_confirmed": false,
        "short_name": "Catholic U",
        "seal_url": null,
        "school_mascot_name": "Cardinal",
        "school_color_light": "#FFC72C",
        "departments_sanitized": true,
        "school_color_dark": "#AD2624",
        "school_color_primary": null,
        "school_color_two": "#FFC72C",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/catholic-university-of-america_50x50.jpg",
        "num_depts": 78,
        "name": "Catholic University of America",
        "num_emails": 0,
        "num_courses": 2081,
        "variations": "cardinal cardinals cua",
        "longitude": "-76.998692",
        "courses_sanitized": true,
        "popular_courses": [
            "ANTH 105",
            "ECON 103",
            "HSHU 101",
            "MATH 168",
            "CHEM 125",
            "PHIL 301",
            "ARPL 331",
            "HSPH 203",
            "MIS 240",
            "POL 212",
            "ENGR 222",
            "TRS 260",
            "MGT 240",
            "PHYS 103",
            "HSSS 101",
            "MDIA 201",
            "SOC 345",
            "HIST 102",
            "ARCH 457",
            "ENG 209"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/7/7e/Logo_of_The_Catholic_University_of_America.svg"
    },
    {
        "school_casual_name": "wittenberg",
        "school_color_one": "#DD0000",
        "banner_url": "https://farm9.staticflickr.com/8507/8433479839_f0bdc18198_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 210,
        "school_tiny_name": "WU",
        "id": 2055,
        "city": "Springfield",
        "num_popular_courses": 57,
        "state": "OH",
        "latitude": "39.9346566",
        "population": 1894,
        "website": "www.wittenberg.edu",
        "banner_url_confirmed": false,
        "short_name": "Wittenberg",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/e/eb/Witt_seal.png/220px-Witt_seal.png",
        "school_mascot_name": "Tiger",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#DD0000",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/wittenberg-university_50x50.jpg",
        "num_depts": 84,
        "name": "Wittenberg University",
        "num_emails": 0,
        "num_courses": 1744,
        "variations": "tiger wu",
        "longitude": "-83.812195",
        "courses_sanitized": true,
        "popular_courses": [
            "BIO 180",
            "PHIL 103",
            "PSYCH 101",
            "PHYS 218",
            "SOC 111",
            "ECON 310",
            "EDUC 341",
            "HIST 202",
            "COMP 150",
            "ENG 101",
            "PSYC 110",
            "CHEM 121",
            "POLI 102",
            "MATH 201",
            "MUS 102",
            "COMM 200",
            "ENGL 200",
            "SPAN 150",
            "EDU 112",
            "BIOL 131"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/7/7d/Seal_Leucorea_Wittenberg.svg"
    },
    {
        "school_casual_name": "lmu",
        "school_color_one": "#0058A1",
        "banner_url": "https://farm8.staticflickr.com/7057/6840062398_405137675d_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 183,
        "school_tiny_name": "LMU",
        "id": 1301,
        "city": "Los angeles",
        "num_popular_courses": 816,
        "state": "CA",
        "latitude": "33.9704172",
        "population": 9492,
        "website": "www.lmu.edu",
        "banner_url_confirmed": false,
        "short_name": "Loyola Mary",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/9/91/Loyola_Marymount_Seal_Colored.png/200px-Loyola_Marymount_Seal_Colored.png",
        "school_mascot_name": "lion",
        "school_color_light": "#B80007",
        "departments_sanitized": true,
        "school_color_dark": "#0058A1",
        "school_color_primary": null,
        "school_color_two": "#B80007",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/loyola-marymount-university_50x50.jpg",
        "num_depts": 103,
        "name": "Loyola Marymount University",
        "num_emails": 0,
        "num_courses": 1891,
        "variations": "iggy the lion lions lmu",
        "longitude": "-118.4174046",
        "courses_sanitized": true,
        "popular_courses": [
            "PSYC 251",
            "CMST 101",
            "PSYCH 251",
            "POLS 155",
            "MBAA 605",
            "ISQM 370",
            "BIO 272",
            "THST 150",
            "HIST 198",
            "ECON 310",
            "AMCS 198",
            "NTLS 151",
            "ENGR 140",
            "PHIL 330",
            "ART 257",
            "ANIM 100",
            "ITAL 101",
            "MGMT 409",
            "ACCT 2110",
            "PROD 250"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Terriers",
        "school_color_one": "#886E4C",
        "banner_url": "https://farm3.staticflickr.com/2082/2389913085_548ddef8cf_z.jpg",
        "sp16_start": "Mon, 01 Feb 2016 00:00:00 -0000",
        "rank": 85,
        "school_tiny_name": "WC",
        "id": 988,
        "city": "Spartanburg",
        "num_popular_courses": 116,
        "state": "SC",
        "latitude": "34.9588759",
        "population": 1619,
        "website": "www.wofford.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/commons/thumb/4/42/Wofford_College_Seal.png/220px-Wofford_College_Seal.png",
        "school_mascot_name": "Terrier",
        "school_color_light": "#886E4C",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#000000",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/wofford-college_50x50.jpg",
        "num_depts": 59,
        "name": "Wofford College",
        "num_emails": 0,
        "num_courses": 1149,
        "variations": "terrier terriers wc",
        "longitude": "-81.934516",
        "courses_sanitized": true,
        "popular_courses": [
            "BIO 113",
            "CHEM 124",
            "REL 203",
            "SOC 210",
            "SPAN 101",
            "ART 201",
            "CHIN 101",
            "MATH 182",
            "PSY 110",
            "PHIL 210",
            "COSC 235",
            "FIN 321",
            "GOV 202",
            "HIST 101",
            "PHY 104",
            "STATS 140",
            "CALC 182",
            "GOVT 202",
            "ACCT 211",
            "ECO 201"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Pioneers",
        "school_color_one": "#002D62",
        "banner_url": "https://farm6.staticflickr.com/5292/5510886341_37cee30032_b.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 49,
        "school_tiny_name": "SC",
        "id": 399,
        "city": "Northampton",
        "num_popular_courses": 323,
        "state": "MA",
        "latitude": "42.3180957",
        "population": 3212,
        "website": "smith.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Pioneers",
        "school_color_light": "#F1AB00",
        "departments_sanitized": true,
        "school_color_dark": "#002D62",
        "school_color_primary": null,
        "school_color_two": "#F1AB00",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/smith-college_50x50.jpg",
        "num_depts": 86,
        "name": "Smith College",
        "num_emails": 0,
        "num_courses": 1359,
        "variations": "pioneers sc",
        "longitude": "-72.6372341",
        "courses_sanitized": true,
        "popular_courses": [
            "GOV 200",
            "AAS 111",
            "ENG 200",
            "EGR 290",
            "EAS 217",
            "BIO 230",
            "PSY 221",
            "FLS 241",
            "SOC 215",
            "ECO 253",
            "EDC 238",
            "MUS 201",
            "LSS 105",
            "AST 111",
            "CHM 224",
            "MTH 245",
            "LOG 100",
            "PHI 124",
            "ARS 161",
            "EAL 232"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Friars",
        "school_color_one": "#000000",
        "banner_url": "https://farm8.staticflickr.com/7511/15516278678_f655180d39_z.jpg",
        "sp16_start": "Sun, 17 Jan 2016 00:00:00 -0000",
        "rank": 105,
        "school_tiny_name": "PC",
        "id": 1936,
        "city": "Providence",
        "num_popular_courses": 267,
        "state": "RI",
        "latitude": "41.8438848",
        "population": 4672,
        "website": "www.providence.edu",
        "banner_url_confirmed": false,
        "short_name": "PC",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/9/96/ProvidenceCollegeSeal.png/200px-ProvidenceCollegeSeal.png",
        "school_mascot_name": "Friar",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/providence-college_50x50.jpg",
        "num_depts": 58,
        "name": "Providence College",
        "num_emails": 0,
        "num_courses": 1163,
        "variations": "friars pc",
        "longitude": "-71.4346677",
        "courses_sanitized": true,
        "popular_courses": [
            "HIS 255",
            "EDU 201",
            "THL 342",
            "CHM 121",
            "PSY 323",
            "ACC 405",
            "CSC 103",
            "MKT 335",
            "TDF 121",
            "PHL 470",
            "NSC 102",
            "AMS 101",
            "APG 101",
            "MGT 320",
            "SOC 101",
            "ENG 400",
            "GST 101",
            "SWK 101",
            "FIN 317",
            "HON 209"
        ],
        "svg_url": "https://worldvectorlogo.com/logos/providence-college-1.svg"
    },
    {
        "school_casual_name": "The Warriors",
        "school_color_one": "#F58025",
        "banner_url": "https://farm1.staticflickr.com/687/21281152088_a085d10092_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 152,
        "school_tiny_name": "HC",
        "id": 1982,
        "city": "Conway",
        "num_popular_courses": 141,
        "state": "AR",
        "latitude": "35.1006849",
        "population": 1388,
        "website": "hendrix.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/b/b5/Hendrix_College_seal.png/220px-Hendrix_College_seal.png",
        "school_mascot_name": "Ivan the Warrior",
        "school_color_light": "#F58025",
        "departments_sanitized": true,
        "school_color_dark": "black",
        "school_color_primary": null,
        "school_color_two": "black",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/hendrix-college_50x50.jpg",
        "num_depts": 56,
        "name": "Hendrix College",
        "num_emails": 0,
        "num_courses": 1002,
        "variations": "ivan the warrior the warriors hc",
        "longitude": "-92.436529",
        "courses_sanitized": true,
        "popular_courses": [
            "SPAN 120",
            "CHEM 110",
            "POLI 250",
            "ECON 200",
            "EDUC 110",
            "HIST 170",
            "PHIL 285",
            "BIOL 220",
            "ENG 220",
            "ART 101",
            "ANTH 102",
            "ENGL 248",
            "FREN 210",
            "SOCI 110",
            "BIO 150",
            "ARTS 100",
            "CSCI 150",
            "GERM 110",
            "GREE 110",
            "LATI 110"
        ],
        "svg_url": "https://www.hendrix.edu/staticresources/images/hendrixLogo_bob.svg"
    },
    {
        "school_casual_name": "Sagehens",
        "school_color_one": "#0000ff",
        "banner_url": "https://farm6.staticflickr.com/5288/5301086405_e1582225bb_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 8,
        "school_tiny_name": "PC",
        "id": 2149,
        "city": "Claremont",
        "num_popular_courses": 141,
        "state": "CA",
        "latitude": "34.097718",
        "population": 1607,
        "website": "pomona.edu",
        "banner_url_confirmed": false,
        "short_name": "Pomona",
        "seal_url": null,
        "school_mascot_name": "Cecil Sagehen",
        "school_color_light": "#0000ff",
        "departments_sanitized": true,
        "school_color_dark": "#757575",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/pomona-college_50x50.jpg",
        "num_depts": 64,
        "name": "Pomona College",
        "num_emails": 0,
        "num_courses": 1165,
        "variations": "cecil sagehen sagehens pc pomona",
        "longitude": "-117.7094496",
        "courses_sanitized": true,
        "popular_courses": [
            "ANTH 52",
            "ECON 101",
            "RLST 100",
            "WMST 180",
            "SPAN 001",
            "LGCS 11",
            "MATH 32",
            "ASTRO 1",
            "CS 51",
            "JAPN 111",
            "ART 21",
            "CHEM 115",
            "FREN 105",
            "HIST 11",
            "MS 49",
            "PHIL 1",
            "POLI 90",
            "SOC 126",
            "BIO 163",
            "GEO 125"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": null,
        "school_color_one": "#40484B",
        "banner_url": "https://farm1.staticflickr.com/114/303156398_03c7ef8bd8_b.jpg",
        "sp16_start": null,
        "rank": 126,
        "school_tiny_name": "UCSD",
        "id": 397,
        "city": "La jolla",
        "num_popular_courses": 1281,
        "state": "CA",
        "latitude": "32.8800604",
        "population": 28294,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": "UCSD",
        "seal_url": null,
        "school_mascot_name": "King Triton",
        "school_color_light": "#757575",
        "departments_sanitized": null,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-california-san-diego_50x50.jpg",
        "num_depts": 135,
        "name": "University of California-San Diego",
        "num_emails": 0,
        "num_courses": 3209,
        "variations": " ucsd",
        "longitude": "-117.2340135",
        "courses_sanitized": true,
        "popular_courses": [
            "ECON 4",
            "CHEM 4",
            "COGS 3",
            "BILD 22",
            "BIPN 105",
            "SIO 15",
            "ANLD 1",
            "BIEB 166",
            "VIS 154",
            "HILD 10",
            "POLI 13",
            "MAE 3",
            "TDGE 1",
            "LTEN 21",
            "HINE 114",
            "E 54",
            "HIEU 158",
            "MMW 11",
            "MUS 11",
            "PSYC 179"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Raiders",
        "school_color_one": "#862633",
        "banner_url": "https://farm2.staticflickr.com/1144/1388178552_47d28f5da0_z.jpg",
        "sp16_start": "Thu, 25 Aug 2016 00:00:00 -0000",
        "rank": 38,
        "school_tiny_name": "CU",
        "id": 2110,
        "city": "Hamilton",
        "num_popular_courses": 238,
        "state": "NY",
        "latitude": "42.8173737",
        "population": 2886,
        "website": "www.colgate.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/4/41/Colgate_University_Seal.svg/200px-Colgate_University_Seal.svg.png",
        "school_mascot_name": "Raider",
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "#862633",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/colgate-university_50x50.jpg",
        "num_depts": 74,
        "name": "Colgate University",
        "num_emails": 0,
        "num_courses": 1331,
        "variations": "raider raiders cu",
        "longitude": "-75.5392442",
        "courses_sanitized": true,
        "popular_courses": [
            "CORE 114",
            "POSC 211",
            "PHYS 121",
            "CHEM 263",
            "HIST 202",
            "SPAN 101",
            "COSC 100",
            "FSEM 136",
            "MATH 214",
            "SOAN 210",
            "ASTR 101",
            "ENST 232",
            "ARTS 211",
            "PHIL 216",
            "ECON 251",
            "MUSI 203",
            "FREN 351",
            "GEOG 312",
            "GEOL 135",
            "NEUR 375"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/4/41/Colgate_University_Seal.svg"
    },
    {
        "school_casual_name": null,
        "school_color_one": "#40484B",
        "banner_url": "https://farm5.staticflickr.com/4138/4811122569_44083cd64a_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 124,
        "school_tiny_name": "CM",
        "id": 2635,
        "city": "Texas city",
        "num_popular_courses": 108,
        "state": "TX",
        "latitude": "29.395552",
        "population": 340,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Comet the Duck",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/college-of-the-atlantic_50x50.jpg",
        "num_depts": 69,
        "name": "College Of The Mainland",
        "num_emails": 0,
        "num_courses": 551,
        "variations": "",
        "longitude": "-95.000882",
        "courses_sanitized": true,
        "popular_courses": [
            "HUMA 1301",
            "ACCT 2301",
            "SPCH 1315",
            "CHEM 1411",
            "ECON 2301",
            "MATH 0305",
            "ARTS 1303",
            "ENGL 1302",
            "PHYS 1401",
            "BIO 2402",
            "PSYC 1301",
            "CRIJ 1301",
            "SPAN 1411",
            "GOV 2301",
            "BCIS 1405",
            "AP 1",
            "ITSC 1301",
            "TECA 1318",
            "COMP 1301",
            "GOVT 1301"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "h-sc",
        "school_color_one": "#40484B",
        "banner_url": "https://farm6.staticflickr.com/5034/14054510590_99c4e720e4_z.jpg",
        "sp16_start": "Wed, 13 Jan 2016 00:00:00 -0000",
        "rank": 171,
        "school_tiny_name": "H-SC",
        "id": 2188,
        "city": "Hampden-sydney",
        "num_popular_courses": 60,
        "state": "VA",
        "latitude": "37.241039",
        "population": 1080,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": "H-SC",
        "seal_url": null,
        "school_mascot_name": "tiger",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/hampden-sydney-college_50x50.jpg",
        "num_depts": 26,
        "name": "Hampden-Sydney College",
        "num_emails": 0,
        "num_courses": 522,
        "variations": " hsc",
        "longitude": "-78.460986",
        "courses_sanitized": true,
        "popular_courses": [
            "ENG 101",
            "MATH 141",
            "RHET 100",
            "RELI 103",
            "PSYC 101",
            "SPAN 103",
            "PHYS 135",
            "PSYCH 102",
            "HIST 101",
            "FINA 108",
            "BIO 101",
            "WCUL 103",
            "REL 103",
            "POL 101",
            "HON 101",
            "CHEM 230",
            "FRSM 185",
            "WCULT 102",
            "PSC 412",
            "ECON 101"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "dc",
        "school_color_one": "#000000",
        "banner_url": "https://farm6.staticflickr.com/5308/5702921261_1e8c033c87_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 22,
        "school_tiny_name": "DC",
        "id": 2613,
        "city": "Davidson",
        "num_popular_courses": 244,
        "state": "NC",
        "latitude": "35.502229",
        "population": 1790,
        "website": "www.davidson.edu",
        "banner_url_confirmed": false,
        "short_name": "Davidson",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/c/ca/Davidson_College_seal.png/200px-Davidson_College_seal.png",
        "school_mascot_name": "wildcat",
        "school_color_light": "#AC1A2F",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#AC1A2F",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/davidson-college_50x50.jpg",
        "num_depts": 91,
        "name": "Davidson College",
        "num_emails": 0,
        "num_courses": 1930,
        "variations": "will e. wildcat  (bronze sculpture; named for william lee davidson, the college's namesake). wildcats dc",
        "longitude": "-80.847465",
        "courses_sanitized": true,
        "popular_courses": [
            "MUS 141",
            "REL 256",
            "CHE 201",
            "PHY 130",
            "POL 102",
            "ANT 102",
            "BIO 112",
            "RUS 101",
            "FRE 103",
            "PHI 130",
            "ENG 391",
            "MAT 130",
            "SOC 205",
            "HIS 171",
            "EDU 121",
            "PSY 276",
            "ART 222",
            "CIS 171",
            "ENV 202",
            "ECO 202"
        ],
        "svg_url": "http://www.clker.com/cliparts/B/m/u/Y/z/Q/sheep-davidson-wildcats-team-colors-college-football.svg"
    },
    {
        "school_casual_name": "UDub",
        "school_color_one": "#4B2E83",
        "banner_url": "https://farm4.staticflickr.com/3783/13358889075_994654af13_o.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 73,
        "school_tiny_name": "UW",
        "id": 411,
        "city": "Seattle",
        "num_popular_courses": 608,
        "state": "WA",
        "latitude": "47.6553351",
        "population": 43485,
        "website": null,
        "banner_url_confirmed": true,
        "short_name": "UW",
        "seal_url": null,
        "school_mascot_name": "dubs",
        "school_color_light": "#85754D",
        "departments_sanitized": null,
        "school_color_dark": "#4B2E83",
        "school_color_primary": null,
        "school_color_two": "#85754D",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-washington-seattle-campus_50x50.jpg",
        "num_depts": 283,
        "name": "University of Washington",
        "num_emails": 0,
        "num_courses": 14082,
        "variations": " uws",
        "longitude": "-122.3035199",
        "courses_sanitized": true,
        "popular_courses": [
            "GEOG 123",
            "PSYCH 210",
            "SOC 287",
            "ESRM 100",
            "LING 200",
            "MUSIC 120",
            "ESS 102",
            "BIOL 200",
            "ASTR 150",
            "STAT 220",
            "CHEM 238",
            "COM 425",
            "BIOA 101",
            "MGMT 200",
            "WOMEN 200",
            "SIS 200",
            "INFO 101",
            "FIN 350",
            "NUTR 300",
            "BSTR 301"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/1/14/University_of_Washington_Seal.svg"
    },
    {
        "school_casual_name": "Cardinals",
        "school_color_one": "#C41E3A",
        "banner_url": "https://farm9.staticflickr.com/8490/8263061758_c8ff808508_b.jpg",
        "sp16_start": "Thu, 21 Jan 2016 00:00:00 -0000",
        "rank": 15,
        "school_tiny_name": "WU",
        "id": 2213,
        "city": "Middletown",
        "num_popular_courses": 74,
        "state": "CT",
        "latitude": "41.5566104",
        "population": 3262,
        "website": "wesleyan.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Cardinal",
        "school_color_light": "#C41E3A",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#000000",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/wesleyan-university_50x50.jpg",
        "num_depts": 74,
        "name": "Wesleyan University",
        "num_emails": 0,
        "num_courses": 2001,
        "variations": "cardinals wu",
        "longitude": "-72.6569041",
        "courses_sanitized": true,
        "popular_courses": [
            "EES 197",
            "AMST 217",
            "PSYCH 260",
            "ENG 112",
            "NSB 324",
            "PSYC 101",
            "GOVT 107",
            "ECON 123",
            "SOC 152",
            "ANTH 277",
            "HIST 217",
            "COL 103",
            "MBB 181",
            "AFAM 176",
            "LANG 01",
            "BIO 205",
            "ARTS 439",
            "MUSC 101",
            "HST 238",
            "ENGL 237"
        ],
        "svg_url": "https://en.wikipedia.org/wiki/File:Wesleyan_University_Shield.svg"
    },
    {
        "school_casual_name": "gtown",
        "school_color_one": "#011E41",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/2/24/Georgetown_Riverview.jpg",
        "sp16_start": "Tue, 05 Jan 2016 00:00:00 -0000",
        "rank": 28,
        "school_tiny_name": "GU",
        "id": 2264,
        "city": "Washington",
        "num_popular_courses": 798,
        "state": "DC",
        "latitude": "38.9076089",
        "population": 17357,
        "website": "www.georgetown.edu",
        "banner_url_confirmed": true,
        "short_name": "Georgetown",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/0/08/Georgetown_University_Seal.svg/220px-Georgetown_University_Seal.svg.png",
        "school_mascot_name": "bulldog",
        "school_color_light": "#867875",
        "departments_sanitized": true,
        "school_color_dark": "#011E41",
        "school_color_primary": null,
        "school_color_two": "#867875",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/georgetown-university_50x50.jpg",
        "num_depts": 135,
        "name": "Georgetown University",
        "num_emails": 0,
        "num_courses": 7464,
        "variations": "jack the bulldog hoyas gu",
        "longitude": "-77.0722585",
        "courses_sanitized": true,
        "popular_courses": [
            "COSC 010",
            "INAF 508",
            "CHEM 012",
            "JUPS 402",
            "PHIL 004",
            "HIST 122",
            "OPIM 250",
            "NURS 050",
            "THEO 017",
            "FINC 150",
            "HESY 010",
            "PSYC 140",
            "BIOL 013",
            "FREN 011",
            "GOVT 354",
            "JAPN 011",
            "MPRE 641",
            "PHYS 013",
            "SEST 630",
            "ACCT 181"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/0/08/Georgetown_University_Seal.svg"
    },
    {
        "school_casual_name": "Orange",
        "school_color_one": "#FF5A00",
        "banner_url": "https://farm3.staticflickr.com/2936/13902901630_aca7f41ffa_b.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 158,
        "school_tiny_name": "Cuse",
        "id": 2,
        "city": "Syracuse",
        "num_popular_courses": 754,
        "state": "NY",
        "latitude": "43.0391534",
        "population": 21029,
        "website": "www.syr.edu",
        "banner_url_confirmed": false,
        "short_name": "'Cuse",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/a/ad/Syracuse_University_Seal.svg/220px-Syracuse_University_Seal.svg.png",
        "school_mascot_name": "Otto the Orange",
        "school_color_light": null,
        "departments_sanitized": true,
        "school_color_dark": null,
        "school_color_primary": null,
        "school_color_two": null,
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/syracuse-university_50x50.jpg",
        "num_depts": 229,
        "name": "Syracuse University",
        "num_emails": 0,
        "num_courses": 6570,
        "variations": "otto the orange orange su 'cuse",
        "longitude": "-76.1351158",
        "courses_sanitized": true,
        "popular_courses": [
            "PAF 101",
            "PSY 315",
            "CLS 105",
            "HST 101",
            "COM 101",
            "CIE 600",
            "ART 113",
            "BIO 355",
            "ANT 185",
            "CHE 113",
            "ECS 102",
            "WGS 230",
            "PSC 329",
            "MAE 251",
            "EAR 117",
            "LIN 201",
            "REL 103",
            "CSE 681",
            "AAS 138",
            "ACC 356"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/2/28/Syracuse_University_Letters.svg"
    },
    {
        "school_casual_name": "princeton",
        "school_color_one": "#000000",
        "banner_url": "https://farm4.staticflickr.com/3792/11227389016_a91469543e_k.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 4,
        "school_tiny_name": "Prin",
        "id": 2502,
        "city": "Princeton",
        "num_popular_courses": 96,
        "state": "NJ",
        "latitude": "40.3439888",
        "population": 7975,
        "website": "princeton.edu",
        "banner_url_confirmed": true,
        "short_name": "Princeton",
        "seal_url": null,
        "school_mascot_name": "tiger",
        "school_color_light": "#ee7f2d",
        "departments_sanitized": null,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "black",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/princeton-university_50x50.jpg",
        "num_depts": 96,
        "name": "Princeton University",
        "num_emails": 4436,
        "num_courses": 232,
        "variations": "tigers pu",
        "longitude": "-74.6514481",
        "courses_sanitized": true,
        "popular_courses": [
            "ENG 111",
            "POL 316",
            "CHV 310",
            "EEB 211",
            "CLA 208",
            "FRS 105",
            "STAT 101",
            "ECO 100",
            "PHI 203",
            "PSY 207",
            "REL 261",
            "CHM 231",
            "ELE 203",
            "ECON 101",
            "PHY 105",
            "AAS 391",
            "MAE 000",
            "ART 219",
            "MAT 201",
            "COS 109"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/a/ae/Princeton_University_Shield.svg"
    },
    {
        "school_casual_name": "Ursinus Bears",
        "school_color_one": "#990000",
        "banner_url": "https://farm4.staticflickr.com/3235/3028973430_c2360ce608_z.jpg",
        "sp16_start": "Mon, 18 Jan 2016 00:00:00 -0000",
        "rank": 193,
        "school_tiny_name": "UC",
        "id": 2444,
        "city": "Collegeville",
        "num_popular_courses": 124,
        "state": "PA",
        "latitude": "40.1942068",
        "population": 1680,
        "website": "official website",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/3/34/Ursinus_College_seal.png/200px-Ursinus_College_seal.png",
        "school_mascot_name": "Ursinus Grizzly Bear",
        "school_color_light": "#FFC600",
        "departments_sanitized": true,
        "school_color_dark": "#990000",
        "school_color_primary": null,
        "school_color_two": "#FFC600",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/ursinus-college_50x50.jpg",
        "num_depts": 120,
        "name": "Ursinus College",
        "num_emails": 0,
        "num_courses": 1345,
        "variations": "ursinus bears uc",
        "longitude": "-75.4580225",
        "courses_sanitized": true,
        "popular_courses": [
            "POL 218",
            "HIST 207",
            "SOC 100",
            "CHEM 206",
            "BIO 101",
            "BE 210",
            "JPN 101",
            "ENG 201",
            "ART 104",
            "MATH 112",
            "PSYCH 210",
            "MCS 102",
            "CST 200",
            "LS 100",
            "THEA 100",
            "ANTH 100",
            "ESS 100",
            "IDS 102",
            "PHIL 100",
            "PHYS 112"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "knox",
        "school_color_one": "#6C2DC7",
        "banner_url": "https://farm6.staticflickr.com/5322/8795697191_3f8d8e7da3_k.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 149,
        "school_tiny_name": "Knox",
        "id": 2554,
        "city": "Galesburg",
        "num_popular_courses": 110,
        "state": "IL",
        "latitude": "40.9416833",
        "population": 1430,
        "website": null,
        "banner_url_confirmed": true,
        "short_name": "Knox",
        "seal_url": null,
        "school_mascot_name": "Prairie Fire",
        "school_color_light": "#FDD017",
        "departments_sanitized": true,
        "school_color_dark": "#6C2DC7",
        "school_color_primary": null,
        "school_color_two": "#FDD017",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/knox-college_50x50.jpg",
        "num_depts": 48,
        "name": "Knox College",
        "num_emails": 0,
        "num_courses": 850,
        "variations": " kc",
        "longitude": "-90.3713045",
        "courses_sanitized": true,
        "popular_courses": [
            "BIO 120",
            "CHEM 205",
            "ANSO 101",
            "ENG 206",
            "ENVS 101",
            "LAT 101",
            "MATH 210",
            "BIOL 319",
            "ECON 110",
            "GRK 101",
            "MUS 145",
            "CS 141",
            "GWST 101",
            "HIST 107",
            "PHIL 115",
            "PHYS 205",
            "PS 210",
            "PSYC 201",
            "SPAN 201",
            "ART 119"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/3/39/CoA_Knox_College_Dunedin.svg"
    },
    {
        "school_casual_name": "Purdue",
        "school_color_one": "#D7B527",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/2/27/EngineeringMall.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 119,
        "school_tiny_name": "Purd",
        "id": 2512,
        "city": "West lafayette",
        "num_popular_courses": 1289,
        "state": "IN",
        "latitude": "40.4237054",
        "population": 40393,
        "website": "www.purdue.edu",
        "banner_url_confirmed": true,
        "short_name": "Purdue",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/c/c6/Purdue_University_Seal.svg/225px-Purdue_University_Seal.svg.png",
        "school_mascot_name": "Boilermakers",
        "school_color_light": "#D7B527",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#000000",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/purdue-university-main-campus_50x50.jpg",
        "num_depts": 146,
        "name": "Purdue University",
        "num_emails": 0,
        "num_courses": 6283,
        "variations": "boilermakers purdue pu",
        "longitude": "-86.9211946",
        "courses_sanitized": true,
        "popular_courses": [
            "MA 154",
            "BIOL 121",
            "ENGR 116",
            "CPB 85602",
            "EAS 120",
            "BIO 121",
            "CS 235",
            "EDCI 270",
            "CSR 332",
            "MGMT 455",
            "SOC 419",
            "MET 242",
            "HIST 371",
            "COM 102",
            "AD 105",
            "AGRY 375",
            "AGEC 331",
            "POL 231",
            "MATH 154",
            "CGT 116"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/4/40/Purdue_University_logo.svg"
    },
    {
        "school_casual_name": "Clarkies, Cougars",
        "school_color_one": "#000000",
        "banner_url": "https://farm7.staticflickr.com/6227/6336242210_1b42da7e7c_b.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 146,
        "school_tiny_name": "CU",
        "id": 2553,
        "city": "Worcester",
        "num_popular_courses": 348,
        "state": "MA",
        "latitude": "42.250386",
        "population": 3503,
        "website": "www.clarku.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Cougar",
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/clark-university_50x50.jpg",
        "num_depts": 60,
        "name": "Clark University",
        "num_emails": 0,
        "num_courses": 1560,
        "variations": "clarkies, cougars cu",
        "longitude": "-71.8222312",
        "courses_sanitized": true,
        "popular_courses": [
            "ENT 245",
            "ENG 205",
            "GOVT 050",
            "MGMT 101",
            "PSYC 109",
            "MPA 3740",
            "PSYCH 109",
            "PSTD 101",
            "CHEM 103",
            "COMM 101",
            "SOC 205",
            "SCRN 121",
            "PHIL 103",
            "HIST 011",
            "GOV 050",
            "BIO 137",
            "JS 117",
            "GEOG 011",
            "ARTH 010",
            "ECON 205"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "(\"Bennington College\",bennington)",
        "school_color_one": "#e9d66b",
        "banner_url": "https://farm8.staticflickr.com/7051/6833833736_77fc1bee26_z.jpg",
        "sp16_start": "Thu, 01 Sep 2016 00:00:00 -0000",
        "rank": 125,
        "school_tiny_name": "BC",
        "id": 2361,
        "city": "Bennington",
        "num_popular_courses": 5,
        "state": "VT",
        "latitude": "42.9238904",
        "population": 826,
        "website": "www.bennington.edu/",
        "banner_url_confirmed": false,
        "short_name": "Bennington",
        "seal_url": null,
        "school_mascot_name": "No official mascot",
        "school_color_light": "#e9d66b",
        "departments_sanitized": true,
        "school_color_dark": "#757575",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/bennington-college_50x50.jpg",
        "num_depts": 36,
        "name": "Bennington College",
        "num_emails": 0,
        "num_courses": 5,
        "variations": "no official mascot bc",
        "longitude": "-73.2415581",
        "courses_sanitized": false,
        "popular_courses": [
            "LIT 4370",
            "MATH 101",
            "PSYCH 101",
            "PRINT 2000",
            "BIO 101"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "(\"Juniata College\",juniata)",
        "school_color_one": "#9e9165",
        "banner_url": "https://farm3.staticflickr.com/2668/4147273779_494f151ddb_z.jpg",
        "sp16_start": "Mon, 18 Jan 2016 00:00:00 -0000",
        "rank": 133,
        "school_tiny_name": "JC",
        "id": 2620,
        "city": "Huntingdon",
        "num_popular_courses": 81,
        "state": "PA",
        "latitude": "40.4994634",
        "population": 1565,
        "website": "www.juniata.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/5/5f/Juniata_College_seal.jpg",
        "school_mascot_name": "Eagles",
        "school_color_light": "#9e9165",
        "departments_sanitized": true,
        "school_color_dark": "#1b2f54",
        "school_color_primary": null,
        "school_color_two": "#1b2f54",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/juniata-college_50x50.jpg",
        "num_depts": 45,
        "name": "Juniata College",
        "num_emails": 0,
        "num_courses": 1480,
        "variations": "eagles jc",
        "longitude": "-78.0166127",
        "courses_sanitized": true,
        "popular_courses": [
            "ED 110",
            "PS 102",
            "HS 115",
            "PC 201",
            "AR 110",
            "EN 110",
            "CH 250",
            "SO 243",
            "CS 101",
            "MA 115",
            "PY 309",
            "BIO 2",
            "CM 130",
            "CA 201",
            "BI 105",
            "PL 115",
            "SP 210",
            "TH 399",
            "OCC 1",
            "CHEM 121"
        ],
        "svg_url": "https://www.juniata.edu/_resources/images/Juniata-logo.svg"
    },
    {
        "school_casual_name": null,
        "school_color_one": "#C41E3A",
        "banner_url": "https://farm3.staticflickr.com/2909/14174165655_f322fee969_z.jpg",
        "sp16_start": "Wed, 24 Aug 2016 00:00:00 -0000",
        "rank": 145,
        "school_tiny_name": "OWU",
        "id": 2346,
        "city": "Delaware",
        "num_popular_courses": 179,
        "state": "OH",
        "latitude": "40.2959764",
        "population": 1819,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/0/06/Wesleyansealnew.png/200px-Wesleyansealnew.png",
        "school_mascot_name": "The Battling Bishop",
        "school_color_light": "#C41E3A",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#000000",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/ohio-wesleyan-university_50x50.jpg",
        "num_depts": 51,
        "name": "Ohio Wesleyan University",
        "num_emails": 0,
        "num_courses": 1772,
        "variations": " owu",
        "longitude": "-83.0678456",
        "courses_sanitized": true,
        "popular_courses": [
            "ART 110",
            "REL 151",
            "BOMI 125",
            "GEOL 110",
            "EMAN 210",
            "ENG 260",
            "PHIL 110",
            "PSYC 252",
            "EDU 110",
            "HMCL 124",
            "JOUR 350",
            "MATH 105",
            "PHYS 110",
            "SPAN 254",
            "PG 210",
            "ASTR 111",
            "HIST 115",
            "MUS 002",
            "ECON 255",
            "CHEM 11011"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/3/31/Wesleyan_University_Shield.svg"
    },
    {
        "school_casual_name": null,
        "school_color_one": "#40484B",
        "banner_url": "https://farm1.staticflickr.com/59/179446664_6e4d6b8d1b_z.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 168,
        "school_tiny_name": "TCNJ",
        "id": 2686,
        "city": "Ewing",
        "num_popular_courses": 284,
        "state": "NJ",
        "latitude": "40.2688352",
        "population": 7270,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": "TCNJ",
        "seal_url": null,
        "school_mascot_name": "Roscoe the Lion",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/the-college-of-new-jersey_50x50.jpg",
        "num_depts": 117,
        "name": "The College of New Jersey",
        "num_emails": 0,
        "num_courses": 1385,
        "variations": " tcnj",
        "longitude": "-74.78091",
        "courses_sanitized": true,
        "popular_courses": [
            "LIT 226",
            "BIO 141",
            "IDS 252",
            "JPW 208",
            "REL 100",
            "COM 172",
            "POL 230",
            "PSY 267",
            "SCI 111",
            "CSC 215",
            "ECO 301",
            "HIS 210",
            "IMM 120",
            "MKT 371",
            "CRI 100",
            "ECE 102",
            "SED 224",
            "ANT 111",
            "FSP 124",
            "MIT 320"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Polar Bears",
        "school_color_one": "#000000",
        "banner_url": "https://farm6.staticflickr.com/5655/20532023721_43b79d8275_z.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 14,
        "school_tiny_name": "BC",
        "id": 2638,
        "city": "Brunswick",
        "num_popular_courses": 237,
        "state": "ME",
        "latitude": "43.9067324",
        "population": 1839,
        "website": "bowdoin.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/a/af/Bowdoin_College_Seal.png",
        "school_mascot_name": "Polar Bear",
        "school_color_light": "black",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "black",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/bowdoin-college_50x50.jpg",
        "num_depts": 40,
        "name": "Bowdoin College",
        "num_emails": 0,
        "num_courses": 411,
        "variations": "polar bear polar bears bc",
        "longitude": "-69.9637933",
        "courses_sanitized": true,
        "popular_courses": [
            "CHEM 101",
            "ECON 255",
            "GOV 250",
            "PHIL 223",
            "PSYCH 211",
            "BIO 105",
            "WST 101",
            "SPAN 203",
            "REL 101",
            "MATH 200",
            "HIST 139",
            "ENG 210",
            "EDU 101",
            "PHYSICS 103",
            "CS 210",
            "CHIN 101",
            "ITAL 101",
            "ED 101",
            "ES 203",
            "RUS 101"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Fighting Scots",
        "school_color_one": "#E3A31D",
        "banner_url": "https://farm8.staticflickr.com/7698/16576120764_65b02194b8_z.jpg",
        "sp16_start": null,
        "rank": 136,
        "school_tiny_name": "CW",
        "id": 2679,
        "city": "Wooster",
        "num_popular_courses": 146,
        "state": "OH",
        "latitude": "40.810544",
        "population": 2080,
        "website": "www.wooster.educollege of woosteru.s. national register of historic placesu.s. historic districtlocationoh 3, wooster, ohiobuilt1900architectural\\u00a0stylelate gothic revival, other, collegiate gothicgoverning bodyprivatenrhp\\u00a0reference\\u00a0#80003246[2]added to nrhpfebruary 25, 1980",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Fighting Scots",
        "school_color_light": "#E3A31D",
        "departments_sanitized": true,
        "school_color_dark": "black",
        "school_color_primary": null,
        "school_color_two": "black",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/the-college-of-wooster_50x50.jpg",
        "num_depts": 41,
        "name": "College of Wooster",
        "num_emails": 0,
        "num_courses": 584,
        "variations": "fighting scots cw",
        "longitude": "-81.93583",
        "courses_sanitized": true,
        "popular_courses": [
            "CHIN 101",
            "GEO 100",
            "SPAN 202",
            "MUS 101",
            "BIO 201",
            "BUEC 119",
            "EDUC 100",
            "ANTH 101",
            "GRK 101",
            "PSYC 101",
            "PSCI 120",
            "PHIL 100",
            "FREN 220",
            "ECON 202",
            "CHEM 215",
            "MATH 108",
            "CLWR 181",
            "SOAN 342",
            "CALC 111",
            "HIST 111"
        ],
        "svg_url": "http://share.uakron.edu/global/includes/images/UA_k_285.svg"
    },
    {
        "school_casual_name": "(\"University of Puget Sound\",pugetsound)",
        "school_color_one": "maroon",
        "banner_url": "https://farm1.staticflickr.com/225/501211882_dc3d29bd9b_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 181,
        "school_tiny_name": "UPS",
        "id": 2735,
        "city": "Tacoma",
        "num_popular_courses": 213,
        "state": "WA",
        "latitude": "47.2620315",
        "population": 2853,
        "website": "www.pugetsound.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/a/ad/UofPS_seal.png/175px-UofPS_seal.png",
        "school_mascot_name": "\"Grizz\" the Logger",
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "maroon",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-puget-sound_50x50.jpg",
        "num_depts": 41,
        "name": "University of Puget Sound",
        "num_emails": 0,
        "num_courses": 1162,
        "variations": "\"grizz\" the logger ups",
        "longitude": "-122.4816819",
        "courses_sanitized": true,
        "popular_courses": [
            "HIST 153",
            "FREN 201",
            "PG 104",
            "COMM 107",
            "ECON 104",
            "MUS 231",
            "ART 278",
            "PHIL 224",
            "CSOC 130",
            "PSYC 201",
            "BUS 290",
            "ENGL 127",
            "EXSC 221",
            "HON 101",
            "PHYS 299",
            "REL 125",
            "SPAN 203",
            "ENVR 110",
            "THTR 217",
            "CHEM 460"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "(\"Pitzer College\",pitzer)",
        "school_color_one": "#ffa500",
        "banner_url": "https://farm4.staticflickr.com/3109/2393514962_d2a99526b3_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 104,
        "school_tiny_name": "Pitz",
        "id": 2627,
        "city": "Claremont",
        "num_popular_courses": 3,
        "state": "CA",
        "latitude": "34.1046694",
        "population": 1084,
        "website": "www.pitzer.edu",
        "banner_url_confirmed": false,
        "short_name": "Pitzer",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/d/d3/Pitzer_College_seal.jpg/250px-Pitzer_College_seal.jpg",
        "school_mascot_name": "Cecil the Sagehen",
        "school_color_light": "#ffa500",
        "departments_sanitized": true,
        "school_color_dark": "#757575",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/pitzer-college_50x50.jpg",
        "num_depts": 97,
        "name": "Pitzer College",
        "num_emails": 0,
        "num_courses": 1403,
        "variations": "cecil the sagehen pc",
        "longitude": "-117.7047392",
        "courses_sanitized": false,
        "popular_courses": [
            "Hist 172",
            "ANTH 12",
            "MATH 108"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Blazers",
        "school_color_one": "#008000",
        "banner_url": "https://farm1.staticflickr.com/58/177916965_f73fec3927_z.jpg",
        "sp16_start": "Wed, 20 Jan 2016 00:00:00 -0000",
        "rank": 92,
        "school_tiny_name": "Elms",
        "id": 2672,
        "city": "Chicopee",
        "num_popular_courses": 16,
        "state": "MA",
        "latitude": "42.1418736",
        "population": 1196,
        "website": "www.elms.edu",
        "banner_url_confirmed": false,
        "short_name": "Elms",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/60/Elmscollegeseal.png/150px-Elmscollegeseal.png",
        "school_mascot_name": "Bolt",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#008000",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/earlham-college_50x50.jpg",
        "num_depts": 52,
        "name": "Elms College",
        "num_emails": 0,
        "num_courses": 543,
        "variations": "blazers ec",
        "longitude": "-72.6010718",
        "courses_sanitized": false,
        "popular_courses": [
            "BIO 123",
            "HIS 103",
            "ART 101",
            "ENG 381",
            "SPA 201",
            "CIT 256",
            "CSD 201",
            "EDU 100",
            "MAT 108",
            "PHI 101",
            "FYS 101",
            "ACC 101"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "rice",
        "school_color_one": "#002469",
        "banner_url": "https://farm4.staticflickr.com/3819/13368228293_80293f6765_b.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 32,
        "school_tiny_name": "Rice",
        "id": 1869,
        "city": "Houston",
        "num_popular_courses": 116,
        "state": "TX",
        "latitude": "29.7173941",
        "population": 6484,
        "website": "www.rice.edu",
        "banner_url_confirmed": false,
        "short_name": "Rice",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/c/c7/Rice_University_seal.svg/225px-Rice_University_seal.svg.png",
        "school_mascot_name": "Sammy the Owl",
        "school_color_light": "#5e6062",
        "departments_sanitized": true,
        "school_color_dark": "#002469",
        "school_color_primary": null,
        "school_color_two": "#5e6062",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/rice-university_50x50.jpg",
        "num_depts": 98,
        "name": "Rice University",
        "num_emails": 0,
        "num_courses": 4290,
        "variations": "sammy the owl owls ru",
        "longitude": "-95.4018312",
        "courses_sanitized": true,
        "popular_courses": [
            "BIOS 201",
            "MGMT 636",
            "ECON 211",
            "POLI 212",
            "CHEM 211",
            "ESCI 101",
            "HIST 101",
            "PHYS 111",
            "MATH 355",
            "MECH 211",
            "RELI 101",
            "SOCI 334",
            "COMP 360",
            "ELEC 242",
            "PHIL 202",
            "PSYC 101",
            "ARAB 301",
            "ASTR 201",
            "SPAN 202",
            "CAAM 378"
        ],
        "svg_url": "https://library.rice.edu/~fondren/sites/all/themes/bootstrap/fondren_subtheme/templates/Rice-Fondren.svg"
    },
    {
        "school_casual_name": "UCI",
        "school_color_one": "#012667",
        "banner_url": "https://farm4.staticflickr.com/3071/2764872936_e101d6e804_z.jpg",
        "sp16_start": "Mon, 28 Mar 2016 00:00:00 -0000",
        "rank": 144,
        "school_tiny_name": "UC-I",
        "id": 1716,
        "city": "Irvine",
        "num_popular_courses": 311,
        "state": "CA",
        "latitude": "33.6404952",
        "population": 27479,
        "website": "www.uci.edu",
        "banner_url_confirmed": false,
        "short_name": "UC Irvine",
        "seal_url": null,
        "school_mascot_name": "Anteaters",
        "school_color_light": "#F8DE5D",
        "departments_sanitized": true,
        "school_color_dark": "#012667",
        "school_color_primary": null,
        "school_color_two": "#F8DE5D",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-california-irvine_50x50.jpg",
        "num_depts": 197,
        "name": "University of California at Irvine",
        "num_emails": 7072,
        "num_courses": 5646,
        "variations": "anteaters uci uc uc irvine",
        "longitude": "-117.8442962",
        "courses_sanitized": true,
        "popular_courses": [
            "SOC 63",
            "CBEMS 155",
            "E 3",
            "MGMT 1",
            "ECON 115",
            "ECE 10",
            "BME 1",
            "C 144",
            "SE 13",
            "ICS 142",
            "PSB 162",
            "DANCE 3",
            "EDU 107",
            "MAE 91",
            "MBA 603",
            "ESS 53",
            "BIO 158",
            "FE 225",
            "WRITING 37",
            "ANTHR 41"
        ],
        "svg_url": "http://www.career.uci.edu/images/icons/header-wordmark-UCI.svg"
    },
    {
        "school_casual_name": "umich",
        "school_color_one": "#01274B",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/1/15/University_of_Michigan_College_of_Pharmacy_exterior.JPG",
        "sp16_start": "Wed, 06 Jan 2016 00:00:00 -0000",
        "rank": 29,
        "school_tiny_name": "UM",
        "id": 2575,
        "city": "Ann arbor",
        "num_popular_courses": 24,
        "state": "MI",
        "latitude": "42.2780436",
        "population": 283954,
        "website": "www.umich.edu",
        "banner_url_confirmed": true,
        "short_name": "Michigan",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/b/b8/Umichigan_color_seal.png/200px-Umichigan_color_seal.png",
        "school_mascot_name": "wolverine",
        "school_color_light": "#FECA31",
        "departments_sanitized": true,
        "school_color_dark": "#01274B",
        "school_color_primary": null,
        "school_color_two": "#FECA31",
        "forbes_url": null,
        "logo_url": "//upload.wikimedia.org/wikipedia/en/thumb/b/b8/Umichigan_color_seal.png/200px-Umichigan_color_seal.png",
        "num_depts": 234,
        "name": "University of Michigan ",
        "num_emails": 0,
        "num_courses": 6443,
        "variations": "wolverines uom",
        "longitude": "-83.7382241",
        "courses_sanitized": false,
        "popular_courses": [
            "BIO 310",
            "ENG 308",
            "ANTHR 101",
            "AC 405",
            "POLSC 160",
            "ANTH 101",
            "HIS 241",
            "POLISCI 111",
            "WOMENSTD 220",
            "ITAL 231",
            "SPANISH 103",
            "PSY 270",
            "SP 232",
            "RELIGION 280",
            "PHYSI 260"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/c/c5/University_of_Michigan_wordmark.svg"
    },
    {
        "school_casual_name": "Leopards",
        "school_color_one": "#822433",
        "banner_url": "https://farm8.staticflickr.com/7421/13721405453_8757f66efc_z.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 48,
        "school_tiny_name": "Lafa",
        "id": 1682,
        "city": "Easton",
        "num_popular_courses": 176,
        "state": "PA",
        "latitude": "40.6998781",
        "population": 2488,
        "website": "www.lafayette.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/3/31/Seal_of_Lafayette_College.png",
        "school_mascot_name": "Leopard",
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "#822433",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/lafayette-college_50x50.jpg",
        "num_depts": 58,
        "name": "Lafayette College",
        "num_emails": 0,
        "num_courses": 982,
        "variations": "leopards lc",
        "longitude": "-75.2079449",
        "courses_sanitized": true,
        "popular_courses": [
            "MUS 103",
            "MUSIC 103",
            "VAST 248",
            "ECON 319",
            "CS 103",
            "FYS 138",
            "MATH 263",
            "PSYCH 203",
            "GEO 100",
            "CHEM 221",
            "PHYS 111",
            "PSYC 120",
            "NEURO 201",
            "SOC 101",
            "CE 271",
            "ENG 110",
            "GOVT 102",
            "HIST 106",
            "REL 102",
            "THTR 201"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "creighton",
        "school_color_one": "#0054A6",
        "banner_url": "https://farm9.staticflickr.com/8002/7269786608_b6c4021e63_o.jpg",
        "sp16_start": "Wed, 13 Jan 2016 00:00:00 -0000",
        "rank": 156,
        "school_tiny_name": "CU",
        "id": 2408,
        "city": "Omaha",
        "num_popular_courses": 364,
        "state": "NE",
        "latitude": "41.2650114",
        "population": 7736,
        "website": "www.creighton.edu",
        "banner_url_confirmed": true,
        "short_name": "Creighton",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/b/bf/CUSeal.svg/200px-CUSeal.svg.png",
        "school_mascot_name": "bluejay",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#0054A6",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/creighton-university_50x50.jpg",
        "num_depts": 139,
        "name": "Creighton University",
        "num_emails": 0,
        "num_courses": 5245,
        "variations": "billy the bluejay bluejays cu",
        "longitude": "-95.9477073",
        "courses_sanitized": true,
        "popular_courses": [
            "PHY 107",
            "THL 205",
            "MTH 135",
            "EDU 101",
            "BIO 211",
            "HIS 107",
            "HAP 200",
            "EXS 240",
            "FIN 325",
            "MGT 385",
            "JPN 101",
            "JMC 111",
            "PLS 215",
            "BUS 301",
            "CHM 286",
            "ITA 101",
            "PSY 313",
            "ANT 352",
            "ART 271",
            "FRN 202"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/b/bf/CUSeal.svg"
    },
    {
        "school_casual_name": "Billikens",
        "school_color_one": "#0000CC",
        "banner_url": "https://farm8.staticflickr.com/7757/17392116042_184d229b1e_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 191,
        "school_tiny_name": "SLU",
        "id": 2310,
        "city": "Saint louis",
        "num_popular_courses": 473,
        "state": "MO",
        "latitude": "38.6365275",
        "population": 17640,
        "website": "www.slu.edu",
        "banner_url_confirmed": false,
        "short_name": "SLU",
        "seal_url": null,
        "school_mascot_name": "Billiken",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#0000CC",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/saint-louis-university-main-campus_50x50.jpg",
        "num_depts": 13,
        "name": "Saint Louis University",
        "num_emails": 3573,
        "num_courses": 720,
        "variations": "billiken billikens slu",
        "longitude": "-90.2331213",
        "courses_sanitized": true,
        "popular_courses": [
            "ANAT 100",
            "POLS 110",
            "MGT 218",
            "IB 200",
            "CHEM 161",
            "SOC 110",
            "EAS 101",
            "ACCT 322",
            "PHIL 105",
            "PLS 100",
            "IPE 110",
            "MGTB 218",
            "ECON 314",
            "BLA 104",
            "BIO 110",
            "MKT 300",
            "PHYS 131",
            "PSY 313",
            "ARTH 100",
            "CSP 125"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "mit",
        "school_color_one": "#A31F34",
        "banner_url": "https://upload.wikimedia.org/wikipedia/en/9/9d/MIT_Kresge_Auditorium.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 5,
        "school_tiny_name": "MIT",
        "id": 463,
        "city": "Cambridge",
        "num_popular_courses": 46,
        "state": "MA",
        "latitude": "42.360091",
        "population": 11189,
        "website": "mit.edu",
        "banner_url_confirmed": true,
        "short_name": "MIT",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/4/44/MIT_Seal.svg/200px-MIT_Seal.svg.png",
        "school_mascot_name": "beaver",
        "school_color_light": "#8A8B8C",
        "departments_sanitized": true,
        "school_color_dark": "#A31F34",
        "school_color_primary": null,
        "school_color_two": "#8A8B8C",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/massachusetts-institute-of-technology_50x50.jpg",
        "num_depts": 1,
        "name": "Massachusetts Institute of Technology",
        "num_emails": 1036,
        "num_courses": 92,
        "variations": "tim the beaver[8] engineers[7] mit",
        "longitude": "-71.09416",
        "courses_sanitized": false,
        "popular_courses": [
            "CMS 610",
            "MATH 1802",
            "BIO 7012",
            "ESD 34",
            "CHEM 3091",
            "EECS 6002",
            "OCW 1801",
            "LING 900",
            "PHYS 101",
            "UNIF 1601",
            "ARCH 301",
            "PHY 802",
            "AA 391",
            "BE 330",
            "ENG 101",
            "SIX 777",
            "PHYSL 01",
            "LJ 111",
            "PSYCH 101",
            "CALC 1802"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/4/44/MIT_Seal.svg"
    },
    {
        "school_casual_name": "Knights",
        "school_color_one": "#fed141",
        "banner_url": "https://farm1.staticflickr.com/222/481072621_10eec74be1_b.jpg",
        "sp16_start": "Mon, 28 Mar 2016 00:00:00 -0000",
        "rank": 16,
        "school_tiny_name": "CC",
        "id": 495,
        "city": "Northfield",
        "num_popular_courses": 135,
        "state": "MN",
        "latitude": "44.461333",
        "population": 2055,
        "website": "www.carleton.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/6d/Carletoncollegeseal.png/220px-Carletoncollegeseal.png",
        "school_mascot_name": "Knight",
        "school_color_light": "#fed141",
        "departments_sanitized": true,
        "school_color_dark": "#012169",
        "school_color_primary": null,
        "school_color_two": "#012169",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/carleton-college_50x50.jpg",
        "num_depts": 60,
        "name": "Carleton College",
        "num_emails": 0,
        "num_courses": 1033,
        "variations": "knights cc",
        "longitude": "-93.1556063",
        "courses_sanitized": true,
        "popular_courses": [
            "ECON 102",
            "CHEM 233",
            "CS 111",
            "POSC 122",
            "MUSC 121",
            "LCST 245",
            "RELG 110",
            "SOAN 110",
            "AMST 115",
            "CLAS 110",
            "HIST 161",
            "CALC 111",
            "PSYC 260",
            "MUSIC 81",
            "BIO 125",
            "LING 110",
            "PSYCH 110",
            "ENGL 110",
            "MATH 121",
            "PHIL 110"
        ],
        "svg_url": "http://www.campusprideindex.org/img/Laurel.svg"
    },
    {
        "school_casual_name": null,
        "school_color_one": "#ED1C2E",
        "banner_url": "https://farm5.staticflickr.com/4064/4516682366_6d22335cfe_b.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 131,
        "school_tiny_name": "RPI",
        "id": 511,
        "city": "Troy",
        "num_popular_courses": 239,
        "state": "NY",
        "latitude": "42.730172",
        "population": 6658,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": "RPI",
        "seal_url": null,
        "school_mascot_name": null,
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#ED1C2E",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/rensselaer-polytechnic-institute_50x50.jpg",
        "num_depts": 43,
        "name": "Rensselaer Polytechnic Institute",
        "num_emails": 0,
        "num_courses": 1626,
        "variations": " rpi",
        "longitude": "-73.6788026",
        "courses_sanitized": true,
        "popular_courses": [
            "ENGR 1300",
            "PSYC 1200",
            "WRIT 2340",
            "CSCI 2300",
            "PHYS 2510",
            "BIOL 2500",
            "MANE 4220",
            "MGMT 2510",
            "ECON 4130",
            "MATP 4700",
            "MATH 4600",
            "COMM 2610",
            "CHME 2010",
            "STSS 1110",
            "PHIL 2140",
            "MTLE 2100",
            "ARTS 4510",
            "BMED 2100",
            "CHEM 4530",
            "ECSE 4670"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/5/5a/Rensselaer_Polytechnic_Institute_coat_of_arms.svg"
    },
    {
        "school_casual_name": "furman",
        "school_color_one": "#582C83",
        "banner_url": "https://farm8.staticflickr.com/7641/16861180309_38bafc6844_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 100,
        "school_tiny_name": "Furm",
        "id": 539,
        "city": "Greenville",
        "num_popular_courses": 470,
        "state": "SC",
        "latitude": "34.9245893",
        "population": 2915,
        "website": "www.furman.edu",
        "banner_url_confirmed": false,
        "short_name": "Furman",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/9/9e/Furman_U_Seal.png/150px-Furman_U_Seal.png",
        "school_mascot_name": "paladin",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#582C83",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/furman-university_50x50.jpg",
        "num_depts": 48,
        "name": "Furman University",
        "num_emails": 0,
        "num_courses": 1025,
        "variations": "paladin paladins fu",
        "longitude": "-82.4391367",
        "courses_sanitized": true,
        "popular_courses": [
            "MUS 16",
            "CHM 110",
            "EES 11",
            "BA 51",
            "BIO 11",
            "HST 152",
            "ART 26",
            "ANT 12",
            "FYS 1161",
            "PHY 26",
            "PS 13",
            "FR 11",
            "BUS 450",
            "CS 12",
            "THEATER 11",
            "HUM 11",
            "REL 12",
            "ECN 111",
            "HES 30",
            "CHEM 18"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/b/bd/PaladinsLogo.svg"
    },
    {
        "school_casual_name": "Bearcats",
        "school_color_one": "#C41E3A",
        "banner_url": "https://farm7.staticflickr.com/6089/6156380502_df5999801d_z.jpg",
        "sp16_start": "Sun, 17 Jan 2016 00:00:00 -0000",
        "rank": 130,
        "school_tiny_name": "WU",
        "id": 564,
        "city": "Salem",
        "num_popular_courses": 204,
        "state": "OR",
        "latitude": "44.9371219",
        "population": 2931,
        "website": "willamette.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/60/WillametteUniversitySeal.png/225px-WillametteUniversitySeal.png",
        "school_mascot_name": "Blitz",
        "school_color_light": "#CFB53B",
        "departments_sanitized": true,
        "school_color_dark": "#C41E3A",
        "school_color_primary": null,
        "school_color_two": "#CFB53B",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/willamette-university_50x50.jpg",
        "num_depts": 43,
        "name": "Willamette University",
        "num_emails": 0,
        "num_courses": 1013,
        "variations": "blitz bearcats wu",
        "longitude": "-123.0318004",
        "courses_sanitized": true,
        "popular_courses": [
            "AES 150",
            "POLI 212",
            "REL 115",
            "SOC 114",
            "ANTH 235",
            "ARTS 117",
            "PHIL 110",
            "SPAN 132",
            "CS 130",
            "THTR 110",
            "HIST 119",
            "BIOL 110",
            "ARTH 213",
            "ECON 123",
            "JAPN 231",
            "MATH 141",
            "PHYS 221",
            "RHET 261",
            "BIO 210",
            "IDS 138"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "WPI",
        "school_color_one": "#AC2B37",
        "banner_url": "https://upload.wikimedia.org/wikipedia/en/7/79/Earle_Bridge.jpg",
        "sp16_start": "Thu, 14 Jan 2016 00:00:00 -0000",
        "rank": 173,
        "school_tiny_name": "WPI",
        "id": 791,
        "city": "Worcester",
        "num_popular_courses": 266,
        "state": "MA",
        "latitude": "42.2738556",
        "population": 5957,
        "website": "www.wpi.edu",
        "banner_url_confirmed": true,
        "short_name": "Worcester Poly",
        "seal_url": null,
        "school_mascot_name": "goat",
        "school_color_light": "#A9B0B7",
        "departments_sanitized": null,
        "school_color_dark": "#AC2B37",
        "school_color_primary": null,
        "school_color_two": "#A9B0B7",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/worcester-polytechnic-institute_50x50.jpg",
        "num_depts": 67,
        "name": "Worcester Polytechnic Institute",
        "num_emails": 0,
        "num_courses": 1632,
        "variations": "gompei the goat engineers wpi",
        "longitude": "-71.8059756",
        "courses_sanitized": true,
        "popular_courses": [
            "OBC 500",
            "CE 2000",
            "MA 1020",
            "CS 504",
            "BB 1035",
            "ECE 2312",
            "ME 3320",
            "BUS 1010",
            "EN 1222",
            "HI 1341",
            "CH 1040",
            "ES 3011",
            "PH 1130",
            "ACC 1100",
            "MU 1611",
            "SD 1510",
            "ECON 1110",
            "BME 3111",
            "AR 2101",
            "GE 2341"
        ],
        "svg_url": "http://users.wpi.edu/~sps/images/WPI-Logo.svg"
    },
    {
        "school_casual_name": "aurora",
        "school_color_one": "#002366",
        "banner_url": "https://farm8.staticflickr.com/7141/6483535475_02a7f6a326_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 150,
        "school_tiny_name": "AU",
        "id": 576,
        "city": "Aurora",
        "num_popular_courses": 148,
        "state": "IL",
        "latitude": "41.7544406",
        "population": 15170,
        "website": "www.aurora.edu",
        "banner_url_confirmed": false,
        "short_name": "Aurora",
        "seal_url": null,
        "school_mascot_name": "spartan",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#002366",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/fordham-university_50x50.jpg",
        "num_depts": 40,
        "name": "Aurora University",
        "num_emails": 0,
        "num_courses": 1596,
        "variations": "spartans au",
        "longitude": "-88.3500398",
        "courses_sanitized": true,
        "popular_courses": [
            "BUS 3220",
            "FIN 3400",
            "NUR 3400",
            "EDU 5480",
            "PSC 110",
            "SWK 1100",
            "IDS 3810",
            "MBA 6080",
            "CRJ 2500",
            "SOC 2150",
            "HIST 3100",
            "MKT 2300",
            "ENG 102",
            "CSC 110",
            "FRN 1810",
            "NSM 1150",
            "PSY 3350",
            "MTH 1100",
            "COM 350",
            "ECN 2030"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Baylor",
        "school_color_one": "#003015",
        "banner_url": "https://farm8.staticflickr.com/7407/13961824238_0d38ab4ef6_b.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 195,
        "school_tiny_name": "Bayl",
        "id": 592,
        "city": "Waco",
        "num_popular_courses": 241,
        "state": "TX",
        "latitude": "31.5482204",
        "population": 15364,
        "website": "www.baylor.edu",
        "banner_url_confirmed": false,
        "short_name": "Baylor",
        "seal_url": "//upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Baylor_Seal.png/187px-Baylor_Seal.png",
        "school_mascot_name": "bear",
        "school_color_light": "#fecb00",
        "departments_sanitized": true,
        "school_color_dark": "#003015",
        "school_color_primary": null,
        "school_color_two": "#fecb00",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/baylor-university_50x50.jpg",
        "num_depts": 124,
        "name": "Baylor University",
        "num_emails": 0,
        "num_courses": 3152,
        "variations": "judge joy & judge lady (live bears)bruiser (costumed) bears / lady bears bu",
        "longitude": "-97.1184377",
        "courses_sanitized": true,
        "popular_courses": [
            "CST 1303",
            "BIO 1305",
            "BUS 1301",
            "ECO 1301",
            "GEOG 1300",
            "CSS 1301",
            "NSC 1306",
            "PHP 1106",
            "HED 4327",
            "PSC 1305",
            "PSY 2402",
            "CSI 3334",
            "EDP 6336",
            "EDC 6336",
            "MIS 3305",
            "TED 4341",
            "CHEM 1316",
            "HISTORY 1307",
            "MATH 1301",
            "EGR 1301"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/b/b7/Baylor_University_mark.svg"
    },
    {
        "school_casual_name": "u miami",
        "school_color_one": "#005030",
        "banner_url": "https://farm1.staticflickr.com/56/191543218_cf4b16aef8_b.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 128,
        "school_tiny_name": "Miam",
        "id": 619,
        "city": "Coral gables",
        "num_popular_courses": 882,
        "state": "FL",
        "latitude": "25.7179436",
        "population": 16172,
        "website": "www.miami.edu",
        "banner_url_confirmed": false,
        "short_name": "U Miami",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/4/44/UMiamiSeal.svg/200px-UMiamiSeal.svg.png",
        "school_mascot_name": "hurricane",
        "school_color_light": "#f47321",
        "departments_sanitized": null,
        "school_color_dark": "#005030",
        "school_color_primary": null,
        "school_color_two": "#f47321",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-miami_50x50.jpg",
        "num_depts": 153,
        "name": "University of Miami",
        "num_emails": 0,
        "num_courses": 7935,
        "variations": "sebastian the ibis hurricanes um the u",
        "longitude": "-80.2781784",
        "courses_sanitized": true,
        "popular_courses": [
            "BME 265",
            "MMI 378",
            "CIS 150",
            "HCS 212",
            "MCY 124",
            "MKT 340",
            "KIN 212",
            "MSC 230",
            "REL 111",
            "GER 101",
            "CSC 220",
            "ART 510",
            "BIL 268",
            "DAN 211",
            "GSC 101",
            "POL 348",
            "PSY 215",
            "SOC 375",
            "TAL 101",
            "CHM 304"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "st marys",
        "school_color_one": "#06315B",
        "banner_url": "https://farm6.staticflickr.com/5068/5628673161_4faedf55a1_o.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 162,
        "school_tiny_name": "Mary",
        "id": 640,
        "city": "Notre dame",
        "num_popular_courses": 2,
        "state": "IN",
        "latitude": "41.7067",
        "population": 509,
        "website": null,
        "banner_url_confirmed": true,
        "short_name": "St Marys",
        "seal_url": null,
        "school_mascot_name": "Gael",
        "school_color_light": "#D80024",
        "departments_sanitized": true,
        "school_color_dark": "#06315B",
        "school_color_primary": null,
        "school_color_two": "#D80024",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/st-johns-college-md_50x50.jpg",
        "num_depts": 48,
        "name": "Saint Mary's College",
        "num_emails": 0,
        "num_courses": 1655,
        "variations": " smc",
        "longitude": "-86.2570",
        "courses_sanitized": false,
        "popular_courses": [
            "BIO 103",
            "PHIL 101"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "clemson",
        "school_color_one": "#F4673C",
        "banner_url": "https://farm1.staticflickr.com/29/88611481_3fef7a6c94_o.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 182,
        "school_tiny_name": "CU",
        "id": 638,
        "city": "Clemson",
        "num_popular_courses": 482,
        "state": "SC",
        "latitude": "34.6774642",
        "population": 6029,
        "website": "www.clemson.edu",
        "banner_url_confirmed": true,
        "short_name": "Clemson",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/9/9c/Clemson_University_Seal.svg/200px-Clemson_University_Seal.svg.png",
        "school_mascot_name": "Tigers",
        "school_color_light": "#F4673C",
        "departments_sanitized": true,
        "school_color_dark": "#51307E",
        "school_color_primary": null,
        "school_color_two": "#51307E",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/elon-university_50x50.jpg",
        "num_depts": 180,
        "name": "Clemson University",
        "num_emails": 0,
        "num_courses": 4710,
        "variations": "tigers tigers cu",
        "longitude": "-82.8361914",
        "courses_sanitized": true,
        "popular_courses": [
            "BIOL 110",
            "PSYCH 306",
            "BIOSC 303",
            "FIN 308",
            "MICRO 205",
            "ACCT 204",
            "MTHSC 111",
            "ENT 200",
            "SOC 388",
            "PHIL 326",
            "CHIN 101",
            "HIST 122",
            "HLTH 340",
            "MKT 428",
            "ECON 310",
            "REL 102",
            "NURS 320",
            "NUTR 205",
            "ANTH 301",
            "PHYS 221"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/4/47/Clemson_University_Wordmark.svg"
    },
    {
        "school_casual_name": "pepperdine",
        "school_color_one": "#002663",
        "banner_url": "https://farm5.staticflickr.com/4112/4960536677_8505b8c240_b.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 112,
        "school_tiny_name": "Pepp",
        "id": 675,
        "city": "Malibu",
        "num_popular_courses": 226,
        "state": "CA",
        "latitude": "34.0414045",
        "population": 7319,
        "website": "www.pepperdine.edu",
        "banner_url_confirmed": false,
        "short_name": "Pepperdine",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/1/1c/Pepperdine_University_seal.png/200px-Pepperdine_University_seal.png",
        "school_mascot_name": "wave",
        "school_color_light": "#EA7125",
        "departments_sanitized": true,
        "school_color_dark": "#002663",
        "school_color_primary": null,
        "school_color_two": "#EA7125",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/pepperdine-university_50x50.jpg",
        "num_depts": 73,
        "name": "Pepperdine University",
        "num_emails": 0,
        "num_courses": 1217,
        "variations": "willy the wave waves pu",
        "longitude": "-118.7095814",
        "courses_sanitized": true,
        "popular_courses": [
            "ECON 200",
            "ART 315",
            "JOUR 241",
            "FRE 252",
            "MATH 140",
            "REL 526",
            "ADV 575",
            "BA 210",
            "PHYS 211",
            "PSYC 250",
            "COM 200",
            "GSHU 199",
            "PR 380",
            "SAAJ 121",
            "CRWR 203",
            "ASIA 592",
            "INTS 514",
            "POSC 518",
            "SPAN 252",
            "ENG 300"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Crusaders[13]",
        "school_color_one": "#164274",
        "banner_url": "https://farm4.staticflickr.com/3801/13798234623_f01bc180e2_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 212,
        "school_tiny_name": "UD",
        "id": 672,
        "city": "Irving",
        "num_popular_courses": 79,
        "state": "TX",
        "latitude": "32.845549",
        "population": 2576,
        "website": "www.udallas.edu",
        "banner_url_confirmed": false,
        "short_name": "UD",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/3/3d/UDallas_seal.png/200px-UDallas_seal.png",
        "school_mascot_name": "Crusaders",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#164274",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-dallas_50x50.jpg",
        "num_depts": 79,
        "name": "University of Dallas",
        "num_emails": 0,
        "num_courses": 2748,
        "variations": "crusaders[13] ud",
        "longitude": "-96.9194984",
        "courses_sanitized": true,
        "popular_courses": [
            "POL 1311",
            "PHIL 3334",
            "GST 3165",
            "WESTCIV 1",
            "LITTRAD 4",
            "PHI 1301",
            "MIT 1301",
            "CHEM 3321",
            "PSY 1311",
            "MSP 2311",
            "BUS 1301",
            "ECO 1311",
            "ENG 1301",
            "HIS 2302",
            "MAT 2305",
            "PHY 1301",
            "PHYS 1301",
            "HIST 2302",
            "THE 1310",
            "BIO 1311"
        ],
        "svg_url": "http://upload.wikimedia.org/wikipedia/commons/b/b4/Roman_Catholic_Diocese_of_Dallas.svg"
    },
    {
        "school_casual_name": "Hawks",
        "school_color_one": "navy",
        "banner_url": "https://farm9.staticflickr.com/8145/7657522366_398978f83b_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 189,
        "school_tiny_name": "SAC",
        "id": 686,
        "city": "Manchester",
        "num_popular_courses": 42,
        "state": "NH",
        "latitude": "42.9874723",
        "population": 1954,
        "website": "www.anselm.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Hawk",
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "navy",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/saint-anselm-college_50x50.jpg",
        "num_depts": 61,
        "name": "Saint Anselm College",
        "num_emails": 0,
        "num_courses": 1005,
        "variations": "hawk hawks sac",
        "longitude": "-71.5072307",
        "courses_sanitized": false,
        "popular_courses": [
            "PH 5",
            "HU 01",
            "HUM 1",
            "BIO 107",
            "CH 131",
            "HUMAN 1",
            "PY 15",
            "PHIL 105",
            "PSYC 101",
            "ML 5152",
            "EN 04",
            "PSYCH 101",
            "SP 150",
            "ECON 101",
            "CHEM 131",
            "CL 350",
            "STAT 201",
            "HI 399",
            "ENG 101",
            "PS 132"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/c/cf/Anselm_of_Canterbury,_seal_(SVG).svg"
    },
    {
        "school_casual_name": "(\"Harvey Mudd College\",hmc)",
        "school_color_one": "black",
        "banner_url": "https://farm1.staticflickr.com/50/140183951_02aee39434_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 52,
        "school_tiny_name": "Mudd",
        "id": 697,
        "city": "Claremont",
        "num_popular_courses": 93,
        "state": "CA",
        "latitude": "34.106067",
        "population": 784,
        "website": "www.hmc.edu",
        "banner_url_confirmed": false,
        "short_name": "Mudd",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/65/Hmc_seal.svg/150px-Hmc_seal.svg.png",
        "school_mascot_name": "Official:\\u00a0\\u00a0Men's, Stag\\u00a0\\u00a0Women's, AthenasUnofficial:\\u00a0\\u00a0Wally Wart",
        "school_color_light": "#ffcc00",
        "departments_sanitized": true,
        "school_color_dark": "black",
        "school_color_primary": null,
        "school_color_two": "#ffcc00",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/harvey-mudd-college_50x50.jpg",
        "num_depts": 23,
        "name": "Harvey Mudd College",
        "num_emails": 0,
        "num_courses": 403,
        "variations": "official:\\u00a0\\u00a0men's, stag\\u00a0\\u00a0women's, athenasunofficial:\\u00a0\\u00a0wally wart hmc mudd",
        "longitude": "-117.7093147",
        "courses_sanitized": true,
        "popular_courses": [
            "CS 5",
            "E 101",
            "MATH 171",
            "ASTRO 62",
            "MUS 88",
            "ENG 82",
            "PHYS 52",
            "CHEM 56",
            "HIST 128",
            "MS 050",
            "SOSC 180",
            "HUM 101",
            "LIT 103",
            "Physics 24",
            "PHIL 102",
            "HSA 10",
            "ENGR 79",
            "BIO 113",
            "CSCI 105",
            "ECON 104"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "uf",
        "school_color_one": "#FF4A00",
        "banner_url": "https://farm8.staticflickr.com/7292/9087630866_3a878a211a_k.jpg",
        "sp16_start": "Tue, 05 Jan 2016 00:00:00 -0000",
        "rank": 87,
        "school_tiny_name": "UF",
        "id": 702,
        "city": "Gainesville",
        "num_popular_courses": 521,
        "state": "FL",
        "latitude": "29.6436325",
        "population": 49913,
        "website": "ufl.edu",
        "banner_url_confirmed": true,
        "short_name": "Florida",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/5/53/University_of_Florida_Seal.png/200px-University_of_Florida_Seal.png",
        "school_mascot_name": "gators",
        "school_color_light": "#FF4A00",
        "departments_sanitized": null,
        "school_color_dark": "#0021A5",
        "school_color_primary": null,
        "school_color_two": "#0021A5",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-florida_50x50.jpg",
        "num_depts": 358,
        "name": "University of Florida",
        "num_emails": 0,
        "num_courses": 9591,
        "variations": "albert and alberta florida gators uf",
        "longitude": "-82.3549302",
        "courses_sanitized": true,
        "popular_courses": [
            "ECO 2013",
            "MAR 3023",
            "WIS 2040",
            "ECP 3703",
            "BUL 4310",
            "PLP 2000",
            "MGF 1106",
            "COM 1000",
            "GLY 1102",
            "ACG 2021",
            "ENY 2040",
            "STA 2023",
            "GEO 2200",
            "APK 2105",
            "JOU 3101",
            "GEB 3113",
            "POS 2112",
            "CLA 3160",
            "URP 3001",
            "PPE 3003"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/3/36/University_of_Florida_Logo.svg"
    },
    {
        "school_casual_name": null,
        "school_color_one": "#40484B",
        "banner_url": "https://farm3.staticflickr.com/2930/13959832964_a7887395d1_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 115,
        "school_tiny_name": "L&C",
        "id": 723,
        "city": "Portland",
        "num_popular_courses": 189,
        "state": "OR",
        "latitude": "45.4522016",
        "population": 3702,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Pio",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/lewis-clark-college_50x50.jpg",
        "num_depts": 38,
        "name": "Lewis & Clark College",
        "num_emails": 0,
        "num_courses": 960,
        "variations": "",
        "longitude": "-122.6774855",
        "courses_sanitized": true,
        "popular_courses": [
            "HIST 120",
            "PHYS 151",
            "ENG 201",
            "RELS 254",
            "SOAN 225",
            "BIO 361",
            "ART 152",
            "CHEM 105",
            "CS 171",
            "GERM 201",
            "PSY 100",
            "SPAN 301",
            "POLS 101",
            "ECON 103",
            "ENVS 220",
            "IA 212",
            "MUS 101",
            "PE 101",
            "RHMS 200",
            "CORE 106"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/2/20/Lewis-Clark_State_College_logo.svg"
    },
    {
        "school_casual_name": "Raptors[3]",
        "school_color_one": "#BE0F34",
        "banner_url": "https://farm4.staticflickr.com/3447/3827882947_7eea7fffd8_z.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 35,
        "school_tiny_name": "Bard",
        "id": 718,
        "city": "Annandale-on-hudson",
        "num_popular_courses": 216,
        "state": "NY",
        "latitude": "42.0224313",
        "population": 2504,
        "website": "bard.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/commons/thumb/3/33/Bard_College_Seal.png/200px-Bard_College_Seal.png",
        "school_mascot_name": null,
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "#BE0F34",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/barnard-college_50x50.jpg",
        "num_depts": 58,
        "name": "Bard College",
        "num_emails": 0,
        "num_courses": 713,
        "variations": "raptors[3] bc",
        "longitude": "-73.9065313",
        "courses_sanitized": true,
        "popular_courses": [
            "BIO 201",
            "ARTH 201",
            "PHIL 120",
            "FILM 167",
            "ANTH 101",
            "CHEM 202",
            "GER 200",
            "PSY 103",
            "PS 105",
            "RUS 101",
            "SOC 254",
            "REL 103",
            "CMSC 201",
            "HR 101",
            "HIST 130",
            "WARTS 100",
            "ECON 201",
            "PAINT 1",
            "LIT 140",
            "PHYS 221"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "WFU",
        "school_color_one": "#9E7E38",
        "banner_url": "https://farm4.staticflickr.com/3151/3053503377_05003369e7_b.jpg",
        "sp16_start": "Tue, 12 Jan 2016 00:00:00 -0000",
        "rank": 61,
        "school_tiny_name": "Wake",
        "id": 732,
        "city": "Winston salem",
        "num_popular_courses": 56,
        "state": "NC",
        "latitude": "36.1298424",
        "population": 7432,
        "website": "www.wfu.edu",
        "banner_url_confirmed": false,
        "short_name": "Wake Forest",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/e/e4/Wake_Forest_University_Seal.svg/200px-Wake_Forest_University_Seal.svg.png",
        "school_mascot_name": "deacon",
        "school_color_light": "#9E7E38",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#000000",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/wake-forest-university_50x50.jpg",
        "num_depts": 70,
        "name": "Wake Forest University",
        "num_emails": 0,
        "num_courses": 1556,
        "variations": "the demon deacon demon deacons wfu",
        "longitude": "-80.2814496",
        "courses_sanitized": true,
        "popular_courses": [
            "ENG 150",
            "ART 111",
            "PHY 262",
            "SPA 213",
            "BIO 214",
            "SOC 154",
            "SPN 213",
            "ECON 150",
            "JPN 111",
            "CHM 111",
            "CLA 261",
            "CSC 221",
            "ECN 150",
            "HST 102",
            "REL 102",
            "FYS 100",
            "LAT 111",
            "MGT 4130",
            "QUANT 1",
            "CHEM 123"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/1/1a/Wake_Forest_University_Athletic_logo.svg"
    },
    {
        "school_casual_name": "unc",
        "school_color_one": "#68A1D0",
        "banner_url": "https://farm6.staticflickr.com/5446/9439980996_41af5e4a7b_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 50,
        "school_tiny_name": "Chap",
        "id": 734,
        "city": "Chapel hill",
        "num_popular_courses": 479,
        "state": "NC",
        "latitude": "35.908746",
        "population": 29278,
        "website": "www.unc.edu",
        "banner_url_confirmed": false,
        "short_name": "Chapel hill",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/4/4d/UNC_Chapel_Hill_seal.svg/200px-UNC_Chapel_Hill_seal.svg.png",
        "school_mascot_name": "tar heel",
        "school_color_light": "#FAFDFD",
        "departments_sanitized": true,
        "school_color_dark": "#68A1D0",
        "school_color_primary": null,
        "school_color_two": "#FAFDFD",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-north-carolina-at-chapel-hill_50x50.jpg",
        "num_depts": 185,
        "name": "University of North Carolina Chapel Hill",
        "num_emails": 1236,
        "num_courses": 5818,
        "variations": "rameses unc chapel hill uncch",
        "longitude": "-79.0295977",
        "courses_sanitized": true,
        "popular_courses": [
            "PLCY 101",
            "ECON 400",
            "COMP 426",
            "DRAM 116",
            "BUSI 101",
            "MCRO 251",
            "PHIL 112",
            "HIST 226",
            "CHEM 430",
            "RELI 181",
            "BIOC 107",
            "GEOL 105",
            "POLI 202",
            "ANTH 146",
            "MATH 110",
            "MUSC 144",
            "NAVS 302",
            "CLAR 120",
            "GLBL 210",
            "ENGL 440"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/4/4d/UNC_Chapel_Hill_seal.svg"
    },
    {
        "school_casual_name": "(\"Amherst College\",amherst)",
        "school_color_one": "#492E7F",
        "banner_url": "https://farm1.staticflickr.com/50/114225228_517d967679_z.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 10,
        "school_tiny_name": "Amhe",
        "id": 798,
        "city": "Amherst",
        "num_popular_courses": 195,
        "state": "MA",
        "latitude": "42.3709104",
        "population": 1817,
        "website": "amherst.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/65/Amherst_College_Seal.svg/200px-Amherst_College_Seal.svg.png",
        "school_mascot_name": "Lord Jeffery Amherst",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#492E7F",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/amherst-college_50x50.jpg",
        "num_depts": 51,
        "name": "Amherst College",
        "num_emails": 0,
        "num_courses": 1012,
        "variations": " ac",
        "longitude": "-72.5170028",
        "courses_sanitized": true,
        "popular_courses": [
            "LJST 18",
            "GEO 11",
            "ECON 58",
            "SPAN 3",
            "THDA 13",
            "FRENCH 7",
            "SOC 11",
            "PSYCH 22",
            "CHEM 21",
            "POSC 45",
            "ENG 84",
            "MATH 12",
            "FYSE 19",
            "RUSS 22",
            "PHIL 33",
            "MUS 18",
            "PSYC 11",
            "BIO 14",
            "GEOL 11",
            "FIAR 32"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/6/65/Amherst_College_Seal.svg"
    },
    {
        "school_casual_name": "brandeis",
        "school_color_one": "#151B54",
        "banner_url": "https://farm5.staticflickr.com/4063/4690102834_99abf2ee1b_b.jpg",
        "sp16_start": "Wed, 13 Jan 2016 00:00:00 -0000",
        "rank": 74,
        "school_tiny_name": "BB",
        "id": 753,
        "city": "Waltham",
        "num_popular_courses": 99,
        "state": "MA",
        "latitude": "42.3654347",
        "population": 5808,
        "website": "www.brandeis.edu",
        "banner_url_confirmed": false,
        "short_name": "Brandeis",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/e/ef/BrandeisUnivSeal.png/200px-BrandeisUnivSeal.png",
        "school_mascot_name": "owl",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#151B54",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/brandeis-university_50x50.jpg",
        "num_depts": 100,
        "name": "Brandeis University",
        "num_emails": 0,
        "num_courses": 3724,
        "variations": "ollie the owl (named for justice oliver wendell holmes, jr.) judges beu",
        "longitude": "-71.258595",
        "courses_sanitized": true,
        "popular_courses": [
            "PHIL 100",
            "PHILE 100",
            "CHEM 25",
            "AMST 170",
            "ECON 202",
            "NEJS 115",
            "ENG 33",
            "NPSY 22",
            "USEM 51",
            "POL 14",
            "FREN 20",
            "WP 600",
            "LING 120",
            "BIOL 22",
            "HIST 170",
            "THA 100",
            "PHILS 4",
            "NBIO 140",
            "COSI 127",
            "LOGICE 101"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Wildcats",
        "school_color_one": "#003591",
        "banner_url": "https://farm9.staticflickr.com/8870/17339502026_f4e48ebfdc_b.jpg",
        "sp16_start": "Tue, 26 Jan 2016 00:00:00 -0000",
        "rank": 185,
        "school_tiny_name": "UNH",
        "id": 763,
        "city": "Durham",
        "num_popular_courses": 635,
        "state": "NH",
        "latitude": "43.138948",
        "population": 15267,
        "website": "www.unh.edu",
        "banner_url_confirmed": false,
        "short_name": "UNH",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/5/50/UNewHampshire_seal.png/200px-UNewHampshire_seal.png",
        "school_mascot_name": "Wild E. Cat, Gnarlz",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": null,
        "school_color_dark": "#003591",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-new-hampshire-main-campus_50x50.jpg",
        "num_depts": 143,
        "name": "University of New Hampshire",
        "num_emails": 0,
        "num_courses": 6602,
        "variations": "wild e. cat, gnarlz wildcats unh",
        "longitude": "-70.9370252",
        "courses_sanitized": true,
        "popular_courses": [
            "THDA 435",
            "JUST 405",
            "BMS 507",
            "KIN 706",
            "SOC 535",
            "CIE 402",
            "ME 441",
            "FS 545",
            "PHIL 447",
            "NR 433",
            "SW 550",
            "CLAS 401",
            "ANTH 415",
            "CHE 410",
            "CS 410",
            "NUTR 405",
            "OT 513",
            "ANSC 511",
            "POLT 568",
            "RMP 511"
        ],
        "svg_url": "http://www.unh.edu/sites/all/themes/custom/unh7_2b/images/logo.svg"
    },
    {
        "school_casual_name": "ga tech",
        "school_color_one": "#C49258",
        "banner_url": "https://farm9.staticflickr.com/8348/8246616230_ee1a3a2299_b.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 90,
        "school_tiny_name": "GT",
        "id": 756,
        "city": "Atlanta",
        "num_popular_courses": 236,
        "state": "GA",
        "latitude": "33.7756178",
        "population": 21557,
        "website": "gatech.edu",
        "banner_url_confirmed": false,
        "short_name": "Georgia Tech",
        "seal_url": "//upload.wikimedia.org/wikipedia/commons/thumb/f/fd/GeorgiaTechSeal.svg/220px-GeorgiaTechSeal.svg.png",
        "school_mascot_name": "yellow jacket",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#C49258",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/georgia-institute-of-technology-main-campus_50x50.jpg",
        "num_depts": 97,
        "name": "Georgia Institute of Technology",
        "num_emails": 0,
        "num_courses": 5903,
        "variations": "yellow jackets georgia tech git",
        "longitude": "-84.396285",
        "courses_sanitized": true,
        "popular_courses": [
            "CS 2110",
            "EAS 1600",
            "ID 2202",
            "INTA 2030",
            "MSE 3015",
            "AE 3125",
            "CHEM 2380",
            "MGT 3075",
            "ECON 2101",
            "LCC 3314",
            "SPAN 2002",
            "ECE 3025",
            "ISYE 2028",
            "APPH 1040",
            "GRMN 1002",
            "GT 1000",
            "BMED 3100",
            "FREN 1001",
            "ME 3017",
            "JAPN 1001"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/f/fd/GeorgiaTechSeal.svg"
    },
    {
        "school_casual_name": "OSU",
        "school_color_one": "#BB0000",
        "banner_url": "https://farm5.staticflickr.com/4143/4817522899_56b58928ba_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 155,
        "school_tiny_name": "OSU",
        "id": 786,
        "city": "Columbus",
        "num_popular_courses": 1060,
        "state": "OH",
        "latitude": "40.0141905",
        "population": 56387,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": "OSU",
        "seal_url": null,
        "school_mascot_name": "buckeye",
        "school_color_light": "#666666",
        "departments_sanitized": null,
        "school_color_dark": "#BB0000",
        "school_color_primary": null,
        "school_color_two": "#666666",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/ohio-state-university-main-campus_50x50.jpg",
        "num_depts": 209,
        "name": "Ohio State University",
        "num_emails": 15408,
        "num_courses": 1289,
        "variations": " tosu",
        "longitude": "-83.0309143",
        "courses_sanitized": true,
        "popular_courses": [
            "ENG 167",
            "EG 167",
            "EEOB 2520",
            "CSE 200",
            "CHEM 101",
            "BA 499",
            "SOCIALDANCE 1",
            "MICRO 509",
            "BIO 114",
            "ACCT 310",
            "PSYCH 333",
            "ISE 504",
            "ECON 200",
            "ENR 2100",
            "FIN 510",
            "ARCH 200",
            "SPAN 104",
            "MHR 701",
            "COMM 200",
            "ECONH 201"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/b/b4/Ohio_State_University_text_logo.svg"
    },
    {
        "school_casual_name": "presby",
        "school_color_one": "#A80436",
        "banner_url": "https://farm6.staticflickr.com/5216/5528317062_b5352d9121_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 142,
        "school_tiny_name": "PC",
        "id": 775,
        "city": "Clinton",
        "num_popular_courses": 72,
        "state": "SC",
        "latitude": "34.4651822",
        "population": 1403,
        "website": "presby.edu",
        "banner_url_confirmed": false,
        "short_name": "Presby",
        "seal_url": null,
        "school_mascot_name": "blue hose",
        "school_color_light": "#A80436",
        "departments_sanitized": true,
        "school_color_dark": "#0060AA",
        "school_color_primary": null,
        "school_color_two": "#0060AA",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/presbyterian-college_50x50.jpg",
        "num_depts": 53,
        "name": "Presbyterian College",
        "num_emails": 0,
        "num_courses": 944,
        "variations": "blue hose pc",
        "longitude": "-81.877559",
        "courses_sanitized": true,
        "popular_courses": [
            "CHEM 101",
            "MATH 108",
            "BIO 112",
            "BIOL 203",
            "BADM 315",
            "HIST 122",
            "PHYS 122",
            "RELG 101",
            "SPAN 151",
            "SOCY 101",
            "WORLDCIV 101",
            "ENG 110",
            "PSYCH 201",
            "ACCT 203",
            "ECON 201",
            "ENGL 110",
            "FREN 101",
            "MUSE 294",
            "PLSC 201",
            "PSYC 201"
        ],
        "svg_url": "http://www.pcci.edu/Images/Graphics/Logos/PensacolaChristianCollegeLogo.svg"
    },
    {
        "school_casual_name": null,
        "school_color_one": "#40484B",
        "banner_url": "https://farm8.staticflickr.com/7085/6922320828_a971034490_z.jpg",
        "sp16_start": "Mon, 09 May 2016 00:00:00 -0000",
        "rank": 165,
        "school_tiny_name": "Delt",
        "id": 782,
        "city": "University center",
        "num_popular_courses": 547,
        "state": "MI",
        "latitude": "42.9276377",
        "population": 1330,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Mustangs",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/beloit-college_50x50.jpg",
        "num_depts": 77,
        "name": "Delta College",
        "num_emails": 0,
        "num_courses": 1551,
        "variations": " dc",
        "longitude": "-85.5828738",
        "courses_sanitized": true,
        "popular_courses": [
            "CHM 210",
            "POL 225",
            "BIO 172",
            "ART 100",
            "CJ 210",
            "PHL 221",
            "HIST 221",
            "MUS 111",
            "ABS 097",
            "MTH 117",
            "GEO 111",
            "ASL 111",
            "MGT 265",
            "PHY 212",
            "CST 155",
            "ENG 115",
            "ACC 228",
            "LWA 113",
            "ECN 221",
            "DH 100"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "GWU",
        "school_color_one": "#004065",
        "banner_url": "https://farm1.staticflickr.com/200/457384513_2dd7416567_b.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 122,
        "school_tiny_name": "GWU",
        "id": 801,
        "city": "Washington",
        "num_popular_courses": 1015,
        "state": "DC",
        "latitude": "38.8997145",
        "population": 25653,
        "website": "www.gwu.edu",
        "banner_url_confirmed": false,
        "short_name": "GWU",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/3/30/George_Washington_University_seal.png/220px-George_Washington_University_seal.png",
        "school_mascot_name": "colonial",
        "school_color_light": "#C8B18B",
        "departments_sanitized": true,
        "school_color_dark": "#004065",
        "school_color_primary": null,
        "school_color_two": "#C8B18B",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/george-washington-university_50x50.jpg",
        "num_depts": 220,
        "name": "George Washington University",
        "num_emails": 0,
        "num_courses": 15067,
        "variations": "george, the colonial[6] colonials gwu",
        "longitude": "-77.0485992",
        "courses_sanitized": true,
        "popular_courses": [
            "BISC 2202",
            "STAT 1127",
            "CSCI 1121",
            "MBAD 223",
            "PSC 108",
            "PHIL 135",
            "ANTH 1003",
            "IAFF 90",
            "SUST 1001",
            "HIST 137",
            "AH 71",
            "COMM 25",
            "SMPA 1050",
            "MATH 52",
            "GEOG 2",
            "PSYC 3122",
            "APSC 115",
            "ACCY 121",
            "ECON 167",
            "REL 1001"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/de/6/6a/George_Washington_University_Logo.svg"
    },
    {
        "school_casual_name": "au",
        "school_color_one": "#DB551F",
        "banner_url": "https://farm5.staticflickr.com/4083/5006781837_d259de8dc6_b.jpg",
        "sp16_start": "Wed, 13 Jan 2016 00:00:00 -0000",
        "rank": 204,
        "school_tiny_name": "AU",
        "id": 835,
        "city": "Auburn",
        "num_popular_courses": 948,
        "state": "AL",
        "latitude": "32.5933574",
        "population": 25134,
        "website": "www.auburn.edu",
        "banner_url_confirmed": false,
        "short_name": "Auburn",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/7/7f/Auburn_University_seal.svg/200px-Auburn_University_seal.svg.png",
        "school_mascot_name": "tiger",
        "school_color_light": "#DB551F",
        "departments_sanitized": true,
        "school_color_dark": "#03244C",
        "school_color_primary": null,
        "school_color_two": "#03244C",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/auburn-university-main-campus_50x50.jpg",
        "num_depts": 141,
        "name": "Auburn University",
        "num_emails": 0,
        "num_courses": 6509,
        "variations": "tigers au au",
        "longitude": "-85.4951663",
        "courses_sanitized": true,
        "popular_courses": [
            "COMP 2210",
            "ACCT 2990",
            "ARCH 1000",
            "ECON 4100",
            "CHEM 1041",
            "HORT 2040",
            "BIOL 5500",
            "SCMH 1990",
            "FINC 3200",
            "HIST 1217",
            "CIVL 3310",
            "BCHE 3200",
            "MATL 2100",
            "POLI 3020",
            "CMDS 3000",
            "AERO 2200",
            "MECH 2220",
            "HDFS 4680",
            "COMM 3500",
            "CRIM 2000"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/b/bb/Auburn_University_Athletics_logo.svg"
    },
    {
        "school_casual_name": "Broncos",
        "school_color_one": "#93191B",
        "banner_url": "https://farm9.staticflickr.com/8563/15561192344_8c39f39498_b.jpg",
        "sp16_start": "Tue, 29 Mar 2016 00:00:00 -0000",
        "rank": 86,
        "school_tiny_name": "SCU",
        "id": 913,
        "city": "Santa clara",
        "num_popular_courses": 402,
        "state": "CA",
        "latitude": "37.3496418",
        "population": 8519,
        "website": "www.scu.edu",
        "banner_url_confirmed": false,
        "short_name": "SCU",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/a/ad/Santa_Clara_U_Seal.svg/200px-Santa_Clara_U_Seal.svg.png",
        "school_mascot_name": "Bucky the Bronco",
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "#93191B",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/santa-clara-university_50x50.jpg",
        "num_depts": 70,
        "name": "Santa Clara University",
        "num_emails": 0,
        "num_courses": 1931,
        "variations": "bucky the bronco broncos scu",
        "longitude": "-121.9389875",
        "courses_sanitized": true,
        "popular_courses": [
            "FNCE 135",
            "COEN 20",
            "ACTG 131",
            "ELEN 151",
            "MGMT 619",
            "RSOC 81",
            "HIST 84",
            "POLI 142",
            "AMTH 108",
            "OMIS 107",
            "COMM 30",
            "LBST 75",
            "MSIS 602",
            "PHIL 9",
            "MATH 52",
            "ECON 126",
            "MKTG 178",
            "PSYC 185",
            "TESP 88",
            "WGST 50"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/a/ad/Santa_Clara_U_Seal.svg"
    },
    {
        "school_casual_name": "CSM",
        "school_color_one": "#192366",
        "banner_url": "https://farm8.staticflickr.com/7513/15949686662_7cc6edb81d_b.jpg",
        "sp16_start": "Wed, 13 Jan 2016 00:00:00 -0000",
        "rank": 153,
        "school_tiny_name": "CSM",
        "id": 953,
        "city": "Golden",
        "num_popular_courses": 146,
        "state": "CO",
        "latitude": "39.7512306",
        "population": 5721,
        "website": "www.mines.edu",
        "banner_url_confirmed": false,
        "short_name": "Colorado",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/d/d2/CSMines_seal.png",
        "school_mascot_name": "orediggers",
        "school_color_light": "#C0C0C0",
        "departments_sanitized": true,
        "school_color_dark": "#192366",
        "school_color_primary": null,
        "school_color_two": "#C0C0C0",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/colorado-school-of-mines_50x50.jpg",
        "num_depts": 36,
        "name": "Colorado School of Mines",
        "num_emails": 0,
        "num_courses": 1733,
        "variations": "orediggers csm csm",
        "longitude": "-105.2226523",
        "courses_sanitized": true,
        "popular_courses": [
            "EBGN 201",
            "CHEM 1",
            "CHGN 121",
            "MACS 407",
            "EGGN 381",
            "EPIC 151",
            "PEGN 308",
            "PHGN 200",
            "CHEN 421",
            "CEEN 311",
            "CSCI 101",
            "DCGN 209",
            "MATH 225",
            "LAW 101",
            "SYGN 200",
            "CALC 3",
            "CR 421",
            "BELS 101",
            "PHYSICS 2",
            "PHYS 200"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/0/00/Seal_of_Colorado.svg"
    },
    {
        "school_casual_name": "byu",
        "school_color_one": "#002255",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/b/bf/Harold_B._Lee_Library.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 79,
        "school_tiny_name": "BYU",
        "id": 999,
        "city": "Provo",
        "num_popular_courses": 647,
        "state": "UT",
        "latitude": "40.2518435",
        "population": 34409,
        "website": null,
        "banner_url_confirmed": true,
        "short_name": "BYU",
        "seal_url": null,
        "school_mascot_name": "cougar",
        "school_color_light": "#C5AF7D",
        "departments_sanitized": true,
        "school_color_dark": "#002255",
        "school_color_primary": null,
        "school_color_two": "#C5AF7D",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/brigham-young-university_50x50.jpg",
        "num_depts": 199,
        "name": "Brigham Young University",
        "num_emails": 0,
        "num_courses": 5653,
        "variations": " byup",
        "longitude": "-111.6493156",
        "courses_sanitized": true,
        "popular_courses": [
            "FINANCE 201",
            "CHUM 284",
            "SOC 112",
            "BUSM 241",
            "VA 115",
            "PDBIO 305",
            "ELANG 223",
            "CS 142",
            "SPAN 106",
            "BIO 100",
            "TMA 150",
            "COMMS 101",
            "CHEM 107",
            "ACC 210",
            "SFL 102",
            "ARTHC 202",
            "ECON 110",
            "PSYCH 111",
            "CHIN 302",
            "NDFS 100"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/e/e7/BYU_Medallion_Logo.svg"
    },
    {
        "school_casual_name": "Hawkeyes",
        "school_color_one": "#000000",
        "banner_url": "https://farm5.staticflickr.com/4112/5180502342_b44283a12b_b.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 192,
        "school_tiny_name": "Iowa",
        "id": 976,
        "city": "Iowa city",
        "num_popular_courses": 210,
        "state": "IA",
        "latitude": "41.6626963",
        "population": 30129,
        "website": "uiowa.edu",
        "banner_url_confirmed": false,
        "short_name": "U Iowa",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/a/a4/UI-seal.png",
        "school_mascot_name": "Herky the Hawk",
        "school_color_light": "#ffe100",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#ffe100",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-iowa_50x50.jpg",
        "num_depts": 414,
        "name": "University of Iowa",
        "num_emails": 74,
        "num_courses": 11662,
        "variations": "herky the hawk hawkeyes ui",
        "longitude": "-91.5548998",
        "courses_sanitized": true,
        "popular_courses": [
            "ACCT 132",
            "CS 180",
            "ECON 1100",
            "STAT 1030",
            "CHEM 111",
            "MATH 013",
            "ECE 2400",
            "MGMT 2000",
            "POLI 1200",
            "LING 100",
            "RHET 003",
            "COMM 065",
            "PSY 015",
            "MKTG 3000",
            "SOC 1010",
            "ASTR 1070",
            "GEOG 105",
            "PHIL 034",
            "ANTH 003",
            "FIN 117"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/d/d2/University_of_Iowa_logo.svg"
    },
    {
        "school_casual_name": "Big Red",
        "school_color_one": "#B31B1B",
        "banner_url": "https://farm4.staticflickr.com/3186/2716197764_de5f47b0b6_z.jpg",
        "sp16_start": "Fri, 22 Jan 2016 00:00:00 -0000",
        "rank": 31,
        "school_tiny_name": "Corn",
        "id": 1015,
        "city": "Ithaca",
        "num_popular_courses": 570,
        "state": "NY",
        "latitude": "42.4534492",
        "population": 21424,
        "website": "www.cornell.edu",
        "banner_url_confirmed": false,
        "short_name": "Cornell",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/b/bc/Cornell_Seal.svg/200px-Cornell_Seal.svg.png",
        "school_mascot_name": "Touchdown the Bear (unofficial)[6]",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#B31B1B",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/cornell-university_50x50.jpg",
        "num_depts": 181,
        "name": "Cornell University",
        "num_emails": 6993,
        "num_courses": 7071,
        "variations": "touchdown the bear (unofficial)[6] big red cu",
        "longitude": "-76.4735027",
        "courses_sanitized": true,
        "popular_courses": [
            "CS 1112",
            "NS 1150",
            "AEM 1200",
            "MEDVL 1101",
            "CHEM 2510",
            "SOC 1101",
            "ANSC 1100",
            "PSYCH 2090",
            "MAE 4700",
            "BIOG 1440",
            "ARTH 1136",
            "HD 3620",
            "CLASS 2604",
            "DSOC 1101",
            "NTRES 3100",
            "CHIN 1101",
            "EAS 1540",
            "GOVT 1817",
            "BEE 1510",
            "DEA 1500"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/b/bc/Cornell_Seal.svg"
    },
    {
        "school_casual_name": "SMU",
        "school_color_one": "#CE1126",
        "banner_url": "https://farm4.staticflickr.com/3694/9291969905_52a0c03dd8_b.jpg",
        "sp16_start": "Fri, 15 Jan 2016 00:00:00 -0000",
        "rank": 101,
        "school_tiny_name": "SMU",
        "id": 1073,
        "city": "Dallas",
        "num_popular_courses": 205,
        "state": "TX",
        "latitude": "32.8412178",
        "population": 10893,
        "website": "www.smu.edu",
        "banner_url_confirmed": false,
        "short_name": "SMU",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/64/SMU_Seal_Logo.png/180px-SMU_Seal_Logo.png",
        "school_mascot_name": "mustang",
        "school_color_light": "#CE1126",
        "departments_sanitized": true,
        "school_color_dark": "#0038A8",
        "school_color_primary": null,
        "school_color_two": "#0038A8",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/southern-methodist-university_50x50.jpg",
        "num_depts": 32,
        "name": "Southern Methodist University",
        "num_emails": 0,
        "num_courses": 1162,
        "variations": "peruna mustangs srmu smu",
        "longitude": "-96.7845175",
        "courses_sanitized": true,
        "popular_courses": [
            "RELI 3329",
            "CHEM 1113",
            "BIOL 1401",
            "PHIL 1300",
            "GEOL 1313",
            "HIST 3350",
            "ENGL 3331",
            "PLSC 4369",
            "SOCI 3345",
            "BIO 1402",
            "ANTH 1321",
            "PHYS 1311",
            "MATH 1338",
            "ECO 5353",
            "ITAL 1401",
            "STAT 1301",
            "FREN 1401",
            "RUSS 1401",
            "SPAN 1401",
            "LATN 2311"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/8/8d/Southern_Methodist_University_Logo.svg"
    },
    {
        "school_casual_name": "st oles",
        "school_color_one": "#000000",
        "banner_url": "https://farm3.staticflickr.com/2649/3962651894_5d3b48607d_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 109,
        "school_tiny_name": "Olaf",
        "id": 1109,
        "city": "Northfield",
        "num_popular_courses": 425,
        "state": "MN",
        "latitude": "44.461154",
        "population": 3176,
        "website": "www.stolaf.edu",
        "banner_url_confirmed": false,
        "short_name": "St. Olaf",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/8/87/StOlafSeal.png",
        "school_mascot_name": "lion",
        "school_color_light": "#CFB53B",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#CFB53B",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/st-olaf-college_50x50.jpg",
        "num_depts": 59,
        "name": "St. Olaf College",
        "num_emails": 0,
        "num_courses": 1560,
        "variations": "st. olaf lion \"oles\" /\\u02c8o\\u028ali\\u02d0z/ oh-leez soc",
        "longitude": "-93.1836963",
        "courses_sanitized": true,
        "popular_courses": [
            "ART 104",
            "HIST 203",
            "MEDIA 160",
            "CS 121",
            "French 231",
            "MGMT 225",
            "Music 241",
            "PSYCH 236",
            "STATS 212",
            "PSCI 113",
            "PHIL 118",
            "REL 209",
            "GER 251",
            "ENG 215",
            "BIO 121",
            "ARMS 121",
            "ES 232",
            "PHYS 126",
            "STAT 263",
            "ECON 261"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "The Garnet",
        "school_color_one": "#8B0000",
        "banner_url": "https://farm1.staticflickr.com/178/466475870_1e5541d976_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 3,
        "school_tiny_name": "Swar",
        "id": 1161,
        "city": "Swarthmore",
        "num_popular_courses": 102,
        "state": "PA",
        "latitude": "39.90652",
        "population": 1552,
        "website": "swarthmore.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Phineas the Phoenix[7]",
        "school_color_light": "grey",
        "departments_sanitized": true,
        "school_color_dark": "#8B0000",
        "school_color_primary": null,
        "school_color_two": "grey",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/swarthmore-college_50x50.jpg",
        "num_depts": 51,
        "name": "Swarthmore College",
        "num_emails": 0,
        "num_courses": 2874,
        "variations": "phineas the phoenix[7] the garnet sc",
        "longitude": "-75.35199",
        "courses_sanitized": true,
        "popular_courses": [
            "ECON 11",
            "CHEM 22",
            "FMST 033",
            "POLS 002",
            "MATH 026",
            "PHYS 003",
            "PSYCH 1",
            "FREN 004",
            "LING 045",
            "PHIL 11",
            "PSYC 001",
            "RELG 004",
            "STAT 001",
            "E 11",
            "FRENCH 004",
            "ARTH 002",
            "ASTR 001",
            "BIOL 021",
            "CLAS 056",
            "EDUC 14"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/8/8e/Formal_Seal_of_Swarthmore_College%2C_Swarthmore%2C_PA%2C_USA.svg"
    },
    {
        "school_casual_name": "UW",
        "school_color_one": "#482E24",
        "banner_url": "https://farm4.staticflickr.com/3555/3376678794_2132b8fa85_b.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 200,
        "school_tiny_name": "Wyom",
        "id": 1168,
        "city": "Laramie",
        "num_popular_courses": 222,
        "state": "WY",
        "latitude": "41.3130972",
        "population": 12903,
        "website": "uwyo.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/e/e1/University_of_Wyoming_seal.svg/200px-University_of_Wyoming_seal.svg.png",
        "school_mascot_name": "Cowboys and Cowgirls",
        "school_color_light": "#FEC33B",
        "departments_sanitized": true,
        "school_color_dark": "#482E24",
        "school_color_primary": null,
        "school_color_two": "#FEC33B",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-wyoming_50x50.jpg",
        "num_depts": 126,
        "name": "University of Wyoming",
        "num_emails": 0,
        "num_courses": 6084,
        "variations": "cowboys and cowgirls uw uw",
        "longitude": "-105.5796706",
        "courses_sanitized": true,
        "popular_courses": [
            "MATH 1400",
            "HIST 1251",
            "FIN 5310",
            "COJO 1000",
            "MKT 3210",
            "PSYCH 1000",
            "COSC 2030",
            "ECON 5010",
            "POLS 2460",
            "EDEL 2280",
            "EDST 3000",
            "FCSC 4112",
            "LIFE 2022",
            "PSYC 4370",
            "RUSS 1010",
            "PSY 101",
            "CALC 2",
            "CHE 3025",
            "CHEM 1020",
            "CHIN 3055"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/1/18/University_of_Wyoming_logo.svg"
    },
    {
        "school_casual_name": "udel",
        "school_color_one": "#00539F",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/a/a9/University_of_Delaware_-_The_Mall.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 135,
        "school_tiny_name": "UDel",
        "id": 1194,
        "city": "Newark",
        "num_popular_courses": 1461,
        "state": "DE",
        "latitude": "38.6343945",
        "population": 21856,
        "website": "www.udel.edu",
        "banner_url_confirmed": true,
        "short_name": "Delaware",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/2/29/University_of_Delaware_Seal.svg/200px-University_of_Delaware_Seal.svg.png",
        "school_mascot_name": "blue hen",
        "school_color_light": "#FFD200",
        "departments_sanitized": true,
        "school_color_dark": "#00539F",
        "school_color_primary": null,
        "school_color_two": "#FFD200",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-delaware_50x50.jpg",
        "num_depts": 110,
        "name": "University of Delaware",
        "num_emails": 0,
        "num_courses": 9560,
        "variations": "youdee delaware fightin' blue hens ud",
        "longitude": "-75.4541363",
        "courses_sanitized": true,
        "popular_courses": [
            "BISC 302",
            "ACCT 327",
            "COMM 256",
            "BUAD 384",
            "MATH 205",
            "ANTH 216",
            "CHEM 111",
            "PHYS 139",
            "HIST 138",
            "FREC 135",
            "SOCI 203",
            "EDUC 230",
            "ARTH 237",
            "ANFS 140",
            "PLSC 133",
            "NURS 222",
            "CRJU 311",
            "HDFS 235",
            "ECON 315",
            "MUSC 185"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/2/29/University_of_Delaware_Seal.svg"
    },
    {
        "school_casual_name": "Fighting Irish",
        "school_color_one": "#DCB439",
        "banner_url": "https://farm9.staticflickr.com/8315/7923939790_8641d60070_z.jpg",
        "sp16_start": "Mon, 22 Feb 2016 00:00:00 -0000",
        "rank": 17,
        "school_tiny_name": "Dame",
        "id": 1174,
        "city": "Notre dame",
        "num_popular_courses": 51,
        "state": "IN",
        "latitude": "41.7055716",
        "population": 12126,
        "website": "www.nd.edu",
        "banner_url_confirmed": false,
        "short_name": "ND",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/9/95/NotreDameSeal.svg/220px-NotreDameSeal.svg.png",
        "school_mascot_name": "Leprechaun",
        "school_color_light": "#DCB439",
        "departments_sanitized": true,
        "school_color_dark": "#002B5B",
        "school_color_primary": null,
        "school_color_two": "#002B5B",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-notre-dame_50x50.jpg",
        "num_depts": 136,
        "name": "University of Notre Dame",
        "num_emails": 3504,
        "num_courses": 248,
        "variations": "leprechaun fighting irish und",
        "longitude": "-86.2353388",
        "courses_sanitized": true,
        "popular_courses": [
            "PHIL 20402",
            "PHYS 222",
            "PSY 101",
            "BIOS 30420",
            "FIN 231",
            "CHEM 117",
            "MATH 119",
            "WR 13100",
            "MUS 101",
            "SOC 102",
            "ECON 180",
            "PE 1",
            "POLS 30201",
            "ENGL 4327",
            "STRAT 6050",
            "THEO 101",
            "ANTH 109",
            "ROSP 3081",
            "EALJ 1011",
            "PHILO 101"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/c/c7/NotreDameFightingIrish.svg"
    },
    {
        "school_casual_name": "uga",
        "school_color_one": "#CA0612",
        "banner_url": "https://farm4.staticflickr.com/3186/3078945004_60ea630203_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 94,
        "school_tiny_name": "UGA",
        "id": 1210,
        "city": "Athens",
        "num_popular_courses": 447,
        "state": "GA",
        "latitude": "33.9480053",
        "population": 34519,
        "website": "www.uga.edu",
        "banner_url_confirmed": false,
        "short_name": "UGA",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/c/cf/Seal_of_the_University_of_Georgia.png/200px-Seal_of_the_University_of_Georgia.png",
        "school_mascot_name": "bulldog",
        "school_color_light": "#CA0612",
        "departments_sanitized": null,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#000000",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-georgia_50x50.jpg",
        "num_depts": 220,
        "name": "University of Georgia",
        "num_emails": 35926,
        "num_courses": 10238,
        "variations": "bulldogs uga ug",
        "longitude": "-83.3773221",
        "courses_sanitized": true,
        "popular_courses": [
            "MUSI 2060",
            "ECON 2200",
            "ACCT 2101",
            "FINA 3000",
            "ECOL 1000",
            "FDNS 2100",
            "PEDB 1380",
            "HACE 3100",
            "JOUR 3310",
            "MGMT 3000",
            "SOCI 1101",
            "RELI 1006",
            "MARK 3000",
            "GEOG 1112",
            "MARS 1020",
            "ADPR 3100",
            "HORT 2000",
            "MIST 2090",
            "BIO 1107",
            "BCMB 3100"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/5/5b/UGA_logo.svg"
    },
    {
        "school_casual_name": "american",
        "school_color_one": "#ED1A3B",
        "banner_url": "https://upload.wikimedia.org/wikipedia/en/d/d4/AU_School_of_International_Service_Building.jpg",
        "sp16_start": "Wed, 06 Jan 2016 00:00:00 -0000",
        "rank": 134,
        "school_tiny_name": "AU",
        "id": 1276,
        "city": "Washington",
        "num_popular_courses": 443,
        "state": "DC",
        "latitude": "38.9368448",
        "population": 12904,
        "website": "american.edu",
        "banner_url_confirmed": true,
        "short_name": "American",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/8/8b/American_University_Seal.svg/200px-American_University_Seal.svg.png",
        "school_mascot_name": "eagle",
        "school_color_light": "#ED1A3B",
        "departments_sanitized": true,
        "school_color_dark": "#004FA3",
        "school_color_primary": null,
        "school_color_two": "#004FA3",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/american-university_50x50.jpg",
        "num_depts": 86,
        "name": "American University",
        "num_emails": 0,
        "num_courses": 4415,
        "variations": "clawed the eagle eagles au",
        "longitude": "-77.0908767",
        "courses_sanitized": true,
        "popular_courses": [
            "COMM 516",
            "JLS 101",
            "GOVT 320",
            "SOCY 100",
            "IBUS 300",
            "PERF 115",
            "MKTG 250",
            "RUSS 144",
            "HIST 225",
            "ITEC 200",
            "BIO 110",
            "LIT 135",
            "SIS 245",
            "SPAN 253",
            "PSYC 200",
            "ARAB 103",
            "PHYS 220",
            "ECON 370",
            "ACCT 241",
            "STAT 53"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/0/00/American_University_of_Kuwait.svg"
    },
    {
        "school_casual_name": "Maccabees",
        "school_color_one": "#0000ff",
        "banner_url": "https://farm4.staticflickr.com/3250/2460823643_33ebdc490b_b.jpg",
        "sp16_start": "Tue, 26 Jan 2016 00:00:00 -0000",
        "rank": 120,
        "school_tiny_name": "YU",
        "id": 1299,
        "city": "New york",
        "num_popular_courses": 135,
        "state": "NY",
        "latitude": "40.8504891",
        "population": 6740,
        "website": "www.yu.edu",
        "banner_url_confirmed": false,
        "short_name": "YU",
        "seal_url": null,
        "school_mascot_name": null,
        "school_color_light": "#0000ff",
        "departments_sanitized": null,
        "school_color_dark": "#757575",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/yeshiva-university_50x50.jpg",
        "num_depts": 142,
        "name": "Yeshiva University",
        "num_emails": 3889,
        "num_courses": 315,
        "variations": "maccabees yu",
        "longitude": "-73.929274",
        "courses_sanitized": true,
        "popular_courses": [
            "BIO 1011",
            "HEB 1305",
            "PSY 1010",
            "COM 1300",
            "FRE 1932",
            "ECO 1031",
            "CHE 1045",
            "IDS 1020",
            "ENG 2010",
            "GMAT 101",
            "MATH 7",
            "FIN 101",
            "ACC 10012",
            "INF 1020",
            "COWC 1001",
            "FYWR 1010",
            "INTC 1007",
            "ART 1051",
            "FYW 101",
            "MIS 1020"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/c/c2/Yeshiva_University.svg"
    },
    {
        "school_casual_name": "(\"Bryn Mawr College\",brynmawr)",
        "school_color_one": "yellow",
        "banner_url": "https://farm3.staticflickr.com/2747/4453969799_c2e0274da5_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 65,
        "school_tiny_name": "BMC",
        "id": 1280,
        "city": "Bryn mawr",
        "num_popular_courses": 88,
        "state": "PA",
        "latitude": "40.0266576",
        "population": 1765,
        "website": "www.brynmawr.edu",
        "banner_url_confirmed": false,
        "short_name": "BMC",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/d/dc/Bryn_Mawr_seal.png/200px-Bryn_Mawr_seal.png",
        "school_mascot_name": "Owl",
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "yellow",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/bryn-mawr-college_50x50.jpg",
        "num_depts": 45,
        "name": "Bryn Mawr College",
        "num_emails": 0,
        "num_courses": 1245,
        "variations": "owl bmc",
        "longitude": "-75.3143902",
        "courses_sanitized": true,
        "popular_courses": [
            "PHYS 101",
            "CALC 101",
            "BIO 101",
            "RUSS 215",
            "MATH 201",
            "ITAL 001",
            "CITY 185",
            "CSTS 212",
            "ARCH 206",
            "PHIL 344",
            "GEO 101",
            "SPAN 200",
            "LING 101",
            "ECON 105",
            "PHYSICS 101",
            "CHEM 104",
            "SOC 160",
            "LATIN 201",
            "HIST 224",
            "HART 105"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "OU",
        "school_color_one": "#841617",
        "banner_url": "https://farm3.staticflickr.com/2318/2307022252_95f377c9ca_b.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 202,
        "school_tiny_name": "ONC",
        "id": 1314,
        "city": "Norman",
        "num_popular_courses": 4,
        "state": "OK",
        "latitude": "35.2058936",
        "population": 27507,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Sooners",
        "school_color_light": "#FDF9D8",
        "departments_sanitized": true,
        "school_color_dark": "#841617",
        "school_color_primary": null,
        "school_color_two": "#FDF9D8",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-oklahoma-norman-campus_50x50.jpg",
        "num_depts": 183,
        "name": "University Of Oklahoma Norman Campus",
        "num_emails": 0,
        "num_courses": 8863,
        "variations": "sooners ou uoonc",
        "longitude": "-97.4457137",
        "courses_sanitized": false,
        "popular_courses": [
            "BIOL 2124",
            "PSC 2503",
            "FMS 3853",
            "ANTHR 001"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/3/30/OU-Logo.svg"
    },
    {
        "school_casual_name": "redlands",
        "school_color_one": "maroon",
        "banner_url": "https://farm4.staticflickr.com/3182/3043980027_a494af785b_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 123,
        "school_tiny_name": "Redl",
        "id": 1325,
        "city": "Redlands",
        "num_popular_courses": 166,
        "state": "CA",
        "latitude": "34.062685",
        "population": 4956,
        "website": "www.redlands.edu",
        "banner_url_confirmed": false,
        "short_name": "Redlands",
        "seal_url": null,
        "school_mascot_name": "bulldog",
        "school_color_light": "gray",
        "departments_sanitized": true,
        "school_color_dark": "maroon",
        "school_color_primary": null,
        "school_color_two": "gray",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-redlands_50x50.jpg",
        "num_depts": 55,
        "name": "University of Redlands",
        "num_emails": 0,
        "num_courses": 1878,
        "variations": "bulldog \"thurber\" bulldogs urs",
        "longitude": "-117.163181",
        "courses_sanitized": true,
        "popular_courses": [
            "BUS 126",
            "POLI 111",
            "ACCT 210",
            "HIST 121",
            "MATH 119",
            "ENG 103",
            "REL 125",
            "SPANISH 101",
            "HUM 212",
            "PSYC 250",
            "ECON 200",
            "GOVT 314",
            "PE 310",
            "MUAP 308",
            "CALC 1",
            "SPAN 401",
            "BIO 131",
            "EDUC 401",
            "SOAN 104",
            "CDIS 205"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/b/b4/University_of_Redlands_Logo.svg"
    },
    {
        "school_casual_name": "UConn",
        "school_color_one": "#000E2E",
        "banner_url": "https://farm1.staticflickr.com/47/150141643_5096f31213_b.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 164,
        "school_tiny_name": "Conn",
        "id": 1362,
        "city": "Storrs",
        "num_popular_courses": 531,
        "state": "CT",
        "latitude": "41.8077414",
        "population": 25483,
        "website": "www.uconn.edu",
        "banner_url_confirmed": false,
        "short_name": "UConn",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/0/0e/University_of_Connecticut_Seal.svg/200px-University_of_Connecticut_Seal.svg.png",
        "school_mascot_name": "Huskies",
        "school_color_light": "#7C878E",
        "departments_sanitized": null,
        "school_color_dark": "#000E2E",
        "school_color_primary": null,
        "school_color_two": "#7C878E",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-connecticut_50x50.jpg",
        "num_depts": 141,
        "name": "University of Connecticut",
        "num_emails": 0,
        "num_courses": 5346,
        "variations": "huskies uconn uc",
        "longitude": "-72.2539805",
        "courses_sanitized": true,
        "popular_courses": [
            "BIO 1107",
            "MCB 2000",
            "CSE 1010",
            "PHYS 1025",
            "DRAM 1110",
            "ENGR 1000",
            "PNB 2250",
            "ACCT 131",
            "CHEM 2241",
            "ARTH 1137",
            "CAMS 1103",
            "CDIS 1150",
            "GEOG 1700",
            "PHIL 1101",
            "MATH 2620",
            "NUSC 2200",
            "JOUR 102",
            "ANSC 3122",
            "ANTH 2502",
            "FREN 1177"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "vandy",
        "school_color_one": "#000000",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/5/57/CorneliusVanderbiltStatue.JPG",
        "sp16_start": "Sat, 09 Jan 2016 00:00:00 -0000",
        "rank": 54,
        "school_tiny_name": "Vand",
        "id": 1442,
        "city": "Nashville",
        "num_popular_courses": 216,
        "state": "TN",
        "latitude": "36.1447034",
        "population": 12710,
        "website": "www.vanderbilt.edu",
        "banner_url_confirmed": true,
        "short_name": "Vanderbilt",
        "seal_url": null,
        "school_mascot_name": "commodore",
        "school_color_light": "#997F3D",
        "departments_sanitized": true,
        "school_color_dark": "#000000",
        "school_color_primary": null,
        "school_color_two": "#997F3D",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/vanderbilt-university_50x50.jpg",
        "num_depts": 89,
        "name": "Vanderbilt University",
        "num_emails": 0,
        "num_courses": 2138,
        "variations": "mr. commodore (mr. c) commodores veu vandy",
        "longitude": "-86.8026551",
        "courses_sanitized": true,
        "popular_courses": [
            "MUSL 147",
            "BSCI 105",
            "PSY 252",
            "SPED 1010",
            "HOD 1400",
            "CS 101",
            "MUSC 100",
            "BME 103",
            "CE 225",
            "EES 103",
            "ES 155",
            "EECE 116",
            "AHST 130",
            "MGRL 195",
            "EDUC 2920",
            "FNEC 275",
            "ME 160",
            "ENGM 244",
            "MHS 201",
            "ARTS 140"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/f/ff/Vanderbilt_University_wordmark.svg"
    },
    {
        "school_casual_name": "SEU",
        "school_color_one": "#40484B",
        "banner_url": "https://farm6.staticflickr.com/5476/9690659779_99dac31599_k.jpg",
        "sp16_start": "Wed, 13 Jan 2016 00:00:00 -0000",
        "rank": 197,
        "school_tiny_name": "SU",
        "id": 1499,
        "city": "Lakeland",
        "num_popular_courses": 24,
        "state": "FL",
        "latitude": "28.029681",
        "population": 1394,
        "website": null,
        "banner_url_confirmed": true,
        "short_name": "Southeastern",
        "seal_url": null,
        "school_mascot_name": "fire",
        "school_color_light": "#757575",
        "departments_sanitized": true,
        "school_color_dark": "#40484B",
        "school_color_primary": null,
        "school_color_two": "#757575",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/southwestern-university_50x50.jpg",
        "num_depts": 47,
        "name": "Southeastern University",
        "num_emails": 0,
        "num_courses": 1020,
        "variations": " sau suistate university of iowa",
        "longitude": "-81.9179275",
        "courses_sanitized": false,
        "popular_courses": [
            "PSYCH 1233",
            "WCIV 101",
            "BUSI 1",
            "ENG 1133",
            "ACCT 1",
            "ENGCOMP 1",
            "HIST 2233",
            "MGMT 4163",
            "MATH 101",
            "ENC 1101",
            "LIT 2020",
            "MATHLIB 1",
            "CCU 101",
            "LIBERALARTS 2",
            "ENGL 2",
            "COMM 101",
            "BIB 1703",
            "THEO 1",
            "CHEM 1",
            "MISS 101"
        ],
        "svg_url": "http://www.civitaslearning.com/wp-content/uploads/2015/06/NovaSoutheasternUniversity-gray.svg"
    },
    {
        "school_casual_name": "middlebury",
        "school_color_one": "#003F84",
        "banner_url": "https://farm9.staticflickr.com/8260/8614299221_87ea35909f_b.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 30,
        "school_tiny_name": "Midd",
        "id": 1532,
        "city": "Middlebury",
        "num_popular_courses": 37,
        "state": "VT",
        "latitude": "44.0111095",
        "population": 2516,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": "Middlebury",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/0/0f/Middlebury_seal.png/200px-Middlebury_seal.png",
        "school_mascot_name": "panther",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#003F84",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/middlebury-college_50x50.jpg",
        "num_depts": 95,
        "name": "Middlebury College",
        "num_emails": 0,
        "num_courses": 1828,
        "variations": " mc",
        "longitude": "-73.1785764",
        "courses_sanitized": false,
        "popular_courses": [
            "PS 101",
            "BI 250",
            "PSCI 103",
            "CHEM 104",
            "CLAS 0150",
            "ECON 210",
            "ENAM 204",
            "FREN 101",
            "INTL 101",
            "MATH 121",
            "PHIL 201",
            "SOAN 105",
            "WAGS 200",
            "MUSIC 101",
            "HIST 101",
            "JAPN 103",
            "EL 312",
            "EC 210",
            "MA 113",
            "IT 102"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/d/d2/Middlebury_College_wordmark.svg"
    },
    {
        "school_casual_name": "Tulsa",
        "school_color_one": "#002D72",
        "banner_url": "https://farm2.staticflickr.com/1336/723777663_82ce418e28_n.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 213,
        "school_tiny_name": "Tuls",
        "id": 1579,
        "city": "Tulsa",
        "num_popular_courses": 267,
        "state": "OK",
        "latitude": "36.150944",
        "population": 4326,
        "website": "www.utulsa.edu",
        "banner_url_confirmed": false,
        "short_name": "Tulsa",
        "seal_url": null,
        "school_mascot_name": "hurricane",
        "school_color_light": "#A29161",
        "departments_sanitized": true,
        "school_color_dark": "#002D72",
        "school_color_primary": null,
        "school_color_two": "#A29161",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-tulsa_50x50.jpg",
        "num_depts": 60,
        "name": "University of Tulsa",
        "num_emails": 0,
        "num_courses": 1750,
        "variations": "captain cane golden hurricane ut",
        "longitude": "-95.9436367",
        "courses_sanitized": true,
        "popular_courses": [
            "QM 2013",
            "MIS 1123",
            "REL 2013",
            "EDUC 1101",
            "ANTH 2023",
            "STAT 1",
            "CS 2033",
            "POL 2053",
            "ACCT 3113",
            "ATRG 2023",
            "MATH 3073",
            "BIOL 2124",
            "PHYS 2051",
            "PHYSICS 1",
            "FR 2003",
            "SOC 2133",
            "EE 2163",
            "PSY 3023",
            "SPAN 3123",
            "ES 3023"
        ],
        "svg_url": "https://worldvectorlogo.com/logos/the-university-of-tulsa.svg"
    },
    {
        "school_casual_name": "richmond",
        "school_color_one": "#000066",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/e/e4/University_of_Richmond.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 96,
        "school_tiny_name": "Rich",
        "id": 1592,
        "city": "Richmond",
        "num_popular_courses": 370,
        "state": "VA",
        "latitude": "37.5739607",
        "population": 4361,
        "website": "www.richmond.edu",
        "banner_url_confirmed": true,
        "short_name": "Richmond",
        "seal_url": null,
        "school_mascot_name": "spider",
        "school_color_light": "#990000",
        "departments_sanitized": true,
        "school_color_dark": "#000066",
        "school_color_primary": null,
        "school_color_two": "#990000",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-richmond_50x50.jpg",
        "num_depts": 92,
        "name": "University of Richmond",
        "num_emails": 0,
        "num_courses": 1772,
        "variations": "webstur the spider[5] spiders ur u of r",
        "longitude": "-77.5396137",
        "courses_sanitized": true,
        "popular_courses": [
            "BUAD 205",
            "ACCT 302",
            "HIUS 323",
            "PHIL 251",
            "FREN 301",
            "BIO 201",
            "HIST 235",
            "CHEM 329",
            "ISYS 351",
            "AFST 100",
            "ANTH 205",
            "FIN 462",
            "GERM 201",
            "LAIS 301",
            "ITAL 121",
            "JAPN 101",
            "POLSC 250",
            "PROP 101",
            "ENG 220",
            "REL 263"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/d/d0/UR_Shield.svg"
    },
    {
        "school_casual_name": "UVM",
        "school_color_one": "#598A5D",
        "banner_url": "https://farm3.staticflickr.com/2126/2253187312_66fb6f9b44_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 140,
        "school_tiny_name": "UVM",
        "id": 1621,
        "city": "Burlington",
        "num_popular_courses": 841,
        "state": "VT",
        "latitude": "44.4778528",
        "population": 13098,
        "website": "www.uvm.edu",
        "banner_url_confirmed": false,
        "short_name": "UVM",
        "seal_url": null,
        "school_mascot_name": "Catamounts",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#598A5D",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-vermont_50x50.jpg",
        "num_depts": 153,
        "name": "University of Vermont",
        "num_emails": 17701,
        "num_courses": 5236,
        "variations": "catamounts uvm uv",
        "longitude": "-73.1964637",
        "courses_sanitized": true,
        "popular_courses": [
            "CHEM 141",
            "BSAD 251",
            "CS 008",
            "NFS 143",
            "ASTR 005",
            "POLS 131",
            "ARTH 008",
            "EE 141",
            "RUSS 001",
            "EDSC 207",
            "ASCI 006",
            "HDFS 060",
            "NR 2",
            "SOC 19",
            "ANTH 024",
            "GEOL 007",
            "CLAS 042",
            "ENVS 001",
            "FTS 009",
            "PHIL 111"
        ],
        "svg_url": "http://www.uvm.edu/sites/all/themes/uvmbase/images/uvmlogo2014.svg"
    },
    {
        "school_casual_name": "Jumbos",
        "school_color_one": "#522C1B",
        "banner_url": "http://c2.staticflickr.com/6/5097/5514096962_ee022a89d4_b.jpg",
        "sp16_start": "Thu, 21 Jan 2016 00:00:00 -0000",
        "rank": 25,
        "school_tiny_name": "Tuft",
        "id": 1632,
        "city": "Medford",
        "num_popular_courses": 494,
        "state": "MA",
        "latitude": "42.4074843",
        "population": 10837,
        "website": "tufts.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/5/5d/Tufts_University_seal.svg/200px-Tufts_University_seal.svg.png",
        "school_mascot_name": "Jumbo the Elephant[3]",
        "school_color_light": "#417DC1",
        "departments_sanitized": true,
        "school_color_dark": "#522C1B",
        "school_color_primary": null,
        "school_color_two": "#417DC1",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/tufts-university_50x50.jpg",
        "num_depts": 116,
        "name": "Tufts University",
        "num_emails": 0,
        "num_courses": 3859,
        "variations": "jumbo the elephant[3] jumbos tu",
        "longitude": "-71.1190232",
        "courses_sanitized": true,
        "popular_courses": [
            "PHIL 0033",
            "AST 0010",
            "EN 0002",
            "BIO 0010",
            "CD 0001",
            "ANTH 0020",
            "EC 0005",
            "CH 0001",
            "ED 0001",
            "JS 0065",
            "SOC 0030",
            "CHEM 0016",
            "SPN 0003",
            "GEO 0002",
            "HIST 0028",
            "PS 0061",
            "ARB 0001",
            "ENG 0005",
            "PJS 0001",
            "PSY 0027"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "U of I",
        "school_color_one": "#043D7B",
        "banner_url": "https://farm7.staticflickr.com/6103/6373338433_7793ecbb0b_n.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 68,
        "school_tiny_name": "UIUC",
        "id": 1714,
        "city": "Champaign",
        "num_popular_courses": 542,
        "state": "IL",
        "latitude": "40.1019523",
        "population": 44520,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": "UIUC",
        "seal_url": null,
        "school_mascot_name": "Fighting Illini",
        "school_color_light": "#F27F32",
        "departments_sanitized": true,
        "school_color_dark": "#043D7B",
        "school_color_primary": null,
        "school_color_two": "#F27F32",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-illinois-at-urbana-champaign_50x50.jpg",
        "num_depts": 202,
        "name": "University of Illinois at Urbana-Champaign",
        "num_emails": 0,
        "num_courses": 542,
        "variations": "fighting illini u of i uic uiuc",
        "longitude": "-88.2271615",
        "courses_sanitized": false,
        "popular_courses": [
            "ACCY 201",
            "ECON 202",
            "FIN 221",
            "CS 101",
            "GEOL 118",
            "SOC 100",
            "FSHN 120",
            "ADV 300",
            "ECE 110",
            "GE 101",
            "ACE 161",
            "EPSY 201",
            "BADM 310",
            "MCB 100",
            "HORT 100",
            "PS 270",
            "ATMS 100",
            "STAT 100",
            "ME 170",
            "ENGL 209"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/6/60/Fighting_Illini_logo.svg"
    },
    {
        "school_casual_name": "UC Davis",
        "school_color_one": "#012764",
        "banner_url": "https://farm3.staticflickr.com/2578/4122477574_08d694ec97_o.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 113,
        "school_tiny_name": "Davi",
        "id": 1800,
        "city": "Davis",
        "num_popular_courses": 5,
        "state": "CA",
        "latitude": "34.4139629",
        "population": 32354,
        "website": "www.universityofcalifornia.edu",
        "banner_url_confirmed": true,
        "short_name": "UC",
        "seal_url": null,
        "school_mascot_name": "Aggie",
        "school_color_light": "#BE9820",
        "departments_sanitized": true,
        "school_color_dark": "#012764",
        "school_color_primary": null,
        "school_color_two": "#BE9820",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-california-davis_50x50.jpg",
        "num_depts": 209,
        "name": "University of California, Davis",
        "num_emails": 2,
        "num_courses": 6851,
        "variations": "aggies uc davis uc",
        "longitude": "-119.848947",
        "courses_sanitized": false,
        "popular_courses": [
            "STAT 13",
            "SOC 30",
            "ANTHRO 2",
            "FST 1",
            "POLSCI 3"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/f/fc/The_University_of_California_1868.svg"
    },
    {
        "school_casual_name": "william and mary",
        "school_color_one": "#145640",
        "banner_url": "https://farm1.staticflickr.com/199/466827649_34353339ea_z.jpg",
        "sp16_start": "Wed, 20 Jan 2016 00:00:00 -0000",
        "rank": 41,
        "school_tiny_name": "W&M",
        "id": 1836,
        "city": "Williamsburg",
        "num_popular_courses": 630,
        "state": "VA",
        "latitude": "37.2647386",
        "population": 8258,
        "website": null,
        "banner_url_confirmed": false,
        "short_name": "WM",
        "seal_url": null,
        "school_mascot_name": "Tribe",
        "school_color_light": "#B8965F",
        "departments_sanitized": true,
        "school_color_dark": "#145640",
        "school_color_primary": null,
        "school_color_two": "#B8965F",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/college-of-william-and-mary_50x50.jpg",
        "num_depts": 64,
        "name": "College of William & Mary",
        "num_emails": 5369,
        "num_courses": 4460,
        "variations": "tribe william and mary",
        "longitude": "-76.705043",
        "courses_sanitized": true,
        "popular_courses": [
            "CHEM 307",
            "BUAD 452",
            "BIO 203",
            "CSCI 131",
            "CS 141",
            "KINE 322",
            "MATH 104",
            "ECON 101",
            "ANTH 203",
            "GEO 110",
            "GOVT 370",
            "RELG 204",
            "HIST 161",
            "GEOL 101",
            "CHIN 101",
            "PHIL 331",
            "PHYS 176",
            "SPCH 102",
            "CLCV 217",
            "CIV 205"
        ],
        "svg_url": "https://mason.wm.edu/img/cypher_wordmark.svg"
    },
    {
        "school_casual_name": "UT Austin",
        "school_color_one": "#BD5716",
        "banner_url": "https://farm3.staticflickr.com/2736/4151853144_23e4039615_b.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 76,
        "school_tiny_name": "UTAu",
        "id": 1853,
        "city": "Austin",
        "num_popular_courses": 333,
        "state": "TX",
        "latitude": "30.2806543",
        "population": 52186,
        "website": "www.utexas.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Large_university-of-texas_seal_rgb%28199-91-18%29.png/200px-Large_university-of-texas_seal_rgb%28199-91-18%29.png",
        "school_mascot_name": "Longhorns",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#BD5716",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/the-university-of-texas-at-austin_50x50.jpg",
        "num_depts": 227,
        "name": "University of Texas at Austin",
        "num_emails": 0,
        "num_courses": 5219,
        "variations": "longhorns ut austin ut",
        "longitude": "-97.7327641",
        "courses_sanitized": true,
        "popular_courses": [
            "PR 319",
            "ARC 308",
            "COMM 150",
            "MIS 301",
            "PHR 338",
            "CS 307",
            "BIO 211",
            "HDF 313",
            "J 310",
            "N 310",
            "CMS 315",
            "CC 306",
            "CHE 210",
            "ASE 102",
            "DANCE 101",
            "PSY 308",
            "PHL 302",
            "HIS 383",
            "PHY 301",
            "HIST 1378"
        ],
        "svg_url": "http://upload.wikimedia.org/wikipedia/commons/e/e8/UofTatA.svg"
    },
    {
        "school_casual_name": "cal poly",
        "school_color_one": "#1E4D2B",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/8/87/Cal_Poly's_New_Poly_Canyon_Village.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 157,
        "school_tiny_name": "CPSU",
        "id": 1870,
        "city": "San luis obispo",
        "num_popular_courses": 112,
        "state": "CA",
        "latitude": "35.3050054",
        "population": 18679,
        "website": null,
        "banner_url_confirmed": true,
        "short_name": "Cal Poly",
        "seal_url": null,
        "school_mascot_name": "bronco",
        "school_color_light": "#C6930A",
        "departments_sanitized": true,
        "school_color_dark": "#1E4D2B",
        "school_color_primary": null,
        "school_color_two": "#C6930A",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/california-polytechnic-state-university-san-luis-obispo_50x50.jpg",
        "num_depts": 91,
        "name": "Cal Polytechnic State University",
        "num_emails": 0,
        "num_courses": 3310,
        "variations": " cpsu",
        "longitude": "-120.6624942",
        "courses_sanitized": true,
        "popular_courses": [
            "GSB 514",
            "ANT 250",
            "CPE 101",
            "BUS 387",
            "GEOG 150",
            "GEOL 201",
            "POLS 333",
            "PHYS 141",
            "ARCH 121",
            "MATH 141",
            "SPC 125",
            "BOT 121",
            "CHEM 111",
            "ECON 221",
            "MATE 210",
            "PSY 340",
            "STAT 218",
            "ENG 310",
            "CSC 464",
            "BIO 152"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/d/d9/CalPoly_Seal.svg"
    },
    {
        "school_casual_name": "Terriers",
        "school_color_one": "#CC0000",
        "banner_url": "https://farm4.staticflickr.com/3004/2556383625_9c9eb05e25_b.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 89,
        "school_tiny_name": "BC",
        "id": 1910,
        "city": "Boston",
        "num_popular_courses": 1870,
        "state": "MA",
        "latitude": "42.3504997",
        "population": 32603,
        "website": "www.bu.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/commons/thumb/f/f5/Boston_University_seal.svg/200px-Boston_University_seal.svg.png",
        "school_mascot_name": "Rhett the Boston Terrier",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#CC0000",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/boston-university_50x50.jpg",
        "num_depts": 151,
        "name": "Boston University",
        "num_emails": 0,
        "num_courses": 4842,
        "variations": "rhett the boston terrier terriers bu",
        "longitude": "-71.1053991",
        "courses_sanitized": true,
        "popular_courses": [
            "LX 250",
            "AS 105",
            "PS 354",
            "CL 321",
            "EK 126",
            "MU 117",
            "HS 251",
            "CS 350",
            "SE 250",
            "AR 232",
            "HI 307",
            "ES 140",
            "FE 442",
            "FI 202",
            "BI 407",
            "EC 111",
            "PH 155",
            "PO 102",
            "IR 350",
            "FT 360"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/f/f5/Boston_University_seal.svg"
    },
    {
        "school_casual_name": "Wolverines",
        "school_color_one": "#ffffff",
        "banner_url": "https://farm2.staticflickr.com/1056/529336583_cd33012d39_z.jpg",
        "sp16_start": "Mon, 18 Jan 2016 00:00:00 -0000",
        "rank": 148,
        "school_tiny_name": "GCC",
        "id": 1964,
        "city": "Grove city",
        "num_popular_courses": 245,
        "state": "PA",
        "latitude": "41.155194",
        "population": 2506,
        "website": "http://www.gcc.edu/",
        "banner_url_confirmed": false,
        "short_name": "GCC",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/6/6b/Grove_City_College_seal.png",
        "school_mascot_name": "Willie the Wolverine",
        "school_color_light": "#ffffff",
        "departments_sanitized": true,
        "school_color_dark": "#dc143c",
        "school_color_primary": null,
        "school_color_two": "#dc143c",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/grove-city-college_50x50.jpg",
        "num_depts": 35,
        "name": "Grove City College",
        "num_emails": 0,
        "num_courses": 864,
        "variations": "willie the wolverine wolverines gcc",
        "longitude": "-80.084226",
        "courses_sanitized": true,
        "popular_courses": [
            "ECON 102",
            "BUSA 203",
            "PHYS 102",
            "ENGL 201",
            "EDUC 201",
            "SCIC 201",
            "SSFT 212",
            "POLS 201",
            "PSYC 102",
            "ENG 201",
            "RELI 211",
            "CHEM 105",
            "BIOL 234",
            "PHIL 201",
            "HUMA 102",
            "COMM 107",
            "COMP 204",
            "HIST 141",
            "SPAN 295",
            "ENGR 136"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "CU Boulder",
        "school_color_one": "#D0B685",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/5/52/Wolf_Law_building_at_University_of_Colorado_at_Boulder_from_the_southwest.JPG",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 118,
        "school_tiny_name": "CU-B",
        "id": 1967,
        "city": "Boulder",
        "num_popular_courses": 377,
        "state": "CO",
        "latitude": "40.007581",
        "population": 31945,
        "website": null,
        "banner_url_confirmed": true,
        "short_name": "CU Boulder",
        "seal_url": null,
        "school_mascot_name": "buffalo",
        "school_color_light": "#D0B685",
        "departments_sanitized": null,
        "school_color_dark": "#232122",
        "school_color_primary": null,
        "school_color_two": "#232122",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-colorado-at-boulder_50x50.jpg",
        "num_depts": 196,
        "name": "University of Colorado",
        "num_emails": 0,
        "num_courses": 9188,
        "variations": "buffaloes cu boulder uc",
        "longitude": "-105.2659417",
        "courses_sanitized": true,
        "popular_courses": [
            "PSYC 2145",
            "ECON 1088",
            "EBIO 1210",
            "IPHY 2420",
            "GEOG 1982",
            "PSCI 1101",
            "PHIL 1600",
            "CHEN 2120",
            "FILM 1502",
            "JOUR 2403",
            "HIST 1015",
            "MCDB 2150",
            "CHEM 1113",
            "CLAS 1020",
            "ENGL 3000",
            "ATOC 1050",
            "ECEN 2120",
            "BCOR 2300",
            "ENVD 2003",
            "WRTG 1250"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Mountain Hawks",
        "school_color_one": "#4C280F",
        "banner_url": "https://farm5.staticflickr.com/4067/5124126101_c032178bdb_z.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 77,
        "school_tiny_name": "Lehi",
        "id": 1965,
        "city": "Bethlehem",
        "num_popular_courses": 445,
        "state": "PA",
        "latitude": "40.6069087",
        "population": 7080,
        "website": "www.lehigh.edu",
        "banner_url_confirmed": false,
        "short_name": "Lehigh",
        "seal_url": null,
        "school_mascot_name": "Clutch",
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "#4C280F",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/lehigh-university_50x50.jpg",
        "num_depts": 106,
        "name": "Lehigh University",
        "num_emails": 5366,
        "num_courses": 3777,
        "variations": "clutch mountain hawks lu",
        "longitude": "-75.3782832",
        "courses_sanitized": true,
        "popular_courses": [
            "ECE 33",
            "ACCT 324",
            "FIN 125",
            "EES 011",
            "CSE 17",
            "ECO 119",
            "GBUS 470",
            "PSYC 153",
            "IR 125",
            "ENGR 001",
            "BIOS 382",
            "JOUR 122",
            "ME 10",
            "HIST 12",
            "THTR 56",
            "IE 121",
            "PHY 021",
            "ART 3",
            "CHM 51",
            "LAW 201"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/e/ef/LUwithShield-CMYK.svg"
    },
    {
        "school_casual_name": "Bulldogs",
        "school_color_one": "#0E4C92",
        "banner_url": "https://farm6.staticflickr.com/5060/5445948985_22aa8e916e_z.jpg",
        "sp16_start": "Tue, 19 Jan 2016 00:00:00 -0000",
        "rank": 6,
        "school_tiny_name": "Yale",
        "id": 1991,
        "city": "New haven",
        "num_popular_courses": 112,
        "state": "CT",
        "latitude": "41.3163244",
        "population": 11906,
        "website": "yale.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "Handsome Dan",
        "school_color_light": null,
        "departments_sanitized": true,
        "school_color_dark": null,
        "school_color_primary": null,
        "school_color_two": null,
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/yale-university_50x50.jpg",
        "num_depts": 162,
        "name": "Yale University",
        "num_emails": 0,
        "num_courses": 17006,
        "variations": "handsome dan bulldogs yu",
        "longitude": "-72.9223431",
        "courses_sanitized": true,
        "popular_courses": [
            "FILM 350",
            "CGSC 110",
            "HIST 116",
            "CHEM 118",
            "ECON 110",
            "PHIL 176",
            "SOCY 130",
            "HSAR 112",
            "ITAL 115",
            "MATH 120",
            "ORCH 101",
            "GESO 101",
            "SOC 130",
            "PSY 180",
            "ENGL 129",
            "REL 547",
            "ENG 120",
            "MUSIC 112",
            "MAT 201",
            "EE 101"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/7/74/Yale_Bulldogs_Logo.svg"
    },
    {
        "school_casual_name": "ozark",
        "school_color_one": "#4E2683",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/4/41/View_from_scenic_outlook_on_US_62,_Carroll_County,_Arkansas.jpg",
        "sp16_start": "Tue, 05 Jan 2016 00:00:00 -0000",
        "rank": 194,
        "school_tiny_name": "Ozar",
        "id": 2005,
        "city": "Point lookout",
        "num_popular_courses": 17,
        "state": "MO",
        "latitude": "36.6199216",
        "population": 1372,
        "website": null,
        "banner_url_confirmed": true,
        "short_name": "Ozark",
        "seal_url": null,
        "school_mascot_name": "ozark",
        "school_color_light": "#FDB813",
        "departments_sanitized": true,
        "school_color_dark": "#4E2683",
        "school_color_primary": null,
        "school_color_two": "#FDB813",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/college-of-the-ozarks_50x50.jpg",
        "num_depts": 64,
        "name": "University of the Ozarks",
        "num_emails": 0,
        "num_courses": 655,
        "variations": " cto",
        "longitude": "-93.2385254",
        "courses_sanitized": false,
        "popular_courses": [
            "MKT 223",
            "SPC 103",
            "ENW 133",
            "ENG 201",
            "SOC 101",
            "HST 103",
            "MUS 103",
            "ENA 123",
            "SPEEC 103",
            "MAT 133",
            "MCC 103",
            "REL 103"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Violets",
        "school_color_one": "#57068C",
        "banner_url": "https://farm4.staticflickr.com/3894/15272294146_6552db0a00_b.jpg",
        "sp16_start": "Mon, 25 Jan 2016 00:00:00 -0000",
        "rank": 72,
        "school_tiny_name": "NYU",
        "id": 2089,
        "city": "New york",
        "num_popular_courses": 423,
        "state": "NY",
        "latitude": "40.7295134",
        "population": 44516,
        "website": "www.nyu.edu",
        "banner_url_confirmed": false,
        "short_name": "NYU",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/1/16/New_York_University_Seal.svg/200px-New_York_University_Seal.svg.png",
        "school_mascot_name": "Bobcat",
        "school_color_light": null,
        "departments_sanitized": true,
        "school_color_dark": "#57068C",
        "school_color_primary": null,
        "school_color_two": null,
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/new-york-university_50x50.jpg",
        "num_depts": 397,
        "name": "New York University",
        "num_emails": 0,
        "num_courses": 423,
        "variations": "bobcat violets nyu",
        "longitude": "-73.9964609",
        "courses_sanitized": false,
        "popular_courses": [
            "ORGO 1",
            "DSGA 1005",
            "CHEMUA 998",
            "CSCIGA 3033",
            "SOC 101",
            "ECON 101",
            "CULT 2",
            "ECONUA 2",
            "POLUA 330",
            "ACE 110",
            "PSYCHUA 30",
            "MAPUA 404",
            "BIOCH 1",
            "ENG 300",
            "GENCHEM 2",
            "CHEM 001",
            "ITS 101",
            "CRW 17",
            "WTE 101",
            "ANTH 101"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Mac",
        "school_color_one": "#1948A4",
        "banner_url": "https://farm9.staticflickr.com/8253/8662204858_45ae2185c9_b.jpg",
        "sp16_start": "Thu, 21 Jan 2016 00:00:00 -0000",
        "rank": 66,
        "school_tiny_name": "Maca",
        "id": 2128,
        "city": "Saint paul",
        "num_popular_courses": 246,
        "state": "MN",
        "latitude": "44.93914",
        "population": 2070,
        "website": "macalester.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/6e/Macalester_seal_hires.png/200px-Macalester_seal_hires.png",
        "school_mascot_name": "The Scots",
        "school_color_light": "#EB5025",
        "departments_sanitized": true,
        "school_color_dark": "#1948A4",
        "school_color_primary": null,
        "school_color_two": "#EB5025",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/macalester-college_50x50.jpg",
        "num_depts": 37,
        "name": "Macalester College",
        "num_emails": 0,
        "num_courses": 246,
        "variations": "the scots mac mc",
        "longitude": "-93.1685031",
        "courses_sanitized": true,
        "popular_courses": [
            "MATH 135",
            "POLI 160",
            "PHYS 226",
            "GEOG 225",
            "CHEM 211",
            "HMCS 114",
            "ECON 221",
            "INTL 110",
            "HIST 140",
            "AMST 103",
            "COMP 123",
            "ASIA 101",
            "BIOL 285",
            "GEOL 155",
            "JAPA 101",
            "ART 100",
            "FREN 111",
            "PHIL 369",
            "ENVI 133",
            "CHIN 101"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "wellesley",
        "school_color_one": "#0431B4",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/Wellesley_College_Tower_Court.jpg/1920px-Wellesley_College_Tower_Court.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 29,
        "school_tiny_name": "Well",
        "id": 2186,
        "city": "Wellesley",
        "num_popular_courses": 120,
        "state": "MA",
        "latitude": "42.2935733",
        "population": 2482,
        "website": "wellesley.edu",
        "banner_url_confirmed": true,
        "short_name": "Wellesley",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/2/27/Wellesley_college_seal.png",
        "school_mascot_name": "blue",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#0431B4",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/wellesley-college_50x50.jpg",
        "num_depts": 105,
        "name": "Wellesley College",
        "num_emails": 0,
        "num_courses": 1453,
        "variations": "none blue wc",
        "longitude": "-71.3059278",
        "courses_sanitized": true,
        "popular_courses": [
            "THST 204",
            "HIST 232",
            "CHEM 232",
            "BISC 109",
            "ECON 202",
            "NEUR 325",
            "ANTH 104",
            "ARAB 101",
            "ARTH 100",
            "FREN 201",
            "MATH 220",
            "PHIL 103",
            "POL 114",
            "PSYC 207",
            "RUSS 101",
            "SPAN 241",
            "DANTE 101",
            "WRIT 123",
            "SOC 301",
            "NEURO 100"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Lords (men's teams) and Ladies (women's teams)",
        "school_color_one": "#492F92",
        "banner_url": "https://farm5.staticflickr.com/4101/4881565261_63049c9af0_z.jpg",
        "sp16_start": "Mon, 18 Jan 2016 00:00:00 -0000",
        "rank": 42,
        "school_tiny_name": "Keny",
        "id": 2215,
        "city": "Gambier",
        "num_popular_courses": 268,
        "state": "OH",
        "latitude": "40.3768328",
        "population": 1667,
        "website": "www.kenyon.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": null,
        "school_color_light": "white",
        "departments_sanitized": true,
        "school_color_dark": "#492F92",
        "school_color_primary": null,
        "school_color_two": "white",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/kenyon-college_50x50.jpg",
        "num_depts": 43,
        "name": "Kenyon College",
        "num_emails": 0,
        "num_courses": 720,
        "variations": "lords (men's teams) and ladies (women's teams) kc",
        "longitude": "-82.3965928",
        "courses_sanitized": true,
        "popular_courses": [
            "ECON 101",
            "INST 131",
            "HIST 226",
            "BIO 114",
            "PSYC 101",
            "ARHS 110",
            "PSCI 220",
            "BIOL 113",
            "LATN 101",
            "SOCY 223",
            "CHNS 111",
            "ANTH 112",
            "MUSC 479",
            "PHIL 100",
            "MATH 222",
            "PSYCH 200",
            "WMNS 111",
            "CHEM 124",
            "PHYS 107",
            "ENVS 112"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "Penn State",
        "school_color_one": "#000099",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/8/8a/West_Halls_PSU.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 166,
        "school_tiny_name": "Penn",
        "id": 2273,
        "city": "University park",
        "num_popular_courses": 671,
        "state": "PA",
        "latitude": "40.7982133",
        "population": 45783,
        "website": "www.psu.edu",
        "banner_url_confirmed": true,
        "short_name": "Penn State",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/5/5c/Pennsylvania_State_University_seal.svg/200px-Pennsylvania_State_University_seal.svg.png",
        "school_mascot_name": "lion",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#000099",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/pennsylvania-state-university-main-campus_50x50.jpg",
        "num_depts": 438,
        "name": "Pennsylvania State University",
        "num_emails": 0,
        "num_courses": 17350,
        "variations": "nittany lion nittany lions psu penn state",
        "longitude": "-77.8599084",
        "courses_sanitized": true,
        "popular_courses": [
            "EGEE 102",
            "SOC 005",
            "CMLIT 108",
            "IE 312",
            "COMM 100",
            "SCM 200",
            "BBH 146",
            "MIS 204",
            "THEA 100",
            "INART 110",
            "HORT 101",
            "HDFS 229",
            "BISCI 003",
            "AFR 105",
            "FIN 100",
            "CMPSC 200",
            "MATH 251",
            "MUSIC 005",
            "BA 301",
            "ECON 104"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "USC",
        "school_color_one": "#990000",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/4/44/USC_School_of_Cinematic_Arts_03.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 78,
        "school_tiny_name": "USC",
        "id": 2318,
        "city": "Los angeles",
        "num_popular_courses": 1056,
        "state": "CA",
        "latitude": "34.0223519",
        "population": 39958,
        "website": "www.usc.edu",
        "banner_url_confirmed": true,
        "short_name": "USC",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/6/68/USC_Seal.svg/200px-USC_Seal.svg.png",
        "school_mascot_name": "trojan",
        "school_color_light": "#FFCC00",
        "departments_sanitized": null,
        "school_color_dark": "#990000",
        "school_color_primary": null,
        "school_color_two": "#FFCC00",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-southern-california_50x50.jpg",
        "num_depts": 192,
        "name": "University of Southern California",
        "num_emails": 15726,
        "num_courses": 1296,
        "variations": "traveler trojansmen/women of troy usrc usc",
        "longitude": "-118.285117",
        "courses_sanitized": true,
        "popular_courses": [
            "CS 402",
            "CSCI 101",
            "MOR 462",
            "COMM 200",
            "ITP 280",
            "HIST 266",
            "EXSC 205",
            "FBE 403",
            "SOCI 155",
            "ECON 317",
            "CTCS 469",
            "REL 111",
            "BISC 102",
            "EE 450",
            "EALC 110",
            "PSYC 326",
            "GEOG 257",
            "JOUR 380",
            "PHYS 161",
            "ENGR 101"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/b/bc/University_of_Southern_California_seal.svg"
    },
    {
        "school_casual_name": "Big Green",
        "school_color_one": "#00693E",
        "banner_url": "https://farm3.staticflickr.com/2884/8897272658_03bd6738f9_z.jpg",
        "sp16_start": "Mon, 28 Mar 2016 00:00:00 -0000",
        "rank": 18,
        "school_tiny_name": "Dart",
        "id": 2371,
        "city": "Hanover",
        "num_popular_courses": 48,
        "state": "NH",
        "latitude": "43.7044406",
        "population": 6277,
        "website": "dartmouth.edu",
        "banner_url_confirmed": false,
        "short_name": "Dartmouth",
        "seal_url": null,
        "school_mascot_name": "Keggy the Keg, Moose & Indian (1922-1974) (All unofficial)",
        "school_color_light": null,
        "departments_sanitized": null,
        "school_color_dark": null,
        "school_color_primary": null,
        "school_color_two": null,
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/dartmouth-college_50x50.jpg",
        "num_depts": 66,
        "name": "Dartmouth College",
        "num_emails": 5290,
        "num_courses": 138,
        "variations": "keggy the keg, moose & indian (1922-1974) (all unofficial) big green dc",
        "longitude": "-72.2886934",
        "courses_sanitized": false,
        "popular_courses": [
            "WRIT 2",
            "ECON 20",
            "CS 49",
            "PHYS 41",
            "ANTH 8",
            "COSC 30",
            "ENG 27",
            "JS 613",
            "PSYCH 06",
            "CHEM 81",
            "MATH 23",
            "MALS 307",
            "ENGL 21",
            "HIST 36",
            "PBS 60",
            "ENGLISH 5",
            "PSYC 28",
            "MICRO 264",
            "ENGS 20",
            "SOCY 22"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/e/e4/Dartmouth_College_shield.svg"
    },
    {
        "school_casual_name": "miami oh",
        "school_color_one": "#C41230",
        "banner_url": "http://www.hercampus.com/sites/default/files/2014/02/14/Miami_13.jpg",
        "sp16_start": "Sat, 02 Jan 2016 00:00:00 -0000",
        "rank": 176,
        "school_tiny_name": "M-OX",
        "id": 2365,
        "city": "Oxford",
        "num_popular_courses": 1048,
        "state": "OH",
        "latitude": "39.5105334",
        "population": 17683,
        "website": null,
        "banner_url_confirmed": true,
        "short_name": "Miami Oh",
        "seal_url": null,
        "school_mascot_name": "redhawk",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#C41230",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/miami-university-oxford_50x50.jpg",
        "num_depts": 101,
        "name": "Miami University, Oxford",
        "num_emails": 0,
        "num_courses": 13558,
        "variations": " muo",
        "longitude": "-84.7308768",
        "courses_sanitized": true,
        "popular_courses": [
            "MUS 186",
            "POL 250",
            "AER 118",
            "FIN 331",
            "PHL 106",
            "ART 185",
            "KNH 184",
            "HON 351",
            "BOT 171",
            "ENG 109",
            "HST 121",
            "EDT 421",
            "ECO 385",
            "CLS 102",
            "COM 259",
            "PHY 111",
            "PHS 101",
            "ESP 366",
            "GEOG 225",
            "ACCT 321"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/e/e9/Miami_Hurricanes_logo.svg"
    },
    {
        "school_casual_name": "CMU",
        "school_color_one": "#990000",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5b/Sunset_over_Hammerschlag_Hall_and_the_Cathedral_of_Learning_2_%2B_0.7_EV.JPG/2048px-Sunset_over_Hammerschlag_Hall_and_the_Cathedral_of_Learning_2_%2B_0.7_EV.JPG",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 59,
        "school_tiny_name": "CMU",
        "id": 2455,
        "city": "Pittsburgh",
        "num_popular_courses": 114,
        "state": "PA",
        "latitude": "40.4424925",
        "population": 11978,
        "website": null,
        "banner_url_confirmed": true,
        "short_name": "CMU",
        "seal_url": null,
        "school_mascot_name": "tartan",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": true,
        "school_color_dark": "#990000",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/carnegie-mellon-university_50x50.jpg",
        "num_depts": 66,
        "name": "Carnegie Mellon University",
        "num_emails": 0,
        "num_courses": 6489,
        "variations": " cmu",
        "longitude": "-79.9425528",
        "courses_sanitized": true,
        "popular_courses": [
            "CS 112",
            "ECE 100",
            "MATH 127",
            "CALC 120",
            "PSYCH 102",
            "BIO 121",
            "STAT 201",
            "HIST 104",
            "LIFE 101",
            "PHIL 147",
            "ECON 101",
            "CSE 311",
            "ENG 262",
            "LAB 1",
            "CHEM 218",
            "PHYS 104",
            "DRA 101",
            "BIZ 100",
            "DIFEQ 260",
            "VOICE 01"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/b/bb/Carnegie_Mellon_University_seal.svg"
    },
    {
        "school_casual_name": "Beavers",
        "school_color_one": "#FF6E1E",
        "banner_url": "https://farm8.staticflickr.com/7174/13166682964_06acc83461_z.jpg",
        "sp16_start": "Mon, 28 Mar 2016 00:00:00 -0000",
        "rank": 21,
        "school_tiny_name": "CalT",
        "id": 2498,
        "city": "Pasadena",
        "num_popular_courses": 32,
        "state": "CA",
        "latitude": "34.1376576",
        "population": 2243,
        "website": "caltech.edu",
        "banner_url_confirmed": false,
        "short_name": "Caltech",
        "seal_url": null,
        "school_mascot_name": "Beaver",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": null,
        "school_color_dark": "#FF6E1E",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/california-institute-of-technology_50x50.jpg",
        "num_depts": 167,
        "name": "California Institute of Technology",
        "num_emails": 1292,
        "num_courses": 1297,
        "variations": "beaver beavers cit caltech",
        "longitude": "-118.125269",
        "courses_sanitized": false,
        "popular_courses": [
            "PHY 484",
            "BI 1",
            "EE 114",
            "ACM 95",
            "CHE 169",
            "EC 11",
            "PS 12",
            "PHYS 101",
            "ASTR 101",
            "ME 18",
            "GE 112",
            "CHA 2",
            "CH 1",
            "PH 1",
            "AE 104",
            "MU 140",
            "CS 1"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/e/ef/Caltech_logo.svg"
    },
    {
        "school_casual_name": "\"Golden Gusties\"",
        "school_color_one": "black",
        "banner_url": "https://farm8.staticflickr.com/7294/8743747555_c93018fc5a_z.jpg",
        "sp16_start": "Sat, 06 Feb 2016 00:00:00 -0000",
        "rank": 201,
        "school_tiny_name": "GAC",
        "id": 2558,
        "city": "Saint peter",
        "num_popular_courses": 241,
        "state": "MN",
        "latitude": "44.3240246",
        "population": 2526,
        "website": "gustavus.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": null,
        "school_mascot_name": "\"Gus\" the Lion",
        "school_color_light": "#FFCF00",
        "departments_sanitized": true,
        "school_color_dark": "black",
        "school_color_primary": null,
        "school_color_two": "#FFCF00",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/gustavus-adolphus-college_50x50.jpg",
        "num_depts": 37,
        "name": "Gustavus Adolphus College",
        "num_emails": 0,
        "num_courses": 897,
        "variations": "\"gus\" the lion \"golden gusties\" gac",
        "longitude": "-93.9706135",
        "courses_sanitized": true,
        "popular_courses": [
            "REL 123",
            "PHI 109",
            "SWE 101",
            "HIS 170",
            "EM 125",
            "SA 113",
            "PSY 230",
            "ENG 142",
            "GEG 102",
            "SPA 200",
            "JPN 101",
            "COM 110",
            "CHE 255",
            "POL 200",
            "ART 101",
            "CUR 120",
            "LAT 101",
            "MUS 102",
            "PHY 220",
            "EDU 230"
        ],
        "svg_url": null
    },
    {
        "school_casual_name": "du",
        "school_color_one": "#8B2332",
        "banner_url": "https://upload.wikimedia.org/wikipedia/commons/7/79/University_of_Denver_Sturm_College_of_Law.jpg",
        "sp16_start": "Mon, 04 Jan 2016 00:00:00 -0000",
        "rank": 139,
        "school_tiny_name": "UD",
        "id": 2542,
        "city": "Denver",
        "num_popular_courses": 741,
        "state": "CO",
        "latitude": "39.6766174",
        "population": 11656,
        "website": "www.du.edu",
        "banner_url_confirmed": true,
        "short_name": "Denver",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/a/ae/DUSeal.png",
        "school_mascot_name": "pioneer",
        "school_color_light": "#8B6F4B",
        "departments_sanitized": null,
        "school_color_dark": "#8B2332",
        "school_color_primary": null,
        "school_color_two": "#8B6F4B",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-denver_50x50.jpg",
        "num_depts": 141,
        "name": "University of Denver",
        "num_emails": 0,
        "num_courses": 8310,
        "variations": "(none at this time) pioneers ud",
        "longitude": "-104.9618965",
        "courses_sanitized": true,
        "popular_courses": [
            "FIN 3850",
            "ACC 3520",
            "HIS 1250",
            "CIS 3145",
            "HPL 1660",
            "CDES 2222",
            "PSY 2850",
            "MGT 4950",
            "SWK 3000",
            "HSP 1010",
            "ENG 3470",
            "PSC 3200",
            "HTE 1030",
            "BIO 3240",
            "COM 2610",
            "THE 2210",
            "EDT 3610",
            "CHS 2010",
            "ECON 4111",
            "ECE 3860"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/9/9d/Denver_University_Pioneers_Logo.svg"
    },
    {
        "school_casual_name": "TCU",
        "school_color_one": "#4d1979",
        "banner_url": "https://farm3.staticflickr.com/2470/3721406594_63ecd2e035_n.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 216,
        "school_tiny_name": "TCU",
        "id": 2639,
        "city": "Fort worth",
        "num_popular_courses": 698,
        "state": "TX",
        "latitude": "32.7078079",
        "population": 9727,
        "website": "www.tcu.edu",
        "banner_url_confirmed": false,
        "short_name": "TCU",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/5/57/Texas_Christian_University_Seal.svg/175px-Texas_Christian_University_Seal.svg.png",
        "school_mascot_name": "frog",
        "school_color_light": "#FFFFFF",
        "departments_sanitized": null,
        "school_color_dark": "#4d1979",
        "school_color_primary": null,
        "school_color_two": "#FFFFFF",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/texas-christian-university_50x50.jpg",
        "num_depts": 116,
        "name": "Texas Christian University",
        "num_emails": 0,
        "num_courses": 4549,
        "variations": "super frog horned frogs tcu",
        "longitude": "-97.3637066",
        "courses_sanitized": true,
        "popular_courses": [
            "NTDT 2040",
            "ECON 30243",
            "SPAN 20203",
            "SOCI 002",
            "ACCT 2065",
            "NURS 10303",
            "EDUC 20003",
            "BIO 10003",
            "SOWO 1083",
            "PHYS 20073",
            "GEOL 10143",
            "FINA 3015",
            "PHYSICS 2",
            "ENG 2013",
            "RELI 1043",
            "BIOL 10504",
            "ENGR 10033",
            "INSC 30313",
            "JOUR 10103",
            "HIST 10923"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/5/57/Texas_Christian_University_Seal.svg"
    },
    {
        "school_casual_name": "UVA",
        "school_color_one": "#002FC0",
        "banner_url": "https://farm8.staticflickr.com/7035/6408999007_57de11ab74_b.jpg",
        "sp16_start": "Wed, 20 Jan 2016 00:00:00 -0000",
        "rank": 40,
        "school_tiny_name": "UVA",
        "id": 2687,
        "city": "Charlottesville",
        "num_popular_courses": 604,
        "state": "VA",
        "latitude": "38.0335529",
        "population": 23907,
        "website": "www.virginia.edu",
        "banner_url_confirmed": false,
        "short_name": "UVA",
        "seal_url": null,
        "school_mascot_name": "Cavaliers",
        "school_color_light": "#E87000",
        "departments_sanitized": true,
        "school_color_dark": "#002FC0",
        "school_color_primary": null,
        "school_color_two": "#E87000",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/university-of-virginia-main-campus_50x50.jpg",
        "num_depts": 283,
        "name": "University of Virginia",
        "num_emails": 0,
        "num_courses": 12038,
        "variations": "cavaliers uva uv",
        "longitude": "-78.5079772",
        "courses_sanitized": true,
        "popular_courses": [
            "ECON 202",
            "MUSI 212",
            "RELG 265",
            "SOC 247",
            "PHYS 105",
            "BIOL 201",
            "PSYC 215",
            "HIUS 201",
            "CHEM 1410",
            "PHIL 151",
            "ANTH 225",
            "ASTR 348",
            "FREN 332",
            "APMA 308",
            "ARTH 101",
            "PLPT 101",
            "STS 101",
            "DRAM 281",
            "STAT 2120",
            "PLCP 311"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/commons/a/a9/University_of_Virginia_logo.svg"
    },
    {
        "school_casual_name": "ne",
        "school_color_one": "#CC0000",
        "banner_url": "https://farm4.staticflickr.com/3195/2959084360_19ffd4d9fa_z.jpg",
        "sp16_start": "Mon, 11 Jan 2016 00:00:00 -0000",
        "rank": 209,
        "school_tiny_name": "NE",
        "id": 2703,
        "city": "Boston",
        "num_popular_courses": 1407,
        "state": "MA",
        "latitude": "42.3398067",
        "population": 27694,
        "website": "www.northeastern.edu",
        "banner_url_confirmed": false,
        "short_name": "Northeastern",
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/f/f5/Northeastern-seal.svg/200px-Northeastern-seal.svg.png",
        "school_mascot_name": "huskie",
        "school_color_light": "#CC0000",
        "departments_sanitized": true,
        "school_color_dark": "#615445",
        "school_color_primary": null,
        "school_color_two": "#615445",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/northeastern-university_50x50.jpg",
        "num_depts": 76,
        "name": "Northeastern University",
        "num_emails": 488,
        "num_courses": 1745,
        "variations": "paws huskies nau ne",
        "longitude": "-71.0891717",
        "courses_sanitized": true,
        "popular_courses": [
            "MK 447",
            "IB 201",
            "CSU 370",
            "MGT 4750",
            "BC 290",
            "COMM 3423",
            "CS 5010",
            "EECE 3326",
            "BIOU 111",
            "PSY 1111",
            "HRM 6030",
            "ENTR 3401",
            "POLU 400",
            "SOC 241",
            "PSYU 458",
            "HST 387",
            "EDUC 1111",
            "CLTR 1501",
            "BIOL 1103",
            "ENVR 1120"
        ],
        "svg_url": "https://upload.wikimedia.org/wikipedia/en/f/f5/Northeastern-seal.svg"
    },
    {
        "school_casual_name": "Bullets",
        "school_color_one": "#DE7500",
        "banner_url": "https://farm1.staticflickr.com/23/27145794_2bacfe6be1_z.jpg",
        "sp16_start": "Mon, 18 Jan 2016 00:00:00 -0000",
        "rank": 103,
        "school_tiny_name": "Gett",
        "id": 2739,
        "city": "Gettysburg",
        "num_popular_courses": 317,
        "state": "PA",
        "latitude": "39.835958",
        "population": 2600,
        "website": "www.gettysburg.edu",
        "banner_url_confirmed": false,
        "short_name": null,
        "seal_url": "//upload.wikimedia.org/wikipedia/en/thumb/9/95/Gettysburg_College_seal.png/183px-Gettysburg_College_seal.png",
        "school_mascot_name": null,
        "school_color_light": "#DE7500",
        "departments_sanitized": true,
        "school_color_dark": "#23336E",
        "school_color_primary": null,
        "school_color_two": "#23336E",
        "forbes_url": null,
        "logo_url": "http://i.forbesimg.com/media/lists/colleges/gettysburg-college_50x50.jpg",
        "num_depts": 64,
        "name": "Gettysburg College",
        "num_emails": 0,
        "num_courses": 1530,
        "variations": "bullets gc",
        "longitude": "-77.2372308",
        "courses_sanitized": true,
        "popular_courses": [
            "HIST 300",
            "VAH 120",
            "BIO 225",
            "LAS 140",
            "SPAN 101",
            "CHEM 203",
            "ES 211",
            "MGT 235",
            "FILM 101",
            "REL 105",
            "CS 103",
            "FYS 150",
            "POL 103",
            "VAS 141",
            "MATH 301",
            "ANTH 106",
            "WS 222",
            "ENG 235",
            "PHIL 211",
            "PHY 255"
        ],
        "svg_url": null
    }
]

angular
    .module('uguru.shared.services')
    .factory("GUtilService", [
        '$timeout',
    GUtilService
    ]);

function GUtilService($timeout) {
  var publicPlaceService;


  function latCoordToGoogleLatLng(lat, lng) {
    return new google.maps.LatLng(parseFloat(lat), parseFloat(lng));
  }


  function initPlacesService(map) {
    return new google.maps.places.PlacesService(map);
  }

  function getAddressFromLatLng(lat, lng, scope) {
      var gCoords = latCoordToGoogleLatLng(lat, lng);
      var geoCoderObj = new google.maps.Geocoder();
      var geoCodePayload = {location: gCoords};
      geoCoderObj.geocode(geoCodePayload, function(results, status) {
        if (status === google.maps.GeocoderStatus.OK) {
          if (results.length) {
            if (scope && scope.requestForm) {
              scope.requestForm.address = results[0].formatted_address;
              scope.requestForm.location = {latitude: results[0].geometry.location.lat(), longitude:results[0].geometry.location.lng()};
            }
          }
        }
      })
  }

  function printPhotos(places) {
      var photoCount = 0;
      for (var i = 0; i < places.length; i++) {
          var resultPlace = places[i];
          if (resultPlace.photos && resultPlace.photos.length){
            photoCount += 1;
          }
      }
    }

  function getPlaceListByCoords(scope, map, coords, callback, options) {
    var options = options || {};

    var gCoords = latCoordToGoogleLatLng(coords.latitude, coords.longitude);
    var placeService = new google.maps.places.PlacesService(map);
    var types = options.types || ['library', 'food', 'cafe', 'bus-stop', 'grocery'];
    // var types = ["bus-stop", "cafe", "establishment", "grocery", "library", "lodging", "parking", "restaurant", "theater", "weight"];
    var radius = options.radius || 500;
    var placeService = new google.maps.places.PlacesService(map);
    var placeServiceOptions = { location: gCoords, radius:radius || 10000, rankBy: google.maps.places.RankBy.prominence, types: types};
    placeService.nearbySearch(placeServiceOptions, updateScopeWithPlaces);

    function updateScopeWithPlaces(results, status) {
      if (status == google.maps.places.PlacesServiceStatus.OK) {
        if (results.length) {

          $timeout(function() {
            scope.university.place_results = [];
            for (var i = 0; i < results.length; i++) {
              var resultPlace = results[i];
              if (!resultPlace.photos || !resultPlace.photos.length) {
                continue;
              }

              resultPlace.svg_path = getMapIconPathOnly(resultPlace.types[0], scope.university.school_color_dark, '#FFFFFF', 5);
              resultPlace.photo_url = resultPlace.photos[0].getUrl({'maxWidth': 100, 'maxHeight': 100})
              scope.university.place_results.push(resultPlace);
            }
            if (callback) {

              callback(scope.university, scope.category);
            }
          });
        }
      }
    }
  }

  function coordsToNearestPlace(map, coords, requestForm, types, radius) {
    var gCoords = latCoordToGoogleLatLng(coords.latitude, coords.longitude);
    var placeService = new google.maps.places.PlacesService(map);
    var placeServiceOptions = { location: gCoords, radius:radius || 2000, rankBy: google.maps.places.RankBy.prominence, types: types};

    placeService.nearbySearch(placeServiceOptions, updateRequestFormWithPlace);

    function updateRequestFormWithPlace(results, status) {
      if (status == google.maps.places.PlacesServiceStatus.OK) {
           if (results.length) {
            for (var i = 0; i < results.length; i++) {
            }
           } else {
            //get cross street
            // TODO: http://stackoverflow.com/questions/10676790/getting-an-intersection-with-google-places-geocoding-api
           }
      }
    }

  }

  function getMapIconPathOnly(keyVal, stroke_hex, fill_hex, stroke_weight) {
    var mapIconDict = {
      "bus-stop": 'M33.4454342,33.1111111 C31.5542205,33.1111111 30,34.3572253 30,35.8990022 L30,49.8795222 C30,51.4212991 31.5542205,52.6666667 33.4454342,52.6666667 L66.5794259,52.6666667 C68.4715604,52.6666667 70,51.4212991 70,49.8795222 L70,35.8990022 C70,34.3572253 68.4715604,33.1111111 66.5794259,33.1111111 L33.4454342,33.1111111 L33.4454342,33.1111111 L33.4454342,33.1111111 Z M27.1810466,18 L73.8200621,18 C76.1583881,18 78,19.7325373 78,21.8989747 L78,70.9909352 C78,73.1277652 76.2215861,74.8317162 73.9442406,74.8888889 L73.8211708,74.8888889 L73.6648389,74.8888889 L65.6464541,74.8888889 C65.5233843,74.8603025 65.3969883,74.8603025 65.271701,74.8888889 L35.6972544,74.8888889 L35.3546547,74.8888889 L27.3052252,74.8888889 C27.2120913,74.8603025 27.1488933,74.8603025 27.0557594,74.8603025 L27.0247148,74.8603025 C24.7784139,74.7735225 23,73.0981579 23,70.9909352 L23,21.8979537 C23.0011087,19.7325373 24.8416119,18 27.1810466,18 L27.1810466,18 L27.1810466,18 Z M35.0135856,60.6666667 C37.2523047,60.6666667 39,62.2224603 39,64.2099486 C39,66.1728895 37.2523047,67.7777778 35.0135856,67.7777778 C32.7738962,67.7777778 31,66.1728895 31,64.2099486 C31,62.2224603 32.7748666,60.6666667 35.0135856,60.6666667 L35.0135856,60.6666667 L35.0135856,60.6666667 Z M66.0009671,60.6666667 C68.2321083,60.6666667 70,62.2224603 70,64.2099486 C70,66.1728895 68.2321083,67.7777778 66.0009671,67.7777778 C63.7678917,67.7777778 62,66.1728895 62,64.2099486 C62,62.2224603 63.7678917,60.6666667 66.0009671,60.6666667 L66.0009671,60.6666667 L66.0009671,60.6666667 Z M29,74.8888889 L37,74.8888889 L37,80.7125876 C37,81.4484067 36.3213747,82 35.4536463,82 L30.5476949,82 C29.6799665,82 29.0013412,81.447323 29.0013412,80.7125876 L29.0013412,74.8888889 L29,74.8888889 L29,74.8888889 Z M64,74.8888889 L72,74.8888889 L72,80.7125876 C72,81.4484067 71.3213747,82 70.4536463,82 L65.5476949,82 C64.6799665,82 64.0013412,81.447323 64.0013412,80.7125876 L64.0013412,74.8888889 L64,74.8888889 L64,74.8888889 Z M38,25.1111111 C38,23.6383518 39.1889834,22.4444444 40.6754379,22.4444444 L60.3245621,22.4444444 C61.8021656,22.4444444 63,23.6413485 63,25.1111111 L63,25.1111111 C63,26.5838704 61.8110166,27.7777778 60.3245621,27.7777778 L40.6754379,27.7777778 C39.1978344,27.7777778 38,26.5808737 38,25.1111111 L38,25.1111111 Z',
      "cafe": 'M69.7423747,43.7777778 L70.9810759,33.2165522 C71.0454426,32.667759 70.6517105,32.2222222 70.1015564,32.2222222 L30.1208189,32.2222222 C29.5676537,32.2222222 29.1768904,32.6673989 29.2412993,33.2165522 L30.4800005,43.7777778 L69.7423747,43.7777778 Z M66.8232158,68.6666667 L65.3760032,81.00567 C65.3115943,81.5548233 64.8075957,82 64.2513656,82 L35.9710096,82 C35.4142983,82 34.9107387,81.5544633 34.846372,81.00567 L33.3991595,68.6666667 L66.8232158,68.6666667 Z M25.0204167,23.4177221 C25.1554325,22.8801957 25.7197841,22.4444444 26.2683259,22.4444444 L73.3810662,22.4444444 C73.9352516,22.4444444 74.493207,22.8771997 74.6289754,23.4177221 L76.596021,31.2489446 C76.7310368,31.786471 76.3896116,32.2222222 75.8330941,32.2222222 L23.8162979,32.2222222 C23.2599292,32.2222222 22.9176027,31.789467 23.0533711,31.2489446 L25.0204167,23.4177221 Z M32.0394423,18.9425524 C32.2321699,18.4219951 32.8379488,18 33.3853073,18 L65.9466044,18 C66.4971775,18 67.1012808,18.426152 67.2924694,18.9425524 L68.2400219,21.5018921 C68.4327495,22.0224494 68.1375919,22.4444444 67.5961491,22.4444444 L31.7357626,22.4444444 C31.1874338,22.4444444 30.9007012,22.0182924 31.0918897,21.5018921 L32.0394423,18.9425524 Z M28.3485134,44.7688106 C28.2930377,44.2214783 28.6950797,43.7777778 29.2434991,43.7777778 L70.9785758,43.7777778 C71.5283385,43.7777778 71.9280703,44.2310173 71.8735615,44.7688106 L69.5518056,67.6756339 C69.4963299,68.2229662 69.0035795,68.6666667 68.456331,68.6666667 L31.7657433,68.6666667 C31.2162051,68.6666667 30.7247776,68.2134272 30.6702688,67.6756339 L28.3485134,44.7688106 Z',
      "establishment": 'M19,35.7777778 L81.2222222,35.7777778 L50.1107184,18 L19,35.7777778 Z M26.6704444,41.880065 L32.8926667,41.880065 L32.8926667,69.5506529 L26.6704444,69.5506529 L26.6704444,41.880065 Z M40.3333333,41.880065 L46.5555556,41.880065 L46.5555556,69.5506529 L40.3333333,69.5506529 L40.3333333,41.880065 Z M53.6666667,41.880065 L59.8888889,41.880065 L59.8888889,69.5506529 L53.6666667,69.5506529 L53.6666667,41.880065 Z M67.9984444,41.880065 L74.2206667,41.880065 L74.2206667,69.5506529 L67.9984444,69.5506529 L67.9984444,41.880065 Z M24.3333333,35.6578428 L75.8888889,35.6578428 L75.8888889,41.880065 L24.3333333,41.880065 L24.3333333,35.6578428 Z M24.3333333,69.5555556 L75.8888889,69.5555556 L75.8888889,75.7777778 L24.3333333,75.7777778 L24.3333333,69.5555556 Z M19,75.7777778 L81.2222222,75.7777778 L81.2222222,82 L19,82 L19,75.7777778 Z',
      "grocery": 'M19.6687987,51.4228417 C19.4194933,50.3468444 20.1144762,49.4745763 21.2120326,49.4745763 L79.8314457,49.4745763 C80.9330557,49.4745763 81.6231033,50.3506498 81.3746796,51.4228417 L74.9731465,79.0517345 C74.7238411,80.1277318 73.6268007,81 72.5203499,81 L28.5231284,81 C27.4177916,81 26.3187555,80.1239265 26.0703318,79.0517345 L19.6687987,51.4228417 Z M23.9130435,69.8644068 L76.0973896,69.8644068 M22.8695652,59.4576271 L78.183757,59.4576271 M32.2608696,49.4745763 L38.5217391,80.4745763 M14,45.2711864 C14,42.9497183 15.8888166,41.0677966 18.2086436,41.0677966 L81.7913564,41.0677966 C84.1157261,41.0677966 86,42.9544421 86,45.2711864 L86,45.2711864 C86,47.5926545 84.1111834,49.4745763 81.7913564,49.4745763 L18.2086436,49.4745763 C15.8842739,49.4745763 14,47.5879308 14,45.2711864 L14,45.2711864 Z M68.7826087,49.4745763 L62.5217391,80.4745763 M50.5217391,49.4745763 L50.5217391,80.4745763 M30.8183756,22.8944809 C31.3268944,20.7436185 33.5238756,19 35.7435821,19 L66.3433745,19 C68.554972,19 70.7615871,20.7500687 71.2685809,22.8944809 L75.5652174,41.0677966 L26.5217391,41.0677966 L30.8183756,22.8944809 Z',
      "library": 'M17,25 L12,25 L12,77 L88,77 L88,25 L83,25 M17,23 C17,23 24,21 33,21 C42,21 50,23 50,23 L50,73 C50,73 42,71 33,71 C24,71 17,73 17,73 L17,23 Z M50,23 C50,23 57,21 66,21 C75,21 83,23 83,23 L83,73 C83,73 75,71 66,71 C57,71 50,73 50,73 L50,23 Z M50,70.5 L50,76.5',
      "lodging": 'M14,59.4003632 L86,59.4003632 L86,67.4016015 L14,67.4016015 L14,59.4003632 Z M22.3478261,47.0030958 L77.3459525,47.0030958 C80.6606958,47.0030958 83.3478261,49.6965468 83.3478261,53.0040245 L83.3478261,59.0049532 M24.442771,67.7819727 L24.442771,75.999364 L19.2094029,75.999364 L19.2094029,67.7819727 M79.7471188,67.7819727 L79.7471188,75.999364 L74.5137507,75.999364 L74.5137507,67.7819727 M14,59 L14,32.0050741 C14,29.7931328 15.7953562,28 18,28 L18,28 C20.209139,28 22,29.8006843 22,32.0050741 L22,59',
      "parking": 'M30.2162107,36.8634124 C30.0087463,35.7775888 29.9256554,34.0037524 30.0828066,32.916777 C30.0828066,32.916777 30.8453024,15 49.9353487,15 C69.0253949,15 69.7878908,32.916777 69.7878908,32.916777 C69.9216781,34.01062 69.8632165,35.7709661 69.6544867,36.8634124 L63.3726068,69.741404 C63.1651424,70.8272276 62.0977389,71.7074615 60.9904903,71.7074615 L38.8802071,71.7074615 C37.7720649,71.7074615 36.7068203,70.8338504 36.4980905,69.741404 L30.2162107,36.8634124 Z M46.5224799,74.0592008 C46.5224799,72.9587836 47.4084377,72.0667193 48.5299823,72.0667193 L50.3483108,72.0667193 C51.4570238,72.0667193 52.3558133,72.9556761 52.3558133,74.0592008 L52.3558133,83.0075185 C52.3558133,84.1079357 51.4698555,85 50.3483108,85 L48.5299823,85 C47.4212694,85 46.5224799,84.1110432 46.5224799,83.0075185 L46.5224799,74.0592008 Z M46.5224799,46.9839985 C46.5224799,45.8795449 47.4084377,44.9842084 48.5299823,44.9842084 L50.3483108,44.9842084 C51.4570238,44.9842084 52.3558133,45.8799301 52.3558133,46.9839985 L52.3558133,59.4273715 C52.3558133,60.531825 51.4698555,61.4271615 50.3483108,61.4271615 L48.5299823,61.4271615 C47.4212694,61.4271615 46.5224799,60.5314398 46.5224799,59.4273715 L46.5224799,46.9839985 Z M62.0833333,35.8922226 C62.0833333,28.749369 56.6423494,22.958942 49.9305556,22.958942 C43.2187617,22.958942 37.7777778,28.749369 37.7777778,35.8922226 C37.7777778,35.8922227 62.0833334,35.8922227 62.0833333,35.8922226 Z M52.8472222,29.0248717 L49.9305556,35.7954994',
      "meal_takeaway": 'M78.7777778,18 L78.7777778,38.4324336 C78.7777778,45.6100023 72.9219566,51.4285714 65.7311828,51.4285714 C58.5257474,51.4285714 52.6845878,45.6057587 52.6845878,38.4324336 L52.6845878,18 M65.7311828,52.1703404 L65.7311828,83 M22.8637993,18 L30.0782514,19.916983 C33.8139289,20.9096059 36.8422939,24.8504932 36.8422939,28.6989037 L36.8422939,40.7296677 C36.8422939,44.5871657 33.8091688,48.5202304 30.0782514,49.5115884 L22.8637993,51.4285714 M22.8637993,18 L22.8637993,83 M78.7777778,34.7142857 L78.7777778,39.4440162 C78.7777778,44.0115599 65.7311828,34.7142857 65.7311828,34.7142857 C65.7311828,34.7142857 52.6845878,44.0088594 52.6845878,39.4440162 L52.6845878,34.7142857 M65.7311828,18 L65.7311828,34.816755',
      "food": 'M78.7777778,18 L78.7777778,38.4324336 C78.7777778,45.6100023 72.9219566,51.4285714 65.7311828,51.4285714 C58.5257474,51.4285714 52.6845878,45.6057587 52.6845878,38.4324336 L52.6845878,18 M65.7311828,52.1703404 L65.7311828,83 M22.8637993,18 L30.0782514,19.916983 C33.8139289,20.9096059 36.8422939,24.8504932 36.8422939,28.6989037 L36.8422939,40.7296677 C36.8422939,44.5871657 33.8091688,48.5202304 30.0782514,49.5115884 L22.8637993,51.4285714 M22.8637993,18 L22.8637993,83 M78.7777778,34.7142857 L78.7777778,39.4440162 C78.7777778,44.0115599 65.7311828,34.7142857 65.7311828,34.7142857 C65.7311828,34.7142857 52.6845878,44.0088594 52.6845878,39.4440162 L52.6845878,34.7142857 M65.7311828,18 L65.7311828,34.816755',
      "restaurant": 'M78.7777778,18 L78.7777778,38.4324336 C78.7777778,45.6100023 72.9219566,51.4285714 65.7311828,51.4285714 C58.5257474,51.4285714 52.6845878,45.6057587 52.6845878,38.4324336 L52.6845878,18 M65.7311828,52.1703404 L65.7311828,83 M22.8637993,18 L30.0782514,19.916983 C33.8139289,20.9096059 36.8422939,24.8504932 36.8422939,28.6989037 L36.8422939,40.7296677 C36.8422939,44.5871657 33.8091688,48.5202304 30.0782514,49.5115884 L22.8637993,51.4285714 M22.8637993,18 L22.8637993,83 M78.7777778,34.7142857 L78.7777778,39.4440162 C78.7777778,44.0115599 65.7311828,34.7142857 65.7311828,34.7142857 C65.7311828,34.7142857 52.6845878,44.0088594 52.6845878,39.4440162 L52.6845878,34.7142857 M65.7311828,18 L65.7311828,34.816755',
      "theater": 'M19,39 C19,39 31,44.4651163 36.4545455,44.4651163 C43,44.4651163 55,39 55,39 L55,70.6996925 C55,71.302238 54.8421766,72.2473732 54.6235513,72.8125957 C54.6235513,72.8125957 50.6363636,86 36.4545455,86 C22.2727273,86 19.3055416,72.8355416 19.3055416,72.8355416 C19.1367956,72.2584902 19,71.3017171 19,70.6996925 L19,39 L19,39 Z M28.7894737,69.6363636 C28.7894737,69.6363636 31.5087719,74 36.9473684,74 C42.3859649,74 45.1052632,69.6363636 45.1052632,69.6363636 M25.5263158,56.5454545 C25.5263158,56.5454545 26.6140351,53.2727273 29.877193,53.2727273 C33.1403509,53.2727273 34.2280702,56.5454545 34.2280702,56.5454545 M40.754386,56.5454545 C40.754386,56.5454545 41.8421053,53.2727273 45.1052632,53.2727273 C48.3684211,53.2727273 49.4561404,56.5454545 49.4561404,56.5454545 M45,14 C45,14 57,19.4651163 62.4545455,19.4651163 C69,19.4651163 81,14 81,14 L81,45.6996925 C81,46.302238 80.8421766,47.2473732 80.6235513,47.8125957 C80.6235513,47.8125957 76.6363636,61 62.4545455,61 C59.4616616,61 54.8882463,58.9889982 54.8882463,58.9889982 L54.8882467,39.1395349 L46.0395263,42.0738843 C45.4654118,42.2642681 45,41.9253466 45,41.3219748 L45,14 L45,14 Z M54.8947368,48.9090909 C54.8947368,48.9090909 57.6140351,44.5454545 63.0526316,44.5454545 C68.4912281,44.5454545 71.2105263,48.9090909 71.2105263,48.9090909 M51.6315789,31.4545455 C51.6315789,31.4545455 52.7192982,28.1818182 55.9824561,28.1818182 C59.245614,28.1818182 60.3333333,31.4545455 60.3333333,31.4545455 M66.8596491,31.4545455 C66.8596491,31.4545455 67.9473684,28.1818182 71.2105263,28.1818182 C74.4736842,28.1818182 75.5614035,31.4545455 75.5614035,31.4545455',
      "weight": 'M35.1764706,50 L64.8235294,50 M82.8235294,50 L86,50 M14,50 L17.1764706,50 M18.2352941,42.3333604 C18.2352941,40.6764912 19.577484,39.3333333 21.2336271,39.3333333 L23.7075494,39.3333333 C25.3634829,39.3333333 26.7058824,40.6678289 26.7058824,42.3333604 L26.7058824,57.6666396 C26.7058824,59.3235088 25.3636925,60.6666667 23.7075494,60.6666667 L21.2336271,60.6666667 C19.5776935,60.6666667 18.2352941,59.3321711 18.2352941,57.6666396 L18.2352941,42.3333604 Z M26.7058824,36.9961002 C26.7058824,35.3413998 28.0480722,34 29.7042153,34 L32.1781376,34 C33.8340712,34 35.1764706,35.3342595 35.1764706,36.9961002 L35.1764706,63.0038998 C35.1764706,64.6586002 33.8342807,66 32.1781376,66 L29.7042153,66 C28.0482818,66 26.7058824,64.6657405 26.7058824,63.0038998 L26.7058824,36.9961002 Z M64.8235294,36.9961002 C64.8235294,35.3413998 66.1657193,34 67.8218624,34 L70.2957847,34 C71.9517182,34 73.2941176,35.3342595 73.2941176,36.9961002 L73.2941176,63.0038998 C73.2941176,64.6586002 71.9519278,66 70.2957847,66 L67.8218624,66 C66.1659288,66 64.8235294,64.6657405 64.8235294,63.0038998 L64.8235294,36.9961002 Z M73.2941176,42.3333604 C73.2941176,40.6764912 74.6363075,39.3333333 76.2924506,39.3333333 L78.7663729,39.3333333 C80.4223065,39.3333333 81.7647059,40.6678289 81.7647059,42.3333604 L81.7647059,57.6666396 C81.7647059,59.3235088 80.422516,60.6666667 78.7663729,60.6666667 L76.2924506,60.6666667 C74.6365171,60.6666667 73.2941176,59.3321711 73.2941176,57.6666396 L73.2941176,42.3333604 Z'
    }
    return mapIconDict[keyVal];
  }
  function getMapIconPath(keyVal, stroke_hex, fill_hex, stroke_weight) {
    var mapIconDict = {
      "bus-stop": 'M33.4454342,33.1111111 C31.5542205,33.1111111 30,34.3572253 30,35.8990022 L30,49.8795222 C30,51.4212991 31.5542205,52.6666667 33.4454342,52.6666667 L66.5794259,52.6666667 C68.4715604,52.6666667 70,51.4212991 70,49.8795222 L70,35.8990022 C70,34.3572253 68.4715604,33.1111111 66.5794259,33.1111111 L33.4454342,33.1111111 L33.4454342,33.1111111 L33.4454342,33.1111111 Z M27.1810466,18 L73.8200621,18 C76.1583881,18 78,19.7325373 78,21.8989747 L78,70.9909352 C78,73.1277652 76.2215861,74.8317162 73.9442406,74.8888889 L73.8211708,74.8888889 L73.6648389,74.8888889 L65.6464541,74.8888889 C65.5233843,74.8603025 65.3969883,74.8603025 65.271701,74.8888889 L35.6972544,74.8888889 L35.3546547,74.8888889 L27.3052252,74.8888889 C27.2120913,74.8603025 27.1488933,74.8603025 27.0557594,74.8603025 L27.0247148,74.8603025 C24.7784139,74.7735225 23,73.0981579 23,70.9909352 L23,21.8979537 C23.0011087,19.7325373 24.8416119,18 27.1810466,18 L27.1810466,18 L27.1810466,18 Z M35.0135856,60.6666667 C37.2523047,60.6666667 39,62.2224603 39,64.2099486 C39,66.1728895 37.2523047,67.7777778 35.0135856,67.7777778 C32.7738962,67.7777778 31,66.1728895 31,64.2099486 C31,62.2224603 32.7748666,60.6666667 35.0135856,60.6666667 L35.0135856,60.6666667 L35.0135856,60.6666667 Z M66.0009671,60.6666667 C68.2321083,60.6666667 70,62.2224603 70,64.2099486 C70,66.1728895 68.2321083,67.7777778 66.0009671,67.7777778 C63.7678917,67.7777778 62,66.1728895 62,64.2099486 C62,62.2224603 63.7678917,60.6666667 66.0009671,60.6666667 L66.0009671,60.6666667 L66.0009671,60.6666667 Z M29,74.8888889 L37,74.8888889 L37,80.7125876 C37,81.4484067 36.3213747,82 35.4536463,82 L30.5476949,82 C29.6799665,82 29.0013412,81.447323 29.0013412,80.7125876 L29.0013412,74.8888889 L29,74.8888889 L29,74.8888889 Z M64,74.8888889 L72,74.8888889 L72,80.7125876 C72,81.4484067 71.3213747,82 70.4536463,82 L65.5476949,82 C64.6799665,82 64.0013412,81.447323 64.0013412,80.7125876 L64.0013412,74.8888889 L64,74.8888889 L64,74.8888889 Z M38,25.1111111 C38,23.6383518 39.1889834,22.4444444 40.6754379,22.4444444 L60.3245621,22.4444444 C61.8021656,22.4444444 63,23.6413485 63,25.1111111 L63,25.1111111 C63,26.5838704 61.8110166,27.7777778 60.3245621,27.7777778 L40.6754379,27.7777778 C39.1978344,27.7777778 38,26.5808737 38,25.1111111 L38,25.1111111 Z',
      "cafe": 'M69.7423747,43.7777778 L70.9810759,33.2165522 C71.0454426,32.667759 70.6517105,32.2222222 70.1015564,32.2222222 L30.1208189,32.2222222 C29.5676537,32.2222222 29.1768904,32.6673989 29.2412993,33.2165522 L30.4800005,43.7777778 L69.7423747,43.7777778 Z M66.8232158,68.6666667 L65.3760032,81.00567 C65.3115943,81.5548233 64.8075957,82 64.2513656,82 L35.9710096,82 C35.4142983,82 34.9107387,81.5544633 34.846372,81.00567 L33.3991595,68.6666667 L66.8232158,68.6666667 Z M25.0204167,23.4177221 C25.1554325,22.8801957 25.7197841,22.4444444 26.2683259,22.4444444 L73.3810662,22.4444444 C73.9352516,22.4444444 74.493207,22.8771997 74.6289754,23.4177221 L76.596021,31.2489446 C76.7310368,31.786471 76.3896116,32.2222222 75.8330941,32.2222222 L23.8162979,32.2222222 C23.2599292,32.2222222 22.9176027,31.789467 23.0533711,31.2489446 L25.0204167,23.4177221 Z M32.0394423,18.9425524 C32.2321699,18.4219951 32.8379488,18 33.3853073,18 L65.9466044,18 C66.4971775,18 67.1012808,18.426152 67.2924694,18.9425524 L68.2400219,21.5018921 C68.4327495,22.0224494 68.1375919,22.4444444 67.5961491,22.4444444 L31.7357626,22.4444444 C31.1874338,22.4444444 30.9007012,22.0182924 31.0918897,21.5018921 L32.0394423,18.9425524 Z M28.3485134,44.7688106 C28.2930377,44.2214783 28.6950797,43.7777778 29.2434991,43.7777778 L70.9785758,43.7777778 C71.5283385,43.7777778 71.9280703,44.2310173 71.8735615,44.7688106 L69.5518056,67.6756339 C69.4963299,68.2229662 69.0035795,68.6666667 68.456331,68.6666667 L31.7657433,68.6666667 C31.2162051,68.6666667 30.7247776,68.2134272 30.6702688,67.6756339 L28.3485134,44.7688106 Z',
      "establishment": 'M19,35.7777778 L81.2222222,35.7777778 L50.1107184,18 L19,35.7777778 Z M26.6704444,41.880065 L32.8926667,41.880065 L32.8926667,69.5506529 L26.6704444,69.5506529 L26.6704444,41.880065 Z M40.3333333,41.880065 L46.5555556,41.880065 L46.5555556,69.5506529 L40.3333333,69.5506529 L40.3333333,41.880065 Z M53.6666667,41.880065 L59.8888889,41.880065 L59.8888889,69.5506529 L53.6666667,69.5506529 L53.6666667,41.880065 Z M67.9984444,41.880065 L74.2206667,41.880065 L74.2206667,69.5506529 L67.9984444,69.5506529 L67.9984444,41.880065 Z M24.3333333,35.6578428 L75.8888889,35.6578428 L75.8888889,41.880065 L24.3333333,41.880065 L24.3333333,35.6578428 Z M24.3333333,69.5555556 L75.8888889,69.5555556 L75.8888889,75.7777778 L24.3333333,75.7777778 L24.3333333,69.5555556 Z M19,75.7777778 L81.2222222,75.7777778 L81.2222222,82 L19,82 L19,75.7777778 Z',
      "grocery": 'M19.6687987,51.4228417 C19.4194933,50.3468444 20.1144762,49.4745763 21.2120326,49.4745763 L79.8314457,49.4745763 C80.9330557,49.4745763 81.6231033,50.3506498 81.3746796,51.4228417 L74.9731465,79.0517345 C74.7238411,80.1277318 73.6268007,81 72.5203499,81 L28.5231284,81 C27.4177916,81 26.3187555,80.1239265 26.0703318,79.0517345 L19.6687987,51.4228417 Z M23.9130435,69.8644068 L76.0973896,69.8644068 M22.8695652,59.4576271 L78.183757,59.4576271 M32.2608696,49.4745763 L38.5217391,80.4745763 M14,45.2711864 C14,42.9497183 15.8888166,41.0677966 18.2086436,41.0677966 L81.7913564,41.0677966 C84.1157261,41.0677966 86,42.9544421 86,45.2711864 L86,45.2711864 C86,47.5926545 84.1111834,49.4745763 81.7913564,49.4745763 L18.2086436,49.4745763 C15.8842739,49.4745763 14,47.5879308 14,45.2711864 L14,45.2711864 Z M68.7826087,49.4745763 L62.5217391,80.4745763 M50.5217391,49.4745763 L50.5217391,80.4745763 M30.8183756,22.8944809 C31.3268944,20.7436185 33.5238756,19 35.7435821,19 L66.3433745,19 C68.554972,19 70.7615871,20.7500687 71.2685809,22.8944809 L75.5652174,41.0677966 L26.5217391,41.0677966 L30.8183756,22.8944809 Z',
      "library": 'M17,25 L12,25 L12,77 L88,77 L88,25 L83,25 M17,23 C17,23 24,21 33,21 C42,21 50,23 50,23 L50,73 C50,73 42,71 33,71 C24,71 17,73 17,73 L17,23 Z M50,23 C50,23 57,21 66,21 C75,21 83,23 83,23 L83,73 C83,73 75,71 66,71 C57,71 50,73 50,73 L50,23 Z M50,70.5 L50,76.5',
      "lodging": 'M14,59.4003632 L86,59.4003632 L86,67.4016015 L14,67.4016015 L14,59.4003632 Z M22.3478261,47.0030958 L77.3459525,47.0030958 C80.6606958,47.0030958 83.3478261,49.6965468 83.3478261,53.0040245 L83.3478261,59.0049532 M24.442771,67.7819727 L24.442771,75.999364 L19.2094029,75.999364 L19.2094029,67.7819727 M79.7471188,67.7819727 L79.7471188,75.999364 L74.5137507,75.999364 L74.5137507,67.7819727 M14,59 L14,32.0050741 C14,29.7931328 15.7953562,28 18,28 L18,28 C20.209139,28 22,29.8006843 22,32.0050741 L22,59',
      "parking": 'M30.2162107,36.8634124 C30.0087463,35.7775888 29.9256554,34.0037524 30.0828066,32.916777 C30.0828066,32.916777 30.8453024,15 49.9353487,15 C69.0253949,15 69.7878908,32.916777 69.7878908,32.916777 C69.9216781,34.01062 69.8632165,35.7709661 69.6544867,36.8634124 L63.3726068,69.741404 C63.1651424,70.8272276 62.0977389,71.7074615 60.9904903,71.7074615 L38.8802071,71.7074615 C37.7720649,71.7074615 36.7068203,70.8338504 36.4980905,69.741404 L30.2162107,36.8634124 Z M46.5224799,74.0592008 C46.5224799,72.9587836 47.4084377,72.0667193 48.5299823,72.0667193 L50.3483108,72.0667193 C51.4570238,72.0667193 52.3558133,72.9556761 52.3558133,74.0592008 L52.3558133,83.0075185 C52.3558133,84.1079357 51.4698555,85 50.3483108,85 L48.5299823,85 C47.4212694,85 46.5224799,84.1110432 46.5224799,83.0075185 L46.5224799,74.0592008 Z M46.5224799,46.9839985 C46.5224799,45.8795449 47.4084377,44.9842084 48.5299823,44.9842084 L50.3483108,44.9842084 C51.4570238,44.9842084 52.3558133,45.8799301 52.3558133,46.9839985 L52.3558133,59.4273715 C52.3558133,60.531825 51.4698555,61.4271615 50.3483108,61.4271615 L48.5299823,61.4271615 C47.4212694,61.4271615 46.5224799,60.5314398 46.5224799,59.4273715 L46.5224799,46.9839985 Z M62.0833333,35.8922226 C62.0833333,28.749369 56.6423494,22.958942 49.9305556,22.958942 C43.2187617,22.958942 37.7777778,28.749369 37.7777778,35.8922226 C37.7777778,35.8922227 62.0833334,35.8922227 62.0833333,35.8922226 Z M52.8472222,29.0248717 L49.9305556,35.7954994',
      "restaurant": 'M78.7777778,18 L78.7777778,38.4324336 C78.7777778,45.6100023 72.9219566,51.4285714 65.7311828,51.4285714 C58.5257474,51.4285714 52.6845878,45.6057587 52.6845878,38.4324336 L52.6845878,18 M65.7311828,52.1703404 L65.7311828,83 M22.8637993,18 L30.0782514,19.916983 C33.8139289,20.9096059 36.8422939,24.8504932 36.8422939,28.6989037 L36.8422939,40.7296677 C36.8422939,44.5871657 33.8091688,48.5202304 30.0782514,49.5115884 L22.8637993,51.4285714 M22.8637993,18 L22.8637993,83 M78.7777778,34.7142857 L78.7777778,39.4440162 C78.7777778,44.0115599 65.7311828,34.7142857 65.7311828,34.7142857 C65.7311828,34.7142857 52.6845878,44.0088594 52.6845878,39.4440162 L52.6845878,34.7142857 M65.7311828,18 L65.7311828,34.816755',
      "theater": 'M19,39 C19,39 31,44.4651163 36.4545455,44.4651163 C43,44.4651163 55,39 55,39 L55,70.6996925 C55,71.302238 54.8421766,72.2473732 54.6235513,72.8125957 C54.6235513,72.8125957 50.6363636,86 36.4545455,86 C22.2727273,86 19.3055416,72.8355416 19.3055416,72.8355416 C19.1367956,72.2584902 19,71.3017171 19,70.6996925 L19,39 L19,39 Z M28.7894737,69.6363636 C28.7894737,69.6363636 31.5087719,74 36.9473684,74 C42.3859649,74 45.1052632,69.6363636 45.1052632,69.6363636 M25.5263158,56.5454545 C25.5263158,56.5454545 26.6140351,53.2727273 29.877193,53.2727273 C33.1403509,53.2727273 34.2280702,56.5454545 34.2280702,56.5454545 M40.754386,56.5454545 C40.754386,56.5454545 41.8421053,53.2727273 45.1052632,53.2727273 C48.3684211,53.2727273 49.4561404,56.5454545 49.4561404,56.5454545 M45,14 C45,14 57,19.4651163 62.4545455,19.4651163 C69,19.4651163 81,14 81,14 L81,45.6996925 C81,46.302238 80.8421766,47.2473732 80.6235513,47.8125957 C80.6235513,47.8125957 76.6363636,61 62.4545455,61 C59.4616616,61 54.8882463,58.9889982 54.8882463,58.9889982 L54.8882467,39.1395349 L46.0395263,42.0738843 C45.4654118,42.2642681 45,41.9253466 45,41.3219748 L45,14 L45,14 Z M54.8947368,48.9090909 C54.8947368,48.9090909 57.6140351,44.5454545 63.0526316,44.5454545 C68.4912281,44.5454545 71.2105263,48.9090909 71.2105263,48.9090909 M51.6315789,31.4545455 C51.6315789,31.4545455 52.7192982,28.1818182 55.9824561,28.1818182 C59.245614,28.1818182 60.3333333,31.4545455 60.3333333,31.4545455 M66.8596491,31.4545455 C66.8596491,31.4545455 67.9473684,28.1818182 71.2105263,28.1818182 C74.4736842,28.1818182 75.5614035,31.4545455 75.5614035,31.4545455',
      "weight": 'M35.1764706,50 L64.8235294,50 M82.8235294,50 L86,50 M14,50 L17.1764706,50 M18.2352941,42.3333604 C18.2352941,40.6764912 19.577484,39.3333333 21.2336271,39.3333333 L23.7075494,39.3333333 C25.3634829,39.3333333 26.7058824,40.6678289 26.7058824,42.3333604 L26.7058824,57.6666396 C26.7058824,59.3235088 25.3636925,60.6666667 23.7075494,60.6666667 L21.2336271,60.6666667 C19.5776935,60.6666667 18.2352941,59.3321711 18.2352941,57.6666396 L18.2352941,42.3333604 Z M26.7058824,36.9961002 C26.7058824,35.3413998 28.0480722,34 29.7042153,34 L32.1781376,34 C33.8340712,34 35.1764706,35.3342595 35.1764706,36.9961002 L35.1764706,63.0038998 C35.1764706,64.6586002 33.8342807,66 32.1781376,66 L29.7042153,66 C28.0482818,66 26.7058824,64.6657405 26.7058824,63.0038998 L26.7058824,36.9961002 Z M64.8235294,36.9961002 C64.8235294,35.3413998 66.1657193,34 67.8218624,34 L70.2957847,34 C71.9517182,34 73.2941176,35.3342595 73.2941176,36.9961002 L73.2941176,63.0038998 C73.2941176,64.6586002 71.9519278,66 70.2957847,66 L67.8218624,66 C66.1659288,66 64.8235294,64.6657405 64.8235294,63.0038998 L64.8235294,36.9961002 Z M73.2941176,42.3333604 C73.2941176,40.6764912 74.6363075,39.3333333 76.2924506,39.3333333 L78.7663729,39.3333333 C80.4223065,39.3333333 81.7647059,40.6678289 81.7647059,42.3333604 L81.7647059,57.6666396 C81.7647059,59.3235088 80.422516,60.6666667 78.7663729,60.6666667 L76.2924506,60.6666667 C74.6365171,60.6666667 73.2941176,59.3321711 73.2941176,57.6666396 L73.2941176,42.3333604 Z'
    }
    var templatedPathValue = {
      'path': mapIconDict[keyVal],
      'fillOpacity': 1,
      'strokeOpacity':1,
      // labelOrigin: new google.maps.Point(0, 40),
      'rotation': 0,
      'scale': 0.5,
      'strokeColor': stroke_hex,
      'fillColor': fill_hex,
      // anchor: new google.maps.Point(0, 0),
      'strokeWeight': (!stroke_weight || 3)
    }
    return templatedPathValue;
  }

  function getInvisibleIconPath() {
    return {
      "path": "M33.4454342, 31.4545455",
      "fillOpacity": 0,
      "strokeOpacity":0,
      "rotation": 0,
      "scale":0.01,
      "strokeColor": "transparent",
      "fillColor": "transparent",
      "strokeWeight": 0
    }
  }

  function getNearestLocationOneMarker(map, lat, lng, scope) {
    if (!publicPlaceService) {
      publicPlaceService = initPlacesService(map, lat, lng);
    }
    var GLatLng = latCoordToGoogleLatLng(lat, lng);
    var requestPayload = {location: GLatLng, rankBy:google.maps.places.RankBy.DISTANCE, types:["restaurant", "cafe", "food", "bar" ,"point_of_interest", "establishment"]};
    publicPlaceService.nearbySearch(requestPayload,
      function(results, status) {
        if (status == google.maps.places.PlacesServiceStatus.OK) {
           if (results.length) {
            var placeName = results[0].name;
            var placeObj = results[0];
            scope.map.centerMarker.windowText = placeName;
            scope.map.centerMarker.closestPlace = placeObj;
           }
        }
      }
    );
  }

  var createMarker = function(map, lat, lng, markerObj, iconUrl) {
    var gLocation = latCoordToGoogleLatLng(lat, lng);
    var marker = new google.maps.Marker({
        position: gLocation,
        map: map,
        title: markerObj.name,
        animation: google.maps.Animation.DROP,
        icon: iconUrl
      });
    return marker;
  }

  var createMarkerWithLabel = function(map, lat, lng, icon, options) {
    var gLocation = latCoordToGoogleLatLng(lat, lng);
    var marker = new MarkerWithLabel({
        position: gLocation,
        map: map,
        // title: markerObj.name,
        animation: options.animation,
        // icon: icon,
        labelContent: options.labelContent,
        labelAnchor: new google.maps.Point(0,20),
        labelStyle:"color:" + options.labelColor + ' !important;' + options.customStyle || '',
        labelClass: options.className, // the CSS class for the label
        labelInBackground: false,
      });
    return marker;
  }

  function generateStaticMapUrls(uni_arr, options) {
    var API_KEY = "AIzaSyAIonm682hyuTYUjpQ0rWYVvBbY4ES1D-Y"
    for (var i = 0; i < uni_arr.length; i++) {
      var indexUni = uni_arr[i];
      indexUni.static_map_url = getStaticMapUriForUniversityObj(indexUni, options.zoom, options.map_type, options.size, options.scale);
    }
    return uni_arr;
  }

  function getStaticMapUriForUniversityObj(uni, zoom, maptype, size, scale, api_key) {
    return "https://maps.googleapis.com/maps/api/staticmap?center=" + uni.latitude + ',' +  uni.longitude + "&zoom=" + zoom + "&size=" + size + "&scale=" + scale + "maptype=" + maptype  // + "&key=" + api_key || ""
  }

  var getRelevantIcon = function(color_one, color_two, g_types) {
    // https://developers.google.com/maps/documentation/javascript/reference?hl=en#Symbol
    //rotation, scale, stroke color, stroke opacity, stroke weight, path, label origin, fillOpacity, fillColor, anchor
    var formatIconSvgUrl = function(iconName,scope) {
      return scope.img_base + 'templates/svg/main/map/' + iconName + '.svg'
    }
    var supportedIcons = ["bus-stop", "cafe", "establishment", "grocery", "library", "lodging", "parking", "restaurant", "theater", "weight"];

    for (var i = 0; i < g_types.length; i++) {
      var gTypeIndex = g_types[i];
      var matchedIndex = supportedIcons.indexOf(gTypeIndex)
      if (matchedIndex > -1) {
        // return formatIconSvgUrl(supportedIcons[matchedIndex], scope);
        return getMapIconPath(supportedIcons[matchedIndex], color_one, color_two, 5);
      }
    }

    var randItem = supportedIcons[Math.floor(Math.random()*supportedIcons.length)];
    return getMapIconPath(randItem, color_one, color_two, 5);
  }

  var convertSVGStringIntoDataUri = function(svg_string) {
    var precursorFormat = "data:image/svg+xml,";
    var result = precursorFormat + encodeURIComponent(svg_string);
    return result;
  }

  var getHtmlForUniversityPennant = function(university) {
    return "<h1>" + university.short_name + "</h1><br>" + "<small>" + university.city + ", " + university.state + "</small>"
  }

  // (map, university_arr, scope.map.markers, {icon_type:"university_penant", label_color:"white", custom_class})
  var initSeveralMarkersWithLabel = function(map, obj_arr, scope, options, callback) {
    var result_arr = [];
    var obj_arr = JSON.parse(JSON.stringify(obj_arr));
    for (var i = 0; i < obj_arr.length; i++) {

      var objIndex = obj_arr[i];
      var icon = getRelevantIcon(objIndex.school_color_dark, objIndex.school_color_light, options.icon_type);




      var pictureLabel = document.createElement("img");
      if (objIndex.school_tiny_name && objIndex.school_tiny_name.length) {
        var universityName = objIndex.school_tiny_name
      }
      else if (objIndex.short_name && objIndex.short_name.length) {
        var universityName = objIndex.short_name;
      } else if (objIndex.name && objIndex.name.length) {
        var universityName = objIndex.name;
      }


      if (universityName.length > 4) {
        universityName = universityName.substring(0,4);
      }
      if (objIndex.school_color_light === '#757575')  {
        objIndex.school_color_light = '#FFFFFF';
      }
      var svgImage = "<svg viewBox='0 0 73 41' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><path d='M71.7272013,15.1343641 L63.071575,20.5 L72.2393802,25.9924931 L0,41 L1.42108547e-14,0 L71.7272013,15.1343641 L71.7272013,15.1343641 Z' id='flag' opacity='0.9' fill='" + objIndex.school_color_dark +"'></path><path d='M0,0 L0,41 L6.261,39.7 L6.261,1.321 L0,0 Z' id='border' fill='" + objIndex.school_color_light +"'></path><text font-family='Source Sans Pro' font-size='16' font-weight='600' line-spacing='16' fill='" + objIndex.school_color_light +"'><tspan x='8' y='26'>" + universityName + "</tspan></text></svg>"
      var pennantPaths = [];
      pictureLabel.src = convertSVGStringIntoDataUri(svgImage, options);

      var objIndex = obj_arr[i];
        // var indexmarker =
      var createMarker = function(university, i) {
        var pictureLabel = document.createElement("img");
        if (university.school_tiny_name && university.school_tiny_name.length) {
          var universityName = university.school_tiny_name
        }
        else if (university.short_name && university.short_name.length) {
          var universityName = university.short_name;
        } else if (university.name && university.name.length) {
          var universityName = university.name;
        }


        if (university.school_color_light === '#757575')  {
          university.school_color_light = '#FFFFFF';
        }
        var svgImage = "<svg viewBox='0 0 73 41' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><path d='M71.7272013,15.1343641 L63.071575,20.5 L72.2393802,25.9924931 L0,41 L1.42108547e-14,0 L71.7272013,15.1343641 L71.7272013,15.1343641 Z' id='flag' opacity='0.9' fill='" + university.school_color_dark +"'></path><path d='M0,0 L0,41 L6.261,39.7 L6.261,1.321 L0,0 Z' id='border' fill='" + university.school_color_light +"'></path><text font-family='Source Sans Pro' font-size='16' font-weight='600' line-spacing='16' fill='" + university.school_color_light +"'><tspan x='8' y='26'>" + universityName + "</tspan></text></svg>"
        var pennantPaths = [];
        pictureLabel.src = convertSVGStringIntoDataUri(svgImage, options);

        var markerWithLabelDict = {
          'position': latCoordToGoogleLatLng(university.latitude, university.longitude),
          'map': map,
          'icon':  getInvisibleIconPath(), //cant edit the icon css
          'labelContent': pictureLabel,
          'labelAnchor': new google.maps.Point(0,0),
          'labelClass': 'university-svg-icon', // the CSS class for the label
          'labelInBackground': false,
          'customInfo': {short_name: university.short_name, city:university.city, state:university.state},
          'idKey': i
        }
        return markerWithLabelDict;
        // return new MarkerWithLabel(markerWithLabelDict);
      }

      result_arr.push(createMarker(obj_arr[i], i))
      // google.maps.event.addListener(marker_arr[i], 'click', function() {
      //   alert('this was clicked')
      //   var infowindow = new google.maps.InfoWindow({
      //     content: getHtmlForUniversityPennant(this.customInfo)
      //   });
      //   infowindow.open(map, this);
      // })




      // var indexMarker = createMarkerWithLabel(map, objIndex.latitude, objIndex.longitude, null, markerOptions);
    }
    return result_arr;
    // callback && callback(result_arr);
  }

  var nearbyLocationMarkers = [];
  function getNearestLocationManyMarkers(map, lat, lng, scope) {
    if (!publicPlaceService) {
      publicPlaceService = initPlacesService(map, lat, lng);
    }
    var GLatLng = latCoordToGoogleLatLng(lat, lng);
    var requestPayload = {location: GLatLng, rankBy:google.maps.places.RankBy.DISTANCE, types:["restaurant", "cafe", "food", "bar"]};
    publicPlaceService.nearbySearch(requestPayload,
      function(results, status) {
        if (status == google.maps.places.PlacesServiceStatus.OK) {
           if (results.length) {
            nearbyLocationMarkers = [];
            for (var i = 0; i < results.length; i++) {
              var placeName = results[i].name;
              var placeObj = results[i];
              var placeLat = results[i].geometry.location.G;
              var placeLng = results[i].geometry.location.K;
              var iconUrl = getRelevantIcon(scope.university.school_color_dark, scope.university.school_color_light, placeObj.types);
              var markerOptions = {
                labelContent: placeObj.types[0],
                labelColor: scope.university.school_color_dark,
                className: 'gmap-marker-label',
              }
              var indexMarker = createMarkerWithLabel(map, placeLat, placeLng, iconUrl, markerOptions);
              nearbyLocationMarkers.push(indexMarker);
            }
            scope.map.nearbyLocations.markers = JSON.parse(JSON.stringify(nearbyLocationMarkers));
           }
        }
      }
    );
  }
  return {
    latCoordToGoogleLatLng:latCoordToGoogleLatLng,
    initPlacesService:initPlacesService,
    getNearestLocationOneMarker: getNearestLocationOneMarker,
    getNearestLocationManyMarkers: getNearestLocationManyMarkers,
    initSeveralMarkersWithLabel: initSeveralMarkersWithLabel,
    generateStaticMapUrls: generateStaticMapUrls,
    coordsToNearestPlace: coordsToNearestPlace,
    getAddressFromLatLng: getAddressFromLatLng,
    getPlaceListByCoords: getPlaceListByCoords
  }
}
angular.module('uguru.shared.services')
.factory("TransformService", [
    '$timeout',
    '$state',
    'UtilitiesService',
    'AnimationService',
    'RootService',
    TransformService
        ]);

function TransformService($timeout, $state, UtilitiesService, AnimationService, RootService) {

      // ---- transform ----
      // backface-visibility
      // perspective-origin
      // transform-box
      // transform-origin
      // transform-style

      // shorthand syntax
      // timing state
      // clear
      // special coordinates
      // special element properties
      // tweener
      // consecutive
      // animation directive




      // multiple animations at once

      return {
        getElemPosition: getElemPosition,
        getTranslateToCoords: getTranslateToCoords,
        parseTransformArgs: parseTransformArgs,
        getSupported: getSupported
      }

      function getSupported() {
          return ['to', 'tf', 'timing-function', 'rotatex', 'rotatey', 'rotatez', 'translatex', 'translatey', 'translatez', 'scalex', 'scaley', 'scalez', 'pe', 'translate', 'sk-x', 'sk-y', 'sky', 'skx', 'sx', 'sc-x', 's-x', 'sy', 'sc-y', 's-y', 'sz', 'sc-z', 's-z', 'tr', 'tr-z', 'tr-x', 'tr-y', 't-z', 't-x', 'tr-y', 'tx', 'ty','tz', 'rx', 'rz', 'r-x', 'ro-x', 'r-y', 'ry', 'ro-y', 'r-z', 'ro-z', 'p-o', 'perspective-origin', 'transform-box', 't-b', 'transform-origin', 'transform-style', 't-s', 't-o',  'backface-visibility', 'b-v', 'perspective-origin', 'p-origin', 'rotate', 'skew', 'skewX', 'skewY', 'duration', 'delay', 'clear', 'tz', 'sz', 'sx', 'sy', 'scale', 'sc', 'moveX', 'moveY', 'moveZ', 'scaleX', 'scaleY', 'scaleZ', 'perspective', 'p'];
      }

      function parse2d(coord_string) {

      }

      function detectTransformDictKey(str) {
        str = str.toLowerCase();
        if (['sc', 'scale'].indexOf(str) > -1) {
          return "scale"
        }
        if ('p' === str || 'pe' === str) {
          return 'perspective'
        }
        if ('sk' === str) {
          return 'skew'
        }
        if (['tr-z', 'tz', 't-z', 'translatez'].indexOf(str) > -1) {
          return 'translateZ'
        }
        if (['tr-y', 'ty', 't-y', 'translatey'].indexOf(str) > -1) {
          return 'translateY'
        }
        if (['tr-x', 'tx', 't-x', 'translatex'].indexOf(str) > -1) {
          return 'translateX'
        }
        if (['ro-z', 'rz', 'r-z', 'rotatez'].indexOf(str) > -1) {
          return 'rotateZ'
        }
        if (['ro-y', 'ry', 'r-y', 'rotatey'].indexOf(str) > -1) {
          return 'rotateY'
        }
        if (['ro-x', 'rx', 'r-x', 'rotatex'].indexOf(str) > -1) {
          return 'rotateX'
        }
        if (['sc-x', 'sx', 's-x', 'scalex'].indexOf(str) > -1) {
          return 'scaleX'
        }
        if (['sk-x', 'sk', 'skewx'].indexOf(str) > -1) {
          return 'skewX'
        }
        if (['sk-y', 'sky', 'skewy'].indexOf(str) > -1) {
          return 'skewY'
        }
        if (['sc-y', 'sy', 's-y', 'scaley'].indexOf(str) > -1) {
          return 'scaleY'
        }
        if (['sc-z', 'sz', 's-z', 'scalez'].indexOf(str) > -1) {
          return 'scaleZ'
        }
        if ('p-o' === str || 'p-origin' === str || 'po' === str) {
          return 'perspective-origin'
        }
        if ('t-b' === str || 'transform-box' === str || 'tb' === str) {
          return 'transform-box'
        }
        if ('tf' === str) {
          return 'timing-function';
        }
        if ('b-v' === str)  {
          return 'backface-visibility'
        }
        if ('t-o' === str) {
          return 'transform-origin'
        }
        if ('t-s' === str) {
          return 'transform-style'
        }
        if (['tr', 'translate'].indexOf(str) > -1) {
          return "translate"
        }
        if (['r', 'rotate', 'ro'].indexOf(str) > -1) {
          return "rotate";
        }
        return str;
      }
      function parseTransformDictKey(key, str, resultDict) {
        var strSplit = str.split(',');
        if (key === 'scale') {
          var args = ['X', 'Y', 'Z'];
          strSplit.forEach(function(arg, index) {
            resultDict['scale' + args[index]] = parseFloat(arg)
          })
        }
        if (key === 'translate' || key === 't' || key === 'tr') {
          var args = ['X', 'Y', 'Z'];
          strSplit.forEach(function(arg, index) {
            resultDict['translate' + args[index]] = arg
          })
        }
        if (key === 'rotate' || key === 'r' || key === 'ro') {
          var args = ['X', 'Y', 'Z'];
          strSplit.forEach(function(arg, index) {
            resultDict['rotate' + args[index]] = arg
          })
        }
        if (key === 'skew' || key === 'sk') {
          var args = ['X', 'Y'];
          strSplit.forEach(function(arg, index) {
            resultDict['skew' + args[index]] = arg
          })
        }
      }

      function parseTransformArgs(transform_dict, elem, browser_prefix) {
        var resultDict = {};
        var extra_args = ['tf', 'timing-function', 't-s', 'transform-style', 'transform-box', 't-b', 'b-v', 'backface-visibility', 't-o', 'transform-origin', 't-s', 'transform-style', 'p-o', 'perspective-origin']
        for (key in transform_dict) {
          parsedKey = detectTransformDictKey(key);
          switch (parsedKey) {
            case ('delay'):
              resultDict.delay = parseInt(transform_dict[key]);
              break;
            case ('scale'):
              parseTransformDictKey(parsedKey, transform_dict[key], resultDict)
              break;
            case ('perspective'):
              resultDict['perspective'] = transform_dict[key];
              break;
            case ('skew'):
              parseTransformDictKey(parsedKey, transform_dict[key], resultDict)
            case ('sk'):
              parseTransformDictKey(parsedKey, transform_dict[key], resultDict)
            case ('t'):
              parseTransformDictKey(parsedKey, transform_dict[key], resultDict)
            case ('tr'):
              parseTransformDictKey(parsedKey, transform_dict[key], resultDict)
            case ('translate'):
              parseTransformDictKey(parsedKey, transform_dict[key], resultDict);
              break;
            case ('rotateX'):
              resultDict['rotateX'] = transform_dict[key];
              break
            case ('rotateY'):
              resultDict['rotateY'] = transform_dict[key];
              break;
            case ('rotateZ'):
              resultDict['rotateZ'] = transform_dict[key];
              break;
            case ('skewX'):
              resultDict['skewX'] = transform_dict[key];
              break;
            case ('skewY'):
              resultDict['skewY'] = transform_dict[key];
              break;
            case ('translateX'):
              resultDict['translateX'] = transform_dict[key];
              break
            case ('translateY'):
              resultDict['translateY'] = transform_dict[key];
              break;
            case ('translateZ'):
              resultDict['translateZ'] = transform_dict[key];
              break;
            case ('scaleX'):
              resultDict['scaleX'] = transform_dict;
              break
            case ('scaleY'):
              resultDict['scaleY'] = transform_dict;
              break;
            case ('scaleZ'):
              resultDict['scaleZ'] = transform_dict;
              break;
            case ('rotate'):
              parseTransformDictKey(parsedKey, transform_dict[key], resultDict);
            case ('clear'):
              resultDict.translateX = '0px';
              resultDict.translateY = '0px';
              break;
            case ('clear' && transform_dict[key] === 'scale'):
              resultDict.scaleX = '0px';
              resultDict.scaleY = '0px';
            case ('to'):
              resultDict.duration = transform_dict[key]
              var translateCoords = xyToElem(elem, transform_dict[key]);
              for (coordName in translateCoords) {
                resultDict[coordName] = translateCoords[coordName];
              }
              break;
            case ('timing-function'):
              resultDict.timingFunction = transform_dict[key];
              if (['cb', 'cubic-bezier'].indexOf(resultDict.timingFunction) > -1) {
              }
              break;
            case ('duration'):
              resultDict.duration = transform_dict[key]
              break;
          }

          if (extra_args.indexOf(key) > -1) {
            var formattedArg = detectTransformDictKey(key);
            if (!('ext' in resultDict)) {
              resultDict.ext = {};
            }
            resultDict.ext[formattedArg] = transform_dict[key];
          }

        }

        return resultDict
      }

      function xyToElem(elem, selector) {
        var translateToElem = document.querySelector(selector);
        if (translateToElem) {
          var to_coords = getElemPosition(translateToElem);
          var from_coords = getElemPosition(elem[0]);
          return getTranslateToCoords(to_coords, from_coords);
        }
      };

      function getElemPosition(elem) {
        var elemRect = elem.getBoundingClientRect();
        return {height: elemRect.height, width: elemRect.width, top: elemRect.top, left: elemRect.left};
      }


      function getTranslateToCoords(from_elem_coords, to_elem_coords, x_offset, y_offset) {
        var translateY = parseInt(from_elem_coords.top - to_elem_coords.top) + ((y_offset && parseInt(y_offset )) || 0);
        var translateX = parseInt(from_elem_coords.left - to_elem_coords.left) + ((x_offset && parseInt(x_offset)) || 0);
        return {translateX: translateX + 'px', translateY: translateY + 'px'};
      }

}

angular.module('uguru.shared.services')
    .factory("ContentService", [
        'CategoryService',
        ContentService
    ]);

function ContentService(Category) {
    var STATIC_BASE = "https://uguru-rest-test.herokuapp.com/static/remote/";

    var splashCategoryOptions = {
        academic: {
            madlib: {
                _class: "academic-madlib",
                template: {
                    beginning: "It's",
                    p1: "5am",
                    middle: "and I have a ",
                    p2: "bio exam",
                    end: "in 4 hours"
                },
                blank_one_options: ['midnight', '2am', 'bedtime', '7am'],
                blank_two_options: ['paper', 'speech', 'report', 'project']
            }
        },
        household: {
            madlib: {
                _class: "household-madlib",
                template: {
                    beginning: "It's been a ",
                    p1: "month",
                    middle: "since I did",
                    p2: "my laundry",
                    end: ""
                },
                blank_one_options: ["semester", "...idk", "week", "never"],
                blank_two_options: ["the dishes", "vacuuming", "cleaned the bathroom", "ironed"]
            }
        },
        tech: {
            madlib: {
                _class: "tech-madlib",
                template: {
                    beginning: "My current",
                    p1: "iphone",
                    middle: "needs a",
                    p2: "new screen",
                    end: ""
                },
                blank_one_options: ['macbook', 'router', 'windows pc', 'nexus tablet'],
                blank_two_options: ['virus', '1hr battery life', 'replacement', 'charger'],
            }
        },
        photography: {
            madlib: {
                _class: 'photography-madlib',
                template: {
                    beginning: "Its almost",
                    p1: "graduation",
                    middle: "and I need",
                    p2: "take grad photos",
                    end: "",
                },
                blank_one_options: ['photography', 'photography', 'photography', 'photography'],
                blank_two_options: ['photography', 'photography', 'photography', 'photography']
            }
        },
        baking: {
            madlib: {
                _class: 'bakery-madlib',
                template: {
                    beginning: "I'm really",
                    p1: "lazy",
                    middle: "and I'm craving",
                    p2: "brownies"
                },
                blank_one_options: ['baking', 'baking', 'baking', 'baking'],
                blank_two_options: ['baking', 'baking', 'baking', 'baking']
            }
        }
    }

    var pricing = {
        header: "Estimated Pricing",
        cards: {
            one: {
                header: 'HEADER HEADER HEADER',
                subheader: 'subheader subheader subheader subheader subheader subheader subheader subheader subheader subheader',
                attributes: ['attributes attributes attributes', 'attributes attributes attributes', 'attributes attributes attributes'],
                pricing: 50
            },
            two: {
                header: 'HEADER HEADER HEADER',
                subheader: 'subheader subheader subheader subheader subheader subheader subheader subheader subheader subheader',
                attributes: ['attributes attributes attributes', 'attributes attributes attributes', 'attributes attributes attributes'],
                pricing: 50
            },
            three: {
                header: 'HEADER HEADER HEADER',
                subheader: 'subheader subheader subheader subheader subheader subheader subheader subheader subheader subheader',
                attributes: ['attributes attributes attributes', 'attributes attributes attributes', 'attributes attributes attributes'],
                pricing: 50
            }
        },
        footer: {
            sophisticated: "If you seek something more sophisticated, we have a couple of these left",
            affordability: "if none of these meet your needs or are out of budget, contact us for a quick reply",
        }
    }

    var sampleProfiles = {
        "academic": {
            "name": "Kelly U",
            "category": {
                name: "Academic Course Shop"
            },
            "rating": {
                "review_count": 24,
                "avg_stars": 4.5
            },
            "profile_url": "https://uguru-rest-test.herokuapp.com/static/remote/img/filler/avatars/guru-academic-f.jpg",
            "guru_introduction": "Note-taking guru extraordinaire.",
            "profile_code": "academic",
            "verified": true,
            "percentile": "3rd",
            "guru_ratings": new Array(49),
            "guru_rating": {
                "int": 5,
                "half": false,
            },
            "university": {
                "name": "University of California at Berkeley",
                "short_name": "UC Berkeley"
            },
            "skype_friendly": true,
            "messenger_friendly": true,
            "phone_friendly": true,
            "text_friendly": true,
            "year": "grad student",
            "is_alumni": false,
            "major": "Computer Science",
            "guru_languages": [{
                name: "English"
            }, {
                name: "Spanish"
            }, ],
            "all_currencies": [{
                name: "Money",
                active: true,
                icon_url: "cash.html"
            }, {
                name: "Food",
                active: true,
                icon_url: "food.html"
            }, {
                name: "Bitcoin",
                active: true,
                icon_url: "dogecoin.html"
            }, {
                name: "Meal Points",
                active: true,
                icon_url: "meal_points.html"
            }, {
                name: "Coffee",
                active: true,
                icon_url: "coffee.html"
            }, {
                name: "Kitten Time",
                active: true,
                icon_url: "kitten_time.html"
            }],
            "guru_experiences": [{
                name: "NASA Intern",
                years: 1,
                description: "",
            }, {
                name: "CS 312 TA",
                years: 2,
                description: "",
            }, {
                name: "CS 200 TA",
                description: "",
                years: 1
            }],
            "academic_shop": {
                "banner_url": "https://uguru-rest-test.herokuapp.com/static/remote/img/filler/avatars/guru-academic-f.jpg",
                "title": "The Golden Bear Tutor",
                "description": "Tutoring for three years, I am devoted in helping my peers achieve eureka moments when studying. Dean’s List and in the top quartile of all my classes.",
                "portfolio_items":
                    [{
                    "rounded_avg_rating": 5,
                    "half_stars": false,
                    "avg_rating": 4.9,
                    "name": "CS 200",
                    "full_name": "Algorithms and Data Structures",
                    "hourly_price": 20,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "CS 312",
                    "full_name": "Introduction to Programming",
                    "hourly_price": 25,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "MATH 410",
                    "full_name": "Linear Algebra",
                    "hourly_price": 15,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "CS 420",
                    "full_name": "Analysis of Algorithms",
                    "hourly_price": 15,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }]
            }
        },
        "bakery": {
            "name": "Jeremy O",
            "category": {
                name: "Bakery"
            },
            "rating": {
                "review_count": 24,
                "avg_stars": 4.5
            },
            "profile_url": "https://uguru-rest-test.herokuapp.com/static/remote/img/filler/avatars/guru-baker-m.jpg",
            "guru_introduction": "I make yummy things",
            "profile_code": "baking",
            "verified": true,
            "percentile": "8th",
            "guru_ratings": new Array(15),
            "guru_rating": {
                "int": 4,
                "half": true,
            },
            "university": {
                "name": "Cornell University",
                "short_name": "Cornell"
            },
            "skype_friendly": true,
            "messenger_friendly": true,
            "phone_friendly": true,
            "text_friendly": true,
            "year": "junior",
            "is_alumni": false,
            "major": "Hospitality",
            "guru_languages": [{
                name: "French"
            }, {
                name: "Italian"
            }, ],
            "all_currencies": [{
                name: "Money",
                active: true,
                icon_url: "cash.html"
            }, {
                name: "Food",
                active: true,
                icon_url: "food.html"
            }, {
                name: "Bitcoin",
                active: true,
                icon_url: "dogecoin.html"
            }, {
                name: "Meal Points",
                active: true,
                icon_url: "meal_points.html"
            }, {
                name: "Coffee",
                active: true,
                icon_url: "coffee.html"
            }, {
                name: "Kitten Time",
                active: true,
                icon_url: "kitten_time.html"
            }],
            "guru_experiences": [{
                name: "Barista at Starbucks",
                description: "",
                years: "current"
            }, {
                name: "Baker at Mrs. Fields",
                description: "",
                years: 2
            }],
            "academic_shop": {
                "banner_url": "https://uguru-rest-test.herokuapp.com/static/remote/img/filler/avatars/guru-baker-m.jpg",
                "title": "Jem's Quality Treats",
                "description": "Fresh delivery with tasty vegan, gluten-free and kosher options. Creating the most delicious, all natural baked goods from Court Hall on North Campus. Drop me a line to check out my seasonal treats.",
                "portfolio_items":
                    [{
                    "rounded_avg_rating": 5,
                    "half_stars": false,
                    "avg_rating": 4.9,
                    "name": "",
                    "full_name": "Chocolate Chip Cookies",
                    "hourly_price": 5,
                    "price_measure": "dozen",
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/baking/cookie.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "Cupcakes",
                    "hourly_price": 10,
                    "price_measure": "dozen",
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/baking/cupcake.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "Donuts",
                    "hourly_price": 8,
                    "price_measure": "dozen",
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/baking/donut.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "Macarons",
                    "hourly_price": 12,
                    "price_measure": "dozen",
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/baking/maca.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }]
            }
        },
        "household": {
            "name": "Austin L",
            "category": {
                name: "Household"
            },
            "rating": {
                "review_count": 24,
                "avg_stars": 4.5
            },
            "profile_url": "https://uguru-rest-test.herokuapp.com/static/remote/img/filler/avatars/guru-clean-m.jpg",
            "guru_introduction": "So fresh, so clean, and a five-star guru.",
            "profile_code": "household",
            "verified": true,
            "percentile": "25th",
            "guru_rating": {
                "int": 4,
                "half": true,
            },
            "guru_ratings": new Array(83),
            "university": {
                "name": "Washington University in St Louis",
                "short_name": "Wash U"
            },
            "skype_friendly": true,
            "messenger_friendly": true,
            "phone_friendly": true,
            "text_friendly": true,
            "year": "sophomore",
            "is_alumni": false,
            "major": "Hospitality",
            "guru_languages": [{
                name: "English"
            }, {
                name: "Spanish"
            }, {
                name: "Latin"
            }, {
                name: "German"
            }, ],
            "all_currencies": [{
                name: "Money",
                active: true,
                icon_url: "cash.html"
            }, {
                name: "Food",
                active: true,
                icon_url: "food.html"
            }, {
                name: "Meal Points",
                active: true,
                icon_url: "meal_points.html"
            }, {
                name: "Chipotle",
                active: true,
                icon_url: "chipotle.html"
            }, {
                name: "Coffee",
                active: true,
                icon_url: "coffee.html"
            }, {
                name: "Kitten Time",
                active: true,
                icon_url: "kitten_time.html"
            }],
            "guru_experiences": [{
                name: "Guest Service Agent at Holiday Inn",
                years: 1,
                description: "",
            }, {
                name: "Sales Associate at Target",
                description: "",
                years: 2
            }],
            "academic_shop": {
                "banner_url": "https://uguru-rest-test.herokuapp.com/static/remote/img/filler/avatars/guru-clean-m.jpg",
                "title": "Cleanly by Austin",
                "description": "Spruce your dorm or apartment whether you have a messy closet or preparing for a house party. Your living space will be lemon-fresh and squeaky-clean.",
                "portfolio_items":
                    [{
                    "rounded_avg_rating": 5,
                    "half_stars": false,
                    "avg_rating": 4.9,
                    "name": "",
                    "full_name": "Dishwashing",
                    "hourly_price": 10,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/household/dish.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                "rounded_avg_rating": 5,
                "half_stars": false,
                "avg_rating": 4.9,
                "name": "",
                "full_name": "Furniture Cleaning",
                "hourly_price": 12,
                "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                "featured_url": STATIC_BASE + "img/filler/household/furclean.jpg",
                "resources": [{
                    "is_url": true,
                    "is_featured": true,
                    "site_url": ""
                }]
            }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "Floor Care",
                    "hourly_price": 12,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/household/floor.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "Laundry",
                    "hourly_price": 18,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/household/laundry.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "General Cleaning",
                    "hourly_price": 20,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/household/genclean.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }]
            }
        },
        "photography": {
            "name": "Rachel V",
            "category": {
                name: "Photography"
            },
            "rating": {
                "review_count": 24,
                "avg_stars": 4.5
            },
            "profile_url": STATIC_BASE + "img/filler/avatars/guru-photo-f.jpg",
            "guru_introduction": "Often imitated, never duplicated. Photography maniac",
            "profile_code": "photo",
            "verified": true,
            "percentile": "5th",
            "guru_ratings": new Array(19),
            "guru_rating": {
                "int": 4,
                "half": true,
            },
            "university": {
                "name": "Miami University at Oxford",
                "short_name": "Miami U"
            },
            "skype_friendly": true,
            "messenger_friendly": true,
            "phone_friendly": true,
            "text_friendly": true,
            "year": "Freshman",
            "is_alumni": false,
            "major": "Art History",
            "guru_languages": [{
                name: "English"
            }, {
                name: "Chinese"
            }, {
                name: "Japanese"
            }, {
                name: "Tagalog"
            }, ],
            "all_currencies": [{
                name: "Money",
                active: true,
                icon_url: "cash.html"
            }, {
                name: "Food",
                active: true,
                icon_url: "food.html"
            }, {
                name: "Meal Points",
                active: true,
                icon_url: "meal_points.html"
            }, {
                name: "Chipotle",
                active: true,
                icon_url: "chipotle.html"
            }, {
                name: "Coffee",
                active: true,
                icon_url: "coffee.html"
            }, {
                name: "Kitten Time",
                active: true,
                icon_url: "kitten_time.html"
            }],
            "guru_experiences": [{
                name: "Freelance Photographer",
                years: 6,
                description: ""
            }],
            "academic_shop": {
                "banner_url": STATIC_BASE + "img/filler/avatars/guru-photo-f.jpg",
                "title": "Limitless Photos",
                "description": "A multi-disciplinary creative specializing in photography. Self-taught. Passionate about capturing the human spirit. Prints for sale on my website.",
                "portfolio_items":
                    [{
                    "rounded_avg_rating": 5,
                    "half_stars": false,
                    "avg_rating": 4.9,
                    "name": "",
                    "full_name": "Adventure Series",
                    "hourly_price": 15,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/photography/night.jpeg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "Formal Events",
                    "hourly_price": 20,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/photography/suit.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "Headshots",
                    "hourly_price": 20,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/photography/headshots.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "Fun Around Campus",
                    "hourly_price": 15,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/photography/singer.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }]
            }
        },
        "tech": {
            "name": "Gregory M",
            "category": {
                name: "Technology & IT"
            },
            "rating": {
                "review_count": 24,
                "avg_stars": 4.5
            },
            "profile_url": STATIC_BASE + "img/filler/avatars/guru-tech-m.jpg",
            "guru_introduction": "Retro gamer. Go-to person for campus tech advice. Blue Devils fan.",
            "profile_code": "tech",
            "verified": true,
            "percentile": "< 1st",
            "guru_ratings": new Array(36),
            "guru_rating": {
                "int": 4,
                "half": false,
            },
            "university": {
                "name": "Duke University",
                "short_name": "Duke"
            },
            "skype_friendly": true,
            "messenger_friendly": true,
            "phone_friendly": true,
            "text_friendly": true,
            "year": "senior",
            "is_alumni": false,
            "major": "Electrical Engineering",
            "guru_languages": [{
                name: "English"
            }, {
                name: "Greek"
            } ],
            "all_currencies": [{
                name: "Money",
                active: true,
                icon_url: "cash.html"
            }, {
                name: "Food",
                active: true,
                icon_url: "food.html"
            }, {
                name: "Bitcoin",
                active: true,
                icon_url: "dogecoin.html"
            }, {
                name: "Meal Points",
                active: true,
                icon_url: "meal_points.html"
            }, {
                name: "Chipotle",
                active: true,
                icon_url: "chipotle.html"
            }, {
                name: "Coffee",
                active: true,
                icon_url: "coffee.html"
            }],
            "guru_experiences": [{
                name: "Best Buy Geek Squad",
                description: "",
                years: 2
            }, {
                name: "Genius at Apple Store",
                description: "",
                years: 5
            }],
            "academic_shop": {
                "banner_url": "https://uguru.me/static/remote/img/avatar.svg",
                "title": "Smart Tech Repair",
                "description": "I can help you with your Mac or PC meltdowns ASAP.",
                "portfolio_items":
                    [{
                    "rounded_avg_rating": 5,
                    "half_stars": false,
                    "avg_rating": 4.9,
                    "name": "",
                    "full_name": "Broken Device Screens",
                    "hourly_price": "25-$80",
                    "price_measure": "device",
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/tech/broken.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "Water Damage",
                    "hourly_price": "25-$80",
                    "price_measure": "device",
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/tech/waterdmg.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "WiFi Installation",
                    "hourly_price": 15,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/tech/wifi.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "Memory Backup",
                    "hourly_price": 15,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/tech/memory.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "Gadget Help",
                    "hourly_price": 25,
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/tech/gadgethlp.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }, {
                    "rounded_avg_rating": 4,
                    "avg_rating": 4.0,
                    "half_stars": true,
                    "name": "",
                    "full_name": "Web Design",
                    "hourly_price": "20-$30",
                    "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
                    "featured_url": STATIC_BASE + "img/filler/tech/design.jpg",
                    "resources": [{
                        "is_url": true,
                        "is_featured": true,
                        "site_url": ""
                    }]
                }]
            }
        }
    }

    var generateMiniSampleProfileDict = function() {

        var getMainAttributesFromUser = function(category) {
            return {
                name: sampleProfiles[category]["name"],
                profile_url: sampleProfiles[category]["profile_url"],
                verified: sampleProfiles[category]["verified"],
                category_name: sampleProfiles[category]["category"]["name"],
                university_name: sampleProfiles[category]["university"]["short_name"],
                percentile: sampleProfiles[category]["percentile"],
                rating: {
                    "whole_stars": sampleProfiles[category]["guru_rating"]["int"],
                    "has_half_star": sampleProfiles[category]["guru_rating"]["half"],
                    "count": sampleProfiles[category]["guru_ratings"].length
                }
            }
        }

        return {
            tech: getMainAttributesFromUser("tech"),
            household: getMainAttributesFromUser("household"),
            academic: getMainAttributesFromUser("academic"),
            photography: getMainAttributesFromUser("photography"),
            baking: getMainAttributesFromUser("bakery")
        }
    }

    var faq = [
        {question: "What is Uguru?", answer: "<p>uGuru <strong> helps connect college students with peer tutors (Gurus)</strong> who have done well in the same classes in school.</p><p>We have all experienced that helpless feeling when you are stuck in the library by yourself the night before exams because you can’t find help outside the classroom.</p><p>Traditional tutoring is too expensive. Office hours are too packed. Why not make it easy for students to get help from each other?</p><p><strong>So we created a platform to make peer-to-peer help available and affordable.</strong></p>"},
        {question: "Who are you guys?", answer: "<p>We are a team of college students and graduates who are passionate about turning the unnecessary academic competition into collaborative learning opportunities, starting with Cal (Berkeley).</p>"},
        {question: "How is uGuru different comparing to traditional private tutoring?", answer: "<p>Traditional private tutoring costs anywhere from $30 to $60 per hour, and that is ridiculously expensive for poor college students living on top ramen. Since it’s students helping each other, sessions on uGuru are super affordable ($15/hr on average).</p><p>uGuru also focuses on making urgent help available, especially when you are in a jam, and need to cram.</p><p>Most importantly, students are getting help directly from peer tutors that have done well in the same exact courses at Cal, instead of random “experts” who are not familiar with the students particular course.</p>"},
        {question: "Who can sign up as a Guru?", answer: "<p>Everyone can sign up as a Guru, but you will need to prove yourself before you can start charging your students. You will give free sessions until you receive an average rating of 4.5 stars. Most good Gurus can do that in one shot and become an official Guru.</p>"},
        {question: "What is the time commitment as a Guru?", answer: "<p>No time commitment required at all! Signing up to be a guru makes it possible for you to receive work, but you are not obligated to take a job if it doesn’t fit your schedule or if you’re cramming for your own midterm. You set your own schedule based upon which sessions you choose to accept.</p>"},
        {question: "Which classes are offered?", answer: "<p>The class selection is based upon what courses gurus have signed up to tutor. The larger the course, the more likely a guru has signed up to tutor that course. Currently, the largest selection of gurus are available for lower division courses and for writing help.</p>"},
        {question: "Why should I choose uGuru over other resource", answer: "<p>uGuru offers personal attention and time flexibility which are often not offered by other resources on campus. With uGuru, students wouldn’t have to worry about competing for the tutor’s time with other students.</p><p>uGuru tutors are also available at times that are convenient to the student, whether that be on the weekends or late in the night right before a midterm. Overall, it’s easier, and faster.</p>"},
        {question: "What’s the price generally?", answer: "<p>Prices vary, but usually around $15 per hour. You name your own price when you request help, and Gurus also get to reply with their ideal price. We also provide recommended rates depending on the time of the semester (ex: a higher offer helps you attract Gurus during finals season).</p>"},
        {question: "How do students and Gurus get matched up?", answer: "<p>Student sends out a Guru request for a class, specifying a preferred price, time, and location to meet.</p><p>We pin all the Gurus who registered for the class with the request. Based on their availability, Gurus could ignore or accept the request, with the option of changing the price to how much they’d like to get paid.</p><p>Student then choose from up to 3 Gurus based on their ratings, relevant attributes and experience.</p>"},
        {question: "How do students and Gurus get matched up?", answer: "<ol><li>Student sends out a Guru request for a class, specifying a preferred price, time, and location to meet.</li><li>We pin all the Gurus who registered for the class with the request. Based on their availability, Gurus could ignore or accept the request, with the option of changing the price to how much they’d like to get paid.</li><li>Student then choose from up to 3 Gurus based on their ratings, relevant attributes and experience.</li></ol>"},
        {question: "How do students and Gurus get matched up?", answer: "<p>After each payment through the platform, students give the Guru a review and a rating, which will be appear on the Guru’s profile to help other students compare their options.</p><p>Generally, Gurus with higher ratings and higher number of reviews are more popular and are compensated more per hour.</p>"},
        {question: "How does a student reconnect with the same Guru again?", answer: "<p>Since our Gurus are awesome, it is common that students would like to have more sessions with the same Guru after the first time.</p><p>You can re-request from the same Guru, and if the Guru doesn’t respond, the request gets sent to other available Gurus.</p>"}
        ]










    var timeline = {

    }

    var honorPledge = [{
        content: "I will not request that any portion of my work be rewritten by a Guru."
    }, {
        content: "I understand that if I do, I risk immediately losing access to my Uguru account."
    }, {
        content: "All of the work I'm submitting for feedback is my work and my work only."
    }, {
        content: "I understand that Uguru's services may not result in acceptance to any school."
    }, {
        content: "I understand that addicting usage of Uguru may result in cancer."
    }]

    //MVP
    var affordability_modal = {

    }


    var sophisticated_modal = {

    }

    var parents = {

    }

    var generateUniversitySpecificBecomeGuruText = function(university) {
        return {
            header: "A Part-Time Job where U Come 1st",
            top_half: [{
                icon_src: "splash/profile.html",
                header: "Full Stack Profile",
                content: "A platform where you come first. Complete control over your profile.",
            }, {
                icon_src: "splash/promotion.html",
                header: "Analytics & Promotion",
                content: "We'll help you out with digital marketing kits, business cards",
            }, {
                icon_src: "splash/payment.html",
                header: "Your Payment Portal",
                content: "Money goes straight to your bank account. Send an invoice to whoever",
            }, ],
            bottom_half: [{
                icon_src: "splash/skills.html",
                header: "A Shop For ___ Skill",
                content: "Create an academic shop for tutoring, photography shop.",
            }, {
                icon_src: "splash/fees.html",
                header: "Zero Transaction Fees",
                content: "Earn your first $500 in a month and then we'll discuss business.",
            }, {
                icon_src: "splash/pajamas.html",
                header: "Work anytime, anywhere",
                content: "Toggle a switch when you're available to earn and we'll market.",
            }, ]
        };

    }
    var generateUniversitySpecificHowItWorks = function(university) {
        return {
            header: "How Uguru Impacts You", //bold this // or how about "How Uguru Increases Life Quality"
            subheader: "Enjoy all 4 Years of College. Uguru helps you stay on top of your academic life.",
            top_half: [{
                icon_src: "splash/anytime.html",
                header: "24/7, Anytime, Anywhere",
                content: "Request anything. Your peers can help you with biology @2am",
                // content: "Request anything. Your peers can your Biology Grade @2am, take your grad photos, or do dirty laundry",
            }, {
                icon_src: "splash/save.html",
                header: "Dirt-Cheap Tutoring",
                content: "Got a quick question? Need an entire course crammed the night before?",
                // content: "Got a quick question? Need an entire course crammed the night before? Perhaps a guru for your study group of 4?",
            }, {
                icon_src: "splash/same.html",
                header: "Not Just 'Math' Help",
                content: "Yes, you can now request a Guru who has taken Math 16A recently",
                // content: "Yes, you can now request a Guru who has taken Math 16A recently, possibly the same professor & textbook",
            }],
            bottom_half: [{
                icon_src: "splash/organize.html",
                header: "100% LTE Coverage", // add 100
                content: "Got a quick question? Need an entire course crammed the night before?"
                // content: "Got a quick question? Need an entire course crammed the night before? Need a guru for your study group of 4?"
            }, {
                icon_src: "splash/career.html",
                header: "Meet the Future You.", //FUTURE: Have the dynamic text here
                content: "On the Pre-Med track? Meet with alumni already @ your dream school.",
                // content: "On the Pre-Med track? Meet with alumni already @ your dream school. Dream job Google? Match with a peer already there.",
            }, {
                icon_src: "splash/earn.html",
                header: "Become a College Guru",
                content: "Earn great sidecash anytime, anywhere. Build cred and earn."
                // content: "Earn great sidecash anytime, anywhere. Build cred and earn up to $40/hr. Earn, learn, & burn those loans early."
            }, ]
        };

    }
    var homeHowItWorks = generateUniversitySpecificHowItWorks();
    var homeBecomeAGuru = generateUniversitySpecificBecomeGuruText();
    var homeFooter = {
        header: "Congrats! You're the first to make it all the way down here.",
        subheader: "Don't worry. We've summarized your next steps below to make your life easier.", //add emoji wink
        button_left: "Become a Guru",
        button_right: "Launch College Student Portal"
    }
    var homeNavbar;
    var homeSidebar;
    var homePage = {
        how_it_works: homeHowItWorks,
        become_a_guru: homeBecomeAGuru, //final 'draft' --> requires approval
        navbar: homeNavbar,
        sidebar:homeSidebar,
        footer: homeFooter,
        sections: {
            main: {
                header_constant: [],
                header_dynamic: []
            },
            browse: {
                profiles: generateMiniSampleProfileDict(),
                categories: Category.categories
            }
        }
    }



    return {
        pricing: pricing,
        faq: faq,
        timeline: timeline,
        generateUniversitySpecificHowItWorks: generateUniversitySpecificHowItWorks,
        generateUniversitySpecificBecomeGuruText: generateUniversitySpecificBecomeGuruText,
        honorPledge: honorPledge,
        parents: parents,
        sophisticated_modal: sophisticated_modal,
        affordability_modal: affordability_modal,
        sampleProfiles: sampleProfiles,
        generateMiniSampleProfileDict: generateMiniSampleProfileDict,
        splashCategoryOptions: splashCategoryOptions
    }

}
angular.module('uguru.shared.services')
.factory("KeyboardService", [
    'UtilitiesService',
    '$timeout',
    KeyboardService
    ]);

function KeyboardService(Utilities, $timeout) {

    var deviceKeyboardExists = false;
    var deviceKeyboardOpen = false;
    var keyupNotRecent;
    var keydownNotRecent;
    var keyCache = {recent: [], active: {}};
    var active = true;
    var MAX_KEY_CACHE_LENGTH = 10;
    // function preventDefaultCutPaste() {
    //     document.body.oncopy = function() { alert('yo');return false; }
    //     document.body.oncut = function() { return false; }
    //     document.body.onpaste = function() { return false; }
    // }

    function insertKeyEventToCache(e) {
        var letter = keyMappings.toChar[e.which];
        if (keyCache.recent.length < 10) {
            console.log(keyCache.recent.unshift(letter));
            console.log('current cache', keyCache.recent)
        } else {
            var popped = keyCache.recent.pop();
            console.log(popped);
            keyCache.recent.unshift(letter);
            console.log('new cache', keyCache.recent)
        }
    }

    function initCopyPasteFunctionCallbacks(copy_func, paste_func) {
        (copy_func && copy_func()) || defaultCopyFunction();
        (paste_func && past_func()) || defaultPasteFunc();


        function defaultPasteFunc() {
            return;
        }
    }

    function initKeyboardKeydownFunc(cb, parent_elem) {
        parent_elem = parent_elem || document;
        parent_elem.addEventListener('keydown', function(e) {
            cb && cb(e);
        })
    }


    function initOptionPressedAndReleasedFunction(on_press, on_release, code, key, immediate, delay) {
        // if (on_press) {
            var delay = delay || 0;
            window.addEventListener("keydown", function(e){

                if (document.activeElement && document.activeElement.nodeName.toLowerCase() === 'input') {
                    return;
                }

                if (!immediate) {
                    delay = delay || 250;
                }
                evt = (e) ? e : window.event
                if (((key && evt[key])||true) && evt.keyCode === code && !keydownNotRecent) {
                    on_press && on_press(e);
                    keydownNotRecent = true;
                    $timeout(function() {
                        keydownNotRecent = null;
                    }, delay)
                }
                // if ((evt.ctrlKey && evt.keyCode === 17) && !keyupNotRecent) {
                //     on_press && on_press(e);
                //     keydownNotRecent = true;
                //     $timeout(function() {
                //         keydownNotRecent = null;
                //     }, 1000)
                // }
            })
        // }

        // if (on_release) {
            document.addEventListener('keyup', function (e){
                if (document.activeElement && document.activeElement.nodeName.toLowerCase() === 'input') {
                    return;
                }
                if (((key && evt[key])||true) && e.keyCode === code && !keyupNotRecent) {
                    var delay = 0;
                    if (!immediate) {
                        delay = delay || 250;
                    }
                    // console.log('command released', e);
                    on_release && on_release(e);
                    keyupNotRecent = true;
                    $timeout(function() {
                        keyupNotRecent = null;
                    }, delay);
                }
                // if ((evt.ctrlKey || evt.keyCode === 17) && !keyupNotRecent) {
                //     on_release && on_release(e);
                //     keyupNotRecent = true;
                //     $timeout(function() {
                //         keyupNotRecent = null;
                //     }, 1000);
                // }
            }, false);
        // }
    }

    function defaultCopyFunction() {
        var cmdPressed = false;
        var ctrlPressed = false;

            window.addEventListener("keydown", function(e){
                evt = (e) ? e : window.event
                if (evt.ctrlKey) {
                    cmdPressed = true;
                    // console.log('CMD pressed');
                }
            })
            window.addEventListener("keyup", function(e){
                evt = (e) ? e : window.event; // Some cross-browser compatibility.
                // control key
                if (evt.ctrlKey) {
                    // console.log('ctrl key pressed');
                }
                if((evt.metaKey || evt.keyCode == 224 || evt.keyCode == 93 || evt.which == 91 )&& (evt.which == 67))
                {

                    cmdPressed = false;
                    return false;
                    // Manual Copy / Paste / Cut code here.
                }
            })

        }

    function setDeviceKeyboardState(bool) {
        deviceKeyboardOpen = bool;
    }

    // function closeKeyboardIfExists() {
    //     DeviceService.doesCordovaExist() && cordova.plugins.Keyboard && cordova.plugins.Keyboard.close();
    // }
    var keyMappings = {
      toChar: {8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause/Break",20:"Caps Lock",27:"Esc",32:"Space",33:"Page Up",34:"Page Down",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"cmd",93:"Right Click",96:"Numpad 0",97:"Numpad 1",98:"Numpad 2",99:"Numpad 3",100:"Numpad 4",101:"Numpad 5",102:"Numpad 6",103:"Numpad 7",104:"Numpad 8",105:"Numpad 9",106:"Numpad *",107:"Numpad +",109:"Numpad -",110:"Numpad .",111:"Numpad /",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Num Lock",145:"Scroll Lock",182:"My Computer",183:"My Calculator",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},
      toKeyCode:{"Backspace":8,"Tab":9,"Enter":13,"Shift":16,"Ctrl":17,"Alt":18,"Pause/Break":19,"Caps Lock":20,"Esc":27,"Space":32,"Page Up":33,"Page Down":34,"End":35,"Home":36,"Left":37,"Up":38,"Right":39,"Down":40,"Insert":45,"Delete":46,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,"A":65,"B":66,"C":67,"D":68,"E":69,"F":70,"G":71,"H":72,"I":73,"J":74,"K":75,"L":76,"M":77,"N":78,"O":79,"P":80,"Q":81,"R":82,"S":83,"T":84,"U":85,"V":86,"W":87,"X":88,"Y":89,"Z":90,"cmd":91,"Right Click":93,"Numpad 0":96,"Numpad 1":97,"Numpad 2":98,"Numpad 3":99,"Numpad 4":100,"Numpad 5":101,"Numpad 6":102,"Numpad 7":103,"Numpad 8":104,"Numpad 9":105,"Numpad *":106,"Numpad +":107,"Numpad -":109,"Numpad .":110,"Numpad /":111,"F1":112,"F2":113,"F3":114,"F4":115,"F5":116,"F6":117,"F7":118,"F8":119,"F9":120,"F10":121,"F11":122,"F12":123,"Num Lock":144,"Scroll Lock":145,"My Computer":182,"My Calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222}
    }

    return {
        setDeviceKeyboardState:setDeviceKeyboardState,
        initOptionPressedAndReleasedFunction: initOptionPressedAndReleasedFunction,
        initCopyPasteFunctionCallbacks: initCopyPasteFunctionCallbacks,
        initKeyboardKeydownFunc: initKeyboardKeydownFunc,
        keyMaps: keyMappings,
        record: insertKeyEventToCache
    }
};


angular
.module('uguru.shared.services')
.factory("UtilitiesService", [
    '$rootScope',
    '$compile',
    '$timeout',
    UtilitiesService
    ]);

function UtilitiesService($rootScope, $compile, $timeout) {
    $timeout(function() {
        initSupport();
    })
    return {
        getNetworkSpeed: getNetworkSpeed,
        deg2rad: deg2rad,
        getDistanceInMiles: getDistanceInMiles,
        nickMatcher: nickMatcher,
        removeAllOccurrancesArr: removeAllOccurrancesArr,
        replaceAll: replaceAll,
        getFileName: getFileName,
        camelCase: camelCase,
        camelToDash: camelToDash,
        isElementInViewport: isElementInViewport,
        transitionEndEventName: transitionEndEventName,
        fireBeforeEnter: fireBeforeEnter,
        fireSchoolChange: fireSchoolChange,
        rAF: rAF,
        sortArrObjByKey: sortArrObjByKey,
        checkFreeSpace: checkFreeSpace,
        getFreeSpace: getFreeSpace,
        clearLoader: clearLoader,
        validateEmail: validateEmail,
        validatePhone: validatePhone,
        validateCode: validateCode,
        validateName: validateName,
        validatePassword: validatePassword,
        keyboardExistsAndVisible: keyboardExistsAndVisible,
        keyboardExists: keyboardExists,
        cordovaExists: cordovaExists,
        numberWithCommas: numberWithCommas,
        isAdminRequest: isAdminRequest,
        compileToAngular: compileToAngular,
        initSupport: initSupport,
        calcScrollOffset: calcScrollOffset,
        addClassToElemDelay: addClassToElemDelay,
        countAndSplitLines: countAndSplitLines,
        constructImportUrlFromObj: constructImportUrlFromObj,
        getArrayOfDecimals: getArrayOfDecimals
    }

    function getArrayOfDecimals(value) {
          var r = /[\d*\.?\d-*]+/g;
          var m;
          var resultArr = [];
          while ((m = r.exec(value)) != null) {
            resultArr.push(m[0]);
          }
          return resultArr
    }



    function constructImportUrlFromObj(str, type) {
        type = 'components'
        ending = str.indexOf('.tpl') > -1 && '.tpl' || '.html';
        str = str.replace('.tpl', '').replace('.html', '');
        str = str.split('.').join('/').trim();
        var resultUrl = 'shared/templates/' + type + '/' + str + ending;
        return resultUrl;
    }

    function countAndSplitLines(elem) {
        var style = window.getComputedStyle(elem, null);
          var height = parseInt(style.getPropertyValue("height"));
          var font_size = parseInt(style.getPropertyValue("font-size"));
          var line_height = parseInt(style.getPropertyValue("line-height"));
          var box_sizing = style.getPropertyValue("box-sizing");

          if(isNaN(line_height)) line_height = font_size * 1.2;

          if(box_sizing=='border-box')
          {
            var padding_top = parseInt(style.getPropertyValue("padding-top"));
            var padding_bottom = parseInt(style.getPropertyValue("padding-bottom"));
            var border_top = parseInt(style.getPropertyValue("border-top-width"));
            var border_bottom = parseInt(style.getPropertyValue("border-bottom-width"));
            height = height - padding_top - padding_bottom - border_top - border_bottom
          }
          var lines = height/(font_size);

          return lines;
    }

    function addClassToElemDelay(elem, _class, delay) {
        console.log(elem, _class, delay)
        $timeout(function() {

            _class && _class();
            // elem.classList.add(_class);
            // console.log(elem)
        }, parseInt(delay))
    }

    function camelCase(input) {
        return input.toLowerCase().replace(/-(.)/g, function(match, group1) {
            return group1.toUpperCase();
        });
    }

    function camelToDash(str) {
      return str.replace(/\W+/g, '-')
                .replace(/([a-z\d])([A-Z])/g, '$1-$2');
   }

    function initSupport() {
        //cross platform filter
        if (!Array.prototype.filter) {
          Array.prototype.filter = function(fun /*, thisp*/) {
            var len = this.length >>> 0;
            if (typeof fun != "function")
            throw new TypeError();

            var res = [];
            var thisp = arguments[1];
            for (var i = 0; i < len; i++) {
              if (i in this) {
                var val = this[i]; // in case fun mutates this
                if (fun.call(thisp, val, i, this))
                res.push(val);
              }
            }
            return res;
          };
        }
        //
        (function() {
            var lastTime = 0;
            var vendors = ['ms', 'moz', 'webkit', 'o'];
            for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
                window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
                window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame']
                                           || window[vendors[x]+'CancelRequestAnimationFrame'];
            }

            if (!window.requestAnimationFrame)
                window.requestAnimationFrame = function(callback, element) {
                    var currTime = new Date().getTime();
                    var timeToCall = Math.max(0, 16 - (currTime - lastTime));
                    var id = window.setTimeout(function() { callback(currTime + timeToCall); },
                      timeToCall);
                    lastTime = currTime + timeToCall;
                    return id;
                };

            if (!window.cancelAnimationFrame)
                window.cancelAnimationFrame = function(id) {
                    clearTimeout(id);
                };
        }());
    }


    function removeAllOccurrancesArr(str, remove_arr_str) {
      for (var i = 0; i < remove_arr_str.length; i++) {
        var indexRemoveStr = remove_arr_str[i];
        str = replaceAll(str, indexRemoveStr, '');
      }
      return str;
    }

    function replaceAll(str, find, replace) {
      return str.replace(new RegExp(escapeRegExp(find), 'g'), replace);

      function escapeRegExp(str) {
          return str.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1");
      }

    }

    function sortArrObjByKey(arr, key) {
        function compare(a,b) {
          if (a[key] < b[key])
            return -1;
          if (a[key] > b[key])
            return 1;
          return 0;
        }
        arr.sort(compare);
        return arr
    }

    function compileToAngular(elemID, scope) {
        var elem = document.getElementById(elemID);
        elem && $compile(elem)(scope);
    }

    function getNetworkSpeed() {
        var networkState = navigator.connection.type;

        var states = {};
        states[Connection.UNKNOWN]  = 'Unknown connection';
        states[Connection.ETHERNET] = 'Ethernet connection';
        states[Connection.WIFI]     = 'WiFi connection';
        states[Connection.CELL_2G]  = 'Cell 2G connection';
        states[Connection.CELL_3G]  = 'Cell 3G connection';
        states[Connection.CELL_4G]  = 'Cell 4G connection';
        states[Connection.CELL]     = 'Cell generic connection';
        states[Connection.NONE]     = 'No network connection';


        return networkState;
    }

    function deg2rad(deg) {
        return deg * (Math.PI/180);
    }

    function getDistanceInMiles(lat1,lon1,lat2,lon2) {
        var R = 6371; // Radius of the earth in km
        var dLat = deg2rad(lat2-lat1);  // deg2rad below
        var dLon = deg2rad(lon2-lon1);

        var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
        Math.sin(dLon/2) * Math.sin(dLon/2);

        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        var d = R * c; // Distance in km
        var miles = d * 0.621371; // Convert to miles
        return miles;
    }

    function readError(type, code) {
        if(type==='geolocation') {
            Settings.location = false;
            switch(code) {
                case 1: return 'user denied permission';
                    break;
                case 2: return 'user position is unavailable';
                    break;
                case 3: return 'GPS timed out'
                    break;
            }
        }
    }

    // Pass in an optional ID parameter for specific case handling
    function nickMatcher(input, list, property, id) {

        var matcher = new FastMatcher(list, {
            selector: property,
            caseInsensitive: true,
            preserveOrder: true,
            anyWord: true,
            limit: 1000
        });

        if(id === 'university') matcher.preserveOrder = true;

        return matcher.getMatches(input);
    }

    function QueryURLString() {
      // This function is anonymous, is executed immediately and
      // the return value is assigned to QueryString!
      var query_string = {};
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
            // If first entry with this name
        if (typeof query_string[pair[0]] === "undefined") {
          query_string[pair[0]] = decodeURIComponent(pair[1]);
            // If second entry with this name
        } else if (typeof query_string[pair[0]] === "string") {
          var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
          query_string[pair[0]] = arr;
            // If third or later entry with this name
        } else {
          query_string[pair[0]].push(decodeURIComponent(pair[1]));
        }
      }
        return query_string;
    }

    function isAdminRequest() {
        var urlParams = QueryURLString();
        if (urlParams.admin_token && urlParams.user_id) {
            return { admin_token: urlParams.admin_token, user_id: urlParams.user_id };
        };
    }

    function loginAsUser() {

    }


    function getFileName(URI) {
        var indexSlash = URI.lastIndexOf("/");
        var fileName = URI.substring(indexSlash + 1);

        return fileName;
    }

    function cordovaExists() {
        return (typeof cordova === 'undefined');
    }

    function keyboardExists() {
        return cordovaExists() && cordova.plugins && cordova.plugins.Keyboard;
    }

    function keyboardExistsAndVisible() {
        return keyboardExists && cordova.plugins.Keyboard.isVisible;
    }

    function isElementInViewport (el) {
        var rect = el[0].getBoundingClientRect();

        return (
            rect.top >= 0 &&
            rect.left >= 0 &&
            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
            rect.right <= (window.innerWidth || document.documentElement.clientWidth)
        );
    }

    function calcScrollOffset(el) {
        var result = {x: 0, y:0};
        var rect = el.getBoundingClientRect();
        var vpHeight = window.innerHeight || document.documentElement.clientHeight
        var vpWidth = window.innerHeight || document.documentElement.clientWidth;
        var Ypercent = Math.round(Math.abs(rect.top)/vpHeight * 100, 2);
        var Xpercent = Math.round(Math.abs(rect.right)/vpWidth * 100, 2);
        if (Ypercent) {
            result.y = Ypercent
        }
        if (Xpercent) {
            result.x = Xpercent;
        };
        return result
    }

    function transitionEndEventName() {
        var i,
            undefined,
            el = document.createElement('div'),
            transitions = {
                'transition':'transitionend',
                'OTransition':'otransitionend',  // oTransitionEnd in very old Opera
                'MozTransition':'transitionend',
                'WebkitTransition':'webkitTransitionEnd'
            };

        for (i in transitions) {
            if (transitions.hasOwnProperty(i) && el.style[i] !== undefined) {
                return transitions[i];
            }
        }
    }

    var BeforeEnterEvent = new CustomEvent("beforeEnter");

    function fireBeforeEnter() {
        return BeforeEnterEvent;
    }

    var SchoolChangeEvent = new CustomEvent('schoolChange');

    function fireSchoolChange() {
        return SchoolChangeEvent;
    }

    function rAF() {
      return
        window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        function(callback) {
          window.setTimeout(callback, 16);
        };
    }


    function checkFreeSpace(size) {
        var size_b = size
        if(size_b === undefined) size_b = 300,000,000;
        var free = getFreeSpace(size_b);
        return free;
    }

    function getFreeSpace(size_b) {

        var size_mb = size_b/1000/1000;
        cordova.exec(function(result) {
            var space_mb = result/1000;
                if(space_mb > size_mb) {
                return true;
            } else {
                uTracker.track('Low Disk Space', {
                    '$Free_Space': space_mb,
                    '$File_Size': size_mb
                });
                return false;
            }
        }, function(error) {
            uTracker.track('Callback Error', {
                '$Message': error
            });
            return false;
        }, "File", "getFreeDiskSpace", []);
    }


    function clearLoader() {
        $rootScope.loader.hide();
    }

    function validateEmail(email) {
        var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
        return re.test(email);
    }

    function validatePhone(phone) {
        var check = phone.match(/\d/g)
        return check!==null && check.length===10;
    }

    function validateCode(code) {
        // if(code!==null) {
        //  return code.length===4;
        // } else return false;
        return code != null && code.length===4
    }

    function validateName(name) {
        var re= /^[A-z ]+$/;
        return re.test(name);
    }

    function validatePassword(password) {
        if(password!==null) {
            return password.length>=6;
        } else return false;
    }

    function numberWithCommas(x) {
    var parts = x.toString().split(".");
    parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    return parts[0];

    // // for reference
    // $scope.fireKeyUpEvent = function() {
    //   var elem = document.getElementById('card-input');
    //   var e = document.createEvent("KeyboardEvent");
    //   e.initEvent("keyup", true, true);
    //   e.view = window;
    //   e.altKey = false;
    //   e.ctrlKey = false;
    //   e.shiftKey = false;
    //   e.metaKey = false;
    //   e.keyCode = 0;
    //   e.charCode = 'a';
    //   e.keyCode = 32;

    //   elem.dispatchEvent(e);
    // }
}

}





angular
.module('uguru.shared.services')
.factory("ScrollService", [
    '$timeout',
  ScrollService
    ]);

function ScrollService($timeout) {
    var scrollElems = {};
    var scroll = {main: {element: window, showStatus:false}, contained:{}};
    var rootScrollDiv = document.body;

    return {
        initScrollable: initScrollSubscriber,
        initScrollContainer: initScrollContainer,
        showStatus: showStatus,
        scroll: scroll,
        linkScrollStateToContainer: linkScrollStateToContainer
    }

    function linkScrollStateToContainer(name, element, stream, args_arr) {

        if (!(name in scroll.contained))  return;
        var result = {};
        for (var i = 0; i < args_arr.length; i++) {
            if (args_arr[i] === 'x') {
                result.scrollX = true;
            } else if (args_arr[i] === 'xy') {
                result.scrollY = true;
                result.scrollX = true;
            } else if (result.scrollY === 'y') {
                result.scrollY = true;
            }
        }
        result.element = element;
        result.props = {};

        stream.stream.events.forEach(function(ev) {

            var currentIndex = Math.ceil(parseFloat(ev.offset/ev.duration)*ev.values.length);
            var currentValue = ev.values[currentIndex];
            result.props[ev.name] = {pointer: 0, min:ev.values[0], max:ev.values[ev.values.length - 2], values: ev.values, current: ''};
        });
        result.lineHeight = toPX('ex', 0);
        var dupExists = false;
        if (scroll.contained[name].info.element) {
            if (scroll.contained[name].info.elements.length) {
                scroll.contained[name].info.elements.forEach(function(elem_result) {
                        if (elem_result.element[0] === result.element[0] && scroll.contained[name].elements.length) {
                            dupExists = true;
                        }
                })
            } else {
                scroll.contained[name].info.elements.push(result);
            }
        }
        // scroll.contained[name].info.elements.forEach(function(elem_result, i) {


        // })
        // if (!dupExists) {
        //     scroll.contained[name].elements.push(result);
        // }


        // element, stream, name.slice(1));
    }



    function showStatus(bool) {
        scroll.main.element.showStatus = bool;

    }


  function initScrollSubscriber(element, no_scroll_x, no_scroll_y) {
    // if (!scroll.main.listener) {
    //     scroll.main.listener = initScrollListener(scroll.main.element, callback, false);

    // }
    // scroll.contained.elements.push(initElementForScroll(element), no_scroll_x, no_scroll_y);
  }

  function initScrollContainer(element, attr) {
    if (!scroll.main.listener) {
        scroll.main.listener = initScrollListener();
    }
    var container = {elements:[], info:{}};
    if (attr.scrollable && attr.scrollable.length) {
        var scrollSplit = attr.scrollable.split('|');
        if (scrollSplit.length > 1) {
            container.name = scrollSplit[0];
            container.info.scrollY = false;
            container.info.scrollX = false;

            //x existence

            if (scrollSplit[1].indexOf('x') > -1) {
                container.info.scrollX = true;
            }

            //y existence
            if (scrollSplit[1].indexOf('y') > -1) {
                container.info.scrollY = true;
            }
        }

    }

    var containerName = container.name;
    // console.log(containerName)
    delete container['name'];
    scroll.contained[containerName] = {};
    scroll.contained[containerName].info = {
        element: element,
        elements: [],
        height: null,
        width: null,
        scrollY: container.info.scrollY,
        scrollX: container.info.scrollX
    };
    element.css('transition', 'transform 16ms linear')
    element.ready(function() {

        // var rect = element.parent().children()[0].getBoundingClientRect();
        // console.log(rect, element.parent().children(), element[0].scrollTop)
        // scroll.contained[containerName].info = {
        //     height: rect.height,
        //     width: rect.width,
        //     element: element[0]
        // }

    })
    return containerName



  }

  function initElementForScroll(elem, no_scroll_x, no_scroll_y) {
    var result = {lock: {x: no_scroll_x || false, y: no_scroll_y || false}};

    result.lineHeight = toPX('ex', elem[0]);
    return result
  }

  // function parseScrollLimitFromAttr(attr) {
  //   for (key in attr.$attr) {
  //       console.log(key)
  //   }
  // }

  function initScrollListener() {
    var lineheight = toPX('ex', scroll.main.element);
    console.log(lineheight)
        return scroll.main.element.addEventListener('wheel', function(ev) {




            var dx = ev.deltaX || 0;
            var dy = ev.deltaY || 0;
            var dz = ev.deltaZ || 0;
            var mode = ev.deltaMode;



            if(dx || dy || dz) {
                var coords = {x: dx, y:dy, z:dz};
                renderElementsWithinContainers(scroll.contained, ev,coords, lineheight);
            }

            // if (noScroll) {
            //     ev.preventDefault()
            // } else {
                // processScrollEvent(elem, scroll)
            // }
            // return elem;
        })
    }

    function getScrollParentContainer(s_target, destination) {
        var scrollTop = s_target.scrollTop;
        if (scrollTop > 0 || s_target === document.body) {
            return s_target
        }
        else {
            var scrollTop = getScrollParentContainer(s_target.parentNode);
            return scrollTop;
        }

        // if (s_target.outerHTML === destination.outerHTML) {

        //     return s_target.scrollTop;
        // } else {
        //     return getScrollParentContainer(s_target.parentNode, destination)
        // }
    }

    function renderElementsWithinContainers(contained, ev, coords, lh) {
        // ev.preventDefault()
        var _scroll = {}
        //compare (ev, and .ev.last)
        if (!_scroll.ev) {
            _scroll.ev = {};
        }

        _scroll.ev.last = ev;
        _scroll.mouse = {vp:{x:_scroll.ev.last.clientX, y:_scroll.ev.last.clientY}}

        for (scroll_container_name in contained) {
            _scroll.height = contained[scroll_container_name].info.scrollHeight;
            var yPos = contained[scroll_container_name].info.posY + coords.y/2;
            _scroll.container = scroll_container_name;
            var scrollPercent = yPos/_scroll.height;

            if (scrollPercent > 1 || scrollPercent < 0) {
                ev.preventDefault();
            } else {
                contained[scroll_container_name].info.posY += coords.y/2;
            }

            if (scrollPercent > 0 && scrollPercent < 1) {
                _scroll.top = {element: getScrollParentContainer(ev.target, contained[scroll_container_name].info.element)}

                _scroll.top.element = {scrollTop: _scroll.top.element.scrollTop, rect: _scroll.top.element.getBoundingClientRect(_scroll.top.element)};
                _scroll.top.element.top = _scroll.top.element.rect.top;
                _scroll.top.element.height = _scroll.top.element.rect.height;

                _scroll.top.percent = (_scroll.top.element.top + _scroll.top.element.scrollTop)/_scroll.height;
                // _scroll.top.container = _scroll.top.from/_scroll.height * 100;

                _scroll.abs = {percent: (_scroll.top.element.height + _scroll.top.element.scrollTop)/contained[scroll_container_name].info.scrollHeight};
                console.log('abs: %', _scroll.abs.percent*100, '\nmy mouse is X:'+_scroll.mouse.vp.x, 'Y:'+_scroll.mouse.vp.y )
            }


            var details = contained[scroll_container_name].info;
            var elements = scroll.contained[scroll_container_name].info.elements;

            if (coords.y && details.scrollY && elements.length) {

                // for (var i = 0; i < elements.length; i++) {


                    elements.forEach(function(elem) {

                        var element = elem.element;

                        var props = elem.props;

                        for (prop in props) {
                            // for (prop in props) {
                                var propInfo = props[prop];
                                var propValues = props[prop].values;
                                // console.log(propValues.length, scrollContainerTop, contained[scroll_container_name].info.scrollHeight)
                                // var nxtPointer = propInfo.pointer + Math.abs(coords.y)/coords.y;
                                // // console.log(propInfo.pointer, '=>', nxtPointer);
                                // if (nxtPointer < (propValues.length-1) && nxtPointer > -1) {
                                //     propInfo.pointer = nxtPointer;
                                //     var value = propValues[nxtPointer];
                                //     if (!elem.transitions) {
                                //         elem.transitions = [];
                                //     }
                                //     if (elem.transitions.indexOf(prop) === -1) {
                                //         elem.transitions.push(prop);
                                //         var transitionProps = elem.transitions.join(" ")
                                //         // console.log(transitionProps);
                                //         elem.css('transition', transitionProps + ' 16ms' + ' ease');
                                //     }
                                //     console.log(prop, value, element)
                                //     elem.element.css(prop, value);
                                // }


                            // }

                        }
                    })

                // }
            }
            if (coords.x && details.scrollX) {
                for (var i = 0; i < scroll.contained[scroll_container_name].elements.length; i++) {
                    if ('elements' in scroll.contained[scroll_container_name]) {
                        var elements = scroll.contained[scroll_container_name].elements;
                        elements.forEach(function(elem) {
                            var element = elem.element;
                            var props = elem.props;
                            // console.log(props)
                            for (prop in props) {
                                var propInfo = props[prop];
                                var propValues = props[prop].values;



                            }
                        })
                    }

                }
                // console.log(coords.x, ev.target, );
            }
        }
    }

    function calcRespectiveScale(ev, line_height, coords) {
        var scale = 1;
        switch(ev.deltaMode) {
            case 1:
                scale = lineHeight;
                break;
            case 2:
                scale = window.innerHeight;
                break;
        }
        coords.x *= scale;
        coords.y *= scale;
        // dz *= scale;
        // return dx, dy, dz;
    }


    function parseUnit(str, out) {
        if (!out)
        out = [ 0, '' ]

        str = String(str)
        var num = parseFloat(str, 10)
        out[0] = num
        out[1] = str.match(/[\d.\-\+]*\s*(.*)/)[1] || ''
        return out
    }


    var PIXELS_PER_INCH = 96

    function getPropertyInPX(element, prop) {
        var parts = parseUnit(getComputedStyle(element).getPropertyValue(prop))
        return parts[0] * toPX(parts[1], element)
    }

    //This brutal hack is needed
    function getSizeBrutal(unit, element) {
        var testDIV = document.createElement('div')
        testDIV.style['font-size'] = '128' + unit
        element.appendChild(testDIV)
        var size = getPropertyInPX(testDIV, 'font-size') / 128
        element.removeChild(testDIV)
        return size
    }

    function toPX(str, element) {
        element = element || document.body
        str = (str || 'px').trim().toLowerCase()
        if(element === window || element === document) {
           element = document.body
        }
        switch(str) {
            case '%':  //Ambiguous, not sure if we should use width or height
        return element.clientHeight / 100.0
            case 'ch':
            case 'ex':
        return getSizeBrutal(str, element)
            case 'em':
        return getPropertyInPX(element, 'font-size')
            case 'rem':
        return getPropertyInPX(document.body, 'font-size')
            case 'vw':
        return window.innerWidth/100
            case 'vh':
        return window.innerHeight/100
            case 'vmin':
        return Math.min(window.innerWidth, window.innerHeight) / 100
            case 'vmax':
        return Math.max(window.innerWidth, window.innerHeight) / 100
            case 'in':
        return PIXELS_PER_INCH
            case 'cm':
        return PIXELS_PER_INCH / 2.54
            case 'mm':
        return PIXELS_PER_INCH / 25.4
            case 'pt':
        return PIXELS_PER_INCH / 72
            case 'pc':
        return PIXELS_PER_INCH / 6
        }
        return 1
    }






    function callback(ev, elem, dx, dy, dz) {



        elem.css('transform', 'translateY(' + dy + 'px)');
        console.log(elem.parent(), dx, dy +'px', dz)
        // totalX -= dx
        // totalY -= dy
        // elem.style.left = totalX + 'px'
        // elem.style.top = totalY + 'px'
        // infoLog.innerHTML =
        // '<p>Scroll:' + dx + ',' + dy + ' - ' + totalX + ',' + totalY + '</p>'
    }
}

angular
.module('uguru.shared.services')
.factory("FileService", [
  'LoadingService',
  'Restangular',
  FileService
    ]);

function FileService(LoadingService, Restangular) {
    var DropzoneDict = {}
    var dropZoneUiEvents = ['drop', 'dragstart', 'dragend', 'dragenter', 'dragover', 'dragleave']; //event first param
    var dropZoneFileEvents = ["totaluploadprogress", "queuecomplete", "maxfilesreached", "complete", "success", "uploadprogress", "thumbnail"]
    return {
        initRequestDropzoneFromSelector: initRequestDropzoneFromSelector,
        initMessageDropzone: initMessageDropzone,
        DropzoneDict: DropzoneDict,
        initUserAdminTool: initUserAdminTool,
        getS3JsonFile: getS3JsonFile,
        postS3JsonFile: postS3JsonFile,
        getCodepenAssets: getCodepenAssets
    }

    function initUserAdminTool() {

        return {
            //gets all files
            get: getAllAdminFiles(),
            save: {
                file: saveAdminFile,
                folder: saveAdminFolder
            },
            create: {
                folder: createAdminFolder,
                file: createAdminFile
            },
            remove: {
                folder: removeAdminFolder,
                file: removeAdminFile
            }
        }
    }

    function getUserSettings(user_name) {
        //last_file_opened
        //last_10_files_edited
        //variations
        //--previous fork reference
    }




    function getAllAdminFiles() {
        return function(_scope) {
            Restangular.one('admin', '9c1185a5c5e9fc54612808977ee8f548b2258d34').one('files').get().then(
            function(response) {
                var files = response.plain().admin_files;
                _scope.files = {
                    users: {options: Object.keys(files), index:0},
                    all: files,
                    switchUser: function(user) {
                        return
                    }
                }
                var splash_files = [];
                var user_name = _scope.user.name.split(' ')[0].toLowerCase();
                if (user_name === "asif") {
                    user_name = 'samir';
                }

                for (var i = 0; i < files['master'].files.length; i++) {
                    var indexFile = files['master'].files[i];
                    if (indexFile.name && indexFile.name.indexOf('layouts/splash.json') > -1) {
                        splash_files.push(indexFile);
                    }
                }

                // _scope.current_file = splash_files[0];
                // console.log(_scope.current_file);
                console.log(splash_files)
                var xhr = new XMLHttpRequest();
                xhr.open( 'GET', splash_files[0].url, true );

                xhr.onload = function () {
                    var resp = window.JSON.parse( xhr.responseText );
                    console.log(indexFile.name, resp)
                    resp.full_template_url = splash_files[0].url;
                    console.log(resp.full_template_url);
                    // DevToolService.initCurrentFile(_scope, resp);
                    _scope.status.show = false;
                };
                xhr.send();
            })
        }

    }
    function removeAdminFolder () {return};
    function removeAdminFile () {return};
    function createAdminFile () {return};
    function createAdminFolder () {return};
    function saveAdminFile () {return};
    function saveAdminFolder () {return};

    function sceneState() {
        function autoInit() {
        }
        function goNext() {

        }
        function triggerScene() {

        }
    }

    function variationUtility () {
        function promote() {
        }
        function fork() {
        }
    }
    function updateUserSettings() {
        return {
        }
        //takes a recent edited component obj &&
        function updateRecentlyEditedComponents() {

        }
    }

    function initMessageDropzone(scope) {
        var dropzoneElem = new Dropzone('#message-dropzone', getDefaultRequestDropzone());
        dropzoneElem.on("addedfile", function(file) {
                return
            });

            dropzoneElem.on("success", function(file, server_response) {
                var messagePayload = {
                    message: {
                        relationship_id: scope.active_relationship.id,
                        session_id: scope.active_relationship.sessions[scope.active_relationship.sessions.length - 1].id,
                        sender_id: scope.user.id,
                        file_id: server_response.id
                    }
                }
                if (scope.active_relationship.guru.id !== scope.user.id) {
                    messagePayload.receiver_id = scope.active_relationship.guru.id;
                } else {
                    messagePayload.receiver_id = scope.active_relationship.student.id;
                }
                scope.user.createObj(scope.user, 'messages', messagePayload, scope);
            })


            dropzoneElem.on("sending", function(file, xhr, data) {
                if (scope.user && scope.user.id) {
                    data.append("user_id", scope.user.id);
                }
                data.append("filename", file.name);
                data.append("filesize", file.size);
                data.append("filetype", file.type);
            });
            dropzoneElem.on("error", function(file, errorMessage, xml_error) {
                var fileExtension;
                fileNameSplit = file.name.split('.')
                if (fileNameSplit.length === 1) {
                    LoadingService.showMsg('Sorry, we no longer can accept unknown file types, please add an extension to the file or submit another one.', 5000)
                    return;
                } else {
                    fileExtension = fileNameSplit.slice(-1)[0];
                    LoadingService.showMsg('Sorry, we no longer can accept bare .' + fileExtension + ' file types, please either compress & resubmit or submit another file type.', 5000)
                }
            })

            dropzoneElem.on("uploadprogress", function(file, progress, bytesSent) {
                return
            })
        return dropzoneElem;
        // Dropzone.options.messageDropzone = {
        //   paramName: "file", // The name that will be used to transfer the file
        //   maxFilesize: 2, // MB
        //   accept: function(file, done) {
        //     if (file.name == "justinbieber.jpg") {
        //       done("Naha, you don't.");
        //     }
        //     else { done(); }
        //   },
        //   init: function() {
        //     this.on("addedfile", function(file) {
        //     });
        //   }
        // };
    }

    function initRequestDropzoneFromSelector(elem_selector, scope) {
        if (elem_selector && !DropzoneDict[elem_selector]) {
            var dz_elem = getDefaultRequestDropzone();
            if (!dz_elem) {
                return;
            }
            var dropzoneElem = new Dropzone(elem_selector, dz_elem);
            //stor in global
            DropzoneDict[elem_selector] = dropzoneElem;

            //init event listeners
            //full docs are here http://www.dropzonejs.com/#event-list
            dropzoneElem.on("addedfile", function(file) {
                return
            });
            dropzoneElem.on("removedfile", function(file) {
                if (scope.requestForm && scope.requestForm.files && scope.requestForm.files.length) {
                    for (var i = 0; i < scope.requestForm.files.length; i++) {
                        var indexRequestFile = scope.requestForm.files[i];
                        if (indexRequestFile.name === file.name) {
                            var removedFile = scope.requestForm.files.splice(i, 1);
                            scope.$apply();
                        }
                    }
                }
            });
            dropzoneElem.on("success", function(file, server_response) {
                if (scope.requestForm && scope.requestForm.files) {
                    scope.requestForm.files.push(server_response);
                    scope.root.vars.getUserFromServer(scope);
                }
            })


            dropzoneElem.on("sending", function(file, xhr, data) {
                if (scope.user && scope.user.id) {
                    data.append("user_id", scope.user.id);
                }
                data.append("filename", file.name);
                data.append("filesize", file.size);
                data.append("filetype", file.type);
            });
            dropzoneElem.on("error", function(file, errorMessage, xml_error) {
                var fileExtension;
                fileNameSplit = file.name.split('.')
                if (fileNameSplit.length === 1) {
                    LoadingService.showMsg('Sorry, we no longer can accept unknown file types, please add an extension to the file or submit another one.', 5000)
                    return;
                } else {
                    fileExtension = fileNameSplit.slice(-1)[0];
                    LoadingService.showMsg('Sorry, we no longer can accept bare .' + fileExtension + ' file types, please either compress & resubmit or submit another file type.', 5000)
                }
            })

            dropzoneElem.on("uploadprogress", function(file, progress, bytesSent) {
                return
            })
        }
    }


    function getCodepenAssets(type, url, cb) {
        var xhr = new XMLHttpRequest();
        // xhr.withCredentials = true;
        xhr.onload = function () {
            var resp = xhr.responseText;
            cb && cb(resp);
        }
        var protocol = window.location.protocol;
        var crossOriginUrl = 'http://crossorigin.me/';
        if (protocol.indexOf('https') > -1) {
            crossOriginUrl = 'https://crossorigin.me/';
        }
        xhr.open( 'GET',crossOriginUrl +  url, true );;
        xhr.send();
    }
    function getS3JsonFile(first_name, url, cb) {
        var xhr = new XMLHttpRequest();
        xhr.open( 'GET', url, true );

        xhr.onload = function () {
            var resp = window.JSON.parse( xhr.responseText );
            cb && cb(first_name, resp);
        };
        xhr.send();
    }

    function postS3JsonFile(data, first_name, url, cb) {
        var xhr = new XMLHttpRequest();
        xhr.open( 'PUT', url, true );
        xhr.setRequestHeader("Content-type", "application/json");
        xhr.onload = function () {
            var resp =  xhr.responseText;
            cb && cb(first_name, resp);
        };
        xhr.send(data);
    }

    function getDefaultRequestDropzone(elem) {
        console.log(elem);
        if (!elem) {
            return;

        }
        return {
                    previewTemplate: elem.innerHTML,
                    url: REST_URL + '/api/v1/files',
                    method: "POST",
                    paramName: "file",
                    maxFilesize: 10,
                    addRemoveLinks: true,
                    uploadMultiple: false,
                    acceptedFiles: "image/*, application/pdf, audio/*, text/*, video/*, application/zip, audio/*, application/powerpoint, application/msword, application/rtf",
                    clickable: true,
                    createImageThumbnails: true,

                }
    }

}
angular
	.module('uguru.shared.services')
	.factory('CTAService', [
    '$timeout',
    CTAService
	]);

function CTAService($timeout) {
  var ctaParentDict = {};
  var ctaFuncDict = {};
  var ctaOptions = {duration: 0.2, extraTransitionDuration:0};
  var ctaCloseFuncDict = {};
  var ctaKeyCodeMappings = {'esc': 27};

  var showModalCTA = function(elem) {
    elem.classList.add('show');
  }

  var hideModalCTA = function(elem) {
    elem.classList.remove('show');
  }

  var showCTAManually = function(elem_id, cb) {
    var func = ctaFuncDict[elem_id];
    func && func();
    cb && cb();
  }

  var closeCTAManually = function(elem_id, cb) {
    var func = ctaCloseFuncDict[elem_id];

    func && func();
    cb && cb();
  }

  var getModalCloseIcon = function(elem) {
    return elem.querySelector('.cta-modal-close');
  }

  var bindCtaToBoxElem = function(box_elem, modal_elem, show_callback, box_selector, key_triggers) {
    key_triggers = key_triggers || [];
    ctaFuncDict[box_selector] = function() {
      // ctaCloseFuncDict[box_selector]  = cta(box_elem, modal_elem, ctaOptions, function() {

      //   //show modal cta
      //   showModalCTA(modal_elem);
      //   // $timeout(function() { showModalCTA(modal_elem) });

      //   $timeout(function() {
      //     show_callback && show_callback(modal_elem);
      //   })
      //   var modalCloseIcon = getModalCloseIcon(modal_elem);
      //   if (modalCloseIcon) {
      //     modalCloseIcon.addEventListener('click', function() {

      //       ctaCloseFuncDict[box_selector]();
      //       hideModalCTA(modal_elem);
      //     });
      //   }

      //   window.addEventListener('keydown', function(evt) {
      //     evt = evt || window.event;
      //     for (var i = 0; i < key_triggers.length; i++) {
      //       var indexKey = key_triggers[i];
      //       if (indexKey in ctaKeyCodeMappings && ctaKeyCodeMappings[indexKey] === evt.keyCode) {
      //           ctaCloseFuncDict[box_selector]();
      //           hideModalCTA(modal_elem);
      //       }
      //     }
      //   });

      // }, ctaParentDict[box_selector])

    }

    box_elem.addEventListener('click', ctaFuncDict[box_selector]);
  }

  var initSingleCTA = function(boxSelector, parentSelector, show_callback, eventTriggers) {
    var parentElem = document.querySelector(parentSelector);
    var boxElem = document.querySelector(boxSelector);

    var modalElemId = boxElem && boxSelector.replace('.', '#').replace('box', 'modal');
    var modalElem = document.querySelector(modalElemId);

    // Debug use
    // if(modalElemId =='#cta-modal-request-courses'){
    //     console.log('parentElem',parentElem)
    //     console.log('boxElem',boxElem)
    //     console.log('modalElemId',modalElemId)
    //     console.log('modalElem',modalElem)

    // }

    //if both dont exist dont do anything
    if (!(parentElem && boxElem && modalElem)) {
      return false;
    }
    ctaParentDict[boxSelector] = parentSelector;
    bindCtaToBoxElem(boxElem, modalElem, show_callback, boxSelector, eventTriggers);


  }

  var initArrCTASharedParent = function(parentRef, elem_arr, cb_dict) {
    if (!cb_dict) {
      cb_dict = {};
    }
    if (!elem_arr || !elem_arr.length || !parentRef) return;
    for (var i = 0; i < elem_arr.length; i++) {
      var elemRef = elem_arr[i];
      initSingleCTA(elemRef, parentRef, cb_dict[elemRef])
    }
  }

  return {
    initSingleCTA:initSingleCTA,
    initArrCTASharedParent:initArrCTASharedParent,
    showCTAManually:showCTAManually,
    closeCTAManually: closeCTAManually
  }

}
angular.module('uguru.shared.services')
.factory("XHRService", [
    '$timeout',
    XHRService
        ]);

function XHRService($timeout) {
  var XHRQueue = [];
  var XHR_THRESHOLD = 5;

  return {
    getJSONFile: getJSONFile,
    getFileWithProgress: getFileWithProgress,
    updateJSONFile: updateJSONFile
  }

  function getFileWithProgress(url, progress, params, callback) {
    var xhr = new XMLHttpRequest();

    XHRQueue.push({xhrObj: xhr, type: 'GET', url:url, func: callback, params: params});
    if (XHRQueue.length < XHR_THRESHOLD) {

      var frontQueue = XHRQueue.splice(0, 1)[0];

      frontQueue.xhrObj.open(frontQueue.type, frontQueue.url, true);
      frontQueue.xhrObj.responseType = 'arraybuffer';
      xhr.onprogress = function(oEvent) {

          // var responseDict = JSON.parse(frontQueue.xhrObj.responseText);

          progress && progress(oEvent);
      }

      xhr.onload = function (e) {
          var arr = new Uint8Array(this.response);


          // Convert the int array to a binary string
          // We have to use apply() as we are converting an *array*
          // and String.fromCharCode() takes one or more single values, not
          // an array.
          var raw = '';
          var i,j,subArray,chunk = 5000;
          for (i=0,j=arr.length; i<j; i+=chunk) {

             subArray = arr.subarray(i,i+chunk);
             raw += String.fromCharCode.apply(null, subArray);
          }

          // This works!!!
          var b64=btoa(raw);
          var dataURL="data:image/jpeg;base64,"+b64;
          // $timeout(function() {
            callback(dataURL);
          // }, 1000)

      };

      xhr.send();

    } else {
      if (XHRQueue.length && XHRQueue.length >= XHR_THRESHOLD) {
        $timeout(function() {
          getJSONFile(request_type, url, callback, params)
        }, 1000);
      }
    }

  }


  function updateJSONFile(test_url, data, post_success_callback) {
      function callback(resp ) {
        if (resp.status === 200 && resp.readyState === 4 && resp.statusText === "OK") {
          getJSONFile('GET', test_url, post_success_callback)
        }
      }
      getJSONFile('PUT', test_url, callback, JSON.stringify(data), true)
  }
  function getJSONFile(request_type, url, callback, params, skip_parse) {
    skip_parse = skip_parse || false;

    var xhr = new XMLHttpRequest();
    XHRQueue.push({xhrObj: xhr, type: request_type, url:url, func: callback, params: params});
    var frontQueue = XHRQueue.splice(0, 1)[0];
    if (XHRQueue.length < XHR_THRESHOLD + 1) {

      frontQueue.xhrObj.open(frontQueue.type, frontQueue.url, true);
      xhr.onload = function () {

          if (!skip_parse) {
            var responseDict = JSON.parse(frontQueue.xhrObj.responseText);
            callback && callback(responseDict);
          } else {
            callback && callback(frontQueue.xhrObj);
          }
      };
      ['POST', 'PUT'].indexOf(request_type) > -1 && xhr.setRequestHeader("Content-type", "application/json");
      // console.log('sending', frontQueue.type, frontQueue.url, request_type)
      xhr.send(params);

    } else {
      if (XHRQueue.length && XHRQueue.length >= XHR_THRESHOLD) {
        $timeout(function() {
          getJSONFile(request_type, url, callback, params)
        }, 1000);
      }
    }
  }


}

angular.module('uguru.shared.services')
.factory("SendService", [
    '$timeout',
    '$parse',
    'RootService',
    'TweenService',
    SendService
        ]);

function SendService($timeout, $parse, RootService, TweenService) {
  var sendTree = {};
  var sendScopeShortcuts = getSendScopeShortcuts();
  return {
    sendMsgToSelf: sendMsgToSelf,
    prepareToSendMessage: prepareToSendMessage,
    parseDepth: parseDepth,
    applySendArgs: execSendArgs,
    precompileSendActionArgs: precompileSend,
    sendTree: sendTree
  }
  function parseMessageAndStoreToExecuteLater(scope, state, expected_depth, element, attr) {
    var stateName = state.nameCamel;
    // console.log('incoming message', stateName, state.actions, '\npublic scope:',scope.public.customStates.when)

    //copy over all from parent that are greater than 0 and subtract them by negative one
    var futureExecDict = {
      actions: state.actions,
      func: getExecFunction(state, {depth: -1}, element, attr),
      name: state.name,
      camel:state.nameCamel
    }

    if (expected_depth - Math.floor(expected_depth) === 0.5) {
      futureExecDict.elem = element[0];
    }

    if (stateName in scope.public.customStates.when && scope.public.customStates.when[stateName].elements) {
      futureExecDict.depth = expected_depth || scope.public.customStates.when[stateName].depth;
      scope.public.customStates.when[stateName].elements.push(futureExecDict)
    }

    else if (scope.root && state.nameCamel in scope.root.scope.public.customStates.when) {

      scope.root.scope.public.customStates.when[state.nameCamel].elements.push(futureExecDict)
    } else if (scope.root) {
      scope.root.scope.public.customStates.when[state.nameCamel] = {elements: [], depth: -1}
      scope.root.scope.public.customStates.when[state.nameCamel].elements.push(futureExecDict);
    }



    // {actions: state.actions, func: whenCallback(currentDepth), name:state.name};
    // console.log(state, scope.outgoing_parsed.join(" "))
  }

  function getSendScopeShortcuts() {
    return {
      'siblings': 'depth(-0)',
      'self': 'depth(-)',
      'public': 'depth(*)',
      'c': 'depth(1)',
      'grandchildren': 'depth(2)',
      'gp': 'depth(-2)',
      'p': 'depth(-1)',
      'grandparent': 'depth(-2)',
      'children': 'depth(1)',
      'gc': 'depth(2)',
      'ggc': 'depth(3)',
      'gggc': 'depth(4)',
      'ggggc': 'depth(4)',
      '5g': 'depth(5)',
    }
  }

  function getExecFunction(state, msg_options, element, attr) {


      return function(actions, scope, delay, depth) {

        actions = actions || state.actions;

        var options = msg_options
        var current_depth = msg_options.depth
        if (delay) {
          $timeout(function() {
            state.exec(element, scope, attr, actions);
          }, delay)
          // return;
        } else {
          state.exec(element, scope, attr, actions);
        }

      }
    }

  function parseStateMsgContents(state) {
    var msgResultArr = [];
    var msgArr = state.parsed.split(',');
    msgArr.forEach(function(msg, i) {

      msgObj = {raw: msg.trim()}
      msgSplit = msgObj.raw.split(':');
      msgObj.name = msgSplit[0];
      msgObj.nameCamel = RootService.camelCase(msgObj.name)
      msgObj.type = getMsgType(msgSplit[0]);
      msgObj.delay = calcTotalDelay(state, msgObj.name);
      msgObj.greaterThan = msgSplit[1].indexOf('>') > -1 && true;
      msgObj.lessThan = msgSplit[1].indexOf('<') > -1 && true;
      msgObj.sendScope = getSendScope(msgSplit[1].replace('>', '').replace('<', ''));
      msgResultArr.push(msgObj)
    })
    // console.log(state.nameCamel, state.actions)
    // msgObj.delayTotal = state
    // console.log(state)

    return msgResultArr;

    function calcTotalDelay(send_obj, msg) {
      if (!send_obj.delays.internal) send_obj.delays.internal = {};
      return send_obj.delays.external + (msg in send_obj.delays.internal && send_obj.delays.internal[msg] ||0)
    }

    function getSendScope(msg_scope) {

      if (msg_scope in sendScopeShortcuts) return sendScopeShortcuts[msg_scope]
      return msg_scope;
    }

    function getMsgType(msg_arg) {
      msg_arg = msg_arg.split('-')[0]
      if (['init', 'on', 'as'].indexOf(msg_arg.trim().toLowerCase()) > -1) {
        return msg_arg.trim()
      }
      return 'when'
    }

  }

  function parseMsgString() {

  }

  function registerFutureMessageToScope(msg_obj, scope, depth) {

    if (msg_obj.sendScope === 'depth(*)') {
      depth = -1;
    }
    else if (msg_obj.sendScope === 'depth(-0)' || msg_obj.sendScope === 'depth(0)') {
      depth = 0.5;
    }
     else {
      depth = 0;
    }


    if (depth === 0.5) {
      if (!(msg_obj.nameCamel in scope.$parent.public.customStates.when)) {
        scope.public.customStates.when[msg_obj.nameCamel] = {elements:[], depth: depth, siblings:true}
        scope.$parent.public.customStates.when[msg_obj.nameCamel] = scope.public.customStates.when[msg_obj.nameCamel]
      } else {
        scope.$parent.public.customStates.when[msg_obj.nameCamel].siblings = true;
      }
      // console.log(scope.public.customStates.when)

    }
    else if ('root' in scope && (msg_obj.nameCamel) in scope.root.scope.public.customStates.when) {


      if (!scope.root.scope.public.customStates.when[msg_obj.nameCamel].options) {
        scope.root.scope.public.customStates.when[msg_obj.nameCamel].options = msg_obj;
      }

      return;
    } else if (!(msg_obj.nameCamel in scope.public.customStates.when)) {
      if (depth === -1) {
        scope.root.scope.public.customStates.when[msg_obj.nameCamel] = {elements:[], depth: depth}
      }
      else {
        scope.public.customStates.when[msg_obj.nameCamel] = {elements:[], depth: depth}
        if (scope.$parent && scope.$parent.public) {
            scope.$parent.public.customStates.when[msg_obj.nameCamel] = scope.public.customStates.when[msg_obj.nameCamel]
        } else {
            $timeout(function() {
              if (scope.$parent) {
                scope.$parent.public.customStates.when[msg_obj.nameCamel] = scope.public.customStates.when[msg_obj.nameCamel]
              }
            })
        }
      }
      // console.log('registered', msg_obj.nameCamel, depth);
    }

  }

  function registerFutureMessageUpwards(msg_obj, scope, elem, attr, int_depth) {
    // console.log('registering upwards', int_depth)
    var depthScope = scope;

    for (var i = parseInt(int_depth); i < 0; i++) {
      depthScope = depthScope.$parent;
    }
    var msgName = msg_obj.type;

    if (msg_obj.type in depthScope.states) {
      var typeStates = depthScope.states[msg_obj.type];
      if (typeStates.length) {
        typeStates.forEach(function(state) {
          if (state.nameCamel === msg_obj.nameCamel) {
            parseMessageAndStoreToExecuteLater(depthScope, state, int_depth, depthScope.elem, attr)
            $timeout(function() {
              depthScope.$apply();
            })
          }
          return;
        })
      }
    }
  }

  function registerFutureMessageToSelf(msg_obj, scope, elem, attr) {
    var msgName = msg_obj.type;
    if (msg_obj.type in scope.states) {
      var typeStates = scope.states[msg_obj.type];
      if (typeStates.length) {
        typeStates.forEach(function(state) {
          if (state.nameCamel === msg_obj.nameCamel) {
            parseMessageAndStoreToExecuteLater(scope, state, null, elem, attr)
          }
          return;
        })
      }
    }
    // if (!(msg_obj.camelName in scope.public.customStates.when)) {
    //   scope.public.customStates.when[msg_obj.camelName] = {elements: [], depth: 0};
    // } else {
    //   scope.public.customStates.when[msg_obj.camelName].elements.push({})
    // }
  }

  function registerOutgoingMessageToScope(msg_obj, scope, elem, attr) {
    //outgoing step #2

      var depth = parseDepthString(msg_obj.sendScope.replace('d(', 'depth(')) + '';

      if (['public', 'self', 'siblings'].indexOf(depth) === -1) {
        var intDepth = parseInt(depth);
        if (typeof intDepth === 'number' && intDepth > 0) {
          depth = 'positive';
        } else if (typeof intDepth ==='number' && intDepth < 0) {
          depth = 'negative'
        }
      }



        switch (depth) {
          case('negative'):
            // console.log('case upwards');
            registerFutureMessageUpwards(msg_obj, scope, elem, attr, intDepth)

            break;
          case('siblings'):

            registerFutureMessageToScope(msg_obj, scope)
            break;
          case('self'):

            registerFutureMessageToSelf(msg_obj, scope, elem, attr)
            // registerFutureMessageToScope(msg_obj, scope, 'self')
            break;
          case('public'):

            registerFutureMessageToScope(msg_obj, scope)
            break;
          case('positive'):

            registerFutureMessageToScope(msg_obj, scope, intDepth)
            // registerFutureMessageToScope(msg_obj, scope.public.customStates.when, intDepth)
            break
        }



      function isPublicDepth(depth) {
        return depth === 'public'
      }

  }

  function parseDepthString(depth_str) {


    var specialDepthMappings = {'-':'self', '*':'public', '0': 'siblings', '-0':'siblings', 'parent': -1, 'p': -1, 'grandparent': -2, 'gp': -2}


    if (depth_str in specialDepthMappings) {
      return specialDepthMappings[depth_str]
    } else if (depth_str.indexOf('depth' > -1)) {
      depth_str = depth_str.replace('depth(', '').replace(')', '');
      if (depth_str in specialDepthMappings) {
        return specialDepthMappings[depth_str]
      }
    } else {
      depth_str = '0'
    }
    depthResult = parseInt(depth_str);

    return depth_str
  }

  function precompileSend(states_dict, scope, element, elem_attr) {

      scope.public = {customStates: {when: {}}};
    // }
    if (scope.$parent && scope.$parent.public && scope.$parent.public.customStates.when ) {


      scope.parentInherited = true;
      var keys = Object.keys(scope.$parent.public.customStates.when);
      for (key in scope.$parent.public.customStates.when) {
        if (scope.$parent.public.customStates.when[key].depth >= 0) {
          scope.public.customStates.when[key] = {elements: scope.$parent.public.customStates.when[key].elements};
          scope.public.customStates.when[key].depth = scope.$parent.public.customStates.when[key].depth + 1
        }

      }
    }

    var msgStates = parseStatesForSending(states_dict, scope);
    scope.outgoing_parsed = [];
    //outgoing step #1

    // element.ready(function() {
    msgStates.outgoing.forEach(function(o_state) {
      o_state.parsedMsgArr = parseStateMsgContents(o_state.actions.send);
      o_state.parsedMsgArr.forEach(function(msg_obj, i) {
        scope.outgoing_parsed.push(msg_obj.nameCamel)
        // console.log('registering message contents', msg_obj.nameCamel, 'from', o_state.nameCamel)
        registerOutgoingMessageToScope(msg_obj, scope, element, elem_attr);

      });
    })
  // })


        msgStates.incoming.forEach(function(i_state) {
          if (i_state.name.split('-')[0] === 'var') return;
        // console.log(i_state)
        if (i_state.actions.send && !i_state.parsedObj) {
          i_state.parsedObj = parseStateMsgContents(i_state.actions.send)
        }
        var expectedDepth;
        if (i_state.parsedObj) {
          expectedDepth = parseDepthString(i_state.parsedObj[0].sendScope);
        }
        if (scope.$parent && scope.$parent.public && i_state.nameCamel in scope.$parent.public.customStates.when && scope.$parent.public.customStates.when[i_state.nameCamel].siblings) {
          parseMessageAndStoreToExecuteLater(scope, i_state, scope.$parent.public.customStates.when[i_state.nameCamel].depth - 0.5, element, elem_attr)
        }
        parseMessageAndStoreToExecuteLater(scope, i_state, expectedDepth, element, elem_attr)


      })

    return

  }

  function parseStatesForSending(states, scope) {
    var resultDict = {outgoing:[], incoming: []};
    for (state_type in states) {
      states[state_type].forEach(function(state) {
        if (typeof state.name === 'object') {
          state.name = [state.type, state.name].join('-');
          state.nameCamel = RootService.camelCase(state.name)
        }

        if (state_type === 'when') {
          resultDict.incoming.push(state);
        }
        if (state.actions && state.actions.send) {

          if (state.actions.send.parsed.indexOf('}}') > -1) {
            repairSendStateName(scope, state, state.actions.send.parsed)
          }
          resultDict.outgoing.push(state);

        }
      })
      // parseOutgoing();
    }


    function repairSendStateName(scope, state, name) {
      state.actions.send.parsed = $parse('"' + name.replace('{{', '"+').replace('}}', '+"') + '"')(scope)
      state.actions.send.raw = $parse('"' + name.replace('{{', '"+').replace('}}', '+"') + '"')(scope);
      if (state.actions.send.delays.internal) {
        for (key in state.actions.send.delays.internal) {
          if (key.indexOf('{{') > -1) {
            var value = state.actions.send.delays.internal[key];
            var tempKey = key + '';
            key = '"' + key.replace('{{', '"+').replace('}}', '+"') + '"'
            var newKeyName = $parse(key)(scope);
            state.actions.send.delays.internal[newKeyName] = value;
            delete state.actions.send.delays.internal[tempKey];

          }
        }
      }
    }
    return resultDict;
  }

  function execSingleMsgArg(element, scope, element_arr, options, depth) {

    var depthMappings = {'depth(*)': -1}
    var total_delay = options.delay || 0
    var stagger_delay = 0;
    var final_depth = options.sendScope in depthMappings && depthMappings[options.sendScope] || 0;

    element_arr.forEach(function(state_ref, i) {
      if (options.stagger && options.stagger.delays.length) {
        stagger_delay = options.stagger.delays[i]
      }
      state_ref.func(state_ref.actions, element.scope(), total_delay + stagger_delay, final_depth);
    })

  }

  function processStaggerDelayedMessages(stagger_info, item_count) {
    // console.log('processing', stagger_info, item_count)
    var tempDuration = item_count * (1000/60.0);
    var duration = stagger_info.duration

    var values = TweenService.preComputeValues("send", tempDuration, {send: 0}, {send:1}, stagger_info.ease, stagger_info.delays, 60).cache;

    stagger_info.delays = values.slice(0, values.length - 2);
    stagger_info.delays.forEach(function(delay_val, i) {
      stagger_info.delays[i] = stagger_info.delays[i] * duration;
    })
    return stagger_info
  }

  function execSendArgs(element, scope, messages, delay_dict, shortcuts, context) {


        var msgArr = parseStateMsgContents({parsed:messages, delays:delay_dict}) || [];
        // console.log(msgArr)
        msgArr.forEach(function(msg_info, i) {
          var staggerExists = false;



          // console.log(msg_info.name, msg_info.nameCamel, msg_info)



          var statesToExecute = [];

          //public scope
          if (scope.root && msg_info.nameCamel in scope.root.scope.public.customStates.when && msg_info.sendScope === 'depth(*)') {

              var currentMsgContext = scope.root.scope.public.customStates.when[msg_info.nameCamel];


              var numChildren = currentMsgContext.elements.length;
              if ('stagger' in delay_dict.internal &&  msg_info.name in delay_dict.internal.stagger) {
                var staggerDetails = delay_dict.internal.stagger[msg_info.name];
                staggerExists = true;
                delay_dict.internal.stagger[msg_info.name] = processStaggerDelayedMessages(staggerDetails,numChildren)
                msg_info.stagger = delay_dict.internal.stagger[msg_info.name]
              }

              if (currentMsgContext.elements.length) {

                execSingleMsgArg(element, scope, currentMsgContext.elements, msg_info)
              }
          } else {

              var currentMsgContext = scope.public.customStates.when[msg_info.nameCamel] || (scope.$parent && scope.$parent.public.customStates.when[msg_info.nameCamel])
              // console.log('entering local scope', currentMsgContext)
              //if elements exists
              if (currentMsgContext && currentMsgContext.elements) {
                  var numChildren = currentMsgContext.elements.length;



                  var depthParsed = parseDepthString(msg_info.sendScope)
                  var depthNum = parseInt(depthParsed);
                  // console.log(msg_info.name, depthParsed, depthNum, 'depthNumType:', typeof depthNum)


                  //self
                  if (depthParsed === 'self') {
                    if (currentMsgContext.elements && currentMsgContext.elements.length) {
                      currentMsgContext.depth = 'self';
                      execSingleMsgArg(element, scope, currentMsgContext.elements, msg_info)
                    }
                  }

                  //siblings
                  else if (depthParsed === 'siblings') {
                    var elements = [];

                    var intendedDepth = scope.$parent.public.customStates.when[msg_info.nameCamel].depth + 0.5;

                    currentMsgContext.elements.forEach(function(elem_info) {
                      if (elem_info.depth === intendedDepth && element[0].parentNode === elem_info.elem.parentNode) {

                        if (msg_info.sendScope === 'depth(0)' || element[0] !== elem_info.elem) {
                          elements.push(elem_info)
                        }
                      }
                    })

                    if (elements.length !== currentMsgContext.elements.length) {
                      currentMsgContext = {elements: elements, depth: currentMsgContext.depth, options: currentMsgContext.options};
                    }
                    var numChildren = currentMsgContext.elements.length;
                    if ('stagger' in delay_dict.internal && msg_info.name in delay_dict.internal.stagger) {

                      var staggerDetails = delay_dict.internal.stagger[msg_info.name];

                      staggerExists = true;
                      if (msg_info.name) {
                        delay_dict.internal.stagger[msg_info.name] = processStaggerDelayedMessages(staggerDetails,numChildren)

                        msg_info.stagger = delay_dict.internal.stagger[msg_info.name]
                      }
                    }
                    execSingleMsgArg(element, scope, currentMsgContext.elements, msg_info)
                  }

                //depthNum > 0
              else
                if (typeof depthNum === "number" && depthNum > 0) {

                  var elements = [];
                  currentMsgContext.elements.forEach(function(elem_info) {

                    if (elem_info.depth && !msg_info.greaterThan && !msg_info.lessThan && elem_info.depth === depthNum) {
                      elements.push(elem_info);
                    } else if (msg_info.greaterThan && elem_info.depth >= depthNum) {
                      // console.log(elem_info, depthNum, elem_info.depth, msg_info.greaterThan)
                      elements.push(elem_info);
                    } else if (msg_info.lessThan && elem_info.depth <= depthNum) {
                      elements.push(elem_info);
                    }

                  })


                  if (elements.length !== currentMsgContext.elements.length) {
                    currentMsgContext = {elements: elements, depth: currentMsgContext.depth, options: currentMsgContext.options};
                  }
                  // console.log(elements.length, currentMsgContext)
                  var numChildren = currentMsgContext.elements.length
                  if ('stagger' in delay_dict.internal && msg_info.name in delay_dict.internal.stagger) {

                    var staggerDetails = delay_dict.internal.stagger[msg_info.name];
                    staggerExists = true;
                    if (msg_info.name && msg_info.name.length) {
                      delay_dict.internal.stagger[msg_info.name] = processStaggerDelayedMessages(staggerDetails,numChildren)
                      msg_info.stagger = delay_dict.internal.stagger[msg_info.name]
                    }



                  }

                  execSingleMsgArg(element, scope, currentMsgContext.elements, msg_info)
              } else if (typeof depthNum === "number" && depthNum < 0) {
                var depthScope = scope;
                for (var i = depthNum; i < 0; i++) {
                  depthScope = depthScope.$parent;
                }
                if (msg_info.nameCamel in depthScope.public.customStates.when) {
                  var depthScopeElems = depthScope.public.customStates.when[msg_info.nameCamel].elements;
                  var elements = [];
                  depthScopeElems.forEach(function(state_ref) {

                    if (state_ref.depth === depthNum) {
                      elements.push(state_ref);
                    }
                  })
                  if (elements.length) {
                    currentMsgContext = {elements: elements, depth: depthNum, options:currentMsgContext.options};
                  }

                  execSingleMsgArg(element, depthScope, currentMsgContext.elements, msg_info)
                  // console.log(dept)
                }

                // console.log(scope.$parent.public.customStates.when)
                // if (msg_info.type in depthScope.states) {
                //   var typeStates = depthScope.states[msg_info.type];
                //   if (typeStates.length) {
                //     typeStates.forEach(function(state) {
                //       if (state.nameCamel === msg_info.nameCamel) {
                //         console.log(state)
                //       }
                //     })
                //   }
                // }

                // execSingleMsgArg(element, scope, currentMsgContext.elements, msg_info)
              }

            }
          }

        })
        return;
        messages = messages.trim();
        delay_dict = delay_dict || {internal: {}, external:0}

        if (messages.indexOf('{{') > -1) {
          var messagesParsed = [];
          messages.split(',').slice().forEach(function(msg) {
            messagesParsed.push( $parse('"' + messages.replace('{{', '"+').replace('}}', '+"') + '"')(scope))
          })
          messages = messagesParsed.join(",")
        }
        console.log('sending', messages)
        messages.split(',').forEach(function(msg, i) {
          if (!shortcuts.cmds) {
            shortcuts.cmds = RootService.animations.customShortcuts.cmds;
          }

          if (msg in shortcuts.cmds) {
            msg = shortcuts.cmds[msg];
          }
          var msgSplit = msg.split(':')
          var iMsg = msgSplit[0].trim();
          var msgName = iMsg;
          var msgScope = msgSplit[1].trim();

          msgDelay = delay_dict;
          var totalMsgDelay = msgDelay.external || 0;

          if (msgSplit.length > 2) {
            if (!msgDelay.internal && msgDelay.internal !== 0) {
              msgDelay.internal = 0;
            }
            totalMsgDelay = (msgDelay.external || 0) + (msgDelay.internal[msgName] || 0);
          }

          var fullMsgName = msgName;
          var msgType = msgName.split('-')[0];
          if (['as', 'init', 'on'].indexOf(msgType) === -1) {
             fullMsgName = ['when',msgName].join('-');
             var msgType = 'when'
          }

          var camelName = RootService.camelCase(fullMsgName.replace('when-', ''));
          if (msgScope === 'parent') {
            msgScope = 'depth(-1)'
          }
          if (msgScope === 'self') {

            if (['on', 'init', 'when'].indexOf(msgType) > -1) {
              console.log('waiting total', totalMsgDelay, delay_dict)
              $timeout(function() {
                console.log('activating', camelName, fullMsgName, scope.public.customStates.when)
                fullMsgName = fullMsgName.replace('when-', '');

                SendService.sendMsgToSelf(element, scope, fullMsgName.split('-').slice(1)[0], msgType, RootService.camelCase(fullMsgName))
              }, totalMsgDelay)
              return;

            }
            if (camelName in scope.public.customStates.when) {
              var stateRef = scope.public.customStates.when[camelName];

              if (stateRef.actions) {
                for (key in stateRef.actions) {

                  var splitSendObj = {};
                  splitSendObj[key] = stateRef.actions[key];

                  //warning: send to self loop;
                  if (key === 'send') {
                    var extDelay = stateRef.actions.send.delays.external + totalMsgDelay;

                      splitSendObj[key].delays.external = 0;
                      $timeout(function() {
                        stateRef.func && stateRef.func(splitSendObj, scope);
                      }, extDelay);
                  } else {

                    splitSendObj[key].delays.external += totalMsgDelay;

                    console.log('send level', key, msgScope, splitSendObj[key].delays);
                    stateRef.func && stateRef.func(splitSendObj, scope);
                  }
                }
              }

            }
          }
          else if (['children', 'grandchildren', 'siblings'].indexOf(msgScope) > -1 || msgScope.indexOf('depth') > -1) {
            var depthLevel;
            var depthScope = scope;
            var isInclusive = msgScope.indexOf('>') > -1 || msgScope.indexOf('<') > -1 || false;

            if (isInclusive) {
              msgScope = msgScope.replace('>', '').replace('<', '')
            }
            //also make sure it gets sent to self
            if (msgScope === 'depth(0)') {
              applySendArgsAndCallback(element, scope, msg.replace('depth(0)', 'self'), delay_dict);
              msgScope = 'siblings'
            }
            if (msgScope === 'depth(-0)') {
              msgScope = 'siblings'
            }
            var depthShortcutDict = {children: 1, grandchildren:2, siblings:0.5, parent: -1, "depth(-0)": 0.5, "depth(0)": 0.5, "depth(>0)": 1};
            if (msgScope in depthShortcutDict) {
              depthLevel = {num: depthShortcutDict[msgScope], inclusive: false};
            }
            else if (msgScope.indexOf('depth') > -1) {
              var depthNum = msgScope.split('(')[1].replace(')', '') || '0';
              if (depthNum) {
                depthNum = parseInt(depthNum)
              }
              depthLevel = {num: depthNum, inclusive: isInclusive}
            }


            if (!depthLevel) {
               depthLevel = {num: 0, inclusive:false};
            }

            if (depthLevel.num < 0) {
              for (var i = depthLevel.num; i < 0; i++) {
                depthScope = depthScope.$parent;
              }
              depthLevel.num = 0;
            }

            var stateRefs = depthScope.public.customStates.when[camelName];
            console.log(stateRefs, camelName, depthLevel, depthScope.public.customStates, element)
            if (msgScope === 'siblings' && (!stateRefs || !stateRefs.length)) {
              stateRefs = scope.$parent.public.customStates.when[camelName];
            } else if (!stateRefs || !camelName in depthScope.public.customStates.when) {
              if (msgType === 'when') {

                var dashedName = [msgType, msgName].join('-')
                stateRefs = {elements: depthScope.public.customStates[dashedName]}
              }
            }

            if (delay_dict.internal && delay_dict.internal.stagger) {

              var duration = delay_dict.internal.stagger.duration;
              var easeFunc = delay_dict.internal.stagger.ease;
              var numChildren = stateRefs.elements.length;

              var tempDuration = numChildren * (1000/60.0);

              var values = TweenService.preComputeValues("send", tempDuration, {send: 0}, {send:1}, easeFunc, delay_dict.internal.stagger.delays, 60).cache;

              delay_dict.internal.stagger.delays = values.slice(0, values.length - 2);
              delay_dict.internal.stagger.delays.forEach(function(delay_val, i) {
                delay_dict.internal.stagger.delays[i] = delay_dict.internal.stagger.delays[i] * duration;
              })
            }


            if (!stateRefs.length && msgType === 'when' && msgName.length) {
              // console.log(UtilitiesService[msgType, msgName].join('-'))
              // console.log(depthScope.public.customStates.when, camelName)
              console.log(depthScope.public, scope.public)
            }
            // depthLevel.num += 1
            // console.log(depthLevel.num)
            stateRefs.elements.forEach(function(stateRef, i) {

              var stagger_delay = 0;
              if (delay_dict.internal && delay_dict.internal.stagger && delay_dict.internal.stagger.delays) {
                stagger_delay = delay_dict.internal.stagger.delays[i];
              }
              // if (stateRef.actions.send) {
              //                 stateRef.actions.send.parsed.split(',').forEach(function(message_str, i) {
              //                   var msgNameCamel = UtilitiesService.camelCase(message_str.split(':')[0]);
              //                   SendService.prepareToSendMessage(msgNameCamel, message_str, depthScope);
              //                 })
              //           }
              if (stateRef.actions && Object.keys(stateRef.actions).length) {
                $timeout(function() {

                      stateRef.func && stateRef.func(stateRef.actions, depthScope || scope, stagger_delay, depthLevel);
                }, totalMsgDelay);
              }
            })
          }
          else if (msgScope === 'grandparent') {
            var stateRef;
            var depthScope = scope.$parent.$parent;

            if (camelName in depthScope.public.customStates.when) {

              stateRef = depthScope.public.customStates.when[camelName];
              console.log(stateRef)
              if ('name' in stateRef) {
                stateRef.func && stateRef.func(stateRef.actions, scope);
              } else {
                var stateRefs = stateRef;
                stateRefs.elements.forEach(function(stateRef, i) {
                  if (stateRef.actions && Object.keys(stateRef.actions).length) {
                    // if (stateRef.actions.send) {
                    //           stateRef.actions.send.parsed.split(',').forEach(function(message_str, i) {
                    //             var msgNameCamel = UtilitiesService.camelCase(message_str.split(':')[0]);
                    //             SendService.prepareToSendMessage(msgNameCamel, message_str, scope);
                    //           })
                    //     }

                    $timeout(function() {
                          stateRef.func && stateRef.func(stateRef.actions, scope);
                    }, totalMsgDelay);
                  }
                })
              }
            }
          }
          else if (msgScope === 'parent') {
            var stateRef;
            if (camelName in scope.$parent.public.customStates.when) {

              stateRef = scope.$parent.public.customStates.when[camelName];
              if ('name' in stateRef) {
                stateRef.func && stateRef.func(stateRef.actions, scope);
              } else {
                var stateRefs = stateRef;
                stateRefs.elements.forEach(function(stateRef, i) {
                  if (stateRef.actions && Object.keys(stateRef.actions).length) {
                    // if (stateRef.actions.send) {
                    //           stateRef.actions.send.parsed.split(',').forEach(function(message_str, i) {
                    //             var msgNameCamel = UtilitiesService.camelCase(message_str.split(':')[0]);
                    //             SendService.prepareToSendMessage(msgNameCamel, message_str, scope);
                    //           })
                    //     }

                    $timeout(function() {
                          stateRef.func && stateRef.func(stateRef.actions, scope);
                    }, totalMsgDelay);
                  }
                })
              }
            }

            // var elementFound = false;
            //   scope.$parent.public.customStates.whenElements.forEach(function(elem, i) {
            //     if (!elementFound && elem.contains(element[0])) {
            //       elementFound = elem;
            //       return;
            //     }
            //   })
            //   var camelName = UtilitiesService.camelCase(fullMsgName);
            //   if (elementFound && !scope.$parent.public.customStates.when[camelName]) {

            //     scope.$parent.public.customStates.when[camelName] = true;

            //     $timeout(function() {
            //       scope.$parent.public.customStates.when[camelName] = false;
            //     })
            //     var stateRef = scope.$parent.states[fullMsgName];
            //     if (stateRef.actions) {
            //       for (key in stateRef.actions) {

            //           stateRef.actions[key].delays.external += totalMsgDelay;
            //       }
            //       stateRef.func && stateRef.func(stateRef.actions, scope);
            //     }
            //     // scope.$parent.public.customStates.when[camelName] = elementFound;
            //   }
          }
          else if(msgScope === 'public' ) {
            // if (camelName in scope.root.scope.public.customStates) {
            //   fullMsgName = camelName
            // }
            // var  = UtilitiesService.camelCase(msg.split(':')[0]);

            var stateRefs = scope.root.scope.public.customStates[fullMsgName];
            if (!stateRefs) {
              stateRefs = scope.root.scope.public.customStates['when-' + msgName]
              // console.log(scope.root.scope.public.customStates, msgName)
            }
            stateRefs.forEach(function(stateRef, i) {
              if (stateRef.actions && Object.keys(stateRef.actions).length) {

                if (stateRef.actions.send) {
                      console.log('detected', stateRef.actions.send.parsed)
                       // if (stateRef.actions.send) {
                       //        stateRef.actions.send.parsed.split(',').forEach(function(message_str, i) {
                       //          var msgNameCamel = UtilitiesService.camelCase(message_str.split(':')[0]);
                       //          // var options = ;
                       //          // console.log(options)
                       //          SendService.prepareToSendMessage(msgNameCamel, message_str, scope, options);
                       //        })
                       //  }
                  }

                $timeout(function() {
                  console.log(stateRef)
                      stateRef.func && stateRef.func(stateRef.actions, scope);
                }, totalMsgDelay);


              }
            })
          }
        })
      }

  function parseDepth(depth_str) {
    var depth_str = depth_str && depth_str.replace('depth(', '').replace(')', '') || 'depth(1)';
    var inclusive = (depth_str.indexOf('>') > -1) || (depth_str.indexOf('<') > -1)
    if (inclusive) {
      depth_str = depth_str.replace('<', '').replace('>', '')
    }
    var result = {num: 0, inclusive: false};
    console.log(depth_str, parseInt(depth_str))
    result.num = parseFloat(depth_str);
    result.inclusive = inclusive || false;
    return result
  }

  function prepareToSendMessage(msg_name, msg_str, scope, options) {
    if (msg_str.indexOf('{{') > -1) {
      var messagesParsed = [];
      msg_str.split(',').slice().forEach(function(msg) {
        messagesParsed.push( $parse('"' + msg_str.replace('{{', '"+').replace('}}', '+"') + '"')(scope))
      })
      msg_str = messagesParsed.join(",");
      msg_name = msg_str.split(':')[0]
    }
    // console.log('attempting to pre-compile message', msg_name, msg_str)
    scope.public.customStates.when[msg_name] = {elements: [], depth: 0};
    var msg_scope = msg_str.split(':')[1];

    // console.log('attempting to precompile',msg_name, msg_scope, msg_str, scope.public.customStates.when)
    if (msg_scope === 'siblings' || msg_scope ==='depth(-0)' || msg_scope === 'depth(0)') {
      if (!scope.$parent.public) {
        scope.$parent.public = {customStates: {when: {}}};
      }
      scope.public.customStates.when[msg_name].depth = -0.5;
      scope.$parent.public.customStates.when[msg_name] = {elements: [], depth: -0.5};
      $timeout(function() {
        scope.$apply();
      })
    } else if (msg_scope !== 'self'){
      if (scope.public.customStates && scope.public.customStates.when) {
        // console.log(msg_name, msg_scope, scope.public.customStates.when.startCounter)
        if (!(msg_name in scope.public.customStates.when)) {
          scope.public.customStates.when[msg_name] = {depth: 0, elements: []}
        }
        // if (!scope.public.customStates.when.elements.length) {
        //   scope.public.customStates.when = {depth: 0, elements: []}
        //   // scope.public.customStates.when.elements.push(options.metadata)
        // }
        // console.log(options)

      }
    }

  }

  function sendMsgToSelf(element, scope, state_ref, msg_type, full_msg) {
    msg_type = msg_type.trim();
    state_ref = state_ref.trim();
    console.log(state_ref, msg_type)
    if (['with', 'init', 'as'].indexOf(state_ref) > -1 || msg_type === 'when') {

      // if (state_ref && state_ref.length && typeof) {``

      //   internal_name = state_ref[0];
      // }
      var internal_name = state_ref;
      console.log(scope.states[msg_type])
      if (scope.states[msg_type] && scope.states[msg_type].length) {
        scope.states[msg_type].forEach(function(state, i) {

          if (state.name.indexOf(state_ref) > -1 || msg_type === 'when') {
            state.exec(element, scope, null);
          }
          // if (on_state.name && on_state.name.indexOf())
        })
      } else if (scope.public.customStates.when && full_msg in scope.public.customStates.when) {
        var stateRef = scope.public.customStates.when[full_msg];
        // stateRef.elements && stateRef.elements.forEach(function(state, elem) {

        // })
        stateRef.elements.forEach(function(state, i) {
          if (state.func) {
            console.log(state)
            state.func(state.actions.send, scope.$parent)
          }
        })
        console.log()
        // console.log('attempting to activate message to self', scope.public.customStates.when, state_ref)
      }
    }
  }
}

angular.module('uguru.shared.services')
.factory("PropertyService", [
    '$timeout',
    '$state',
    'UtilitiesService',
    'TweenService',
    'RootService',
    'XHRService',
    '$compile',
    '$rootScope',
    'SVGService',
    PropertyService
        ]);

function PropertyService($timeout, $state, UtilitiesService, TweenService, RootService, XHRService, $compile, $rootScope, SVGService) {
  var blacklistStates = ['init-with', 'init-later'];
  var defaultPropAnimations = {};
  var rFrameEasingCache = {};
  var defaults = {};
  defaults.FPS_SIXTY = 1000/16;
  var playerControlElems= {ball: null, bar: null, time:null};
  return {
    initPropertyObj: initPropertyObj,
    getFrameAnimationFunc: getFrameAnimationFunc,
    defaultPropAnimations: defaultPropAnimations,
    detectPlaybarControlElem: detectPlaybarControlElem,
    getPropJson: getPropJson,
    parseAnimObjToPropArr: parseAnimObjToPropArr,
    getDMatrixString: getDMatrixString
  }

  function getDMatrixString(d_matrix, transform_str, perspective) {
            transform_str = transform_str + " ";
            var result = "";

            var defaults = {"scaleX": 1, "scaleY": 1, "scaleZ": 1};
            var count =0;

            if (d_matrix.skew[0] || transform_str.split('skewX').length > 1) {
                result += "skewX(" + parseFloat(d_matrix.skew[0], 10).toFixed(4) + 'deg) '
                count++;
            }
            if (d_matrix.skew[1] || transform_str.split('skewY').length > 1) {
                result += "skewY(" + parseFloat(d_matrix.skew[1], 10).toFixed(4) + 'deg) ';
                count++;
            }
            if (d_matrix.rotate[0] || transform_str.split('rotateX').length > 1) {
                result += "rotateX(" + parseFloat(d_matrix.rotate[0], 10).toFixed(4) + 'deg) ';
                count++;
            }

            if (d_matrix.rotate[1] || transform_str.split('rotateY').length > 1) {
                result += "rotateY(" + parseFloat(d_matrix.rotate[1], 10).toFixed(4) + "deg) ";
                count++;
            }
            if (d_matrix.rotate[2] || transform_str.split('rotateZ').length > 1) {
                result += "rotateZ(" + parseFloat(d_matrix.rotate[2], 10).toFixed(4) + "deg) ";
                count++;
            }
            if (d_matrix.translate[0] || transform_str.split('translateX').length > 1) {
                result += "translateX(" + parseFloat(d_matrix.translate[0], 10).toFixed(4) + "%) ";
                count++;
            }
            if (d_matrix.translate[1] || transform_str.split('translateY').length > 1) {
                result += "translateY(" + parseFloat(d_matrix.translate[1], 10).toFixed(4) + "%) ";
                count++;
            }
            if (d_matrix.translate[2] || transform_str.split('translateZ').length > 1) {
                result += "translateZ(" + parseFloat(d_matrix.translate[2], 10).toFixed(4) + "px) ";
                count++;
            }
            if (d_matrix.scale[0] !== 1 && transform_str.split('scaleX').length > 1) {
                result += "scaleX(" + parseFloat(d_matrix.scale[0], 10).toFixed(4) + ") ";
                count++;
            }
            if (d_matrix.scale[1] !== 1 && transform_str.split('scaleY').length > 1) {
                result += "scaleY(" + parseFloat(d_matrix.scale[1], 10).toFixed(4) + ") ";
                count++;
            }
            if (d_matrix.scale[2] !== 1 &&  transform_str.split('scaleZ').length > 1) {
                result += "scaleZ(" + parseFloat(d_matrix.scale[1], 10).toFixed(4) + ") ";
                count++;
            }
            if (transform_str.split('scale(').length > 1) {
                result += "scaleX(" + parseFloat(d_matrix.scale[0], 10).toFixed(4) + ") scaleY(" + parseFloat(d_matrix.scale[1], 10).toFixed(4) + ") ";
                count++;
            }
            if (transform_str.split('scale3d(').length > 1) {
                result += "scale3d(" + parseFloat(d_matrix.scale[0], 10).toFixed(4) + ", " + parseFloat(d_matrix.scale[1], 10).toFixed(4) + ", " + parseFloat(d_matrix.scale[1], 10).toFixed(4) +  ") ";
                count++;
            }
            if (perspective && perspective.length) {
                result += "perspective(" + perspective + ') '
                count++;
            }
            if (transform_str.split('rotate(').length > 1) {
                var rotateValue = transform_str.split('rotate(')[1].split(')')[0];
                console.log('rotateValue discovered... hacking..');
                result += "rotate(" + rotateValue +") ";
                count++;
            }
            if (count) {
                return result
            }

        }

  function parseKeyframeCSS(css_str) {
    var resultDict = {}
    var removedBracketStr = css_str.split('{')[1].split('}')[0].trim();
    var kvProps = removedBracketStr.split(';')
    kvProps.forEach(function(kv, i) {kvProps[i] = kvProps[i].replace(': ', ':').replace(' :', ':').replace(' : ', ':').trim()})
    kvProps = kvProps.filter(function(prop, i) {return prop && prop.length})
    kvProps.forEach(function(kv, i) {
      // resultDict[kv]
      var kvSplit = kv.split(':');
      resultDict[kvSplit[0].trim() + ""] = kvSplit[1].trim()
    })
    return resultDict;
  }

  function parseAnimObjToPropArr(css_rules, debug) {
    var keyFrames = [];
    var propDictFrames = {};
    for (var i = 0; i < css_rules.length; i++) {

      var iRule = css_rules[i];
      if (iRule.type !== 8) {
        continue;
      }
      var percentInt = parseFloat(iRule.keyText.replace('%', ''))
      var cssText = iRule.cssText;
      var propArr = parseKeyframeCSS(iRule.cssText)
      for (key in propArr) {
        if (!(key in propDictFrames)) {
          propDictFrames[key] = []
        }
        propDictFrames[key].push({prop: key, value: propArr[key], percent:percentInt});
      }
      keyFrames.unshift({percent: percentInt, props:propArr})
    }

    for (key in keyFrames) {
      var frames = keyFrames[key];
      debug && console.log(key, '-' , frames.length, 'frames')
      for (var i = 0; i < keyFrames[key].length; i++) {
        var propObj = keyFrames[key][i];
        debug && console.log('|' , propObj.percent + '%', propObj.prop, '==>' ,propObj.value)
      }
      debug && console.log('\n------------------------\n')
    }

    // for (property in css_rules) {
    //   if ((property || property === 0) && css_rules[property].type === window.CSSRule.WEBKIT_KEYFRAME_RULE) {
    //     keyFrames.push(css_rules[property]);
    //   }
    // }
    // keyFrames.sort(function(kf_a, kf_b) {
    //   return parseFloat(kf_b.keyText.replace("%", "")) - parseFloat(kf_b.keyText.replace("%", ""))
    // }).reverse()
    // keyFrames.forEach(function(kf, i) {
    //   console.log(kf.keyText)
    // })
    // var resultDict =
    return {orig: {rules: css_rules, kf: keyFrames}, props: propDictFrames};
  }

  function detectPlaybarControlElem() {
    if (!playerControlElems.ball) {
      playerControlElems.ball = {elem: document.querySelector('[inspector-ball]'), width: null, height: null};
      if (playerControlElems.ball.elem) {
        var ballRect = playerControlElems.ball.elem.getBoundingClientRect();
        playerControlElems.ball.width = ballRect.width;
        playerControlElems.ball.height = ballRect.height;
      }
    }
    if (!playerControlElems.bar) {
      playerControlElems.bar = {elem: document.querySelector('[inspector-bar]'), width: null, height: null};
      if (playerControlElems.bar.elem) {
        var barRect = playerControlElems.bar.elem.getBoundingClientRect();
        playerControlElems.bar.width = barRect.width;
        playerControlElems.bar.height = barRect.height;
      }
    }
    if (!playerControlElems.time) {
      playerControlElems.time = {elem: document.querySelector('[inspector-time]'), width: null, height: null};
      if (playerControlElems.time.elem) {
        var timeRect = playerControlElems.time.elem.getBoundingClientRect();
        playerControlElems.time.width = timeRect.width;
        playerControlElems.time.height = timeRect.height;
      }
    }

    return playerControlElems
  }

  function getPropJson(struct, cb) {
    if (!struct) return;
      var request_type = 'GET';
      var url = '/admin/spec/property.json';
      XHRService.getJSONFile(request_type, url, cb, struct)
  }

  function getDefaultAnimProp(struct) {
    if (!struct) struct = defaultPropAnimations;
      var callback = function(response) {
        if (response && 'defaultsDict' in response) {
          for (key in response.defaultsDict) {
            struct[key] = response.defaultsDict[key];
          }
        }
      }
      var request_type = 'GET';
      var url = '/admin/spec/property.json';
      XHRService.getJSONFile(request_type, url, callback, {})
  }

  function getFrameAnimationFunc(elem, property, arg_arr, state_name, apply_default, player) {
    var previous_player = player || null;
    if (!property) console.log('ERROR: Missing property');

    var args = processPropertyArgs(elem, property, arg_arr, state_name, apply_default);
    args.stateNameCamel = UtilitiesService.camelCase(state_name);
    args.stateName = state_name;
    if (args.direction.current === 'r' && (args.direction.value === 'ar' || args.direction.current === 'r')) {
      var tempEnd = {};
      for (key in args.start) {
        tempEnd[key] = args.start[key];
      }
      args.start = args.end;
      args.end = tempEnd;
      if (args.direction.value === 'ar') {
        args.direction.value = 'a';
      }

    }
    args.player = initPlayerFromArgs(elem[0], args, previous_player);


    return args;

    // console.log(property, arg_arr, state_name, apply_default);
  }

  function combinePreviousWithNewProp(prop_args, previous_player) {
    var resultDict = {};
    var supportedMappings = ['property', 'start', 'end', 'ease', 'duration'];
    previousPlayerProp = previous_player.tweenConfig.attachment.property;
    if (typeof(previous_player.tweenConfig.easing) === 'string') {
      var previousStrValue = previous_player.tweenConfig.easing;
      previous_player.tweenConfig.easing = {};
      previous_player.tweenConfig.easing[previousPlayerProp] = previousStrValue;
      previous_player.tweenConfig.easing[prop_args.property] = prop_args.ease;
    } else {
      previous_player.tweenConfig.easing[prop_args.property] = prop_args.ease;
    }
    previous_player.control.iter[prop_args.property] = prop_args.iter;
    console.log()
    if (prop_args.property in previous_player.tweenConfig.to && prop_args.property in previous_player.tweenConfig.from) {
      // previous_player.tweenConfig.to[prop_args.property] = prop_args.end[prop_args.property];
      // if (!prop_args.pr)
      if (!previous_player.tweenConfig.inBetween) {
        previous_player.tweenConfig.inBetween = {};
        previous_player.tweenConfig.inBetween[prop_args.property] = [];
      }
      if (previous_player.tweenConfig.inBetween[prop_args.property]) {
        previous_player.tweenConfig.inBetween[prop_args.property].push(prop_args);
        previous_player.tweenConfig.to[prop_args.property] = prop_args.end[prop_args.property];
      }
    } else {
      previous_player.tweenConfig.from[prop_args.property] = prop_args.start[prop_args.property];
      previous_player.tweenConfig.to[prop_args.property] = prop_args.end[prop_args.property];
    }
    return previous_player;
  }

  function applyInspectorGadgetPreferences(player) {
    var resultDict = {};
    var preferences = RootService.getInspectorPreferences();
    var filledPreferences = {};
    for (key in preferences) {

      if (preferences[key].length || preferences[key] > 0 || typeof(preferences[key]) === 'boolean') {
        filledPreferences[key] = preferences[key];
      }
    }



    if (preferences.speed) {
      player.tweenConfig.duration = 1/preferences.speed * player.tweenConfig.duration;
      if (player.propDelays) {
        for (key in player.propDelays) {
          player.propDelays[key].duration = 1/preferences.speed * player.propDelays[key].duration;
          player.propDelays[key].offset = 1/preferences.speed * player.propDelays[key].offset;
          TweenService.preComputeValues(player.propDelays[key].property, player.propDelays[key].duration, player.propDelays[key].start, player.propDelays[key].end, player.propDelays[key].ease, player.propDelays[key])
        }
      }
      player.control.time.duration = player.tweenConfig.duration;
      if (player.tweenConfig.duration > 1000 && (player.tweenConfig.duration/1000 % 100) > 10) {
        player.control.time.sigfig = (player.tweenConfig.duration/1000 + "").split('.')[1].length
      }
      filledPreferences.speed = preferences.speed;
    }

    if (preferences.startAt) {
      var startOption = preferences.startAt.split(':')[0];
      var startValue = preferences.startAt.split(':')[1];
      if (startValue.indexOf('%') > -1) {
        startValue = parseFloat(startValue.replace('%', ''))/100 * player.tweenConfig.duration;
      }
      console.log(startValue)
      switch (startOption) {
        case ("t") :
          // var seekMS = player.tweenConfig.duration
          filledPreferences.startAt = {seek: startValue};
          player.control.ball = {elem: document.querySelector('[inspector-ball]')}
          player.control.time.elem = document.querySelector('[inspector-time]');
      }
    }

    if (preferences.showProps && preferences.showProps.length) {
      filledPreferences.hideProp = {};
    // if (player.pref && player.pref.showProps && player.pref.showProps.length) {
      var formatShowPropsArr = UtilitiesService.replaceAll(preferences.showProps, ', ', ',').split(',');


      formatShowPropsArr.forEach(function(prop, i) {
        if (prop.indexOf('!') > -1) {
          prop = prop.replace('!', '')
          filledPreferences.hideProp[prop] = true;
        }
      })
    }


    filledPreferences.showStates = getPlayerPropertyAnimations(player.elem)
    filledPreferences.switchStateTo = recompileElement(player.elem);
    player.prefs = filledPreferences
  }

  function recompileElement(elem) {
    return function(player, state) {
      var state_name = state.name;
      var state_value = state.value;

      var elemChild = elem;
      var elemParent = elemChild.parentNode;
      elemChild.parentNode.removeChild(elem);
      elem.setAttribute('inspector-elem', state_name);
      elemParent.appendChild(elem);

      // $timeout(function() {
      //   $compile(elemParent)($rootScope);
      // })
      $timeout(function() {



        $compile(angular.element(document.querySelector('#gadget-player')))($rootScope);
        var argsDict = {};

      }, 100)
    }
  }

  function getPlayerPropertyAnimations(elem) {
    return function(player) {
      var searchValues = ['inspector-elem', 'p:['];
      var currentlyActive;
      var resultAttr = [];
      for (var i = 0; i < elem.attributes.length; i++) {
        var attrName = elem.attributes[i].name;
        var attrValue = elem.attributes[i].value;
        if (attrName.indexOf(searchValues[0]) > -1) {
          currentlyActive = attrValue.split('-').join(' ').toUpperCase();
          continue
        }
        if (attrValue.indexOf(searchValues[1]) > -1) {
          resultAttr.push(elem.attributes[i])
        }
      }

      player.prefs.elemAnimStates = resultAttr;
      player.prefs.activeState = currentlyActive
      return resultAttr
    }
  }

  function applyShowOptionPropertySpecificPlayerToTweenConfig(playerObj) {
    if (!playerObj.tweenConfig.from.propControl && playerObj.state.properties.length) {
            playerObj.tweenConfig.from.propControl = '';
            playerObj.tweenConfig.to.propControl = '';

            playerObj.tweenConfig.easing.propControl = '';
      }



      playerObj.state.properties.forEach(function(prop, i) {
          if (prop.active) {

            playerObj.tweenConfig.from.propControl += 'translateX(0px) ';
            playerObj.tweenConfig.to.propControl += 'translateX(' + prop.control.barWidth + 'px) ';

            if (prop.type === 'transform' && prop.easing.split(' ').length > 1) {
              prop.easing = prop.easing.split(' ')[prop.state.splitIndex]
              console.log(prop.easing = prop.easing.split(' '))
              playerObj.tweenConfig.easing.propControl += prop.easing + ' '

            }
            //transform
            else if (prop.type && playerObj.tweenConfig.easing && prop.type in playerObj.tweenConfig.easing)  {
              prop.easing = playerObj.tweenConfig.easing[prop.type]
              playerObj.tweenConfig.easing.propControl += prop.easing + ' ';
            }

            //standard
            else if (playerObj.tweenConfig.easing && typeof playerObj.tweenConfig.easing === 'string') {
              var initialEasing = playerObj.tweenConfig.easing + '';
              playerObj.tweenConfig.easing = {ballControl: 'linear'};
              playerObj.tweenConfig.easing[prop.name] = initialEasing || prop.easing || 'linear';
              if (!playerObj.tweenConfig.easing.propControl) {
                playerObj.tweenConfig.easing.propControl = prop.easing;
              }
            }
            else if (!prop.name){
              prop.easing = 'linear';
              playerObj.tweenConfig.easing = {ballControl: 'linear'};
              playerObj.tweenConfig.easing.name = prop.easing || 'linear'
              playerObj.tweenConfig.easing.propControl = playerObj.tweenConfig.easing.name
            } else if (prop.name && !playerObj.tweenConfig.easing) {
              prop.easing = prop.name
              playerObj.tweenConfig.easing = {}
              playerObj.tweenConfig.easing.name = prop.name || prop.type;
              playerObj.tweenConfig.easing.propControl = playerObj.tweenConfig.easing.name
            }


          }
          playerObj.state.propertyControls.push(prop.control);

          console.log(playerObj.tweenConfig, prop.name)
      })


      if (typeof playerObj.tweenConfig.easing === 'string') {
        var originalEasing = playerObj.tweenConfig.easing;
        playerObj.tweenConfig.easing = {ballControl: 'linear'}
        for (key in playerObj.tweenConfig.from) {
          if (key !== 'ballControl') {
            playerObj.tweenConfig.easing[key] = originalEasing;
          }
        }
      }

      if (playerObj.tweenConfig.easing.propControl) {
        playerObj.tweenConfig.easing.propControl = playerObj.tweenConfig.easing.propControl.trim()
      }
      playerObj.tweenConfig.easing && delete playerObj.tweenConfig.easing['undefined']
      // if (playerObj.tweenConfig.easing) {
      //   playerObj.tweenConfig.easing.ballControl = 'linear'
      // }
      playerObj.tweenConfig.to.propControl = playerObj.tweenConfig.to.propControl.trim();
      playerObj.tweenConfig.from.propControl = playerObj.tweenConfig.from.propControl.trim();

      console.log(playerObj.tweenConfig.from.propControl)
      console.log(playerObj.tweenConfig.to.propControl)
      if (playerObj.tweenConfig.easing.propControl && playerObj.tweenConfig.easing.propControl.split(' ').length > playerObj.tweenConfig.from.propControl.split(' ').length) {
        playerObj.tweenConfig.easing.propControl = playerObj.tweenConfig.easing.propControl.split(' ').slice(0, playerObj.tweenConfig.to.propControl.split(' ').length).join(' ')
      }
      // playerObj.tweenConfig.easing.propControl =
      return playerObj;
  }

  function parseActiveProperties(playerObj, start, end, easing) {
    var resultArr = [];
    var resultDict = {};
    var easing = easing;
    for (key in start) {
      if (key.toLowerCase().indexOf('control') > -1) continue;
      var pDict = {};
      pDict.name = key;
      pDict.start = start[key];
      pDict.end = end[key];
      pDict.active = !playerObj.prefs.hideProp || ((pDict.name in playerObj.prefs.hideProp) === false)


      if (key.toLowerCase().indexOf('transform') > -1) {
        pDict.type = 'transform';
        start[key].split(' ').forEach(function(prop, i) {
          pDict.name = prop.split('(')[0].replace('%', '').replace('px', '').replace('deg','');
          pDict.active = !playerObj.prefs.hideProp || ((pDict.name in playerObj.prefs.hideProp) === false)
          pDict.start = UtilitiesService.removeAllOccurrancesArr(prop.split(pDict.name)[1], ['(', ')']).trim()

          pDict.end = UtilitiesService.removeAllOccurrancesArr(end[key].split(' ')[i].split(pDict.name)[1], ['(', ')']).trim()

          pDict.easing = easing;
          pDict.state = {splitIndex: i,  time: 0,  delay: 0, ignore:true, breakpoints:[], startAt: [], stepSize: 25, speed:1};
          resultArr.push(JSON.parse(JSON.stringify(pDict)));

        })
      } else {
        pDict.easing = easing || 'linear';
        resultArr.push(JSON.parse(JSON.stringify(pDict)));
      }

    }
    resultArr = removeInactivePropertiesFromResultArr(playerObj, resultArr)


    $timeout(function() {
      if (!playerObj.state.properties) {
        playerObj.state.properties = resultArr;
        $timeout(function() {
          playerObj.state.properties.length && playerObj.state.properties.forEach(function(pDict, i) {

            var ballElem = document.querySelector('#property-ball-' + i);
            var valueElem = document.querySelector('#property-value-' + i);
            var barElem = document.querySelector('#property-bar-' + i);
            var barElemWidth = null || playerObj.control.bar.width;
            if (barElem) {
              barElemWidth = barElem.getBoundingClientRect().width || playerObj.control.bar.width
            }
            pDict.control = {time: 0, active: pDict.active , ball: {elem: ballElem}, valueElem: valueElem, name: pDict.type || pDict.name, barWidth: barElemWidth};



          })

          playerObj.state.propertyControls = [];
          playerObj = applyShowOptionPropertySpecificPlayerToTweenConfig(playerObj)
        },100)
      }


      },10);
      return resultArr;
  }

  function removeInactivePropertiesFromResultArr(playerObj, resultArr) {
    var indicesToRemove = [];
    resultArr.forEach(function(pDict, i) {
      if (!pDict.active) {
        playerObj.prefs.hideProp[pDict.name] = pDict;
        if (!pDict.type || pDict.type !== 'transform') {
          playerObj.prefs.hideProp[pDict.name].tweenConfig = {from: playerObj.tweenConfig.from[pDict.name]}
          delete playerObj.tweenConfig.from[pDict.name];
        } else {
          playerObj.prefs.hideProp[pDict.name].tweenConfig = {from: playerObj.tweenConfig.from[pDict.name], to: playerObj.tweenConfig.from[pDict.name]}
          var fromSplit = playerObj.tweenConfig.from[pDict.type].split(' ')
          var toSplit = playerObj.tweenConfig.to[pDict.type].split(' ')
          fromSplit[pDict.state.splitIndex] = '';
          toSplit[pDict.state.splitIndex] = '';
          playerObj.tweenConfig.from[pDict.type] = fromSplit.join(' ')
          playerObj.tweenConfig.to[pDict.type] = toSplit.join(' ')

        }
        indicesToRemove.push(i)
        return false
      }
      return true
    })
    var tempArr = [];
    resultArr.forEach(function(prop, i) {
      if (prop.active) {
        tempArr.push(prop)
      }
    })
    return tempArr;
  }


  function initPlayerFromArgs(elem, args, previous_player) {
    var playerObj = {state: { time: 0, active: false, paused: false}, control: {iter: {}, time: {duration: args.duration || previous_player.duration, sigfig: 1}}};
    playerObj.control.iter[args.property] = args.iter;
    playerObj.control.iter[args.property].direction = args.direction;
    if (!previous_player) {
      playerObj.elem = elem;
      playerObj.tweenConfig = {
        from: args.start,
        to: args.end,
        duration: args.duration,
        easing: args.ease,
        attachment: playerObj,
        start: startTween,
        step: applyPropToElem,
        finish: finishTween
      }
        playerObj.elem = elem;
    } else {

        playerObj = combinePreviousWithNewProp(args, previous_player);

    }

    if (args.duration !== playerObj.tweenConfig.duration) {

      args.delay = 0;
      playerObj.tweenConfig.duration = Math.max(playerObj.tweenConfig.duration, args.duration + args.delay || 0)
    }

    // playerObj.tween = new Tweenable();
    if (args.delay || args.delay === 0) {

      if (!('propDelays' in playerObj)) {
        playerObj.propDelays = {};
      }
      playerObj.propDelays[args.property] = {property: args.property, offset: args.delay, duration: args.duration, start: args.start, end: args.end, ease:args.ease, cache:[]};

      cacheResponse = TweenService.preComputeValues(args.property, args.duration, args.start, args.end, args.ease, playerObj.propDelays[args.property])
      // console.log(playerObj.tweenConfig.inBetween)
    }

    if (playerObj.tweenConfig.inBetween && playerObj.tweenConfig.inBetween.length) {

    }


    if (elem.hasAttribute('inspector-elem')) {
      playerObj.inspect = true;
      !previous_player && RootService.addElemToInspector(playerObj);

      $timeout(function() {
        var newControl = detectPlaybarControlElem();
        newControl.time.duration = playerObj.control.time.duration;
        newControl.time.sigfig = playerObj.control.time.sigfig;
        playerObj.control = newControl;
        if (playerObj.control && playerObj.control.ball && playerObj.control.ball.elem) {
          playerObj.tweenConfig.from.ballControl = 'translateX(0px)';
          playerObj.tweenConfig.to['ballControl'] = 'translateX(' + playerObj.control.bar.width + 'px)';
          !playerObj.prefs && applyInspectorGadgetPreferences(playerObj);


          if (playerObj.prefs && playerObj.prefs.showProps) {
            parseActiveProperties(playerObj, args.start, args.end, args.ease);
          }
        }
      })
    }




    function formatTime (time, time_control, sigfig) {
      if (!sigfig) sigfig = 2;
      if (!time) time = 0;
      if (time_control && time_control.reverse) time = time_control.duration - time;
      if (time > 1000) {
        return (time/1000).toFixed(sigfig) + 's';
      }
      return parseInt(time) + 'ms';
    }


    function applyPropToElem(state, args, time) {
      if (!time) return;

      var skipArgs;
      if (args.control && args.control.ball && args.control.ball.elem) {
        args.control.ball.elem.setAttribute('style', 'transform:' + state['ballControl'] + ';');
        args.control.time.elem.innerHTML = formatTime(time, args.control.time)
      }

      if (args.prefs && args.prefs.showProps && time > 0) {

        args.state.propertyControls.forEach(function(prop, i) {
          if (Math.abs(prop.time - time) > 2 * defaults.FPS_SIXTY) return;
          if (!prop.active) return;
          var ballValue = state['propControl'].split(' ')[i];
          var propName = args.state.propertyControls[i].name;
          var propValue = state[propName];
          prop.ball.elem.style.transform = ballValue;
          prop.time = time;
          prop.valueElem.innerHTML = (propValue.split(' ').length >= 1 && propName.toLowerCase() !== 'transform') || propValue.split(' ')[i].split('(')[1].replace(')', '');
          if (args.skip && args.skip.length && prop.active) {
            console.log('skipProp', args.skip, propValue)
            skipArgs = {value:propValue, name: propName}
          }
        })
      }
      if (skipArgs) {
        args.elem.style[skipArgs.name] = skipArgs.value
        return;
      }

      args.state.time = time;

      args.inspect && args.prefs.showLog && args.state.active && console.log('\n@ T = ' + time +'ms\n-----------');

      for (prop in state) {
        if (time > 0 && args.inspect && args.skipProp && args.skipProp.indexOf(prop) > -1) {
          console.log('skipping', prop);
          continue
        };
        if (state[prop].indexOf('rgba') > -1) {
          var firstSplit = state[prop].split('(')
          var secondSplit = firstSplit[1].split(',');
          var value = firstSplit[0] + '(' + parseInt(secondSplit[0]) + ',' +  parseInt(secondSplit[1]) + ',' +  parseInt(secondSplit[2]) + ',' + secondSplit[3];
          args.elem.style[prop] = value;
          continue;
        }
        if (args.propDelays && prop in args.propDelays) {
          var delta = args.propDelays[prop].offset - time;
          // args.propDelays[prop].cache.push(state[prop])

          if (delta < 0) {
            var val = args.propDelays[prop].cache.shift();
            if (val !== null) {

              args.propDelays[prop].cache.push(val);
              args.elem.style[prop] = val
              // console.log(delta, args.propDelays[prop].cache)
            } else {
              args.propDelays[prop].cache.unshift(null);
            }

          }
        } else {
          args.elem.style[prop] = state[prop];
        }
        args.inspect && args.prefs.showLog && args.state.active && prop.indexOf('Control') === -1 && time >= 0 && time <= args.tweenConfig.duration && console.log(prop + ':' + state[prop])
      }
      args.inspect && args.prefs.showLog && args.state.active && console.log('\n')
    }

    function startTween(state, args) {
      // console.log(args)
      // console.log('starting...', state, args);
      // console.log(state, args)
      args.prefs && args.prefs.showLog && console.log('-----Animation starting ---')
      // $timeout(function() {

      //   args.control.ball = {elem: document.querySelector('[inspector-ball]')}
      //   args.control.time.elem = document.querySelector('[inspector-time]');

      // }, 250)
      args.inspect && args.prefs.showLog && args.state.active && console.log('\n@ T = ' +'0ms\n-----------');
      for (prop in state) {

        args.inspect && args.prefs.showLog && args.state.active && prop.indexOf('Control') === -1  && console.log(prop + ':' + state[prop])
      }



    }

    function finishTween(state, player) {
        if (player.tweenConfig.finishCallback) {
          player = player.tweenConfig.finishCallback(player);
        }
        player.state.active = false;
        player.state.time = 0;
        player.state.active = false;
        player.state.paused = false;
        player.tween.dispose();
        $timeout(function() {
          player.state.active = false;
        })
        if (player.propDelays) {
          for (key in player.propDelays) {
            if (player.propDelays[key].cache && player.propDelays[key].cache.length && player.propDelays[key].cache[0] === null) {
              player.propDelays[key].cache.push(player.propDelays[key].cache.shift());
            }
          }
        }
        player.inspect && player.prefs.showLog && console.log('-----Animation successfully finished---')
        // playerObj.propDelays[args.property] = {offset: args.delay, duration: args.duration, start: args.start, end: args.end, ease:args.ease, cache:[]};
        for (key in player.control.iter) {
          var direction = player.control.iter[key].direction;
          var count = player.control.iter[key].count;

          if (direction.value === 'a' && count && count >= 1) {
            if (direction.current === 'f') {
              player.control.iter[key].direction.current = 'r';
              var tempStart = player.tweenConfig.to;
              player.tweenConfig.to = player.tweenConfig.from;
              player.tweenConfig.from = tempStart;
              // player.tween = new Tweenable(player.tweenConfig).pause();
            }

            else if (direction.current === 'r') {
              player.control.iter[key].direction.current = 'f';
              var tempStart = player.tweenConfig.to;
              player.tweenConfig.to = player.tweenConfig.from;
              player.tweenConfig.from = tempStart;
              // player.tween = new Tweenable(player.tweenConfig).pause();

              console.log(player.tweenConfig.to, player.tweenConfig.from)
            }
          }
        }


        player = player.init(player);

        var count = 0;
        var maxDelay = -1;
        for (key in playerObj.control.iter) {
          playerObj.control.iter[key].count -= 1;
          count += playerObj.control.iter[key].count;

          if (playerObj.control.iter[key].delay && playerObj.control.iter[key].delay > maxDelay) {
            maxDelay = playerObj.control.iter[key].delay;
          }
        }
        if (count > 0) {
          if (maxDelay > 0) {
            $timeout(function() {
              player.play(player);
            }, maxDelay)
          } else {
            player.play();
          }
        }
        // if (player.control.iter)

      }


    function getPlayFunction(player) {

      playerObj.tween.setConfig(playerObj.tweenConfig)
      if (playerObj.control.iter) {
        for (key in playerObj.control.iter) {
          if (playerObj.control.iter[key].count <= 0) {
            console.log('out of counts', key)
            return;
          }
        }
      }

      return function() {
        if (!player.state.time) {
          player.state.active = true;
          player.state.paused = false;
          player.tween = player.tween.tween();
        } else {
          player.state.active = true;
          player.tween = player.tween.resume();
        }
      };
    }

    function getPauseFunction(player) {
      return function() {
        console.log('pausing..')
        player.state.active = false;
        player.tween.pause();
      }
    }

    function getStepToFunction(player) {
      return function(direction) {
        var ms = parseFloat(player.prefs && player.prefs.stepSize || 100);
        var seekTotal;
        if (direction === 'forwards') {
          player.direction = 'normal';
          seekTotal = player.state.time + ms;
        } else if (direction === 'reverse'){
          ms = ms * -1;
            if (player.state.time < Math.abs(ms) && player.state.time > 0) {
              seekTotal = 0;
            }
            else if (player.state.time === 0){
              seekTotal = player.tweenConfig.duration + ms;
            } else {
              seekTotal = player.state.time + ms
            }
        }
        player.tween.seek(seekTotal);
      }
    }

    function getJumpToFunction(player) {
      return function($event) {
        console.log(player.tweenConfig)
        var initialTo = player.tweenConfig.to;
        var initialFrom = player.tweenConfig.from;
        var initialDuration = player.tweenConfig.duration;

        parentRect = player.control.bar.elem.parentNode.getBoundingClientRect()
        console.log(parentRect)
        ballRectLeft = player.control.ball.elem.getBoundingClientRect().left;
        var parentWidth = parentRect.width;
        var jumpToCoordX = $event.clientX - parentRect.left;
        jumpToCoordX
        var reverse = ballRectLeft > jumpToCoordX;

        var jumpDict = {start: {}, end: {}};

        if (player.state.time > 0) {
          jumpDict.start.state =  player.state.time && player.tween.get();
          jumpDict.start.time = player.state.time;
          console.log('jumping with time already > 0 && reverse', reverse);
        } else if (reverse && !player.state.time) {
          jumpDict.start.state =  player.tweenConfig.to;
          jumpDict.start.time = player.tweenConfig.duration;
          console.log('jumping with animation complete && reverse', reverse);
        } else if (!reverse && !player.state.time) {
          jumpDict.start.time = 0;
          jumpDict.start.state = player.tween.get();
          console.log('jumping with time = 0')
        }



        jumpDict.end.time = parseInt(player.tweenConfig.duration * (jumpToCoordX/parentWidth));
        jumpDict.end.state = player.tween.pause().seek(jumpDict.end.time).get()

        player.control.time.reverse = jumpDict.end.time < jumpDict.start.time;


        player.tweenConfig.finishCallback = function(player, $state) {
          player.tweenConfig.to = initialTo;
          player.tweenConfig.from = initialFrom;
          player.tweenConfig.finishCallback = null;
          player.control.time.reverse = false;
          return player;
        }

        player.tweenConfig.duration = player.tweenConfig.duration
        player = player.init(player, true);
        player.tween.tween()
        if (player.tween.isPlaying()) {
          player.tween.pause();
        }
        player.tween.seek(jumpDict.end.time)
      }
    }

    function getResetFunc() {
      return function(player, play_after) {
        player.tween.seek(player.tweenConfig.duration);
        player.tween.dispose();
        var from = player.tweenConfig.from;
        var multiplier = player.prefs.reverseSpeed || 10;
        player.tweenConfig.from = player.tweenConfig.to;
        player.tweenConfig.to = from;
        player.tweenConfig.duration /= multiplier;
        player.control.time.duration /= multiplier;
        player.control.time.reverse = true;
        player.tweenConfig.finishCallback = function(player) {
          player.tweenConfig.to = player.tweenConfig.from;
          player.tweenConfig.from = from;
          player.tweenConfig.finishCallback = null;
          player.control.time.reverse = false;
          player.control.time.duration *= multiplier;
          player.tweenConfig.duration *= multiplier;
          return player;
        }
        player = player.init(player, true);
        player.tween.tween();
      }
    }

    function getSetFunction(player) {
      return function(property, value) {
        if (property in player.tweenConfig) {
          player.tweenConfig[property] = value;
          player.init(player, true);

        }
      }
    }



    function setPropPlayerFunctions(player) {
      player.state.propertyControls.forEach(function(prop, i) {
        player.state.propertyControls[i].player = {};
        player.state.propertyControls[i].player.play = playFunc(player.state.propertyControls[i], player);
        player.state.properties[i].player = {};
        player.state.properties[i].player.play = playFunc(player.state.propertyControls[i], player);
        player.state.properties[i].player.pause = pauseFunc(player.state.propertyControls[i], player);
        player.state.properties[i].player.reset = resetFunc(player.state.propertyControls[i], player);
        player.state.properties[i].player.stepTo = stepToFunc(player.state.propertyControls[i], player);

      })
      return player.state.propertyControls;

      function resetFunc(property, playerObj) {


        return function() {
            setAllInactive(property, player);
            property.active = true;
            playerObj = playerObj.reset(playerObj);
        }
      }

      function pauseFunc(property, playerObj) {
        return function() {
          // if (!property.active) {
              setAllInactive(property, playerObj);
              property.active = true;
            // }
            player.skip = '';

            playerObj.pause();
          }
        }

        function stepToFunc(property, playerObj) {
          return function(direction) {
            setAllInactive(property, player);
            if (!property.active) {
              property.player = true;
            }
            player.skip = '';
            property.time = playerObj.state.time
            playerObj.stepTo(direction);

          }
        }

      function playFunc(property, playerObj) {
        return function() {
          setAllInactive(property, playerObj);
          property.active = true;
          player.skip = '';
          // property.time = playerObj.state.time || property.time;
          // playerObj.play();
          // setPropPlayerFunctions();
        }
      }


      function setAllInactive(property, player) {
          player.skip = '';
          player.state.propertyControls.forEach(function(prop, i) {
            if (prop !== property) {

              if (prop.active) {
                prop.time = player.state.time;
                console.log('last time recordered before switch', prop.time)
              }
              prop.active = false;
              player.skip += prop.name + ' ';
            }
          })
      }


    }


    playerObj.init = function(playerObj, skip) {

      playerObj.state.time = 0
      playerObj.state.active = false;
      playerObj.state.paused = false;
      playerObj.state.percent= 0;
      playerObj.tween = new Tweenable();
      playerObj.tweenConfig.attachment = playerObj;
      playerObj.tweenConfig.durationFormatted = formatTime(playerObj.tweenConfig.duration, playerObj.control.time, playerObj.control.time.sigfig || 1);
      playerObj.play = getPlayFunction(playerObj);
      playerObj.pause = getPauseFunction(playerObj);
      playerObj.start = startTween;
      playerObj.stepTo = getStepToFunction(playerObj);
      playerObj.jumpTo = getJumpToFunction(playerObj);
      playerObj.reset = getResetFunc();
      playerObj.set = getSetFunction(playerObj);
      playerObj.state.propertyControls =  playerObj.state.propertyControls && setPropPlayerFunctions(playerObj);
      // playerObj.start =
      // playerObj.reverse = function(value) {tween.seek(value)};


      playerObj.inspect && $timeout(function() {
        !skip && playerObj.prefs && playerObj.prefs.playInfinite && playerObj.play();
      })
      playerObj.prefs && playerObj.prefs.startAt && playerObj.tween.seek(0).seek(playerObj.prefs.startAt.seek);
      if (playerObj.prefs) {
        elemAnimStates = playerObj.prefs.showStates(playerObj);
        playerObj.prefs.elemAnimStates = elemAnimStates
      }
      return playerObj
    }




    if (playerObj.inspect && !playerObj.inspectorInitialized) {
      playerObj.inspectorInitialized = true;
      playerObj.showProps && parseActiveProperties(playerObj, args.start, args.end, args.ease);
      $timeout(function() {

        // if (playerObj.inspectorInitialized) {
          playerObj = playerObj.init(playerObj);
          playerObj.inspectorInitialized = false;

           if (playerObj.inspect && playerObj.state.properties && playerObj.state.properties.length && playerObj.state.properties[0].control && (
              !playerObj.state.properties[0].control.ball.elem)) {

              playerObj.state.properties.forEach(function(pDict, i) {
                var ballElem = document.querySelector('#property-ball-' + i);
                var valueElem = document.querySelector('#property-value-' + i);
                var barElem = document.querySelector('#property-bar-' + i);
                var barElemWidth = barElem && barElem.getBoundingClientRect().width || playerObj.control.bar.width * .6;
                pDict.control = {ball: {elem: ballElem}, valueElem: valueElem, barWidth: barElemWidth};
                playerObj.state.propertyControls[i] = pDict.control;
              });
              // applyShowOptionPropertySpecificPlayerToTweenConfig(playerObj)
              playerObj = playerObj.init(playerObj);


            }

      }, 250)

    } else {
      playerObj = playerObj.init(playerObj);
      // console.log(playerObj.tweenConfig.easing)
    }

    return playerObj;
  }

  function getElemPlayFunction(elem, tweener) {
    return function() {
      tweener
    }
  }

  function processPropertyArgs(elem, property, arg_arr, state_name, apply_default) {
    var allTweens = TweenService.getAllEasing();
    var missing_args = [];
    var pObj = initPropertyObj();

    pObj.state_name = state_name;
    pObj.property = property;
    pObj.timingFunction = 'linear';
    if (pObj.property === 'draw') {

      // option 2
      // var pathLength = SVGService.svgShapeToPath(elem[0])[0].getTotalLength();


      var pathLength = SVGService.getTotalPathLength(elem[0])
      console.log('computing path length',  pathLength, '\n', elem[0])
      if (parseInt(arg_arr[0]) > 0) {
        arg_arr[0] = parseInt(pathLength) + ""
      }
      if (parseInt(arg_arr[1]) > 0) {
        // console.log(pathLength)
        // // var path = SVGService.svgShapeToPath(elem[0]);

        console.log(arg_arr[1])
        arg_arr[1] = parseInt(pathLength) + ""
      }
      var property = "stroke-dashoffset"
      pObj.property = property;
      console.log(pObj.property, arg_arr)
    }


    for (var i = 0; i < arg_arr.length; i++) {
      switch(i) {
        //potential start
        case (0):

          pObj.start[property] = processStartArg(arg_arr[i], property, apply_default);
          continue
        case (1):
          pObj.end[property] = processEndArg(arg_arr[i], property, apply_default) + "";
          continue
        case (2):
          pObj.duration = processDuration(arg_arr[i], property, apply_default);
          continue;
        case (3):

          pObj.ease = verifyAndProcessEaseArg(pObj, arg_arr[i], property, apply_default, allTweens.slice());
          continue;
        case (4):
            pObj.delay = processDuration(arg_arr[i], property, apply_default);
          continue;
        case (5):
            pObj.iter = processIterations(arg_arr[i], property, apply_default);
          continue;
        case (6):

            pObj.direction = processDirection(arg_arr[i], property, apply_default);

          continue;
      }
    }
    pObj.iter = pObj.iter || processIterations();
    pObj.direction = pObj.direction || processDirection();

    // pObj.iter.direction = pObj.direction
    return pObj;
  }

  function processDirection(str) {
    if (!str || !str.length) {
      str = 'f';
      return {value: str, current: 'f'};
    } else
    if (str === 'f') {
      return {value: 'f', current: 'f'};
    } else
    if (str === 'r') {
      return {value: 'r', current: 'r'};
    }
    else if (str === 'a') {
      return {value: 'a', current: 'f'};
    }
    else if (str === 'ar') {
      return {value: 'ar', current: 'r'};
    }
  }

  function processIterations(str, property, apply_default) {
    if (!str || !str.length)  return {count: 1, delay:0};
    var iterSplit = str.split('+').filter(function(s, i) {return s && s.length });
    iterSplit.forEach(function(s, i) {iterSplit[i] = parseInt(s)})
    if (!iterSplit.length) {
      iterSplit = [1, 0];
    }
    if (iterSplit.length === 1) {
      iterSplit.push(0)
    }
    return {
      count: iterSplit[0],
      delay: iterSplit[1]
    }

  }

  function processDuration(dur_str, prop, apply_default) {
    dur_str = dur_str.replace('d', '');
    if (dur_str.indexOf('ms') > -1) {
      return Math.round((parseFloat(dur_str.replace('ms', ''))/1000), 2)
    }
    else
      if (dur_str.indexOf('s') > -1) {
      return Math.round((parseFloat(dur_str.replace('', ''))*1000), 2)
    }
    else if (dur_str && dur_str.length && !apply_default) {
      return parseFloat(dur_str)
    } else if (apply_default && prop){
      return defaultPropAnimations[prop]["duration"];
    }
  }

  function verifyAndProcessEaseArg(obj, arg_str, prop, apply_default, easing_arr) {
    return arg_str
    // if (prop === 'transform') {
    //   var ease_dict = {ballControl: 'linear'};
    //   ease_dict[prop] = arg_str;
    //   return ease_dict
    // } else {
    //   return arg_str
    // }
  }

  function processEndArg(arg_str, prop, apply_default) {
    if (arg_str.trim() === '*' && apply_default) {
      return defaultPropAnimations[prop]["end"];
    } else if (arg_str && arg_str.length) {
      return arg_str;
    }
  }

  function processStartArg(arg_str, prop, apply_default) {
    arg_str = arg_str + '';
    if (arg_str && arg_str.trim() === '@') {
      return function(elem, prop) {
        return ele.style[prop];
      }
    } else if (arg_str.trim() === '*' && apply_default) {
      return defaultPropAnimations[prop]["start"];
    } else if (arg_str && arg_str.length) {
      return arg_str;
    }
  }

  function initPropertyObj() {
    return {
      property: null,
      start: {},
      end: {},
      ease: null,
      duration: 0
    }
  }

  function applyAnimationDefaultsToPropObj(p_obj) {
    if (!p_obj.fillMode) p_obj.fillMode = 'forwards';
    if (!p_obj.direction) p_obj.direction = 'normal';
    if (!p_obj.iterationCount) p_obj.iterationCount = 0;
    if (!p_obj.timingFunction) p_obj.timingFunction = 0;
    return p_obj;
  }

}

angular.module('uguru.shared.services')
    .factory('CompService', [
    '$timeout',
    '$compile',
    '$parse',
    '$rootScope',
    CompService
    ]);

function CompService($timeout, $compile, $parse, $rootScope) {
  var genOptionSpec = ['type', 'when-*', 'as*', '']
  var flexAlignMapping = {'bottom': 'flex-end', 'left': 'flex-start', 'right': 'flex-end', 'top': 'flex-start'}
  var itemSpec = [];
  var globals= {attr: {}, attrWithValue:{}, _class:{}}
  var css = initCSSObj();
  var cssDirectiveShortcuts = getCSSDirectiveShortcuts(_browser);
  var cssDefaultPropValues = getCSSDefaultPropValues(_browser);



  var platformSpecificProperties = getPlatformSpecificProperties();
  var browserPlatform;
  var specialProperties = {
    'display': 'flex'
  }
  return {
    getBaseSpec: getBaseSpec,
    getOptions: getOptions,
    getCompTemplateType: getCompTemplateType,
    getAndParseDimensions: getAndParseDimensions,
    applyDelayToWord: applyDelayToWord,
    parseSrcUrl: parseSrcUrl,
    getMediaElemOfType: getMediaElemOfType,
    renderAlign: renderAlign,
    renderAllStyleAttributes: renderAllStyleAttributes,
    initializeModalAttr: initializeModalAttr,
    globals: globals,
    css: css,
    doesElemHaveLoader: doesElemHaveLoader,
    getParentBackgroundColor: getParentBackgroundColor
  }

  function doesElemHaveLoader(child_arr) {
    var childResults = {loader:null, remaining:[]}
    for (var i = 0; i < child_arr.length; i++) {
      if (child_arr[i].nodeName.toLowerCase() === 'loader') {
        childResults.loader = child_arr[i];
        childResults.loaderIndex = i
      } else {
        childResults.remaining.push(child_arr[i])
      }
    }
    return childResults
  }

  function getParentBackgroundColor(elem) {
    console.log(elem[0].getBoundingClientRect())
    var elemParentStyle = window.getComputedStyle(elem[0].parentNode);
    if ('background' in elemParentStyle) {
      return elemParentStyle;
    }
    return  window.getComputedStyle(document.body)['background']
  }

  function isSVGElement(name) {
    name = name.toLowerCase();
    return ['path', 'g', 'rect', 'svg', 'polygon', 'line', 'circle'].indexOf(name) > -1;
  }

  function getCrossPlatformProperty(property, platform) {

    return property;
  }

  function getCSSDefaultPropValues(browser) {
    var prefixes = [];
    browser.size.tablet && prefixes.push('t');
    browser.size.mobile && prefixes.push('m');
    browser.size.orientation === 'l' && prefixes.push('l');
    browser.size.orientation === 'p' && prefixes.push('p');

    var baseProps = {
      "end": "flex-end",
      "start": "flex-start",
      "left": "flex-start",
      "right": "flex-end",
      "center": "center",
      "stretch": "stretch",
      "space-between": "space-between",
      "space-around": "space-around",
      "sA": "space-around",
      "sB": "space-between",
      "yEnd": "flex-end",
      "yStretch": "stretch",
      "yStart": "flex-start",
      "yCenter": "center",
      "xEnd": "flex-end",
      "ySpaceBetween": "space-between",
      "ySpaceAround": "space-around",
      "spaceBetween": "space-between",
      "spaceAround": "space-around",
      "ySa": "space-around",
      "ySB": "space-between",
      "row": "row",
      "rowReverse": "row-reverse",
      "column": "column",
      "columnReverse": "column-reverse",
      "rR": "row-reverse",
      "cR": "column-reverse",
      "wrap": "wrap",
      "nowrap": "nowrap",
      "wrapReverse": "wrap-reverse",
      "flex": "flex",
      "rel": "relative",
      "relative": "relative",
      "abs": "absolute",
      "absolute": "absolute",
      "static": "static",
      "fix": "fixed",
      "fixed": "fixed",
      "scrollX": "auto",
      "scrollY": "auto",
      "scrollXy": "auto",
      "noScroll": "hidden",
      "hideX": "hidden",
      "hideY": "hidden",
      "overflow": "visible",
      "oFlow": "visible",
      "scroll": "visible",
      "pointer": "pointer",
      "point": "pointer",
      "hide-scroll": "visible",
      "xStretch": "stretch",
      "uppercase": "uppercase",
      "upper": "uppercase",
      "capital": "capitalize",
      "inheritH": "inherit",
      "inheritW": "width"
    }
    prefixes.forEach(function(p) {
      var basePropKeys = Object.keys(baseProps);
      basePropKeys.forEach(function(key) {
        var preStr = camelCase(p + '-' + toDashed(key));
        baseProps[preStr] = baseProps[key];
      })
    })
    console.log(baseProps)
    return baseProps
  }

  function getPlatformSpecificProperties() {
    return {
      "flex-direction": {},
      "flex": {},
      "order": {},
      "flex-grow": {},
      "flex-shrink": {},
      "flex-wrap": {},
      "justify-content": {},
      "align-content": {},
      "align-items": {},
      "flex-basis": {},
      "flex-flow": {},
      "align-self": {}
    }
  }

  function getCSSDirectiveShortcuts(browser) {
    var prefixes = [];
    browser.size.tablet && prefixes.push('t');
    browser.size.mobile && prefixes.push('m');
    browser.size.orientation === 'l' && prefixes.push('l');
    browser.size.orientation === 'p' && prefixes.push('p');
    var baseProps = {
        'm': 'margin',
        'mX': 'margin-left margin-right',//
        'mY': 'margin-top margin-bottom',
        'mTop': 'margin-top',
        'marginTop': 'margin-top',
        'marginBot': 'margin-bottom',
        'marginBottom': 'margin-botton',
        'marginLeft': 'margin-left',
        'marginRight': 'margin-right',

        'mBot': 'margin-bottom',
        'mBottom': 'margin-bottom',
        'mLeft': 'margin-left',
        'width': 'width',
        'height': 'height',
        'mWidth': 'width',
        'mHeight': 'height',
        'mRight': 'margin-right',
        "marginX": "margin-left margin-right",
        "marginY": "margin-top margin-bottom",
        'margin': 'margin',
        'padding': 'padding',
        "p": "padding",
        'flexFlow': 'display',
        "padding": "padding",
        "margin": "margin",
        "pX": "padding-left padding-right",
        "pY": "padding-bottom padding-top",
        "pTop": "padding-top",
        "pBottom": "padding-bottom",
        'paddingBottom': 'padding-bottom',
        'paddingBot': 'padding-bottom',
        'pBot': 'padding-bottom',
        'paddingTop': 'padding-top',
        'paddingLeft': 'padding-left',
        'paddingRight': 'padding-right',
        "pLeft": "padding-left",
        "pRight": "padding-right",
        "paddingX": "padding-left padding-right",
        "paddingY": "padding-top padding-bottom",
        "basis": "display flex-basis",
        "shrink": "display flex-shrink",
        "grow": "display flex-grow",
        "order": "display order",
        "wrapReverse": "display flex-wrap",
        "wrap": "display flex-wrap",
        "nowrap": "display flex-wrap",
        "end": "display align-self",
        "start": "display align-self",
        "left": "display align-self",
        "right": "display align-self",
        "center": "display align-self",
        "stretch": "display align-content",
        "spaceBetween": "display justify-content",
        "spaceAround": "display justify-content",
        "sA": "display justify-content",
        "sB": "display justify-content",
        "xEnd": "justify-content",
        "yEnd": "display align-content align-items",
        "yStretch": "display align-content align-items",
        "yStart": "display align-content align-items",
        "yCenter": "display align-content align-items",
        "ySpaceBetween": "display align-content",
        "ySpaceAround": "display align-content",
        "ySa": "display align-content",
        "ySb": "display justify-content",
        "row": "display flex-direction",
        "rowReverse": "display flex-direction",
        "rR": "display flex-direction",
        "column": "display flex-direction",
        "columnReverse": "display flex-direction",
        "cR": "display flex-direction",
        "x": "display justify-content",
        "y": "display align-content align-items",
        "fontSize": "font-size",
        "fS": "font-size",
        "top": "position top",
        "left": "position left",
        "bottom": "position bottom",
        "right": "position right",
        "zIndex": "z-index",
        "maxHeight": "max-height",
        "maxH": "max-height",
        "minH": "min-height",
        "minW": "min-width",
        "maxW": "max-width",
        "minHeight": "min-height",
        "maxWidth": "max-width",
        "minWidth": "min-width",
        "t": "position top",
        "l": "position left",
        "r": "position right",
        "b": "position bottom",
        "radius": "border-radius",
        "rad": "border-radius",
        "bR": "border-radius",
        "o": "opacity",
        "opacity": "opacity",
        "w": "width",
        "h": "height",
        "bottom": "bottom",
        "bot": "bottom",
        "fontWeight": "font-weight",
        "fW": "font-weight",
        "flex": "display",
        "abs": "position",
        "absolute": "position",
        "relative": "position",
        "rel": "position",
        "z": "z-index",
        "border": "border",
        "borderWidth": "border-width",
        "bW": "border-width",
        "bC": "border-color",
        "borderColor": "border-color",
        "borderStyle": "border-style",
        "bS": "border-style",
        "static": "position",
        "fixed": "position",
        "fix": "position",
        "op": "opacity",
        "overflow": "overflow",
        "oFlow": "overflow",
        "hideX": "overflow",
        "hideY": "overflow",
        "scrollX": "overflow-x",
        "scrollY": "overflow-y",
        "scrollXy": "overflow-x overflow-y",
        "scrollable": "overflow-x overflow-y",
        "scroll": "overflow",
        "lineHeight": "line-height",
        "lH": "line-height",
        "lS": "letter-spacing",
        "letterSpacing": "letter-spacing",
        "pointer": "cursor",
        "point": "cursor",
        "content": "content",
        "alignItems": "align-items",
        "xStretch": "align-items",
        "uppercase": "text-transform",
        "upper": "text-transform",
        "capital": "text-transform",
        "lowercase": "text-transform",
        "lower": "text-transform",
        "inheritH": "height",
        "inheritW": "inherit"

    }
    prefixes.forEach(function(p) {
      var basePropKeys = Object.keys(baseProps);
      basePropKeys.forEach(function(key) {
        var preStr = camelCase(p + '-' + toDashed(key));
        baseProps[preStr] = baseProps[key];
      })
    })

    return baseProps;
  }

  function initCSSObj() {
    return {
      render: {
        width: renderWidthFunc,
        height: renderHeightFunc,
        general: renderGeneralFunc
      },
      apply: applyCrossPlatformCSSFunc(_browser)
    }
  }

  function applyCrossPlatformCSSFunc(browser) {
    browserPlatform = browser.engine.replace('blink', 'webkit');

    return function(element, prop, value) {

      if (prop in cssPrefixedProperties) {
        prop = formatPrefixedCSSByEngine(prop, browserPlatform);
      } else
      if (prop in cssPrefixedPropertyValues) {
        var valueFilter = cssPrefixedPropertyValues[prop];
        if (value.indexOf(valueFilter) > -1) {
          value = formatPrefixedCSSByEngine(value, browserPlatform)
        }
      }


      prop = camelCase(prop);
      if (prop === 'fontWeight') value = parseInt(value)
        // console.log(element, prop, value)
      element[0].style[prop] = value;

    }
  }

  function toDashed(str) {
    return (str.replace(/\W+/g, '-')
                .replace(/([a-z\d])([A-Z])/g, '$1-$2')).toLowerCase();
  }

  function camelCase(input) {
    return input.toLowerCase().replace(/-(.)/g, function(match, group1) {
      return group1.toUpperCase();
    });
  }


  // $timeout(function() {
  //   css.apply()
  // })

  function formatPrefixedCSSByEngine(value, browserPlatform) {
    var supportedPlatforms = ["blink", "moz", "ms", "webkit"];
    if (supportedPlatforms.indexOf(browserPlatform) > -1 ) {
      return  browserPlatform + "-" + value;
    }
    return value;
  }

  function getPlatformSpecificPropName(prop_name, browser) {
    // console.log('detected platform specific', prop_name)
    return prop_name
  }



  function renderGeneralFunc(elem, value, options) {
    var svgOnlyProps = ['x', 'y', 'width', 'height'];
    if (value.indexOf('{{') > -1) {
      value = $parse(value)(options.scope)
    }
    if (options.propName && options.propName in cssDirectiveShortcuts) {
      var propNames = cssDirectiveShortcuts[options.propName];
      if (svgOnlyProps.indexOf(options.propName.toLowerCase()) > -1 && isSVGElement(elem[0].nodeName)) {
        return;
      }
      propNames.split(" ").forEach(function(property) {

        var currentValue = value;
        if (value.length === 0 && options.propName in cssDefaultPropValues) {
          currentValue = cssDefaultPropValues[options.propName];
        }
        if (property in specialProperties) {

          currentValue = specialProperties[property]
        }

        if (property in platformSpecificProperties) {
          property = getPlatformSpecificPropName(property);
        }


        css.apply(elem, property, currentValue);
      })
    }
  }

  function renderHeightFunc(elem, value, scope) {

    if (value && !isSVGElement(elem[0].nodeName.toLowerCase())) {
        if (value.indexOf('%') === -1 && value.indexOf('px') === -1) {
          css.apply(elem, 'height', value + '%');
            // elem.css('height', value + '%')
        } else {
          css.apply(elem, 'height', value);
        }
    }
  }

  function renderWidthFunc(elem, value, scope) {
    if (value && !isSVGElement(elem[0].nodeName.toLowerCase())) {
      if (value.indexOf('%') === -1 && value.indexOf('px') === -1) {
          css.apply(elem, 'width', value + '%');
      } else {
        css.apply(elem, 'width', value);
      }
    }
    //ideal
    // var extraUnit = ((attr.width.indexOf('%')>-1 || attr.width.indexOf('px')>-1 || attr.width.indexOf('em')>-1 )&& '') || '%';
    //         var attrWidth = attr.width;
    //         ['%', 'px', 'em', 'vw', 'vh'].forEach(function(unit) {
    //             if (attrWidth.indexOf(unit) > 0) {
    //                 extraUnit = unit;
    //                 attrWidth = attrWidth.replace(unit, '')
    //             }
    //         })
    //         attrWidth = $parse(attrWidth)($rootScope);
    //         console.log(attrWidth)
    //         element.css('width', attrWidth + extraUnit);
  }

  function initializeModalAttr(p_elem, attr, _window) {
    validDirections = ['top', 'bottom', 'left', 'under'];

    // if (validDirections.indexOf(attr) > -1) {
      // 'top' in attr && p_elem.css('transform', ('translateY(-' + _window.height + 'px'))
      // 'bottom' in attr && p_elem.css('transform', ( 'translateY('+ _window.height + 'px'))
      // 'left' in attr && p_elem.css('transform', ('translateX(' + _window.width + 'px'))
      // 'right' in attr  && p_elem.css('transform', ('translateX(-' + _window.width + 'px'))
    // }

    // if (attr.linkCoordsWith && attr.linkCoordsWith.length) {
    //   scope.root.
    // }

    if (attr.name && attr.name.length) {

      var statePrecursor = 'when-modal-' + attr.name.toLowerCase() + '-requested';

      for (key in attr.$attr) {
        if (key.indexOf('when') === 0) {
          var whenStateNameContents = attr[key];

          if (key.toLowerCase().indexOf('requested')>-1) {

            if (whenStateNameContents.toLowerCase().indexOf('z-index') === -1) {
              var postAnimationStr = whenStateNameContents.split('a:[')[1];
              var animationStr = postAnimationStr.split(']')
              var newContents = "a:[" +  animationStr[0] + ',' + "z-index:-10:100:50:linear:0:1:f]" + animationStr.slice(1).join("]")
              attr.$set(key, newContents)
              console.log(attr)
            }
          }
          if (key.toLowerCase().indexOf('close')>-1) {
            if (whenStateNameContents.toLowerCase().indexOf('z-index') === -1) {
              var postAnimationStr = whenStateNameContents.split('a:[')[1];
              var animationStr = postAnimationStr.split(']')
              var newContents = "a:[" +  animationStr[0] + ',' + "z-index:100:-10:1000:linear:0:1:f]" + animationStr.slice(1).join("]")
              attr.$set(key, newContents)
            }
          }
          // console.log(whenStateNameContents)
        }
        // "when-modal-" + attr.name  + "-requested=a:[z-index:-10:100:50:linear:0:1:f]|p:[opacity:0]"
        // "when-modal-" + attr.name  + "-closed=a:[z-index:-10:100:50:linear:0:1:f]"
      }

    }

    // for (_attr in attr) {
    //   console.log(attr, _attr)
    // }
    // else if (_window.mobile) {
    //     p_elem.css('transform', 'translateY(' + _window.height + 'px)');
    // } else if (){
    //     p_elem.css('transform', 'translateY(-' + _window.height + 'px');
    // }
  }


  function renderAllStyleAttributes(elem, attr) {
    if (attr.fontWeight) {
      elem.css('font-weight', attr.fontWeight);
    }
    if (attr.border) {
      elem.css('border', attr.border);
    }
    if (attr.letterSpacing) {
      elem.css('letter-spacing', attr.letterSpacing);
    }
    if (attr.textDecoration || attr.tD) {
      elem.css('text-decoration', attr.textDecoration || attr.tD);
    }

    if ('pointer' in attr) {
      elem.css('cursor', 'pointer')
    }



    if (attr.type && attr.type === 'row') {
        elem.addClass('flex-wrap-center', 'flex-wrap')
    }

    // if (attr.width && elem[0].nodeName.toLowerCase() !== 'svg') {
    //   if (attr.width.indexOf('%') === -1 && attr.width.indexOf('px') === -1) {
    //       elem.css('width', attr.width + '%')
    //   } else {
    //       elem.css('width', attr.width)
    //   }
    // }

    // if (attr.height && elem[0].nodeName.toLowerCase() !== 'svg') {
    //     if (attr.height.indexOf('%') === -1 && attr.height.indexOf('px') === -1) {
    //         elem.css('height', attr.height + '%')
    //     } else {
    //         elem.css('height', attr.height)
    //     }
    // }

    if ((attr.layer && attr.layer.length) || (attr.depth && attr.depth.length))  {
      var intLayer = 0;
      if (attr.layer) {
          intLayer = parseInt(attr.layer);
      } else if (attr.depth) {
        intLayer = parseInt(attr.depth);
      }


      elem.css('zIndex', intLayer);
    }

    attr.align && renderAlign(elem, attr.align || 'center center');
    attr.padding && renderPadding(elem, attr.padding);
    attr.margin && renderMargin(elem, attr.margin);
    attr.fontSize && renderFontSize(elem, attr.fontSize);
    attr.bgUrl && renderBgImage(elem, attr, attr.bgUrl)
    'fixed' in attr && elem.css('position', 'fixed')
    'absolute' in attr && elem.css('position', 'absolute')
    attr.alignSelf && renderAlignSelf(elem, attr.alignSelf)
    attr.alignSelf2 && renderAlignSelf(elem, attr.alignSelf)
  }

  function renderBgImage(elem, attr, url) {
    if (url && url.length) {
      elem.css('background-image', 'url("' +  url + '")');
      !attr.bgPos && elem.css('background-position', 'center');
      !attr.bgSize && elem.css('background-size', 'cover');
    }
    if (attr.bgPos && attr.bgPos.length) {
      elem.css('background-position', attr.bgPos)
    }
  }

  function renderAlignSelf(elem, align_args) {
    var selfAlignArgSplit = align_args.split(' ');
    align_args = selfAlignArgSplit[0];
    if (selfAlignArgSplit.length > 1 && ['top', 'bottom', 'right', 'left'].indexOf(selfAlignArgSplit[1])) {
      elem.css(selfAlignArgSplit[1], 0)
    }
    if (align_args in flexAlignMapping) {
      elem.css('align-self', flexAlignMapping[align_args])
    } else {
      elem.css('align-self', align_args)
    }
  }

  function renderFontSize(elem, font_args) {
    elem.css('font-size', font_args);
  }

  function renderMargin(elem, margin_args) {
    elem.css('margin', margin_args);
  }

  function renderPadding(elem, padding_args) {
    elem.css('padding', padding_args);
  }

  function renderAlign(elem, align_args) {

    var alignArgSplit = align_args.split(' ');
    var vertArg = alignArgSplit[0];
    var horizArg = alignArgSplit[1];
    if (horizArg in flexAlignMapping) horizArg = flexAlignMapping[horizArg];
    if (vertArg in flexAlignMapping) vertArg = flexAlignMapping[vertArg];
    elem.css('display', 'flex');
    elem.css('align-items', horizArg);
    elem.css('justify-content',vertArg);
  }

  function getMediaElemOfType(type, data_url, attributes, scope, attr, element) {
    var mDict = {};
    var import_type = attr.import;
    if (type === 'img') {
      if (import_type) {
        var elem  = element[0].querySelector('[media-child]')
        console.log(elem)
      } else {
        mDict.elem = document.createElement('img');
        for (var i = 0; i < attributes.length; i++) {
          mDict.elem.setAttribute(attributes[i].name, attributes[i].value);
        }
        mDict.elem.src =  data_url;
        mDict.elem = angular.element(mDict.elem);
        mediaDict.elem.attr('u', '');
        $compile(mediaDict.elem)(scope);
        element.replaceWith(mediaDict.elem);
      }




    }
    return mDict;
  }

  function getSpacingFunctions() {
    return {

    }
  }

  function parseSrcUrl(obj_str) {
    var elem = obj_str.split('.');
  }

  function applyDelayToWord(elem, delay) {
    var elemAttr = elem[0].attributes;
    for (var i = 0; i <  elemAttr.length; i++) {
      var iValue = elemAttr[i].value;
      if (iValue && iValue.indexOf('p:[') > -1) {
        elemAttr[i].value = elemAttr[i].value + ':delay-' + delay;
      }
    }
  }

  function getAndParseDimensions(dim) {
    if (!dim) return;
    var resultDim = {rows:0, cols: 0};

    var resultDimSplit = dim.split('x')
    resultDim.rows = parseFloat(resultDimSplit[0]);
    resultDim.cols = parseFloat(resultDimSplit[1]);
    var items = [];

    if (resultDim && resultDim.rows && resultDim.cols) {
      var count = 1;
        for (var row = 0; row < resultDim.rows; row ++) {
            for (var col = 0; col < resultDim.cols; col ++) {
                items.push({
                  id: count,
                  row: row + 1,
                  col: col + 1,
                  width: 100/resultDim.cols,
                  height: 100/resultDim.rows
                });
                count++;
            }
        }
        items.forEach(function(i, index) {console.log(i)})
    }

    // console.log(dim.rows, dim.columns);
    return items;
  }


  function getCompTemplateType(element_type, type_elem) {
    return function(element, attr) {
      var type = (attr.type && (attr.type + '.')) || '';
      var defaultCompRoutes = {
        'grid': "<div class='flex-wrap-center full-xy absolute'></div>",
        'letter': "shared/templates/components/base/text/letter." + type + "tpl",
        "input": "shared/templates/components/base/inputs/text." + type + "tpl"
      }
      if (element_type && type_elem) {
        return defaultCompRoutes[element_type + '.' + type_elem]
      }
      else if (element_type && !type_elem) {

        return defaultCompRoutes[element_type]
      }
      return defaultCompRoutes[element_type]
    }
  }

  // function getOptionSpec(name) {

  // }

  function getBaseSpec(name) {
    return {
      grid: {options: ['dim', 'style'], children: ['list', 'item']},
      list: {options: ['list', 'style'], parent:'grid'},
      item: {options:['ignore', 'offset'], parent: ['grid'], types: getAllItemTypes()}
    }
  }

  function getOptions(name) {

  }

  function getAllItemTypes() {
    // return getItemTypes()
  }
}

function getItemTypes() {

}

function getCustomItems() {
  return [
    'grid'
  ]
}

function getItems() {
  return [
    'grid'
  ]
}
angular.module('uguru.shared.services')
    .factory('ViewService', [
    '$timeout',
    '$compile',
    '$parse',
    '$rootScope',
    ViewService
    ]);

function ViewService($timeout, $compile, $parse, $rootScope) {
    return {}
}
angular.module('uguru.shared.services')
.factory("EvalService", [
    "$compile",
    "$parse",
    "$interpolate",
    "$rootScope",
    EvalService
        ]);

function EvalService($compile, $parse, $interpolate, $rootScope) {
    var supportedActions = ["set", "apply", "increment", "decrement", ""]
    return {
        parseRawExpression: parseRawExpression,
        parseAndRenderExpressions: parseAndRenderExpressions,
        getExpressionTypes: getExpressionTypes,
        renderActionExpressions: renderActionExpressions
    }

    function parseAndRenderExpressions(element, scope, attr, eval_actions, context) {

        if (!scope && context.type === 'init') {
            attr.$set('evalAgain', true)
            return;
        }
        if (eval_actions.raw.indexOf('eval:[') === -1 && eval_actions.raw.indexOf('e:[') === -1) {
            return
        }
        var evalArgs = eval_actions.parsed && getEvalArgs(eval_actions.parsed);

        if (evalArgs.varName && evalArgs.action) {

            renderEvalStatement(scope, evalArgs);
        }

        // console.log(expr_str)

        // var exprTypes = getExpressionTypes(expr_str);
        // console.log(scope, )
        // var exprArr = expr_str.split(', ').join(',').split(',');
        // exprArr.forEach(function(expr, i) {
        //     exprArr[i] = parseRawExpression(expr)
        // })
        // return exprTypes;
    }

    function renderEvalStatement(scope, eval_dict) {
        if (eval_dict.delay) {
            $timeout(function() {
                renderEvalStatement(eval_dict)
            }, eval_dict.delay + 0)
            return;
        }
        // if (!('vars' in scope)) {
        //     scope.vars = {};
        // }

            // console.log($interpolate(eval_dict.value.current)(scope))
            var evalString =  eval_dict.varName + '=' + autoDetectValueType($interpolate(eval_dict.value.current)(scope), eval_dict);

            scope.$parent.$eval(evalString);
            // console.log(evalString)
            // console.log(scope.$parent.view.data.tabIndex)
        return;
    }

    function autoDetectValueType(current, dict) {
        var parsedResult = current;
        // console.log(current);
        if (!dict.type) {
            if (["true", "false"].indexOf(current) > -1) {
                dict.type = 'bool';
            } else if (parseFloat(current) !== NaN) {
                dict.type = 'num';
            } else {
                dict.type = 'string';
            }
        }
        if (dict.type === 'num') {
            parsedResult = parseFloat(current)
        }
        if (dict.type === 'bool') {
            parsedResult = (current === 'true')
        }

        return parsedResult
    }

    function getEvalArgs(eval_str) {
        var evalSplit = eval_str.split(":");
        var evalDict = {};
        evalSplit.forEach(function(arg, i) {
            if (i > 1 && (!evalDict.action || !evalDict.varName)) {
                return {};
            }
            if (!evalDict.action) {
                evalDict.action = arg;
            }
            else if (!evalDict.varName) {
                evalDict.varName = arg;
            } else if (!eval.value) {
                evalDict.value = parseEvalValue(arg)
            } else if (!eval.delay) {
                evalDict.delay = parseInt(arg);
            } else if (!eval.repeat) {
                evalDict.repeat = parseInt(arg)
            }

        })

        return evalDict;

        function parseEvalValue(str) {
            var strSplit = str.split('|');
            var type = 'num';
            if (strSplit.length > 1) {
                type = strSplit[1];
            }
            return {
                    type: type,
                    original: str,
                    current: str,
                    interpolate: str.indexOf('{{'),
                    history: [str]
                }
        }
    }

    function getExpressionTypes(scope, action_dict) {

        for (key in action_dict) {
            var actionType = key;
            actionInfo = action_dict[key];
            if (['prop', 'send', 'anim', 'eval'].indexOf(actionType) > -1) {
                renderActionExpressions(scope, actionInfo);
            }
        }
        return action_dict;
    }


    function renderActionExpressions(scope, attr, actionInfo) {
        var delayedInterpolArr = [];
        var actionInfo = angular.copy(actionInfo);
        for (key in actionInfo) {
            var actionValue = actionInfo[key];
            var actionType = typeof actionValue;

            if (actionType === "string" && actionValue.indexOf("{{") === -1) {
                continue
            }
            else if (actionType  === "string" && actionValue.indexOf('{{') > -1) {

                if (!scope) {
                    attr.$set('interpolate', true);
                    delayedInterpolArr.push(getInterpolationFunction(actionInfo, key));

                } else {

                    actionInfo[key] = $interpolate(actionValue)(scope);
                }

            } else
            if (actionType === "object") {
                for (avKey in actionValue) {
                    if (typeof actionValue[avKey] === "string" && actionValue[avKey].indexOf('{{') > -1) {

                        if (scope) {
                            // actionValue[avKey] = renderActionExpressions(scope, attr, actionValue[avKey])
                            actionValue[avKey] = $interpolate(actionValue[avKey])(scope);

                        } else {
                            attr.$set('interpolate', true);
                        }

                    }
                }

            }
        }
        if (delayedInterpolArr.length) {
            attr.$set('interpolate', true);
        }
        function getInterpolationFunction(action_info, key) {
            return function(scope) {
                action_info[key] = $interpolate(action_info[key])(scope);
            }

        }
        return actionInfo
    }





    function parseRawExpression(expr_str) {
        var result = {};
        return result;
    }
}

angular
    .module('uguru.shared.services')
    .factory('DataService', [
    '$timeout',
    '$compile',
    '$parse',
    '$rootScope',
    '$stateParams',
    '$interpolate',
    'XHRService',
    DataService
    ]);

function DataService($timeout, $compile, $parse, $rootScope, $stateParams, $interpolate, XHRService) {
  var initConfigDict = {
    vars: {},
    base_url: "",
    scripts: [],
  };
  var lib = {random: getRandomDataFuncs()}
  var dataMappings = {};
  var componentModule = baseCompModule;
  var dataCache = {views: {}}
  return {
    parseAppDataJson: parseAppDataJson,
    parseDataParams: parseDataParams,
    registerMappingFunc: registerMappingFunc,
    registerDirectives: registerDirectives,
    detectDataType: detectDataType,
    dataMappings: dataMappings,
    dataCache: dataCache,
    applyListParams: getApplyListParamsFunc($rootScope),
    initComponent: registerDOMCustomComponents,
    initNewAttrDirective: initNewAttrDirective
  }

  function getApplyListParamsFunc(root) {
    instantiateRootListFunctions(root);
    return function(list_str, root) {

      var resultStr = '';
      var listVarSplit = list_str.split(' in ');
      var list = {};
      list.var = listVarSplit[0];
      list.arr = listVarSplit[1];

      if (list.arr.indexOf(':') > -1) {

        var fullListArgsSplit = list.arr.split(']:');

        if (fullListArgsSplit.length > 1) {
          var fullListArgs = fullListArgsSplit[1].split(':');
          fullListArgs.length && fullListArgs.forEach(function(arg, i) {
            list.arr = processListArg(list, arg, i)
          })
        } else if (list.arr.split("':").length > 1) {
          var fullListArgsSplit = list.arr.split("':");
          var fullListArgs = fullListArgsSplit[1].split(':');
          fullListArgs.length && fullListArgs.forEach(function(arg, i) {
            list.arr = processListArg(list, arg, i)
          })
        }
        else {
          var listSplit = list.arr.split(':');
          var listName = listSplit[0];
          var fullListArgs = listSplit.splice(1);
          fullListArgs.length && fullListArgs.forEach(function(arg, i) {
            list.arr = processListArg(list, arg, i)
          })
        }

      }


      function processListArg(list, list_str, i) {
        var list_arr = list.arr
        if (list_str.indexOf('reverse') > -1) {
          list_arr = list_arr.replace(':reverse', '');
          list_arr = list_arr + ' | orderBy:reverse:true'
        }
        if (list_str.indexOf('filter') > -1) {
          list_arr = list_arr.replace(':filter', '')
        }
        if (list_str.indexOf('up') > -1) {
          list_arr = list_arr.replace(':up', '');
          list_arr = list_arr + ' | orderBy '
        }
        if (list_str.indexOf('down') > -1) {
          list_arr = list_arr.replace(':down', '');
          list_arr = list_arr + ' | orderBy:reverse:true'
        }
        if (list_str.indexOf('trim') > -1) {
          var sliceSplit = list_arr.split('trim(')
          var sliceStr = '';
          if (sliceSplit.length) {
            var slicePortion = sliceSplit[1].split(')')[0];

            var sliceStr = ':trim('  + slicePortion + ')';
            list_arr = list_arr.replace(sliceStr, '');;
            slicePortion = slicePortion.replace(', ', ',');
            var sliceParams = slicePortion.split(',');;
            sliceParams.length && sliceParams.forEach(function(slice_param, i) {
              sliceParams[i] = parseInt(slice_param);
            })
            if (sliceParams.length === 1) {
              list_arr = list_arr + '| limitTo:' + sliceParams[0];
            } else {
              list_arr = list_arr + '.slice(' + sliceParams[0] +  ',' + sliceParams[1] +  ')';
            }
          }

          // list_arr = list_arr + ' | orderBy:reverse:true'
        }
        return list_arr;
      }
      // console.log([list.var, list.arr].join(' in ::') + ' track by $index')
      return [list.var, list.arr].join(' in ') + ' track by $index';
    }
  }

  function instantiateRootListFunctions(root) {
    if (!('list' in root)) root.list = {};
    root.list.incrementIndexByOne = function($index) {
      return $index + 1;
    }
  }

  function detectDataType(element, data_attr) {
    var data_attr_parsed = parseDataAttr(data_attr);
    // if (typeof data_attr_parsed === 'string') {
    //   return $parse(data_attr_parsed['name'])(parsedData)
    // }
    if ('view' in data_attr_parsed && data_attr_parsed['view'] in dataCache.views) {
      var parsedData = dataCache.views[data_attr_parsed['view']];
      return {name: data_attr_parsed['name'], data: $parse(data_attr_parsed['name'])(parsedData)}
      // if (data_attr_parsed.split('.')[0] in parsedData) {

      //   // var data_attr = $parse()(parsedData);
      //   // console.log(data_attr)
      // }
    }
    console.log(data_attr_parsed, dataCache.views[data_attr_parsed.view])

  }

  function parseDataAttr(data_attr) {
      var isVar = data_attr.indexOf(".") > -1;
      if (isVar) {
        var varSplit = data_attr.split('.');
        var ptr = dataMappings;
        varSplit.forEach(function(data_var) {
          if (data_var in ptr) {
            ptr = ptr[data_var]
            data_attr = data_attr.replace(data_var, ptr["name"])
          }
        })
        var result = {view: ptr['view'], name: data_attr};
        return result;
      } else
      if (data_attr in dataMappings) {
        return dataMappings[data_attr];
      }
  }

  function camelCase(input) {
        return input.toLowerCase().replace(/-(.)/g, function(match, group1) {
            return group1.toUpperCase();
        });
  }

  function registerDOMCustomComponents(component_arr) {
    var componentLength = component_arr.children.length;
    for (var i = 0; i < componentLength; i++) {
      var component = component_arr.children[i];
      if (!component.nodeName) continue;
      var compDict = {
        name: camelCase(component.nodeName.toLowerCase()),

      }

      if ('attributes' in component) {
        var attributes = component.attributes;
        compDict.fields = getFieldsFromAttributes(attributes);
      }
      if (Object.keys(compDict.fields ).length) {
        compDict.scope = compileComponentVars({external: compDict.fields});
      }
      compDict.template = component.innerHTML
      registerOneDirective(compDict)
      // console.log('registering.. complete')
    }

    function getFieldsFromAttributes(attr_dict) {
      var _dict = {};

      for (attr_name in attr_dict) {

        var kv = attr_dict[attr_name];
        if  (kv.value) {
          var elemType = kv.value;
          _dict[kv.name] = kv.value
        }

      }

      return _dict;
    }
  }

  function registerDirectives(component_dict) {

    // for (component in component_dict) {
      var compSpec = component_dict[component];
      var templateUrl = 'template_url' in compSpec && compSpec['template_url']
      var scope = 'fields' in compSpec || {};
      var camelName = camelCase(component.toLowerCase());
      registerOneDirective(camelName, scope, templateUrl)
    // }

  }

  // function registerOneDirective(name, scope, template_url, template) {
  //   console.log()
  //    angular.module('uguru.shared.directives').directive(name, ['$compile', function($compile) {
  //     return {
  //       restrict: 'E',
  //       templateUrl: template_url || null,
  //       template: template || null,
  //       scope: _scope,
  //       replace: true,
  //       link: function(scope, element, attr) {
  //         console.log(element)
  //         // console.log(elemento)
  //       }
  //     }
  //   }])


  // }

  function registerMappingFunc(root_scope) {

    return function(attr_name, value) {
      console.log(attr_name, value)
      if (root_scope.activeView) {
        console.log(root_scope.activeView.name)
      }
    }


  }

  function initDataScopeAndConfig(data_scope) {
    if (data_scope === undefined) data_scope = {};
    if (data_scope && !('config' in data_scope)) {
      data_scope.config = JSON.parse(JSON.stringify(initConfigDict));
    }
  }

  function parseDataParams(data_scope, path_data) {


    var pathDepthsArr = path_data.split('/');
    var depthCont = pathDepthsArr.length;
    var varPtr = data_scope.config.vars;
    var pathParams = 'pathParams' in data_scope.config && data_scope.config['pathParams'];
    var depthNum = 0;

    pathDepthsArr.forEach(function(var_name) {

      var pathParamsDepth = pathParams && getPathParamVarsForDepth(pathParams, depthNum) || [];
      pathDepthsArr[depthNum] = {depth: depthNum, stateParam: var_name, values: pathParamsDepth}
      depthNum++;
    })

    return pathDepthsArr
  }

  function getPathParamVarsForDepth(vars_scope, depth) {
    var results = [];
    if (vars_scope && Object.keys(vars_scope)) {
      for (key in vars_scope) {
        if (vars_scope[key] === depth) {
          results.push(key)
        }
      }
    }
    return results;
  }

  function executeExternalScripts(data_scope) {
    var script_scope = data_scope.config.scripts
    var baseURL = 'base' in script_scope && script_scope.base ||'';
    if ('queue' in script_scope && script_scope.queue.length) {
      script_scope.queue.forEach(function(single_script_dict, i) {
        single_script_dict.base_url = baseURL
        fetchAndOrganizeExternalJson(data_scope, single_script_dict);

      })
    }
  }

  function fetchAndOrganizeExternalJson(data_scope, script_info) {

    var url = script_info.base_url  + script_info.path;
    var name = script_info.name || '';
    XHRService.getJSONFile('GET', url, generatePostExternalScriptCallback(data_scope, name, script_info), {})
  }

  function generatePostExternalScriptCallback(data_scope, name, script_info) {
    // console.log(mapping)
    if (!('content') in data_scope) data_scope.content = {};
    if (!name || !name.length) {
      name = 'param' - (i+1)
    }
    data_scope.config.processed.scripts = {};
    data_scope.config.processed.scripts[name] = false;

    return function(response) {
      if (script_info.mapping) {
        mapPostDataToDataScope(data_scope, response, script_info.mapping)
      } else if (script_info.mappings) {
        script_info.mappings.forEach(function(mapping) {
          mapPostDataToDataScope(data_scope, response, mapping)
        })
      }




      checkExtScriptStatus(data_scope)

      if ('parse' in data_scope.config) {
        applyAndUpdateParseData(data_scope, data_scope.config.parse)
      }

      data_scope.config.processed.scripts[name] = true;

    }
  }

  function applyAndUpdateParseData(scope, parse_fields) {
    for (key in parse_fields) {
      console.log(key, parse_fields[key][0], $parse(parse_fields[key][0])(scope));
    }
  }

  function mapPostDataToDataScope(source, incoming, spec) {
    // source['content'][spec.name] = incoming;
    if ('from' in spec) {
      var incomingFormatted = retrieveDataFromNestedPath(incoming, spec);
      if (incomingFormatted) {
        incoming = incomingFormatted
      }
    }
    if ('to' in spec) {
      setDataToNestedPath(source, incoming, spec)
    }

    if(!('to' in spec) && !('from' in spec)) {
      source['content'][name] = incoming;
    } else  if (!('to' in spec) && !('from' in spec) && !('name' in spec)){
      source['unknown-' + (new Date().getTime() + "")] = incoming;
    }
  }


  function retrieveDataFromNestedPath(incoming, spec) {

    if ('from' in spec)  {
      var path = spec.from.split('.');
      var ptr = incoming;
      var nestingNumber = 0;
      var lastVarName;
      var resp = $parse(spec.from)(incoming);
      if (typeof resp === 'object') {
        return resp;
      }


    }
  }

  function setDataToNestedPath(source, incoming, spec) {
    // console.log(source, incoming, spec)
    if ('to' in spec)  {
      var path = spec.to.split('.');
      var ptr = source;
      var nestingNumber = 0;
      var lastVarName;
      var previousPtr;
      path.forEach(function(var_name) {
        nestingNumber += 1;
        if (var_name in ptr) {
          previousPtr = ptr;
          ptr = ptr[var_name]
          // console.log(nestingNumber, var_name, ptr)
        } else {
          ptr[var_name] = {};
          previousPtr = ptr;
          ptr = ptr[var_name]
        }
        lastVarName = var_name
      })
      previousPtr[lastVarName] = incoming



    }
  }



  function checkExtScriptStatus(data_scope) {

    var script_scope = data_scope.config.processed.scripts;

    if (!('scriptStatus' in data_scope.config.processed)) {
      data_scope.config.processed.scriptStatus = {
        remaining: Object.keys(script_scope).length,
        total: Object.keys(script_scope).length,
        complete: false
      }
    }
    var numFalse = 0;
    var count = 0;

    for (key in script_scope) {

      if (key in script_scope && !script_scope[key]) {
        numFalse++;
      }
      count ++;
    }

    if (numFalse) {
      data_scope.config.processed.scriptStatus = {
        remaining: numFalse,
        total: count,
        complete: false
      }
      $timeout(function() {
        checkExtScriptStatus(data_scope)
      }, 100)

    }
    else {

      if ('complete' in data_scope.config.processed.scriptStatus) {
        data_scope.config.processed.scriptStatus.complete = true;
      } else {
        data_scope.config.processed.scriptStatus = {complete: true};
      }
    }
  }

  function parseAppDataJson(data_scope) {
    // init
    initDataScopeAndConfig(data_scope);
    data_scope.config.processed = {};

    // init

    if ('path' in $stateParams) {
      data_scope.config.processed.path = parseDataParams(data_scope, $stateParams.path)
    }



    if ('scripts' in data_scope.config) {
      executeExternalScripts(data_scope);
    }
    if ('components' in data_scope) {
      compileComponentsIntoDirectives(data_scope.components)
      if (!$rootScope.components) {
        $rootScope.components = {};
      }
      for (compName in data_scope.components) {
        $rootScope.components[compName] = data_scope.components[compName]
      }
    }
  }

  function compileComponentsIntoDirectives(comp_dict) {

    for (key in comp_dict) {
      var dirInfo = {
        name: key.replace(/-(\w)/g, function(match) {
          return match[1].toUpperCase();
          }),
        templateUrl: 'template_url' in comp_dict[key] && comp_dict[key]['template_url'],
        scope: compileComponentVars(comp_dict[key]['data']),
        config: 'config' in comp_dict[key] && comp_dict[key]['config']
      };
      if (dirInfo.name && dirInfo.templateUrl) {
        registerOneDirective(dirInfo)
      }
    }
    // baseCompModule.directive('vizBar', ['$rootScope',function($rootScope) {
    //   return {
    //     restrict: 'E',
    //     replace:true,
    //     scope: {
    //         'animationType': '=animationType'
    //     },
    //     templateUrl: function(element, attr) {
    //         return $rootScope.components[element[0].nodeName.toLowerCase()]['template_url']
    //     }
    //   }
    // }])
  }

  //todo eventually: variable service
  function compileComponentVars(vars) {
      if (!vars) return false;
      if (!('external' in vars)) return;
      var resultScope = {};
      vars.external = parseScopeVarsByType(vars.external)
      for (var_name in vars.external) {
        if (['dict'].indexOf(vars.external[var_name]) > -1) {
          resultScope[var_name] =  '<' + var_name;
        }
        else if (vars.external[var_name] === 'var') {
          resultScope[var_name] = '=' + var_name;
        } else {
          resultScope[var_name] = '@' + var_name;
        }
      }
      if (!Object.keys(resultScope).length) return false;

      return resultScope;
  }

  function parseScopeVarsByType(var_dict) {
    for (_var_name in var_dict) {
      var value = var_dict[_var_name];
    }
    return var_dict;


  }

  function registerOneDirective(dir_info) {

    componentModule.directive(dir_info.name, ['ElementService', function(ElementService) {
      var dirObj = {
        restrict: 'E',
        scope: dir_info.scope,
        replace:true,
        transclude:true,
        priority:100,
        templateUrl: dir_info.template_url && function(element, attr) {
            return dir_info.templateUrl
        },
        template: function(element, attr) {
          var e = angular.element(dir_info.template);
          if (e[0].outerHTML) {
            e.removeAttr('u');
          // e.removeAttr('ngRepeat');
            attr.$set('u', '');
            return e[0].outerHTML
          } else {
            element[0].removeAttribute('u')
            element.removeAttr('u');
            // attr.$set('u', '');
            return element[0].outerHTML
          }

          console.log(dir_info.template);

        },
        controller: function($element, $transclude, $scope, $attrs) {
          $scope.public = $scope.$parent.public;
          $scope.root = $scope.$parent.root;
          // console.log($attrs.whenTabIndexChanged)
          this.states = ElementService.renderElementStates($element, $attrs);
          if (this.states.init) {
            this.states.init.forEach(function(state, i) {

              if (state.name === 'init' && state.type === 'on') {
                states.on.push(state);
              } else if (state.exec && state.name !== 'after') {
                // console.log(state.name)
                state.exec($element, null, $attrs)
              }
            })
          }
          if (this.states.on) {
            this.states.on.forEach(function(state, i) {
              state.exec($element, $scope, $attrs);
            })
          }
          // this.innerElem = $transclude($scope);
          // console.log($transclude(function(elem, scope) {
          //   console.log(elem[0])
          // }))
          // console.log($attrs)
          $attrs.$set('u', '');
          // var e = $compile($element)($scope);



          // console.log(e)
          // $element.css('display', 'initial');
          // $element.replaceWith(e)

          // console.log(e[0])



          // console.log($transclude(function(element, scope) {console.log(element[0])}).contents())
        },
        compile: function(c_elem, attr) {

          return {
            pre: function preLink(scope, element, attr, ctrl, tr) {
              // $compile(element)(scope);

              // c_elem.css('display', 'block');
              // console.log(tr()[0], element.children()[0])
              // console.log($compile(element.html())(scope));
            },
            post: function postLink(scope, element) {
              // console.log(scope.states)
            }
          }
        }

      }
      return dirObj
    }])
  }

  function initNewAttrDirective(options) {
    var dirName = camelCase(options.pre + '-' + options.postdash);
    var valueSplit = options.value.indexOf(';') > -1 && options.value.split(';') || options.value.split(':');
    var cssArr = [];

    if (valueSplit.length > 1) {
      valueSplit.forEach(function(val) {
        var css = {};
        var valSplit = val.split(':')
        css.key = valSplit[0];
        css.value = valSplit[1];
        cssArr.push(css);
      })


    }
    // console.log(valueSplit, dirName)
      componentModule.directive(dirName, ['ElementService', function(ElementService) {
      var dirObj = {
        restrict: 'A',
        scope: false,
        replace:true,
        priority:100,
        compile: function(element, attr) {
          cssArr && cssArr.forEach(function(css) {
            element.css(css.key, css.value);
          })

        }
      }
      return dirObj;
    }])
  }

  function processScopeVars(scope, attr) {

    for (attr_name in attr.$attr) {
      if (attr_name in scope) {
        if (typeof scope[attr_name] === 'function') {
          scope[attr_name] = scope[attr_name]()
        }
        detectScopeType(scope[attr_name])
      }
    }
  }

  function detectScopeType(var_data) {
    if (isArray(var_data)) {

    } else
    if (isObject(var_data)) {

      var_data.titles = [];
      var_data.arr = [];
      for (key in var_data) {
        if (['titles', 'arr'].indexOf(key) > -1) continue;
        var innerObj = {}
        innerObj.name = key;
        innerObj.contents = var_data[key];
        var_data.arr.push(innerObj)
        var_data.titles.push(key + "")
      }

      // var_data.titles =  titles.slice()
      // var_data.arr = innerObjects.slice()

      return var_data
    }
    function isObject ( obj ) {
       return obj && (typeof obj  === "object");
    }

    function isArray ( obj ) {
      return isObject(obj) && (obj instanceof Array);
    }
  }

  function getRandomDataFuncs() {
    return {
      lorem:generateRandomLoremIpsum
    }

    function generateRandomLoremIpsum(word_length) {
      return loremChunk.split(' ').slice(0, word_length).join(" ");
    }
  }


  function mapDataFromOneSourceToMain(data_scope) {





  }
}

function generateDataSet(type, length, min, max) {


  function generateRandomDataSet() {

  }

  function generateLoremIpsumDataSet() {

  }
}




var loremChunk = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Eaedem res maneant alio modo. Ut optime, secundum naturam affectum esse possit. Disserendi artem nullam habuit. Apud imperitos tum illa dicta sunt, aliquid etiam coronae datum; Quorum altera prosunt, nocent altera. Videamus animi partes, quarum est conspectus illustrior; Ex ea difficultate illae fallaciloquae, ut ait Accius, malitiae natae sunt. Quae cum dixisset paulumque institisset, Quid est? Nunc agendum est subtilius. Aperiendum est igitur, quid sit voluptas; Quis est tam dissimile homini. Inde sermone vario sex illa a Dipylo stadia confecimus. Verum tamen cum de rebus grandioribus dicas, ipsae res verba rapiunt; Ex ea difficultate illae fallaciloquae, ut ait Accius, malitiae natae sunt. Sed vos squalidius, illorum vides quam niteat oratio. Non dolere, inquam, istud quam vim habeat postea videro; In schola desinis. Qui est in parvis malis. Nondum autem explanatum satis, erat, quid maxime natura vellet. Et ille ridens: Video, inquit, quid agas; Miserum hominem! Si dolor summum malum est, dici aliter non potest. An vero, inquit, quisquam potest probare, quod perceptfum, quod. Quae qui non vident, nihil umquam magnum ac cognitione dignum amaverunt. Incommoda autem et commoda-ita enim estmata et dustmata appello-communia esse voluerunt, paria noluerunt. Dic in quovis conventu te omnia facere, ne doleas. Habent enim et bene longam et satis litigiosam disputationem. Non dolere, inquam, istud quam vim habeat postea videro; Nec vero alia sunt quaerenda contra Carneadeam illam sententiam. Duo Reges: constructio interrete. At modo dixeras nihil in istis rebus esse, quod interesset. Nam ista vestra: Si gravis, brevis; Ergo, si semel tristior effectus est, hilara vita amissa est? Aliter homines, aliter philosophos loqui putas oportere? Atqui iste locus est, Piso, tibi etiam atque etiam confirmandus, inquam; Etenim semper illud extra est, quod arte comprehenditur. Etenim semper illud extra est, quod arte comprehenditur. Quae diligentissime contra Aristonem dicuntur a Chryippo."
angular.module('uguru.shared.services')
.factory("ElementService", [
    '$timeout',
    '$state',
    'UtilitiesService',
    'DirectiveService',
    'AnimationFrameService',
    '$window',
    'RootService',
    'SVGService',
    '$parse',
    'SendService',
    'TweenService',
    '$compile',
    'CompService',
    'KeyboardService',
    'EvalService',
    'ScrollService',
    ElementService
        ]);

function ElementService($timeout, $state, UtilitiesService, DirectiveService, AnimationFrameService, $window, RootService, SVGService, $parse, SendService, TweenService, $compile, CompService, KeyboardService, EvalService, ScrollService) {
      var rShortcuts = {special: getSpecialAnimShortcuts(), animations:null, propValues: {}, props: {}, values:{}};
      var stateShortcuts = {};
      var rAnimations;
      var stateTypes = ['on', 'when', 'init'];
      var delayMatchStr =  ['delay-', 'd-', 'd', '+'];
      var onStateMappings = {
        'init': 'ready'
      }
      var player;

      return {
        renderElementStates: renderElementStates,
        renderState: renderState,
        getShortcutDict: getShortcutDict,
        addShortcuts: addShortcuts,
        launchExternalWindow: launchExternalWindow,
        toCamelCaseBridge: UtilitiesService.camelCase,
        renderAnimationStr: applyAnimArgs,
        constructImportUrlFromObj: UtilitiesService.constructImportUrlFromObj,
        initGraphicElement: initElement,
        applySendAnimPropEval: applySendAnimPropEval,
        filterVarStates: filterVarStates,
        registerVarStates: registerVarStates,
        getInternalDelay: getInternalDelay
      }




      function registerVarStates(scope, elem, attr, state_arr) {

        if (!('watchers' in scope)) {
          scope.watchers = {};
        }


        state_arr.forEach(function(state) {
          var varNameFull = state.name.replace('var-', '');
          var varNameSplit = varNameFull.split('-');
          var varNameLeft;
          if (varNameSplit.length > 1) {
            var isIndex = varNameSplit.indexOf('is');
            var isntIndex = varNameSplit.indexOf('isnt');
            var changesIndex = varNameSplit.indexOf('changes');
            var trueIndex = varNameSplit.indexOf('true');




            if (isIndex > -1) {

              varNameLeft = camelCase(varNameSplit.slice(0, isIndex).join("-").toLowerCase());
            } else if (isntIndex > -1) {
              varNameLeft = camelCase(varNameSplit.slice(0, isntIndex).join("-").toLowerCase());
            } else if (changesIndex > -1) {
              varNameLeft = camelCase(varNameSplit.slice(0, changesIndex).join("-").toLowerCase());
            } else if(trueIndex > -1) {
              varNameLeft = camelCase(varNameSplit.slice(0, changesIndex).join("-").toLowerCase());
            }


              if (!(varNameLeft in scope.watchers)) {

                scope.watchers[varNameLeft] = {
                  values: {is: [], isnt: [], changes: [], isTrue: false, isFalse: false},
                  watcher: null
                }
              }
              if (trueIndex) {
                scope.watchers[varNameLeft].values.isTrue = true;
              }
              if (isIndex > -1) {
                var varNameRight = varNameSplit.slice(isIndex + 1, varNameSplit.length).join('-').toLowerCase()
                var value = varNameRight in scope && scope[varNameRight] || varNameRight;
                if (varNameRight === 'true') {
                  value = true;
                }
                if (varNameLeft === 'false') {
                  value = false;
                }
                scope.watchers[varNameLeft].values.is.push(
                {
                  value: value,
                  state: state
                })
              }
              if (isntIndex > -1) {
                var varNameRight = varNameSplit.slice(isntIndex + 1, varNameSplit.length).join('-').toLowerCase()
                var value = varNameRight in scope && scope[varNameRight] || varNameRight;
                scope.watchers[varNameLeft].values.isnt.push(
                {
                  value: value,
                  state: state
                })
              }

              if (changesIndex > -1) {

                var varNameRight = varNameSplit.slice(changesIndex + 1, varNameSplit.length).join('-').toLowerCase()
                scope.watchers[varNameLeft].values.changes.push(
                {
                  value: varNameRight in scope && scope[varNameRight] || varNameRight,
                  state: state
                })
              }
              if (!scope.watchers[varNameLeft].watcherName) {
                // console.log('it gets here', varNameLeft)

                if ('vars' in scope && (varNameLeft in scope.vars) || (scope.$parent && 'vars' in scope.$parent && varNameLeft in scope.$parent.vars)) {
                  scope.watchers[varNameLeft].watcherName =  'vars.' + varNameLeft.trim()
                } else {
                  scope.watchers[varNameLeft].watcherName =  varNameLeft.trim()
                }


                scope.watchers[varNameLeft].watcher = scope.$watch((scope.watchers[varNameLeft].watcherName + ''), function(value) {
                  if (value === true) {
                    console.log(value)
                  }
                  // console.log(value, scope.watchers[varNameLeft].values)
                  scope.watchers[varNameLeft].values.is && scope.watchers[varNameLeft].values.is.forEach(function(is_obj, i) {

                    if (is_obj.value === value) {

                      applySendAnimPropEval(scope, elem, is_obj.state.actions, attr);
                      // is_obj.state.exec(scope, elem, );
                    }
                  })
                  scope.watchers[varNameLeft].values.isnt && scope.watchers[varNameLeft].values.isnt.forEach(function(isnt_obj, i) {
                    if (isnt_obj.value !== value) {
                      applySendAnimPropEval(scope, elem, isnt_obj.state.actions, attr);
                    }
                  })
                  scope.watchers[varNameLeft].values.changes && scope.watchers[varNameLeft].values.changes.forEach(function(c_obj, i) {

                      var actionCopy = {}
                      for (key in c_obj.state.actions) {
                        actionCopy[key] = {}
                        for (nested_key in c_obj.state.actions[key]) {
                          if (nested_key === 'delays') {
                            actionCopy[key]['delays'] = c_obj.state.actions[key][nested_key]
                            continue;
                          }
                          if (c_obj.state.actions[key][nested_key].indexOf('{{') > -1) {
                            var splitActionArgs = c_obj.state.actions[key][nested_key].split('{{');
                            var resultStr = ''

                            splitActionArgs.forEach(function(compile_str, i) {
                              if (compile_str.indexOf('}}') > -1) {
                                var compiledStrSplit = compile_str.split('}}');
                                console.log(compiledStrSplit[0]);
                                compiledStr = $parse(compiledStrSplit[0])(scope);
                                resultStr += compiledStr + (compiledStrSplit.length > 1 && compiledStrSplit[1] || '');
                              } else {
                                resultStr += compile_str
                              }
                            })

                            actionCopy[key][nested_key] = resultStr;
                          } else {
                            actionCopy[key][nested_key] = c_obj.state.actions[key][nested_key]
                          }
                        }
                      }
                      applySendAnimPropEval(scope, elem, actionCopy, attr);

                  })

                })
              }
            }
        })
        // scope.watchers['activeTab'].watcher

        // for (key in scope.watchers) {

        //   console.log('registering', key, scope.$id)
        //   registerWatcher(key + "")
        // }
        // function registerWatcher(var_name) {
        //   var varName = 'vars.' + var_name
        //   scope.$watch(varName, function(value) {
        //       console.log(value)
        //   })
        // }




      }

      function filterVarStates(states) {
        if (!states) return [];
        return states.filter(function(when_state) {
          return ('name' in when_state) && when_state.name.indexOf('var') === 0;
        })
      }

      function initElement(obj_url) {
        var objUrlSplit = obj_url.split(':')
        var type = objUrlSplit[0];
        var objUrl = objUrlSplit[1]
        var url = UtilitiesService.constructImportUrlFromObj(objUrl, type).replace('components/components/', 'components/');
        var elem = angular.element('<graphic></graphic>')
        elem.attr('src', "" + url + "");
        elem.css('height', '25%')
        elem.css('width', '25%')
        return elem
      }

      function launchExternalWindow(params, element) {
        var anim_string = params;
        if (anim_string.indexOf('[') > -1) {
          anim_string = params.split('[')[1].split(']')[0];
        }

        var base_url = '/#/admin/api/animations/prop/';
        var anim_strings = [];
        anim_string.split(',').forEach(function(a, i) {
          anim_strings.push(a.split(':')[0] + ':' + a.split(':').splice(1).join(","))
        });
        base_url = base_url + anim_strings.join('+');

        var elemNodeName = element[0].nodeName.toLowerCase();
        base_url += '?template=shared:components.svg.logo.guru-head.html&autoPlay=true&select=svg'
        $window.open(base_url, '_blank');

      }

      function addShortcuts(prefix, shortcuts, attr) {

        var shortCutArr = [];
        shortcuts.forEach(function(child, i) {
          child.nodeName !== '#text' && parseShortcut(prefix, child.attributes);
        });
      }

      function parseShortcut(prefix, attr) {
        var terms =['replace', 'with']
        // var resultDict = {};
        if (! (prefix in rShortcuts)) {
          rShortcuts[prefix] = {};
        }

        resultDict = rShortcuts[prefix];

        if (!prefix || !prefix.length) prefix = 'root';

        var withIndices = [];
        for (var i = 0; i < attr.length; i++) {
          var iAttr = attr[i];

          if (iAttr.name === 'with') {
            withIndices.push(i);
            continue;
          }
          if (terms.indexOf(iAttr.name) === -1 && withIndices.length) {
            if (iAttr.value.length) {
              switch (iAttr.name) {
                case ("prop-value"):
                  resultDict[attr[i-2].name] = iAttr.value;
                  rShortcuts.propValues[attr[i-2].name] = iAttr.value;
                  break;
                case ("props"):
                  resultDict[attr[i-2].name]  = iAttr.value;
                  rShortcuts.props[attr[i-2].name] = iAttr.value;
                  break;
                case ("values"):
                  resultDict[attr[i-2].name]  = iAttr.value;
                  rShortcuts.values[attr[i-2].name] = iAttr.value;
                  break;
              }

            } else {
              resultDict[iAttr.name] = attr[i-2].name;
            }
          }
        }

      }

      function renderElementStates(element, attr) {
        var states = {}

        for (var key in attr.$attr) {
          var stateObj = renderState(element, attr.$attr[key], attr[key], key)

          if (!stateObj) continue;
          if (!(stateObj.type in states)) states[stateObj.type] = [];
          states[stateObj.type].push(stateObj);
        }
        // states.init && states.init.length && console.log(states.init[0])
        return states
      }

      function renderState(elem, name, value, name_camel) {
        var state = {type: null, nameCamel: '', name: {camel: name_camel, dash:name}};
        state.type = detectStateType(name, name_camel);
        if (!isValidState(state.type)) return;
        var parsedArgs = getParsedArgsByType(elem, state.type, name.split('-').splice(1), value)
        state.name = parsedArgs[state.type];

        state.actions = parsedArgs.actions;

        state.nameCamel = parsedArgs.fullNameCamel;
        state.exec = getStateFunc(state.type, state.name, parsedArgs.actions, rShortcuts);
        return state;
      }

      function isValidState(type) {
        return stateTypes.indexOf(type) > -1;
      }

      function loadAnimations() {
        if (!RootService.animations.customShortcuts) {
          return false;
        }
        if (!rShortcuts.animations || !rShortcuts.animations.customShortcuts || !RootService.animations) {
          rAnimations = RootService.animations;
          rShortcuts.cssPropValues = RootService.animations.customShortcuts.cssPropValues;
          rShortcuts.cssProps = RootService.animations.customShortcuts.cssProps;
          rShortcuts.cmds = RootService.animations.customShortcuts.cmds;
          rShortcuts.args = RootService.animations.customShortcuts.args;
        }
      }

      function getStateFunc(type, name, actions, shortcuts) {
        var context = {name: name, type: type}
        // console.log(shortcuts)
          if (type === 'init' && name == 'with') {
            return function(element, scope, attr) {
              shortcuts = shortcuts || RootService.animations;
              rShortcuts.animations = shortcuts;
              if (!rShortcuts.animations && rShortcuts.animations.customShortcuts) {
                rAnimations = RootService.animations;
                rShortcuts.cssPropValues = RootService.animations.customShortcuts.cssPropValues;
                rShortcuts.cssProps = RootService.animations.customShortcuts.cssProps;
                rShortcuts.cmds = RootService.animations.customShortcuts.cmds;
                rShortcuts.args = RootService.animations.customShortcuts.args;
              } else if (!rShortcuts.animations.customShortcuts) {
                $timeout(function() {
                  getStateFunc(type, name, actions);
                  // scope.$apply();
                });
              }
              // registerAnimationListeners(scope, element, attr, actions, context);
              // console.log(console.log(actions.eval))
              applySendAnimPropEval(scope, element, actions, attr, context);
              // applyPropsToElement(element, actions.prop, rShortcuts);
            }
          }
          if (type === 'on') {

            return function(element, scope, attr) {


              applyOnToElement(scope, element, attr, actions, context);
            }
          }
          if (type === 'when') {

            return function(element, scope, attr, updated_actions) {
              console.log(element.scope())
              applySendAnimPropEval(element.scope(), element, actions||updatedActions, attr, context);
            }
          }
      }

      function parseDelayFromState(key, action_dict) {

        var delayDict = action_dict && action_dict.delays;
        if (!action_dict) return;
        var extStrToParseSplit = action_dict['raw'] && key in action_dict['raw'] && action_dict['raw'][key].split(']:');
        if (!delayDict) {
          delayDict = {external: 0, internal: 0};
        }
        if (extStrToParseSplit && extStrToParseSplit.length > 1) {
          delayDict.external = getExternalDelay(':' + extStrToParseSplit[1], delayMatchStr);
        }
        var intStrToParseSplit = action_dict['raw'] && key in action_dict['raw'] && action_dict['raw'][key].split(']')[0].split('[')[1];
        delayDict.internal = getInternalDelay(key, intStrToParseSplit, delayMatchStr)

        if (key === 'send') {
          action_dict.delays[key] = delayDict;
        }

      }

      function getInternalDelay(key, int_str, delay_match_strs) {
          //to refactor

          if (!rShortcuts || !rShortcuts.cmds) {
            var animStatus = loadAnimations();
            if (!rShortcuts || !rShortcuts.cmds || !animStatus) {
              $timeout(function() {
                getInternalDelay(key, int_str, delay_match_strs)
              })
              return;
            }
          }
          if (int_str in rShortcuts.cmds) {
            int_str = rShortcuts.cmds[int_str]
          }
          int_str = UtilitiesService.replaceAll(int_str, ', ', ',');
          int_str = int_str.split('[')[1];
          int_str = int_str.split(']')[0];
          var result = {};
          var argTypeStr = {'a': 'anim', 's': 'send', 'p': 'prop', 'e': 'eval'};
          if (key.length === 1) {
            key = argTypeStr[key]
          }
          if (key === 'send' || argTypeStr[key] === 'send') {

            var msgArr = int_str.split(',');
            msgArr.forEach(function(msg, i) {
              if (msg.split(':').length > 2) {

                var msgSplit =msg.split(':')
                var msgName = msgSplit[0];
                // console.log(msgName)

                var delay = msgSplit[2];
                //staggers
                result[msgName] = parseInt(delay);
                if (!result[msgName] && delay.indexOf('-') > -1) {
                  result[msgName] = 0;
                  var staggerSplit = delay.split('-');
                  var easeFunc = staggerSplit[0];
                  var duration = parseInt(staggerSplit[1]);

                  if (easeFunc.length > -1 && duration) {

                    var staggerDelays = [];
                    if (!result.stagger) {
                      result.stagger = {};
                    }

                    result.stagger[msgName] = {ease: easeFunc, duration: duration, delays:[]}
                    // console.log('stagger detected for', msgName, result.stagger[msgName])
                  }
                }
              }
            })
          }
          return result;
        }

        function getExternalDelay(ext_str, delay_match_strs) {
          if (!delay_match_strs) {
            delay_match_strs = ['delay-', 'd-', 'd', '+'];
          }
          var result = 0;
          var extArgs = ext_str.split(':').filter(function(arg, i) {return arg && arg.length});

          extArgs.forEach(function(e_arg, i) {

            delay_match_strs.forEach(function(d, j) {
              if (e_arg.indexOf(d) > -1 && !result) {

                var strDelay = e_arg.replace(d, '');
                result = parseInt(strDelay);
              }
            })
          })

          return result || 0;
        }

      function applyOnToElement(scope, element, attr, actions, context) {
        var name = context.name;
        if (name === 'init' || typeof(name) === 'object' && name.indexOf('init') > -1) {
          // registerAnimationListeners(scope, element, attr, actions, context)

          element.ready(function(e) {

            applySendAnimPropEval(scope, element, actions, attr, context);
          })
        }

        else if (typeof(name) === 'object' && name.indexOf('key') > -1) {
          if (name.length > 1 && name[1] === 'press') {
            name[1] = 'down'
          }
          scope.validKeys = attr.acceptKeys || 'abcdefghijklmnopqrstuvwxyz';
          var specialKeys = {'space': 32}
          //keyboardservice
          scope.$on('key' + name[1], function(onEvent, keypressEvent) {
            var charPressed = KeyboardService.keyMap.toChar[keypressEvent.which];
            charPressed = charPressed && charPressed.toLowerCase() || '';
            if (scope.validKeys.indexOf(charPressed) > -1 ) {
              console.log('sending...')
              applySendAnimPropEval(scope, element, actions, attr, context);
            }
          });
        }
        else {
          if (name && name[0] === 'scroll' && actions.anim) {
            if (name.length > 1) {
              context.streamOnly = true;
              var stream = applyAnimArgs(element, scope, actions.anim.parsed, context);
              var args = name.length > 2 && name.slice(2);
              ScrollService.linkScrollStateToContainer(name[1], element, stream, args);
            }
          } else {
            element.on(name,function(e) {
            // delete actions['send']
              applySendAnimPropEval(scope, element, actions, context)
            })
          }
          // registerAnimationListeners(scope, element, attr, actions, context)
        }
      }

      function applySendAnimPropEval(scope, element, actions, attr, context, cb) {
          if (!actions) return;

          // console.log(actions.prop)
          if (actions.eval) {
            EvalService.parseAndRenderExpressions(element, scope, attr, actions.eval, context);
          }
          actions = EvalService.renderActionExpressions(scope, attr, actions);




          if (actions.prop) {
            if ('prop' in actions.prop.delays) {
              $timeout(function() {
                applyPropsToElement(element, actions.prop.parsed, actions.prop.delays);
              }, actions.prop.delays.external)
            } else {
              applyPropsToElement(element, actions.prop.parsed);
            }
          };
          if (actions.anim) {
            actions.anim.parsed = condenseAnimationsAndShortcuts(scope, actions.anim.parsed.replace(':delay-0', ''));

            if ('anim' in actions.anim.delays && actions.anim.delays > 0) {
                var animStrSplit = (actions.anim.parsed + "").split(',');
                var animArr = [];
                animStrSplit.forEach(function(single_anim, j) {
                  var singleAnimSplit = single_anim.split(':');
                  if (singleAnimSplit.length < 8) {
                    singleAnimSplit[3] = parseFloat(singleAnimSplit[3]) + actions.anim.delays.external;
                  } else {
                    singleAnimSplit[5] = parseFloat(singleAnimSplit[5]) + actions.anim.delays.external;
                  }
                  animArr.push(singleAnimSplit.join(':'));
                })
                actions.anim.parsed = animArr.join(",")
            }
            $timeout(function() {
              applyAnimArgs(element, scope, actions.anim.parsed, context);
            })
          }

          if (actions.send) {

            SendService.applySendArgs(element, scope, actions.send.parsed, actions.send.delays, rShortcuts, context)
          }
          cb && cb();
      }

      function condenseAnimationsAndShortcuts(scope, animations) {

        var cAnimations = [];
        var defaultAnimMappings = {'scale:': ['scaleX', 'scaleY']};
        var extraDelay = '';
        animations.split(',').forEach(function(anim, index) {
          extraDelay = anim.split(':delay-')[1] || '';
          if (extraDelay) {
            extraDelay = ':delay-' + extraDelay
            anim = anim.replace(extraDelay, '');
          }

          for (key in defaultAnimMappings) {
            if (anim.indexOf(key) > -1) {
              var mappingArr = [];
              defaultAnimMappings[key].forEach(function(map1, index) {
                cAnimations.push(anim.replace(key, map1 + ':') + extraDelay);
              })
            } else {
              cAnimations.push(anim+extraDelay);
            }
          }
        })

        if (cAnimations.length) {

          animations = cAnimations.join(",")
        }
        // if (cAnimations.indexOf('[') === -1) {
        //   animations = '[' + animations + ']';
        // }
        return animations
      }

      function applyAnimArgs(element, scope, animations, context, debug) {
        // if (element[0].nodeName === '#comment') {
        //   console.log(scope.elem, element.after(), element.parent().children())
        //   return;

        debug = debug || false;
        var stateName = context.type + '-' + context.name;
        var defaults = {"kf":60,"autoPlay":false,"toolbar":{},"hidePlot":false}
        var animDelay = 0;
        // var animationSplitIndex = animations.indexOf(':delay-');
        var animArr = resolveAnimationDelays(animations);

        animations = animArr.join(",");

        // animations = '[' + animations + ']'
        // console.log('pre condense', animations)
        // animations = condenseAnimationsAndShortcuts(scope, animations);

        var state = AnimationFrameService.init.state('', animations, element[0], defaults);
        // console.log(state.props.counter[0])
        // console.log(state)
        if (!player) {

          player = AnimationFrameService.getPlayer();
        }

        animDelay = animDelay || 0;

        player.scheduleStream(player, state, animDelay, debug);
        if (!scope || (context && context.streamOnly)) {

          return {player: player, stream:state, delay: animDelay}
        }
        //TODO, inject global offset here
        // if (animDelay && animDelay>0) {
        //   $timeout(function() {
        //     if (!player.active) {
        //       player.play(player);
        //     }
        //  }, animDelay)
        // }
        // else {

          if (!player.active) {
              player.play(player);
          }
      }

      function resolveAnimationDelays(animations, element) {
        var animArr = [];
        //resolve delays
        animations.split(',').forEach(function(animation, i) {
          var finalAnim = animation;
          finalAnimDelaySplit = finalAnim.split('delay-');
          if (finalAnimDelaySplit.length > 1) {
            var pureAnim = finalAnimDelaySplit[0];
            var delayVal = parseInt(finalAnimDelaySplit[1]);
            var pureAnimSplit = pureAnim.split(':').filter(function(arg) {return arg.length});
            if (pureAnimSplit.length > 7) {
              pureAnimSplit[5] = (parseInt(pureAnimSplit[5]) + delayVal) + "";
              finalAnim = pureAnimSplit.join(":")
            } else {
              pureAnimSplit[3] = (parseInt(pureAnimSplit[3]) + delayVal) + "";
              finalAnim = pureAnimSplit.join(":")
            }
          }

          finalAnim = checkAndReplaceSpecialArgs(element, finalAnim);
          animArr.push(finalAnim);
        })
        return animArr;
      }

      function checkShortcuts(str, arg) {

        if (arg in rShortcuts && str in rShortcuts[arg]) {
          return rShortcuts[arg][str]
        }
        return str;
      }

      function parsePropertiesWithShortcuts(elem, properties) {

          var elemProps = properties.split(',');
          var shortcuts = {special:Object.keys(rShortcuts.special), propValues:Object.keys(rShortcuts.propValues), props: Object.keys(rShortcuts.props), values: Object.keys(rShortcuts.values)};
          var propObjArr = [];
          elemProps.forEach(function(kv, kv_index) {
            shortcuts.special.forEach(function(special, i) {
              if (kv.indexOf(special) > -1) {
                kv = rShortcuts.special[special](elem, kv);
              }
            })

            var propValueShortcutIndex = shortcuts.propValues.indexOf(kv);
            if (propValueShortcutIndex > -1) {
              kv = rShortcuts.propValues[shortcuts.propValues[propValueShortcutIndex]]
            }

            var kvSplit = kv.split(':');
            var key = kvSplit[0];
            var value = kvSplit[1];
            if (key in rShortcuts.props) {
              key = rShortcuts.props[key];
            }
            if (value in rShortcuts.values) {
              value = rShortcuts.values[value]
            }
            propObjArr.push({key: key, value:value});
          })

          return propObjArr
      }


      function applyPropsToElement(elem, properties, shortcuts) {

        // properties.split(',').forEach(function() )
        var propertyArr = [];
        var specialProps = false;
        if (properties.indexOf('rgba') > -1) {
          specialProps = true;
          var propSplit = properties.split('rgba(');
          var propStrArr = [];
          propSplit.forEach(function(rgba_string) {
            if (rgba_string.indexOf(')') > -1) {
              var endParenthical = rgba_string.split(')');
              endParenthical[0] = endParenthical[0].split(',').join('|');
              rgba_string = endParenthical.join(")")
            }
            propStrArr.push(rgba_string)
          })
          properties = propStrArr.join('rgba(');
        }
        properties = UtilitiesService.replaceAll(properties, ', ', ',');
        var propertySplit = properties.split(',');
        if (!rShortcuts.cssPropValues && RootService.animations.customShortcuts) {
          rShortcuts.cssPropValues = RootService.animations.customShortcuts.cssPropValues;
          rShortcuts.cssProps = RootService.animations.customShortcuts.cssProps;
          rShortcuts.cmds = RootService.animations.customShortcuts.cmds;
          rShortcuts.args = RootService.animations.customShortcuts.args;
        }
        properties.split(',').forEach(function(prop, i) {
          if (!rShortcuts || !rShortcuts.cssPropValues) {

          }

          var prop = prop.trim();

          prop = checkAndReplaceSpecialPropArgs(elem, prop);
          if (!prop || !prop.length) return;

          if (rShortcuts && rShortcuts.cssPropValues && prop.toLowerCase() in rShortcuts.cssPropValues) {
            prop = rShortcuts.props[prop] + "";
          }
          if (!rShortcuts.cssPropValues) {
            $timeout(function() {
              applyPropsToElement(elem, properties, shortcuts);
            })
            return;
          }
          var iPropSplit = prop.split(':');

          if (iPropSplit.length >= 2) {
            var propKey = iPropSplit[0].trim();
            var propValue = iPropSplit[1].trim();
            if (propKey.toLowerCase() in rShortcuts.cssProps) {
              propKey = rShortcuts.cssProps[propKey];
            }
            propertyArr.push({key: propKey, value: propValue});
          }
        })

        // properties = parsePropertiesWithShortcuts(elem, properties);


        propertyArr.forEach(function(kv, i) {
          if (specialProps && kv.value.indexOf('|') > -1) {
            kv.value = kv.value.split('|').join(',');
          }
          // console.log(elem, kv.key, kv.value)
          CompService.css.apply(elem, kv.key, kv.value);
          // elem.css(kv.key, kv.value);
        })
      }

      function getParsedArgsByType(elem, state_type, state_args, arg_value) {
        var argDict = {};


        remainderStateName = state_args;
        state_args = getStateArgsFromValue(state_args, arg_value);


        if (state_type === 'when') {
          argDict[state_type] = remainderStateName.join('-');
          argDict.fullNameCamel = UtilitiesService.camelCase(argDict[state_type]);

        } else {
          argDict[state_type] = remainderStateName;
        }



          // var shortCutDict = getShortcutDict(elem, arg_value);

        argDict.actions = getArgActions(state_args, arg_value);
        // console.log(argDict)
        return argDict;
      }

      function getStateArgsFromValue(state_args, arg_value) {
        if (!state_args || !arg_value) return;
        //SHORTCUTS GO HERE for FULL anim/send/trigger states;
        arg_value = UtilitiesService.replaceAll(arg_value, ' | ', '|');
        var resultArr = [];
        arg_value.split('|').forEach(function(param_value, i) {
          resultDict = {argName: '', delays: {internal: 0, external: 0}};

          // resultDict.delays.external = getExternalDelay(arg_value + '') || 0;


          param_value = param_value.trim();

          if (param_value.indexOf('s:[') > -1 || param_value.indexOf('send:[') > -1 || param_value.indexOf('trigger:[') > -1 || param_value.indexOf('t:[') > -1) {

            resultDict.argName = 'send';
          }
          if (param_value.indexOf('p:[') > -1 || param_value.indexOf('prop:[') > -1) {
            resultDict.argName = 'prop';
          }
          if (param_value.indexOf('a:[') > -1 || param_value.indexOf('anim:[') > -1) {
            resultDict.argName = 'anim';
          }
          if (param_value.indexOf('e:[') > -1 || param_value.indexOf('eval:[') > -1) {
            resultDict.argName = 'eval';
          }
          resultArr.push(resultDict)
        })

        return resultArr;
      }

      function getArgActions(state_args, full_value, shortcuts) {
        if (!state_args) return;
        var actionDict = {};
        var delayDict = {};
        var rawDict = {};
        var state_args_base = [];
        state_args.forEach(function(arg_dict, i) {state_args_base.push(arg_dict.argName.split(':')[0].trim())});

        var joinedSends = [];
        full_value = UtilitiesService.replaceAll(full_value, ': ', ':');
        full_value = UtilitiesService.replaceAll(full_value, ', ', ',');

        //trigger
        full_value.split('|').forEach(function(stream) {




          if (!rShortcuts.cmds && !RootService.animations.customShortcuts) {
            $timeout(function() {
              getArgActions(state_args, full_value, shortcuts);
            })
            return;
          }

          if (RootService.animations && RootService.animations.customShortcuts) {
            rAnimations = RootService.animations;
            rShortcuts.cssPropValues = RootService.animations.customShortcuts.cssPropValues;
            rShortcuts.cssProps = RootService.animations.customShortcuts.cssProps;
            rShortcuts.cmds = RootService.animations.customShortcuts.cmds;
            rShortcuts.args = RootService.animations.customShortcuts.args;
          }

          if (stream && stream.length && stream in rShortcuts.cmds) {
            stream = rShortcuts.cmds[stream];
          }

          if (stream.indexOf('t:[') > -1 || stream.indexOf('trigger:[') > -1) {
            param_value = stream.trim();
            var hasDelay = (param_value + '').split(']')[1];
            var delay = '';
            if (hasDelay) {
              delay = ':' + parseFloat(hasDelay.replace(':delay-', '')).toFixed(4);
            }
            param_value = param_value.trim();

            if (state_args_base.indexOf('send') === -1) {
              full_value = full_value.replace('t:[', 'send:[').replace('trigger:[', 'send:[').trim();
              state_args.push('send' + delay);
            } else {
              full_value = full_value.replace('t:[', 'send:[').replace('trigger:[', 'send:[').trim();
            }
          }
        })

        //
        var resultDict = {};


        state_args.forEach(function(arg_dict, i) {
          if (!arg_dict.argName.length) {
            if (full_value.indexOf('reverse:') > -1) {
              resultDict['reverse'] = true;
              resultDict['stateName'] = full_value.split(':')[1]
              resultDict['raw'] = full_value
              return;
           }
          }


          // var extDelay = arg_dict.delays.external || 0;
          //to elimiate
          var arg = arg_dict.argName.split(':')[0];
          resultDict[arg] = {};

          if (arg in actionDict) {
            resultDict[arg].parsed = actionDict[arg];
          } else {
            resultDict[arg].parsed = extractRelevantValueFromArg(arg, full_value);
            resultDict[arg].raw = extractRelevantValueFromArg(arg, full_value);
          }
          resultDict[arg].raw = extractRelevantValueFromArg(arg, full_value, true);

          resultDict[arg].delays = {internal: getInternalDelay(arg, resultDict[arg].raw, delayMatchStr), external: getExternalDelay(resultDict[arg].parsed)};

        })

        return resultDict;

        function detectAndAddStrArgValues(state_args) {
          return [];
        }

        function extractRelevantValueFromArg(arg, full_value, remove_external) {
          remove_external = remove_external || false;
          arg = arg.trim();
          var returnValue = full_value;
          full_value.split('|').forEach(function(value, i) {
            if (value.indexOf(arg + ':[') > -1 || value.indexOf(arg[0] + ':[') > -1) {
              returnValue = value;
              if (!remove_external) {
                returnValue = UtilitiesService.replaceAll(returnValue, arg+':[', '');
                returnValue = UtilitiesService.replaceAll(returnValue, arg[0]+':[', '');
                returnValue = UtilitiesService.replaceAll(returnValue, ']', '');
              }
            }
          })
          return returnValue
        }
      }

      function detectStateType(name, camel) {

        return name.split('-')[0].toLowerCase();
      }

      function getSpecialAnimShortcuts() {
        return {draw: drawFunc, move: moveToFunc}
      }

      // function getWindowObj() {
      //   console.log(RootService._window)
      // }

      function moveToFunc(elem, shortcut, formatted) {
        var argSplit = formatted.split(':');
        var elemCurrentPosition = elem[0].getBoundingClientRect();
        var moveToArgs = [argSplit[1], argSplit[2]];
        var vp_info = RootService._window.elemInfo(elem[0])
        // var currentStyle = window.getComputedStyle()
        moveToArgs.forEach(function(pos, i)  {


          // function(pos, i) {


            var shortcutReplace = isShortcutMoveTo(pos, elemCurrentPosition, vp_info);
            console.log(shortcutReplace);
            if (shortcutReplace) {
              moveToArgs[i] = shortcutReplace + 'px';
            }
          // }
        });

        // return 'translateX:' + ''


        function isShortcutMoveTo(arg, coords, vp_info) {
          var resultValue = 0;
          var values = [];
          var resultExpr = '';
          var shortcuts = { left:0, right: 1, bottom:0, bottom: 1};
          var vp = vp_info;
          var replaceDict = {'x': 'left', 'y': 'top'};


          // if (arg.indexOf('vp.') > -1) {

          //   var hasDirection = arg.split('.')[1];
          //   if (hasDirection in shortcuts) {
          //     resultExpr += shortcuts[hasDirection] + '-'
          //   }
          // }
          var arg = arg;
          while (arg.indexOf('vp.') > -1 || arg.indexOf('#') > -1) {

            if (arg.indexOf('#') > -1) {
              var idIndex = arg.indexOf('#');
              var idNamePlusSplit = arg.substring(idIndex + 1, arg.length).split('.');
              var idName = idNamePlusSplit[0];
              var idDirection = idNamePlusSplit[1];
              if (idDirection in replaceDict) {
                idDirection = replaceDict[idDirection]
              }

              if (!(idName in RootService.elemIdCache)) {
                var elem = document.querySelector('#' + idName);
                if (elem) {
                  RootService.elemIdCache[idName] = elem.getBoundingClientRect();
                }
              }
              var toElemRect = RootService.elemIdCache[idName]
              var toReplaceStr = '#' + idName + '.' + idDirection;

              if (arg.indexOf(toReplaceStr) > -1)  {
                arg = arg.replace(toReplaceStr, toElemRect[idDirection] || '0')
              }
              if (('.' + idDirection).indexOf(arg) > -1) {
                    arg = arg.replace('.' + idDirection, '')
                }
              // arg = arg.replace('#', '');

              // ['right', 'left', 'top', 'bottom'].forEach(function(dir, i) {
              //   if (remainderString.indexOf(dir) === 0) {

              //   }
              // })
            }
            if (arg.indexOf('vp.') > -1) {
              console.log(arg)
              // var direction = arg.split('vp.')[0]
              var vpIndex = arg.indexOf('vp.');
              if (vpIndex || parseInt(vpIndex) === 0)  {

                remainderString = arg.substring(vpIndex + arg.substring(vpIndex, 3).length, arg.length);
                ['right', 'left', 'top', 'bottom'].forEach(function(dir, i) {
                  if (remainderString.indexOf(dir) >= 0) {


                    if (('.' + dir).indexOf(arg) > -1) {
                      arg = arg.replace('.' + dir, '')
                    }
                    arg = arg.replace('vp.' + dir, vp[dir] || '0')
                  }
                })
              }

              // console.log(arg.split('vp.')[0])
              // var numReplaced = vp[direction];

              // if (hasDirection in shortcuts) {
              // console.log(toReplace, numReplaced)
              // resultExpr += arg;

            }
          }
          // resultArg = arg;
          ['.left', '.right', '.top', '.bottom'].forEach(function(direct, i) {
            if (arg.indexOf(direct) > -1) {
              arg = arg.replace(direct, i);
            }
          });
          // var resultExpr = arg + coords[hasDirection];
          return $parse(arg)();
        }


        if (formatted) {
          var argSplit = (formatted + "").split(':')
          var translateX = ['translateX', '0px', moveToArgs[0], argSplit[3], argSplit[4], argSplit[5], argSplit[6], argSplit[7]].join(":");
          var translateY = ['translateY', '0px', moveToArgs[1], argSplit[3], argSplit[4], argSplit[5], argSplit[6], argSplit[7]].join(":");
          console.log(translateX, translateY)
          return [translateX, translateY].join(',')
        }
        return 'strokeDashoffset:' + (elem[0].getTotalLength() * percentDraw).toFixed(4);
      }

      function getSpecialPropShortcuts() {
        return {draw: initDrawFunc, move: identityFunc}

        function identityFunc(elem, prop_str) {
          return prop_str
        }

        function initDrawFunc(elem, attr) {
          var pathLength = SVGService.getTotalPathLength(elem[0]);

          elem[0].setAttribute('stroke-dashoffset', pathLength + "")
          return "stroke-dasharray:" + pathLength + ';stroke-dashoffset:' + pathLength;
        }

      }

      function checkAndReplaceSpecialPropArgs(elem, prop_str) {
        var firstArg = prop_str.split(':')[0];
        var specialPropDict = getSpecialPropShortcuts();
        if (firstArg in specialPropDict) {
          var result = specialPropDict[firstArg](elem, null, prop_str);

          return result;
        }
        return prop_str;
      }

      function checkAndReplaceSpecialArgs(elem, anim_str) {

        var firstArg = (anim_str + '').split(':')[0];
        var specialFuncDict = getSpecialAnimShortcuts();
        var func = specialFuncDict[firstArg];

        if (func) {

          var result = func(elem, null, anim_str);
          console.log(result)
          return result;
        }

        return result || anim_str
      }

      function drawFunc(elem, shortcut, formatted) {
        var shortcut = shortcut || "draw:100%";

        var parsedShortcut = shortcut.split('draw:')[1];
        var percentDraw = parseInt(parsedShortcut)/100;
        var isNegative = shortcut.indexOf('-') > -1;
        if (shortcut.indexOf('-1') > -1) {
          percentDraw *= isNegative
        }

        if (formatted) {
          var pathLength = SVGService.getTotalPathLength(elem[0]);
          var percentStart = parseInt(formatted.split(':')[1].replace('%', ''))/100.0;
          var percentEnd = parseInt(formatted.split(':')[2].replace('%', ''))/100.0;
          var pathLengthStart = percentStart * pathLength;
          var pathLengthEnd = percentEnd * pathLength;
          elem.css('stroke-dasharray', pathLength);
          var remainderAnim = formatted.split(':').slice(3).join(":");
          result = "stroke-dashoffset:" + (pathLength - pathLengthStart) + ':' + (pathLength - pathLengthEnd) + ':' + remainderAnim;
          console.log(result)
          return result;
        }
        return 'strokeDashoffset:' + (elem[0].getTotalLength() * percentDraw).toFixed(4);
      }

      function getShortcutDict(elem, str) {
        var matchDict = {};
        var parsedParams = [];
        for (key in rShortcuts) {

          sortedShortcuts = Object.keys(rShortcuts[key]).sort();;
          // full shortcuts
          sortedShortcuts.forEach(function(shortcut,i) {
            var strParams = str.split(',');
            strParams.forEach(function(param, i) {

              if (parsedParams.indexOf(param) > -1) return;

              var shortIndex = param.indexOf(shortcut);

              if (key === 'special' && shortIndex > -1) {
                var response = rShortcuts[key][shortcut](elem, param);
                matchDict[shortcut + param.split(shortcut)[1]] = response;
                parsedParams.push(param)
              }
              else if (key !== 'special' && shortIndex > -1) {
                matchDict[shortcut] = rShortcuts[key][shortcut];
                parsedParams.push(param)
              }
            });
          })
        }

        return matchDict
      }
}



angular
    .module('uguru.shared.services')
    .factory('ChartService', [
    '$timeout',
    '$compile',
    ChartService
    ]);

function ChartService($timeout, $compile) {

  return {
  }


}
angular.module('uguru.shared.services')
.factory("AdminElementService", [
    '$timeout',
    '$state',
    AdminElementService
        ]);

function AdminElementService($timeout, $state) {
      return {
        scaleSvgCSS:scaleSvgCSS,
        isSVGElement: isSVGElement,
        getSVGParent: getSVGParent,
        isSVG: isSVG,
        formatElement: formatElement,
        createBlind: createBlind
      }

      function formatElement(elem, _type, _window) {
        if (_type === 'player') {
          //svg
          if (elem.viewBox) {
            var ratio = elem.viewBox.baseVal.width/elem.viewBox.baseVal.height;
            elem.style.height = _window.height*0.5 * (1/ratio);
            elem.style.width = _window.width*0.5 * (1/ratio);

            return elem


          } else if (isSVG(elem)) {
            svgElem = getSVGParent(elem)
            var ratio = svgElem.viewBox.baseVal.width/svgElem.viewBox.baseVal.height;
            var svgClone = svgElem.cloneNode(true);
            svgClone.innerHTML = '';
            svgClone.appendChild(elem.cloneNode(true));
            svgClone.style.height = _window.height/0.5;
            svgClone.style.width = _window.width/0.5;
            return svgClone
          }
        }
        return elem
      }

      function createBlind(elem) {
        console.log(elem)
        var elemParent = getSVGParent(elem)

        // elem.parentNode.appendChild(blindElem);
      }

      function scaleSvgCSS(svg_elem, _window, absolute) {
        console.log('element', svg_elem);
        var viewBStr = svg_elem.getAttribute('viewBox');
        var viewBStrSplit = viewBStr.split(' ');

        viewBStrSplit.forEach(function(num, i) {viewBStrSplit[i] = parseFloat(viewBStrSplit[i])});

        var viewDict = {minX: viewBStrSplit[0], minY: viewBStrSplit[1], width: viewBStrSplit[2], height: viewBStrSplit[3]};
        var ratio = viewDict.width/viewDict.height;

        if (_window) {
          svg_elem.style.width = _window.width/(ratio/5) + 'px';
          svg_elem.style.height = _window.height/(ratio/5) + 'px';
        }
        if (absolute) {
          svg_elem.classList.add('absolute');
          svg_elem.style.left = _window.width * 0.4  + 'px';
        }



        return svg_elem;
      }

      function isSVG(elem) {
        name = elem.nodeName.toLowerCase();
        return ['path', 'g', 'rect', 'svg', 'polygon', 'line', 'circle'].indexOf(name) > -1;
      }

      function isSVGElement(name) {
        name = name.toLowerCase();
        return ['path', 'g', 'rect', 'svg', 'polygon', 'line', 'circle'].indexOf(name) > -1;
      }
      function getSVGParent(elem) {

        if (isSVGElement(elem.nodeName.toLowerCase()) && elem.nodeName === 'svg') return elem;

        return getSVGParent(elem.parentNode)
      }

}



angular
.module('uguru.admin', [])
.factory("AnimToolService", [
  '$state',
  '$timeout',
  '$localstorage',
  "$interval",
  'RootService',
  'AnimationService',
  AnimToolService
  ]);

function AnimToolService($state, $timeout, $localstorage, $interval, RootService, AnimationService) {
    var animationList = [];
    var toResolveAnimations = [];
    var animComplete = false;
    var animNameObjDict = {};
    var recorder = {};
    var player = {};
    var browser_prefix = RootService.getBrowserPrefix();
    var stage;
    var parent_elem;
    var animStartCallback;
    var animEndCallback;

    var animEventStartName = getAnimEventName(browser_prefix, 'Start');
    var animEventEndName = getAnimEventName(browser_prefix, 'End');


    return {
        initPlayer:initPlayer,
        initRecorder: initRecorder,
        setStage: setStage,
    }

    function initPlayer() {
        player.duration = recorder.time;
        player.play = playStageAnimations;
        player.time = null;
        player.jumpTo = jumpTo;
        player.animations = {queued: [], active: [], complete:[]};
        player.cleanAnimations = cleanAnimations;
        player.pauseAnimation = pauseAnimation;
            // player.start = getStartFunc();
            // player.pause = getPauseFunc();
            // player.changeRatio = getChangeRatioFunc()
        return player;
    }

    function pauseAnimation() {
        stage.player.mode = 'paused';
        if (player.timeout) {
            console.log('canceling complete animation effort');
            $timeout.cancel(player.timeout);
        }
        console.log('start offset', stage.player.start_offset);
        updateAnimPlayerOnPause();
        var animPlayStateKey = formatAnimationOption('AnimationPlayState', browser_prefix);
        for (var i = 0; i < stage.player.animations.queued.length; i++) {
            var indexAnim = stage.player.animations.queued[i];
            if (indexAnim.elem) {
                indexAnim.elem.style[animPlayStateKey] = 'paused';
            }
        }
    }

    function updateAnimPlayerOnPause() {
        stage.player.start_offset = getCurrentPlayProgress();
        stage.player.globals.offset.beginning =  ((stage.player.start_offset/100.0) * stage.player.total_time).toFixed(0);
    }

    function getCurrentPlayProgress() {
        var circle = document.querySelector('#main-player-tweener');
        if (circle) {
            var currentValue = circle.style['cx'];
            return parseInt(currentValue.replace('%', ''));
        }
    }

    function resumeAnimation() {
        stage.player.mode = 'resume';
        var animPlayStateKey = formatAnimationOption('AnimationPlayState', browser_prefix);
        for (var i = 0; i < stage.player.animations.queued.length; i++) {
            var indexAnim = stage.player.animations.queued[i];
            if (indexAnim.elem) {
                indexAnim.elem.style[animPlayStateKey] = 'running';
            }
        }
        var currentProgressMs = getCurrentPlayProgress();
        var msRemaining = stage.player.total_time - ((currentProgressMs/100.0) * stage.player.total_time).toFixed(0);
        triggerEndPlayerGlobalAnimation(msRemaining);
    }

    function triggerEndPlayerGlobalAnimation(time_ms) {
        console.log('checking to see if animation complete')
        player.timeout = $timeout(function() {
            if (stage.player.mode === "play" || stage.player.mode === 'resume' && player.timeout) {
                console.log('playing...');
                stage.player.mode = null;
                jumpTo(0)
            }
        }, time_ms)
    }

    function cleanAnimations() {
        stage.animations.sort(function(a1, a2) {
            a1.last_anim = null;
            a2.first_anim = null;
            return (a2.delay + a2.duration) - (a1.delay + a1.duration);
        }).reverse();
        var lastAnim = stage.animations[stage.animations.length - 1];
        lastAnim.last_anim = true;
        stage.animations[0].first_anim = true;
        stage.player.total_time = lastAnim.utc_start_time + lastAnim.duration - stage.animations[0].utc_start_time;
    }

    function jumpTo(percent) {
        var total_ms = stage.recorder.time * 1000;
        stage.player.globals.offset.beginning = ((percent/100) * total_ms).toFixed(1);
        stage.player.globals.jump_only = true;
        for (var i = 0; i < stage.animations.length; i++) {
            var animation = stage.animations[i];
            var animationString = constructAnimationString(stage.animations[i], stage.animationOptions);
            var formattedAnimationKey = formatAnimationOption('Animation', browser_prefix);
            animation.elem.style[formattedAnimationKey] = '';
            animation.elem.style[formattedAnimationKey] = animationString;
        }
    }

    function playStageAnimations() {
        stage.player.animations = {queued: [], active: [], complete:[]};
        stage.player.cleanAnimations();
        stage.player.mode = 'play';
        stage.player.pause = pauseAnimation;
        stage.player.resume = resumeAnimation;
        parent_elem = document.querySelector(stage.parentElem);
        parent_elem.addEventListener( animEventStartName , playStartCb);
        parent_elem.addEventListener( animEventEndName , playEndCb);
        var stage_animations_cp = stage.animations.slice();
        for (var i = 0; i < stage.animations.length; i++) {
            var clonedStageAnim = stage_animations_cp[i];
            stage.player.animations.queued.push(stage_animations_cp[i]);
            runAnimationsWithSettings(stage.animations[i], stage.animationOptions);

        }

        function runAnimationsWithSettings(animation, options) {
            var animationString = constructAnimationString(animation, stage.animationOptions);
            if (animation.elem) {
                var formattedAnimationKey = formatAnimationOption('Animation', browser_prefix);
                initBaseAnimElemListener(animation.elem);
                animation.elem.style[formattedAnimationKey] = '';
                $timeout(function() {
                    animation.elem.style[formattedAnimationKey] = animationString;
                })

            }
        }

        function playStartCb(e) {
            if (e.target) {
                // console.log('animation started', e);
                var anim_num = e.target.getAttribute('anim-num')
                var anim_name = e.animationName;
                var queued_anim;
                for (var j = 0; j < stage.player.animations.queued.length; j++) {
                    if (stage.player.animations.queued[j].name === anim_name) {
                        queued_anim = stage.player.animations.queued[j];
                        break;
                    }
                }
                queued_anim.elem = e.target;
                stage.player.animations.active.push(queued_anim);
            }
        }

        function playEndCb(e) {
            if (e.target) {
                // console.log('animation started', e);
                var anim_num = e.target.getAttribute('anim-num')
                var anim_name = e.animationName;
                var active_anim;
                for (var k = 0; k < stage.player.animations.active.length; k++) {
                    if (stage.player.animations.active[k].name === anim_name) {
                        active_anim = stage.player.animations.active[k];
                        break;
                    }
                }
                stage.player.animations.complete.push(active_anim);

                console.log(getCurrentPlayProgress() + '%', 'completed', stage.player.animations.complete.length);
            }
        }


        function initBaseAnimElemListener(elem) {
            // console.log(anim.elem, animEventStartName);
            // function startAnimCb(animation) {
            //     return function(e) {
            //         console.log(animation, e)
            //         if (animation.first_anim) {
            //             console.log('first anim started', animation.name);
            //         }
            //         function endAnimCb(animation) {
            //             return function(e) {
            //                 if (animation.first_anim) {
            //                     console.log('first anim complete', animation.name)
            //                 }
            //                 e.target.style[formattedAnimationKey] = '';
            //                 animation.elem.removeEventListener(endAnimCb, animEventEndName);
            //             }
            //         };
            //         animation.elem.addEventListener(animEventEndName, endAnimCb(animation));
            //     }
            // }
            function endAnimCb(e) {
                // return function(e) {
                    console.log('finished');
                    if (anim.first_anim) {

                    }
                    e.target.style[formattedAnimationKey] = '';
                    elem.removeEventListener(endAnimCb, animEventEndName);
                // }
            };
            elem.addEventListener(animEventEndName, endAnimCb);
            // anim.elem.addEventListener(animEventStartName, startAnimCb(anim));
        }
    }

    function formatAnimationOption(option, browser_prefix) {
        return browser_prefix && browser_prefix.length && (browser_prefix + option) || option[0].toLowerCase() + option.substring(1)
    }

    function constructAnimationString(animation, options) {

        var name, duration, time_f, delay, iter, direc, f_mode, play_state;

        if (options.speed) {
            duration = animation.duration / options.speed;
            delay = animation.delay / options.speed;
        }


        if (stage.player.globals.offset.beginning) {
            delay = animation.delay - stage.player.globals.offset.beginning;
        }

        if (stage.player.globals.jump_only) {
            play_state = 'paused';
        } else {
            play_state = 'running';
        }



        //formatting
        name = animation.name || 'temp-anim';
        duration = (duration && duration + 'ms') || '1s';
        time_f = animation.timing_function || 'ease';
        delay = delay + 'ms' || '0s';
        iter = animation.iteration_count || 1;
        direc = animation.direction || 'normal';
        f_mode = animation.fill_mode || 'none';
        play_state = play_state || '';

        var full_animation_string = name + " " + duration + " " + time_f + " " + delay + " " + iter + " " + direc + " " + f_mode + " " + play_state;
        return full_animation_string
    }

    function setStage(_stage) {
        stage = _stage || {};
        stage.animStats = initAnimStats();
        stage.animations = [];
        stage.animationOptions = {jump_only:true, speed: 1.5, showTweener: false, offset: {beginning:2000}};
        stage.player = player;
        stage.player.globals = {jump_only:false, speed: 1, showTweener: false, offset: {beginning:0}};
        stage.player.start_offset = '0';
        return stage;
    };

    function updatePlayerStartOffset(total_time_ms, offset_ms) {
        stage.player.start_offset = ((offset_ms/(total_time_ms * 1000)) * 100).toFixed('2');
    }

    function initAnimationListener(browser_prefix, _parent_elem) {


        animStartCallback = function(e) {
            var reservedIDs = ['admin-anim-tools'];
            if (e.target && reservedIDs.indexOf(e.target.id) > -1) {
                return;
            }
            stage.animStats.numActiveStart += 1;
            e.time_stamp = new Date().getTime();
            e.current_classname = e.target.className + "";
            stage.animStats.startEvents.push(e);
            if (stage.animStats.uniqueAnimArr.indexOf(e.animationName) === -1) {
                stage.animStats.uniqueAnimArr.push(e.animationName);
            }
            formatAndPushTimelineAnimObj(stage.animations.length, e.time_stamp, e.animationName, e.target, e.current_classname);


        }

        animEndCallback = function (e) {
            e.time_stamp = new Date().getTime();
            stage.animStats.numActiveEnd += 1;
            stage.animStats.endEvents.push(e);
            checkIfAnimationComplete(stage.animStats, stage.animStats.numActiveStart + 0, stage.animStats.numActiveEnd + 0);
            resolveAnimation(e);
        }

        parent_elem = document.querySelector(_parent_elem);
        parent_elem.addEventListener( animEventStartName , animStartCallback)
        parent_elem.addEventListener( animEventEndName, animEndCallback)
    }

    function resolveAnimation(evt) {
        var elementsMatched = [];
        for (var i = 0; i < toResolveAnimations.length; i++) {
            var anim = toResolveAnimations[i]
            if (evt.animationName === anim.name && evt.target === anim.elem) {
                elementsMatched.push(i);
            }
        }
        if (elementsMatched.length > 1) {
            alert('something went wrong see console');
            console.log('ERROR: event is matching more than two animations/elements', evt, toResolveAnimations);
            return;
        } else if (elementsMatched.length === 1) {
            var anim = toResolveAnimations.splice(toResolveAnimations[0], 1)[0]
            anim.duration = evt.time_stamp - anim.utc_start_time;
            if (!stage.animations.length) {
                anim.delay = 0;
            }
            anim.elem.setAttribute('anim-num', stage.animations.length + 1);
            stage.animations.push(anim);
        }
    }

    function checkIfAnimationComplete(stats, current_start, current_end) {
        if (animComplete) return;


        $timeout(function() {
            // case one -- its been over 1 second since the last animation has started
            var timeStampLastStartAnim = stats.numActiveStart && stats.startEvents[stats.startEvents.length - 1].time_stamp;
            if (new Date().getTime() - timeStampLastStartAnim > 1000 && !animComplete) {
                animComplete = true;
                var intervalCounter = 0;
                var waitInterval = setInterval(function() {
                    intervalCounter += 1;
                    if (intervalCounter === 1 && (stats.startEvents.length > stats.endEvents.length)) {
                        recorder.end(recorder);
                        window.clearTimeout(waitInterval);
                    }
                    else if (stats.startEvents.length === stats.endEvents.length) {
                        recorder.end(recorder);
                        window.clearTimeout(waitInterval);
                    }
                }, 1000)

            }
        }, 1000);
    }



    function getAnimEventName(prefix, _type) {
        if (['ms', 'moz', 'webkit', 'o'].indexOf(prefix.toLowerCase()) > -1) {
            return prefix + 'Animation' + _type
        }
        return "animation" + _type.toLowerCase();

    }



    function formatAndPushTimelineAnimObj(index, start_time, name, elem, class_name) {
        $timeout(function() {
            var js_obj = AnimationService.getAnimationObjFromAnimationName(name);
            var anim = {
                id: index,
                name: name,
                js_obj: js_obj,
                delay:start_time - recorder.start_time,
                utc_start_time: start_time,
                duration: null,
                elem: elem,
                _class: class_name
            }
            toResolveAnimations.push(anim);
        })
    }

    function mergeDurationToAnimObj(f_anim, start_events, end_event) {
        for (var j = 0; j < start_events.length; j++) {
            var indexEvent = start_events[j];
            if (indexEvent.target === f_anim.elem) {
                f_anim.duration = indexEvent.time_stamp - f_anim.utc_start_time;
                console.log(f_anim.name, 'will start', f_anim.delay +'ms for', f_anim.duration/1000 + 's')
            }
        }
    }

    function initRecorder(stage, scope) {
        var startCallback = function() {
            return function() {
                initAnimationListener(browser_prefix, stage.parentElem);
            }
        }
        return getRecordObj(scope, startCallback())
    }

    function initAnimStats() {
        return {
            uniqueAnimArr: [],
            startEvents:[],
            uniqueElems:[],
            numActiveStart: 0,
            numActiveEnd: 0,
            endEvents:[],
            animDict: {}
        }
    };

    function getRecordObj(scope, start_cb) {

        recorder = {
            start: function(r_obj) {

                if (start_cb) {
                    start_cb();
                }
                $timeout(function() {
                    if (!r_obj.start_time) {
                        r_obj.time = 0;
                        r_obj.start_time = new Date().getTime();
                        r_obj.time_promise = $interval(function() {
                            var current_time = new Date().getTime();
                            r_obj.time = ((current_time - r_obj.start_time)/1000).toFixed(1);
                        }, 10)
                    }
                })
            },
            start_time: null,
            end: function(r_obj) {
                stage.animations.sort(function(a1, a2) {
                    return (a2.delay + a2.duration) - (a1.delay + a1.duration);
                }).reverse();
                var current_time = new Date().getTime();

                parent_elem.removeEventListener(animEventStartName, animStartCallback);
                parent_elem.removeEventListener(animEventEndName, animEndCallback);
                $interval.cancel(r_obj.time_promise);
                stage.player.start_offset = 50
                stage.animationOptions.showTweener = true;

                var lastAnim = stage.animations[stage.animations.length - 1];
                stage.recorder.complete = true;
                stage.recorder.time = ((lastAnim.utc_start_time + lastAnim.duration -  stage.animations[0].utc_start_time)/1000.0).toFixed(2);
                stage.player.total_time = stage.recorder.time;
                stage.player.orig_time = stage.recorder.time;
                updatePlayerStartOffset(stage.player.total_time * 1000, 0);
                stage.recorder.end_time = current_time;
                stage.recorder.total_time = current_time - r_obj.start_time;

                $timeout(function() {
                    scope.$apply();
                })
            },
            end_time: null,
            complete:false,
            time: 0,
            total_time: 0,
            time_promise: null,
            clear: function(record_obj) {
                if (confirm('are you sure you want to remove this data?')) {
                    r_obj.start_time = 0;
                    r_obj.complete = false;
                    r_obj.total_time = 0;
                    r_obj.time = 0;
                    r_obj.time_promise = false;
                }
            }
        }
        stage.recorder = recorder;
        return recorder;
    }
}
angular
.module('uguru.admin')
.factory('ReportService', [
    '$timeout',
    'FileService',
    'LoadingService',
    '$q',
     ReportService
]);
function ReportService($timeout,FileService,LoadingService,$q) {
    var bugReport
    var states
    var caches 
    var defaultEnvi= []
    /**
    * Redeem the data from amazons services
    *   
    * @param dataUrl
    */
    // function initData(bugUrl='https://s3.amazonaws.com/uguru-admin/sync/bugs.json'){
    //     bugReport = redeemData(bugUrl)
    //     console.log("Done",bugReport)
    //     return bugReport
    // }
    function redeemData(url, cb){
          var xhr = new XMLHttpRequest();
        xhr.open( 'GET', url, true );

        xhr.onload = function () {
            var resp = window.JSON.parse( xhr.responseText );
            cb && cb(resp);
        };
        xhr.send();
    }

    function initData(name,url){
        redeemData(url,callback)
        function callback(resp){
            bugReport = resp
            caches = true
            LoadingService.hide()
            $timeout(function() {
             LoadingService.showSuccess(resp.length + ' '+name+' loaded', 1000) ;
            })
        }
    }

    function saveBug(newObject){
        bugReport = newObject;
    }
    
    function syncReport(newObject){
      
      FileService.postS3JsonFile(JSON.stringify(newObject), null ,
                                 'https://s3.amazonaws.com/uguru-admin/sync/bugs.json', postCallback);
      function postCallback(firstName, resp) {
          saveBug(newObject);
          console.log('file successfully saved', resp);          
        }
    }
    function getBug(id){
        var deferred = $q.defer();
         setTimeout(function() {
           if (bugReport) {
              var found;
              deferred.resolve(bugReport);
              // for(var i = 0; i < bugReport.length; ++ i)
              //   { 
              //     if(bugReport[i].bugID === id){
              //       found = bugReport[i];
              //     }
              //   }

              //   if (found){
              //       deferred.resolve(found);
              //   }
              //   else{
              //       deferred.reject('Unable to lunch bug report');

              //   }
           } 
           else {
             deferred.reject('Unable to lunch bug report',bugReport);
           }
         }, 3000);

         return deferred.promise;
    }

    function getStates(){
        if (!caches){
            initData('states','https://s3.amazonaws.com/uguru-admin/master/layouts/splash.json');
        }
        return bugReport;
    }
    return{
        initData: initData,
        getBug: getBug,
        saveBug: saveBug,
        getStates: getStates,
        syncReport:syncReport
    };
}
angular.module('uguru.shared.directives', []);
angular.module('uguru.shared.directives')
.directive('page-transition', function () {
  return {
    restrict: 'A',
    link: function(scope, element, attr) {

      var loader = new SVGLoader( element[0], { speedIn : attr.pageTransitionDelay || 300, easingIn : mina.easeinout } );
      loader.show();

      element[0].className += ' pageload-overlay';
      element[0].setAttribute('data-opening', 'M -18 -26.90625 L -18 86.90625 L 98 86.90625 L 98 -26.90625 L -18 -26.90625 Z M 40 29.96875 C 40.01804 29.96875 40.03125 29.98196 40.03125 30 C 40.03125 30.01804 40.01804 30.03125 40 30.03125 C 39.98196 30.03125 39.96875 30.01804 39.96875 30 C 39.96875 29.98196 39.98196 29.96875 40 29.96875 Z');

      var div = document.createElement('div');
      div.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="transition" style="position:fixed;background-color:transparent; visibility:hidden;" width="100%" height="100%" viewBox="0 0 80 60" preserveAspectRatio="xMidYMid slice"><path d="M -18 -26.90625 L -18 86.90625 L 98 86.90625 L 98 -26.90625 L -18 -26.90625 Z M 40 -25.6875 C 70.750092 -25.6875 95.6875 -0.7500919 95.6875 30 C 95.6875 60.750092 70.750092 85.6875 40 85.6875 C 9.2499078 85.6875 -15.6875 60.750092 -15.6875 30 C -15.6875 -0.7500919 9.2499078 -25.6875 40 -25.6875 Z"/></svg>'
      element[0].appendChild(div);


      scope.$watch(function() {
          return element.attr('class');
        }, function(new_class) {
          if (element[0].className.indexOf('activate')) {
            element[0].classList.remove('activate');
            element[0].querySelector('svg.transition').style.visibility = "visible";
          }
      })
    }
  }
})
.directive('tracePath', ['$timeout', 'SVGService', '$compile', '$rootScope', function ($timeout, SVGService, $compile, $rootScope) {
  return {
    restrict: 'A',
    scope: {
        kf: '=kf',
    },
    link: function(scope, element, attr) {

      var elementToTraceSelector = attr.tracePath;
      var elementToAppendChild = attr.traceParent;
      // console.log('passed in selectors', elementToTraceSelector, elementToAppendChild)
      var options = {
        duration: attr.traceDuration || '5s',
        time_function: attr.traceTimeFunc || 'linear',
        delay: attr.traceDelay || '0s',
        iter_count: attr.traceIterCount || '1',
        direction: attr.traceDirection || 'normal',
        fill_mode: attr.traceFillMode || 'forwards',
        anim_name: attr.traceAnimName || (element[0].id + '-' + element[0].nodeName),
        should_rotate: (attr.traceRotate && attr.traceRotate === 'true') || (!attr.traceRotate && true)
      }
      if (!options.should_rotate) {
        console.log('element has explicitly set should rotate to false', element[0]);
      }

      var pathElem = document.querySelector(elementToTraceSelector);
      var traceParent = document.querySelector(elementToAppendChild);
      var parentDrawShape = pathElem && findParentDrawShape(pathElem);

      scope.$watch(function() {
          return element.attr('class');
      }, function(new_class, old_class) {
        if (!new_class) {
          return;
        }
        if (new_class.indexOf('trace-activate') > -1) {
          element[0].classList.remove('trace-activate');
          if (!pathElem || !traceParent || !parentDrawShape) {
            var pathElem = document.querySelector(elementToTraceSelector);
            var traceParent = document.querySelector(elementToAppendChild);
            var parentDrawShape = findParentDrawShape(pathElem);
            if (!pathElem || !traceParent || !parentDrawShape) {
              console.log('ERROR: could not find elements with selector:', !pathElem && elementToTraceSelector, !traceParent && elementToAppendChild);
              return;
            }
          }
          var animName = options.anim_name;
          var elemOffset = SVGService.getShapeWidthHeight(element[0]).width;
          $timeout(function() {

          })
          var cssAnimObj = SVGService.generateCSSObjFromPath(animName, pathElem, elemOffset, options.should_rotate);
          console.log(cssAnimObj);
          var cssAnimObjString = [animName, options.duration, options.time_function, options.delay, options.iter_count, options.direction, options.fill_mode].join(' ');

          traceParent.appendChild(element[0]);
          $timeout(function() {
            parentDrawShape.classList.add('activate');
            scope.$apply()
            element[0].style.animation = cssAnimObjString;
            element[0].style.webkitAnimation = cssAnimObjString;
            element[0].addEventListener( 'webkitAnimationEnd', animEndCallback)
            function animEndCallback() {
              element[0].offsetWidth = element[0].offsetWidth;
              element[0].style.animation = null;
              element[0].style.webkitAnimation = null;
              element[0].removeEventListener('webkitAnimationEnd', animEndCallback);
            }
          });
        }
      })
    }
  }
    function findParentDrawShape(elem) {

        if (elem.nodeName === 'svg' || elem.hasAttribute('draw-shapes')) {
            return elem.hasAttribute('draw-shapes') && elem;
        } else {
          return findParentDrawShape(elem.parentNode);
        }
    }
}])
.directive('kf', ['$timeout', 'SVGService', function ($timeout, SVGService) {
  return {
      restrict: 'A',
      scope: {
            state: '=kfMode',
      },
      link: function(scope, element, attr) {
        scope.$watch('state', function(newValue, oldValue){

          var requestFrameHandle;
          if (!scope.state) {
            scope.state = 'stop';
            window.cancelAnimationFrame(requestFrameHandle);
          } else if (scope.state === 'paused') {
            window.cancelAnimationFrame(requestFrameHandle);
          } else if (scope.state === 'play' || scope.state === 'resume') {
            drawShape();
            if (!requestFrameHandle) {
              requestFrameHandle = 0;
            }

            var parentWidth = element[0].parentNode.getBoundingClientRect.width;
            var total_frames = ((parseInt(attr.kfDuration.replace('ms', ''))/1000).toFixed(2) * 60) || 60;
            var current_frame = total_frames * (parseInt(attr.cx.replace('%', ''))/100.0).toFixed(2) || 0;

            function drawShape() {
              var progress = current_frame/total_frames;
                if (progress >= 1) {
                   scope.state = 'stop';
                   element[0].style.cx = '0%';
                   window.cancelAnimationFrame(requestFrameHandle);
                }
                else if (scope.state === 'paused') {
                    window.cancelAnimationFrame(requestFrameHandle);
                }
                else {
                  current_frame++;
                  element[0].style.cx = (progress * 100) + '%';
                  requestFrameHandle = window.requestAnimationFrame(drawShape);
                }
              }
          }
        })
      }
    }
}])
.directive('drawShapes', ['$timeout', 'SVGService', function ($timeout, SVGService) {
  return {
    restrict: 'A',
    link: function(scope, element, attr) {
      var clonedElem = element[0].cloneNode(true);
      var currentFrame = parseInt(attr.initFrame) || 0;
      var delay = attr.drawDelay || 0;
      var totalFrames = SVGService.computeDrawDuration(attr.drawDuration) || 60;
      var svgPaths = element[0].querySelectorAll('path:not([draw]):not([draw-ignore]), line:not([draw]):not([draw-ignore]), circle:not([draw]):not([draw-ignore]), rect:not([draw]):not([draw-ignore]), polygon:not([draw]):not([draw-ignore])');
      var pathLengths = new Array();
      var drawShapesDelay = parseInt(attr.drawShapesDelay) || 0;
      for (var i = 0; i < svgPaths.length; i++) {
        var indexPathElem = svgPaths[i];

        var pathLength = SVGService.getTotalPathLength(indexPathElem);

        // var pathLength = indexPathElem.getTotalLength();
        pathLengths[i] = pathLength;
        indexPathElem.style.strokeDasharray = pathLength + ' ' + pathLength;
        indexPathElem.style.strokeDashoffset = pathLength;
      }
      scope.$watch(function() {
        return element.attr('class');
      }, function() {

        if (element[0].classList.contains('activate') || (attr.drawOnClass && element[0].classList.contains(attr.drawOnClass))) {
            $timeout(function() {
              //concurrent case
              var startTime = new Date().getTime();
              var requestFrameHandle = 0;
              function draw() {
                var progress = currentFrame/totalFrames;
                if (progress > 1) {
                  var endTime = new Date().getTime();
                   window.cancelAnimationFrame(requestFrameHandle);
                } else {
                  currentFrame++;
                  for(var j=0; j<svgPaths.length;j++){
                    svgPaths[j].style.strokeDashoffset = Math.floor(pathLengths[j] * (1 - progress))
                    // console.log(svgPaths[j].style.strokeDashoffset);
                  }
                  requestFrameHandle = window.requestAnimationFrame(draw);
                }
              }
              draw()
            }, drawShapesDelay);
          }
        })
      }
    }
}])
.directive('classOnClear', ['$timeout', 'AnimationService', function ($timeout, AnimationService) {
  return {
    restrict: 'A',
    link: function(scope, element, attr) {
      scope.$watch(function() {
        return element.attr('class');
      },function() {
        if (element[0].classList.contains('clear')) {
          element[0].classList.remove('clear')
          var delay = attr.classOnClearDelay || 0;
          var classes = attr.classOnClear.split(", ");
          $timeout(function() {
              for (var i = 0; i < classes.length; i++) {
                var indexClass = classes[i].split(":")[0];
                var classArgs = classes[i].split(":").slice(1);
                if (classArgs.indexOf("animIn") > -1) {
                  if (classArgs.indexOf("keep") > -1) {
                    indexClass = indexClass +':keep';
                  }
                  AnimationService.animateIn(element[0], indexClass);
                } else
                if (classArgs.indexOf("animOut") > -1) {
                  if (classArgs.indexOf("keep") > -1) {
                    indexClass = indexClass +':keep';
                  }
                  AnimationService.animateOut(element[0], indexClass);
                }
                else {
                  element[0].classList.add(indexClass);
                }
                if (classArgs.indexOf("unique") > -1) {
                  var otherClassElems = document.querySelectorAll('.' + indexClass);
                  for (var j = 0; j < otherClassElems.length; j++) {
                    var otherElemIndex = otherClassElems[j];
                    if (otherElemIndex !== element[0]) {
                      otherElemIndex.classList.remove(indexClass);
                    }
                  }
                }
                if (classes[i].indexOf('inject') > -1 && classArgsHasInject(classArgs)) {
                  var injectArgClassSplit = classArgsHasInject(classArgs).split("|")
                  if (injectArgClassSplit.length > 1) {
                    var classToInject = injectArgClassSplit[1];
                    var elemToInjectSelector = injectArgClassSplit[0];
                    var elemsToInject = document.querySelectorAll(elemToInjectSelector);
                    for (var k = 0; k < elemsToInject.length; k++) {
                      elemsToInject[k].classList.add(classToInject);
                    }
                  }
                }
              }
          }, delay);
          function classArgsHasInject(args) {
            var injectArg = null;
            args.forEach.call(function(word, index) {
              if (word.indexOf("inject") > -1) {
                injectArg = args[index];
                return true
              };
            })
            return (injectArg && injectArg.replace("inject", ""));
          }
        }
      })
    }
  }
}])
.directive('onActivate', ['$timeout', '$parse', 'AnimationService',
  function ($timeout, $parse, AnimationService) {
  return {
    restrict: 'A',
    link: function(scope, element, attr) {
      var activateClass = attr.onActivate;
      var animationObj;
      if (activateClass.split(':').length > 1 && activateClass.indexOf(':animIn') === -1 && activateClass.indexOf(':animOut') === -1 && activateClass.indexOf(':anim') > -1) {
        animationClass = activateClass.split(':anim')[0];
        animationObj = AnimationService.getCSSAnimationFromClassName(animationClass);
      }



      scope.$watch(function() {
        return element.attr('class');
      },function() {
        if (element[0].classList.contains('activate')) {

          element[0].classList.remove('activate')
          var delay = attr.onActivate || 0;
          var classes = attr.onActivate.split(", ");
          // $timeout(function() {
              for (var i = 0; i < classes.length; i++) {
                var indexClass = classes[i].split(":")[0];
                var classArgs = classes[i].split(":").slice(1);
                var elemArgDict = parseElemStateAttrValueArgs(classArgs);
                if (elemArgDict.unique) {
                //   $timeout(function() {
                    var elemsThatAlreadyHaveClass = document.querySelectorAll('.' + indexClass) || [];
                    for (var i = 0; i < elemsThatAlreadyHaveClass.length; i++) {
                      elemsThatAlreadyHaveClass[i].classList.remove(indexClass);
                    }
                //   });
                }
                if (classArgs.indexOf("animIn") > -1 && indexClass !== "null") {''
                  if (classArgs.indexOf("keep") > -1) {
                    indexClass = indexClass +':keep';
                  }
                  AnimationService.animateIn(element[0], indexClass, elemArgDict.delay);
                } else
                if (classArgs.indexOf("animOut") > -1 && indexClass !== "null") {
                  if (classArgs.indexOf("keep") > -1) {
                    indexClass = indexClass +':keep';
                  }
                  AnimationService.animateOut(element[0], indexClass, elemArgDict.delay);
                } else
                if (classArgs.indexOf("anim") > -1 && indexClass !== "null") {
                  if (classArgs.indexOf("keep") > -1) {
                    indexClass = indexClass + ':keep';
                  }
                  AnimationService.animate(element[0], indexClass, animationObj, elemArgDict.delay);
                }
                else if (indexClass !== "null" && indexClass.length) {
                  element[0].classList.add(indexClass);
                }
                // if (classArgs.indexOf("unique") > -1) {
                //   var otherClassElems = document.querySelectorAll('.' + indexClass);
                //   for (var j = 0; j < otherClassElems.length; j++) {
                //     var otherElemIndex = otherClassElems[j];
                //     if (otherElemIndex !== element[0]) {
                //       otherElemIndex.classList.remove(indexClass);
                //     }
                //   }
                // }

                // if (classes[i].indexOf('inject') > -1 && classArgsHasInject(classArgs)) {
                //   var injectArgClassSplit = classArgsHasInject(classArgs).split("|")
                //   if (injectArgClassSplit.length > 1) {
                //     var classToInject = injectArgClassSplit[1];
                //     var elemToInjectSelector = injectArgClassSplit[0];
                //     var elemsToInject = document.querySelectorAll(elemToInjectSelector);
                //     for (var k = 0; k < elemsToInject.length; k++) {
                //       elemsToInject[k].classList.add(classToInject);
                //     }
                //   }
                // }
                if (elemArgDict.inject_elems && !elemArgDict.delay) {
                  for (var k = 0; k < elemArgDict.inject_elems.length; k++) {
                    elemArgDict.inject_elems[k].classList.add(elemArgDict.inject_class);
                  }
                } else if (elemArgDict.inject_elems && elemArgDict.delay) {
                  console.log('injecting...', elemArgDict.inject_class);
                  $timeout(function() {
                    for (var k = 0; k < elemArgDict.inject_elems.length; k++) {
                      elemArgDict.inject_elems[k].classList.add(elemArgDict.inject_class);
                    }
                  }, parseInt(elemArgDict.delay));
                }
              }
          // }, delay);

          if (attr.evalOnActivate) {
            $timeout(function() {
              scope.$apply(function(){
                var parsedExpr = $parse(attr.evalOnActivate)(scope);
                console.log(parsedExpr);

              })
            })
          }

          // function classArgsHasInject(args) {
          //   var injectArg = null;
          //   args.forEach.call(function(word, index) {
          //     if (word.indexOf("inject") > -1) {
          //       injectArg = args[index];
          //       return true
          //     };
          //   })
          //   return (injectArg && injectArg.replace("inject", ""));
          // }
        }
      })
    }
  }
}])
.directive('classOnActivate', ['$timeout', '$parse', 'AnimationService',
  function ($timeout, $parse, AnimationService) {
  return {
    restrict: 'A',
    link: function(scope, element, attr) {
      scope.$watch(function() {
        return element.attr('class');
      },function() {
        if (element[0].classList.contains('activate')) {

          element[0].classList.remove('activate')

          var delay = attr.classOnActivateDelay || 0;
          var classes = attr.classOnActivate.split(", ");
          $timeout(function() {
              for (var i = 0; i < classes.length; i++) {
                var indexClass = classes[i].split(":")[0];
                var classArgs = classes[i].split(":").slice(1);
                if (classArgs.indexOf("animIn") > -1 && indexClass !== "null") {
                  if (classArgs.indexOf("keep") > -1) {
                    indexClass = indexClass +':keep';
                  }
                  AnimationService.animateIn(element[0], indexClass);
                } else
                if (classArgs.indexOf("animOut") > -1 && indexClass !== "null") {
                  if (classArgs.indexOf("keep") > -1) {
                    indexClass = indexClass +':keep';
                  }
                  AnimationService.animateOut(element[0], indexClass);
                }
                else if (indexClass !== "null") {
                  element[0].classList.add(indexClass);
                }
                if (classArgs.indexOf("unique") > -1) {
                  var otherClassElems = document.querySelectorAll('.' + indexClass);
                  for (var j = 0; j < otherClassElems.length; j++) {
                    var otherElemIndex = otherClassElems[j];
                    if (otherElemIndex !== element[0]) {
                      otherElemIndex.classList.remove(indexClass);
                    }
                  }
                }
                if (classes[i].indexOf('inject') > -1 && classArgsHasInject(classArgs)) {
                  var injectArgClassSplit = classArgsHasInject(classArgs).split("|")
                  if (injectArgClassSplit.length > 1) {
                    var classToInject = injectArgClassSplit[1];
                    var elemToInjectSelector = injectArgClassSplit[0];
                    var elemsToInject = document.querySelectorAll(elemToInjectSelector);
                    for (var k = 0; k < elemsToInject.length; k++) {
                      elemsToInject[k].classList.add(classToInject);
                    }
                  }
                }
              }
          }, delay);

          if (attr.evalOnActivate) {
            $timeout(function() {
              scope.$apply(function(){
                var parsedExpr = $parse(attr.evalOnActivate)(scope);
                console.log(parsedExpr);

              })
            })
          }


        }
      })
    }
  }
}])
.directive('counter', ['$timeout', '$interval', function ($timeout, $interval) {
  return {
    restrict: 'A',
    link: function(scope, element, attr) {
      var counterMax = attr.counterMax;
      var counterMin = attr.counterMin || 0;
      var counterSuffix = attr.counterSuffix || '';
      var counterPrefix = attr.counterPrefix || '';
      var counterDuration = attr.counterDuration || '';
      if (attr.initOnClass && attr.initOnClass.indexOf('counter:') > -1 && counterMax) {
        var initOnClassArgs = attr.initOnClass.split(', ');
        var initCounterClassIndex = getClassArgIndex('counter', initOnClassArgs)
        var initCounterClassArr = initOnClassArgs[initCounterClassIndex].split(':')
        if (initCounterClassArr.length === 2) {
          initCounterClass = initCounterClassArr[1];
        }
        if (initCounterClass) {
          scope.$watch(function() {
            counterMax = attr.counterMax;
            var counterDuration = attr.counterDuration || '';
            return (element.attr('class') && element.attr('class').indexOf(initCounterClass) > -1) || "";

          },function(elem_has_init_counter_class) {
            if (elem_has_init_counter_class) {
              $timeout(function() {
                scope.$apply(function() {
                  element[0].classList.remove(elem_has_init_counter_class);
                })
              });
              if (!element[0].id) {
                var numCounterElems = document.querySelectorAll('[counter]').length + 1
                element[0].id = 'counter-' + numCounterElems;
              }
              var counterArgs = {
                  useEasing : false,
                  useGrouping : false,
                  separator : ',',
                  decimal : '.',
                  prefix : counterPrefix ,
                  suffix : counterSuffix
              }
              var counterDelay = attr.counterDelay;
              var counterInfinite = attr.counterInfinite;
              var counterDuration = attr.counterDuration;
              if ('counterInfinite' in attr) {
                var counterTimeBetween = attr.counterInfiniteInBtwn || 0;
                if (counterDelay) {
                  $timeout(function() {
                    $interval(function() {
                      var countUpInstance = new CountUp(element[0].id, parseInt(counterMin), parseInt(counterMax), 0, parseInt(counterDuration), counterArgs);
                      countUpInstance.start();
                    }, parseInt(counterDuration) * 1000 + parseInt(counterTimeBetween) * 1000 + 1000)
                  }, parseInt(counterDelay))
                } else {
                  $interval(function() {
                    var countUpInstance = new CountUp(element[0].id, parseInt(counterMin), parseInt(counterMax), 0, parseInt(counterDuration), counterArgs);
                    countUpInstance.start();
                  }, parseInt(counterDuration) * 1000 + parseInt(counterTimeBetween) * 1000);
                }

              } else {
                if (counterDelay) {
                  $timeout(function() {
                    var countUpInstance = new CountUp(element[0].id, parseInt(counterMin), parseInt(counterMax), 0, parseInt(counterDuration), counterArgs);
                    countUpInstance.start();
                  }, parseInt(counterDelay))
                } else {
                    var countUpInstance = new CountUp(element[0].id, parseInt(counterMin), parseInt(counterMax), 0, parseInt(counterDuration), counterArgs);
                    countUpInstance.start();
                }
              }
            }
          })
        }
      }

      function getClassArgIndex(arg_name, class_arr) {
        for (var i = 0; i < class_arr.length; i++) {
          var indexClass = class_arr[i];
          if (indexClass.indexOf(arg_name + ':') > -1) {
            return i;
          }
        }
      }

    }
  }
}])
.directive('activateOnClass', ['$timeout', function ($timeout) {
  return {
    restrict: 'A',
    link: function(scope, element, attr) {
      scope.$watch(function() {
        return element.attr('class');
      },function() {
        var classTriggers = attr.activateOnClass.split(', ');
        var classTriggerDict = {};
        for (var i = 0; i < classTriggers.length; i++) {
          var indexClassTrigger = classTriggers[i];
          if (element[0].classList.contains(indexClassTrigger)) {
            classTriggerDict[indexClassTrigger] = true;
          }
        }
        if (Object.keys(classTriggerDict).length > 0 &&  Object.keys(classTriggerDict).length === classTriggers.length) {
          var delay = attr.activateOnClassDelay || 0;
          $timeout(function() {
            element[0].classList.add('activate');
            for (var i = 0; i < classTriggers.length; i++) {
              element[0].classList.remove(classTriggers[i]);
            }
            $timeout(function() {
              scope.$apply();
            })
          }, delay)
        }
      });
    }
  }
}])
.directive('translateOnClass', ['$timeout', function ($timeout) {
  return {
    restrict: 'A',
    link: function(scope, element, attr) {
      $timeout(function() {
        scope.$watch(function() {
          return element.attr('class');
        },function(value) {
            if (!element.attr('class')) {
              console.log('ERROR TRANSLATE-ON-CLASS', 'needs at least one class to provide translate-on-class-functionality');
              return
            }
            var classNames = element.attr('class').split(' ');

              if (((classNames.indexOf('activate') > -1 && !('translateOnClass' in attr)) || classNames.indexOf(attr.translateOnClass) > -1) && attr.translateToElem) {
                element[0].classList.remove(attr.translateToElem);
                var elementBounding = element[0].getBoundingClientRect();
                var elemCoords = {height: elementBounding.height, width: elementBounding.width, top: elementBounding.top, left: elementBounding.left};
                var translateElem = attr.translateToElem;
                var translateElemBounding = document.querySelector(translateElem) && document.querySelector(translateElem).getBoundingClientRect();
                var translateElemCoords = {height: translateElemBounding.height, width: translateElemBounding.width, top: translateElemBounding.top, left: translateElemBounding.left};
                var injectOnTranslateClass = 'translate-active';
                if (!element[0].style.webkitTransform && !element[0].style.MozTransform && !element[0].style.msTransform && !element[0].style.OTransform && !element[0].style.transform) {
                  var translateY = parseInt(translateElemCoords.top - elemCoords.top) + ((attr.translateYOffset && parseInt(attr.translateYOffset)) || 0);
                  var translateX = parseInt(translateElemCoords.left - elemCoords.left) + ((attr.translateXOffset && parseInt(attr.translateXOffset)) || 0);
                  var transFormString = "translate(" + translateX + "px, " + translateY + "px)"
                  var delay = attr.translateOnClassDelay || 0;
                  if (delay) {
                    $timeout(function() {
                      element[0].style.webkitTransform = transFormString;
                      element[0].style.MozTransform = transFormString;
                      element[0].style.msTransform = transFormString;
                      element[0].style.OTransform = transFormString;
                      element[0].style.transform = transFormString;
                      element[0].classList.add(injectOnTranslateClass, 'active');
                    }, delay);
                  } else {
                    element[0].style.webkitTransform = transFormString;
                    element[0].style.MozTransform = transFormString;
                    element[0].style.msTransform = transFormString;
                    element[0].style.OTransform = transFormString;
                    element[0].style.transform = transFormString;
                    element[0].classList.add(injectOnTranslateClass, 'active');
                  }

                }
              }
        });
      })
    }
  }
}])
.directive('translateOnClick', ['$timeout', function ($timeout) {
    // add 'translate-to-click' to element to "declare" directive. "translate-active" is added to element if element does not have transform properties && transforms
    // add 'translate-to-elem'="#sample-selector" to element to link destination element
    // add 'translate-x-offset'="200" to add 200px X offset (origin = bottom left);
    // add 'translate-y-offset'="200" to add 200px Y offset (origin = bottom left);
    // add 'scale-x-on-click'="1.3" scales x by 1.3
    // add 'translate-on-click-duration'="2.0" scales x by 1.3
    // add 'translate-on-click-delay'="1000" sets transition duration to 1000ms
    // add 'scale-y-on-click'="0.7" scales y by 0.7
    // add [NOT SUPPORTED YET] 'translate-back-class'="untransform-class-name1, untransform-class-name-2" adds the argument/class(es) when the transform is set to null (when element with attribute transforms)
    return {
        restrict: 'A',
        link: function(scope, element, attr) {
            element.on('click', function() {
              var elementBounding = element[0].getBoundingClientRect();
              var elemCoords = {height: elementBounding.height, width: elementBounding.width, top: elementBounding.top, left: elementBounding.left};

              var translateElem = attr.translateToElem;
              var translateElemBounding = document.querySelector(translateElem).getBoundingClientRect();
              var translateElemCoords = {height: translateElemBounding.height, width: translateElemBounding.width, top: translateElemBounding.top, left: translateElemBounding.left};
              var injectOnTranslateClass = attr.translateOnClick || 'translate-active';
              var scaleString = "";
              if (!element[0].style.webkitTransform && !element[0].style.MozTransform && !element[0].style.msTransform && !element[0].style.OTransform && !element[0].style.transform) {
                var translateY = parseInt(translateElemCoords.top - elemCoords.top) + ((attr.translateYOffset && parseInt(attr.translateYOffset)) || 0);
                var translateX = parseInt(translateElemCoords.left - elemCoords.left) + ((attr.translateXOffset && parseInt(attr.translateXOffset)) || 0);
                var scaleX = (attr.scaleXOnClick && parseFloat(attr.scaleXOnClick)) || 1.0;
                var scaleY = (attr.scaleXOnClick && parseFloat(attr.scaleYOnClick)) || 1.0;
                var transFormString = "translate(" + translateX + "px, " + translateY + "px)"
                var scaleString = " scale(" + scaleX + ',' + scaleY + ')'
                element[0].style.webkitTransform = transFormString + scaleString;
                element[0].style.MozTransform = transFormString + scaleString;
                element[0].style.msTransform = transFormString + scaleString;
                element[0].style.OTransform = transFormString + scaleString;
                element[0].style.transform = transFormString + scaleString;
                if (attr.translateOnClickDelay && attr.translateOnClickDelay.length) {
                  var translateDelay = parseInt(attr.translateOnClickDelay);
                  element[0].style.webkitTransitionDelay = translateDelay + "ms";
                  element[0].style.MozTransitionDelay = translateDelay + "ms";
                  element[0].style.msTransitionDelay = translateDelay + "ms";
                  element[0].style.OTransitionDelay = translateDelay + "ms";
                  element[0].style.transitionDelay = translateDelay + "ms";
                }
                if (attr.translateOnClickDuration && attr.translateOnClickDuration.length) {
                  var translateDuration = parseInt(attr.translateOnClickDuration);
                  element[0].style.webkitTransitionDuration = translateDuration + "ms";
                  element[0].style.MozTransitionDuration = translateDuration + "ms";
                  element[0].style.msTransitionDuration = translateDuration + "ms";
                  element[0].style.OTransitionDuration = translateDuration + "ms";
                  element[0].style.transitionDuration = translateDuration + "ms";
                }
                //deactivate other directives with transforms towards the same element "translate-to-elem";
                var allTranslateOnClickElems = document.querySelectorAll('.' + injectOnTranslateClass + ".active");
                element[0].classList.add(injectOnTranslateClass, 'active', 'recently-active');
                for (var i = 0; i < allTranslateOnClickElems.length; i++) {
                  var indexTranslateElem  = allTranslateOnClickElems[i];
                  if (indexTranslateElem !== element[0]) {
                        indexTranslateElem.classList.remove(injectOnTranslateClass, 'active');
                        indexTranslateElem.style.webkitTransform = null;
                        indexTranslateElem.style.MozTransform = null;
                        indexTranslateElem.style.msTransform = null;
                        indexTranslateElem.style.OTransform = null;
                        indexTranslateElem.style.transform = null;
                      }
                    }
                }
                $timeout(function() {
                  element[0].classList.remove('recently-active');
                }, 500);
            });
      }
    };
}]).
directive("classOnLoad", ["$timeout", 'AnimationService', function ($timeout, AnimationService) {
      return {
          restrict: 'A',
          link: function(scope, element, attr) {
              $timeout(function() {
                scope.$watch('root.loader.body.hide', function(value) {
                  if (value) {
                    var delay = attr.classOnLoadDelay || 0;
                    var classes = attr.classOnLoad.split(", ");
                    $timeout(function() {
                      for (var i = 0; i < classes.length; i++) {
                        var indexClass = classes[i].split(":")[0];
                        var classArgs = classes[i].split(":").slice(1);
                        if (classArgs.indexOf("animIn") > -1) {
                          if (classArgs.indexOf("keep") > -1) {
                            indexClass = indexClass +':keep';
                          }
                          AnimationService.animateIn(element[0], indexClass);
                        } else {
                          indexClass && element[0].classList.add(indexClass);
                        }
                      }
                      scope.$apply();
                    }, delay)
                  }
                });
              })
          }
      };
}]).

directive("elemStates", ["$timeout", 'AnimationService', 'UtilitiesService', function ($timeout, AnimationService, UtilitiesService) {
      return {
          restrict: 'A',
          link: function(scope, element, attr) {
              //if its not an array then not qualified
              if (attr.elemStates.indexOf(']') === -1 || attr.elemStates.indexOf('[') === -1) return;
              var elemStates = UtilitiesService.removeAllOccurrancesArr(attr.elemStates, ['[', ']', ' ', "'", '"']).split(',')
              var processedElemStates = [];
              var elemClassAnimDict = {};
              for (var i = 0; i < elemStates.length; i++) {
                var onEnterAttr = 'on-' + elemStates[i] + '-enter';
                var onExitAttr = 'on-' + elemStates[i] + '-exit';

                //check if you defined those attr
                if (camelCase(onEnterAttr) in attr) {
                  processedElemStates.push(onEnterAttr);
                }
                if (camelCase(onExitAttr) in attr) {
                  processedElemStates.push(onExitAttr);
                }
              }
              for (j = 0; j < processedElemStates.length; j++)  {
                var attrName = processedElemStates[j];
                var animClass = element[0].getAttribute(attrName);

                if (animClass.indexOf(':animIn') === -1 && animClass.indexOf(':animOut') === -1 && animClass.indexOf(':anim') > -1) {
                  animationClass = animClass.split(':anim')[0];
                  animationObj = AnimationService.getCSSAnimationFromClassName(animationClass);
                  elemClassAnimDict[attrName] = animationObj;
                }
              }
              if (!element.attr('class')) {

                element[0].setAttribute('class', '');
              }

              scope.$watch(function() {

                return element.attr('class');
              }, function(newValue, oldValue) {
                for (var i = 0; i < processedElemStates.length; i++) {

                  if (newValue.split(' ').indexOf(processedElemStates[i]) > -1) {
                    element[0].classList.remove(processedElemStates[i]);
                    var elemStateValue = attr[camelCase(processedElemStates[i])];
                    var elemStateClass = elemStateValue.split(':')[0];
                    var elemArgDict = parseElemStateAttrValueArgs(elemStateValue.split(':').splice(1));

                    if (elemArgDict.unique) {
                    //   $timeout(function() {
                        var elemsThatAlreadyHaveClass = document.querySelectorAll('.' + elemStateClass) || [];
                        for (var i = 0; i < elemsThatAlreadyHaveClass.length; i++) {
                          elemsThatAlreadyHaveClass[i].classList.remove(elemStateClass);
                        }
                    //   });
                    // console.log(element[0], elemArgDict.unique, elemStateClass);
                    }
                    if (elemArgDict.animateIn) {

                      AnimationService.animateIn(element[0], elemStateClass, elemArgDict.delay);
                    } else if (elemArgDict.animateOut) {

                      AnimationService.animateOut(element[0], elemStateClass, elemArgDict.delay);
                    } else if (elemArgDict.animate) {

                      console.log(element[0], elemArgDict, elemStateClass, elemClassAnimDict);
                      AnimationService.animate(element[0], elemStateClass, elemClassAnimDict[processedElemStates[i]], elemArgDict.delay || 0);
                    }
                    else if (elemStateClass && elemStateClass.length && elemStateClass !== 'null') {

                      element[0].classList.add(elemStateClass);
                      if (elemArgDict.remove && elemArgDict.remove.length) {
                        if (elemArgDict.delay) {
                          $timeout(function() {
                            element[0].classList.remove(elemArgDict.remove);
                          }, elemArgDict.delay);
                        } else {
                          element[0].classList.remove(elemArgDict.remove);
                        }
                      }
                    }

                    if (elemArgDict.inject_elems && !elemArgDict.delay) {

                        for (var k = 0; k < elemArgDict.inject_elems.length; k++) {
                          elemArgDict.inject_elems[k].classList.add(elemArgDict.inject_class);
                        }
                    } else if (elemArgDict.inject_elems && elemArgDict.delay) {
                      $timeout(function() {
                        for (var k = 0; k < elemArgDict.inject_elems.length; k++) {
                          elemArgDict.inject_elems[k].classList.add(elemArgDict.inject_class);
                        }
                      }, parseInt(elemArgDict.delay))
                    }

                  }
                }
              });
          }
      }
}]).
directive("classOnClick", ["$timeout", 'AnimationService', function ($timeout, AnimationService) {
      return {
          restrict: 'A',
          link: function(scope, element, attr) {
              element.on("click", function() {
                var delay = attr.classOnClickDelay || 0;
                var classes = attr.classOnClick.split(", ");
                $timeout(function() {
                    for (var i = 0; i < classes.length; i++) {
                      var indexClass = classes[i].split(":")[0];
                      var classArgs = classes[i].split(":").slice(1);
                      if (classArgs.indexOf("animIn") > -1) {
                        if (classArgs.indexOf("keep") > -1) {
                          indexClass = indexClass +':keep';
                        }
                        AnimationService.animateIn(element[0], indexClass);
                      } else
                      if (classArgs.indexOf("animOut") > -1) {
                        if (classArgs.indexOf("keep") > -1) {
                          indexClass = indexClass +':keep';
                        }
                        AnimationService.animateOut(element[0], indexClass);
                      }else {
                        element[0].classList.add(indexClass);
                      }
                      if (classArgs.indexOf("unique") > -1) {
                        var otherClassElems = document.querySelectorAll('.' + indexClass);
                        for (var j = 0; j < otherClassElems.length; j++) {
                          var otherElemIndex = otherClassElems[j];
                          if (otherElemIndex !== element[0]) {
                            otherElemIndex.classList.remove(indexClass);
                          }
                        }
                      }
                      if (indexClass.indexOf('inject') > -1) {

                        var injectArgClassSplit = indexClass.split("|")
                        if (injectArgClassSplit.length > 1) {
                          var classToInject = injectArgClassSplit[1];
                          var elemToInjectSelector = injectArgClassSplit[0];
                          var elemsToInject = document.querySelectorAll(elemToInjectSelector);
                          for (var k = 0; k < elemsToInject.length; k++) {
                            elemsToInject[k].classList.add(classToInject);
                          }
                        }
                        // var otherClassElems = document.querySelectorAll('.' + indexClass);
                        // for (var j = 0; j < otherClassElems.length; j++) {
                        //   var otherElemIndex = otherClassElems[j];
                        //   if (otherElemIndex !== element[0]) {
                        //     otherElemIndex.classList.remove(indexClass);
                        //   }
                        // }
                      }
                    }
                }, delay);
              });
            }
          }
}])
// .directive('onHover', ['$timeout', 'AnimationService', function ($timeout, AnimationService) {
//   return {
//     restrict: 'A',
//     link: function(scope, element, attr) {
//       var inTimeout = false;
//       var hoverAnim = attr.onHover.split(':')[0];
//       var hoverDelay = 250;
//       if (attr.onHover.split(':').length === 2 && attr.onHover.indexOf('delay-') > -1) {
//         hoverDelay = parseInt(attr.onHover.split(':')[1].replace('delay-', ''));
//       }
//       scope.$watch(function() {
//           return element.attr('class');
//         }, function(new_class) {
//           if (!new_class) {
//             element[0].className = ''
//           }
//           if (new_class && new_class.indexOf('activate-hover') > -1) {
//             element[0].classList.remove('activate-hover');
//             AnimationService.animateIn(element[0], hoverAnim, null);
//           }

//         })
//       element.on('mouseover', function () {
//         inTimeout = true;
//         $timeout(function () {
//           if (inTimeout) {
//             AnimationService.animateIn(element[0], hoverAnim, null);
//             scope.$apply();
//           }
//         }, 250 + hoverDelay);
//       });
//        element.on('mouseleave', function () {
//         inTimeout = false;
//       });
//     }
//   }
// }])



function isElementInViewport (el) {

    //special bonus for those using jQuery
    if (typeof jQuery === "function" && el instanceof jQuery) {
        el = el[0];
    }

    var rect = el.getBoundingClientRect();

    return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) && /*or $(window).height() */
        rect.right <= (window.innerWidth || document.documentElement.clientWidth) /*or $(window).width() */
    );
}
function removeAllOccurrancesArr(str, remove_arr_str) {
  for (var i = 0; i < remove_arr_str.length; i++) {
    var indexRemoveStr = remove_arr_str[i];
    str = replaceAll(str, indexRemoveStr, '');
  }
  return str;
}

function replaceAll(str, find, replace) {
  return str.replace(new RegExp(escapeRegExp(find), 'g'), replace);

  function escapeRegExp(str) {
      return str.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1");
  }

}
function camelCase(input) {
    return input.toLowerCase().replace(/-(.)/g, function(match, group1) {
        return group1.toUpperCase();
    });
}

function classArgsHasInject(args) {
  console.log(args);
  return (args && args.length && (args.split('inject').length > 1)) || "";
}

function parseElemStateAttrValueArgs(arg_arr) {
    var resultDict = {};
    for (var i = 0; i < arg_arr.length; i++) {
      var indexArg = arg_arr[i];

      if (!indexArg || !indexArg.length) continue;

      if (indexArg === "animIn") {
        resultDict.animateIn = true;
      }
      if (indexArg.indexOf('delay-') > -1) {
        resultDict.delay = parseInt(indexArg.replace('delay-', ''))
      }
      if (indexArg === 'animOut') {
        resultDict.animateOut = true;
      }

      if (indexArg.indexOf('remove|') > -1) {
        resultDict.remove = indexArg.replace('remove|', '');
      }

      if (indexArg === 'anim') {
        resultDict.animate = true;
      }

      if (indexArg.indexOf('unique') > - 1) {
        if (indexArg.split('|').length === 2) {
          var supportedPipeArgs = ['hide', 'show', 'opacity-0'];
          var pipeArg = indexArg.split('|')[1];
          if (supportedPipeArgs.indexOf(pipeArg) > -1) {
            var pipe_index = supportedPipeArgs.indexOf(pipeArg);
            resultDict['unique_' + supportedPipeArgs[pipe_index]] = true;
          }
        }
        resultDict.unique = true;
      }
      // var hasInject = classArgsHasInject(indexArg);

      if (indexArg.indexOf('inject') > -1) {
        indexArg = indexArg.replace("inject", "");
        var injectArgClassSplit = indexArg.split("|");
        if (injectArgClassSplit.length > 1) {
          var classToInject = injectArgClassSplit[1];
          var elemToInjectSelector = injectArgClassSplit[0];
          var elemsToInject = elemToInjectSelector && document.querySelectorAll(elemToInjectSelector + '[' + classToInject + ']');
          if (elemsToInject && elemsToInject.length && elemToInjectSelector.length) {
            resultDict.inject_elems = elemsToInject;
            resultDict.inject_class = classToInject;
          }
        }
      }
    }
    return resultDict;
  }


angular.module('uguru.shared.directives')
.directive('date', function () {
    return {
        templateUrl: 'shared/templates/components/calendar/date.tpl',
        restrict: 'E',
        link: function preLink(scope, element, attr) {
          scope.date = attr.date || new Date().getDate();
          scope.day = attr.day;
        }
    };
})
.directive('week', ['DateService', function (DateService) {
    return {
        templateUrl: 'shared/templates/components/calendar/week.tpl',
        restrict: 'E',
        replace: true,
        link: function preLink(scope, element, attr) {
          var today = new Date()
          var numWeeks = attr.num || 1;
          scope.dates = [];
          var iDate = today;
          for (var i = 0; i < 7* parseFloat(numWeeks); i++) {
            scope.dates.push({
              date: iDate.getDate(),
              day: DateService.getShortDayName(iDate.getDay())
            })
            iDate.setDate(iDate.getDate() + 1);
          }

          // scope.dates = attr.date || new Date().getDate();
          // scope.day = attr.day;
        }
    };
}]);

// todo now
// - animName: in, out, set, before, after, send, setTemp
// - anim
// - tween
// - verify trigger

// todo later
// - trigger args
// - replace trigger scope.watch for 'on' states with a class that initiates the watcher (to prevent future watchers)


// var customModule = angular.module('uguru.shared.directives.custom', [])
angular.module('uguru.shared.directives', [])


// todo now
// - animName: in, out, set, before, after, send, setTemp
// - anim
// - tween
// - verify trigger

// todo later
// - trigger args
// - replace trigger scope.watch for 'on' states with a class that initiates the watcher (to prevent future watchers)


.directive('transcluder', function() {
// http://stackoverflow.com/questions/24615103/angular-directives-when-and-how-to-use-compile-controller-pre-link-and-post
    return {
        controller: ["$scope", "$element", "$attrs", "$transclude", function( $scope, $element, $attrs, $transclude ) {
            console.log( $attrs.log + ' (controller)' );
        }],
        compile: function compile( tElement, tAttributes ) {
            console.log( tAttributes.log + ' (compile)'  );
            return {
                pre: function preLink( scope, element, attributes ) {
                    console.log( attributes.log + ' (pre-link)'  );
                },
                post: function postLink( scope, element, attributes ) {
                    console.log( attributes.log + ' (post-link)'  );
                }
            };
         }
     };

})

.directive('start', ['CompService', function(CompService) {
  return {
    restrict: 'A',
    compile: function(element, attr) {
      element.css('justify-content', 'flex-start');
    }
  }
}])
.directive('center', [function() {
  return {
    restrict: 'A',
    compile: function(element, attr) {
      element.css('justify-content', 'center');
    }
  }
}])
.directive('end', [function() {
  return {
    restrict: 'A',
    compile: function(element, attr) {
      element.css('justify-content', 'center');
    }
  }
}])

// .directive('import', function() {
//   return {
//     restrict: 'A',
//     priority: 100000,
//     replace:true,
//     templateUrl: function(element, attr) {
//       return attr.import;
//     }
//   }
// })
.directive('import', ['$parse', '$compile', '$timeout', '$rootScope', function($parse, $compile, $timeout, $rootScope) {
  return {
    restrict: 'E',
    replace:true,
    scope: false,
    templateUrl: function(element, attr) {

      var attrUrl = attr.url;
      if ($rootScope.ui && $rootScope.ui.data && 'set' in $rootScope.ui.data) {
        for (var setVar in $rootScope.ui.data.set) {
          var extended = $rootScope.ui.data.set[setVar];
          if (extended !== attr.url && attr.url.indexOf(extended) === -1) {
            attrUrl = attrUrl.replace(setVar, extended);
          }
        }
      }


      var urlSplit = attrUrl.split('.').splice(1);

      if (urlSplit.length === 2) {
        return attr.url
      }

      var ptr = $rootScope.ui.data
      // console.log(ptr, urlSplit)
      var hasSkip = false;
      urlSplit.forEach(function(url_split, i) {

         ptr = ptr[url_split]
         if (typeof ptr === 'object' && 'skip' in ptr) {
          hasSkip = true;
         }
      })
      if (hasSkip) {
        return 404
      }
      return  ptr
    },
    compile: function compile(element, attr) {
      return {
        pre: function preLink(scope, element, attr) {
          if (attr.let) {
            console.log(attr.let)
          }
        }
      }
    }
  }
}])

.directive('linkSrcData', ['XHRService', '$compile', '$timeout', '$rootScope', '$parse', function(XHRService, $compile, $timeout, $rootScope, $parse) {
  return {
    restrict: 'A',
    replace:true,
    scope:true,
    compile: function compile(element, attr) {

        var url;
        var mainUrl;
        if (attr.uSrc || window.location.href.split('8100').length > 1) {

          url = attr.linkSrcData || attr.uSrc || 'coach/static/data/site.json';
        } else if (attr.accessCode) {
          url = 'https://s3-us-west-1.amazonaws.com/ui-coach/users/' + attr.accessCode + '/app.json'
        }

        var varName = attr.linkDataName||url.split('/').reverse()[0].split('.')[0];
        var nestedVars = varName.split('.');
        mainUrl = nestedVars[0];

        if (url && url.length) {
          XHRService.getJSONFile(
            'GET',
            url,
            function(data) {
              var ptr = $rootScope;
              nestedVars.forEach(function(var_name, i) {
                ptr[var_name] = {};
                ptr = ptr[var_name];
              })
              ptr.data = data;

              $rootScope.components = data.components;
              // console.log('registering', data.components)

              // console.log(ptr.data)
              // varName = varName || 'app';

              // $rootScope[varName]= data;
            },
          {});

        }
        return {pre:
          function preLink(scope, p_elem, attr) {

            var watcherFuncCancel = $rootScope.$watch(mainUrl + '.data', function(obj) {
              var data = obj;

              scope[mainUrl] = obj;
              if (!obj || !mainUrl) return

              if ('components' in scope[mainUrl] && scope[mainUrl].components)  {
                var dataComponents = scope[mainUrl].components;
                for (component in scope[mainUrl].components) {
                    scope.root.customComponents.push({name: component, data: scope[mainUrl].components[component]});
                }

                for (component in dataComponents) {

                  var template_url = dataComponents[component].template_url
                  var fields = dataComponents[component].fields
                  var comp_scope = {};
                  if (fields && fields.length) {
                    fields.forEach(function(field_name) {
                      comp_scope[field_name] = '=' + field_name
                    })
                  }
                  angular.module('uguru.shared.directives').directive(component, ['$compile', function($compile) {
                    return {
                      restrict: 'E',
                      templateUrl: template_url,
                      scope: {background: '=background'},
                      replace: true,
                      link: {
                        pre: function preLink(_scope, _element, _attr) {
                          console.log('it gets pre linked')
                          for (attr_name in attr) {
                            console.log(attr_name, attr)
                            if (fields.indexOf(attr_name) > -1) {
                              scope[attr_name] = attr[attr_name]
                            }
                          }
                        }
                      }
                    }
                  }])


                }

              }





            })
          }
        }
      }
  }
}])
// templateUrl: function(element, attr) {
//       return $rootScope.components[element[0].nodeName.toLowerCase]
//     },
.directive('listData', ['$rootScope', 'DataService', '$compile', function($rootScope, DataService, $compile) {
  return {
    restrict: 'A',
    replace:true,
    priority: 100000,
    compile: function(element, attr) {
      var dataParams = attr.listData;

      if (!dataParams || !dataParams.length) return;

      var dataGetAttr = attr.listData;
      if (dataParams.indexOf('=') > -1) {
        dataGetAttr = dataParams.split('=')[1];
      }

      var dataObj = DataService.detectDataType(element, dataGetAttr);
      var limitTo = attr.listLimit && parseInt(attr.listLimit) || dataObj.data.length;
      var resultHtml = '';
      element[0].removeAttribute('list-data');
      element[0].removeAttribute('list-limit');
      element[0].setAttribute('data', dataObj.name);
      var outerHtml = element[0].outerHTML;
      var elem_name = element[0].nodeName.toLowerCase();
      for (var i = 0; i < limitTo; i++) {
        var outerHtmlCp = outerHtml + '';
        resultHtml += outerHtmlCp.replace(dataObj.name, dataObj.name + '[' + i + ']').replace('<' + elem_name, '<' + elem_name + ' custom');
      }
      element.replaceWith(angular.element(resultHtml))
    }

  }
}])
.directive('listDataArchive', ['XHRService', 'DataService', '$compile', '$parse', '$rootScope', function(XHRService, DataService, $compile, $parse, $rootScope) {
  return {
    restrict: 'A',
    priority: 10000,
    scope: false,
    compile: function(element, attr) {
      var dataParams = attr.listData;

      if (!dataParams || !dataParams.length) return;

      var dataGetAttr = attr.listData;
      if (dataParams.indexOf('=') > -1) {
        dataGetAttr = dataParams.split('=')[1];
      }

      var dataObj = DataService.detectDataType(element, dataGetAttr);
      var limitTo = attr.listLimit && parseInt(attr.listLimit) || dataObj.data.length;

      element.removeAttr('listData')
      attr.$set('ngRepeat', attr.listItem + ' in ::' +  dataObj.name + ' track by $index');
      attr.$set('ngInclude', '"' +  $rootScope.components[element[0].nodeName.toLowerCase()].template_url + '"');




      // var resultHtml = '';
      // attr.$set('listData', '')
      // var outerHtml = element[0].outerHTML;



      // // var elem = angular.element(resultHtml);
      // // element.contents(elem);

      // return function(scope, _element, _attr, ctrl) {
      //   transclude(scope, function(clone, inner_scope) {
      //     var result = [];
      //     dataObj.data.forEach(function(_, i) {
      //       if (i >= listBounds.start && i < listBounds.end) {
      //         var extHtml = outerHtml + '';
      //         extHtml = extHtml.replace('list-data=""', 'data="' + dataObj.data[i] + '" custom');
      //         console.log($compile(angular.element(extHtml))(scope)[0])
      //         // console.log($compile(extHtml)(scope)[0]);
      //         result.push(angular.element(extHtml));
      //       }
      //     });
      //     _element.replaceWith(result)

      //   })
      // }

    }
  }
}])
.directive('main', ['$rootScope', 'LoaderService', '$compile', '$timeout', function($rootScope, LoaderService, $compile, $timeout) {
  return {
    restrict: 'E',
    transclude:true,
    controllerAs: 'main',
    require: '^?view',
    controllerAs:'main',
    controller: ["$element", "$scope", "$attrs", "$transclude", function main($element, $scope, $attrs, $transclude) {
      // $element.parent().replaceWith($element);
      var main = this;
      main.elems = {pre: null, post: null};
      main.loader = $scope.view && $scope.view.loader;
      main.elems.post = $transclude(function(transEl, transScope) {
        main.elems.pre = transEl;
        main.elems.scope = transScope;
      })
      main.element = $element;
      $scope.view.main = main;

      main.loader = $scope.view.loader;

      if ($scope.view.loader.exists) {
        $scope.$watch('view.loader.complete', function(value) {
          if (value) {
            console.log(value)
          }

        })
      } else {
        if (!$attrs.minMs && !$attrs.loader && !$scope.view.loader.started) {
          $element.append($transclude($scope))
        }
      }
      // else {


        // console.log(main.elems.post);

      // }


    }],
    link:  {
      pre:
        function preLink(scope, elem, attr, ctrl, tr) {
          if (attr.minMs) {

            ctrl.main.loader = {watcher: null};
            ctrl.main.loader.timer = parseInt(attr.minMs);
            ctrl.main.loader  = $timeout(function() {

              elem.empty();

              elem.append($compile(ctrl.main.elems.post)(scope));

            }, ctrl.main.loader.timer);
          } else if (!attr.minMs && !attr.loader) {
            // elem.empty();
            var innerElem = $compile(ctrl.main.elems.post)(ctrl.main.elems.scope);
            if (scope.view.loader.started)  {
              var watcher = scope.$watch('view.loader.complete', function(value) {
                if (value) {
                  elem.empty();
                  // var innerElem = tr(scope, function(transEl, transScope) {
                  // })
                  elem.append(innerElem)
                  watcher();
                }
              } )
            } else {
              // elem.empty();

              // elem.append(ctrl.main.elems.post)
            }

            // view.loader.complete
          }

          // console.log('it gets here')

          // ctrl.main.elems.scope.$destroy();
          // elem.append(ctrl.main.elems.post);
          // console.log(elem[0], )
          // elem.replaceWith(ctrl.main.elems.post)
        },
      post:
        function postLink(scope) {
          // console.log(scope)
        }
      }
    }
}])
.directive('replaceMe', function() {
  return {
    transclude: 'E',
    template: function(elem, attr) {
      return '<ng-transclude ng-transclude-slot="' + attr.with + '"></ng-transclude>'
    },
    link: function(scope, elem, attr, ctrl, tr) {
      elem.append(tr(scope));
    }
    // link: function(scope, elem, attr, ctrl, tr) {
    //   console.log('template', elem[0])
    //   elem.append(tr());
    //   // console.log($element, )
    // }
  }
})
// .directive('components',['$compile', function($compile) {
//   return {
//     restrict: 'E',
//     transclude: 'element',
//     link: function(scope, elem, attr, ctrl, tr) {

//       var response = tr(function(inner_elem, inner_scope) {
//         console.log(inner_elem[0].innerHTML)
//       });
//       console.log(response.children()[0])

//     }
//   }
// }])

.directive('external', ['$rootScope', 'LoaderService', '$compile', function($rootScope, LoaderService, $compile) {
  return {
    restrict: 'E',
    transclude:true,
    controllerAs: 'external',
    templateUrl: function(element, attr) {
      return ('import' in attr && attr.import) || ('url' in attr && attr.url) || 'ui/templates/components/base/external.tpl'
    },
    compile: function(element, attr, transclude) {
      element.attr('view', 'view');
      // element.attr('logic', 'logic');


      return function(scope, elem, attrs, ctrl, tr) {
        console.log(scope);
      }
    },
    controller: ["$element", "$scope", "$transclude", function($element, $scope, $transclude) {
      // $element.parent().replaceWith($element);
      console.log($scope.view)

      $scope.$watch('view.loader.complete', function(value) {
        if (value) {
          $transclude($scope, function(transEl, transScope) {
            $element.append($compile(transEl)(transScope))
          })
        }

      })
    }]
    }
}])
.directive('loader', ['$rootScope', 'LoaderService', '$compile', '$timeout', function($rootScope, LoaderService, $compile, $timeout) {
  return {
    restrict: 'E',
    transclude:true,
    controllerAs: 'loader',
    templateUrl: function(element, attr) {

      return ('import' in attr && attr.import) || ('url' in attr && attr.url) || 'ui/templates/components/base/loader.tpl'
    },
    compile: function(element, attr, transclude) {
      if (attr.skip) {
        element.replaceWith(angular.element('<!-- Skipping ' + element[0].nodeName + '-->'));
      }
      element.attr('loader');
      element.attr('view', 'view');
      element.attr('logic', 'logic');

      return function(scope, elem, attrs, ctrl, tr) {
        elem.append($compile(transclude(scope))(scope));
      }
    },
    controller: ["$scope", "$element", "$attrs", "$transclude", "$parse", function($scope, $element, $attrs, $transclude, $parse) {
      // var this = scope;
      $scope.root = {scope: $rootScope};
      $scope.public = {customStates: {when:{}}}

      var loader = this;
      loader.info = {width: 0, height: 0};

      // $transclude($scope, function(elem, inner_scope) {
      //   $element.append(elem)
      // })
    console.log($element[0])

      loader.attr = LoaderService.renderLoaderAttrs($scope, $attrs, loader.info);
      loader.duration = $attrs.ms && parseInt($attrs.ms) || 1000;



      // if (!('bg' in $attrs)) {
      //   loader.info['background-color'] = LoaderService.getParentBgColor($element, $attrs);
      // }


      var loaderParent = $element.parent()[0] || $element[0].parentNode;

      var loaderParentCoords;
      loaderParentCoords = loaderParent && 'getBoundingClientRect' in loaderParent && loaderParent.getBoundingClientRect() || {};

      loader.info.height = loaderParentCoords.height || '100%';
      loader.info.width = loaderParentCoords.width || '100%';
      $scope.view.loader.started = true;

      $element.ready(function() {

        $timeout(function() {
          $scope.view.loader.complete = true;
          $element.parent().empty();

        }, loader.duration);
      });


      // loader.watchers = {parentHeight: 0};
      // loader.watchers.infoHeight = $scope.$watch('loader.info.height', function(val) {
      //   if (val) {


      //     // ctrl.watchers.parentHeight();
      //     loader.watchers.infoHeight();
      //     this.info.opacity = 1;

      //     LoaderService.setInheritedCSS(elem, this.info)
      //     if (scope.loader.info.minMs) {
      //       $timeout(function() {
      //         $element.parent().replaceWith(angular.element("<!-- -->"));
      //       }, scope.loader.info.minMs || 1000 +  scope.loader.info.minMs || 500)
      //     }
      //   }
      // })
    }]
  }
}])
.directive('linkData', ['XHRService', '$compile', '$timeout', '$rootScope', '$parse', 'CompService', function(XHRService, $compile, $timeout, $rootScope, $parse, CompService) {
  return {
    restrict: 'A',

    scope: false,
    transclude: true,
    controller: ["$scope", "$transclude", "$element", function($scope, $transclude, $element) {
      $scope.view = {loader: {}};
      $scope.innerElems = {};
      $scope.innerElems.elements = $transclude($scope, function(transElem, transScope) {
        $scope.innerElems.clone = transElem;
        $scope.innerElems.scope = transScope;
      });
      $scope.preTranscludeElems = CompService.doesElemHaveLoader($scope.innerElems.elements);


      if ($scope.preTranscludeElems.loader) {

        $scope.innerElems.loader = $scope.preTranscludeElems.loader
        $scope.innerElems.loader.setAttribute('loader', '')

        $scope.innerElems.timer = new Date().getTime();
        $element.append($scope.innerElems.loader);

        // console.log(preTranscludeElems.remaining.forEach(function( item, i) {
        //   if ('innerHTML' in item) {
        //     item.style.opacity = 0;
        //   }
        // }))

      }
    }],
    compile: function compile(element, attr, transclude) {
      var scopeRef = null;
      if ('renderAfterExtScripts' in attr) {
        element[0].style.opacity = 0;
      }
      if ('let' in attr && attr.let && attr.let.split('=').length > 1) {
        var letSplit = attr.let.split('=');
        $rootScope.dataMappings[letSplit[0]] = {name: letSplit[1], view: attr.linkData};
      }


      XHRService.getJSONFile(
            'GET',
        attr.linkData,
        function(data) {

          $rootScope.dataCache.views[attr.linkData] = {data: data, name: attr.name || attr.linkData };
          if (scopeRef) {
            scopeRef[attr.setDataName || 'data'] = data;
          } else {
            $timeout(function() {
              scopeRef[attr.setDataName || 'data'] = data;
            },1)
          }
        },
      {});

      return {
        pre: function(scope, p_element, p_attr) {
          scopeRef = scope;
          var preTranscludeElems = scope.preTranscludeElems
          var innerElems = scope.innerElems;
          if ('renderAfterExtScripts' in attr) {
            scope.$watch('data.config.processed.scriptStatus.complete', function(value) {
              if (value) {

                  if (!$rootScope.activeView) {
                    $rootScope.activeView = {name: attr.linkDataName, data: scope.data};
                    // scope.$watch(attr.linkDataName + '.data', function(value) {
                        // if (value) {

                          // element.after(preTranscludeElems.remaining)

                              if (!preTranscludeElems.loader) {
                                transclude(scope, function(clone, innerScope) {
                                  if (attr.let && attr.let.length) {
                                    var letAttrSplit = attr.let.split('=');
                                    innerScope[letAttrSplit[0]] = $parse(letAttrSplit[1])(scope)
                                  }
                                  $compile(clone)(innerScope);

                                  element.append(clone);

                                })
                              }
                              else {
                                innerElems.loaderInfo = innerElems.scope.loader.info;
                                console.log()
                                var timeNow = new Date().getTime();

                                var maxLoadTime = innerElems.scope.loader.info.minMs || 1000;
                                var ttl_loader_complete = maxLoadTime - (timeNow - innerElems.timer);
                                console.log(ttl_loader_complete);
                                $timeout(function() {

                                  console.log(preTranscludeElems.loader, preTranscludeElems.loader.parent())
                                  preTranscludeElems.loader[0].outerHTML = '';
                                }, ttl_loader_complete)
                                  // transclude(scope, function(clone, innerScope) {
                                    if (attr.let && attr.let.length) {
                                      var letAttrSplit = attr.let.split('=');
                                      scope[letAttrSplit[0]] = $parse(letAttrSplit[1])(scope)
                                    }

                                    for (var i = 0; i < preTranscludeElems.remaining.length; i++) {
                                      console.log(preTranscludeElems.remaining[i])
                                      if (i !== preTranscludeElems.loaderIndex) {
                                        // if (preTranscludeElems.remaining[i].style) {
                                        //   preTranscludeElems.remaining[i].style.opacity = 0;
                                        // }
                                        $compile(preTranscludeElems.remaining[i])(scope);
                                      }
                                    }
                                    preTranscludeElems.loader = p_element.children();

                                    p_element.append(preTranscludeElems.remaining)


                                  // })





                                // var clone = preTranscludeElems.remaining;
                                // if (attr.let && attr.let.length) {
                                //     var letAttrSplit = attr.let.split('=');
                                //     scope[letAttrSplit[1]] = $parse(letAttrSplit[1])(scope)
                                // };

                                // transclude(scope, function(clone, innerScope) {
                                //   console.log(clone)
                                // })

                                //   // if (attr.let && attr.let.length) {
                                //   //   var letAttrSplit = attr.let.split('=');
                                //   //   innerScope[letAttrSplit[0]] = $parse(letAttrSplit[1])(scope)
                                //   // }
                                //   // $compile(clone)(scope);

                                //   element.append($compile(preTranscludeElems.remaining)(scope));
                                // // })


                              }

                            p_element[0].style.opacity = 1;
                        // }
                    // })
                }
              }
            })
          } else {
            if (!$rootScope.activeView) {
                    $rootScope.activeView = {name: attr.linkDataName, data: scope.data};
            }

            element.append(transclude(scope))
          }
            // if ('linkData' in attr && 'linkDataName' in attr) {

          // }

        },
        post: angular.noop
      }

    }
  }
}])
.directive('set', ['$parse', '$rootScope', function($parse, $rootScope) {
  return {
    restrict: 'E',
    priority: 100000,
    link: function(scope, element, attr) {
      var varDict =  {};
      for (_attr in attr.$attr) {
         varDict[attr.$normalize(_attr)] =  $parse(attr[_attr])(scope) || attr[_attr];
      }

      scope.$watch('view', function(value) {
        if (!('data'in value)) {
          value.data = {};
        }
        for (key in varDict) {
          value.data[key] = varDict[key];
        }


      })
    }
  }
}])
.directive('set', ['$parse', '$rootScope', function($parse, $rootScope) {
  return {
    restrict: 'A',
    priority: 100000,
    scope:false,
    link: function preLink(scope, element, attr) {
      if (!scope.vars) {
        scope.vars = {};
      }
      if ('set' in attr && attr.set.indexOf('=') > -1) {

        scope.$eval(attr['set']);
        scope.vars[attr['set'].split('=')[0].trim()] = attr['set'].split('=')[1].trim()
        scope[attr['set'].split('=')[0].trim()] = attr['set'].split('=')[1].trim()

      } else {

        for (key in attr.$attr) {
          var valueSplit = attr[key].split('|');
          var value;
          if (valueSplit.length === 2) {
            if (valueSplit[1] === 'num') {
              value = parseInt(valueSplit[0]);
            }
          } else {
            value = valueSplit[0];
          }
          scope.$parent.$eval(key +'=' + value);
          scope.vars[key] = value;
          // scope[key] = value;
        }
      }






      // scope.$eval(attr.set);




        // if (setVars && setVars.length > 1 && setVars[0].length > 1) {

        //   scope[varName] = $parse(varVal)(scope)
        //   // console.log(setVars[0].trim(),




        // }
    }

  }
}])
.directive('syncWith', ['UtilitiesService', '$timeout', function(UtilitiesService, $timeout) {
  return {
    restrict: 'A',
    scope: false,
    link: {
      post: function(scope, element, attr) {
          scope.$watch('scroll.y', function(new_val, old_val) {
            element[0].style['transitionDuration'] = 100/Math.abs(old_val - new_val)
            element[0].style['opacity'] = (new_val/100)
          })
      }
    }
  }
}])
// .directive("id", ["$compile", "RootService", "$timeout", function($compile, RootService, $timeout) {
//   return {
//     restrict: 'A',
//     scope: false,
//     priority: 1000,
//        compile: function(element, attr) {


//           if (!(attr.id in RootService.elemIdCache)) {
//               var elementRect = element[0].getBoundingClientRect();
//               RootService.elemIdCache[attr.id] = JSON.parse(JSON.stringify(elementRect));
//           }

//        }
//    }
//   }])
.directive("counter", ["$compile", "ElementService", "$timeout", function($compile, ElementService, $timeout) {
  return {
    restrict: 'A',
    scope: false,
    link: {
       compile: function(element, attr, transclude) {
        elem, name, value, name_camel;
            this.states = ElementService.renderState(elem, name, value, name_camel);
            var states = this.states;
        }
    }
  }
}])

.directive('staggerChildren', ['UtilitiesService', 'DirectiveService', '$timeout', '$compile', function(UtilitiesService, DirectiveService, $timeout, $compile) {
  return {
    restrict: 'AE',
    replace:true,
    transclude:true,
    priority: 100,
      compile: function(element, attr, transclude) {
        // element[0].style.display = 'none';
          var elems = element[0].querySelectorAll('*')
          var attrDelay = attr.delay
          var attrInterval = attr.interval;
          var attrApply = attr.apply;
          var attrLength = element[0].attributes.length;
          var staggerDict = {};
          var postponedElem = [];
          //

          var stagDict = DirectiveService.processStaggerArgs(attr)
          // console.log('its compiling', attr.onEnter)

          return {
            post: function postLink(lScope, lElem, lAttr) {
              var parent = lElem.parent();


              parent && parent.children().length && parent[0].removeChild(lElem[0])
                  transclude(lScope, function(clone, innerScope) {

                    var clonedChildrenWithAttr = [];
                    console.log(clone)

                    // for (var i = 0; i < clone.length; i++) {
                    //   // console.log(angular.element(clone[i]).parent())
                    //   if (clone[i] && clone[i].attributes) {

                    //     clonedChildrenWithAttr.push(clone[i])
                    //   }
                    // }
                    // console.log(clonedChildrenWithAttr.length)
                    //go through each element
                    for (key in stagDict) {

                      var hasKey = key in stagDict && stagDict[key];
                      var stateTime = hasKey && 'time' in stagDict[key] && stagDict[key].time;
                      if (hasKey && stateTime && (!stateTime.values || !stateTime.values.length)) {
                        console.log
                        if (stateTime.valueFunc) {
                          stateTime.valueFunc(clone, stateTime);
                          // if ()
                        }
                      }
                    }
                    for (var i = 0; i < clone.length; i++) {
                      var iChild = clone[i];
                      for (key in stagDict) {
                          keyDashed = UtilitiesService.camelToDash(key).toLowerCase();

                          var hasAttribute = iChild.getAttribute && iChild.getAttribute(keyDashed);
                          if (hasAttribute && hasAttribute.length && stagDict[key].time) {



                            var keyAttr = hasAttribute
                            var selectorPrefs = stagDict[key].selector;

                            var matchesWithConstraints = DirectiveService.verifyStaggerChildSelector(selectorPrefs[0], iChild)
                            if (key.indexOf('when') > -1) {
                              console.log(stagDict[key], stagDict[key].time.values)
                            }
                            if (matchesWithConstraints && stagDict[key].time.values && stagDict[key].time.values.length) {
                              var delayVal = stagDict[key].time.values.shift();
                              // console.log(delayVal)
                              var extensionValue = '';
                              if (keyAttr.indexOf('^') > -1 && delayVal > 0) {
                                keyAttr = UtilitiesService.replaceAll(keyAttr, '^', 0);
                              }
                              if (delayVal > 0) {
                                extensionValue = ':' + 'delay-' + delayVal
                              }

                              // iChild.removeAttribute(keyDashed);
                              iChild.setAttribute(keyDashed, keyAttr + extensionValue);

                            }

                          }
                        }
                        iChild.removeAttribute && iChild.removeAttribute('style')
                        $compile(iChild)(innerScope)
                        clonedChildrenWithAttr.push(iChild);
                      }

                      clonedChildrenWithAttr.forEach(function(elem, i) {


                        // elem.setAttribute && setAttribute('style', '');
                        parent.append(elem)
                        // $compile(elem)(lScope)
                      })
                      $compile(parent)(lScope)

                  });

                },
          }
      }
  }
}])
// .directive('scrollable', ['UtilitiesService', '$timeout', function(UtilitiesService, $timeout) {
//   return {
//     restrict: 'A',
//     scope:false,
//     link: {
//       pre: function(scope, element, attr) {
//         var scrollCmds = getScrollParams(attr.scrollable);
//         var scrollName = scrollCmds.name;
//         scope.scroll = {x: 0, y:0};


//         var sListener = element[0].addEventListener('wheel', function(e) {
//           getImptWheelAttr(e, scrollCmds);
//           var offset = UtilitiesService.calcScrollOffset(element[0]);
//           scope.scroll.x = offset.x;
//           scope.scroll.y = offset.y;
//           $timeout(function() {
//             scope.$apply()
//           })
//         });

//         function getImptWheelAttr(e, elem_cmds) {
//           console.log(elem_cmds)
//           var overrideX = elem_cmds.override && elem_cmds.override.indexOf('x') > -1;
//           var overrideY = elem_cmds.override && elem_cmds.override.indexOf('y') > -1;
//           var sendEvents = 'send' in elem_cmds
//           etargetRect = e.target.getBoundingClientRect();
//           var deltaX = e.deltaX;
//           var deltaY = e.deltaY;
//           if (overrideX && Math.abs(deltaX) > Math.abs(deltaY)) {
//             e.preventDefault();

//           }
//           if (overrideY && Math.abs(deltaY) > Math.abs(deltaX)) {
//             e.preventDefault();
//           }

//           if (sendEvents) {
//             applySendEvents(e, elem_cmds);
//           }

//           return e;
//         }

//         function applySendEvents(e, elem_cmds) {
//           console.log(elem_cmds)
//           cmds = parseSendCommands(elem_cmds['send']);
//           var offset = UtilitiesService.calcScrollOffset(e.target);
//           for (var i = 0; i < cmds.length; i++) {
//             var dim = cmds[i].dim;
//             var oper = cmds[i].operand
//             var val = cmds[i].value;
//             var msgName = UtilitiesService.camelCase('when-' + cmds[i].eventName);

//             if (oper === '+' && !val) {
//               if (e['delta' + dim.toUpperCase()] > 0) {
//                 scope.$parent.root.public.customStates['when'][msgName] = {yOffset: offset.y/100}
//               }
//             }
//             if (oper === '=' && val) {
//               val = parseFloat(val.replace('%', ''))
//               if (val === offset[dim]) {
//                 console.log(offset, msgName, offset.y/100)
//                 scope.$parent.root.public.customStates['when'][msgName] = true
//               }

//             }
//             if (oper === '-' && !val) {
//               if (e['delta' + dim.toUpperCase()] < 0) {
//                 scope.$parent.root.public.customStates['when'][msgName] = {yOffset: offset.y/100}
//               }
//             }

//           }
//         }

//         function parseSendCommands(str) {
//           str = UtilitiesService.removeAllOccurrancesArr(str, ['(', ')']);
//           str = UtilitiesService.replaceAll(str, ' | ', '|');
//           triggers = str.split('|');
//           var commandArr = [];
//           for (var i = 0; i < triggers.length; i++) {
//             var triggerDict = {};
//             var iTrigSplit = triggers[i].split('@')
//             var iEvent = iTrigSplit[0];
//             var iConstraint = iTrigSplit[1];
//             triggerDict.eventName = iEvent;
//             triggerDict.dim = iConstraint[0];
//             triggerDict.operand = iConstraint[1];
//             triggerDict.value = iConstraint.length > 1 && iConstraint.substring(2, iConstraint.length)
//             commandArr.push(triggerDict);
//           }
//           return commandArr;
//         }

//         function getScrollParams(str) {
//           var _dict = {};
//           str=UtilitiesService.removeAllOccurrancesArr(str, ['[',']']);
//           str=UtilitiesService.replaceAll(str, ', ', ',');
//           var strSplit = str.split(':');
//           if (!strSplit.length > 1) return _dict;
//           strSplit = str.split(',')
//           for (var i = 0; i < strSplit.length; i++) {
//             var itemSplit = strSplit[i].split(':')
//             if (!itemSplit || !itemSplit.length) continue;
//             itemKey = itemSplit[0];
//             itemValue = itemSplit[1];
//             _dict[itemKey] = itemValue;
//           }
//           return _dict;
//         }
//       }
//     }
//   }
// }])
.directive('dynamicData', ['$timeout', 'RootService', function($timeout, RootService) {
  return {
    restrict: 'A',
    scope: false,
    link: {
      pre: function(scope, element, attr) {
          var queuedVal = null;
          var endListener = null;
          var browserName = RootService.getBrowserPrefix();
          if (browserName && browserName.length) {
            var animEndEventName = browserName + 'AnimationEnd';
          } else {
            var animEndEventName = animEndEventName;
          }

          attr.$observe('dynamicData', function(val, old_val) {

            console.log(val, old_val)

          })

          $timeout(function() {
            element[0].classList.add('on-exit');
          }, 5000)
      }
    }
  }
}])


.directive("uClass", ["$compile", "ElementService", function($compile, ElementService) {
      return {
          restrict: 'E',
          replace: true,
          priority:1,
          compile: function(element, attr, transclude) {
            attr.prefix && attr.prefix.length && ElementService.addShortcuts(attr.prefix, element[0].childNodes, attr);
            // return {
            //       pre:
            //         function (scope, lElem, lAttr) {
            //           attr.prefix && attr.prefix.length && ElementService.addShortcuts(attr.prefix, lElem[0].childNodes, attr);
            //         }
            // }
          }
        }
}])
.directive("dict", ['$parse', '$compile', '$rootScope', '$interpolate', function($parse, $compile, $rootScope, $interpolate) {
  return {
    restrict: 'AE',
    transclude:'element',
    priority: 1000000,
    controller: ["$transclude", "$scope", "$element", function($transclude, $scope, $element) {
      // var element = angular.copy($transclude($scope, function(elem) {console.log(elem[0])}))
      // var dictStr = filterDictionary($transclude);
      var elemDict = filterDictionary($transclude)

      // var dictStr = elemDict.trim();
      // var dict = dictStr.length && $parse(dictStr)($scope) || {};
      var dict = elemDict.dict;
      // console.log(dict)
      $element.empty();
      $scope.queue = $scope.queue || [];
      var keyChildren = [];
      for (key in dict) {
        var cpElem = angular.copy($transclude()).empty();
        var cpTitle = elemDict.elem.title && angular.copy(elemDict.elem.title);
        var cpChild = elemDict.elem.child && angular.copy(elemDict.elem.child);
        if (cpTitle) {
          cpTitle.html($interpolate(cpTitle[0].outerHTML)({title: key}))
        }
        cpElem.append(cpTitle);
        cpElem.append(cpChild)
        keyChildren.push(cpElem);

        // console.log(key)
        // $scope.queue.push({
        //   elem: angular.copy(element),
        //   key: key,
        //   value: dict[key]
        // })
      }
      keyChildren.forEach(function(child, i) {
        $element.after(child);
      })
      $element.after($element.children())
      console.log($element)


      console.log($scope.queue)

      function filterDictionary(tr) {
        var result = {dict: {}, elem: {title: null, child: null}};
        var children = tr()[0].childNodes;
        children.forEach(function(child, i) {
          if (child.nodeName.toLowerCase() === '#text') {
            var innerText = child.textContent.trim();

            if (isDictStr(innerText)) {

              result.dict = $parse(innerText)($scope);
            }
          } else if ('outerHTML' in child) {
            var outerHTML = child.outerHTML;
            if (outerHTML.length) {

              var e = angular.element(child);
              var eAttr = e[0].attributes;
              for (var i = 0; i < eAttr.length; i++) {
                if ('title' === eAttr[i].name) {
                  result.elem.title = e;
                }
                if ('child' === eAttr[i].name) {
                  result.elem.child = e;
                }
              }
            }
          }
        })
        return result;
        function isDictStr(str) {
          return str.charAt(0) === '{' && str.charAt(str.length - 1) === '}'
        }

      }
    }]
  }
}])
.directive("node", ['$parse', '$compile', '$rootScope', function($parse, $compile, $rootScope) {
      return {
          restrict: 'A',
          priority:1000000,
          transclude:true,
          compile: function(element, attr) {
            // element.removeAttr('node');
            return {
              pre: angular.noop,
              post: function postLink(scope, p_elem, attrs, ctrl, tr) {
              // p_elem.children().unbind();
              // p_elem.children().removeClass('ng-binding');

              scope.children.length && scope.children.forEach(function(child, i) {
                child.elem.attr('data', JSON.stringify(child.data));
                child.elem.attr('name', child.name);
                tr(function(elem, inner_scope) {
                  inner_scope.name = child.name;
                  if (attrs.removeChildAttr && attrs.removeChildAttr.length) {

                    attrs.removeChildAttr.split(' ').forEach(function(attr_name) {

                      child.elem.removeAttr(attr_name)
                    })
                  }

                  if (attrs.childAttr && attrs.childAttr.length) {
                    attrs.childAttr.split(' ').forEach(function(attr_name) {
                      attr_name_split = attr_name.split(':');
                      attr_name_value = attr_name_split.length > 1 && attr_name_split[1] || ''
                      console.log('setting', attr_name_split[0], attr_name_value)
                      child.elem.attr(attr_name_split[0], attr_name_value)
                    })
                  }



                  p_elem.children().after($compile(child.elem)(inner_scope))
                })
              })
            }
          }
              // p_elem.replaceWith(replElem)
          },
          controller: ["$scope", "$attrs", "$element", "$transclude", function($scope, $attrs, $element, $transclude) {
            $scope.name = $attrs.name;
            if (!$scope.name || !$scope.name.length) {
              return;
            }
            $scope.children = [];
            if ($attrs.data && $attrs.data.length) {
              var _dict = $parse($attrs.data)()
              var _dictKeys = Object.keys(_dict);
              var childKeys;
              if (_dictKeys.length && _dictKeys[0] === $attrs.name && _dictKeys.length === 1)  {
                childKeys = _dict[$attrs.name]
              } else {
                childKeys = _dict
              }
              $element.append($transclude());
              var childObjArr = [];
              Object.keys(childKeys).forEach(function(key, i){
                var _dict = {};
                _dict.name = key;
                _dict.children = childKeys[key];
                var childNode;
                // $transclude(function(elem, inner_scope) {
                   var childNode = {};
                   childNode.elem = angular.copy($element);
                   childNode.elem.attr('node', '');
                   // childNode.inner_scope = inner_scope;
                   childNode.name = _dict.name;
                   childNode.data = _dict.children;
                   $scope.children.push(childNode)
                // });





                // for (child_key in _dictKeys[$attrs.name][key]) {
                //   var hasChild = _dict[key];

                //   if (Object.keys(hasChild)) {

                //   }
                // }
              });

              // var _children =
              // console.log(children)
            }
          }]
        }
}])

.directive("u", ["$compile", "ElementService", "$timeout", "$rootScope", "SendService", "CompService", "$parse", "EvalService", function($compile, ElementService, $timeout, $rootScope, SendService, CompService, $parse, EvalService) {
      return {
          restrict: 'A',
          replace: false,
          priority:99,
          scope:true,
          controller: ["$scope", "$attrs", "$element", "$transclude", function($scope, $attrs, $element, $transclude) {
            console.log("it gets here");
            if ('interpolate' in $attrs || 'evalAgain' in $attrs) {
              // console.log('evalAgain' in $attrs, 'interpolate' in $attrs)
                var listener = $scope.$watch('states', function(states) {
                  if (states.init) {
                    states.init.forEach(function(state) {
                      ElementService.applySendAnimPropEval($element.scope(), $element, state.actions, $attrs);
                    })
                  }
                  listener();
                })
            }



          }],
          compile: function(element, attr, transclude) {
            // attr.$set('public', 'public');
            // attr.$set('root', 'root');
            console.log(element)
            var elemName = element[0].nodeName.toLowerCase();

            var hasInitAfter = false;
              // if (attr.initAfter && attr.initAfter.length) {
              //   hasInitAfter = ElementService.toCamelCaseBridge(attr.initAfter)
              //   var hasInitAfterCamel = ElementService.toCamelCaseBridge('when-' + attr.initAfter);
              //   attr.$set(hasInitAfterCamel, attr.onInit);
              //   element[0].removeAttribute('init-after');
            // element[0].removeAttribute('on-init')
              //   delete attr['initAfter']
              //   delete attr['onInit']
              //   delete attr.$attr['on-init']
              //   // attr.$set();
              // }

              this.states = ElementService.renderElementStates(element, attr);
              // console.log(element, this.states)
              var states = this.states;
              // console.log(states)
              var filterStates =  [];
              for (var state in states) {
                states[state].length && states[state].forEach(function(_state) {
                  if (_state.actions && _state.actions.reverse && _state.actions.stateName && _state.actions.stateName.length) {
                    var stateSplit = _state.actions.stateName.split('-');
                    if (stateSplit.length >= 2) {
                      var stateType = stateSplit[0];
                      var stateArgName = stateSplit[1]
                      if (stateType in states) {
                        var stateToCopy = stateArgName;
                        if (states[stateType]) {
                          states[stateType].forEach(function(to_copy_state) {
                            if (to_copy_state.name.indexOf(stateArgName) > -1 && to_copy_state.actions.anim) {

                              var animSplit = (to_copy_state.actions.anim.parsed + "").split(':')
                              if (animSplit.length > 7) {
                                var animParsed = [animSplit[0], animSplit[2], animSplit[1]].join(':') + ':' + animSplit.slice(3).join(":");
                              } else {
                                var reverseDict = {'f': 'r', 'r': 'f', 'a': 'ar', 'ar': 'a'};
                                var lastArg = animSplit[animSplit.length - 1];
                                var animParsed = animSplit.slice(0, animSplit.length - 1).join(':') + ":" + reverseDict[lastArg]
                                console.log(animParsed)
                              }
                              _state.actions.anim = {};
                              for (key in to_copy_state.actions.anim) {
                                _state.actions.anim[key] = to_copy_state.actions.anim[key]
                              }
                              _state.actions.anim.parsed = animParsed;
                              // _state.actions.anim.parsed = animParsed;

                            }
                          })
                        }
                      }
                    }

                  }
                })
              }
              // console.log(filterStates)


                  if (states.init) {
                      states.init.forEach(function(state, i) {

                        if (state.name === 'init' && state.type === 'on') {
                          states.on.push(state);
                        } else if (state.exec && state.name !== 'after') {
                          state.exec(element, null, attr)
                        }
                      })
                    }

              var postStates = [];
              return {
                  pre: function (scope, lElem, lAttr) {

                    if ('$index' in scope) {
                      scope.index = scope.$index + 1;
                    }

                    if (attr.data) {
                      var attrData = attr.data;

                      if ($rootScope.ui && $rootScope.ui.data && 'set' in $rootScope.ui.data) {
                        for (var setVar in $rootScope.ui.data.set) {
                          var extended = $rootScope.ui.data.set[setVar];
                          if (extended !== attr.data && attr.data.indexOf(extended) === -1) {
                            attrData = attrData.replace(setVar, extended);
                            scope[setVar] = $parse(extended)(scope);
                            // var ptr = scope;

                            // parseSetAttributeUrl(extended, scope, setVar)
                          }
                        }
                      }
                      // console.log(scope.options, lElem[0])
                      // $compile(lElem.contents())($parse(attrData)(scope))

                    }


                    scope.states = states || {};

                    scope.hasInitAfter = hasInitAfter;
                    scope.elem = lElem;
                    scope.parentCompiled = false;
                    scope.inheritedFromParent = [];

                    var varStates = ElementService.filterVarStates(scope.states.when);

                    if (varStates.length) {
                      ElementService.registerVarStates(scope, lElem, lAttr, varStates);
                    }

                    // scope.public = scope._public
                    // element.ready(function() {
                    //   console.log('compiling send states for', element)
                    //   // postStates.forEach(function(state) {
                    //   //   state.exec(lElem, scope, lAttr);
                    //   // })

                    // })





                      if (states.on) {


                        states.on.forEach(function(state, i) {
                          if (!('actions' in state) || !state.actions) return;
                          // if (state.actions.send) {
                          //   state.actions.send.parsed.split(',').forEach(function(message_str, i) {
                          //   var msgNameCamel = ElementService.toCamelCaseBridge(message_str.split(':')[0]);
                          //   SendService.prepareToSendMessage(msgNameCamel, message_str, scope);
                          // })
                          // }
                          // if (state.name.indexOf('init') > -1) {
                          //   postStates.push(state);
                          //   return;
                          // }
                          if (state.actions.debug) {
                            ElementService.launchExternalWindow(state.actions.debug, element);
                          }

                          state.exec(lElem, scope, lAttr);
                          if (state.name.indexOf('debug') > -1) {
                            ElementService.launchExternalWindow(state.actions.anim.parsed, element);
                          }
                        })
                      }

                      if (states.when && scope.hasInitAfter) {

                        states.when.forEach(function(w_state, i) {
                          console.log(w_state, scope.hasInitAfter)
                          if (w_state.nameCamel === scope.hasInitAfter) {
                            w_state.exec = function(a1, a2, a3, a4) {
                              transclude(scope, function(clone, innerScope) {
                                    $compile(clone)(innerScope)
                                    lElem.append(clone);
                              });
                            }
                          }
                        })
                      }


                      if (!('root' in scope) && scope.$parent && !('root' in scope.$parent)) {
                        scope.root = {scope: $rootScope};
                      }

                      SendService.precompileSendActionArgs(states, scope, lElem, lAttr)



                  }
              }
          }
      }
}])
.directive("innerSrc", ["$compile", function($compile) {
      return {
          restrict: 'A',
          replace: true,
          priority: 100,
          compile: function(element, attr) {
            var div = angular.element('<div></div>');
            for (var key in attr.$attr) {
              if (key !== 'u') {
                div[0].setAttribute(key, attr[key]);
              }
            }

            // element[0].removeAttribute('inner-src');

            return {
              pre: function(scope, pElem, attr) {
                element.replaceWith(div);
                div.attr('ng-include', attr.innerSrc);
                $compile(div)(scope);
                element[0].removeAttribute('inner-src');
              }
            }
          }
        }
}])
.directive("initLater", ["CompService", "$compile", function(CompService, $compile) {
      return {
          restrict: 'A',
          replace: true,
          transclude: true,
          priority:1,
          compile: function(element, attr, transclude) {

              return {
                  pre:
                  function (scope, lElem, lAttr) {


                      scope.$watch(function() {
                        return element.attr('class');
                      }, function(new_classes) {

                        if (new_classes && new_classes.indexOf('init') > -1) {

                          transclude(scope, function(clone, innerScope) {
                              $compile(clone)(innerScope)
                              lElem.append(clone)
                          })

                        }
                      })

                  },
                  post: angular.noop
              }
          }
      }
}])

.directive('desktop', ['DirectiveService', '$compile', function(DirectiveService, $compile) {
  return {
    restrict: 'A',
    priority: 1,
    require: '^?RootController',
      link: {
        pre: function(scope, element, attr) {
          if (!scope.root.window.desktop) {
            attr.$set('ngIf', scope.root.window.desktop);
            $compile(element[0])(scope);
          } else {
            attr.$set('desktop', null);
          }
      }
    }
  }
}])
.directive('tablet', ['DirectiveService', '$compile', function(DirectiveService, $compile) {
  return {
    restrict: 'A',
    priority: 1,
    require: '^?RootController',
      link: {
        pre: function(scope, element, attr) {
          if (!_browser.size.tablet) {
            attr.$set('ngIf', scope.root.window.desktop);
            $compile(element[0])(scope);
          } else {
            attr.$set('tablet', null);
          }
          // console.log(_browser)
          // if (!scope.root.window.desktop) {
          //   attr.$set('ngIf', scope.root.window.desktop);
          //   $compile(element[0])(scope);
          // } else {
          //   attr.$set('desktop', null);
          // }
      }
    }
  }
}])
.directive('mobile', ['DirectiveService', '$compile', function(DirectiveService, $compile) {
  return {
    restrict: 'A',
    require: '^?RootController',
    priority: 1,
      link: {
        pre: function(scope, element, attr) {
          if (!scope.root.window.mobile) {
            attr.$set('ngIf', scope.root.window.mobile);
            $compile(element[0])(scope);
          } else {
            attr.$set('mobile', null);
          }
      }
    }
  }
}])

// .directive('tablet', ['DirectiveService', '$compile', function(DirectiveService, $compile) {
//   return {
//     restrict: 'A',
//     require: '^?RootController',
//     priority: 1,
//       link: {
//         pre: function(scope, element, attr) {
//           if (!scope.root.window.tablet) {
//             attr.$set('ngIf', scope.root.window.tablet);
//             $compile(element[0])(scope);
//           } else {
//             attr.$set('tablet', null);
//           }
//       }
//     }
//   }
// }])

.directive('initDefault', ['$timeout', 'DirectiveService', function ($timeout, DirectiveService) {
  return {
    restrict: 'A',
    link: function postLink(scope, element, attr, controller) {
          var listenerArgs = DirectiveService.detectExternalStates(attr);
          for (key in listenerArgs) {
            var type = listenerArgs[key].type
            var _attr = listenerArgs[key].attr;
            DirectiveService.initCustomStateWatcher(scope, element,  type, _attr, attr[_attr.camel]);
          }
    }
  }
}])
// .directive('u', ['$timeout', 'DirectiveService', function ($timeout, DirectiveService) {
//   return {
//     restrict: 'A',
//     link: function(scope, element, attr, controller) {
//           var listenerArgs = DirectiveService.detectExternalStates(attr);
//           if ('switch' in attr) {
//             console.log('initializing', attr.switch)
//           }
//           for (key in listenerArgs) {
//             var type = listenerArgs[key].type
//             var _attr = listenerArgs[key].attr;
//             DirectiveService.initCustomStateWatcher(scope, element,  type, _attr, attr[_attr.camel]);
//           }
//     }
//   }
// }])

.directive('onEnter', ['$timeout', 'DirectiveService', function ($timeout, DirectiveService) {
  return {
    restrict: 'A',
    link: {
      pre: function(scope, element, attr) {
        scope.root && scope.root.inspect && scope.root.pauseElement(element, attr);
        var elemArgs = DirectiveService.parseArgs(attr.onEnter, 'on-enter', element);
        var supportedCommands = DirectiveService.supportedCommands;
        scope.$watch(function() {
          return element.attr('class');
        }, function(new_classes, old_classes) {
          if (new_classes && new_classes.indexOf('on-enter') > -1) {
            element[0].classList.remove('on-enter');
            for (key in elemArgs) {
              if (supportedCommands.indexOf(key) > -1) {
                DirectiveService.activateArg(key, elemArgs[key], scope, element);
              }
            }
          }
        });
      }
    }
  }
}])


.directive('onChange', ['$timeout', 'DirectiveService', '$parse', '$compile', function ($timeout, DirectiveService, $parse, $compile) {
  return {
    restrict: 'A',
    link: {
      pre: function(scope, element, attr) {


        scope.root && scope.root.inspect && scope.root.pauseElement(element, attr);
        var elemArgs = DirectiveService.parseArgs(attr.onChange);

        scope.$watch(function() {
          return element.attr('class');
        }, function(new_classes, old_classes) {
          if (new_classes && new_classes.indexOf('on-change') > -1) {
            console.log('onChange elem args', attr.onChange, elemArgs)
            element[0].classList.remove('on-change');
            // element[0].style.opacity = 0;
            var formattedAttrOnChange = (attr.onChange + "").replace('[', '').replace(']', '');
            var func = $parse(elemArgs.eval.functions[0].custom);
            // element[0].style.opacity = 0;
            var temp = element[0].style.display + '';
            element[0].style.display = 'none';
            func(scope.$parent);
            // $compile(element)(scope);
            element[0].style.display = temp;
            $timeout(function() {
              // element[0].style.opacity = 1;
            // $compile(element)(scope);
              element[0].classList.add('on-enter');
              // element[0].style.opacity= 1;
            });

            // $timeout(function() {

            //   // scope.$apply();

            // })
            // $timeout(function() {
            //   element[0].style.opacity = 1;
            // }, 100)
            // $timeout(function() {
            //   // scope.$apply();
            //   element[0].style.opacity = 1;
            // })
            // for (key in elemArgs) {
            //   if (supportedCommands.indexOf(key) > -1) {
            //     DirectiveService.activateArg(key, elemArgs[key], scope, element);
            //   }
            // }
          }
        });

        // var elemArgs = DirectiveService.parseArgs(attr.onChange);
        // var supportedCommands = DirectiveService.supportedCommands;
        // scope.$watch(function() {
        //   return element.attr('class');
        // }, function(new_classes, old_classes) {
        //   if (new_classes && new_classes.indexOf('on-enter') > -1) {
        //     element[0].classList.remove('on-enter');
        //     for (key in elemArgs) {
        //       if (supportedCommands.indexOf(key) > -1) {
        //         DirectiveService.activateArg(key, elemArgs[key], scope, element);
        //       }
        //     }
        //   }
        // });
      }
    }
  }
}])
.directive('onExit', ['$timeout', 'DirectiveService', function ($timeout, DirectiveService) {
  return {
    restrict: 'A',
    link: {
      pre: function(scope, element, attr) {
        scope.root && scope.root.inspect && scope.root.pauseElement(element, attr);
        var elemArgs = DirectiveService.parseArgs(attr.onExit, 'on-exit', element);
        var supportedCommands = DirectiveService.supportedCommands;
        scope.$watch(function() {
          return element.attr('class');
        }, function(new_classes, old_classes) {
          if (new_classes && new_classes.indexOf('on-exit') > -1) {
            element[0].classList.remove('on-exit');
            for (key in elemArgs) {
              if (supportedCommands.indexOf(key) > -1) {
                DirectiveService.activateArg(key, elemArgs[key], scope, element);
              }
            }
          }
        });
      }
    }
  }
}])

.directive('onBlur', ['$timeout', 'DirectiveService', function ($timeout, DirectiveService) {
  return {
    restrict: 'A',
    link: {
      pre: function(scope, element, attr) {
        scope.root && scope.root.inspect && scope.root.pauseElement(element, attr);
        var elemArgs = DirectiveService.parseArgs(attr.onBlur, 'on-blur', element);
        var supportedCommands = DirectiveService.supportedCommands;
        element.on('blur', function () {
            for (key in elemArgs) {
              if (supportedCommands.indexOf(key) > -1) {
                DirectiveService.activateArg(key, elemArgs[key], scope, element);
              }
            }
        });
      }
    }
  }
}])
.directive('onFocus', ['$timeout', 'DirectiveService', function ($timeout, DirectiveService) {
  return {
    restrict: 'A',
    link: {
      pre: function(scope, element, attr) {
        scope.root && scope.root.inspect && scope.root.pauseElement(element, attr);
        var elemArgs = DirectiveService.parseArgs(attr.onFocus, 'on-focus', element);
        var supportedCommands = DirectiveService.supportedCommands;
        element.on('focus', function () {
            for (key in elemArgs) {
              if (supportedCommands.indexOf(key) > -1) {
                DirectiveService.activateArg(key, elemArgs[key], scope, element);
              }
            }
        });
      }
    }
  }
}])
.directive('onValid', ['$timeout', 'DirectiveService', function($timeout, DirectiveService) {
  return {
    restrict: 'A',
    link: {
      pre: function(scope, element, attr) {
        if (!attr.onValid || !attr.onValid.length) return;
        var stringValidArgsSplit = attr.onValid.split(':]')
        var parseArgStr = stringValidArgsSplit[0] + ':]';
        var evalFuncStr = stringValidArgsSplit[1];
        var elemArgs = DirectiveService.parseArgs(parseArgStr, 'on-valid', element);

        scope.$watch(function() {
          return element.attr('class');
        }, function(new_classes, old_classes) {


            if (new_classes && new_classes.indexOf('on-valid') > -1) {
              var func = $parse(evalFuncStr);
              if (func(scope) || func === 'true') {
                for (key in elemArgs) {
                  if (supportedCommands.indexOf(key) > -1) {
                    DirectiveService.activateArg(key, elemArgs[key], scope, element);
                  }
                }
              }
            }
        });
      }
    }
  }
}])
.directive('onInvalid', ['$timeout', 'DirectiveService', function($timeout, DirectiveService) {
  return {
    restrict: 'A',
    link: {
      pre: function(scope, element, attr) {
        if (!attr.onInvalid || !attr.onInvalid.length) return;
        var stringInValidArgsSplit = attr.onInvalid.split(':]')
        var parseArgStr = stringInValidArgsSplit[0] + ':]';
        var evalFuncStr = stringInValidArgsSplit[1];
        var elemArgs = DirectiveService.parseArgs(parseArgStr, 'on-invalid', element);

        scope.$watch(function() {
          return element.attr('class');
        }, function(new_classes, old_classes) {
            if (new_classes && new_classes.indexOf('on-invalid') > -1) {
              var func = $parse(evalFuncStr);
              if (!func(scope) || func === 'false') {
                for (key in elemArgs) {
                  if (supportedCommands.indexOf(key) > -1) {
                    DirectiveService.activateArg(key, elemArgs[key], scope, element);
                  }
                }
              }
            }
        });
      }
    }
  }
}])
.directive('onMouseEnter', ['$timeout', 'DirectiveService', function ($timeout, DirectiveService) {
  return {
    restrict: 'A',
    link: {
      pre: function(scope, element, attr) {
        scope.root && scope.root.inspect && scope.root.pauseElement(element, attr);
        var elemArgs = DirectiveService.parseArgs(attr.onMouseEnter, 'MouseEnter', element);
        var supportedCommands = DirectiveService.supportedCommands;
        var inTimeout = false;
        var mouseEnterDelay = parseInt(attr.onMouseEnterDelay) || 250;
        element.on('mouseenter', function () {
            var inTimeout = true;
            $timeout(function () {
              if (inTimeout) {
                for (key in elemArgs) {
                  if (supportedCommands.indexOf(key) > -1) {
                    DirectiveService.activateArg(key, elemArgs[key], scope, element);
                  }
                }
                scope.$apply();
              }
            }, mouseEnterDelay);
        });

        element.on('mouseleave', function () {
          inTimeout = false;
        });
      }
    }
  }
}])
.directive('onMouseOver', ['$timeout', 'DirectiveService', function ($timeout, DirectiveService) {
  return {
    restrict: 'A',
    link: {
      pre: function(scope, element, attr) {
        scope.root && scope.root.inspect && scope.root.pauseElement(element, attr);
        var elemArgs = DirectiveService.parseArgs(attr.onMouseOver, 'MouseOver', element);
        var supportedCommands = DirectiveService.supportedCommands;
        var inTimeout = false;
        var hoverDelay = parseInt(attr.onMouseOverDelay || DirectiveService.defaults.activate.hover) || 500;
        element.on('mouseover', function () {
          inTimeout = true;
          $timeout(function () {
            if (inTimeout) {
              for (key in elemArgs) {
                if (supportedCommands.indexOf(key) > -1) {
                  DirectiveService.activateArg(key, elemArgs[key], scope, element);
                }
              }
              scope.$apply();
            }
          }, hoverDelay);
        });
         element.on('mouseleave', function () {
          inTimeout = false;
        });
      }
    }
  }
}])
.directive('onMouseLeave', ['$timeout', 'DirectiveService', function ($timeout, DirectiveService) {
  return {
    restrict: 'A',
    link: {
      pre: function(scope, element, attr) {
        scope.root && scope.root.inspect && scope.root.pauseElement(element, attr);
        var elemArgs = DirectiveService.parseArgs(attr.onMouseLeave, 'MouseLeave', element);
        var supportedCommands = DirectiveService.supportedCommands;
        var inTimeout = false;
        var mouseLeaveDelay = parseInt(attr.onMouseLeaveDelay) || 250;


        element.on('mouseleave', function () {
            var inTimeout = true;
            $timeout(function () {
              if (inTimeout) {
                for (key in elemArgs) {
                  if (supportedCommands.indexOf(key) > -1) {
                    DirectiveService.activateArg(key, elemArgs[key], scope, element);
                  }
                }
                scope.$apply();
              }
            }, mouseLeaveDelay);
        });

        element.on('mouseenter', function () {
          inTimeout = false;
        });
      }
    }
  }
}])
.directive('draw', ['$timeout', 'SVGService', '$compile', function ($timeout, SVGService, $compile) {
  return {
    restrict: 'A',
    link: function(scope, element, attr) {
      var clonedElem = element[0].cloneNode(true);
      var currentFrame = parseInt(attr.initFrame) || 0;
      var delay = attr.drawDelay || 0;
      var totalFrames = SVGService.computeDrawDuration(attr.drawDuration) || 60;
      var svgPaths = element[0].querySelectorAll('path:not([draw]):not([draw-ignore]), line:not([draw]):not([draw-ignore]), circle:not([draw]):not([draw-ignore]), rect:not([draw]):not([draw-ignore]), polygon:not([draw]):not([draw-ignore])');

      $timeout(function() {
        element[0].classList.add('activate');
      }, 2000)
      scope.$watch(function() {
        return element.attr('class');
      }, function(new_value) {
        if (new_value && new_value.indexOf('activate') > -1) {
            if (element[0].nodeName !== 'path') {
              var path = SVGService.svgShapeToPath(element[0])[0];
              element[0].parentNode.replaceChild(path, element[0]);
            } else {
              var path = element[0];
            }

            var pathLength = path.getTotalLength()
            var _default = path.style.fill;
            path.style.fill = 'none';
            path.style.strokeDashoffset = pathLength;
            path.style.strokeDasharray = pathLength;
            path.style.webkitTransition = 'all 3000ms ease-out';
            $timeout(function() {
              path.style.strokeDashoffset = 0;
              path.style.strokeDasharray = 0;
              path.style.fill = _default;
              // path.style.strokeWidth = '5';
              // path.style.fill = defaultPath;
            }, 1000)
            // SVGService.drawOneShape(path, 50, pathLength, pathLength)



          // pathLength = SVGService.getTotalPathLength(path[0]);

          // var transitionStr = ['stroke-dashoffset', attr.drawDuration || '250ms', 'ease'].join(' ');
          // element.css('-webkit-transition', transitionStr);
          // element[0].style.strokeDashoffset = 0;
        }

        // element[0].style.stroke = 'blue';
        // if (element[0].classList.contains('activate') || (attr.drawOnClass && element[0].classList.contains(attr.drawOnClass))) {
        //     console.log(attr.drawDuration, pathLength/2, totalFrames)
        //     $timeout(function() {
        //       //concurrent case
        //       var startTime = new Date().getTime();
        //       var requestFrameHandle = 0;
        //       function draw() {
        //         var progress = currentFrame/totalFrames;
        //         if (progress > 1) {
        //           var endTime = new Date().getTime();
        //            window.cancelAnimationFrame(requestFrameHandle);
        //         } else {
        //           currentFrame++;
        //           for(var j=0; j<svgPaths.length;j++){
        //             svgPaths[j].style.strokeDasharray += ' ' + pathLength;
        //           }
        //           requestFrameHandle = window.requestAnimationFrame(draw);
        //         }
        //       }
        //       draw()
        //     }, drawShapesDelay);
        //   }

        })
      }
    }
}])

.directive('customShortcuts', ['$timeout', 'DirectiveService', 'UtilitiesService', function ($timeout, DirectiveService, UtilitiesService) {
  return {
    restrict: 'E',
    priority: 10,
    link : {
      pre: function(scope, element, attr) {
        attr.$set('ngHide', true);
        scope.root.public.customShortcuts = {state: {}, args: {}, cssProps:{}, cssPropValues:{}, cmds:{}};
        DirectiveService.setShortcutDict(scope.root.public.customShortcuts);
      }
    }
  }
}])
.directive('argShortcut', ['$timeout', 'DirectiveService', 'UtilitiesService', function ($timeout, DirectiveService, UtilitiesService) {
  return {
    restrict: 'E',
    priority: 10,
    link : function(scope, element, attr) {
        if ('replace' in attr && 'with' in attr) {
          if (!(attr.replace in scope.root.public.customShortcuts.args)) {
            scope.root.public.customShortcuts.args[attr.with] = attr.replace;
          }
        }
    }
  }
}])
.directive('animPropShortcut', ['$timeout', 'AnimationFrameService', function ($timeout, AnimationFrameService) {
  return {
    restrict: 'E',
    priority: 10,
    link : function(scope, element, attr) {
      var defaultArr = ['stream', 'default', 'custom', 'name', 'start', 'end', 'duration', 'easingFunc', 'delay', 'iter', 'direction'];
        if (!scope.root.public.customShortcuts.animProps) {
          scope.root.public.customShortcuts.animProps = {};
          defaultArr.forEach(function(name, i) {
            scope.root.public.customShortcuts.animProps[name] = {};
          })
        }
        //if not Arg
        if (!attr.arg || ('arg' in attr && defaultArr.indexOf(attr.arg.toLowerCase()) === -1)) return;
        if ('replace' in attr && 'with' in attr) {
          scope.root.public.customShortcuts.animProps[attr.arg][attr.replace] = attr.with;
        }
        if ('for' in attr && 'setDefault' in attr) {
          scope.root.public.customShortcuts.animProps[attr.arg][attr.for] = attr.setDefault;
        }
    }
  }
}])
.directive('propShortcut', ['$timeout', 'DirectiveService', 'UtilitiesService', function ($timeout, DirectiveService, UtilitiesService) {
  return {
    restrict: 'E',
    priority: 10,
    link : function(scope, element, attr) {
        if ('replace' in attr && 'with' in attr) {
          if (!(attr.replace in scope.root.public.customShortcuts.cssProps)) {
            scope.root.public.customShortcuts.cssProps[attr.with] = attr.replace;
          }
        }
    }
  }
}])
.directive('propValueShortcut', ['$timeout', 'DirectiveService', 'UtilitiesService', function ($timeout, DirectiveService, UtilitiesService) {
  return {
    restrict: 'E',
    priority: 10,
    link : function(scope, element, attr) {
        if ('replace' in attr && 'with' in attr) {
          if (!(attr.replace in scope.root.public.customShortcuts.cssPropValues)) {
            scope.root.public.customShortcuts.cssPropValues[attr.with] = attr.replace;
          }
        }
    }
  }
}])
.directive('cmdShortcut', ['$timeout', 'DirectiveService', 'UtilitiesService', function ($timeout, DirectiveService, UtilitiesService) {
  return {
    restrict: 'E',
    priority: 10,
    link : function(scope, element, attr) {
        if ('replace' in attr && 'with' in attr) {
          if (!(attr.replace in scope.root.public.customShortcuts.cmds)) {
            scope.root.public.customShortcuts.cmds[attr.with] = attr.replace;
          }
        }
    }
  }
}])

.directive('customStates', ['$timeout', 'DirectiveService', 'UtilitiesService', function ($timeout, DirectiveService, UtilitiesService) {
  return {
    restrict: 'E',
    link: {
      pre: function(scope, element, attr) {
        var customStateDict = DirectiveService.parseCustomStateAttr(attr);
          for (key in customStateDict) {
            if (!(key in scope.root.public.customStates)) {
              scope.root.public.customStates[key] = {};
            }
            //if not arr
            if (!customStateDict[key].length) continue;

            var customKeyStates = customStateDict[key];
            for (var i = 0; i < customKeyStates.length; i++) {
              var camelCaseCustomState = UtilitiesService.camelCase(customKeyStates[i]);
              var watchState = 'root.public.customStates.' + key + '.' + camelCaseCustomState;
              scope.root.public.customStates[key][camelCaseCustomState] = false;
              scope.$watch(watchState, function(new_value) {
                // console.log('watching..', camelCaseCustomState, watchState, new_value);
              });
              // scope.$watch
            }
          }
      }
    }
  }
}])
.
directive("evalOnInit", ["$timeout", 'AnimationService', '$parse', function($timeout, AnimationService, $parse) {
      return {
          restrict: 'A',
          link: {pre: function(scope, element, attr) {
                var func = $parse(attr.evalOnInit);
                func(scope);
                $timeout(function() {
                  scope.$apply();
                })
              }
          }
      }
}])
.
directive("evalOnReady", ["$timeout", '$parse', function($timeout, $parse) {
      return {
          restrict: 'A',
          link: {post: function(scope, element, attr) {
                element.ready(function() {
                  var func = $parse(attr.evalOnReady);
                  func(scope);
                  $timeout(function() {
                    scope.$apply();
                  })
                })
              }
          }
      }
}])
.directive('classOnInit', ['$timeout', function ($timeout) {
  return {
    restrict: 'A',
    link: function(scope, element, attr) {
      element.ready(function(){

        if (attr.classOnInit && attr.classOnInit.length) {
          var args = attr.classOnInit.split(':');
          if (args.length > 1 && args[1].split('delay').length > 1) {
            var delay = parseInt(args[1].replace('delay-', ''));
            var className = args[0];
            $timeout(function() { element[0].classList.add(className); }, delay)
          }
          element[0].classList.add(attr.classOnInit)
        }
        return;
      })
    }
  }
}])
.directive('parallaxParent', ['$state', '$timeout', function ($state, $timeout) {
    // TODO --> provide support bool | integer
    return {
      restrict: 'A',
      link: function(scope, element, attr) {
          var parallaxArgs = ["clipRelativeInput", "relativeInput", "calibrationThreshold", "calibrationDelay", "supportDelay", "calibrateX", "calibrateY","invertX", "invertY","limitX","limitY","scalarX","scalarY","frictionX","frictionY","originX","originY"];
          var parallaxArgsType = ["bool", "bool", "int", "int", "int", "bool", "bool", "bool", "bool", "bool", "bool", "float", "float", "float", "float", "float", "float"];
          var elemParallaxArgs = [];
          $timeout(function() {
            if (attr.parallaxParent && attr.parallaxParent.length) {
              var elemParallax = new Parallax(element[0]);
              for (var i = 0; i < parallaxArgs.length; i++) {
                 var parsedIndexArg = "parallax" + parallaxArgs[i][0].toUpperCase() + parallaxArgs[i].slice(1);
                 if (!parsedIndexArg || !parsedIndexArg.length) continue;
                 var indexArg = parallaxArgs[i];
                 elemParallaxArgs.push(parsedIndexArg);
                 elemParallax[indexArg] = parseArg(attr[parsedIndexArg], parallaxArgsType[i]) || elemParallax[indexArg]
              }
              $timeout(function() {
                elemParallax.enable();
                elemParallax.updateLayers();
                scope.root.parallax[attr.parallaxParent] = elemParallax
              })

              scope.root.parallax[attr.parallaxParent] = elemParallax
            }
          })
          function parseArg(arg, _type) {
            if (_type === "float") {
              return parseFloat(arg)
            }
            if (_type === "bool") {
              return arg === "true"
            }
            if (_type === "int") {
              return parseInt(arg)
            }
          }
      }
    }
}])
.directive("inspect", ['$timeout', 'RootService', '$compile', 'AdminInspectService',
  function($timeout, RootService, $compile, AdminInspectService) {
      return {
        restrict: 'C',
        scope: false,
        priority: 10000,
        replace: true,
        link: {
          pre: function(scope, element, attr) {
            'initLater' in attr && element.removeAttr('init-later');


            if (scope.root.inspectCount) {
              scope.root.inspectCount += 1;
            } else {
              scope.root.inspectCount = 1;
            }

            var inspect_index = element[0].classList && element[0].classList.value.indexOf('inspect-');

            if (inspect_index > -1) {

              var stateToTrigger = element[0].classList.value.split('inspect-')[1];
              stateToTrigger = stateToTrigger.split(' ')[0];

              //inspect requirement
              if (stateToTrigger.indexOf('on-') > -1) {
                element[0].classList.add(stateToTrigger);
                element.ready(function() {
                  element.triggerHandler(stateToTrigger.replace('on-', ''));
                })
              }



            } else {
              //inspect main
              scope.root.inspect = true;
              console.log('set to true', scope.root.inspect = true);
              element.ready(function() {
                initInspector();
              })
            }


            // document.body.addEventListener()

            // console.log('initializing inspector')
            function initInspector() {
              scope.state = {play: false, pause: false, complete: false, timer: {start:0, pause:0}};
              scope.$watch(function() {
                return element.attr('style');
              }, function(new_style, old_classes) {
                if (new_style && !scope.play) {
                  scope.originalStyle = new_style;

                  scope.origProp = {duration: getDuration(element), transition: (element[0].style.webkitTransition || element[0].style.webkitTransition)}
                  scope.props = {arr: AdminInspectService.getPropArr(new_style), duration: scope.origProp.duration, transition: scope.origProp.transition, style: new_style};
                  scope.parsedAttr = AdminInspectService.getAttrDict(scope, element, attr, new_style);
                  scope.play = getPlayFunction(element, attr, scope.props, scope.state, scope)
                  scope.pause = getPauseFunction(element, attr, scope.props, scope.state, scope)
                  scope.update = getUpdateFunction(element, attr, scope.props, scope.state, scope);
                  attr.$set('style', null);
                  scope.props.attr = scope.parsedAttr;
                  initPlayer(scope);
                }
              })
            }
            // }
          }
        }
      }

      function getPauseFunction(element, attr, props, state) {
        return function() {
          state.pause = true;
          state.play = false;
          state.timer.pause = state.timer.pause + (new Date().getTime() - state.timer.start);
          computedStyle = window.getComputedStyle(element[0]);
          props.arr = AdminInspectService.getPropArr('transform:' + computedStyle.getPropertyValue('transform') +';' +element[0].getAttribute('style'))
          state.playerPos = state.timer.pause
          element.css('transform', computedStyle.getPropertyValue('transform') || computedStyle.getPropertyValue('webkit-transform'));
          element.css('transition', null);
          element.css('webkit-transition', null);
          console.log(state.pause, state.play, state.timer.pause)
        }
      }

      function getUpdateFunction(element, attr, props, state, scope) {
        return function(value) {
          state.timer.pause = true;
          state.play = false;
          state.timer.pause = value;
          attr.$set('style', null);
          $timeout(function() {
            scope.$apply();
            attr.$set('style', props.style);
            element.css('transition-delay', (state.timer.pause * -1) + 'ms');
            element.css('-webkit-transition-delay', (state.timer.pause * -1) + 'ms');
            computedStyle = window.getComputedStyle(element[0]);
            element.css('transform', computedStyle.getPropertyValue('transform') || computedStyle.getPropertyValue('webkit-transform'));
            $timeout(function() {
              scope.$apply();
              element.css('transition', null);
              element.css('webkit-transition', null);
            })
          })
        }
      }

      function getPlayFunction(element, attr, props, state, scope) {
        return function() {




          if (state.pause && state.timer.pause) {
            var durationOffset = props.duration - state.timer.pause;
            attr.$set('style', props.style);
            element.css('transition-duration', durationOffset + 'ms');
            element.css('webkit-transition-duration', durationOffset + 'ms');
            bindElementWithTransitionEnd();
          } else {
            bindElementWithTransitionEnd();
            attr.$set('style', props.style);
          }
          state.timer.start = new Date().getTime();
          state.play = true;

          function bindElementWithTransitionEnd()  {
            element.bind('webkitTransitionEnd', function() {
              state.play = false;
              state.pause = false;
              state.complete = true;
              state.timer.start = 0;
              state.timer.pause = 0;
              attr.$set('style', null);
              $timeout(function() {
                scope.$apply()
              })
              // attr.$set('style', props.style);

            })
          }

        }
      }

      function initPlayer(scope) {
          var div = document.querySelector('#transition-player');
          scope.name = 'player'
          if (!div) {
            div = document.createElement('div');
            div.classList.add('full-x', 'fixed', 'top-0', 'left-0', 'animated', 'slideInDown');
            div.style.zIndex = 100000;
            div.id = 'transition-player';
            div.innerHTML = '<player play=play root=root pause=pause state=state update=update props=props start-offset=state.timer.pause duration=duration></player>'
            document.querySelector('ui-view').appendChild(div)
          }

          scope.playerPos = 0
          scope.duration = 2000;
          $compile(div)(scope)
          $timeout(function() {
            scope.$apply();
          })
      }

      function getDuration(element) {
        return parseFloat((element[0].style.webkitTransitionDuration || element[0].style.transitionDuration).split('ms')[0]);
      }
}])
.directive('switches', ['$state', '$timeout', 'DirectiveService', 'UtilitiesService', 'SwitchService', function($state, $timeout, DirectiveService, UtilitiesService, SwitchService) {
    return {
      restrict: 'A',
      scope: {},
      link: function preLink(scope, element, attr) {
        if (!attr.switches || !attr.switches.length) {
          return;
        }

        scope.root = scope.$parent.root;
        // var listenerArgs = DirectiveService.detectExternalStates(attr);

        // for (key in listenerArgs) {

        //     var type = listenerArgs[key].type
        //     var _attr = listenerArgs[key].attr;
        //     console.log(type, attr);
        //     DirectiveService.initCustomStateWatcher(scope, element,  type, _attr, attr[_attr.camel]);

        //   }
        var supportedCommands = DirectiveService.supportedCommands;
        scope.switches = SwitchService.parseSwitches(element, attr);
        var classesToWatch = [];
        if (scope.switches.classes) {




          classesToWatch = scope.switches.classes;
          delete scope.switches.classes['classes']
          scope.$watch(
            function() {
              return element.attr('class');
            },
            function(new_classes, old_classes) {
              if (!new_classes) {
                return;
              }
              var modifiedClasses = [];

              classesToWatch.forEach(
                function(c, i) {
                  if (new_classes.indexOf(c) > -1) {
                    modifiedClasses.push(c);
                    element[0].classList.remove(c);
                  }
              });
              for (var i = 0; i < modifiedClasses.length; i++) {
                var iClass = modifiedClasses[i];
                for (key in scope.switches) {
                  if (scope.switches[key].nameDashed === iClass) {
                    var iSwitchObj = scope.switches[key];
                    break;
                  }
                }
              }
              if (iSwitchObj) {
                iSwitchObj.value = !iSwitchObj.value;
                var stateValue = (iSwitchObj.value && 'on') || 'off';
                if (stateValue in iSwitchObj) {
                  var elemArgs = iSwitchObj[stateValue].args;
                  for (key in elemArgs) {
                    if (supportedCommands.indexOf(key) > -1) {
                      console.log(key, elemArgs[key])
                      DirectiveService.activateArg(key, elemArgs[key], scope, element);
                    }
                  }
                }
              }
            }
          );
        }
        // console.log(scope.switches);

        // scope.switchClasses = [];
        // for (key in attr) {
        //   console.log(key);
        // }
      }
    }
}])
.directive('switch', ['$state', '$timeout', 'DirectiveService', function($state, $timeout, DirectiveService) {
    return {
      restrict: 'A',
      scope: {},
      link: function(scope, element, attr) {
        //shortcut
        scope.switch = {name: null, value:false};

        if ('switchOn' in attr) {
          scope.switch.on = {args: DirectiveService.parseArgs(attr.switchOn)}
        }

        if ('switchOff' in attr) {
          scope.switch.off = {args: DirectiveService.parseArgs(attr.switchOff)}
        }
        scope.$watch(function() {
          return element.attr('class');
        }, function(new_classes) {
          if (new_classes && new_classes.indexOf('switch-toggle') > -1) {

            element[0].classList.remove('switch-toggle');
            scope.switch.value = !scope.switch.value;
            var toggleValue = scope.switch.value && 'on' || 'off';

            var elemArgs = scope.switch[toggleValue].args;

            var supportedCommands = DirectiveService.supportedCommands;

            for (key in elemArgs) {
              if (supportedCommands.indexOf(key) > -1) {
                  DirectiveService.activateArg(key, elemArgs[key], scope, element);
              }
            }
          }
        })
    }
  }
}])
.directive('parallaxChild', ['$state', '$timeout', function ($state, $timeout) {
    return {
      restrict: 'A',
      link: function(scope, element, attr) {
        if (attr.parallaxChild && attr.parallaxChild.length) {
          var floatValue =  parseFloat(attr.parallaxChild);

          element[0].setAttribute('data-depth', floatValue)
          element[0].classList.add('layer');
          $timeout(function() {
            if (attr.parallaxParentRef && attr.parallaxParentRef.length && scope.root.parallax[attr.parallaxParentRef]) {
              scope.root.parallax[attr.parallaxParentRef] && scope.root.parallax[attr.parallaxParentRef].updateLayers();
            }
          }, 1000)
        }
      }
    }
}])
.directive('rootAnimation', [function () {
    return {
      restrict: 'E',
      scope: false,
      link: function(scope, element, attr) {
        if (attr.off) {
          scope.root.animStatus.off = true;
        }
      }
    }
}])
.directive('swiper', ['$timeout', function ($timeout) {
    return {
      restrict: 'E',
      scope: {
        type: '=type',
      },
      template: '<div class="swiper-container"><div class="swiper-wrapper" ng-transclude></div></div>',
      transclude: true,
      replace: true,
      link: {
        pre: function (scope, element, attr, controllerFn, transclude, data) {

          var swiperOptions = {
            slidesPerView: 'auto',
            centeredSlides: true,
            spaceBetween: 100,
            effect: 'coverflow',
            speed: 600,
            coverflow: {
              slideShadows: false
            },
            paginationClickable: true,
            keyboardControl: true,
            parallax: true,
            ref: 'http://idangero.us/swiper/api/#.V57mX9ArLOQ'
          }
          scope.swiper = {instance: null, options: swiperOptions}
          if ('width' in attr && attr.width.length) {
            element[0].style.width = attr.width;
          }
          if ('height' in attr && attr.height.length) {
            element[0].style.height = attr.height;
          }
          // nextButton: '.header-swiper-front .swiper-button-next',
          //   prevButton: '.header-swiper-front .swiper-button-prev',
          // $timeout(function() {

          //   // scope.swiper.instance.update(true);
          //   // scope.swiper.instance.startAutoplay();
          // }, 1000)
        },
        post: function(scope,element, attr) {

          var className = '.' + element[0].classList.value.split(' ').join('.')
          scope.swiper.instance =  new Swiper(className, scope.swiper.options);
          scope.$parent.swiperOptions = scope.swiper.options;

          scope.$parent.swiper = scope.swiper;

        }
      }
    }
}])
.directive('slide', ['$timeout', function ($timeout) {
    return {
      restrict: 'E',
      scope: {data: '=data', index: '=index'},
      transclude: true,
      priority:1,
      replace:true,
      template: '<div class="swiper-slide" ng-transclude></div>',
      link:  {
            pre: function(scope, element, attr) {
              if (!scope.$parent.data) {
                scope.$parent.data = [];
              }
              scope.$parent.data.push(scope.data);
            },
            post: function(scope, element, attr) {
              $timeout(function() {
                if ('width' in attr && attr.width.length) {
                  element.css('width', attr.width)
                }
                if ('height' in attr && attr.height.length) {
                    element.css('height', attr.height)
                  }
              })
            }
          }
    }
}])
.directive('swiperNext', [function () {
    return {
      restrict: 'E',
      scope: false,
      priority:1,
      replace:true,
      transclude: true,
      template: '<div class="swiper-button-next" ng-transclude></div>',
      link: function preLink(scope, element, attr) {
        console.log();
        scope.$parent.swiper.options.nextButton = element[0];
      }
    }
}])
.directive('bgImage', ['$parse', '$compile', function($parse, $compile){
    return function(scope, element, attrs){
        var scopeWatcher;
        var watcher = attrs.$observe('bgImage', function(value) {
            // if (value.indexOf('{{') > -1 || value.length === 0) {
            //   return;
            // }
            if (value.length && value.indexOf('/') === -1 && value) {

              scopeWatcher = scope.$parent.$watch(attrs.bgImage, function(value) {
                console.log(value)
              })
              watcher();
              return;

            }
            var bgAttrValues = value.split('|');

            element.css({
                'background-image': 'url(' + bgAttrValues[0]  +')',
                'background-position': bgAttrValues[1] || 'center center',
                'background-size' : bgAttrValues[2] || 'cover',
                'background-repeat': bgAttrValues.length > 3 && bgAttrValues[3] || 'no-repeat',
                'background-color': bgAttrValues.length > 4 && bgAttrValues[4] || 'none',
            });
            element[0].removeAttribute('bg-image');
            $compile(element)(scope);

        });
    };
}])
.directive('txt', ['$parse', '$compile', function($parse, $compile){
    return function(scope, element, attrs){
        element.addClass('txt-' + attrs.txt);
    };
}])
.directive('swiperBack', [function () {
    return {
      restrict: 'E',
      scope: false,
      priority:1,
      replace:true,
      transclude: true,
      template: '<div class="swiper-button-prev" ng-transclude></div>',
      link: function preLink(scope, element, attr) {
        console.log();
        scope.$parent.swiper.options.prevButton = element[0];
      }
    }
}])
.directive('swiperControls', [function () {
    return {
      restrict: 'E',
      priority:10,
      replace:true,
      scope: false,
      link:
        {
          pre: function(scope, element, attr) {
            scope.swiperOptions = scope.$parent.swiper.options;

            }
          // post: function(scope, element, attr) {


          // }
      }
    }
}])
.directive('swipeVar', [function () {
    return {
      restrict: 'E',
      priority:11,
      replace:true,
      scope: {key:'@key', value:'@value'},
      link:
        {
          pre: function(scope, element, attr) {

            if (scope.key && scope.key.length && scope.value && (scope.value + '').length) {
              if (!isNaN(parseFloat(scope.value)) && isFinite(scope.value)) {
                scope.value = parseFloat(scope.value);
              }
              scope.$parent.swiperOptions[scope.key] = scope.value;
              if (!scope.$parent.swiperOptions.modified) {
                scope.$parent.swiperOptions.modified =[];
              }
              scope.$parent.swiperOptions.modified.push(scope.key);
            }
          }
        }
    }
}])

.directive('includeReplace', function () {
    return {
        require: 'ngInclude',
        restrict: 'A',

        compile: function (tElement, tAttrs) {
            tElement.replaceWith(tElement.children());
            return {
                post : angular.noop
            };
        }
    };
});
angular.module('uguru.shared.directives.components', []);
angular.module('uguru.shared.directives.components')

    .directive("dropdown", ['$timeout', 'RootService', 'UtilitiesService', 'DirectiveService', function($timeout, RootService, UtilitiesService, DirectiveService) {
        function getTemplateURL(elem, attr) {
            if (attr.type && attr.type === 'color') {
                return RootService.getBaseUrl() + 'shared/templates/components/templates/nav/color.tpl'
            } else {
                return RootService.getBaseUrl() + 'shared/templates/components/dropdown.tpl'
            }
        }
        return {
            templateUrl: getTemplateURL,
            scope: {
                dropdown: '=ngModel',
                prefix: '@prefix',
                states: '@states'
                    // tests:'=testArr',
            },
            replace: true,
            restrict: 'E',
            link: {pre: function(scope, element, attr) {
                if (scope.states && attr.states.length) {
                    scope.states = UtilitiesService.removeAllOccurrancesArr(scope.states, ['[', ']', ' '])
                    scope.states = scope.states && scope.states.split(',')
                }
                // scope.mouse = {over: false, enter: false, leave: false};
                // scope.mouseDelays = {over: 250, enter: 250, leave: 250};
                // if (attr.mouseOverDelay) scope.mouseDelays.over = parseInt(attr.mouseOverDelay);
                // if (attr.mouseEnterDelay) scope.mouseDelays.enter = parseInt(attr.mouseEnterDelay);
                // if (attr.mouseLeaveDelay) scope.mouseDelays.leave = parseInt(attr.mouseLeaveDelay);

                // if (attr.mouseEnterData && attr.mouseEnterData.length) {
                //     var enterData = attr.mouseEnterData + '';
                //     enterData = UtilitiesService.replaceAll(enterData ,', ', ',');
                //     enterDataSplit = enterData.split(',');
                //     var resultDict = {};
                //     for (var i = 0; i < enterDataSplit.length; i++) {

                //     }
                //     scope.dropdown.data.mouseEnter = resultDict;
                // }
                for (var i = 0; i < scope.dropdown.options.length; i++) {
                    if ('mouseEnterData' in attr) {
                        scope.dropdown.options[i].mouseEnterData = UtilitiesService.replaceAll(attr['mouseEnterData'], ', ', ',').split(',').join('#');
                    }
                    if ('mouseOverData' in attr) {
                        scope.dropdown.options[i].mouseOverData = UtilitiesService.replaceAll(attr['mouseOverData'], ', ', ',').split(',').join('#');
                    }
                    if ('mouseLeaveData' in attr) {
                        scope.dropdown.options[i].mouseLeaveData = UtilitiesService.replaceAll(attr['mouseLeaveData'], ', ', ',').split(',').join('#');
                    }
                }

                scope.dropdown.active = false;
                attr.$set('initWith', attr.initWith);
                // attr.$set('onMouseEnter', attr.onMouseEnter);
                scope.dropdown.selectedRecentlyChanged = false;
                scope.root = scope.$parent.root;

                if (!scope.size) {
                    scope.size = 'small';
                }
                if (attr.type && attr.type.toLowerCase() === 'color') {
                    scope.type = 'color';
                } else {
                    scope.type = '';
                }
                if ('colorKey' in attr && attr.colorKey.length) {
                    var stripCharArr = ['[', ']', "'", '"', " "];
                    var strippedColorKeys = UtilitiesService.removeAllOccurrancesArr(attr.colorKey, stripCharArr)
                    if (strippedColorKeys && strippedColorKeys.length) {
                        strippedColorKeys = strippedColorKeys.split(',');
                    }
                    if (strippedColorKeys) {
                        scope.colorKey = strippedColorKeys;
                    }
                }
                scope.click = function(option, index) {


                    if (index !== scope.dropdown.selectedIndex) {
                        scope.dropdown.selectedRecentlyChanged = true;
                        scope.toggle();
                        $timeout(function() {
                            scope.dropdown.selectedRecentlyChanged = false;
                        }, 1000)
                    }

                    if (!option.skip) {
                        scope.dropdown.selectedIndex = index;
                    }

                    $timeout(function() {
                        scope.$apply();
                    })

                    if (scope.dropdown.onOptionClick) {
                        scope.dropdown.onOptionClick(option, index);
                    }

                    if (scope.states && scope.states.indexOf('click') > -1) {
                        console.log('sending click message', element)
                        DirectiveService.sendMessage(scope, 'send', 'click', attr, scope.prefix + '-dropdown-click', scope.dropdown.selectedIndex);
                    }

                }

                if (scope.states && scope.states.indexOf('hover') > -1) {
                    scope.hover = function($event, arg_type, message, index) {
                        DirectiveService.sendMessage(scope, arg_type, 'hover', attr, message, index);
                    }
                }

                if (scope.states && scope.states.indexOf('mouse-enter') > -1) {
                    scope.mouseEnter = function($event, index) {
                        scope.mouse.enter = true;
                        scope.mouse.leave = false;
                        console.log('checking mouse enter is still true after', scope.mouseDelays.enter, 'ms')
                        $timeout(function() {
                            if (scope.mouse.enter) {
                                console.log('firing event', scope.prefix + '-dropdown-mouse-enter');
                                arg_type =  'send'
                                message = scope.prefix + '-dropdown-mouse-enter';
                                index = index || 0;
                                DirectiveService.sendMessage(scope, arg_type, 'mouse-enter', attr, message, index);
                            }
                        }, scope.mouseDelays.enter);
                    }
                }

                if (scope.states && scope.states.indexOf('mouse-leave') > -1) {
                    scope.mouseLeave = function($event, index) {
                        scope.mouse.enter = false;
                        scope.mouse.leave = true;
                        console.log('checking mouse leave is still true after', scope.mouseDelays.leave, 'ms');
                        $timeout(function() {
                            if (scope.mouse.leave) {
                                console.log('firing event', scope.prefix + '-dropdown-mouse-leave');
                                arg_type =  'send'
                                message =  scope.prefix + '-dropdown-mouse-leave';
                                index = index || 0;
                                DirectiveService.sendMessage(scope, arg_type, 'mouse-leave', attr, message, index);
                            }
                        }, scope.mouseDelays.leave)
                    }
                }

                if (scope.states && scope.states.indexOf('mouse-leave') > -1) {
                    scope.mouseOver = function($event, index) {
                        console.log('waiting', scope.mouseDelays.over + 'ms');
                        $timeout(function() {
                            if (scope.mouse.enter) {
                                scope.mouse.over = true;
                                arg_type =  'send'
                                message =  scope.prefix + '-dropdown-mouse-over';
                                index = index || 0;
                                DirectiveService.sendMessage(scope, arg_type, 'mouse-over', attr, message, index);
                            }
                        }, scope.mouseDelays.over)
                    }
                }

                scope.toggle = function($event, index) {
                    // $timeout(function() {
                        scope.dropdown.active = !scope.dropdown.active;

                        if (scope.dropdown.selectedRecentlyChanged) {
                            DirectiveService.sendMessage(scope, 'send', 'toggle-off', attr, scope.prefix + '-dropdown-toggle-off', scope.dropdown.selectedIndex);
                            return false;
                        }

                        if (scope.dropdown.active) {
                            DirectiveService.sendMessage(scope, 'send', 'toggle-on', attr, scope.prefix + '-dropdown-toggle-on', scope.dropdown.selectedIndex);
                        } else {
                            DirectiveService.sendMessage(scope, 'send', 'toggle-off', attr, scope.prefix + '-dropdown-toggle-off', scope.dropdown.selectedIndex);
                        }
                        if (scope.dropdown.onToggle) {
                            scope.dropdown.onToggle(scope.dropdown.active);
                        }
                    // })
                }
            }
            }
        };
    }])
    .directive("checkbox", ['RootService', function(RootService) {
        return {
            templateUrl: 'shared/templates/components/checkbox.tpl',
            scope: {
                onChecked: '=onChange',
                label: '=label',
                value: '=value',
                checked: "=checked"
            },
            restrict: 'E',
            link: function(scope, element, attr) {
                scope.label = attr.label || scope.label;

                scope.onValueChanged = function(value) {
                        scope.onChecked && scope.onChecked(value);
                    }
                    // scope.value = scope.value || attr.value;
                    // if (scope.onPropChange) {
                    //   // scope.onPropChange(scope, )
                    // }
            }
        }
}])
.directive('square', ['SVGService', function(SVGService) {
  return {
    restrict: 'E',
    replace: true,
    template: '<svg width="100" height="100" viewBox="0, 0, 100, 100"> <rect stroke="#637074" stroke-width="3" x="1.5" y="1.5" width="97" height="97" rx="10"></rect> </svg>',
    link: {
      pre: function(scope, element, attr) {

      }
    }
  }
}])
.directive('animationGroup', ['RootService', 'AnimationService', '$timeout', '$compile', function(RootService, AnimationService, $timeout, $compile) {
    return {
        restrict: 'E',
        replace: false,
        templateUrl: 'admin/templates/components/animation.group.player.tpl',
        scope: {
            animations: '=animations'
        },
        link: function(scope, element, attr) {
            scope.animInfoDict = {stagger: 100};
            scope.$watch('animations',  function(new_animations) {
                scope.animations = new_animations;
                for (var i = 0; i < scope.animations.length; i++) {

                }

            })
            scope.mappings = {
                'func': 'Timing Function',
                'direction': 'Direction',
                'delay': 'Delay',
                'playState': 'Play State',
                'iter': 'Iterations',
                'name': 'Anim Name',
                'duration': 'Duration'
            }
            scope.playAll = function() {
                for (var i = 0; i < scope.animations.length; i++) {
                    var animationIndex = scope.animations[i];
                    scope.play(animationIndex, i);
                }
            }

            scope.play = function(anim, index) {

                anim.element.css('-webkit-animation-name', '');
                anim.playState = 'running';
                if (scope.animInfoDict.stagger) {
                    anim.delay = scope.animInfoDict.stagger * i;
                }

                $timeout(function() {
                    anim.element.css('-webkit-animation-name', anim.name);
                    scope.$apply();
                })
            }
        }

    }
}])
.directive('projector', [function() {
    return {
        restrict: 'E',
        replace: true,
        transclude: true,
        templateUrl: 'shared/templates/components/containers/projector.tpl'
    }
}])
.directive('slides', [function() {
    return {
        retrict: 'E',
        replace: true,
        transclude: true,
        template: '<ion-slides  options="options" slider="data.slider"><ion-slide-page><div class="box blue"><h1>BLUE</h1></div></ion-slide-page><ion-slide-page>',
        controller: 'SwiperController',
        scope: {
            slides: '=slides'
        },
        link: {
            pre: function(scope, element, attr) {

            }
        }
    }
}])
.directive('animation', ['RootService', 'AnimationService', '$timeout', '$compile', function(RootService, AnimationService, $timeout, $compile) {
  return {
    restrict: 'E',
    replace: true,
    templateUrl: AnimationService.getAnimatableTemplateFunc,
    scope: {
        name: '@name',
        template: '@template',
        obj: '@import',
        stroke: '@stroke'
    },
    link: {
      pre: function(scope, element, attr) {
        $compile(element)(scope);
        var anim = AnimationService.initAnimationObj();
        scope.anim = anim;
        scope.anim.element = element;
        scope.window = scope.$parent.root.window;

        //if attr.template
        anim.template = RootService.getBaseUrl() + attr.template;


        //if attr.import
        anim.obj = AnimationService.getAnimationObjFromAnimationName(attr.import);
        // for (key in anim.obj.cssRules) console.log(anim.obj.cssRules[key]);

        anim.duration = attr.duration && parseFloat(attr.duration) || 3000;
        anim.direction = attr.direction;
        anim.func = attr.func.replace('cb', 'cubic-bezier');
        anim.delay = attr.delay|| 0;
        anim.css = anim.obj.cssText;
        anim.playState = (((attr.play === 'true') && "running") || "paused");
        anim.iter = attr.iter;
        anim.fillMode = attr.fillMode;
        anim.listeners = {start: AnimationService.getStartListener(scope.anim, element[0]), end: AnimationService.getEndListener(scope.anim, element[0])}
        anim.name = attr.import;
        var cb = function(element) {
            $compile(element)(scope);
            $timeout(function() {
                scope.$apply();
            })
        }
        scope.$parent.root.inspectAnimations.push(anim);
        AnimationService.injectAnimationWithPlayer(scope, element, cb, scope.window);
      }
    }
  }
}])
// .directive("userIcon", ['$compile', function($compile) {
//         return {
//             templateUrl: BASE + 'templates/elements/components/info/user.icon.tpl',
//             scope: {
//                 url: '=url',
//                 size: '=size'
//             },
//             replace: true,
//             restrict: 'E',
//             link: function(scope, element, attr) {
//                 scope.size =  scope.size || attr.size || 'small';
//                 scope.url =  scope.url || attr.url || 'https://uguru.me/static/remote/img/avatar.svg';
//                 if (scope.size && scope.size === 'small') {
//                     scope.size = '32'
//                 } else if (scope.size && scope.size === 'medium') {
//                     scope.size = '64'
//                 }
//                 if (!scope.url || !scope.url.length) {
//                     scope.url = 'https://uguru.me/static/remote/img/avatar.svg';
//                 }
//                 var request = new XMLHttpRequest();
//                 request.open('GET', scope.url, true);
//                 request.onreadystatechange = function() {
//                     if (request.readyState === 4) {
//                         if (request.status === 404) {
//                             scope.url = 'https://uguru.me/static/remote/img/avatar.svg';
//                             // element.attr('url',scope.url);
//                             // $compile(element.contents())(scope);
//                             // scope.$apply();
//                             // console.log('Check',scope.url, typeof(scope.url))

//                         }
//                     }
//                 };
//                 // request.send()

//             }
//         };
//     }])


angular.module('uguru.shared.controllers', [])
// angular.module('uguru.shared.controllers')
.controller('RootController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'RootService',
  'XHRService',
  '$compile',
  '$rootScope',
  '$window',
  'DataService',
  function($scope, $state, $timeout, RootService, XHRService, $compile, $rootScope, $window, DataService) {
    var root = this;
    root.scope = $rootScope;
    $rootScope.dataMappings = DataService.dataMappings;
    $rootScope.dataCache = DataService.dataCache;
    root.scope.public = {customStates: {when: {}}};
    root.publicAttr = {};
    root.window = getBodyDimensions(_window);
    root.window.browser = _browser;
    root.window.tablet = root.window.browser.size.tablet
    root.mainViews = [];
    root.customComponents = [];
    root.linkElemCache = {};
    _window = root.window;


    root.window.elemInfo = getElemWindowInfo(root.window);
    root.base_url = RootService.getBaseUrl();
    root.local = window.location.href.split(':8100').length > 1 || window.location.href.split(':8101').length > 1;;
    root.browserPrefix = RootService.getBrowserPrefix();
    root.docs = {items: RootService.getDocItems(), searchText:'', resultIds: [], resultItems:[]};
    root.devMode = window.location.href.split('/dev/').length > 1;
    root.milestones = [];
    root.animStatus = {off: false};
    root.inspectAnimations = [];
    root.inspectElements = [];
    root.broadcaster = {};
    root.easings = easings;
    root.public = {customStates: [], customShortcuts: {}};
    RootService.customShortcuts.getAnimProps = function () {return root.public.customShortcuts};
    root.pauseElement = pauseElement(root);
    RootService.setPauseElementFunc(root.pauseElement);
    RootService.viewPortSize = root.window;
    root.animationCounter = 0;
    root.transitionCounter = 0;
    root.inspector = {players:[], activePlayer: null, elements: [], preferences: {}};
    RootService._window = root.window;
    RootService.setGetInspector(getInspectorPrefs(root.inspector));
    RootService.setInspectableElements(pushElemPlayer(root.inspector));
    RootService.getCustomEasingAnimations(root)();

    var testURL = 'https://s3-us-west-1.amazonaws.com/ui-coach/users/' + '71ab4' + '/app.json'
    function putSuccessCallback(data) {
      console.log(data);
    }
    // XHRService.getJSONFile('GET', testURL, function(data) {
    //   data.testKey = 'yo this is a test key';
    //   XHRService.updateJSONFile(testURL, data, putSuccessCallback)

    //   // $rootScope.app = data; console.log('data received', $rootScope.app);

    // })



    // XHRService.updateJSONFile()

    $timeout(function() {
      RootService.animations = root.public;
      $scope.$apply();

      registerAnimationShortcuts();

    })

    function getElemWindowInfo(window) {

      return function(elem) {
        var eRect = elem.getBoundingClientRect();
        var result = {};
        result.bottom = window.height - eRect.top - eRect.height
        result.top = eRect.top * -1
        result.right =window.width - eRect.right;
        result.left = eRect.left * -1;
        result.rect = eRect;
        result.browser = bowser.bowser();

        return result;
      }
    }

    function registerAnimationShortcuts() {
      if (root.local) {
        var dataSets = ['api'];
        var callback = function(data) {root.data = {animations: {}}; root.data.animations = data;};
        XHRService.getJSONFile('get', 'admin/spec/animations.json', callback);
        // XHRService.getJSONFile('get', 'http://api.stahk.photos/unsplash/random', function(data) {console.log(data)});
      }
    }


  }
]);

function pushElemPlayer(r_inspector) {
  return function(elem) {
    r_inspector.players.push(elem);
    r_inspector.activePlayer = elem;
    console.log('root inspector elems', r_inspector.players)
  }
}

function getInspectorPrefs(r_inspector) {
  return function() {
    return r_inspector.preferences;
  }
}



function pauseElement(scope) {
  return function(element, attr) {
    var animStartEvent = 'animation';
    var cssPrefix = ''

    if (scope.browserPrefix) {
      cssPrefix = '-' + scope.browserPrefix + '-';
      animStartEvent = 'webkitAnimation';
    }
    // console.log(animStartEvent + 'PlayState:paused' + '!important;');
    if (element[0].style) element[0].style.cssText += ';' + cssPrefix + 'animation-play-state:paused' + '!important;';
    if (element[0].style) element[0].style.cssText += ';' + cssPrefix + 'transition-duration:50ms' + '!important;';
    if (element[0].style) element[0].style.opacity = 0.2;
    // e.target.style.cssText += e.target.style[animStartEvent + 'Duration'] + '!important;'
    // e.target.style[animStartEvent + 'Delay'] = '-' +

    if (!scope.bodyListener) {
      document.body.addEventListener(animStartEvent + 'Start', function(e) {
        // console.log(e.target.style[animStartEvent + 'Delay']);

        if (e.target.style && 'style' in e.target) e.target.style.cssText += ';-webkit-animation-play-state:paused' + '!important;'
        if (e.target.style) element[0].style.opacity = 0.2;
        // e.target.style[animStartEvent + 'PlayState'] = 'paused';
      })
      scope.bodyListener = true;
    }




  }
}



var baseCompModule = angular.module('uguru.shared.directives.base.components', []);

 angular.module('uguru.shared.directives.base.components')
    .directive("letter", ["CompService", "$compile", function(CompService, $compile) {

    }])
    .directive("letter", ["CompService", "$compile", function(CompService, $compile) {
        return {
            restrict: 'E',
            replace: true,
            transclude: true,
            templateUrl:CompService.getCompTemplateType('letter'),
            compile: function(element, attr, transclude) {
                return {
                    pre:
                    function (lScope, lElem, lAttr) {
                         transclude(lScope, function(clone, innerScope) {
                            // lElem[0].innerHTML = clone[0].innerHTML;

                            lElem.html(clone.html())// = .innerHTML;
                            lElem.attr('u', '');
                            $compile(lElem)(lScope);
                        })
                    },
                    post: angular.noop
                }
            }
        }
    }])

    .directive('list', ['$compile', '$rootScope', '$parse',  function($compile, $rootScope, $parse) {
        return {
            restrict: 'A',
            replace:true,
            scope:true,
            priority:10000,
            compile: function(element, attr, transclude) {



                var elemName = (element[0].nodeName.toLowerCase() + "").replace(/-(.)/g, function(match, group1) {
                  return group1.toUpperCase();
                });
                this.elemNameDashed = element[0].nodeName.toLowerCase();
                var resultHtml = '';

                if ($rootScope.activeView && elemName in $rootScope.activeView.data.vars.components) {
                    element[0].removeAttribute('list');
                    element[0].setAttribute('custom', '');

                    attr.$set('data', '');
                    $rootScope.activeView.data.vars.components[elemName].forEach(function(data, i) {
                        var dataStr = JSON.stringify(data)
                        resultHtml += element[0].outerHTML.replace('data=""', "data='" + $rootScope.activeView.name + ".data.vars.components." + elemName + "[" + i + "]'").replace('custom=""', 'custom');
                    })
                }
                if (resultHtml.length) {

                    var elem = angular.element(resultHtml);
                    element.replaceWith(elem)
                } else if (attr.list.length) {


                    // var varNameSplit = attr.list.split('.');
                    // var varName = varNameSplit[varNameSplit.length - 1];
                    // if (varName.charAt(varName.length - 1) === 's') {
                    //     varName = varName.substring(0, varName.length -1);
                    // } else {
                    //     varName = 'data';
                    // }
                    // attr.$set('ngRepeat', varName + ' in ' + attr.list);

                    // attr.$set('data', varName )
                    // element[0].setAttribute('custom', '')
                    // element.replaceWith(angular.element(element[0].outerHTML))

                    element.removeAttr('list');
                    return function(scope, elem, _attr) {

                        var elemNameDashed = elem[0].nodeName.toLowerCase();
                        var listData = [];
                        if (attr.list.indexOf('.') > -1) {
                            attrListSplit = attr.list.split('.');

                            listData = $parse(attr.list)(scope);


                                if (isArray(listData)) {
                                    listData.forEach(function(item, i) {
                                        // console.log(i, elem[0].outerHTML)

                                        resultHtml += '<' + elemNameDashed  + '  data="' + attr.list + '[' + i + ']" custom></' + elemNameDashed + '>';


                                        // element[0].removeAttribute('list');

                                        // element.replaceWith(elem)
                                    })
                                    replaceElementAfterListInScope(elem, listData, attr.list, scope, true)
                                }

                                else if (isObject(listData)) {
                                    var scopePtr = scope[attr.list.split('.')[0]];
                                    var newArray = [];
                                    var splitList = attr.list.split('.').splice(1);
                                    var lastKey = splitList.pop();
                                    splitList.forEach(function(scope_var, i) {
                                        scopePtr = scopePtr[scope_var]
                                    })
                                    scopePtr[lastKey] = [];
                                    for (key in listData) {
                                        var _dict = listData[key];
                                        _dict.name = key;
                                        scopePtr[lastKey].push(_dict)
                                    }
                                    replaceElementAfterListInScope(elem, scopePtr[lastKey], attr.list, scope)
                                    // for (key in listData) {
                                    //     scopePtr = scopePtr[key];
                                    //     listData.push(scopePtr[key]);
                                    // }
                                    console.log(scopePtr, listData)
                                }
                                //     if (listData.length) {

                                //         scopePtr = listData;

                                //         // replaceElementAfterListInScope(elem, value, attr.list, scope)
                                //     }
                                // }
                            // }
                        }
                        if (attr.list in scope) {

                            listData = scope[attr.list];


                            listData.forEach(function(listData, i) {
                                // console.log(i, elem[0].outerHTML)

                                resultHtml += '<' + elemNameDashed  + '  data="' + attr.list + '[' + i + ']" custom></' + elemNameDashed + '>';


                                // element[0].removeAttribute('list');

                                // element.replaceWith(elem)
                            })
                            // scope[attr.list] = listData;
                            elem.replaceWith(angular.element(resultHtml));
                        } else {
                            var watcherCancel = scope.$watch(attr.list, function(value) {
                                if (value) {
                                    if (value.length) {

                                        scope[attr.list] = value;

                                        replaceElementAfterListInScope(elem, value, attr.list, scope)

                                        watcherCancel();

                                    }
                                }
                            })
                        }



                        function replaceElementAfterListInScope(elem, list_elements, data_name, scope, skip_compile) {
                            var resultHtml = '';
                            var elemNameDashed = elem[0].nodeName.toLowerCase();
                            list_elements.forEach(function(list_item, i) {
                                resultHtml += '<' + elemNameDashed  + '  data="' + data_name + '[' + i + ']" custom></' + elemNameDashed + '>';
                            })
                            if (resultHtml.length && !skip_compile) {
                                elem.replaceWith($compile(angular.element(resultHtml))(scope))
                            } else {
                                $compile(angular.element(resultHtml))(scope)
                            }

                        }
                        // console.log(scope.options);





                        // $compile(elem)(scope)
                    }

                    function isObject ( obj ) {
                       return obj && (typeof obj  === "object");
                    }

                    function isArray ( obj ) {
                      return isObject(obj) && (obj instanceof Array);
                    }

                    // previous functioning
                    // var elem = angular.element('<article-option-item  data="options[0]" custom></article-option-item>');


                    // element[0].removeAttribute('list');

                    // element.replaceWith(elem)


                }

            }
        }
    }])
    .directive('custom', ['$compile', '$rootScope', '$parse',  function($compile, $rootScope, $parse) {
        return {
            restrict: 'A',
            replace:true,
            // transclude: true,
            scope:true,
            priority: 10000,
            templateUrl: function(element, attr) {

                var elemName = element[0].nodeName.toLowerCase();
                // element.removeAttr('custom')
                // $rootScope.components[elemName]

                if ($rootScope.components) {
                    return $rootScope.components[elemName]['template_url']
                }
            },
            link: function preLink(scope, elem, attr) {
                if ('data' in attr) {

                    if ('keepName' in attr) {
                        var attrName = attr.data;
                        // if (attr.data.indexOf('.') > -1) {
                        //     var dataAttrSplit = attr.data.split('.');
                        //      attrName = dataAttrSplit[dataAttrSplit.length - 1];

                        // }

                        scope[attrName] = $parse(attr.data)(scope);
                        // if (isObject(scope[attrName]) && !isArray(scope[attrName])) {
                        //     var newArray = [];
                        //     var _dict = scope[attrName];
                        //     for (key in _dict) {
                        //         _dict[key].name = key;
                        //         newArray.push(_dict[key]);
                        //     }
                        //     scope[attrName] = newArray;
                        // }
                    }
                    else if ('listItem' in attr) {
                        var attrName = attr.listItem;
                        var attrValue = $parse(attr.data)(scope);

                        scope[attrName] = attrValue;
                    }
                    else if (!attr.keepName) {
                        var attrValue = $parse(attr.data)(scope)

                        for (attr_name in attrValue) {
                            // if (attrValue[attr_name].split('/').length > 3) {
                            //     attrValue[attr_name] = '"' + attrValue[attr_name].split('/').join(".") +
                            //     console.log(attrValue[attr_name] + '"')
                            // }

                            scope[attr_name] = attrValue[attr_name]
                        }
                    }
                    if (!elem[0].outerHTML) {
                        return;
                    }
                    elem.removeAttr('custom');




                    var newElem = $compile(angular.element(elem[0].outerHTML))(scope);
                    elem.replaceWith(newElem)

                    // console.log($parse(angular.element(elem[0].innerHTML.trim())[0].innerHTML.trim())(scope))
                    // console.log($parse(angular.element(elem[0].innerHTML)[0].innerHTML + '')(scope))
                }






            }

            // compile:function(element, attr, transclude) {
            //     return {

            //     pre: function preLink(scope, p_elem, p_attr) {

            //         // scope.public = scope.$parent.public
            //         // scope.root = scope.$parent.root
            //         // scope.data = $parse(p_attr.data)(scope);
            //         console.log(scope.data)

            //         if (scope.data) {
            //             for (key in scope.data) {
            //                 console.log('setting', key, scope.data[key])
            //                 scope[key] = scope.data[key];
            //             }
            //         } else {
            //             for (attr in p_attr.$attr) {
            //                 var camelAttrName = p_attr.$normalize(attr);

            //                 if (p_attr[camelAttrName].length) {
            //                     scope[camelAttrName] = p_attr[camelAttrName];
            //                 }
            //             }
            //         }



            //         p_elem.removeAttr('custom');
            //         $compile(p_elem)(scope)

            //         transclude(scope, function(clone, innerScope) {
            //             console.log(clone)

            //             $compile(clone)(innerScope);

            //             // p_elem.contents(clone)

            //             // $compile(p_elem)(scope.$parent)
            //             // p_elem.removeAttr('custom')
            //             // p_elem.contents(clone)

            //         })


            //         },
            //     post: angular.noop

            // }
        // }
        }
    }])

    // .directive('uImage', ['$compile',  function($compile) {
    //     return {
    //         restrict: 'E',
    //         replace: true,
    //         templateUrl: function(element, attr) {
    //             return 'shared/templates/components/graphic/image.' + (attr.type && (attr.type + '.')  || '') + 'tpl';
    //         },
    //         link: {
    //             pre: function (scope, element, attrs) {
    //                     var imageElem = element[0].querySelector('img');
    //                     console.log(imageElem)
    //                 }

    //         }
    //     }
    // }])
    .directive('media', ['$compile', 'XHRService', '$timeout', 'CompService', function($compile, XHRService, $timeout, CompService) {
        return {
            restrict: 'E',
            replace: true,

            templateUrl:'shared/templates/components/base/media.tpl',
            compile: function(element, attrs) {
                var progressFunc;
                var callback;

                var imgSrc = attrs.src;
                var img = element[0].firstChild;


                return {
                    pre: function(scope, lElem, lAttr) {
                        scope.m = {type: lAttr.type, url: lAttr.url, media:{url:''}, loader: {url: '', duration: 0, mb: {total:0, loaded:0},kb: {total:0, loaded:0}}};
                        scope.imgLoaded = false;
                        scope.loadRate = 0;

                        var startTime = new Date().getTime();
                        if (lAttr.loadWith) {
                            scope.m.loader.url = 'shared/templates/components/base/loader/' + lAttr.loadWith + '.tpl';
                        }

                        if (lAttr.import) {
                            scope.m.media.url = 'shared/templates/components/base/media/' + lAttr.import + '.tpl';
                        }

                        progressFunc = function(oEvent) {
                            var kbRemaining = oEvent.loaded/1000;
                            var kbTotal = oEvent.total/1000;
                            var deltaT = new Date().getTime() - startTime;
                            var percent = parseInt(10000*(kbRemaining/kbTotal))/100;
                            var eta = 100/percent * deltaT;

                            if (!scope.loadRate) {
                                scope.loadRate = (1000/deltaT) * 1500;
                            }
                            scope.m.loader.kb.total = kbTotal;
                            scope.m.loader.kb.loaded = kbRemaining;
                            scope.m.loader.mb.total = kbTotal/1000;
                            scope.m.loader.mb.loaded = kbRemaining/1000;
                            scope.m.loader.duration = Math.max(eta, 1000);
                            scope.m.loader.percent = percent;
                        };
                        callback = function(response) {

                            scope.m.loader.complete = true;
                            scope.m.data_url = window.URL.createObjectURL(new Blob([response]));
                            var elem = document.querySelector('[media-child]');

                            elem.style.backgroundImage = "url('" + response + "')";
                            elem.setAttribute('u', '');
                            $compile(angular.element(elem))(scope)
                            // CompService.getMediaElemOfType(lAttr.type, response, lElem[0].attributes, scope, lAttr, lElem);
                            scope.$parent.public.customStates['when-loader-complete'][0].func()
                        }
                        XHRService.getFileWithProgress(lAttr.url, progressFunc, null, callback)

                        // scope.img =  {imgHTML: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='30' height='30'><circle cx='15' cy='15' r='10' /></svg>"}
                    },
                    post: angular.noop
                }
            }
        }
    }])
    .directive('scrollable', ['ScrollService', function(ScrollService) {

        return {
            restrict: 'A',
            replace:true,
            compile: function(element, attr) {
                var scrollName = ScrollService.initScrollContainer(element, attr);
                var rect;
                return function postLink(scope, elem) {
                    // elem.ready(function() {

                    //     ScrollService.scroll.contained[scrollName].info.element = elem;
                    // })


                    var cancelWatcher = scope.$watch(function() {
                        rect = elem[0].getBoundingClientRect();
                        return rect.height

                    }, function(value) {

                        if (value && parseInt(value) && value > 0) {

                            for (key in ScrollService.scroll.contained) {
                                if (scrollName === key && 'info' in ScrollService.scroll.contained[scrollName]) {
                                    if (rect) {
                                        // console.log(rect.height, rect.width);
                                        ScrollService.scroll.contained[scrollName].info.height = rect.height;
                                        ScrollService.scroll.contained[scrollName].info.width = rect.width;
                                        ScrollService.scroll.contained[scrollName].info.posY = elem[0].scrollTop;
                                        ScrollService.scroll.contained[scrollName].info.posX = elem[0].scrollLeft;
                                        ScrollService.scroll.contained[scrollName].info.scrollWidth = elem[0].scrollWidth;
                                        ScrollService.scroll.contained[scrollName].info.scrollHeight = elem[0].scrollHeight;
                                        var scrollPos = {};
                                        scope.$watch(function() {
                                            var _elem = elem;
                                            return _elem[0].scrollTop

                                        }, function(value) {
                                            // console.log(100* value/ScrollService.scroll.contained[scrollName].info.scrollHeight + '%')
                                            console.log(ScrollService.scroll.contained[scrollName].info.posY, value)
                                        })
                                        cancelWatcher();
                                    }

                                }

                            }
                        }
                        // console.log(value)
                    })
                }
            },

        }
    }])
    .directive('keypressEvents', [
      '$document',
      '$rootScope',
      'KeyboardService',
      function($document, $rootScope, KeyboardService) {
        return {
          restrict: 'A',
          link: function() {
            $document.bind('keydown', function(e) {
            KeyboardService.record(e);
              $rootScope.$broadcast('keydown', e);

              $rootScope.$broadcast('keydown:' + e.which || e.keyCode, e);
            });
            $document.bind('keyup', function(e) {

              $rootScope.$broadcast('keyup', e);
              $rootScope.$broadcast('keyup:' + e.which || e.keyCode, e);
            });
          }
        };
      }
    ])
    .directive('types', ['$compile', '$stateParams', "$timeout", function($compile, $stateParams, $timeout) {
        return {
            scope: false,
            link: {pre: function(scope, element, attr) {
                scope.types = attr.types.split(', ');
                scope.activeType = $stateParams.type || scope.types[0];

                var d = angular.element('<div></div>')
                d.attr('ng-include', '"admin/templates/types.tpl"');
                element.parent().append(d);
                $compile(d)(scope)
                scope.activateType = function($event, type) {
                    $timeout(function() {
                      scope.activeType = type;

                      scope.$apply();

                      // $compile(angular.element(elem))($scope);
                    })
                }
                // console.log(element)
            }}
        }
    }])
    .directive('chartPlayer', ['$compile', function($compile) {
        return {
            restrict: 'E',
            scope: {'player':'='},
            templateUrl: 'admin/templates/animations/chart.player.tpl',
            replace:true
        }
    }])
    .directive('childGrow', ['$compile', function($compile) {
    return {
        restrict: 'A',
        scope:true,
        replace: false,
        transclude:true,
        compile: function(element, attr, transclude) {
            return function preLink(scope, p_element, p_attr) {
                transclude(scope, function(clone, inner_scope) {
                    p_element.append(clone);
                    p_element.removeAttr('child-grow')
                    p_element = $compile(p_element.contents())(scope)
                })
            }
        }
    }
    }])
    .directive('size', ['$compile', function($compile) {
        return {
            restrict: 'A',
            priority: 10000,
            compile: function(element, attr, transclude) {
                var sizeAttr = attr.size;
                var dim = {};
                if (sizeAttr.length) {
                    var sizeAttrSplit = sizeAttr.split(' ');
                    if (sizeAttrSplit.length === 2)  {
                        dim.width = sizeAttrSplit[0];
                        dim.height = sizeAttrSplit[1];
                    } else {
                        dim.width = sizeAttrSplit[0];
                        dim.height = sizeAttrSplit[0];
                    }
                }
                var extension = '';
                if (dim.width.indexOf('%') === -1 && dim.width.indexOf('px') === -1) {
                    extension = '%';
                }
                if (dim.height.indexOf('%') === -1 && dim.height.indexOf('px') === -1) {
                    extension = '%';
                }

                element.css('height', dim.width + extension);
                element.css('width', dim.height + extension);
                element.removeAttr('size');
                // e.append(element)
            }
        }
    }])
    .directive('inspectData', ['$rootScope', '$timeout', function($rootScope, $timeout) {
        return {
            restrict: 'E',
            scope:false,
            priority: 10000,
            link: function postLink(scope, element, attr) {
                // if (element[0] && element[0].outerHTML) element[0].outerHTML = '';
                if (!$rootScope.inspected) {
                    $rootScope.inspected = true;

                    $timeout(function() {
                        _scope = scope;
                        var dataFields = Object.keys(attr.$attr);
                        var index = 1;
                        if (!dataFields.length) {
                            dataFields = Object.keys(_scope).filter(function(key) {return key.indexOf('$') === -1})
                        }





                        console.log('\n\nDATA AUDIT - ' + dataFields.length + ' fields found\n\n');


                        var fields = 'fields' in attr && attr.fields.split(',') || [];

                        dataFields.forEach(function(field_name) {
                            var obj = {};
                            if (field_name in _scope) {
                                obj[field_name] = _scope[field_name]
                                console.log('#' + index + ':', field_name, obj);
                            } else {
                                console.log('#' + index + ':', 'does not exist in current environment');
                            }
                            index++;
                        })
                        var parentDataFields = Object.keys(scope.$parent).filter(function(key) {return key.indexOf('$') === -1})

                    }, 100)
                }
            }
        }
    }])
    .directive('replace', ['$compile', function($compile) {
        return {
            restrict: 'E',
            transclude: 'element',
            replace:true,
            priority:100,
            scope: false,
            link: {pre: function preLink(scope, element, attr, ctrl, transclude) {

                var urlElem = "<graphic " + " url='" + attr.with + "'></graphic>"

                    e = angular.element(urlElem)
                    for (key in attr.$attr) {
                        e.attr(key, attr[key])
                    }

                    $compile(e)(scope)
                    element.after(e)

                }
            }
        }
    }])
    // .directive('url', [function() {
    //     return {
    //         restrict: 'A',
    //         scope:false,
    //         priority: 10000,
    //         compile: function(element, attr) {

    //             if (element[0].nodeName.toLowerCase() === 'graphic') {
    //                 return;
    //             }

    //             if (attr.url.indexOf('/') === -1) {

    //                 attr.$set('ngInclude', attr.url);
    //                 element.removeAttr('url');
    //             } else {
    //                 attr.$set('ngInclude', "'" +  attr.url + "'");
    //             }

    //         },
    //         link: function(scope, elem, attr) {
    //             console.log('ay', scope.nav)
    //         }
    //     }
    // }])
    .directive('modal', ['$compile', function($compile) {
        return {
            restrict: 'E',
            transclude:'element',
            template: '<ui-view ng-transclude></ui-view>',
            controller: ["$scope", "$attrs", "$transclude", function($scope, $attrs, $transclude) {
                console.log($transclude());
            }]
        }
    }])
    .directive('resize', ['$compile', '$parse', function($compile, $parse) {
        return {
            restrict: 'A',
            terminal: true,
            controller: ["$scope", "$attrs", "$element", function($scope, $attrs, $element) {

                var value = $attrs.resize;

                if (value.length && value.indexOf('.') === -1) {
                    var cancelAfter = $attrs.$observe('resize', function(value) {
                        findAndResizeElement($scope.view.main.element, $element, value)
                        cancelAfter();
                    })
                }
                else if ($scope.view.main && $scope.view.main.element){
                    findAndResizeElement($scope.view.main.element, $element, $attrs.resize)
                }
                else if (!$scope.view.main) {
                    var watcherMain = $scope.$watch(function(value) {
                        if ('element' in value) {
                            watcherMain();
                            findAndResizeElement($scope.view.main.element, $element, $attrs.resize)
                        }
                    })
                }

                function findAndResizeElement(main_elem, elem, resize_elem) {
                    main_elem.ready(function() {
                        if (resize_elem.split('select').length > 1) {


                                // elem.ready(function() {
                            var elemRef = resize_elem.split('select:')[1];
                            var params = [];
                            var paramsMap = {'w': 'width', 'h':'height', 'l':'left', 'r': 'right', 't': 'top', 'b': 'bottom'}
                            if (elemRef.split(':').length > 1) {
                                params = elemRef.split(':')[1].split(',');
                                elemRef  = elemRef.split(':')[0];


                            }
                            elem.ready(function() {


                                var searchedElem = main_elem[0].querySelector(elemRef);
                                if (searchedElem) {
                                    var bounds = searchedElem.getBoundingClientRect();
                                    if (params.length) {
                                        $scope.resize = {};
                                        params.forEach(function(param, i) {
                                            param = param.replace('[', '').replace(']', '');

                                            var multiplier = ['*','+','-', '/'].filter(function(oper, i) {return param.indexOf(oper) > -1});
                                            if (multiplier.length) {
                                                multiplier.forEach(function(oper, i){

                                                    multiplier[i] = {num: parseFloat(param.split(oper)[1]), oper: oper}
                                                    if (i === 0) {
                                                        param = param.split(oper)[0];
                                                    }
                                                })
                                            }

                                            if (param in paramsMap) {
                                                var prop = paramsMap[param];
                                                var value = bounds[prop]
                                                if (multiplier.length) {
                                                    var valuestr = value;
                                                    multiplier.forEach(function(obj, i) {
                                                        valuestr += obj.oper + obj.num
                                                    })
                                                    value = $parse(valuestr)($scope)


                                                }
                                                $scope.resize[prop] = value + 'px';
                                                elem.css(prop, value + 'px');
                                            }

                                            // elem.css('width', bounds.width + 'px');
                                            // elem.css('left', bounds.left + 'px');
                                        })
                                    } else {

                                    }

                                }

                            })


                        }

                    })

                }
            }]
        }
    }])
    .directive('graphic', ['$compile', 'CompService',  function($compile, CompService) {
        return {
            restrict: 'E',
            priority: 10001,
            transclude: true,
            templateUrl: function(element, attr) {
                return attr.url
            },
            controller: ["$scope", "$transclude", "$element", "$attrs", function($scope,$transclude, $element, $attrs) {

                $scope.$watch('url', function(value){
                    if (value) {
                        console.log(value)
                    }
                })
            }]
            // compile: function compile(element, attr, transclude)  {

            //     // CompService.renderAllStyleAttributes(element, attr);
            //     var url = attr.url;
            //     console.log('it gets here', 2)
            //     return {
            //         pre: function(post_scope, post_element, post_attr) {
            //             if (url && url.indexOf('/') > -1 && post_element[0].outerHTML) {
            //                 post_element.removeAttr('ngInclude')
            //                 post_element.removeAttr('url')
            //                 // $compile(post_element)(post_scope)
            //                 // if (post_attr.ngInclude) {
            //                 //     if (post_element[0].outerHTML) {
            //                 //         post_element.removeAttr('ngInclude')
            //                 //     }

            //                 // }

            //                 // console.log(url, post_element[0])
            //             }
            //             if (post_scope.chart) post_scope.chart.elem = post_element;

            //         }
            //     }
            // }
        }
    }])

    .directive('uChart', ['$compile', '$timeout', function($compile, $timeout) {
// http://stackoverflow.com/questions/24615103/angular-directives-when-and-how-to-use-compile-controller-pre-link-and-post
    return {
            restrict: 'E',
            replace:true,
            transclude:true,
            templateUrl: 'shared/templates/components/base/grid/state.chart.tpl',
            controller: 'AdminChartController',
            controllerAs:'chart',
            scope: true,
            compile: function compile( element, attr ) {

                if (!attr.src) attr.src = 'shared:components.svg.logo.guru-head.html'

                return {
                    pre: function preLink( scope, lElem, attributes ) {
                        console.log(lElem[0])
                        // element.append(scope.chart.element)
                        // $compile(element)(scope)
                        // element.replaceWith(scope.chart.element.children().children().contents())
                        // $compile(element)(scope)


                        console.log( attributes.log + ' (pre-link)'  );
                    },
                    post: function postLink( scope, pElem, attributes ) {
                        // $compile(element)(scope)
                        // var animObj = scope.renderAnimationStr(element.find('svg'), null, attr.state, scope.chart.context);
                        // scope.chart.player = animObj.player;

                        $timeout(function() {
                            // scope.chart.elem = document.querySelector('#chart-elem');
                            // console.log(scope.chart.elem)
                        })
                    }
                };
             }
         };

    }])
    .directive("chart", ["$compile", "SVGService", "$timeout", function($compile, SVGService, $timeout) {
        return {
            restrict: 'E',
            replace: true,
            templateUrl: 'shared/templates/components/base/grid/chart.tpl',
            scope: {stream:'=cData', player: '=player'},
            compile: function(lElem, attr, transclude) {
                return {
                    pre: function(scope, elem, attr) {

                        if (scope.stream || typeof scope.stream !== 'object') {
                            console.log('expecting string', attr.state);
                            return;
                        }



                        scope.stream.showProps = false;
                        scope.chart = scope.stream.plot;
                        scope.chart.mouseEntered = false;
                        scope.chart.mouseEnteredPoint = null;
                        scope.chart.focusedPoints = [];
                        scope.chart.showDetails = false;
                        scope.chart.lastPointHovered = null;
                        scope.chart.lastPointEntered = null;
                        scope.chart.lastPointHoveredIndex = 0;

                        scope.chart.onMousePointEnter = function(index, point, $event) {
                            console.log('entering...', point, $event);
                            scope.chart.lastPointHovered = point;
                            scope.chart.lastPointHoveredIndex = index;
                        }
                        // scope.chart.onMousePointLeave = function(point, $event) {
                        //     console.log('leaving...', point, $event.type);
                        // }

                        scope.chart.onMousePointDown = function(point, $event) {
                            scope.chart.lastPointEntered = point;
                            $timeout(function() {
                                scope.$apply();
                            })
                        }

                        scope.chart.onMousePointUp = function(point, $event) {
                            console.log('unpressing...', point, $event);
                        }
                        scope.chart.onClick = function(stream, $event) {

                            var percent = $event.layerX / elem[0].getBoundingClientRect().width;
                            console.log(percent)
                            scope.player.jump(scope.player, percent, 1);
                        }
                        scope.chart.onMouseEnter = function(stream, $event) {

                            scope.player.focusStream(scope.player, stream);
                            scope.chart.showDetails = true;
                            if (scope.chart.mouseEntered) {
                                scope.chart.mouseEnterPending = false;
                                return
                            }
                            scope.chart.mouseEnterPending = true;
                            $timeout(function() {
                                if (!scope.chart.mouseEntered && scope.chart.mouseEnterPending) {
                                    scope.chart.mouseEntered = true;
                                }
                            } )
                        }

                        scope.chart.onMouseLeave = function(stream, $event) {
                            scope.chart.showDetails = false;
                            scope.player.unFocusStream(scope.player, stream)
                        }
                        scope.chartReady = true;
                        for (vb in scope.chart.vb) {
                            vb = scope.chart.vb[vb].toFixed(2)
                        }
                        scope.chart.mouseEntered = false;
                        scope.chart.mouseEnterPending = false;
                        $compile(elem)(scope);

                    }
                }
            }
        }
    }])
.directive('text', ['StyleService', '$compile', '$timeout', function (StyleService, $compile, $timeout) {
      return {
        restrict: 'AE',
        priority: 1,
        compile: function(elem, attr) {
          !('fill' in attr) && attr.$set('fill', 'white');

          !('x' in attr) && attr.$set('x', '50');
          !('y' in attr) && attr.$set('y', '56.25');
          !('fontSize' in attr) && attr.$set('font-size', '75');
          !('textAnchor' in attr) && attr.$set('text-anchor', 'middle');
          // return {
          //       pre:function (lScope, lElem, lAttr) {

          //           transclude(lScope, function(clone, innerScope) {
          //               // lElem[0].innerHTML = clone[0].innerHTML;
          //               // lElem.html(clone.html())// = .innerHTML
          //           })
          //       }
          //   }

        }
      };
    }])
    // .directive('item', ['StyleService', '$compile', function (StyleService, $compile) {
    //   return {
    //     restrict: 'AE',
    //     templateUrl: 'shared/templates/components/base/svg/item.svg.tpl',
    //     compile: function(elem, attr) {
    //       elem.css(StyleService.css.flexItem);
    //       ('height' in attr) && attr.$set('height', attr.height);
    //     },
    //     replace: true,
    //     transclude: true,
    //     priority:1
    //   };
    // }])
    // angular.module('uguru.shared.directives.base.components')
    .directive("render", ["AdminSVGRenderService", "$compile", function(AdminSVGRenderService, $compile) {
        return {
            restrict: 'E',
            templateUrl:function(element, attr) {
                var srcSplit = attr.src.split('.');
                var ending = '.' + srcSplit[srcSplit.length - 1];
                return srcSplit.slice(0, srcSplit.length - 1).join('/') + ending;
            },
            transclude:true,
            terminal:true,
            compile: function(element, attr, transclude) {
                elem = AdminSVGRenderService.parseRawSVG(element.children());
                element.parent().contents(elem);
                console.log(element.children()[0])
                // return {
                //     pre:function (lScope, lElem, lAttr) {

                //          transclude(lScope, function(clone, innerScope) {
                //             lElem.contents(clone);
                //             // lElem[0].innerHTML = clone[0].innerHTML;
                //             // lElem.html(clone.html())// = .innerHTML;
                //             // $compile(lElem)(lScope);
                //         })
                //     },
                //     post: angular.noop
                // }
            }
        }
    }])

    .directive("l", ["CompService", "$compile", function(CompService, $compile) {
        return {
            restrict: 'E',
            replace: true,
            transclude: true,
            templateUrl:CompService.getCompTemplateType('letter'),
            compile: function(element, attr, transclude) {
                return {
                    pre:
                    function (lScope, lElem, lAttr) {
                         transclude(lScope, function(clone, innerScope) {
                            // lElem[0].innerHTML = clone[0].innerHTML;
                            lElem.html(clone.html())
                            $compile(lElem)(lScope);
                        })
                    },
                    post: angular.noop
                }
            }
        }
    }])
    .directive("paragraph", ["CompService", "$compile", "UtilitiesService", function(CompService, $compile, UtilitiesService) {
        return {
            restrict: 'E',
            replace: true,
            transclude: true,
            templateUrl:CompService.getCompTemplateType('letter'),
            compile: function(element, attr, transclude) {

                return {
                    pre:
                        function (lScope, lElem, lAttr) {
                            var tpl = lElem
                            var delay = 0;
                            if (!('keep' in attr)) {
                                lElem = lElem.parent().html('');
                            }
                            if ('delay' in attr && attr.delay.length) {
                                delay = parseInt(attr.delay);
                            }

                            transclude(lScope, function(clone, innerScope) {

                                var words = clone[0].innerHTML;
                                var wordArr = (words && words.length && words.split(' ')) || []
                                var wordCloudDiv = '<div class="flex-wrap">'
                                wordArr.forEach(function(wd, i) {wordCloudDiv += '<span>' + wd + '</span>&nbsp;'});
                                wordCloudDiv += '</div>'
                                wordCloudDiv = angular.element(wordCloudDiv);
                                $compile(wordCloudDiv)(innerScope);



                                lElem.css('visibility', 'hidden');
                                lElem.append(wordCloudDiv);
                                var uniqueSpans = lElem[0].firstChild.children
                                var lineDict = {};
                                for (var i = 0; i < uniqueSpans.length; i++) {
                                    var iSpan = uniqueSpans[i];
                                    var rectTop = parseInt(iSpan.getBoundingClientRect().top);
                                    if (!(rectTop in lineDict)) {
                                        lineDict[rectTop] = [];
                                    }
                                    lineDict[rectTop].push(iSpan.innerHTML)
                                }
                                var lineWordArr = [];
                                wordCloudDiv.html('')
                                lElem.css('visibility', 'visible');
                                var index = 0;
                                for (key in lineDict) {
                                    var lineClone = tpl.clone();
                                    var sentence = lineDict[key].join(" ")

                                    lineClone.html('');

                                    if (delay) {
                                        CompService.applyDelayToWord(lineClone, delay * index);
                                    }

                                    lineClone[0].innerHTML = sentence

                                    $compile(lineClone)(innerScope);
                                    lElem.children().append(lineClone);
                                    index++;
                                }

                            })
                        }
                    }
                }
            }
    }])
    .directive("sentence", ["CompService", "$compile", function(CompService, $compile) {
        return {
            restrict: 'E',
            replace: true,
            transclude: true,
            templateUrl:CompService.getCompTemplateType('letter'),
            compile: function(element, attr, transclude) {
                return {
                    pre:
                        function (lScope, lElem, lAttr) {
                            var tpl = lElem
                            var delay = 0;
                            if (!('keep' in attr)) {
                                lElem = lElem.parent().html('');
                            }
                            if ('delay' in attr && attr.delay.length) {
                                delay = parseInt(attr.delay);
                            }
                            transclude(lScope, function(clone, innerScope) {
                                var wordArr = [];

                                var textStr = clone.html().split(' ');
                                for (var i = 0; i < textStr.length; i++) {
                                    var iChild = textStr[i]
                                    if (i < textStr.length - 1) {
                                        iChild += '&nbsp;';
                                    }
                                    var cloneLetter = tpl.clone();
                                    if (delay) {
                                        CompService.applyDelayToWord(cloneLetter, delay * i);
                                    }
                                    cloneLetter.html(iChild);
                                    $compile(cloneLetter)(innerScope)
                                    lElem.append(cloneLetter);
                                }
                                if ('keep' in attr ) {
                                    keepContainer = angular.element('<div></div>');
                                    lElem.parent().append(keepContainer);
                                    var children = lElem.contents();
                                    lElem.replaceWith(keepContainer)
                                    keepContainer.append(children);
                                }
                            })
                        }
                    }
                }
            }
    }])
.directive("word", ["CompService", "$compile", function(CompService, $compile) {
        return {
            restrict: 'E',
            replace: true,
            transclude: true,
            scope: {innerText: '=text'},
            templateUrl:CompService.getCompTemplateType('letter'),
            compile: function(element, attr, transclude) {

                return {
                    pre:
                    function (lScope, lElem, lAttr) {
                        // if (lScope.innerText) {


                        //     lElem[0].innerHTML =lScope.innerText;
                        // }
                        var tpl = lElem
                        var delay = 0;
                        if (!('keep' in attr)) {
                            lElem = lElem.parent();
                            if (!lElem) lElem = element;
                            lElem.attr('class', attr.class);
                            lElem.html('');

                            if (!lElem) {
                                lElem = element;
                            }
                        }
                        if ('delay' in attr && attr.delay.length) {
                            delay = parseInt(attr.delay);
                        }



                        transclude(lScope, function(clone, innerScope) {
                            var childArr = [];
                            var textStr = clone.html() || lScope.innerText;
                            if (textStr.charAt(textStr.length - 1) !== ' ') {
                                textStr += ' '
                            }
                            for (var i = 0; i < textStr.length; i++) {

                                var iChild = textStr.charAt(i);
                                if (iChild === ' ') {
                                    iChild += '&nbsp;';
                                }
                                var cloneLetter = tpl.clone();
                                cloneLetter.css('webkit-transition', 'none');

                                cloneLetter.attr('on-init', cloneLetter.attr('on-init') + ':delay-' + (delay * i || 0));
                                cloneLetter.attr('u', '')
                                if (delay) {
                                    CompService.applyDelayToWord(cloneLetter, delay * i);
                                }
                                cloneLetter.html(iChild);



                                $compile(cloneLetter)(innerScope);
                                lElem.append(cloneLetter);

                            }
                            console.log(lElem.contents()[0])
                            if ('keep' in attr ) {
                                keepContainer = angular.element('<div></div>');
                                lElem.parent().append(keepContainer);
                                var children = lElem.contents();
                                lElem.replaceWith(keepContainer)

                                keepContainer.append(children);
                            } else {
                                lElem.replaceWith(lElem.children());
                                lElem.addClass('flex-vertical-center')
                            }

                            $compile(lElem)(lScope);


                        })
                    }
                }
            }
        }
    }])
    .directive("item", ["CompService", "$compile", function(CompService, $compile) {
        return {
            restrict: 'E',
            replace:true,
            priority: 102,
            compile: function(element, attr, transclude) {
                CompService.renderAllStyleAttributes(element, attr);

            }
        }
    }])
    .directive("gridItem", ["CompService", "$compile", function(CompService, $compile) {
        return {
            restrict: 'E',
            replace:true,
            priority: 102,
            compile: function(element, attr, transclude) {
                CompService.renderAllStyleAttributes(element, attr);
            }
        }
    }])
    .directive("bg", [function(CompService) {
        return {
            restrict: 'A',
            scope: false,
            replace:true,
            compile: function(element, attr) {
                if (attr.mBg && attr.mBg.length && _window.mobile) return;

                var backgroundString = attr.bg;
                if (attr.bg && attr.bg.length) {
                    var hasHex = attr.bg.indexOf('#');
                    var hasRgb = attr.bg.indexOf('rgb');
                    if (hasHex > -1 || hasRgb > -1) {
                        element.css('backgroundColor', attr.bg);
                    }
                    else if (attr.bg.length){
                        element.addClass('bg-' + attr.bg);
                    }
                }
            }
        }
    }])
    .directive("uInput", ["CompService", function(CompService) {
        return {
            restrict: 'E',
            scope: false,
            replace:true,
            templateUrl: 'shared/templates/components/base/input.tpl',
            compile: function(element, attr) {
                CompService.renderAllStyleAttributes(element, attr);
                 return {
                    pre: function preLink(scope, elem, attr) {
                        scope.type = attr.type || 'light';
                    }
                }
            }
        }
    }])
    .directive("attrValueSet", ["DataService", function(DataService) {
        return {
            restrict: 'E',
            scope: false,
            replace:true,
            compile: function(element, attr) {
                for (attr_name in attr.$attr) {
                    if (attr_name.indexOf('$') === -1 && attr[attr_name].split(' as ').length === 2) {
                        var attr_d = {};
                        var attrNameSplit = attr[attr_name].split(' as ');
                        attr_d.pre = attr_name;
                        attr_d.postdash = attrNameSplit[1].trim();
                        attr_d.value = attrNameSplit[0];
                        DataService.initNewAttrDirective(attr_d);
                    }
                }
            }
        }
    }])
    .directive("publicAttr", [function() {
        return {
            restrict: 'A',
            scope: false,
            link: {
                post: function(scope, elem, attr) {
                    if (!(elem[0].id in scope.root.publicAttr)) {
                        scope.root.publicAttr[elem[0].id] = [];
                    }
                    if (attr.publicAttr && attr.publicAttr.length) {
                        attr.publicAttr.split(' ').forEach(function(attr_str, i) {
                            if (attr_str === 'coords') {
                                scope.root.publicAttr[elem[0].id].push(elem[0].getBoundingClientRect());
                                console.log(scope.root.publicAttr)
                            }
                        })
                    }


                }
            }
        }
    }])
    .directive("image", [function() {
        return {
            restrict: 'E',
            scope: false,
            replace:true,
            templateUrl: 'shared/templates/components/base/image.tpl',
            compile: function(element, attr) {
                CompService.renderAllStyleAttributes(element, attr);
                 return {
                    pre: function preLink(scope, elem, attr) {

                    },
                    post: angular.noop
                }
            }
        }
    }])
    .directive("calendar", ["$compile", "CompService", function($compile, CompService) {
        return {
            restrict: 'E',
            scope: false,
            replace:true,
            templateUrl: 'shared/templates/components/base/calendar.tpl',
            compile: function(element, attr, transclude) {
                CompService.renderAllStyleAttributes(element, attr);

                return {
                    pre: function preLink(scope, elem, attr) {
                        // var

                        var today = new Date();

                        var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                        scope.daysOfWeek = ['Mon', 'Tues', 'Wed', 'Thurs', 'Fri', 'Sat', 'Sun'];

                        var calendar = {
                            month: months[today.getMonth()],
                            date: today.getUTCDate(),
                            year: today.getYear() + 1900,
                            day: today.getDay() + 1,
                            numDays: new Date(today.getFullYear(), today.getMonth()+1, 0).getUTCDate(),
                            days: []
                        }



                        for ( var i = 0; i < calendar.numDays; i++) {
                            calendar.days.push({
                                isBefore: calendar.date > i,
                                isToday: calendar.date === i,
                                isAfter: calendar.date < i,
                                dayName: scope.daysOfWeek[calendar.day % 6],
                                day: i
                            })
                        }
                        console.log(calendar.days)
                        scope.calendar = calendar;

                        // transclude(scope, function(clone, innerScope) {

                        //     console.log();
                        //     for (var i = 0; i < clone.length; i++) {
                        //         console.log(clone[i]);
                        //     }
                        // });
                        // for (var i = 0; i < scope.numDays)





                    }
                }
            }
        }
    }])
    .directive("txt", ["CompService",function(CompService) {
        return {
            restrict: 'E',
            scope: false,
            compile: function(element, attr) {
                if (attr.txt && attr.txt.length && _window.mobile) return;
                CompService.renderAllStyleAttributes(element, attr);
                element.addClass('flex-vertical-center')
                if (attr.center) {
                    element.css('text-align', 'center');
                }
                if (attr.lineHeight) {
                    element.css('line-height', parseFloat(attr.lineHeight));
                }
            }
        }
    }])
    .directive("m-txt", ["CompService",function(CompService) {
        return {
            restrict: 'E',
            scope: false,
            compile: function(element, attr) {
                if (!scope.root.window.mobile) {
                    return;
                }
                CompService.renderAllStyleAttributes(element, attr);
                element.addClass('flex-vertical-center')
                if (attr.center) {
                    element.css('text-align', 'center');
                }
                if (attr.lineHeight) {
                    console.log('has line height')
                    element.css('line-height', parseFloat(attr.lineHeight));
                }
            }
        }
    }])
    .directive("mBg", [function(CompService) {
        return {
            restrict: 'A',
            scope: false,
            link: {pre:
                 function preLink(scope, element, attr) {

                    if (!scope.root.window.mobile) {
                        return;
                    }
                    var backgroundString = attr.mBg;
                    if (attr.bg && attr.mBg.length) {
                        if (attr.mBg.indexOf('#') > -1 || attr.mBg.indexOf('rgb') > -1) {
                            element.css('backgroundColor', '#FFFFF');
                        } else {
                            element.addClass('bg-' + attr.mBg);
                        }
                    }

                }
            }
        }
    }])
    // http://41.media.tumblr.com/ae90b8caeba47c980d343fedfc547b55/tumblr_n9v9gbigA21sciteso1_500.png
    .directive("importView", ["CompService", "$compile", function(CompService, $compile) {
        return {
            restrict: 'E',
            replace:true,
            priority: 1000,
            templateUrl: function(element, attr) {
                return attr.url;
            }
        }
    }])
    .directive("mainView", [function() {
        return {
            restrict: 'E',
            scope: false,
            compile: function(elem, attr, transclude) {
                return {
                    post: angular.noop,
                    pre: function postLink(scope,elem,attr) {
                        scope.root.mainViews.push(elem);
                    }
                }
            }
        }
    }])
    .directive("modal", ["CompService", "$compile", '$timeout', function(CompService, $compile, $timeout) {
        return {
            restrict: 'E',
            priority: 100000,
            scope: false,
            replace:true,
            compile: function(elem, attr) {
                CompService.renderAllStyleAttributes(elem, attr);

                elem[0].style.zIndex = -100;
                elem[0].style.opacity = 0;
                elem[0].style.position = 'fixed';
                CompService.initializeModalAttr(elem, attr, _window);
                var children = elem[0].innerHTML
                if (attr.scaleTo && attr.scaleTo.length) {
                    var elemToScale = document.querySelector(attr.scaleTo);
                    if (elemToScale) {
                        var elemRect = elemToScale.getBoundingClientRect();
                        console.log(elemRect)
                        for (key in elemRect) {
                            elem.css(key, elemRect[key] + 'px');
                        }
                    }

                }


                return {
                    pre: function preLink(scope, p_elem, p_attr) {

                        var _window = scope.root.window;
                        var windowWidth = scope.root.window.width;

                        // $compile(p_elem)(scope)


                        $timeout(function() {
                            if (scope.root.mainViews && scope.root.mainViews.length) {
                                scope.root.mainViews.forEach(function(parent, i) {

                                    // p_elem.append(clone);
                                    parent.parent().append(p_elem);
                                    // $compile(p_elem.contents)(scope)
                                    p_elem.addClass('full-xy absolute')
                                    if (attr.scaleTo && attr.scaleTo.length) {
                                        var elemToScale = document.querySelector(attr.scaleTo);
                                        if (elemToScale) {
                                            var elemRect = elemToScale.getBoundingClientRect();
                                            var ratioWidth;
                                            var ratioHeight;
                                            for (key in elemRect) {
                                                if (key === 'width') {
                                                    ratioWidth = _window.width/elemRect[key];
                                                    console.log(key, 'width:' +  _window.width, 'ratio:' + ratioWidth, 'inverse:' + 1/ratioWidth, p_elem)

                                                }
                                                else if (key === 'height') {
                                                    ratioHeight = _window.height/elemRect[key];
                                                    console.log(key, 'width:' +  _window.height, 'ratio:' + ratioHeight, 'inverse:' + 1/ratioHeight, p_elem)
                                                }

                                            }
                                            if (ratioHeight && ratioWidth) {
                                                elem.css('transform', 'scaleX(' + 1/ratioWidth +  ') scaleY(' +  1/ratioHeight  + ')' )
                                            }
                                        }

                                    }

                                    // p_elem.attr('u', '')
                                    // $compile(p_elem)(scope.$parent)
                                    // if (parent[0].contains(p_elem[0])) {
                                    //     transclude(scope, function(clone, innerScope) {

                                    //         p_elem.append(clone);

                                    //         parent.parent().append(p_elem);

                                    //         p_elem.attr('u', '')

                                    //         $compile(p_elem)(scope.$parent)
                                    //         p_elem[0].className = '';
                                    //         attr.bg && p_elem[0].classList.add('bg-' + attr.bg)

                                    //     })
                                    // }
                                })
                            }
                        })

                    }
                }
            }
        }
    }])
    .directive("replaceMe", ['$compile', function($compile) {
        return {
            restrict: 'A',
            priority: 100000,
            replace:true,
            transclude: 'element',
            templateUrl: 'shared/templates/debug.tpl',
            controller: ["$element", "$transclude", function($element, $transclude) {
                // console.log($element)
                // $element.append($transclude());
            }],
            link: function(scope, elem, attr, ctrl, transclude) {
                var e = (transclude(scope, function(clone, _scope) {
                    elem.append(clone)
                }))
            }
        }
    }])

    .directive('logic', ['$compile', function($compile) {
        return {
            restrict: 'E',
            transclude: 'element',
            template: '<!-- -->',
            controller: ["$scope", "$transclude", "$element", function($scope, $transclude, $element) {
                $element.parent().replaceWith($element);
                // console.log()

                // var afterTemplReplace = $transclude(function(elem, scope) {
                //     originElem = $compile(elem)(scope);
                // })
                // console.log(originElem[0], afterTemplReplace)
                // $element.append(afterTemplReplace);
                console.log($element, $transclude())
            }],
            compile: function(element, attr){

                return function preLink(scope, elem, attr, ctrl, transclude) {
                    e = transclude(function(inner_elem, inner_scope) {
                        console.log(inner_elem[0])
                    })
                    console.log(elem)
                }


            }
        }
    }])
    .directive('mainView', ['$compile', function($compile) {
        return {
            template: '<ui-view height="100" width="100"></ui-view>',
            priority: 1000000
        }
    }])
    .directive("bindings", [function() {
        return {
            restrict: 'E',
            transclude: true,
            controllerAs: 'view',
            template: '<ng-transclude></ng-transclude>',
            link: function(scope, elem, attr, ctrl, transclude) {
                var queue  = [];
                var children = transclude(scope);
                for (var i = 0; i < children.length; i++) {

                    // console.log(children[i])
                    // if (children[i].innerHTML) {
                    //     console.log(children[i])
                    // }
                }

            }
        }
    }])
    .directive("hidden", [function() {
        return {
            restrict: 'E',
            transclude: true,
            terminal:true,
            replace:true,
            controller: ["$scope", "$element", "$attrs", function($scope, $element, $attrs) {
            }],
            link: function(scope, elem, attr, ctrl, transclude) {
                var queue  = [];
                var children = transclude(scope);
                // elem.after(children);
            }
        }
    }])
    .directive("importDict", ['$parse', '$timeout', 'XHRService', function($parse, $timeout, XHRService) {
        return {
            restrict: 'E',
            require: "?view",
            transclude: 'element',
            link: function(scope, element, attr, ctrl, tr) {
                if (attr.url && attr.url.length) {
                    XHRService.getJSONFile('GET', attr.url, function(data) {
                        scope.view.data = data;
                    })
                } else {
                    var innerDict = tr()[0].innerHTML;
                    var dict = $parse(innerDict)(scope);
                    scope.view.data = dict;
                }

                // scope.$watch('view.data' , function(value) {



                //     for (key in dict) {
                //         value[key] = dict;
                //     }
                // })
            }
        }
    }])
    .directive("importFont", ['$timeout', function($timeout) {
        return {
            restrict: 'E',
            require: '?view',
            replace:false,
            template: function(element, attr) {
                if (attr.fF && attr.url && attr.ext) {
                    var font = {};
                    font.family = attr.fF;
                    font.url = 'https://' + attr.url;
                    var extSplit = attr.ext.split(',');
                    extSplit.forEach(function(ext, i) {
                        var formatSplit = ext.split('|');
                        var format;
                        if (formatSplit.length >1) {
                            format = formatSplit[1];
                        } else {
                            format = ext
                        }

                        extSplit[i] = {
                            url:[font.url,ext].join("."),
                            format:format
                        }
                    });
                    font.ext = extSplit;
                    var links = [createLinkElement([font.url,'?family=',font.family].join(""), 'stylesheet', 'text/css'), createFontStyleElement(font)]
                    var header =  document.head || document.getElementsByTagName('head')[0];
                    // links.forEach(function(link, i) {
                    //     if (link.styleSheet) {
                    //         style.styleSheet.cssText = link.innerHTML
                    //     }
                    //     header.appendChild(link);
                    // })
                    function createLinkElement(href, rel, type) {
                        var linkE = document.createElement('link');
                        linkE.setAttribute('href', href)
                        linkE.setAttribute('rel', rel)
                        linkE.setAttribute('type', type)
                        return linkE
                    }
                    function createFontStyleElement(font_str) {
                        var importUrl = ['\@import url(', font.url, '?family=', font.family, ');'].join("")
                        var fontFaceCSS = ['{\@font-face \{font-family: "', font.family, '";\n', "\}\}"].join("");
                        font.ext.forEach(function(ext_dict, i) {
                            fontFaceCSS += ['src: url("', ext_dict.url, '") format("', ext_dict.format, '");'].join("") + "\n";
                        })

                        var linkE = document.createElement('style');
                        linkE.appendChild(document.createTextNode(font_str))
                        return linkE
                    }
                    var fontStr = "<style> @font-face { font-family: 'Cervo Medium'; src: url('https://s3-us-west-1.amazonaws.com/ui-guru/fonts/Cervo-W01-Medium.woff2') format('woff2'), url('https://s3-us-west-1.amazonaws.com/ui-guru/fonts/Cervo-W01-Medium.woff') format('woff'), url('https://s3-us-west-1.amazonaws.com/ui-guru/fonts/Cervo-W01-Medium.woff') format('truetype'); }main{font-family:'Cervo Medium';}"
                    var link =  createFontStyleElement(fontStr);
                    header.appendChild(link);
                    return "<style> @font-face { font-family: 'Cervo Medium'; src: url('https://s3-us-west-1.amazonaws.com/ui-guru/fonts/Cervo-W01-Medium.woff2') format('woff2'), url('https://s3-us-west-1.amazonaws.com/ui-guru/fonts/Cervo-W01-Medium.woff') format('woff'), url('https://s3-us-west-1.amazonaws.com/ui-guru/fonts/Cervo-W01-Medium.woff') format('truetype'); }main{font-family:'Cervo Medium';}"
                }
                return null
            }
        }
    }])
    .directive("view", ["CompService", "$compile", "$rootScope", "$parse", "DataService", "ViewService", function(CompService, $compile, $rootScope, $parse, DataService, ViewService) {
        return {
            restrict: 'E',
            // templateUrl: 'shared/templates/view.tpl',
            template: "<div width='100%' height='100%' abs top='0' left='0' class='view'> <div ng-transclude='imports'> </div> <div ng-transclude='debug'></div> <div ng-transclude='loader'></div> <div size='100%' ng-transclude ng-transclude-slot='main'></div> <!-- <div ng-transclude='main'></div> --> <!-- <ui-view size='100%' x='center' ng-transclude ng-transclude-slot='main'></ui-view> --> <div ng-transclude='hidden'></div> <div>",
            transclude: {
                imports: '?imports',
                loader: '?loader',
                main: '?main',
                hidden: "?hidden",
                debug: "?debug"
            },
            replace:true,
            controllerAs: 'view',
            compile: function(elem, attr, transclude) {
                // console.log(elem[0].innerHTML)
                // elem.css('display', 'none')
                return {
                    pre: function preLink(scope, elem, attr, ctrl, transclude) {
                        // scope.$watch( 'view.data.tabs', function(value) {
                        //     console.log(value)
                        // })
                        // var e = (transclude(scope, function(clone, _scope) {}));

                        // CompService.renderAllStyleAttributes(elem, attr);
                        // console.log(transclude())
                        // transclude(function(inner_elems, inner_scope) {
                        //     console.log(elem)
                        // })
                        // console.log('it gets here')
                        // console.log(elem)

                        // elem.append(e)
                    },
                    post: function postLink(post_scope, post_elem, post_attr) {
                        // console.log(post_elem[0])
                    }
                }
            },
            controller: ["$element", "$attrs", "$scope", "$transclude", function($element, $attrs, $scope, $transclude) {
                var view = this;
                view.logic = {}
                view.loader = {}
                view.content = {}
                view.components = {rendered:false};
                view.inner = {elems: {pre: {}, post:{}}, loader: {}};
                view.inner.elems.post = $transclude($scope, function(transElem, transScope) {


                    view.inner.elems.pre = transElem;
                    view.inner.scope = transScope;
                });
                var numChildren = view.inner.elems.post.length;
                for (var i = 0; i < numChildren; i++) {
                    var child = view.inner.elems.post[i];
                    if (child && child.outerHTML && child.nodeName) {

                        if (child.nodeName.toLowerCase() === 'components') {

                            DataService.initComponent(child);
                        }
                    }
                }
                // console.log('components are rendered')
                view.components.rendered = true;




                var hasLoader = CompService.doesElemHaveLoader(view.inner.elems);
                view.inner.loader = hasLoader.loader;

              //   // console.log(preTranscludeElems.remaining.forEach(function( item, i) {
              //   //   if ('innerHTML' in item) {
              //   //     item.style.opacity = 0;
              //   //   }
              //   // }))

              // }
              //   // $element.append($transclude($scope));
              //   console.log($transclude(function(elem, scope) {
              //       console.log(elem)
              //   }))
            }]
        }
    }])
    .directive("grid", ["CompService", "$compile", function(CompService, $compile) {
        return {
            restrict: 'E',
            replace:true,
            transclude:true,
            priority: 100,
            template: CompService.getCompTemplateType('grid'),
            compile: function(element, attr, transclude) {

                var dimArr = CompService.getAndParseDimensions(attr.d);
                return {
                    pre: function preLink(lScope, lElem, lAttr, transcludeFn) {

                            transclude(lScope, function(clone, innerScope) {
                                var childArr = [];
                                for (var i = 0; i < clone.length; i++) {
                                    if (clone[i].nodeType === 1) {
                                        childArr.push(clone[i]);
                                        console.log(clone[i])
                                    }
                                }
                                for (var i = 0; i < dimArr.length; i++) {
                                    var iChild = childArr[i % childArr.length];
                                    iChild.style.width= dimArr[childArr.length].width + '%';
                                    iChild.style.height = dimArr[childArr.length].height + '%';
                                    var cloneNode = iChild.cloneNode(true);
                                    $compile(cloneNode)(innerScope);
                                    lElem.append(cloneNode)

                                    $compile(lScope)(lElem)

                                }
                                console.log('grid has transcluded')
                            })
                            console.log('grid has compiled')

                    }

                }
            }
        }
    }])
    .directive("svgTable", [function() {
        return {
            templateUrl: 'shared/templates/components/base/grid/svg.table.tpl',
            scope: {},
            restrict: 'E',
            replace: true,
            transclude: true,
            priority:2,
            link: {
                pre: function(scope, element, attr) {
                    scope.vb = {};
                    var parentDim = element.parent()[0].getBoundingClientRect();

                    if (parentDim.width > parentDim.height) {
                        scope.vb.height = Math.round(((parentDim.height/parentDim.width)*100), 2)
                        scope.vb.width = 100;
                        console.log(scope.vb)
                    } else {
                        scope.vb.height = 100;
                        scope.vb.width = Math.round(((parentDim.width/parentDim.height)*100), 2)
                    }
                    element[0].setAttribute('viewBox', '0 0 ' + scope.vb.width + ' ' + scope.vb.height);
                    scope.rows = parseInt(attr.rows);
                }
            }
        }
    }])
    .directive('svgTableItem', ['$compile', function ($compile) {
        return {
        restrict: 'AE',
        scope: {rows:'=rows'},
        template: '<rect rows=rows columns=columns ng-transclude></rect>',
        replace: true,
        transclude: true,
        priority:0,
        compile: function(element, attr) {
            return function preLink(scope, element, attr) {

                var dim = element.parent()[0].getAttribute('dim');
                var columns = parseInt(dim.split('x')[0])
                var rows = parseInt(dim.split('x')[1])
                var parent = element[0].parentNode;
                var index = Array.prototype.indexOf.call(parent.children, element[0]);
                //column
                var rowIndex = parseInt(index/rows) % rows;

                var columnIndex = index % columns;
                element[0].setAttribute('width', 100/rows + '%');
                element[0].setAttribute('x', rowIndex * (100/rows) + '%');
                element[0].setAttribute('y', columnIndex * (100/columns) + '%');
                element[0].setAttribute('height', 100/columns + '%');
            }
        }
      };
    }])
    .directive("bar", ["RootService", "$timeout", function(RootService, $timeout) {
        return {
            templateUrl: RootService.getBaseUrl() + 'shared/templates/components/base/grid/bar.tpl',
            restrict: 'E',
            scope: {
                overflowX:'=',
                options: '=ngModel',
                title: '=title',
                key: '=key',
            },
            link: {
                pre: function(scope, element, attr) {
                }
            }
        }
    }])
    .directive("uBody", ["RootService", function(RootService) {
        return {
            templateUrl: RootService.getBaseUrl() + 'shared/templates/components/base/body.tpl',
            restrict: 'E',
            link: {
                pre: function(scope, element, attr) {
                    return
                }
            }
        }
    }])
    .directive("uBody", ["RootService", function(RootService) {
        return {
            templateUrl: RootService.getBaseUrl() + 'shared/templates/components/base/body.tpl',
            restrict: 'E',
            link: {
                pre: function(scope, element, attr) {
                    return
                }
            }
        }
    }])
    .directive("uCheckbox", ["RootService", function(RootService) {
        return {
            templateUrl: RootService.getBaseUrl() + 'shared/templates/components/base/checkbox.tpl',
            restrict: 'E',
            link: {
                pre: function(scope, element, attr) {
                    return
                }
            }
        }
    }])
    .directive("uDropdown", ["RootService", function(RootService) {
        return {
            templateUrl: RootService.getBaseUrl() + 'shared/templates/components/base/dropdown.tpl',
            restrict: 'E',
            link: {
                pre: function(scope, element, attr) {
                    return
                }
            }
        }
    }])
    .directive("uHeader", ["RootService", function(RootService) {
        return {
            templateUrl: RootService.getBaseUrl() + 'shared/templates/components/base/header.tpl',
            restrict: 'E',
            link: {
                pre: function(scope, element, attr) {
                    return
                }
            }
        }
    }])

    .directive("uRadio", ["RootService", function(RootService) {
        return {
            templateUrl: RootService.getBaseUrl() + 'shared/templates/components/base/radio.tpl',
            restrict: 'E',
            link: {
                pre: function(scope, element, attr) {
                    return
                }
            }
        }
    }])
    .directive("uToggle", ["RootService", function(RootService) {
        return {
            templateUrl: RootService.getBaseUrl() + 'shared/templates/components/base/toggle.tpl',
            restrict: 'E',
            link: {
                pre: function(scope, element, attr) {
                    return
                }
            }
        }
    }])
    .directive("uTooltip", ["RootService", function(RootService) {
        return {
            templateUrl: RootService.getBaseUrl() + 'shared/templates/components/base/tooltip.tpl',
            restrict: 'E',
            link: {
                pre: function(scope, element, attr) {
                    return
                }
            }
        }
    }])
    .directive('x', ['CompService', function(CompService) {
      return {
        restrict: 'A',
        compile: function(element, attr) {
            if (element[0].nodeName.toLowerCase() === 'SVG' || element[0].ownerSVGElement) return;
            var mappings = {
                'center': 'center',
                'end': 'flex-end',
                'space-between': 'space-between',
                'sb': 'space-between',
                'sa': 'space-around',
                'space-around': 'space-around',
                'top': 'flex-start'
            }
            var value = (attr.x && attr.x.length && attr.x in mappings && mappings[attr.x]) || 'center'
          element.css('justify-content', value);
          element.css('align-items', value);
        }
      }
    }])
    .directive('y', ['CompService', function(CompService) {
      return {
        restrict: 'A',
        compile: function(element, attr) {
            if (element[0].nodeName.toLowerCase() === 'SVG' || element[0].ownerSVGElement) return;
            var mappings = {
                'center': 'center',
                'end': 'flex-end',
                'space-between': 'space-between',
                'sb': 'space-between',
                'sa': 'space-around',
                'space-around': 'space-around',
                'top': 'flex-start'
            }
            var value = (attr.y && attr.y.length && attr.y in mappings && mappings[attr.y]) || 'center'
          element.css('align-content', value);
          if (['space-between', 'space-around'].indexOf(value) === -1) {
            element.css('align-items', value);
          }
        }
      }
    }])
    // .directive('end', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-self', 'flex-end');
    //     }
    //   }
    // }])
    // .directive('start', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-self', 'flex-start');
    //     }
    //   }
    // }])
    // .directive('left', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-self', 'flex-start');
    //     }
    //   }
    // }])
    // .directive('right', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-self', 'flex-end');
    //     }
    //   }
    // }])
    // .directive('center', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-self', 'center');
    //     }
    //   }
    // }])
    // .directive('stretch', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-self', 'stretch');
    //     }
    //   }
    // }])
    // .directive('spaceBetween', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-self', 'space-between');
    //     }
    //   }
    // }])
    // .directive('spaceAround', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-self', 'space-around');
    //     }
    //   }
    // }])
    // .directive('xEnd', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('justify-content', 'flex-end');
    //     }
    //   }
    // }])

    // .directive('sA', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('justify-content', 'space-around');
    //     }
    //   }
    // }])
    // .directive('sB', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('justify-content', 'space-between');
    //     }
    //   }
    // }])
    // .directive('yEnd', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-content', 'flex-end');
    //       element.css('align-items', 'flex-end');
    //     }
    //   }
    // }])
    // .directive('yStretch', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-content', 'stretch');
    //       element.css('align-items', 'stretch');
    //     }
    //   }
    // }])
    // .directive('yStart', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-content', 'flex-start');
    //       element.css('align-items', 'flex-start');
    //     }
    //   }
    // }])
    // .directive('yCenter', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-content', 'center');
    //       element.css('align-items', 'center');
    //     }
    //   }
    // }])
    // .directive('xEnd', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('justify-content', 'flex-end');
    //     }
    //   }
    // }])
    // .directive('ySpaceBetween', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-content', 'space-between');
    //     }
    //   }
    // }])
    // .directive('ySpaceAround', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-content', 'space-around');
    //     }
    //   }
    // }])
    // .directive('ySa', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('align-content', 'space-around');
    //     }
    //   }
    // }])
    // .directive('ySb', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('justify-content', 'space-between');
    //     }
    //   }
    // }])
    //  .directive('row', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('flex-direction', 'row');
    //     }
    //   }
    // }])
    // .directive('rowReverse', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('flex-direction', 'row-reverse');
    //     }
    //   }
    // }])
    // .directive('column', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('flex-direction', 'column');
    //     }
    //   }
    // }])
    // .directive('columnReverse', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('flex-direction', 'row-reverse');
    //     }
    //   }
    // }])
    // .directive('wrap', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('flex-wrap', 'wrap');
    //     }
    //   }
    // }])
    // .directive('nowrap', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('flex-wrap', 'nowrap');
    //     }
    //   }
    // }])
    //  .directive('wrapReverse', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('flex-wrap', 'wrap-reverse');
    //     }
    //   }
    // }])
    //  .directive('order', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('order', parseInt(attr.order));
    //     }
    //   }
    // }])
    //  .directive('grow', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('flex-grow', parseInt(attr.grow));
    //     }
    //   }
    // }])
    // .directive('shrink', [function() {
    //   return {
    //     restrict: 'A',
    //     compile: function(element, attr) {
    //       element.css('flex-shrink', parseInt(attr.shrink));
    //     }
    //   }
    // }])
    // .directive('uList', ['$compile', function($compile) {
    //     return {
    //         restrict: 'A',
    //         priority: 100000,
    //         transclude:true,
    //         compile: function(element, attr) {

    //             if (!attr.uList || !attr.uList.length) return;

    //             var listParams = attr.uList + ' track by $index';
    //             if (listParams.indexOf('in') === -1 && listParams.charAt(0) === '[' && listParams.charAt(listParams.length - 1) === ']') {
    //                 var e = angular.element(element[0].outerHTML)
    //                 listParams = 'item in ' + listParams;

    //                 e[0].setAttribute('ng-repeat', listParams);

    //                 element.replaceWith(e);
    //             } else {
    //                 element[0].setAttribute('ng-repeat', listParams);
    //             }
    //             element.removeAttr('uList');
    //             return function preLink(scope, p_element, p_attrs, ctrl, transclude) {
    //                 transclude(function(transEl, transScope) {
    //                     console.log(transEl[0])
    //                 })

    //             }
    //         }
    //     }
    // }])
    .directive('uList', ['$compile', '$rootScope', 'DataService', function($compile, $rootScope, DataService) {
        return {
            restrict: 'A',
            priority: 100000000,
            replace:true,
            template: function(element, attr) {
                element[0].removeAttribute('u-list');
                var uListAttr = attr.uList.replace('in ', 'in ');

                element[0].setAttribute('ng-repeat', DataService.applyListParams(uListAttr));

                return element[0].outerHTML;
            }

        }
    }])
    .directive('initIf', ['$compile', 'DataService', function($compile, DataService) {
        return {
            restrict: 'A',
            transclude:'element',
            replace:true,
            scope:false,
            priority: 10000,
            controller: ["$scope", "$element", "$transclude", "$attrs", function($scope, $element, $transclude, $attrs) {
                var transEl;
                $transclude($scope, function(transEl, scope) {
                    transEl = transEl;
                });
                $scope.$watch($attrs.initIf, function(value) {
                    console.log(value)
                    if (value) {
                        $element.append(transEl);
                    }
                });
            }]

        }
    }])
    // .directive('uList', ['$rootScope', '$compile', '$parse', function($rootScope, $compile, $parse) {
    //   return {
    //     transclude: 'element',
    //     restrict: 'A',
    //     replace:true,
    //     link: function(scope, el, attrs, ctrl, transclude) {

    //         var attrSplit = attrs.uList.split('in');
    //         var varName;
    //         attrSplit.forEach(function(str, i) {attrSplit[i] = attrSplit[i].trim()});
    //         if (attrSplit.length === 2) {
    //             varName = attrSplit[0];
    //         }
    //         if (attrSplit.length < 2 || !varName.length) {
    //             varName = 'item';
    //         }
    //         var coll = scope.$eval(attrSplit[1]);

    //       if ('start' in attrs && 'end' in attrs) {
    //         coll = coll.slice(parseInt(attrs.start), parseInt(attrs.end))
    //       }
    //       console.log(coll)
    //       if (!coll) {
    //         console.log(scope.data)
    //         scope.$watch(attrSplit[1], function(value) {
    //             console.log(value)
    //         })
    //       } else {
    //                 var children = [];

    //                 coll.forEach(function(each, i) {
    //                     transclude(function(transEl, transScope) {
    //                     transScope[varName] = each;
    //                     transScope['index'] = i + 1;
    //                     transEl[0].removeAttribute('u-list');

    //                     // for (attr in attrs) {
    //                     //     if (attr.charAt(0) === 'u') {
    //                     //         var varName = attr.substring(1, attr.length)
    //                     //         varName = varName[0].toLowerCase() + varName.substring(1, varName.length)
    //                     //         console.log('setting', varName, $parse(attrs[attr])($parse))
    //                     //         transScope[varName] = scope.$eval(attrs[attr])
    //                     //     }


    //                     // }

    //                   // for (attr in el.attributes) {

    //                   // }
    //                     $compile(transEl)(transScope)
    //                     el.parent().append(transEl)

    //                     });
    //                  });
    //                 el.replaceWith(el.contents())
    //       }


    //     }
    //   };
    // }])

    .directive('htmlSnippet', ['$compile',function($compile) {
        return {
            restrict: 'E',
            scope: {html: '=html'},
            replace: true,
            link: function(scope, element, attr, ctrl, transclude) {


                var language = attr.language || 'markup';

                var elem = Prism.highlight(scope.html, Prism.languages[language]);
                var codeElem = angular.element('<pre class="formatted language-' + language + '"></pre>');
                codeElem.append(angular.element(elem));
                element.replaceWith(codeElem);

                // element.contents()
                // var html =
            }
        }
    }])
    .directive('htmlRender', ['$compile',function($compile) {
      return {
        restrict: 'E',
        scope: {html: '=html'},
        transclude: true,
        replace:false,
        compile: function(element, attr, transclude) {

            return {
                pre: function preLink(scope, pre_elem, pre_attr) {
                    if (!scope.html || !scope.html.length || scope.html.indexOf('>') === -1) return;
                    var e = $compile(scope.html)(scope)

                    pre_elem.replaceWith(angular.element(e));
                    pre_attr.compile && transclude(scope, function(clone, innerScope) {

                    })
                }
            }
        }

      }
    }]).config(["$controllerProvider", "$provide", "$compileProvider", function($controllerProvider, $provide, $compileProvider) {
        baseCompModule.directive = function(name, factory) {
            $compileProvider.directive(name, factory);
            return (this);
        }
    }]);

    var propDirectives = [
        'width',
        'height',
        'fontSize',
        'm',
        'mX',
        'mY',
        'mTop',
        'marginTop',
        'marginBot',
        'marginBottom',
        'marginLeft',
        'marginRight',
        'mBot',
        'mBottom',
        'mLeft',
        'mRight',
        "marginX",
        "marginY",
        "p",
        "padding",
        "margin",
        "pX",
        "pY",
        "pTop",
        "pBottom",
        "pLeft",
        "pRight",
        "paddingX",
        "paddingY",
        "paddingBottom",
        "paddingBot",
        "pBot",
        "paddingTop",
        "paddingLeft",
        "paddingRight",
        "basis",
        "shrink",
        "grow",
        "order",
        "wrapReverse",
        "wrap",
        "nowrap",
        "end",
        "start",
        "left",
        "right",
        "center",
        "stretch",
        "spaceBetween",
        "spaceAround",
        "sA",
        "sB",
        "xEnd",
        "yEnd",
        "yStretch",
        "yStart",
        "yCenter",
        "xEnd",
        "ySpaceBetween",
        "ySpaceAround",
        "ySa",
        "ySb",
        "row",
        "rowReverse",
        "rR",
        "column",
        "columnReverse",
        "cR",
        "x",
        "y",
        "xCenter",
        "top",
        "left",
        "right",
        "bottom",
        "t",
        "l",
        "r",
        "b",
        "bot",
        "rad",
        "radius",
        "zIndex",
        "maxHeight",
        "minHeight",
        "minWidth",
        "maxWidth",
        "w",
        "h",
        "fS",
        "flex",
        "rel",
        "relative",
        "abs",
        "absolute",
        "border",
        "z",
        "bWidth",
        "borderWidth",
        "bW",
        "bS",
        "borderStyle",
        "borderColor",
        "bC",
        "bR",
        "static",
        "fixed",
        "fix",
        "op",
        "overflow",
        "oFlow",
        "scrollX",
        "scrollY",
        "scrollXY",
        "scrollable",
        "noScroll",
        "hideX",
        "hideY",
        "scroll",
        "fW",
        "fontWeight",
        "lineHeight",
        "lH",
        "lS",
        "letterSpacing",
        "pointer",
        "point",
        "content",
        "inherit"
        ]

    var modulePointer = angular.module('uguru.shared.directives.base.components');

    if (_browser.size.tablet) {
        renderPropDirectives(propDirectives, 't');
    }
    if (_browser.size.mobile) {
        renderPropDirectives(propDirectives, 'm');
    }
    if (_browser.size.orientation === 'landscape') {
        renderPropDirectives(propDirectives, 'l');
    }
    if (_browser.size.orientation === 'portrait') {
        renderPropDirectives(propDirectives, 'p');
    }
    renderPropDirectives(propDirectives);

    function camelCase(input) {
        return input.toLowerCase().replace(/-(.)/g, function(match, group1) {
          return group1.toUpperCase();
        });
      }

    function renderPropDirectives(props, prefix) {

        props.forEach(function(prop) {
            // console.log(prop)
            var propName = prop;
            if (prefix) {

                propName = camelCase((prefix + '-' + prop.replace(/\W+/g, '-')
                .replace(/([a-z\d])([A-Z])/g, '$1-$2').toLowerCase()).toLowerCase());

            }


        var propNameRender = prop
            modulePointer.directive(propName, ['CompService', function(CompService) {
              return {
                restrict: 'A',
                templateNamespace: 'html',
                priority: 100000,
                compile: function(element, attr) {
                    var ignoreCompile = false;
                    var unPrefix = false;
                    var prefixedProp = '';
                    // if (propName.toLowerCase().indexOf('width') > -1) {
                        ['t', 'm', 'l', 'p'].forEach(function(p) {
                            prefixedProp = p + propName.charAt(0).toUpperCase() + propName.substring(1);
                            if (prefixedProp in attr && _browser.size.mobile) {
                                if (propName !== prefixedProp) {

                                    ignoreCompile=true;
                                } else {

                                    unPrefix = true;
                                }
                            }
                        })

                    if (propName === 'mWidth' && 'width' in attr) {
                        if (_browser.size.mobile) {
                            element.css('width', attr.mWidth);
                            return;
                        } else  if (_browser.size.desktop){
                            return;
                        }
                    }

                    if (propName === 'mHeight' && 'height' in attr) {
                        if (_browser.size.mobile) {
                            element.css('height', attr.mHeight);
                            return;
                        } else  if (_browser.size.desktop){
                            return;
                        }
                    }

                    if (!(propNameRender in CompService.css.render)) {
                        propNameRender = 'general'
                    }

                    var options = {
                        propName: propName
                        // scope: scope
                    }
                    if (ignoreCompile && _browser.size.desktop) return;
                    if (element[0] && element[0].nodeType === 1) {

                        // if (propName === 'mWidth') {
                        //     console.log('yo', propNameRender, propName)
                        // }
                        CompService.css.render[propNameRender](element, attr[propName], options);

                    }




                    // if (propName && prefix && propName.indexOf('width') > -1) {


                    // }



                }
                // link: function(scope, element, attr) {


                // }
              }
            }])
        })
    }

angular.module('uguru.shared.services')
.factory("TweenService", [
    TweenService
]);

function TweenService() {
    var specialPropertyTypes = ['background-color', 'background', 'fill', 'color', 'stroke', 'border-color', 'border']
    return  {
        getKeyframeValues: getKeyframeValues,
        getAllEasing: getAllEasing,
        getAllAnimatable: getAllAnimatable,
        getCubicBezierArrs: getAllAnimatable,
        preComputeValues: preComputeValues,
        getKeyframeValuesByProperty: getKeyframeValuesByProperty,
        animatableProps: animatableProps

    }

    function getAllEasing() {
        return easings

        // "easeInElastic", // easings.net or https://github.com/ai/easings.net/blob/master/vendor/jquery.easing.js
        // "easeOutElastic",
        // "easeInOutElastic",
        // "easeInBounce",
        // "easeOutBounce",
        // "easeInOutBounce",


        // "sway", // http://goo.gl/n3DjKQ
        // "hardSway", // http://goo.gl/xX8hna

        // deprecated
    }

    function getCubicBezierArrs() {
        return {
            "nameOfCB": [1,1,1,1]
        }
    }

    function getArrayOfDecimals(value) {
          var r = /[\d*\.?\d-*]+/g;
          var m;
          var resultArr = [];
          while ((m = r.exec(value)) != null) {
            resultArr.push(m[0]);
          }
          return resultArr
    }

    function getAllAnimatable() {
        return animatableProps;
    }

    function getCustomEasingFunction() {
        return {
            t: 'now',
            b: 'start' || 0,
            c: 'end' || 1,
            d: 'duration' || 1000
        }
    }

    function parseSpecialPropertyType(property, value) {
        return 'rgba(' + value.split('|').join(',') + ')'
    }

    function preComputeValues(property, duration, start, end, ease, result_arr) {
        // console.log(property, ease)
        duration = parseFloat(duration)
        result_arr.cache = [];

        property = property.trim();


        var startDict = {};
        startDict[property] = start;
        var endDict = {};
        endDict[property] = end;


        var t = new Tweenable();
        if (specialPropertyTypes.indexOf(property) > -1) {
            start = parseSpecialPropertyType(property, start);
            end = parseSpecialPropertyType(property, end);
        }
        if (ease.indexOf('|') > -1) {
            var easeSplit = ease.split('|');
            if (ease && ease.length && easeSplit.length === 4) {
                easeSplit.forEach(function(val, i) {easeSplit[i] = parseFloat(val)});
                Tweenable.setBezierFunction('cb-function', easeSplit[0], easeSplit[1], easeSplit[2], easeSplit[3]);
                ease = 'cb-function'
            }
        }
        if (ease.indexOf(',') > -1) {
            ease = ease.replace('(', '').replace(')', '');
            var easeSplit = ease.split(',');
            if (ease && ease.length && easeSplit.length === 4) {
                easeSplit.forEach(function(val, i) {easeSplit[i] = parseFloat(val)});
                Tweenable.setBezierFunction('cb-function', easeSplit[0], easeSplit[1], easeSplit[2], easeSplit[3]);
                ease = 'cb-function'
            }
        }

        if (typeof(start) !== 'object') {
            var tempStart = start;
            var start = {};
            start[property] = tempStart
        }
        if (typeof(end) !== 'object') {
            var tempEnd = end;
            var end = {};
            end[property] = tempEnd
        }

        var iterations = (duration/1000 * 60);//fps

        t.tween({
          from: start,
          to:   end,
          duration: duration,
          easing: ease
        }).seek(0).pause()
        var appendLastValueAtEnd = false;
        if (t.get()[property] !== start[property]) {
            appendLastValueAtEnd = true;

            var newDuration = iterations/62 * 1000;
            result_arr.cache.push(start[property]);
            t.tween({
              from: start,
              to:   end,
              duration: newDuration,
              easing: ease
            }).seek(0).pause();
            iterations = iterations - 2;
        }


        for (var i = 0; i < iterations; i++) {
            var seekValue = duration/iterations * i;
            var value = t.seek(seekValue).resume().pause().get()[property]
            result_arr.cache.push(round(value, 15));
        }
        t.stop(true);

        result_arr.cache.push(round(t.get()[property], 15));
        if (appendLastValueAtEnd) {
            result_arr.cache.push(end[property])
        }
        // if (result_arr.cache[result_arr.cache.length - 2] !== end[property]) {
        //     console.log(property[end])
        //     result_arr.cache.push(end[property]);
        //     console.log(result_arr.cache)
        // }
        result_arr.cache.push(null)
        t.dispose();
        if (property === 'counter') {
            formatCounterValues(start.counter, end.counter, result_arr.cache);
        }
        // console.log('\n')
        // console.log(ease, '<>', property)
        // console.log('START 3 values: \n' + result_arr.cache.slice(0,3).join(",\n") +'\n' + '\nEND 3 values:\n' + result_arr.cache.slice(result_arr.cache.length - 4,result_arr.cache.length).join(",\n") + '\n')
        return result_arr
        // t.dispose();
    }

    function formatCounterValues(start, end, arr) {
        var num = getArrayOfDecimals(arr[0])[0];
        var nonNumeric = start.split(num).filter(function(val, i) {return val.length});
        var replaceStart;
        if (start.indexOf(nonNumeric[0]) === 0) {
            replaceStart = nonNumeric[0];
        }
        arr.forEach(function(val, i) {
            if (!val) return;
            if (replaceStart) {
                arr[i] = replaceStart + arr[i].replace(replaceStart, '');
            }
        })
    }

    function precision(a) {
      if (!isFinite(a)) return 0;
      var e = 1, p = 0;
      while (Math.round(a * e) / e !== a) { e *= 10; p++; }
      return p;
    }

    function round(value, decimals) {
        if (typeof value !== 'number') return value
        if (precision(value) > 18) {
            return Number(value.toFixed(15));
        }
      return Number(Math.round(value+'e'+decimals)+'e-'+decimals);
    }

    function getKeyframeValuesByProperty(property, start_val, end_val, duration, easeFunc, max_keyframe) {
        if (!easeFunc) {
            easeFunc = 'linear'
        }
        if (!max_keyframe) {
            max_keyframe = 60;
        }
        duration = duration || 1000;
        var vals = {start: {}, end:{}};
        vals.start[property] = start_val;
        vals.end[property] = end_val;
        return getKeyframeValues(vals.start, vals.end, duration, easeFunc, max_keyframe);
    }

    function getKeyframeValues(start_dict, end_dict, duration, easeFunc, kf_arr, max_keyframe) {
        if (property)
        if (!max_keyframe) max_keyframe = 30;
        var tweenable = new Tweenable();
        var kf_arr = kf_arr || [];
        duration = duration || 1000;
        tweenable.tween({
          from: start_dict,
          to:   end_dict,
          duration: duration,
          easing: easeFunc
        }).seek(0)
        var intervals = (duration/1000 * 60)/2;
        var chunkSize = duration/intervals;
        for (var i = 1; i < (intervals + 2); i++) {



            tweenable.seek(i*chunkSize);
            kf_arr.push(tweenable.get());
            tweenable.resume();
            // console.log(tweenable.get());
        }

        // console.log(kf_arr);
        // kf_arr.forEach(function(kf, i) {kf_arr[i].percentage = i * (100/(intervals + 2))})
        // kf_arr.forEach(function(kf, i) {console.log(kf.percentage, kf[Object.keys(start_dict)[0]])})
        kf_arr.forEach(function(kf, i) {kf_arr[i].percentage = i/(kf_arr.length - 1) * 100})


        return kf_arr;

    }

}


var animatableProps =
[
"translateX",
"translateY",
"translateZ",
"scaleX",
"scaleY",
"rotate",
"skewX",
"skewY",
"scaleZ",
"rotateX",
"rotateY",
"rotateZ",
"perspective",
"rotate3d",
"-webkit-text-fill-color",
"-webkit-text-stroke",
"-webkit-text-stroke-color",
"-webkit-touch-callout",
"all",
"appearance",
"backdrop-filter",
"background",
"background-color",
"background-position",
"background-size",
"border",
"border-bottom",
"border-bottom-color",
"border-bottom-left-radius",
"border-bottom-right-radius",
"border-bottom-width",
"border-color",
"border-left",
"border-left-color",
"border-left-width",
"border-radius",
"border-right",
"border-right-color",
"border-right-width",
"border-top",
"border-top-color",
"border-top-left-radius",
"border-top-right-radius",
"border-top-width",
"border-width",
"bottom",
"box-shadow",
"clip",
"clip-path",
"color",
"column-count",
"column-gap",
"column-rule",
"column-rule-color",
"column-rule-width",
"column-width",
"columns",
"contain",
"filter",
"flex",
"flex-basis",
"flex-grow",
"flex-shrink",
"font",
"font-size",
"font-size-adjust",
"font-stretch",
"font-weight",
"grid-column-gap",
"grid-gap",
"grid-row-gap",
"height",
"left",
"letter-spacing",
"line-height",
"margin",
"margin-bottom",
"margin-left",
"margin-right",
"margin-top",
"mask",
"mask-position",
"mask-size",
"max-height",
"max-width",
"min-height",
"min-width",
"motion-offset",
"motion-rotation",
"object-position",
"opacity",
"order",
"outline",
"outline-color",
"outline-offset",
"outline-width",
"padding",
"padding-bottom",
"padding-left",
"padding-right",
"padding-top",
"perspective",
"perspective-origin",
"right",
"scroll-snap-coordinate",
"scroll-snap-destination",
"shape-image-threshold",
"shape-margin",
"shape-outside",
"text-decoration",
"text-decoration-color",
"text-emphasis",
"text-emphasis-color",
"text-indent",
"text-shadow",
"top",
"transform",
"transform-origin",
"vertical-align",
"visibility",
"width",
"word-spacing",
"z-index",
"-moz-outline-radius",
"-moz-outline-radius-bottomleft",
"-moz-outline-radius-bottomright",
"-moz-outline-radius-topleft",
"-moz-outline-radius-topright"]

var easings = ["easeInQuad",
        "linear",
        "easeOutQuad",
        "easeInOutQuad",
        "easeInCubic",
        "easeOutCubic",
        "easeInOutCubic",
        "easeInQuart",
        "easeOutQuart",
        "easeInOutQuart",
        "easeInQuint",
        "easeOutQuint",
        "easeInOutQuint",
        "easeInSine",
        "easeOutSine",
        "easeInOutSine",
        "easeInExpo",
        "easeOutExpo",
        "easeInOutExpo",
        "easeInCirc",
        "easeOutCirc",
        "easeInOutCirc",
        "easeInBack",
        "easeOutBack",
        "easeInOutBack",
        "easeInOutBounce",
        "easeInBounce",
        "easeOutBounce",
        "easeInElastic",
        "easeOutElastic",
        "easeInOutElastic",
        "bouncePast",
        "swingFromTo",
        "swingFrom",
        "swingTo",
        "easeFromTo",
        "easeFrom",
        "easeTo"
        ]

angular.module('uguru.admin')
.filter('selectedTags', function() {
  return function(bugs, tags) {
          return bugs.filter(function(bug) {
              //no filter if tags is empty
              if (tags.length === 0){
                return true;
              }
              for (var i in bug.tags) {
                  if (tags.indexOf(bug.tags[i]) !== -1) {
                      return true;
                  }
              }
              return false;

          });
        };
})
.filter('selectedPlatforms', function() {
  return function(bugs, platforms) {
          return bugs.filter(function(bug) {
              //no filter if tags is empty
              if (platforms.length === 0){
                return true;
              }
              for (var i in bug.platforms) {
                  if (platforms.indexOf(bug.platforms[i].name) !== -1)
                    {
                      return true;
                    }
                  else if (platforms.indexOf(bug.platforms[i].name+'-'+bug.platforms[i].device) !== -1 )
                  {
                    return true;
                  }
              }
              return false;

          });
        };
})
.filter('selectFixed',function(){
    return function(bugs) {
            return bugs.filter(function(bug) {
                //no filter if tags is empty

                if (bug.fix && bug.fix.isFixed){
                  return true;
                }
                // for (var i in bug.platforms) {
                //     if (platforms.indexOf(bug.platforms[i]) !== -1) {
                //         return true;
                //     }
                // }
                return false;

            });
          };
})
.controller('AdminBugsController', [
  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'FileService',
  'LoadingService',
  'ReportService',
  'CTAService',
  '$localstorage',
  '$timeout',
  'SpecContentService',
  '$interval',
  function($scope, $state, $timeout, FileService, LoadingService,ReportService,
            CTAService,$localstorage, $timeou,SpecContentService,$interval) {
    $scope.updateStatus = function(){
      $scope.isSync = false;
      // console.log('CHeck',$scope.isSync);
    };

    $scope.openBugList=function(section){
      $scope.help = section.help;
      $scope.states = section.states;
      $scope.name = section.name;
      $scope.workFlowID = section.workFlowID;
      $scope.currentManualBugs = section.manualBugs;
      // $scope.currentManualBugs = []
      if ($scope.name === ''){
        $scope.addSection = true;
        $scope.newSection ={
          name:'',
          bugs:[],
          help:{}
        };
      }
      else{
        $scope.addSection = false;
      }
    };
    $scope.pushNewSection = function(newSection){
      $scope.bugReport.push(newSection);
      // console.log($scope.bugReport);
      // $scope.addSection = false;
    };
    $scope.removeBug = function(index,scopeList){
      console.log(index);
      scopeList.splice(index,1);
      $scope.saveBug();
      $scope.closeBug();
    };
    $scope.removeSection = function(index){
      console.log(index);
      $scope.bugReport.splice(index,1);
      console.log($scope.bugReport);
    }

    $scope.addBug = function(){
      function checkTitleRepeat(title,bugs){
        for (var i = 0; i< bugs.length; ++i){
            if(bugs[i].title === title) {
              return true;
            }
        }
        return false;
      }

      if (!checkTitleRepeat($scope.selectedBug.title,$scope.bugs)){
        $scope.bugs.push($scope.selectedBug);
        $scope.saveBug();
        $scope.editMode();
        $scope.closeBug();
      }
      else if($scope.selectedBug.title.length < 1)
      {
        window.alert('Where is the title of bug');
      }
      else{
        window.alert('THIS BUG HAS BEEN ALREADY FILED');
      }
    };

 

    $scope.saveBug = function(){
      // console.log($scope.bugReport[0].manualBugs);
      // $scope.bugReport[0].manualBugs = []
      // console.log('CHECK',angular.toJson($scope.bugReport[0]),4);
      // console.log('update')
     var report = {
        'workflows': $scope.bugReport,
        // 'lastUpdate': new Date().getTime()
        'lastUpdate': $scope.lastReportUpdate

      };

      FileService.postS3JsonFile(angular.toJson(report), null ,
                                 'https://s3.amazonaws.com/uguru-admin/sync/bugs.json', postCallback);
      function postCallback(firstName, resp) {
         
          ReportService.saveBug(report);
          console.log('file successfully saved', resp);          
          // LoadingService.hide();
          // $timeout(function() {
          //   LoadingService.showSuccess('Saved!', 1000);
          // });
        }
      $scope.isSync = true;

    };

    $scope.fileManualBug = function(){

        function checkTitleRepeat(title,bugs){
          for (var i = 0; i< bugs.length; ++i){
              if(bugs[i].title === title) {
                return true;
              }
          }
          return false;
        }
        // console.log($scope.selectedBug.title,$scope.currentManualBugs);
        if($scope.currentManualBugs.length < 1){
          $scope.currentManualBugs.push(angular.copy($scope.selectedBug));

          $scope.saveBug();
          // $scope.editMode();
          $scope.closeBug();
          $scope.fileManul = false;
          $scope.isNewBug = false;
          $scope.isEditMode = false;
        }
        else{
          if (!checkTitleRepeat($scope.selectedBug.title, $scope.currentManualBugs)){
            $scope.currentManualBugs.push(angular.copy($scope.selectedBug));
            $scope.saveBug();
            // $scope.editMode();
            $scope.closeBug();
            $scope.fileManul = false;
            $scope.isNewBug = false;
            $scope.isEditMode = false;
          }
          else{
            window.alert('THIS BUG HAS BEEN ALREADY FILED');
          }
        }

        console.log('current',$scope.currentManualBugs);

    };
    $scope.activePlatforms = function(state){
        $scope.currentStatePlatforms = state.platforms;
        console.log($scope.currentStatePlatforms.length)
        var targetElem = document.querySelector('#cta-box-selected-bug');
        var modalElem = document.querySelector('#cta-modal-state-platforms');
        modalElem.classList.add('show');
    };

    $scope.reviseBug = function(){
      $scope.selectedBug = angular.copy($scope.backupBug);
      $scope.editMode();
    };
    $scope.editMode = function(){
      $scope.isEditMode = !$scope.isEditMode;


    };
    $scope.order = function() {
      $scope.reverse = !$scope.reverse;
    };

    $scope.closeBug = function(){
        var element = document.querySelector('#cta-modal-selected-bug');
        var className = element.className.replace('show','');
        element.className = className;
        var target = document.querySelector('#cta-box-selected-bug');
        target.removeAttribute('id');
        console.log(element.className)
        $scope.isEditMode = false;
        $scope.isNewBug = false;

    };

    $scope.nextBug = function(){
      console.log($scope.selectedBug.index);
      var index = $scope.selectedBug.index + 1;
      $scope.selectedBug = $scope.bugs[index];
      $scope.selectedBug.index = index;
      $scope.backupBug = angular.copy($scope.selectedBug);

    };
    $scope.fixBug = function(){
      var d = new Date();
      $scope.selectedBug.fix=
      {
        isFixed : true,
        fixedDate : d.toUTCString(),
        getTime : d.getTime()
      };
    };

    $scope.unfixBug = function(){
      $scope.selectedBug.fix=null;
    };

    $scope.preBug = function(){
      var index = $scope.current.index - 1;
      $scope.selectedBug = $scope.stepBugs[index];
      $scope.current.index = index;
      $scope.backupBug = angular.copy($scope.selectedBug);
    };
    $scope.preStateBug = function(){
      var pIndex = $scope.current.parentIndex - 1;
      var find = false;
      do
      {
        if ($scope.states[pIndex].stepBugs.length > 0)
        {
          find = true;
        }
        else{
          -- pIndex;
        }
        $scope.current.parentIndex = pIndex;

      }while(find !== true &&  $scope.current.parentIndex >= 0);

      $scope.current.parentIndex = pIndex;
      $scope.current.index = $scope.states[$scope.current.parentIndex].stepBugs.length-1;
      $scope.selectedBug = $scope.states[$scope.current.parentIndex].stepBugs[$scope.current.index];
    }
    $scope.isEndOfBug = function(index){
      for (var i = index; i >= 0; -- i){
        if ($scope.states[i].stepBugs.length > 0 ){
          return false;
        }
      }
      return true;
    };


    $scope.initAndLaunchBugCTA = function($event,bug,index,parentIndex){
      var targetElem = $event.target;
      // console.log("CHECK", !parentIndex)
      if(parentIndex < 0){
        $scope.fileManul = true;
      }
      else{
        $scope.fileManul = false;
      }
      $scope.isNewBug = false;
      $scope.isEditMode = false;

      if (bug){
        $scope.selectedBug = bug;
        $scope.backupBug = angular.copy(bug);
        $scope.current = {
          parentIndex : parentIndex,
          index: index
        };
        // console.log( $scope.current)
      }
      else
      {
        $scope.fileManul = true;
        $scope.isNewBug = true;
        $scope.isEditMode = false;

        $scope.selectedBug = {
          title: null,
          file_names:null,
          file_type:null,
          notes:null,
          rank:null,
          element:null,
          priority:null,
          difficulty:null,
          error_msg:[],
          impact_file:[],
          platforms: getDefaultEnvir(),
          tags:[],
        };
        $scope.backupBug = {};
        // $scope.selectedBug.index = -1;
      }

      $scope.lastCTABoxTargetElem = targetElem;
      $scope.lastCTABoxTargetElem.id = 'cta-box-selected-bug';
      CTAService.initSingleCTA('#' + targetElem.id, '#main-bug-content');

      $timeout(function() {
        var targetElem = document.querySelector('#cta-box-selected-bug');

        // angular.element(targetElem).triggerHandler('click');
        var modalElem = document.querySelector('#cta-modal-selected-bug');
        // CTAService.showModalCTA(modalElem);
        // console.log("check",targetElem)
        modalElem.classList.add('show');
      });
    };

    $scope.removePlatform = function(index){
      if ($scope.selectedBug.platforms && $scope.selectedBug.platforms.length) {
        $scope.selectedBug.platforms.splice(index, 1);
      }
    };
    $scope.addNewPlatform = function(name){
      var platlist = $scope.selectedBug.platforms;
      if (name) {
        if ($scope.advanceSearch.platforms.available_list.indexOf(name) < 0){
          return setErrorMsg('We do not support this platforms: '+name);
        }
        if (platlist.indexOf(name) > -1){
          return setErrorMsg('This platform is already exist');
        }
        $scope.selectedBug.platforms.push(name);
      }
      return '';
    };

    $scope.closePlatform = function(){
      // var targetElem = document.querySelector('#cta-box-selected-bug');
      var modalElem = document.querySelector('#cta-modal-platforms-list');
      modalElem.classList.remove('show');
    };


    $scope.openPlatform = function(){
        // var targetElem = document.querySelector('#cta-box-selected-bug');
        var modalElem = document.querySelector('#cta-modal-platforms-list');
        modalElem.classList.add('show');

    }

    $scope.addPlatforms = function(existPlatform){
       // console.log(existPlatform,getDefaultEnvir()) 
       $scope.platformList = existPlatform
       $scope.openPlatform()
    }

    $scope.removeTag = function(index){
      if ($scope.selectedBug.tags && $scope.selectedBug.tags.length) {
        $scope.selectedBug.tags.splice(index, 1);
        $scope.saveBug()
      }
    }
    $scope.addNewTag = function(newTag){
      taglist = $scope.selectedBug.tags
      if (newTag) {
        if (taglist.indexOf(newTag) > -1){
          return setErrorMsg('Repeating Tag')
        }
        $scope.selectedBug.tags.push(newTag);
        $scope.saveBug();
      }
      return ''
    };

    $scope.isAllEnvirPassed= function(env){
      // var env = $scope.bugReport[index].envir
      var waitForTest = 0;
      var failed= 0;

      for (var i = 0; i < env.length; ++ i){
        if (env[i].isPassed === -1){
          waitForTest ++;
        }
        else if (env[i].isPassed === 0){
          failed ++;
        }
      }
      var str = '';
      if (failed !== 0){
        str += failed + ' failed';
      }
      if (waitForTest !==0){
        str += waitForTest + ' need to get test';
      }
      if (str.length !== 0){
        return str;
      }
      return 'ALL PASSED';

    };



    function setErrorMsg(desc){
      $scope.error_msg = desc;
      $timeout(function() {
        $scope.error_msg = '';
      }, 2500);
      return ''
    }
    function addPlatform(content){
      $scope.advanceSearch.platforms.list.push(content);
      $localstorage.setObject('advanceSearch', $scope.advanceSearch);
    }
    function removePlatform(content){
      if ($scope.advanceSearch.platforms.list && $scope.advanceSearch.platforms.list.length) {
        var index = $scope.advanceSearch.platforms.list.indexOf(content)
        $scope.advanceSearch.platforms.list.splice(index, 1);
        $localstorage.setObject('advanceSearch', $scope.advanceSearch);

      }
    }

    function addTag(content){
        taglist = $scope.advanceSearch.tags.list
        if (content.length > 0 ) {
          if (taglist.indexOf(content) > -1){
            $scope.advanceSearch.tags.empty_tag.content = '';
            $scope.advanceSearch.tags.err_msg = 'Repeating Tag';
            $timeout(function() {
              $scope.advanceSearch.tags.err_msg = '';
            }, 2500);
            return
          }

          $scope.advanceSearch.tags.list.push(content);
          $scope.advanceSearch.tags.empty_tag.content = '';
          // console.log($scope.advanceSearch)
          $localstorage.setObject('advanceSearch', $scope.advanceSearch);
        }

    }
    function removeTag(index){
      if ($scope.advanceSearch.tags.list && $scope.advanceSearch.tags.list.length) {
        $scope.advanceSearch.tags.list.splice(index, 1);
        $localstorage.setObject('advanceSearch', $scope.advanceSearch);
      }
    }
    function genUniqueID(objName){
      var id = 0;
      for (var i = 0; i < objName.length ; ++ i) {
        id += objName.charCodeAt(i);
      }
      return id;
    }
    function getDefaultEnvir(){
          var platformsName = ['chrome','firefox','safari','android','ios','android-chrome','ios-safari'];
          var screenSize = ['small','medium','large','extraLarge'];
          var device = ['desktop','mobile'];
          var environment = [];
          for( var k = 0; k < device.length; ++k){
            for ( var i = 0; i < platformsName.length; ++i ){
                  if (
                      (device[k]!=='desktop' && platformsName[i].indexOf('ios') === 0)  ||
                      (device[k]!=='desktop' && platformsName[i].indexOf('android') ===0)
                      ){
                      environment.push({
                        name: platformsName[i],
                        screenSize: null,
                        device: device[k],
                        isPassed: 0
                      });
                  }
              for ( var j = 0; j < screenSize.length; ++j ){
                  if (
                      (device[k] === 'mobile' || screenSize[j] !== 'extraLarge') &&
                      platformsName[i].indexOf('android') === -1 &&
                      platformsName[i].indexOf('ios') === -1
                      )
                  {
                    environment.push({
                      name: platformsName[i],
                      screenSize: screenSize[j],
                      device: device[k],
                      isPassed: 0
                    });
                  }
              }
            }
          }
          return environment
    }
    function linkReport(object){
      var id = genUniqueID(object.title);
      for (var i = 0; i < $scope.bugReport.length; ++ i) {
        if($scope.bugReport[i].bugID === id){
          return;
        }
      }
      return {name:object.title,bugID:id,bugs:[],help:{},envir:getDefaultEnvir()};
      // return {name:object.title,bugID:id,bugs:[],help:{}};

    }
    function intData(){

        $scope.states = [];
        // $scope.manualBugs = [];
        $scope.help = {};
        $scope.isEditMode = false;
        $scope.isSync = true;
        $scope.availableOptions = [
                                     {id: '1', name: 'All Bugs'},
                                     {id: '2', name: 'Prioritized Bugs'},
                                     {id: '3', name: 'Recently Complete'}
                                  ];
        $scope.availableOptions = {
            'selectedIndex': 0,
            'options': ['All Bugs','Prioritized Bugs','Recently Complete']
        };
        $scope.reverse = true;
        $scope.selectOption = $scope.availableOptions[0];
        $scope.advanceSearch ={
             'workflowsSearch':'',
             'platforms' :{'list':[],'add': addPlatform, 'remove':removePlatform,'available_list':[ 'chrome','firefox','safari','android-app','android-chrome','ios-app','ios-safari']},
             'tags': {'list':[], 'add': addTag, 'remove':removeTag, 'err_msg':'','available_list':[ 'css','major'],'empty_tag': {'placeholder':"+  additional tag", 'content': ''}},
        };
        // console.log("Check",$localstorage.getObject('advanceSearch'))
        var cache = $localstorage.getObject('advanceSearch');
        if (cache!=='[]'){
          if (cache && cache.length !== 0){
              $scope.advanceSearch.workflowsSearch = cache.workflowsSearch;
              $scope.advanceSearch.platforms.list = cache.platforms.list;
              $scope.advanceSearch.tags.list = cache.tags.list;
          }
          // console.log('Reset',$scope.advanceSearch);
        }
        for (var i = 0; i < $scope.bugReport.length; ++ i) {
          if(!$scope.bugReport[i].workFlowID){
           $scope.bugReport[i].workFlowID =  genUniqueID($scope.bugReport[i].name);
          }
          if (!$scope.bugReport[i].manualState){
            $scope.bugReport[i].manualState = [];
            console.log('NO manualState ',$scope.bugReport[i].name);
            for (var j = 0; j < $scope.bugReport[i].states.length; ++j){
                var title = angular.copy($scope.bugReport[i].states[j].title);
                var platforms = angular.copy($scope.bugReport[i].states[j].platforms);
                for (var k = 0; k< platforms.length; ++k)
                {
                  platforms[k].isPassed = 0;
                }
                $scope.bugReport[i].manualState.push({
                  'title' : title,
                  'platforms' : platforms
                });
            }
          }

        }
    }

    function loadUpdatedBugsJsonFile(scope) {
      // LoadingService.showAmbig('Loading....', 10000);
      // console.log('Loading....');
      //https://s3.amazonaws.com/uguru-admin/jason/bugs.json
      //https://s3.amazonaws.com/uguru-admin/sync/bugs.json
      FileService.getS3JsonFile(null, 'https://s3.amazonaws.com/uguru-admin/sync/bugs.json', callbackFunc);
      function callbackFunc(name, resp) {
      
        if(!scope.bugReport){
            scope.bugReport = resp['workflows'];
            scope.lastReportUpdate = resp['lastUpdate'];
        }
        else {
           // console.log(resp['lastUpdate'] , scope.lastReportUpdate);
           if (resp['lastUpdate'] > scope.lastReportUpdate){
               // console.log("DETECT",resp['lastUpdate'], scope.lastReportUpdate)
               scope.bugReport = resp['workflows'];
               scope.lastReportUpdate = resp['lastUpdate'];
               // ReportService.saveBug(resp);
           }
           // else
           // {
           //    console.log("NOTHING NEED TO UDPATED")
           // }
        }
      }
    }
    function getReportIndexByID(id){
        for(var i = 0; i < $scope.bugReport.length ; ++i)
        {
          if ($scope.bugReport[i].bugID === parseInt(id)){
            return i;
          }
        }
        return;
    }
    function updateBugs(){
      // console.log("START");
      loadUpdatedBugsJsonFile($scope)

    }
    // FileService.getS3JsonFile(null, 'https://d4s90fnvxd.execute-api.us-west-2.amazonaws.com/dev', callbackFunc);
    // function callbackFunc(name, resp) {
    //  if(!$scope.test){
    //      $scope.test = resp
    //      console.log('CHECK',$scope.test)

    //  }      
    // }
    
    if (window.location.href.split('8100').length > 1) {
        $timeout(function() {
            loadUpdatedBugsJsonFile($scope);
        },100);
    }


    $scope.$watchCollection('advanceSearch', function(newNames, oldNames) {
      if (oldNames && newNames){
        $localstorage.setObject('advanceSearch', newNames);
      }
    });
    $scope.$watchCollection('bugReport', function(newNames, oldNames) {
      if (!oldNames && newNames){
        console.log('Data is Load',$scope.bugReport);
        intData();
        $scope.indexOfSection = getReportIndexByID(document.URL.split('admin/bugs/')[1]);
        // console.log($scope.indexOfSection)
        if ($scope.indexOfSection){
          $scope.openBugList($scope.bugReport[$scope.indexOfSection]);
        }
        else{
          $scope.openBugList($scope.bugReport[0]);
        }
        // // $scope.openBugList({name:'',bugs:[],help:{}})
        // $scope.userWorkflows = SpecContentService.getContentSpec('preApp');
        // console.log("CHECK",$scope.bugReport);
        $scope.saveBug();
        // ReportService.saveBug($scope.bugReport);
        // console.log('Reprort',ReportService.getBug());
        $interval(updateBugs, 5000);
      }
      else if(oldNames && newNames){
          // console.log('Data is Update',newNames);
         // $scope.openBugList($scope.bugReport[$scope.bugReport.length-1]);
         // $scope.userWorkflows = SpecContentService.getContentSpec('preApp');
         $scope.saveBug();
      }

    });

    // $scope.$watchCollection('userWorkflows', function(newNames, oldNames) {
    //   if (!oldNames && newNames){
    //     for (var i = 0; i < $scope.userWorkflows.length; i++)
    //     {
    //       var section = linkReport($scope.userWorkflows[i]);
    //       if (section){
    //         $scope.bugReport.push(section);
    //       }
    //     }
    //   }
    //   else if(oldNames && newNames){
    //     console.log('Workflows is Update',newNames);
    //   }
    // });

    window.onbeforeunload = function(event)
      {
        if($scope.isEditMode || !$scope.isSync){
          event.returnValue = 'All file won"t be saved without click save button.\n';
        }

      };

  }


]);
angular.module('uguru.admin')

.controller('AdminComponentController', [
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  function($scope, $state, $timeout, SpecService) {

      var base_comp = this;

      SpecService.initSpec('base_comp', $scope);

  }

])
angular
.module('uguru.admin')
.factory("SpecContentService", [
  '$state',
  '$timeout',
  '$localstorage',
  '$window',
  'AdminWorkflowService',
  SpecContentService
  ]);

function SpecContentService($state, $timeout, $localstorage, $window, AdminWorkflowService) {
    var allSpecs = {};
    var allAdminSpecs = {};
    var adminFeedbackArr = ["no docs", "Staging is down", "localhost doesnt work", "override app.css on cp", "dev-toolbar is not working"];
    var adminToolSpec = ["searchable docs", "", "strip data from spec", "univeral per-svg reference", "too many tool-switching (i.e. bounce.js", "upcoming moodbard (no implemented yet)", "todo:learn more about codepen collab", "todsicuss: dev wiki", "default codepen window size ext", "svg bit map", "more robust animation + pause tools", "normlizer"];

    function loadWorkflows() {
        var workflows = AdminWorkflowService.getWorkflows();
        for (wkflw in workflows) {
            workflows[wkflw]['spec'] = getSpec(workflows[wkflw]['id']);
            workflows[wkflw]['ready'] = true;
            workflows[wkflw]['routes'] = getRoutes(workflows[wkflw]['reference'].routeUrl, workflows[wkflw]['reference'].templateUrl, workflows[wkflw]['reference'].cssUrl)
        }
        return {"workflows": workflows}
    }

    function prioritizeWorkflows(workflows, user_name) {
        for (wkflw in workflows['workflows']) {
            var flow = workflows['workflows'][wkflw];
            if (flow.states && flow.states.length) {
                var flowStateAnalysis = {animated: 0, functional:0, tested:0 };
                for (state_id in flow.states) {
                    var state = flow.states[state_id];
                    flowStateAnalysis.functional += (state.functional && 1) || 0;
                    flowStateAnalysis.animated += (state.animated && 1) || 0;
                    flowStateAnalysis.tested += (state.animated && 1) || 0;
                }
                flow['stateAnalysis'] = flowStateAnalysis;
                console.log('successfully analyzed', flow.title);
            }
        }
        return workflows
    }

    allSpecs.preApp =  prioritizeWorkflows(loadWorkflows());
    allAdminSpecs.preApp = [
        {
            title: 'Organize', description: 'depth first pre-app', priority: 1
        },
        {
            title: 'Organize Ctrl, Loader, Splash Madlib', description: 'Depth First', priority: 1,
            tags: ['perfect lightweight base', 'loader mvp + spec']
        },
        {
            title: 'Reflects, Best Practices->Docs, Requirements', description: 'Depth First', priority: 1,
            tags: ['perfect lightweight base', 'loader mvp + spec']
        },
        {
            title: 'Modules: Scroll, Moving Tour Service', description: 'Depth First', priority: 2,
            tags: ['perfect lightweight base', 'loader mvp + spec']
        },
        {
            title: 'Tool: Splash Madlib', description: 'Depth First', priority: 2
        },
        {
            title: 'Pre-App Remainder Spec', description: 'Depth First', priority: 3
        },
        {
            title: 'Cleanup Codebase', description: 'directory structure', priority: 3
        },
        {
            title: 'Organize Calendar', description: 'directory structure', priority: 3
        },
    ]

    function getContentSpec(key) {

        // if (key in allSpecs) {

        return allSpecs[key]['workflows']
        // }
    }

    function getContentSpecAdmin(key) {
        return allAdminSpecs[key]
    }

    return {
        getContentSpec: getContentSpec,
        getContentSpecAdmin: getContentSpecAdmin,
        getTeamMembers: getTeamMembers,
        getStatusSpec: getStatusSpec
    }

    function getStatusSpec() {
        return {

            feedback: adminFeedbackArr,
            requested_tools: adminToolSpec

        }
    }



    function getTeamMembers() {
        return [{
                name: "Jeselle",
                first_name: 'jeselle',
                profile_url: 'https://uguru.me/static/web/images/team/jeselle.png',
                priorities: {
                    components: ['tabs', 'steps', 'dropdown', 'refresher']
                }
            },
            {
                name: "Gabrielle",
                first_name: 'gabrielle',
                profile_url: 'https://uguru.me/static/web/images/team/gabrielle.png'
            },
            {
                name: "Jason",
                first_name: 'jason',
                profile_url: 'https://uguru.me/static/web/images/team/jason.png'
            },
            {
                name: 'Samir',
                first_name: 'samir',
                profile_url: 'https://uguru.me/static/web/images/team/samir.png',
                responsibilities: "Dev, Product Specs, Everything else"
            }];
    }

    function getRoutes(param, template_url, ctrl_url) {
    var defaultRoutes = {
          local: '/#/',
          staging: 'https://uguru_admin:wetrackeverything@uguru-rest-test.herokuapp.com/#/'
        }
        var localUrl = defaultRoutes.local + param;
        var stagingUrl = defaultRoutes.staging + param;
        return {
            local: {url: localUrl, launch: launchSeparateWindowFunc(localUrl)},
            staging: {url: stagingUrl, launch: launchSeparateWindowFunc(stagingUrl)},
            codepen: {launch: launchCodepenFunc(), template_url: template_url, ctrl_url:ctrl_url}
        }
    }
    function launchSeparateWindowFunc(url) {
      return function() {
        $window.open(url, '_blank');
      }
    }

    function getBugInfo(wkflow_name) {
      var id = 0;
      for (var i = 0; i < wkflow_name.length ; ++ i) {
        id += wkflow_name.charCodeAt(i);
      }
      return {
        count: 1,
        stateID: id,
        launchBugTab: function() {
          // console.log("ID",this.bugID)
          var url = document.URL +'/bugs/'+this.workFlowID;
          $window.open(url);
          // alert('coming soon');
        }
      }
    }
    
    function getSpec(wkflow_name) {
      // codepenSpecUrl.replace('.js','') + '/?editors=0010'
      return {launch: wkflow_name, progress:'78%'};
    }
    function launchCodepenFunc() {
      return function(flow, $event) {
        console.log('flow', flow);
          flow.codepenData = {
            title                 : flow.title,
            description           : "Most updated version",
            private               : true, // true || false
            tags                  : [], // an array of strings
            editors               : "101", // Set which editors are open. In this example HTML open, CSS closed, JS open
            layout                : "right", // top | left | right
            html                  : '',
            html_pre_processor    : "",
            css                   : "html { color: red; }",
            css_pre_processor     : "none",
            css_starter           : "neither",
            css_prefix            : "none",
            js                    : "//import this extra file manually https://codepen.io/teamuguru/pen/ONePXN.js",
            js_pre_processor      : "none",
            html_classes          : null,
            head                  : "<meta name='viewport' content='width=device-width'>",
            css_external          : "https://uguru_admin:wetrackeverything@uguru-rest-test.herokuapp.com/static/remote/css/app_version.css",
            js_external           : '',
            css_pre_processor_lib : null,
            js_modernizr : null,
            js_library   : null,
        }
        getHTMLString(flow, getLaunchCB($event.target.parentNode));
      }

      function getLaunchCB($event) {
        return function() {
          $timeout(function() {
            // $scope.$apply();
            var elem = $event.querySelectorAll('input');
            elem[0].click();
            elem[1].click();
            angular.element(elem[0]).triggerHandler('click');
            angular.element(elem[1]).triggerHandler('click');
          })
        }
      }

      function getHTMLString(flow, cb) {
        var requestUrl = '';
        if (window.location.href.split(':8100').length > 1) {
          requestUrl = flow.routes.local.url.split('#/')[0] + 'remote/templates/' + flow.routes.codepen.template_url;
        } else {
          requestUrl = flow.routes.staging.url.split('#/')[0] + 'static/remote/templates/' + flow.routes.codepen.template_url;
        }
        loadHTMLSpec(flow, requestUrl, cb);
      }

      function loadHTMLSpec(flow, template_url, cb) {
        console.log('fetching...', template_url);
        var xhr = new XMLHttpRequest();
        xhr.open( 'GET', template_url, true );

        xhr.onload = function () {
            flow.codepenData.html = wrapMinUguruHtml(xhr.responseText, flow.routes.codepen.ctrl_url);

            $timeout(function() {
              // $scope.$apply();
              $timeout(function() {
                cb && cb()
              }, 500);
            });
        };
        xhr.send();
      }

      function wrapMinUguruHtml(response_html, relative_ctrl_url) {
        return '<body ng-app="uguru" animation="slide-left-right-ios7"><script src="https://uguru_admin:wetrackeverything@uguru-rest-test.herokuapp.com/static/remote/js/u.base.js"></script><script src="https://uguru_admin:wetrackeverything@uguru-rest-test.herokuapp.com/static/remote/js/main.min.js"></script><script src="https://uguru_admin:wetrackeverything@uguru-rest-test.herokuapp.com/static/remote/js/' + relative_ctrl_url + '"></script><ui-view id="uguru-view"><script type="text/ng-template" id="calendar.html">' + response_html + '</div></script></ui-view></body>'
      }
    }





}

angular.module('uguru.admin')
.directive("spec", ['$timeout', 'RootService', function($timeout, RootService) {
        return {
            templateUrl: RootService.getBaseUrl() + 'admin/templates/components/spec.tpl',
            scope: {
                spec: '=data'
            },
            replace: true,
            restrict: 'E',
            link: function(scope, element, attr) {
                return
            }
        }
    }
])
.directive("kfX", ['$timeout', 'UtilitiesService', '$compile', function($timeout, UtilitiesService, $compile) {
        return {
            restrict: 'A',
            replace: true,
            scope: {
                kf: '=kfX'
            },
            link: function preLink(scope, element, attr) {

                element[0].setAttribute('x', scope.kf);

            }
        }
}])

.directive("componentStatusBar", ["$timeout", "XHRService", function($timeout, XHRService) {
    return {
        restrict: 'E',
        replace: true,
        templateUrl: 'admin/templates/components/components.status.tpl',
        link: function preLink(scope, element, attr) {
            scope.section = attr.section;
            scope.name = attr.name;
            scope.version = attr.version
            console.log('this should work')
            var callback = function(response) {
                // console.log();
                scope.metadata = response["dir"][scope.section][scope.name];
                for (_var in scope.metadata.versionVars) {
                    if (_var === scope.version) {
                        scope.$parent[_var] = scope.metadata.versionVars[_var]
                    }
                }
            }
            XHRService.getJSONFile('GET', 'admin/spec/component.json', callback)
        }
    }
}])
.directive("inspectorGadget", ['$timeout', 'UtilitiesService', '$compile', 'RootService', function($timeout, UtilitiesService, $compile, RootService) {
        return {
            restrict: 'E',
            replace: true,
            templateUrl: RootService.getBaseUrl() + 'admin/templates/components/inspector.gadget.player.tpl',
            link:  {pre: function(scope, element, attr) {
                scope.triggerEvents = ['on-click', 'on-mouse-leave', 'on-mouse-enter', 'on-mouse-over'];
                scope.classEvents = ['on-enter', 'on-exit', 'on-init', 'init-with'];
                scope.supportedAttributes = ['active', 'showProps', 'reverseSpeed', 'speed', 'showOptions', 'showLog', 'startAt', 'selector', 'ballColor', 'bgColor', 'state', 'autoPlay', "playInfinite", 'stepSize', 'startAt', 'endAt', 'pauseAt', 'visible']
                scope.root = scope.$parent.root;
                scope.$watch('root.inspector.players', function(players) {
                    console.log('players updated', players.length)
                })
                        for (key in attr) {
                            if (scope.supportedAttributes.indexOf(key) > -1) {

                                scope.root.inspector.preferences[key] = attr[key];
                                if (attr[key] === 'true' || attr[key] === 'false') {
                                    scope.root.inspector.preferences[key] = (attr[key] === 'true');
                                }
                                if (key in attr && !attr[key]) {
                                    scope.root.inspector.preferences[key] = true;
                                }
                                if (['stepSize', 'reverseSpeed', 'speed'].indexOf(key) > -1) {
                                    scope.root.inspector.preferences[key] = parseFloat(attr[key].replace('x', ''))
                                }
                            }
                        }
                        scope.activePlayers = [];
                        scope.elementInspector = RootService.inspectableElements;
                    },
                    post: function(scope, element, attr) {
                        var parentView = element[0].parentNode
                        var inspectorElems = parentView.querySelectorAll('[inspector-elem]');
                        var inspectorTriggers = parentView.querySelectorAll('[inspect-trigger]');
                        var autoTriggerStates = [];
                        for (var i = 0; i < inspectorElems.length; i++) {
                            var stateName = inspectorElems[i].getAttribute('inspector-elem');
                            if (stateName.indexOf('when') > -1) {
                                var stateNameCamel;
                                if (stateName.indexOf('|d-') > -1) {
                                    var stateNameSplit = stateName.split('|d-');
                                    var delay = parseFloat(stateNameSplit[1]);
                                    stateNameCamel = UtilitiesService.camelCase(stateNameSplit[0])
                                    console.log(stateNameCamel, delay)
                                    $timeout(function() {
                                        scope.root.public.customStates.when[stateNameCamel] = true;
                                    }, delay)

                                }
                            }
                        }
                        $timeout(function() {

                            $timeout(function() {
                                $compile(element[0])(scope);
                                scope.$apply()
                            })
                        }, 1000)
                        for (var i = 0; i < inspectorTriggers.length; i++) {
                            var iTriggerElem = inspectorTriggers[i];
                            var iTriggerAttr = iTriggerElem.getAttribute('inspect-trigger');
                            var iTriggerValState = iTriggerAttr.split('|')[0];
                            var iTriggerValTime = iTriggerAttr.split('|')[1];
                            autoTriggerStates.push({
                                elem: iTriggerElem,
                                state: iTriggerValState,
                                time: iTriggerValTime
                            })
                            triggerStateInFuture(iTriggerElem, iTriggerValState, iTriggerValTime);
                        }

                        function triggerStateInFuture(trigger_elem, trigger_type, delay) {

                            $timeout(function() {
                                if (scope.triggerEvents.indexOf(trigger_type) > -1) {
                                    console.log('supposed to be triggering', trigger_type, 'after', delay + 'ms for', trigger_elem)
                                    angular.element(trigger_elem).triggerHandler(trigger_type.replace('on-', ''));
                                } else if (scope.classEvents.indexOf(trigger_type) > -1) {
                                    trigger_elem.classList.add(trigger_type)
                                } else if (trigger_type.indexOf('when-') > -1) {
                                    scope.root.public.customStates['when'][UtilitiesService.camelCase(trigger_type)] = true;
                                }
                            }, parseFloat(delay) || 0)
                        }




                        // $timeout(function() {
                        // scope.$watch('root.inspector.players', function(new_value, old_value) {
                        //     console.log(new_value.length)
                        //     for (var i = 0; i < scope.root.inspector.players.length; i++) {

                        //         var iPlayer = scope.root.inspector.players[i];

                        //         scope.root.player = iPlayer;
                        //     }

                        // })
                        // }, 500)
                    }
                }

        }
}])

.directive("types", ['$timeout', 'UtilitiesService', '$compile', function($timeout, UtilitiesService, $compile) {
        return {
            restrict: 'A',
            replace: false,

            link: function(scope, element, attr) {
                scope.types = UtilitiesService.replaceAll(attr.types, ', ', ',').split(',');
                scope.activateType = function(type) {
                    var onExitElems = element[0].querySelectorAll('[on-exit][ng-if]');
                    var currentTypeIndex = scope.types.indexOf(scope.activeType);
                    var nextTypeIndex = scope.types.indexOf(type);
                    if (onExitElems && onExitElems.length && currentTypeIndex <= scope.types.length && currentTypeIndex <= onExitElems.length) {
                        var exitElem = onExitElems[currentTypeIndex];
                        if (exitElem) {
                            exitElem.classList.add('on-exit');
                            $timeout(function() {
                                exitElem.classList.add('on-exit');
                            }, 1000)
                        }
                        if (nextTypeIndex && nextTypeIndex <= scope.types.length) {
                            nextType = onExitElems[nextTypeIndex];
                            if (nextType) {
                                $timeout(function() {
                                    nextType.classList.add('on-enter');
                                }, 1250)
                            }
                        }
                    } else {
                        scope.activeType = type;
                    }
                }
                if (attr.defaultType) {
                    scope.activeType = scope.types[scope.types.indexOf(attr.defaultType)]
                } else {
                    scope.activeType = scope.types[0];
                }
                var div = document.createElement('div');
                div.setAttribute('ng-include', '"' +  'admin/templates/types.tpl'  +'"');
                element[0].parentNode.appendChild(div);
                $compile(div)(scope);

            }
        }
    }
])
.directive("animationPlayer", ['$timeout', 'RootService', function($timeout, RootService) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/animation.player.tpl',
        restrict: 'E',
        scope: {anim:'=anim'},
        replace: true,
        link: function(scope, element, attr) {
            var browserPrefix = RootService.getBrowserPrefix() || '';
            scope.player = {idle: true, playing:false, refreshable: false};
            var startListener = scope.anim.listeners.start();
            // var endListener = scope.anim.listeners.end(function() {scope.anim.playState = 'paused';});
            scope.play = function() {
                console.log('clicked');
                scope.anim.element.css('-webkit-animation-name', '');
                scope.anim.playState = 'running';

                $timeout(function() {
                    scope.anim.element.css('-webkit-animation-name', scope.anim.name);
                    scope.$apply();
                })
            }

            var animStartEvent = 'animation';
            if (browserPrefix) {
                animStartEvent = browserPrefix.toLowerCase() + 'Animation'
            }
        }
    }
}])
.directive("animationPlayer", ['$timeout', 'RootService', function($timeout, RootService) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/animation.player.tpl',
        restrict: 'E',
        scope: {anim:'=anim'},
        replace: true,
        link: function(scope, element, attr) {
            var browserPrefix = RootService.getBrowserPrefix() || '';
            scope.player = {idle: true, playing:false, refreshable: false};
            var startListener = scope.anim.listeners.start();
            // var endListener = scope.anim.listeners.end(function() {scope.anim.playState = 'paused';});
            scope.play = function() {
                console.log('clicked');
                scope.anim.element.css('-webkit-animation-name', '');
                scope.anim.playState = 'running';

                $timeout(function() {
                    scope.anim.element.css('-webkit-animation-name', scope.anim.name);
                    scope.$apply();
                })
            }

            var animStartEvent = 'animation';
            if (browserPrefix) {
                animStartEvent = browserPrefix.toLowerCase() + 'Animation'
            }
        }
    }
}])
.directive("gallery", ['$timeout', 'UtilitiesService', function($timeout, UtilitiesService) {
    return {
        templateUrl: 'admin/templates/components/gallery.tpl',
        restrict: 'E',
        scope: {},
        link: function(scope, element, attr) {
            scope.name = attr.name.length && attr.name[0].toUpperCase() + attr.name.substring(1);
            scope.type = attr.type.length && attr.type[0].toUpperCase() + attr.type.substring(1);
            scope.components = UtilitiesService.replaceAll(attr.includes, ', ', ',').split(',')
            console.log(scope.components);
            scope.components.forEach(function(str, i) {
                scope.components[i] = {
                    'name': str,
                    url: ('/#/dev/' + scope.type.toLowerCase() + 's/' + scope.name.toLowerCase() + '/' + str),
                    file_path: 'shared/templates/components/' + scope.type.toLowerCase() + '/' + scope.name.toLowerCase() + '/' + str + '.tpl'
                };
            });
        }
    }
}])
.directive("player", ['$timeout', 'RootService', function($timeout, RootService) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/player.tpl',
        restrict: 'E',
        scope: {root:'=root', state:'=state', startOffset:'=startOffset', duration: '=duration', props:'=props', play:'=play', pause:'=pause', update: '=update'},
        replace: true,
        link: function(scope, element, attr) {
            scope.playerPos = scope.startOffset;
            scope.activeAttrIndex = -1
            scope.activateAttr = function($index, key) {

                scope.activeAttrIndex = $index;
                scope.activeAttrArr = scope.props.attr[key].arr;
                console.log(scope.activeAttrArr);
                if (key !== 'style') {
                    scope.activeAttrArr = scope.activeAttrArr[0];
                }


                $timeout(function() {
                    scope.$apply();
                });
            }
            scope.goBackOneLevel = function() {
                scope.activeAttrIndex = -1;
                scope.activeAttrArr = null;
            }
        }
    }
}])
.directive("animTools", ['$timeout', 'RootService', 'AnimToolService', function($timeout, RootService, AnimToolService) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/anim.tools.tpl',
        scope: {
            active: '=active',
            stage: '=ngModel'
        },
        replace: true,
        restrict: 'E',
        link: function(scope, element, attr) {
            AnimToolService.setStage(scope.stage);
            console.log('setting stage', scope.stage)
            scope.stage.recorder = AnimToolService.initRecorder(scope.stage, scope);
            console.log('recorder initialized', scope.stage.recorder)
            scope.stage.player = AnimToolService.initPlayer(scope.stage);
            scope.stage.recorder.start(scope.stage.recorder);
            console.log('starting..')
        }
    }
}])
.directive('actionItem', ['$timeout', 'DirectiveService', 'UtilitiesService', function ($timeout, DirectiveService, UtilitiesService) {
  return {
    restrict: 'E',
    priority: 10,
    link : function(scope, element, attr) {
        var actionObj = constructObjFromAttr(attr);
        scope.$parent.root.milestones.push(actionObj);
        attr.$set('ngIf', 'false')
     }
    }
    function constructObjFromAttr(attr) {
        return {
            items: attr.items && UtilitiesService.removeAllOccurrancesArr(attr.items, ['[', ']', '"', "'"]),
            priority: parseInt(attr.priority),
            tested: attr.tested === 'true',
            time: attr.time,
            phase: attr.phase,
            type: attr.type,
            group: attr.group
        }
    }
}])
.directive('module', ['$timeout', '$stateParams', function ($timeout, $stateParams) {
  return {
    restrict: 'E',
    replace: true,
    scope: true,
    controller: ["$scope", function($scope) {
      $scope.module = {name: '', dimensions:'', workflows: [], teamArr: ['SM', 'GW', 'JO', 'JH']};
    }],
    link : function preLink(scope, element, attr, ctrl, transcludeFn) {
        ctrl.element = element;
        if (!attr.name || !attr.dimensions) return;
        if (attr.columns) {
            scope.module.columns = attr.columns.split(',')
        }
        scope.module.name = attr.name

        scope.module.typeFilter = $stateParams.type;
        scope.module.activePerson = attr.active;
        scope.module.dimensions = attr.dimensions;
        scope.module.toggleActivate = toggleActivate;
        $timeout(function() {
            scope.$parent.ms.modules.push(scope.module);
            scope.$parent.ms.activeModule = scope.module;
            $timeout(function() {
                scope.$watch('module.workflows', function(workflows) {

                    for (var i = 0; i < workflows.length; i++) {
                        var iWorkflow = workflows[i];
                        iWorkflow.progress = iWorkflow.calculateProgress(iWorkflow.stories);
                    }
                    $timeout(function() {
                        scope.module.progress = calcModuleProgress(scope.module.workflows);
                    })


                })
            })
        })
        function toggleActivate(workflow, module) {
            workflow.active = !workflow.active;
            for (var i = 0; i < module.workflows.length; i++) {
                var indexWorkflow = module.workflows[i];
                if (module.workflow !== indexWorkflow) {
                    indexWorkflow.active = false;
                }
            }
        }
     }
    }
}])
.directive('userWorkflow', ['UtilitiesService','$timeout', '$stateParams', function (UtilitiesService, $timeout, $stateParams) {
  return {
    replace: true,
    restrict: 'E',
    require: '^module',
    scope: true,
    link: function preLink(scope, element, attr, ctrl) {
        if (!attr.name) return;
        scope.workflow = {
            id: scope.module.workflows.length + 1,
            name: attr.name,
            filter: {options: ['stories','streams', 'bugs', 'states'], tags:[], tagsUpdated: false, activeIndex: 0},
            sort_tags: {functional: false, cp: false},
            columns: {
                bugs: ['id', 'name', 'description', 'platform', 'by', 'tested'],
                streams: ['name', 'tags/status', 'progress'],
                stories: ['name', 'tags/status', 'progress'],
                states: ['name', 'tags/status', 'progress']
            },
            bugs:[],
            access: checkInitialAccess(scope.module, scope.module.activePerson),
            streams: [],
            states: [],
            url: attr.url,
            completed: 'completed' in attr,
            setup: {
                base: {},
                post: {},
            },
            complete: 'complete' in attr,
            priority: ('priority' in attr && parseFloat(attr.priority)) || 100,
            stories:[],
            calculateProgress: calcWorkflowProgress,
            progress: {},
            personDict: {},
            enabled: $stateParams.type && $stateParams.type === attr.type,
            priority: parseFloat(attr.priority || 100.0),
            toggleActivate: scope.module.toggleActivate
        }

        if (!scope.module.workflows.length) {
            scope.workflow.active = true;
        };

        function parseDefaultFilters(str_defaults, active_person, all_tags) {
            if (!all_tags) return;
            var strDefaultsSplit = UtilitiesService.replaceAll(str_defaults, ', ', ',').split(',');
            var personFilterDict = {};
            strDefaultsSplit.forEach(
                function(option, index) {
                    var initial = option.split(':')[0]
                    var formattedTags = option.split(':').splice(1).join(":");
                    formattedTags = UtilitiesService.removeAllOccurrancesArr(formattedTags, ['[', ']'])
                    var tagArr = formattedTags.split('|');
                    tagArr.forEach(function(option, index) {tagArr[index] = UtilitiesService.replaceAll(option, ':', '|')})
                    personFilterDict[initial] = {tags: tagArr};
                }
            );
            if (active_person in personFilterDict && personFilterDict[active_person]) {
                var activeTags = personFilterDict[active_person].tags;
                var selectedTags = [];
                for (var i = 0; i < activeTags.length; i++) {
                    var iTag = activeTags[i];
                    all_tags.forEach(function(tag, index) {

                        if (tag.kvStr === iTag) {
                            tag.active = true;
                            selectedTags.push(tag);
                        } else if (tag.kvStr.indexOf(iTag.split('|')[1]) > -1) {
                            var tagArgSplit = tag.kvStr.split('|');
                            var iTagArgSplit = iTag.split('|');
                            if (tagArgSplit[0] === iTagArgSplit[0]) {
                                tagArg2 = tagArgSplit[1]
                                iTagArg2 = iTagArgSplit[1];
                                if (tagArg2.indexOf(iTagArg2) > -1) {
                                    tag.active = true;
                                    selectedTags.push(tag);
                                }
                            }
                        }
                    })
                }
                return selectedTags;
            }
        return []
        }

        scope.$watch('module.activePerson', function(new_person) {
            scope.module.workflows.sort(function(w1, w2) {return w2.priority - w1.priority}).reverse();
        })
        scope.$watch('workflow.filter.activeIndex', function(new_index) {
            scope.workflow.filter.tags = getCommonTagsAndFunc(scope.workflow, attr.tags, scope.module.activePerson);
            scope.workflow.filter.selectedTags = attr.defaultFilters && parseDefaultFilters(attr.defaultFilters, scope.module.activePerson, scope.workflow.filter.tags);
            scope.workflow.filter.tagsUpdated = true;
            $timeout(function() {
                scope.$apply();
            });
        })

        $timeout(function() {
            scope.$watch('workflow.filter.tagsUpdated', function(update) {
                if (!update) return;
                scope.workflow.filter.tagsUpdated = false;
                var activeFilterName = scope.workflow.filter.options[scope.workflow.filter.activeIndex];
                var activeFilterArr = scope.workflow[activeFilterName];
                var activeTags = [];
                scope.workflow.filter.tags.forEach(function(tag, index) {if (tag.active) activeTags.push(tag.kvStr)});

                for (var i = 0; i < activeFilterArr.length; i++) {
                    var iFilterObj = activeFilterArr[i];
                    iFilterObj.activeTagCount = 0;
                    if (iFilterObj.tags && iFilterObj.tags.length) {
                        iFilterObj.tags.forEach(function(tag, index) {
                            if (activeTags.indexOf(tag.kvStr) > -1) {
                                iFilterObj.activeTagCount += 1;
                                iFilterObj.tags[index].active = true;
                            } else {
                                iFilterObj.tags[index].active = false;
                            }
                        })
                    }
                    if (iFilterObj.activeTagCount) {
                        iFilterObj.inactive = false;
                    } else {
                        iFilterObj.inactive = true;
                    }
                }
                scope.workflow[activeFilterName].sort(function(item_1, item_2) {return item_2.activeTagCount - item_1.activeTagCount});
            });
            $timeout(function() {

                scope.workflow.filter.tagsUpdated = false;
                scope.workflow.filter.tagsUpdated = true;
            })

        })



        function sortWorkflows() {
            scope.module.workflows.push(scope.workflow);
            scope.module.workflows.sort(function(w1, w2) {if (w2.access) w2.priority = 10000; if (w1.access) w1.priority = 10000; return w2.priority - w1.priority}).reverse();
            var filterdWorkflows = scope.module.workflows.filter(function(w, i) {return w.enabled && !w.completed})
            filterdWorkflows.forEach(function(option, index) {option.pID = index + 1})
            scope.module.workflows = filterdWorkflows;
            for (var i = 0; i < scope.module.workflows.length; i++) {
                var iWorkflow = scope.module.workflows[i];
                var length1 = iWorkflow.stories.length;
                iWorkflow.stories = iWorkflow.stories && iWorkflow.stories.filter(function(s, i) { return !('type' in s) || s['type'] === $stateParams.type})
                var length2 = iWorkflow.stories.length;
            }
        }

        function checkInitialAccess(module, workflow_id, initial) {
            var result = (attr.access && attr.access.length && attr.access.indexOf(initial) === -1)

            for (var i = 0; i < module.workflows.length; i++) {

            }
            return result;
        }

        sortWorkflows();
        // scope.module.workflows.reverse()

     }
    }
}])
.directive('userStories', ['$timeout', function ($timeout) {
  return {
    replace: true,
    restrict: 'E',
    require: '^module',
    scope: true,
    controller: ["$scope", function($scope) {
        $scope.workflow = $scope.$parent.workflow;
    }],
    link : function(scope, element, attr) {
        scope.stories = [];
        scope.personDict = {};
        $timeout(function() {
            scope.workflow = scope.$parent.workflow;
            scope.workflow.stories = scope.stories;
            scope.workflow.personDict = scope.personDict;
            scope.$apply();
                $timeout(function() {
                    scope.$watch('module.activePerson', function(new_person, old_person) {
                    if (new_person in scope.personDict) {
                        scope.personDict[new_person].sort(sortStoryByPriority(new_person));
                        scope.stories = scope.personDict[new_person];
                    }
                    scope.$watch('workflow.stories', function(new_value) {
                        var activePerson = scope.module.activePerson;
                        for (var i = 0; i < scope.workflow.stories.length; i++) {
                            var iStory = scope.workflow.stories[i];
                            iStory.progress = iStory.calculateProgress(iStory.streams);
                            for (var j = 0; j < iStory.streams.length; j ++) {
                                var jStream = iStory.streams[j];
                                scope.workflow.states.sort(function(s1, s2) {
                                    s1 = parseFloat(s1);
                                    s2 = parseFloat(s2);
                                    if (s1.complete) {
                                        s1.priority = 101;
                                    }
                                    if (s2.complete) {
                                        s2.priority = 101;
                                    }
                                    return s2.priority - s1.priority;
                                }).reverse();
                                scope.workflow.states.forEach(function(s, i) {s.pID = i+1})
                            }
                        }
                        if (scope.workflow.progress && scope.workflow.stories.length) {
                            scope.workflow.progress.stories = {total: scope.workflow.stories.length, complete : scope.workflow.stories.filter(function(s, i) {return s.complete}).length}
                            var workflowStateProgress = {total: 0, complete: 0};

                            scope.workflow.stories && scope.workflow.stories.forEach(function(s, i) {
                                workflowStateProgress.total += (s.states && s.states.length) || 0;
                                workflowStateProgress.complete += (s.states && s.states.length && s.states.filter(function(st, i) {return st.complete}).length) || 0;
                            })
                            scope.workflow.progress.states = workflowStateProgress;

                        }
                        scope.workflow.stories.forEach(function(s, i) {s.pID = i + 1})
                    })
                })
            }, 1000)
        });
     }
    }
}])
.directive('story', ['$timeout', function ($timeout) {
  return {
    replace: true,
    restrict: 'E',
    require: '^module',
    scope: true,
    link : function(scope, element, attr) {
        scope.story = {
            name: attr.name ||attr.desc,
            desc:attr.desc,
            calculateProgress: calcStoryProgress,
            func: attr.func === 'true',
            tested: attr.tested === 'true',
            cross_platform: attr.crossPlatform === 'true',
            responsive: attr.responsive === 'true',
            children: ['streams', 'states', 'bugs'],
            streams: [],
            priority: 'priority' in attr && parseFloat(attr['priority']) || 100,
            progress: {},
            complete: 'complete' in attr,
            states: [],
            type: 'type' in attr && attr.type || null,
            priority: parsePriority(attr.priority) || {SM:100},
            bugs: []
        }
        if (scope.story.complete) {
            scope.story.progress = scope.story.calculateProgress(scope.story.streams);
            scope.story.progress.states.total = 1;
            scope.story.progress.states.complete = 1;
        }
        if (!attr.name) scope.story.desc = '';
        // scope.$watchCollection('story', function(story, old_story) {
        //     scope.story.bugsLength
        // })

        $timeout(function() {
            scope.stories = scope.$parent.stories;
            scope.stories.push(scope.story);

            scope.story.id = scope.stories.length + 1;
            // scope.$apply();
            scope.story.priority && updateUserStoriesPriority(scope.$parent, scope.story, scope.module.activePerson);
             scope.$watch('story.streams', function(streams) {
                var activePerson = scope.module.activePerson;
                for (var i = 0; i < scope.story.streams.length; i++) {
                    var iStream = scope.story.streams[i];
                    iStream.progress = iStream.calculateProgress(iStream.states);
                }
            })

        })
     }
    }
}])
.directive('uiStream', ['$timeout', function ($timeout) {
  return {
    replace: true,
    restrict: 'E',
    require: ['^module'],
    scope: true,
    link : function postLink(scope, element, attr) {
        scope.stream = {
            desc: attr.desc,
            states:[],
            bugs: [],
            progress:{},
            type: 'type' in attr && attr['type'],
            cp: ('cp' in attr && attr['cp']) || false,
            func: ('func' in attr && attr['func']) || false,
            calculateProgress: calcStreamProgress
        }
        $timeout(function() {
            scope.story = scope.$parent.story;
            scope.story.streams.push(scope.stream);
            scope.stream.id = scope.story.streams.length + 1;
            scope.story_id = scope.story.id;
            $timeout(function() {

                scope.$parent.workflow.streams.push(scope.stream);
                // console.log();
                // scope.$parent.workflow.states.push(scope.state);
                scope.$watch('stream.states', function(states) {
                    states.forEach(function(s, index) { if (s.complete) {s.priority = 101; }});
                    states && states.sort(function(s1, s2) {
                        return s2.priority - s1.priority;
                    })
                    states && states.forEach(function(s, index) { s.pID = index + 1;})
                })
            })
        })

     }
    }
}])
.directive('uiState', ['$timeout', 'AdminDebugService', function ($timeout, AdminDebugService) {
  return {
    replace: true,
    restrict: 'E',
    require: ['^module'],
    scope: true,
    link : function postLink(scope, element, attr) {
        scope.state = {
            desc: attr.desc,
            name: attr.name,
            testId: attr.testId,
            bugs:[],
            complete: 'complete' in attr,
            testObj: null,
            tags: [],
            type: 'type' in attr && attr['type'],
            func: 'func' in attr && (attr['func'] === 'true' || attr['functional'] === 'true'),
            cp: 'cp' in attr && attr['cp'] === 'true',
            tested: 'tested' in attr && attr['test'] === 'true',
            priority: 'priority' in attr && parseFloat(attr['priority']) || 100,

        }
        $timeout(function() {
            scope.stream = scope.$parent.stream;
            if (!scope.state.type && scope.stream && scope.stream.type) {
                scope.state.type = scope.stream.type;
            }
            else if (!scope.state.type && (!scope.stream || !scope.stream.type)) {
                scope.state.type = scope.$parent.story.type;
            }
            $timeout(function() {
                if (scope.stream && scope.stream.states) {
                    scope.state.id = scope.stream.states.length + 1;
                    scope.state.stream_id = scope.stream.id;
                    scope.stream.progress = scope.stream.calculateProgress(scope.stream.states);
                    scope.stream.states.push(scope.state);
                }
            })


            $timeout(function() {
                if (scope.$parent.workflow.type) {
                    console.log('has type');
                    scope.state.type = scope.$parent.story.type;
                }
                scope.$parent.story.states.push(scope.state);
                scope.$parent.workflow.states.push(scope.state);

                scope.$parent.story.progress = scope.$parent.story.calculateProgress(scope.story.streams);
            })
            //@jason
            if ('testId' in attr && attr.testId.length) {
                // passes the scope so you can update it immediately (you pulled all the bugs locally)
                scope.state.testObj = AdminDebugService.getTestStateObj(parseInt(attr.testId), scope.state);

                // three checks in the if statement?
                //check 1, does it return something immediately
                //check 2, does it return a dictionary
                //check 3, does the dictionary have the ID in it
                if (scope.state.testObj && typeof(scope.state.testObj) === 'object' && 'id' in scope.state.testObj) {
                    attr.testId = scope.state.testObj.id;
                    console.log('test state id', attr.testId, scope.state.testObj);
                } else {
                    //if it doesnt return something immediately, b/c i passed u the scope, if you make a server request to get the object,
                    scope.$watch('state.testObj', function(updated_obj) {
                        if (updated_obj && typeof(updated_obj) === 'object' && 'id' in updated_obj) {
                            attr.testId = updated_obj.id;
                            console.log('test state id', attr.testId, scope.state.testObj);
                        } else {
                            console.log('returned object from BugService getTestStateObj', updated_obj);
                        }
                    })
                }
            }

        })

     }
    }
}])
.directive('bug', ['$timeout', function ($timeout) {
  return {
    replace: true,
    restrict: 'E',
    require: ['^module'],
    scope: true,
    link : function postLink(scope, element, attr) {
        var supportedTypes = ['functional', 'static', 'animation'];
        scope.bug = {
            desc: attr.desc || attr.description,
            type: attr.type,
            platform: attr.platform,
            by: attr.by,
            id: attr.id,
            tested: attr.tested === 'true',
            open: 'open' in attr,
            tested: ('tested' in attr && attr.tested === 'true') || false,
        }
        $timeout(function() {

            scope.state = scope.$parent.state;

            scope.state.bugs.push(scope.bug);
            // scope.state.stream.bugs.push(scope.bug);
            // scope.state.story.bugs.push(scope.bug);
            $timeout(function() {
                if (scope.bug.type === 'functional') {
                    scope.bug.id = scope.$parent.$parent.workflow.bugs.length + 1;
                    scope.bug.state_id = scope.state.id;
                    scope.bug.stream_id = scope.state.stream_id;
                    // scope.bug.name = (scope.$parent.stream.name || '') + ' ' + scope.state.name;
                    scope.$parent.$parent.workflow.bugs.push(scope.bug);
                }
            })

        })

     }
    }
}])
.directive('setup', ['$timeout', function ($timeout) {
  return {
    replace: true,
    restrict: 'E',
    require: ['^module'],
    scope: false,
    link : function postLink(scope, element, attr) {
        var type = attr.type;
        scope[type] = {components:[], directives: [], specs: []}
        $timeout(function() {
            scope.workflow.setup.base = scope[type];
        })
     }
    }
}])
.directive("docItem", ['RootService', '$timeout', '$filter', function(RootService, $timeout, $filter) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/admin.doc.tpl',
        transclude:true,
        replace:true,
        restrict: 'E',
        scope:true,
        controller: 'AdminDocItemController',
        controllerAs: 'doc_item',
        link: function preLink(scope, element, attr, ctrl, transcludeFn) {
            ctrl.element = element;
            element[0].setAttribute('doc-item-id', ctrl.id);
            scope.hide = false;
            if ('keywords' in attr) {
                ctrl.keywords = attr.keywords.split(', ');
            }
            if ('type' in attr) {
                ctrl.type = attr.type;
            }
            $timeout(function() {
                var docItems = RootService.getDocItems();
            }, 1000)

            scope.$watch(function() {
              return element.attr('class');
            }, function(new_value, old_value) {
                $timeout(function() {
                    if (new_value && new_value.indexOf('hide-doc-item') > -1) {
                        element[0].classList.remove('hide-doc-item');
                        scope.hide = true;
                    }
                    if (new_value && new_value.indexOf('show-doc-item') > -1) {
                        element[0].classList.remove('show-doc-item');
                        scope.hide = false;
                    }
                })
            });
        }
    }

}])
.directive("docTitle", ['RootService', '$timeout', function(RootService, $timeout) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/admin.doc.title.tpl',
        transclude:true,
        replace:true,
        restrict: 'E',
        require:'^docItem',
        scope:false,
        link: function(scope, element, attr) {
            scope.doc_item = scope.$parent.doc_item;
            var elementTitle = element[0].querySelector('ng-transclude span:last-child');
            if (!elementTitle) {
                console.log('missing doc title', element[0]);
                return;
            }
            scope.doc_item.title = elementTitle.innerHTML.trim();
            return;
        }
    }
}])
.directive("docDescription", ['RootService', '$timeout', function(RootService, $timeout) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/admin.doc.description.tpl',
        transclude:true,
        replace:true,
        restrict: 'E',
        require:'^docItem',
        scope:false,
        link: function(scope, element, attr) {
            scope.doc_item = scope.$parent.doc_item;
            var elementDescription = element[0].querySelector('ng-transclude span:last-child');
            if (!elementDescription) {
                console.log('missing doc title', element[0]);
                return;
            }
            scope.doc_item.description = elementDescription.innerHTML.trim();
            return;
            return;
        }
    }
}])
.directive("docDemo", ['RootService', '$timeout', function(RootService, $timeout) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/admin.doc.demo.tpl',
        transclude:true,
        replace:true,
        scope:false,
        restrict: 'E',
        require:'^docItem',
        link: function(scope, element, attr, parent_controller) {
            scope.doc_item = scope.$parent.doc_item;
        }
    }
}])

.directive("docState", ['RootService', '$timeout', '$compile', function(RootService, $timeout, $compile) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/admin.doc.state.tpl',
        transclude:true,
        replace:true,
        scope:{doc:'='},
        restrict: 'E',
        link: {
            post: function(scope, element, attr) {
                scope.doc = scope.$parent.doc_item;

                var title = attr.name;
                var inherit = false;
                var html;
                if ('default' in attr) {
                    scope.doc.stateIndex = scope.doc.states.length
                    title = 'Default';
                }
                if ('inherit' in attr && scope.doc.states.length) {
                    html = scope['doc'].states[0].html;
                    inherit = true;
                }
                if (attr.name && !('default' in attr)) {
                    var dashedAttribute = attr.name.replace(/([A-Z])/g, function($1){return "-"+$1.toLowerCase();});
                    var selectedAttrElems = element[0].parentNode.querySelectorAll('[' + dashedAttribute + ']');
                }
                scope.state = {
                    title: title,
                    id: scope.doc && scope.doc.states.length,
                    html: html || element[0].innerHTML,
                    inherit: inherit
                }
                scope.doc && scope.doc.states.push(scope.state);
                // $compile(element[0])(scope);
            }
        }
    }
}])
.directive("docSpec", ['RootService', '$timeout', '$compile', function(RootService, $timeout, $compile) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/admin.doc.spec.tpl',
        transclude:true,
        replace:true,
        scope:{doc:'=', spec:'='},
        restrict: 'E',
        link: function(scope, element, attr, ctrl, transcludeFn) {
            scope.doc = scope.$parent.doc_item;

            if ('spec' in attr && 'doc' in scope) {
                scope.doc.snippetIndex = scope.doc.snippets.length || 0;
                title = 'Default';
            }
            console.log(scope.spec);
            scope.doc && scope.doc.snippets.push(scope.spec);
        }
    }
}])
.directive("docSnippet", ['RootService', '$timeout', '$compile', function(RootService, $timeout, $compile) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/admin.doc.snippet.tpl',
        transclude:true,
        replace:true,
        scope:{doc:'='},
        restrict: 'E',
        link: function(scope, element, attr, ctrl, transcludeFn) {
            scope.doc = scope.$parent.doc_item;
            var type = attr.type;
            var text;
            if ('default' in attr && 'doc' in scope) {
                scope.doc.snippetIndex = scope.doc.snippets.length;
                title = 'Default';
            }
            scope.snippet = {
                type: type,
                id: scope.doc.snippets.length,
                text: text || element[0].innerHTML
            }
            if (scope.snippet.type === 'css') {
                scope.snippet.text = scope.snippet.text.replace('<span>', '').replace('}', '\n}').replace('</span>', '').trim();
            }
            scope.doc && scope.doc.snippets.push(scope.snippet);

            // transcludeFn(function(transEl, transScope) {
            //     var preBlock = document.createElement('pre');
            //     preBlock.appendChild(transEl);
            //     element.append(preBlock);
            //     preBlock.firstChild.innerHTML = transEl.contents();
            // });

        }
    }
}])
.directive("docStates", ['RootService', '$timeout', function(RootService, $timeout) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/admin.doc.states.tpl',
        transclude:true,
        replace:true,
        scope:false,
        restrict: 'E',
        link: function(scope, element, attr) {
            scope.doc_item = scope.$parent.doc_item;
            scope.doc = scope.doc_item;
        }
    }
}])
.directive("debug", ['$timeout', 'RootService',  '$compile', 'AdminDebugService', function($timeout, RootService, $compile, AdminDebugService) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/debug.tpl',
        priority: 10,
        restrict: 'E',
        link: {
            pre: function(scope, element, attr) {
                attr.highlight && AdminDebugService.applyHighlight(rootViewElem);
                element.css({height: '10%', position: 'fixed', width: '100%'});
                element[0].firstChild.style.cssText = element[0].style.cssText;
                var rootViewElem = element[0].parentNode;
                var parentScopeName = AdminDebugService.getParentScope(rootViewElem)
                if (parentScopeName) {
                    scope.parent = scope[parentScopeName];
                    scope.parent.name = parentScopeName;
                    scope.debug = {states:[], options: AdminDebugService.processOptions(attr)};
                    console.log(scope.debug.options.toggles);
                    scope.debug.states = AdminDebugService.getAllDebugElems(element[0].parentNode);
                    console.log(scope.debug.states);
                    if (scope.debug.states.length) {
                        scope.debug.options.showToolbar = true && !('hide' in attr);
                    }
                }
                scope.playAllStates = function() {
                    AdminDebugService.playAllStates(scope.debug.states, scope.debug.options, scope);
                }

                scope.playState = function(state) {
                    AdminDebugService.playState(state, scope);
                }

                if ('autoplay' in attr) {
                    element.ready(function() {
                        scope.playAllStates()
                    })
                }
            // AnimToolService.setStage(scope.stage);

            // scope.stage.recorder = AnimToolService.initRecorder(scope.stage, scope);

            // scope.stage.player = AnimToolService.initPlayer(scope.stage);
            // scope.stage.recorder.start(scope.stage.recorder);
            }
        }
    }
}])
.directive("docSnippets", ['RootService', '$timeout', function(RootService, $timeout) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/admin.doc.snippets.tpl',
        transclude:true,
        replace:true,
        scope:false,
        restrict: 'E',
        link: function(scope, element, attr) {
            scope.doc_item = scope.$parent.doc_item;
            scope.doc = scope.doc_item;
            return;
        }
    }
}])

function parsePriority(str) {
    var resultDict = {};
    if (str && str.length) {
        var strArr = str.split('|')
        for (var i = 0; i < strArr.length; i++) {
            var indexPriority = strArr[i];
            if (indexPriority.indexOf(':') > -1) {
                indexPrioritySplit = indexPriority.split(':');
                personName = indexPrioritySplit[0];
                personPriority = parseFloat(indexPrioritySplit[1]);
                resultDict[personName] = personPriority;
            }
            else {
                personName = 'SM';
                personPriority = parseFloat(indexPriority);
                resultDict[personName] = personPriority;
            }
        }
        return resultDict;
    }

}

function updateUserStoriesPriority(parent, story, initial) {
    storiesArr = parent.stories;
    personDict = parent.personDict;
    priority = story.priority;
    for (person in priority) {
        if (!(person in personDict)) {
            personDict[person] = [story];
        } else {
            // personDict[person].push(story);
            personDict[person].sort(sortStoryByPriority(person))
        }

        person_initial = initial || 'SM';
        if (person_initial) {
            if (!('default' in parent.personDict)) {
                parent.personDict['default'] = parent.stories;
            }
            parent.stories = parent.personDict[person];
        }
    }

}

function calcWorkflowProgress(story_arr) {
    var resultDict = {func: 0, total: story_arr.length, cp: 0, responsive:0, tested: 0};
    for (var i = 0; i < story_arr.length; i++) {
        var iStory = story_arr[i];
        if (iStory.progress && iStory.progress.total > 0) {
            resultDict.func += iStory.progress.func;
            resultDict.cp += iStory.progress.cp;
            resultDict.tested += iStory.progress.tested;
            resultDict.responsive += iStory.progress.responsive;
        }
    }
    return resultDict;
}

function sortStoryByPriority(person) {
    return function(story_2, story_1) {
        return (story_2.priority[person] || 100) - (story_1.priority[person] || 100)
    }
}

function calcModuleProgress(workflows) {
    var resultDict = {workflows: { func: 0, total: workflows.length, cp: 0, responsive:0, tested: 0}, states: {}};
    resultDict.states.total = 0;
    resultDict.states.func = {total: 0, complete: 0, bugs: 0};
    resultDict.states.cp = 0;
    resultDict.states.tested = 0;
    resultDict.states.mTested = 0;
    for (var i = 0; i < workflows.length; i++) {
        var iWorkflow = workflows[i];
        if (iWorkflow.func) resultDict.workflows.func += 1;
        if (iWorkflow.tested) resultDict.workflows.tested += 1;
        if (iWorkflow.cp) resultDict.workflows.cp += 1;
        if (iWorkflow.response) resultDict.workflows.responsive += 1;
        iWorkflow.states.forEach(
            function(state, index)
            {
                if (isStateOfType(state, 'func'))  {
                        resultDict.states.func.total += 1;
                    if (state['func']) {
                        resultDict.states.func.complete += 1;
                    }
                    if (state.bugs && state.bugs.length) {
                        state.bugs.forEach(function(bug, index) {
                            if (bug && isStateOfType(bug, 'func')) {
                                resultDict.states.func.bugs += 1;
                            }
                        })
                    }
                }
            }
        )
    }
    console.log(resultDict.states);

    return resultDict;
}

function isStateOfType(state, _type) {
    if (_type === 'func') {
        return ('func' in state || ('type' in state && state['type'] && state['type'].indexOf('func') > -1))
    }
}

function calcStreamProgress(state_arr) {
    var resultDict = {func: 0, total: state_arr.length, cp: 0, responsive:0, tested: 0};
    for (var i = 0; i < state_arr.length; i++) {

        var iState = state_arr[i];
        if (iState.func) resultDict.func += 1;
        if (iState.tested) resultDict.tested += 1;
        if (iState.cp) resultDict.cp += 1;
        if (iState.response) resultDict.responsive += 1;
    }
    return resultDict;
}

function calcStoryProgress(stream_arr) {
    var resultDict = {func: 0, cp: 0, tested: 0, responsive: 0, total: stream_arr.length, states: {total:0, complete:0}};
    for (var i = 0; i < stream_arr.length; i++) {
        var iStream = stream_arr[i];
        if (iStream.progress && iStream.progress.total > 0) {
            resultDict.func += iStream.progress.func;
            resultDict.cp += iStream.progress.cp;
            resultDict.tested += iStream.progress.tested;
            resultDict.responsive += iStream.progress.responsive;
            resultDict.states.total += iStream.states.length;
            resultDict.states.complete += iStream.states.filter(function(s, i) { return s.complete}).length
        }
    }
    return resultDict;
}

function getCommonTagsAndFunc(workflow, attr_tags, person) {
    var resultTags = [];
    var defaultFilterAttr = ['type', 'func', 'cp']
    var activeFilter = workflow.filter.options[workflow.filter.activeIndex];

    if (!activeFilter || (!workflow[activeFilter])) {
        return resultTags;
    }
    var activeFilterArr = workflow[activeFilter]
    for (var i = 0; i < activeFilterArr.length; i++) {
        var iFilterObj = activeFilterArr[i];

        if (!iFilterObj) continue;
        iFilterObj.tags = [];
        //going through type =

        for (var j = 0; j < defaultFilterAttr.length; j++) {
            var iFilterAttr = defaultFilterAttr[j];
            if (iFilterAttr in iFilterObj && (typeof(iFilterObj[iFilterAttr]) === 'boolean' || (iFilterObj[iFilterAttr] && iFilterObj[iFilterAttr].length))) {;
                if (typeof(iFilterObj[iFilterAttr]) === 'string') {
                    var tagAttrSplit = iFilterObj[iFilterAttr].split(',');
                    tagAttrSplit.forEach(function(item, index) {tagAttrSplit[index] = item.replace(' ', '').trim()})
                    for (var k = 0; k < tagAttrSplit.length; k++) {
                        var indexTag = tagAttrSplit[k];
                        var tagDict=  {};
                        tagDict[iFilterAttr] = indexTag;
                        tagDict['kvStr'] = iFilterAttr + '|' + iFilterObj[iFilterAttr];
                        resultTags.push(tagDict);
                        iFilterObj.tags.push(tagDict)
                    }

                } else if (typeof(iFilterObj[iFilterAttr]) === 'boolean') {
                    var tagDict=  {};
                    tagDict[iFilterAttr] = iFilterObj[iFilterAttr];
                    tagDict['kvStr'] = iFilterAttr + '|' + iFilterObj[iFilterAttr];
                    resultTags.push(tagDict);
                    iFilterObj.tags.push(tagDict);
                }
            }
        }
        iFilterObj.stringTags = iFilterObj.tags.splice().forEach(function(tag, index) {tag = tag.kvStr});
    }
    resultDict = {};
    resultTags.forEach(function(tag_dict, index) {
        if (!tag_dict) {return}
        var key = Object.keys(tag_dict)[0];
        var strKey = Object.keys(tag_dict)[1];

        var kvStr = tag_dict[strKey];
        var tag_value = tag_dict[key] + '';

        if (key in resultDict) {
            if (!(tag_value in resultDict[key])) {
                resultDict[key][tag_value] = {count:1, kvStr:kvStr};
            } else {
                resultDict[key][tag_value].count += 1;
            }
        } else {
            resultDict[key] = {};
            resultDict[key][tag_value] = {count: 1, kvStr:kvStr};
        }
    })
    resultArr = [];

    for (key in resultDict) {
        for (nested_key in resultDict[key]) {
            resultArr.push({name: key, value: nested_key, kvStr: resultDict[key][nested_key].kvStr, count: resultDict[key][nested_key].count, active:false})
        }
    }
    return resultArr;
}

angular.module('uguru.admin')
.directive("timelineTool", ['$timeout', 'RootService', 'TimelineService', function($timeout, RootService, TimelineService) {
    return {
        templateUrl: RootService.getBaseUrl() + 'admin/templates/components/timeline.player.tpl',
        restrict: 'E',
        scope: {animations:'=animations', options: '=options'},
        replace: true,
        terminal: true,
        link: function(scope, element, attr) {
            element.ready(function() {
                scope.animations = scope.animations.filter(function(a, i) {return a.duration !== '0s'});
                // scope.animations.forEach(function(a, i) {console.log(scope.animations[i])});
                scope.animations = TimelineService.initAnimations(scope.animations);
                scope.tPlayer = {};
                scope.tPlayer.state = scope.animations.length && TimelineService.initGlobalPlayer(scope.options, scope.animations[0].env, scope.animations);
                scope.tPlayer.play = TimelineService.func.playAll(scope.tPlayer.state);
                scope.tPlayer.playOne = TimelineService.func.play;
                scope.tPlayer.pause = TimelineService.func.pauseAll(scope.tPlayer.state);
                scope.tPlayer.pauseOne = TimelineService.func.pause;
                scope.tPlayer.reset = TimelineService.func.resetAll;
                scope.tPlayer.resetOne = TimelineService.func.reset;
                scope.tPlayer.jump = TimelineService.func.jumpAll(scope.tPlayer.state);

                scope.tPlayer.state.duration = scope.animations.length && scope.animations[0].env.duration;

                // scope.$watch('tPlayer.state.jumpDirection', function(direction) {

                //     if (['reverse', 'normal'].indexOf(direction) > -1) {

                //         scope.tPlayer.jump(scope.animations, scope.tPlayer.state);
                //     }

                // })


                scope.tPlayer.state.offsetStr = "0.0";
                // scope.animations.forEach(function(a, i) {a.events.start(); a.events.end()})
                // scope.tPlayer.pause(scope.animations);
            })

        }
    }
}])
.directive('timelineInspector', ['RootService', 'TimelineService', '$timeout', '$compile', function(RootService, TimelineService, $timeout, $compile) {
  return {
    restrict: 'E',
    replace: true,
    templateUrl: TimelineService.getAnimatableTemplateFunc,
    scope: {
        template: '@template',
        speed: '@speed',
        duration: '@duration',
        play: '@play',
        pause: '@pause',
        _import: '@import'
    },
    link: {
      pre: function(scope, element, attr) {
        scope.root = scope.$parent.root;
        attr.$set('timeline-inspector', '');
        scope.timeline = {listeners: {}};
        scope.window = scope.$parent.root.window;
        scope.animations = [];
        scope.animLookupDict = {};

        var browserPrefix = RootService.getBrowserPrefix();
        scope.timeline.listeners = {
            start: TimelineService.getAnimationStartListener(scope, browserPrefix, element[0]),
            end: TimelineService.getAnimationEndListener(scope, browserPrefix, element[0])
        }

        var cb = function(element) {
            $compile(element)(scope);
            $timeout(function() {
                scope.$apply();
            })
        }

        // var startListener = scope.timeline.listeners.start();
        // var endListener = scope.timeline.listeners.end();

        scope.options = {
            play: attr.play,
            speed: attr.speed,
            template: attr.template,
            import: attr.import,
            direction: attr.direction,
            duration: attr.duration,
            delay: '0s',
            expand: attr.expand,
            tabIndex: 0
        }

        element.ready(function() {
            $timeout(function() {
                scope.animations = TimelineService.processAnimations(scope, element);
                injectAnimationWithPlayer(scope.animations, element, cb, scope.window, scope.options);
            }, 200)




        })

      }
    }
  }
}])
.directive("timelinePlayer", ['$timeout', 'RootService', 'TimelineService', function($timeout, RootService, TimelineService) {
    return {
        templateUrl:'admin/templates/components/timeline.playbar.tpl',
        restrict: 'E',
        scope: {points:'=points', state: '=state'},
        replace: true,
        terminal: true,
        link: {
            pre: function(scope, element, attr) {
                var bgElem = element.children()[1];
                var bgElemCoords = bgElem.getBoundingClientRect();
                var progressElem = element.children()[0];
                scope.state.initialTransitionSet;
                scope.state.progressElem = progressElem;


                // scope.jumpTo = TimelineService.jumpTo(scope.state, progressElem, bgElemCoords);

                // scope.$watch('state.play', function(play_status) {
                //     if (play_status === true) {
                //         if (!scope.state.initialTransitionSet) {
                //             angular.element(progressElem).css('transition', 'width ' + scope.state.duration + 'ms linear');
                //             scope.state.initialTransitionSet = true;
                //         }
                //         document.querySelector('svg rect').setAttribute('width', '100%')
                //         progressElem.setAttribute('width', '100%');
                //     } else  if (play_status === false && scope.state.initialTransitionSet){
                //         var progressElemRect = progressElem.getBoundingClientRect()
                //         var percentComplete = ((progressElemRect.width/bgElemCoords.width)).toFixed(4);

                //         progressElem.setAttribute('width', (percentComplete * 100) + '%');
                //         var durationRemaining = (scope.state.duration * (1-percentComplete));
                //         angular.element(progressElem).css('transition', 'width ' + durationRemaining + 'ms linear' );

                //     }
                // });
                // scope.$watch('state.complete', function(is_complete) {
                //     if (is_complete) {
                //         var origTransition = angular.element(progressElem).css('transition');
                //         console.log(origTransition);
                //         angular.element(progressElem).css('transition', 'width ' + '400ms linear' );
                //         progressElem.setAttribute('width','0%');
                //         is_complete = false;
                //         scope.state.scaleOffset = 10;
                //         scope.state.timer.reset(scope.state)

                //         $timeout(function() {
                //             scope.state.scaleOffset = 1;
                //             scope.state.initialTransitionSet = false;
                //             // scope.state.play = false;
                //         }, 400)
                //     }
                // })
            }
        }
    }
}])

function injectAnimationWithPlayer(animations, elem, cb, _window, options) {
        var elemCoords = elem[0].getBoundingClientRect();
        elemCoords.height = elemCoords.height/10.0;
        elemCoords.width =  elemCoords.width/10.0;
        var dx = Math.abs(elemCoords.width - _window.width);
        var dy = Math.abs(elemCoords.height - _window.height);

        div = document.createElement('div');
        div.innerHTML = '<timeline-tool animations=animations options=options></timeline-tool>'
        div.style.zIndex = 100000;

        if (dx/_window.width < 0.1) {
          div.classList.add('bottom-0', 'left-0', 'full-x', 'fixed');
          var elem = document.querySelector('ui-view');
          elem.appendChild(div);
        } else {
          div.classList.add('relative', 'animated', 'slideInUp');
          elem[0].parentNode.appendChild(div);
        }
        cb && cb(div);
    }





function getAnimationStartListener(scope, browser, element) {
      return function(cb) {

        var startAnimationEvent = browser + 'animationStart';

        if (browser && browser.length) {
          startAnimationEvent = browser + 'AnimationStart';
        }
        return element.addEventListener(startAnimationEvent, function(e) {
            scope.animations.push({
                target: e.target,
                timeStamp: e.timeStamp,
                type: e.type,
                animation: {name: e.animationName, obj: scope.getAnimationFromName(e.animationName)}
            })
            e.target.style[browser.toLowerCase() + 'AnimationPlayState'] = 'paused';

            var duration = (e.target.style[browser.toLowerCase() + 'AnimationDuration'].split('ms')[0] / 10) + 'ms';
            e.target.style[browser.toLowerCase() + 'AnimationDuration'] = duration;
            e.target.style[browser.toLowerCase() + 'AnimationPlayState'] = 'running';
            cb && cb(e);
        })
      }
    }

function getAnimationEndListener(scope, browser, element) {

    return function(cb) {
    var startAnimationEvent = 'animationEnd';
    if (browser && browser.length) {
      startAnimationEvent = browser + 'AnimationEnd';
    }
    return element.addEventListener(startAnimationEvent, function(e) {
        cb && cb();

        if (browser) {
          console.log('pausing');
          e.target.style[browser + 'AnimationPlayState'] = 'paused';
        } else {
          e.target.style['animationPlayState'] = 'paused';
        }
        e.target.style.offsetWidth = e.target.style.offsetWidth;
        console.log('animation ending', e.target);
       })
    }
}
angular
.module('uguru.admin')
.factory('TimelineService', [
    '$timeout',
    'RootService',
    'AnimationService',
    'UtilitiesService',
    '$interval',
     TimelineService
]);
function TimelineService($timeout, RootService, AnimationService, UtilitiesService, $interval) {
  var browserPrefix = RootService.getBrowserPrefix();
  var func = getAnimationFunctions();
  var animationFunc;
  return {
    injectAnimationWithPlayer: injectAnimationWithPlayer,
    getAnimationStartListener: getAnimationStartListener,
    getAnimationEndListener: getAnimationEndListener,
    getAnimatableTemplateFunc: getAnimatableTemplateFunc,
    getAnimationObjFromName: getAnimationObjFromName,
    initGlobalPlayer: initGlobalPlayer,
    processStyleAnimations: processStyleAnimations,
    processAnimations: processAnimations,
    changeStateAll:changeStateAll,
    func: func,
    jumpTo:jumpTo,
    initAnimations: initAnimations
  }



  function initAnimations(animations) {
      var prefix = 'animation';
      var browserPrefix = RootService.getBrowserPrefix();
      if (browserPrefix && browserPrefix.length)  {
          prefix = browserPrefix + 'Animation';
      }



    animations.forEach(function(a, i) {
        var properties = ['Name', 'Duration',  'TimingFunction', 'Delay', 'IterationCount',  'Direction', 'FillMode', 'PlayState']
        var animationCSS = window.getComputedStyle(a.element)[prefix];
        if (animationCSS && animationCSS.split(' ').length >= 8) {
            a.css = {};
            a.css = {orig: {}, cache: {}};
            var elemAnims = animationCSS.split(', ');
            properties.forEach(function(prop, j) {
                propArr = [];
                elemAnims.forEach(function(str, k) {propArr.push(str.split(' ')[j]) });
                a.css.orig[prefix+prop] = propArr.join(', ');
                a.css.cache[prefix+prop] = propArr.join(', ');
            })
        }
    });
    console.log(animations);
    return animations;
  }

  function initGlobalPlayer(attr, env, animations) {
    var duration = env && env.duration;
    var resultDict = {
      duration: duration,
      play: attr.play === "true" || false,
      speed:  formatSpeedFromAttr(parseFloat(attr.speed && attr.speed.replace('x', ''))),
      offset: 0,
      template: attr.import,
      import: attr.template,
      fillMode: 'forwards',
      direction: 'normal',
      timer: {reset: resetTimer},
      iterCount :1,
      jumpToScale:5,
      scaleOffset: 1,
      timeInterval: 100,
      complete: false,
      animStats: {
        total: animations.length,
        active: 0
      }
    }
    resultDict.fDuration = formatDurationAllTypes(resultDict.duration)


    // applyPlayerDefaultSettings(animations);
    initAnimationDefaults(animations, resultDict);
    if (resultDict.play) {
      var prefix = (browserPrefix && browserPrefix + 'Animation') || 'animation' ;
      $timeout(function() {
        // resultDict.play = true;
        // changeStateAll(prefix+'PlayState', animations, 'running');
      })
    }
    return resultDict;


    // var latestAnimation = animations.sort(function(a1, a2) {a2.timeStamp - a1.timeStamp}).reverse()[0];
  }



  function initAnimationDefaults(animations, state) {

    var startAnimationEvent = browserPrefix + 'animationStart';
      if (browserPrefix && browserPrefix.length) {
        startAnimationEvent = browserPrefix + 'AnimationStart';
      }

    var prefix = 'animation';
      if (browserPrefix && browserPrefix.length)  {
        prefix = browserPrefix + 'Animation'
      }
    var elements = [];
    animations.forEach(function(a, i) {if (elements.indexOf(a.element) === -1) {elements.push(a.element)}})

    elements.forEach(function(e, j){
      var eAnimationStyle = window.getComputedStyle(e)[prefix];
      var eAnimations = [];
      animations.forEach(function(anim, k) {if (anim.element === e) eAnimations.push(anim)});
      eAnimations.forEach(function(anim, k) {
        anim.events = {
          start: getStartListener(anim, e),
          end: getEndListener(anim, e),
          listeners: {}
        };

        console.log('starting listener', window.getComputedStyle(e)['webkitAnimation']);
        eAnimationStyleNames = UtilitiesService.replaceAll(eAnimationStyle, 'paused, ', 'paused ');
        eAnimationStyleNames = UtilitiesService.replaceAll(eAnimationStyleNames, 'running, ', 'running ');
        eAnimationStyleNames = UtilitiesService.replaceAll(eAnimationStyleNames, 'running ', 'paused ');
        var animStyleArrIndex = eAnimationStyleNames.split(' ').indexOf(anim.name);
        var remainingForward = eAnimationStyleNames.split(anim.name + ' ')[1];
        var remainingStyle = anim.name + ' ' + remainingForward.split(' paused')[0] + ' paused';
        var properties = ['Name', 'Duration',  'TimingFunction', 'Delay', 'IterationCount',  'Direction', 'FillMode', 'PlayState']
        var styleAnimArr = UtilitiesService.replaceAll(remainingStyle, ', ', ',').split(' ');
        styleAnimArr.forEach(function(animProp, ai) {
          var property = prefix + properties[ai];
          value = ai;
          anim.css[property] = animProp;
        })
      })
    })
    console.log(elements);
    // console.log(animations);


    function getStartListener(anim, elem) {
      var startAnimationEvent = browserPrefix + 'animationStart';
      if (browserPrefix && browserPrefix.length) {
        startAnimationEvent = browserPrefix + 'AnimationStart';
      }
      console.log(startAnimationEvent)
      return function() {

        anim.events.listeners.startFunc =  function(e) {
          console.log(e.animationName, 'has started', anim.css);

          anim.active = true;
          elem.removeEventListener(startAnimationEvent, anim.events.listeners.startFunc);
        }
        elem.addEventListener(startAnimationEvent, anim.events.listeners.startFunc);
      }

    }
    function getEndListener(anim, elem) {
      var startAnimationEvent = browserPrefix + 'animationEnd';
      if (browserPrefix && browserPrefix.length) {
        startAnimationEvent = browserPrefix + 'AnimationEnd';
      }
      return function() {
        anim.events.listeners.endFunc = elem.addEventListener(startAnimationEvent, function(e) {
          // console.log(e.animationName, 'has ended', anim.css);
          // changeState(anim.prefix + "PlayState", anim, "paused");
          // changeState(anim.prefix + "Name", anim, "");
          // changeState(anim.prefix + "Name", anim, anim.css.name);
          state.complete = true;
          var prefix = 'animation';
          if (browserPrefix && browserPrefix.length)  {
            prefix = browserPrefix + 'Animation'
          }

          // changeState(anim, 'Name', '');

          if (anim.resetAfter && !anim.midReset) {

            // $timeout(function() {
            //   anim.reset();
            // }, 100)

            if (anim.isLast) {

              state.play = false;
            }
          }
          elem.removeEventListener(startAnimationEvent, anim.events.listeners.endFunc);

        });
        elem.addEventListener(startAnimationEvent, anim.events.listeners.endFunc);
      }

    }
  }

  // function applyPlayerDefaultSettings(state, animation) {
  //   state.offset = 1;
  //   if (state.offset) {

  //   }
  // }

  function jumpTo(state, progress_elem, bg_elem_coords) {
    return function($event)  {
      var e = $event;
      var newWidth = $event.clientX - 20;
      var percentPlaybarOffset = parseFloat(((($event.clientX - 20) / bg_elem_coords.width)).toFixed(4));

      //calculate percent of bar changed
      currentWidth = progress_elem.getBoundingClientRect().width;
      progressTranslateXChange = Math.abs((newWidth - currentWidth)/bg_elem_coords.width);



      scaledTransitionTime = parseFloat((progressTranslateXChange * state.duration).toFixed(4));

      // state.offset = (newWidth/bg_elem_coords.width).toFixed(4) * state.duration;


      var timerDuration = scaledTransitionTime/state.jumpToScale;
      angular.element(progress_elem).css('transition', 'width ' + timerDuration + 'ms linear' );

      progress_elem.setAttribute('width', percentPlaybarOffset * 100 + '%');




      var interval = state.timeInterval / state.jumpToScale;
      state.scaleOffset =  state.jumpToScale;
      state.jumpOffset = timerDuration;


      // state.play = true;
      state.jumpDirection = 'normal';
      if (currentWidth > newWidth) {
        state.jumpDirection = "reverse";
        console.log(state.jumpDirection);
      }

      console.log(state, state.offset, state.jumpDirection, interval)
      startTimer(state, state.offset, state.jumpDirection, interval);

      $timeout(function() {
        state.scaleOffset = 1;
        state.jumpOffset = null;
        state.jumpDirection = null;
        pauseTimer(state, interval);
        var timerDuration = scaledTransitionTime/state.jumpToScale;
        initialTransitionSet = false;
      }, timerDuration)

      // console.log('new width', percentPlaybarOffset)
      // console.log('percent change', progressTranslateXChange);
      // console.log('direction', state.jump);

      // console.log(durationRemaining);
      // angular.element(progressElem).css('transition', 'width ' + durationRemaining + 'ms linear' );

    }
  }

  function formatSpeedFromAttr(speed) {
    if (!speed || !speed.length) {
      return '1x';
    } else {
      return parseFloat(speed.replace('x', '')).toFixed(1);
    }
  }

  function formatDurationAllTypes(duration) {
    sDuration = (duration/1000).toFixed(1);
    return {
      ms: {
        number: duration,
        str: duration + 'ms'
      },
      s: {
        number: parseFloat(sDuration),
        str: sDuration + 's'
      }
    }
  }

  function parseStartAt(str_start) {
    if (str_start && str_start.split('ms').length === 1) {
      return str_start + 'ms';
    }
    return str_start;
  }

  function parseDuration(str_duration) {
    if (str_duration && str_duration.split('ms').length === 1) {
      return str_duration + 'ms';
    } else if (str_duration && str_duration.split('s').length > 1) {
      var strValue = parseFloat(str_duration.split('s')[0]) + '000ms';
      return strValue;
    }
    return str_duration;
  }

  function changeStateAll(property, animations, value, state) {
    animations.forEach(function(a, i) {changeState(property, animations[i], value, state)});
  }

  function changeStateJumpAll(property, animations, state) {
    console.log(state.jumpDirection);
      var deltaOffset = state.jumpOffset * state.scaleOffset;

      // animations = animations.splice(0, 1);
      // $timeout(function() {

      //   console.log(animations[0].name, isJumpValid);
      // }, 1000)

      // console.log(animations);
      // console.log('jumping', animations.length, 'animations')
      // console.log('jump offset', state.jumpOffset)
      // console.log('jump direction', state.jumpDirection);
    // $timeout(function() {

      // var isJumpValid = isJumpValidForAnimation(state, animations[0]);
      var validAnimations = animations.filter(function(a, i) {return isJumpValidForAnimation(state, a)})
    // }, 500)
      var jumpObj = {scale: state.scaleOffset, direction:state.jumpDirection, duration: state.jumpOffset * state.scaleOffset, start: state.offset, end: state.offset + (state.jumpOffset * state.scaleOffset)}
      // if (state.offset < state.lastOffset) {
      //   jumpObj.end = state.offset - (state.jumpOffset * state.scaleOffset);
      // }
      console.log(validAnimations);
      validAnimations.forEach(function(a, i) {changeStateJump(validAnimations[i], jumpObj)});
  }

  function isJumpValidForAnimation(state, animation) {

    // var offsetDiff = state.offset - state.lastOffset;
    animTLObj = getAnimationTimelineObj(animation);
    var TLObj = getPlayerTimelineObj(state)
    // console.log(state.lastOffset, state.offset);
    // console.log('\n');
    // console.log(animation)
    // console.log(animTLObj.start, animTLObj.end);
    // console.log(TLObj.start, TLObj.end);
    // console.log('\n');
    // forward direction

    if (Math.abs(TLObj.end - TLObj.start) <= Math.abs(animTLObj.end - animTLObj.start) && ((animTLObj.start <= TLObj.start && animTLObj.end <= animTLObj.start))) {
      return true;
    }
    if ( (TLObj.end - TLObj.start) >= 0 && ((TLObj.start <= animTLObj.start && animTLObj.start <= TLObj.end) || (TLObj.start <= animTLObj.end && animTLObj.end <= TLObj.end))) {

      return true;
    }
    if ( (TLObj.end - TLObj.start) < 0 && ((TLObj.start >= animTLObj.start && animTLObj.start >= TLObj.end) || (TLObj.start >= animTLObj.end && animTLObj.end >= TLObj.end))) {
      return true;
    }


    return false;
  }

  function getPlayerTimelineObj(state) {
    var deltaOffset = state.jumpOffset * state.scaleOffset;
    if (state.jumpDirection === 'reverse') {
      deltaOffset *= -1;
    }

    var resultDict = {start: state.offset, end: state.offset + deltaOffset, direction: 'normal'};
    // console.log(resultDict);

    if (resultDict.end - resultDict.start < 0) {
      resultDict.direction = 'reverse'
    }
    return resultDict;
  }

  function getAnimationTimelineObj(animation) {
    var animStartMS = durationToMS(animation.delay);
    var animEndMS = durationToMS(animation.duration) + animStartMS;
    return {
      start: animStartMS,
      end: animEndMS,
      direction: animation.direction
    }
  }


  function getAnimationFunctions(state) {
    var prefix = 'animation';
    if (browserPrefix && browserPrefix.length)  {
      prefix = browserPrefix + 'Animation'
    }
    return {
      play: function(animation) {return changeState(prefix + "PlayState", animation, "running")},
      pause: function(animation) {return changeState(prefix + "PlayState", animation, "paused")},
      reset: function(animation) {return changeState(prefix+"Reset", animations)},
      jump: function(animation, state) {return changeStateJump(prefix+"Reset", animations)},
      playAll: function(state) {return function(animations) {startTimer(state); return changeStateAll(prefix + "PlayState", animations, "running")}},
      pauseAll: function(state) {return function(animations) {pauseTimer(state); return changeStateAll(prefix + "PlayState", animations, "paused")}},
      jumpAll: function(state) {return function(animations) {return changeStateJumpAll(prefix + "Jump", animations, state)}},
      resetAll: function(animations, state) {return changeStateAll(prefix+"Reset", animations, "paused", state)}
    }
  }

  function resetTimer(state) {
    startTimer(state, state.duration, 'reverse', 10)
  }

  function startTimer(state, start_point, direction, interval, cb) {
    state.lastOffset = state.offset;
    start_point = start_point || state.lastOffset || 0;
    state.offset = start_point;
    if (direction && direction === 'reverse') {
      state.increment = false;
    } else {
      state.increment = true;
    }
    interval = interval || state.timeInterval;
    state.startIntervalPromise = $interval(
      function(){
        if (state.increment) {
          state.offset += (interval *state.scaleOffset);
        } else {
          state.offset -= (interval *state.scaleOffset);
        }
        state.offsetStr = (state.offset/1000).toFixed(1) + '';
        if ((state.offset + interval) > state.duration || state.offset < 0) {
          $timeout(function() {
            pauseTimer(state);
            if (state.offset > 0) {
              state.offset = state.duration;
            }
            if (state.offset <= 0) {
              state.offset = 0;
            }

            state.offsetStr = (state.offset/1000).toFixed(1) + '';


            // state.play = false;
            // state.reset = true;
            // $timeout(function() {
            //   state.reset = false;
            // })
          }, (state.offset + interval - state.duration))
        }
      }, interval
    )
  }

  function pauseTimer(state) {

    $interval.cancel(state.startIntervalPromise);
  }

  function processAnimations(scope,element) {
    var prefix = 'animation';
    if (browserPrefix && browserPrefix.length)  {
      prefix = browserPrefix + 'Animation'
    }
    var allElements = element[0].querySelectorAll("*");

    var timelineDict = {transitions: [], animations:[]};
    var classDict = {};
    var animations = [];
    var elementsWithAnimations = [];
    var count = 0;
    var maxDict = {duration: 0, delay:0, animation: null};;
    for (var i = -1; i < allElements.length; i++) {
      var indexChild = ((i >= 0) && allElements[i]) ||element[0];
      var indexChildClass = indexChild.classList;
      var animationProps = getAnimationObj(browserPrefix, indexChild);
      if (animationProps) {
        elementsWithAnimations.push(indexChild);
        var firstKey = Object.keys(animationProps)[0];
        var animationSplit = UtilitiesService.replaceAll(animationProps[firstKey], ', ', ',').split(',');
        for (var j = 0; j < animationSplit.length; j++) {
          var animDict = [];
          for (key in animationProps) {
            animDict[key] = UtilitiesService.replaceAll(animationProps[key], ', ', ',').split(',')[j];
            var animObj = initAnimationObj(animDict, indexChild, browserPrefix)
            if (animObj.duration && animObj.name && animObj.delay) {
              var durationParsed = parseFloat(parseDuration(animObj.duration));
              var delayParsed = parseFloat(parseDuration(animObj.delay));
              if ((delayParsed + durationParsed) > (maxDict.delay + maxDict.duration)) {
                maxDict.delay = delayParsed;
                maxDict.duration = durationParsed;
                maxDict.animation = animObj;
              }
              if (!(animObj.name in scope.animLookupDict) || scope.animLookupDict[animObj.name].indexOf(indexChild) === -1) {
                  if (!(animObj.name in scope.animLookupDict)) {
                    scope.animLookupDict[animObj.name] = [indexChild];
                  } else {
                    scope.animLookupDict[animObj.name].push(indexChild);
                  }

                  animations.push(animObj)
              }
            }
          }
        }
      }
    }
    var totalLengthMS = durationToMS(maxDict.delay + maxDict.duration + 's');
    // maxDict.animation.isLast = true;
    animations = animations.filter(function(a, i) { return window.getComputedStyle(a.element)['webkitAnimation'].split(' ')[1] !== '0s' })

    animations.forEach(
      function(anim, index) {
        var durationMS = durationToMS(anim.duration);
        var delayMS = durationToMS(anim.delay);
        anim.prefix = prefix;
        anim.css = {};
        anim.set = getAnimationSetFunc(anim);
        anim.env = {
          id: index + 1,
          duration: totalLengthMS,
          xLeft: parseFloat((delayMS/totalLengthMS * 100 ).toFixed(4)),
          width: parseFloat(((durationMS/totalLengthMS) * 100).toFixed(4)),
          collapsed: false,
          active: true,
          tabIndex:0,
          startAt:'50ms',
          endAt: '1s',
          fillModeOptions: ['forwards', 'none', 'backwards', 'both'],
          directionOptions: ['forwards', 'none', 'backwards', 'both'],
        }
        anim.bp = {points: null, add: null, remove:null};
        anim.bp.points = [{time:0, name:'@start'}, {time:0, name:'@end'}];
        anim.bp.add = addAnimationBreakpoint;
        anim.bp.remove = removeAnimationBreakpoint;

        anim.keys = {};
        anim.keys.templates = []
        anim.keys.frames = [{percent: '%0', properties:[]}];
        anim.keys.addFrame = addAnimationKeyframe,
        anim.keys.removeFrame = removeAnimationKeyframe;

        anim.easings = {};
        anim.reset = resetAnimationFunc(anim);
        anim.easings.options = [];
        anim.easings.createTemplate = function () {};
      }
    )
    return animations;

  }

  function getAnimationSetFunc(animation) {
    return function(property, value) {

      setAnimationFunc(animation, property, value)

    }
  }
  function setAnimationFunc(animation, property, value) {
    changeState(animation.prefix + property, animation, value)
  }

  function removeAnimationKeyframe() {
    return function() {

    }
  }

  function addAnimationKeyframe() {
    return function() {

    }
  }

  function removeAnimationBreakpoint() {
    return function() {

    }
  }

  function addAnimationBreakpoint(anim) {
    return function() {

    }
  }

  function durationToMS(str_duration) {
    if (str_duration.indexOf('ms') > -1) {
      return parseFloat(str_duration.replace('ms', ''));
    } else if (str_duration.indexOf('s') > -1) {
      return parseFloat(str_duration.replace('ms', '')) * 1000;
    }
  }

  function getAnimationCssCache(animation, property) {
    if (property in animation.css) {
      return animation.css[property]
    }
  }

  function changeStateJump(animation, jump_info) {
    var prefix = 'animation';
    if (browserPrefix && browserPrefix.length)  {
      prefix = browserPrefix + 'Animation'
    }
    var ji = jump_info;

    ji.pauseIn = ji.duration/ji.scale;

    var msDuration = durationToMS(animation.duration);
    var msDelay = durationToMS(getAnimationCssCache(animation, prefix+'Delay') || animation.delay)
    var msScaledDuration = msDuration/ji.scale + 'ms';
    var msScaledDelay = msDelay/ji.scale + 'ms';
    // console.log('jump animation', animation.name, 'start:' + msScaledDelay, 'end:' + msScaledDuration + msScaledDelay, 'will stop at', ji.pauseIn);

    changeState(prefix + "PlayState", animation, "paused");




    if (ji.direction === 'reverse') {
        changeState(prefix + "Delay", animation, Math.abs((msDuration - msDelay)/ji.scale) * -1);
        changeState(prefix + "Direction", animation, "reverse");
        changeState(prefix + "Duration", animation, msScaledDuration);
    } else {
        changeState(prefix + "Delay", animation, msScaledDelay);
        changeState(prefix + "Direction", animation, "normal");
        changeState(prefix + "Duration", animation, msScaledDuration);
    }



    // console.log('setting delay to...', msScaledDelay);



    changeState(prefix + "PlayState", animation, "running");

    $timeout(function() {
      //

    // console.log(getAnimationProperty(animation, prefix+"Direction"));


      changeState(prefix + "PlayState", animation, "paused");
        if (ji.direction === 'reverse') {
          changeState(prefix + "Direction", animation, "normal");
        }


      changeState(prefix + "Duration", animation, msDuration + 'ms');



      var elapsedDelay = parseFloat((ji.end - msDelay).toFixed(1));


      // if (elapsedDelay > msDuration) {
      //   console.log(animation.name, 'has completed');
      //   //TODO --> set everything back to initial once complete

      //   changeState(prefix + "Delay", animation,  animation.delay);
      //   console.log('Restored delay', animation.name, window.getComputedStyle(animation.element)[prefix + 'Delay']);
      // } else

      if (elapsedDelay < msDuration && msDelay > ji.start) {
        elapsedDelay = '-' + elapsedDelay + 'ms';
        changeState(prefix + "Delay", animation, elapsedDelay);
      } //else {
        //changeState(prefix + "Delay", animation, animation.delay);
      //}

      console.log(animation.name, animation.duration, animation.delay, elapsedDelay, animation);
      }, ji.pauseIn)

  }

  function getAnimationFillMode(animation, fill_prop) {
    if (animation.fillMode !== animation.css[fill_prop] && fill_prop in animation.css && animation.css[fill_prop].length) {
      return animation.css[fill_prop]
    } else {
      return animation.fillMode
    }
  }

  function changeState(property, animation, value, state) {

    parsedProperty = (property +"").toLowerCase().replace('webkit', '').replace(browserPrefix, '').replace('animation', '')
    switch(parsedProperty) {
      case ("direction"):
        applyAnimationProperty(animation, property, value);
        break;
      case ("delay"):
        applyAnimationProperty(animation, property, value);
        break
      case ("fillmode"):
        applyAnimationProperty(animation, property, value);
        break
      case ("timingfunction"):
        applyAnimationProperty(animation, property, value);
        break
      case ("duration"):
        applyAnimationProperty(animation, property, value);
        break
      case ("playstate"):
          console.log('it gets here', animation, property, value)
          applyAnimationProperty(animation, property, value);
        break;
      case ("name"):
        applyAnimationProperty(animation, property, value);
        break;
      case ("reset"):
        animation.reset();
        break;

    }
  }

  function applyAnimationProperty(animation, property, value) {
    console.log(animation, property)
    var currentValue = getAnimationProperty(animation, property);
    if (currentValue && currentValue.split(',').length > 1) {
      console.log('\nattempting to apply', animation.name, property, 'from', currentValue, 'to', value);
      console.log('value before:' + currentValue);
      value = getIndexValue(animation, property, currentValue, value);
      console.log('value proposed:' + value);
    }
    // console.log(value);
    console.log('before', window.getComputedStyle(animation.element)['webkitAnimation']);
    $timeout(function() {
      animation.element.style[property] = value;
      console.log(animation);
      console.log('after', window.getComputedStyle(animation.element)['webkitAnimation']);
    })


    // animation.css[property] = value;

    return value
    // if (currentValue) {
    //   var currentValue = getAnimationProperty(animation, property);
    //   // console.log('value after:' + currentValue, '\n');
    // }
  }

  function getIndexValue(animation, property, current, future) {
    var prefix = 'animation';
    if (browserPrefix && browserPrefix.length)  {
      prefix = browserPrefix + 'Animation'
    }
    var currentValueName = getAnimationProperty(animation, prefix + 'Name');
    var cvSplitName = currentValueName.split(', ');
    var indexName = cvSplitName.indexOf(animation.name);


    var valueSplit = current.split(', ');
    valueSplit[indexName] = future;

    return valueSplit.join(', ');
  }

  function getAnimationProperty(animation, property) {
    parsedProperty = (property +"").toLowerCase().replace('webkit', '').replace(browserPrefix, '').replace('animation', '');
    value = animation.element.style[property];
    if (!value) {
      return window.getComputedStyle(animation.element)[property];
    }
    return value;
  }

  function getStyleWithCSSSelector(cssSelector) {
      var styleSheets = window.document.styleSheets;
      var styleSheetsLength = styleSheets.length;
      var arStylesWithCSSSelector = [];

      //in order to not find class which has the current name as prefix
      var arValidCharsAfterCssSelector = [" ", ".", ",", "#",">","+",":","["];

      //loop through all the stylessheets in the bor
      for(var i = 0; i < styleSheetsLength; i++){
          var classes = styleSheets[i].rules || styleSheets[i].cssRules;
          var classesLength = classes.length;
          for (var x = 0; x < classesLength; x++) {
              //check for any reference to the class in the selector string
              if(typeof classes[x].selectorText != "undefined"){
                  var matchClass = false;

                  if(classes[x].selectorText === cssSelector){//exact match
                      matchClass=true;
                  }else {//check for it as part of the selector string
                      //TODO: Optimize with regexp
                      for (var j=0;j<arValidCharsAfterCssSelector.length; j++){
                          var cssSelectorWithNextChar = cssSelector+ arValidCharsAfterCssSelector[j];

                          if(classes[x].selectorText.indexOf(cssSelectorWithNextChar)!=-1){
                              matchClass=true;
                              //break out of for-loop
                              break;
                          }
                      }
                  }

                  if(matchClass === true){
                      //console.log("Found "+ cssSelectorWithNextChar + " in css class definition " + classes[x].selectorText);
                      var styleDefinition;
                      if(classes[x].cssText){
                          styleDefinition = classes[x].cssText;
                      } else {
                          styleDefinition = classes[x].style.cssText;
                      }
                      if(styleDefinition.indexOf(classes[x].selectorText) == -1){
                          styleDefinition = classes[x].selectorText + "{" + styleDefinition + "}";
                      }
                      arStylesWithCSSSelector.push({"selectorText":classes[x].selectorText, "styleDefinition":styleDefinition});
                  }
              }
          }
      }
      if(arStylesWithCSSSelector.length==0) {
          return null;
      }else {
          return arStylesWithCSSSelector;
      }
  }

  function initAnimationObj(css_dict, element, browser) {
      var mappingDict = {timingfunction:'timingFunc', fillmode: 'fill', iterationcount: 'iterCount'}
      browser = browser || ''

     var cssColumns = Object.keys(css_dict)
     var animation = {
        element: element,
        css: css_dict,
        resetAfter: true,
        isLast: false,
        reset: null,
        resetParentTimeline: null
      }
      // animation.reset = resetAnimationFunc(animation)
      // animation.play = playAnimationFunc(animation);
      // animation.pause = pauseAnimationFunc(animation);
      // animation.set = setAnimationFunc(animation);
      for (key in css_dict) {
        var shortKey = (key + "").replace(browser, '').replace('Animation', '').replace('animation', '');
        shortKey = shortKey.toLowerCase().trim();
        if (shortKey in mappingDict) {
          shortKey = mappingDict[shortKey]
        };
        animation[shortKey] = css_dict[key].trim();
      }
      return animation;
  }



  function resetAnimationFunc(animation) {
    var prefix = 'animation';
    if (browserPrefix && browserPrefix.length)  {
      prefix = browserPrefix + 'Animation'
    }
    return function() {
      animation.midReset = true;
      changeState(prefix+'Delay', animation, '-' + animation.css.orig[prefix+'Duration']);
      changeState(prefix+"PlayState", animation, "paused");
      changeState(prefix+"PlayState", animation, "running");
      // changeState(prefix+'FillMode', animation, "backwards");


      // changeState(prefix+'Duration', animation, '10ms');

      $timeout(function() {
        changeState(prefix+"Name", animation, '');
        changeState(prefix+"PlayState", animation, "paused");
        changeState(prefix+'Delay', animation, animation.css.orig[prefix+'Delay']);
        changeState(prefix+"Name", animation, animation.name);
      }, 100)



      // $timeout(function() {
      //   animation.midReset = false
      //   changeState(prefix+"PlayState", animation, "paused");



      //   changeState(prefix+'Duration', animation, animation.css.orig[prefix+'Duration']);



      // }, 500)
      console.log('reseting...')


      // changeState(prefix+"FillMode", animation, "backwards");



      // animation.events.start();
      // animation.events.end();
    }
  }

  function playAnimationFunc(animation) {
    var prefix = 'animation';

  }

  function pauseAnimationFunc(animation) {
    var prefix = 'animation';

  }





  function processStyleAnimations(styles) {
    var resultDict = {animations: {}, transitions: {}};
    var ss = document.styleSheets;
    for (var i = 0; i <ss.length; i++) {
          if (ss[i].cssRules && ss[i].cssRules.length) {

          }
    }
    return resultDict;
  }

  function getAnimationObj(browser, element) {
    var animationProperties = ['animation', 'animationName', 'animationDuration', 'animationTimingFunction', 'animationFillMode',  'animationIterationCount', 'animationDelay'];
    var defaultPropertyArr = ["none", "0s", "ease", "none", "1", "0s"];
    var animResultDict = {};
    if (browser && browser.length) {
      animationProperties.forEach(function(prop, i) {animationProperties.push(browser + prop[0].toUpperCase() + prop.substring(1))});
    }
    var computedStyle = window.getComputedStyle(element);
    var sum = 0;
    for (var i = 0; i < animationProperties.length; i++) {
      var iProperty = animationProperties[i];
      if (computedStyle[iProperty] && computedStyle[iProperty].length) {
        if ([browserPrefix + 'Animation', 'animation'].indexOf(iProperty) > -1 && computedStyle[iProperty] !== 'none 0s ease 0s 1 normal none running') {
          animResultDict = processComputedPropertyDefaultFormat(animResultDict, computedStyle[iProperty], browser)
        } else {
          animResultDict[iProperty] = computedStyle[iProperty];
        }
      }
    }

    return Object.keys(animResultDict).length && animResultDict;
  }

  function processComputedPropertyDefaultFormat(_dict, anim_str, browser) {
    var properties =     ['animationName', 'animationDuration', 'animationTimingFunction', 'animationDelay',  'animationIterationCount', 'animationDirection', 'animationFillMode', 'animationPlayState']
    var animStrSplit = UtilitiesService.replaceAll(anim_str, ', ', ',').split(',');
    if (browser && browser.length) {
      properties.forEach(function(prop, i) {properties[i] = browser + prop[0].toUpperCase() + prop.substring(1)});
    }
    for (var i = 0; i < properties.length; i++) {
      var resultStr = '';
      for (var j = 0; j < animStrSplit.length; j++) {
        if (j !== ( animStrSplit.length - 1)) {
          resultStr +=  animStrSplit[j].split(' ')[i] + ', '
        } else {
          resultStr +=  animStrSplit[j].split(' ')[i]
        }
      }
      if (resultStr.length) {
        _dict[properties[i]] = resultStr;
      }
    }
    return _dict
  }

  function playAll(animations) {
    return;
  }

  function getAnimationObjFromName(name) {
    return AnimationService.getAnimationObjFromAnimationName(name);
  }

  function getAnimatableTemplateFunc(element, attr) {
      var styleStr = '';
      if (attr.size) {
          styleStr += 'width:' + attr.size + 'px;'
          styleStr += 'height:' + attr.size + 'px;'
      }
      if (attr.stroke) {
          styleStr += 'stroke:' + attr.stroke + 'px;'
          element.children().css('stroke', attr.stroke);
      }
      styleStr += RootService.formatBrowserCSSProperty('animation-name') +':{{anim.name}};'
      styleStr += RootService.formatBrowserCSSProperty('animation-iteration-count') +':{{anim.iter}} !important;'
      styleStr += RootService.formatBrowserCSSProperty('animation-fill-mode') +':{{anim.fill}} !important;'
      styleStr += RootService.formatBrowserCSSProperty('animation-duration') +':{{anim.duration}}ms !important;'
      styleStr += RootService.formatBrowserCSSProperty('animation-timing-function') +':{{anim.func}} !important;'
      styleStr += RootService.formatBrowserCSSProperty('animation-delay') +':{{anim.delay}}ms !important;'
      styleStr += RootService.formatBrowserCSSProperty('animation-play-state') +':{{anim.playState}}'
      attr.$set('style', styleStr);
      return attr.template
    }

  function injectAnimationWithPlayer(animations, elem, cb, _window) {
        var elemCoords = elem[0].getBoundingClientRect();
        elemCoords.height = elemCoords.height/10.0;
        elemCoords.width =  elemCoords.width/10.0;
        var dx = Math.abs(elemCoords.width - _window.width);
        var dy = Math.abs(elemCoords.height - _window.height);

        div = document.createElement('div');
        div.innerHTML = '<timeline-player animations=animations></timeline-player>'
        div.style.zIndex = 100000;

        if (dx/_window.width < 0.1) {
          div.classList.add('bottom-0', 'left-0', 'full-x', 'fixed');
          var elem = document.querySelector('ui-view');
          elem.appendChild(div);
        } else {
          div.classList.add('relative', 'animated', 'slideInUp');
          elem[0].parentNode.appendChild(div);
        }
        cb && cb(div);
    }


function getAnimationStartListener(scope, browser, element) {
      return function(cb) {

        var startAnimationEvent = browser + 'animationStart';

        if (browser && browser.length) {
          startAnimationEvent = browser + 'AnimationStart';
        }
        return element.addEventListener(startAnimationEvent, function(e) {
            var animation = {
                target: e.target,
                timeStamp: e.timeStamp,
                type: e.type,
                name: e.animationName,
                obj: getAnimationObjFromName(e.animationName)}
            console.log(animation)

            e.target.style[browser.toLowerCase() + 'AnimationPlayState'] = 'paused';
            animation.duration = window.getComputedStyle(e.target)[browser.toLowerCase() + 'AnimationDuration'];
            var duration = (e.target.style[browser.toLowerCase() + 'AnimationDuration'].split('ms')[0] / 10) + 'ms';
            e.target.style[browser.toLowerCase() + 'AnimationDuration'] = duration;
            e.target.style[browser.toLowerCase() + 'AnimationPlayState'] = 'pause';
            // scope.animations.push(animation)
            cb && cb(e);
        })
      }
    }

function getAnimationEndListener(scope, browser, element) {

    return function(cb) {
    var startAnimationEvent = 'animationEnd';
    if (browser && browser.length) {
      startAnimationEvent = browser + 'AnimationEnd';
    }
    return element.addEventListener(startAnimationEvent, function(e) {
        cb && cb();

        if (browser) {
          console.log('pausing');
          e.target.style[browser + 'AnimationPlayState'] = 'paused';
        } else {
          e.target.style['animationPlayState'] = 'paused';
        }
        e.target.style.offsetWidth = e.target.style.offsetWidth;
        console.log('animation ending', e.target);
       })
    }
}

}

angular
.module('uguru.admin')
.factory("AdminDirectiveService", [
  '$state',
  '$timeout',
  '$localstorage',
  'RootService',
  AdminDirectiveService
  ]);

function AdminDirectiveService($state, $timeout, $localstorage, RootService) {


    return {
        getAllDirectives: getAllDirectives,
        getBaseComponents: getBaseComponents,
        getCustomComponents: getCustomComponents,
        getBaseComponentHtml: getBaseComponentHtml
    }

    function getBaseComponents() {
        //todo
        var baseComponentDict = {
            input: ['hover', 'focus', 'blur', 'disabled', 'typing', 'typing:valid', 'typing:invalid', 'selected', 'valid', 'invalid', 'invalid:clear', 'default', 'onEnter', 'onExit', 'empty:hover', 'empty:focus', 'empty:blur', 'empty:invalid'],
            checkbox: ['onLoad', 'onEnter', 'unchecked:hover', 'unchecked:active', 'checked', 'checked:hover', 'checked:active', 'disabled'],
            radio: ['onExit', 'onLoad', 'onEnter', 'unchecked:hover', 'unchecked:active', 'checked', 'checked:hover', 'checked:active', 'disabled'],
            toggle: ['default', 'onLoad', 'onEnter', 'onExit', 'checked', 'hover', 'active', 'disabled'],
            dropdown: ['info:hover', 'option:active', 'option:disabled', 'option:hover', 'onClose', 'onOpen', ':disabled', ':active', ':hover', 'onExit', 'onEnter', 'onLoad', 'default'],
            body: ['default', 'onLoad', 'onEnter', 'onEnter-short', 'onExit', 'onExit-short'],
            header: ['default', 'onEnter', 'onExit', 'onExit-alt'],
            image: ['default', 'onLoad', 'onEnter', 'onExit', 'broken'],
            tooltip: ['defaultTop', 'onEnterTop', 'onExitTop', 'onCompleteTop', 'onSwitchTop', 'defaultRight', 'onEnterRight', 'onExitRight', 'onCompleteRight', 'onSwitchRight', 'defaultBottom', 'onEnterBottom', 'onExitBottom', 'onCompleteBottom', 'onSwitchBottom', 'defaultLeft', 'onEnterLeft', 'onExitLeft', 'onCompleteLeft', 'onSwitchLeft'],
            button: ['default', 'onDrawEnter', 'onEnter', 'onExit', 'onHover', 'onActive', 'defaultLine', 'onDrawEnterLine', 'onEnterLine', 'onExitLine', 'onHoverLine', 'activeLine']
        }
        return baseComponentDict
    }

    function getCustomComponents() {
        var customComponentDict = {
            projector: ['template']
        }
        return customComponentDict
    }

    function getBaseComponentHtml(input_name) {

        var uPrefix = Object(getBaseComponents()).keys().indexOf(input_name) > -1 && "u-" || '';
        if (uPrefix.length) {
            var base_url = RootService.getBaseUrl() + 'shared/templates/components/base/' + input_name.toLowerCase() + '.tpl';
        } else {
            var base_url = RootService.getBaseUrl() + 'shared/templates/components/containers/' + input_name.toLowerCase() + '.tpl';
        }


        return "<ion-view class='flex-wrap-center full-xy absolute'> <" + uPrefix + input_name.toLowerCase() + "></" + input_name.toLowerCase() + "> </ion-view>"
    }

    function getAllDirectives() {
        var appDirectiveModules = angular.module('uguru.shared.directives')
        var resultsArr = [];
        appDirectiveModules['_invokeQueue'].forEach(
            function(value){
                var title = value[2][0];
                var args = parseDirectiveSpec(value[2][1]);
                var resultDict = {
                    title: title,
                    type: args.type,
                    replace: args.replace || false,
                }
                if (args.tags) resultDict.tags = args.tags;
                resultsArr.push(resultDict);
            }
        )
        return resultsArr
    }

    function parseDirectiveSpec(args_arr) {
        var resultDict = {type: parseType}
        var lastArg = args_arr[args_arr.length - 1]
        if (!lastArg) {
            responseDict = args_arr();
        } else {
            responseDict = lastArg();
        }
        responseDict.type = parseType(responseDict['restrict'])
        delete responseDict['restrict'];

        return responseDict

        function parseType(dir_type) {

            if (dir_type.length === 1 && dir_type.toLowerCase() === 'a') {
                return 'attribute'
            } else {
                return 'element'
            }
        }
    }


}

angular
.module('uguru.admin')
.factory("AdminDebugService", [
  '$state',
  '$timeout',
  '$localstorage',
  'RootService',
  'UtilitiesService',
  '$compile',
  'AnimToolService',
  AdminDebugService
  ]);

function AdminDebugService($state, $timeout, $localstorage, RootService, UtilitiesService, $compile, AnimToolService) {
    var debug_options = ['highlight', 'pause-at', 'autoplay', 'show'];
    var debug_elem_options = ['trigger', 'inspect', 'select'];
    var debug_global_css_options = ['duration'];
    var settingsDict = {}

    return {
        applyHighlight: applyHighlight,
        getAllDebugElems: getAllDebugElems,
        getParentScope: getParentScope,
        playState: playState,
        playAllStates: playAllStates,
        processOptions: processOptions,
        initAnimToolPlayer: initAnimToolPlayer,
        getAllOptions: getAllOptions,
        getAllCustomStates: getAllCustomStates,
        getTestStateObj: getTestStateObj
    }

    //@jason
    function getTestStateObj(test_id, state_obj) {
        console.log(test_id, state_obj);
        var testStateObj;
        //place your stuff here

        // 1. get test_obj
        // --- if you can get it immediately, return it
        // --- if you cant .. call this callback

        $timeout(function() {
            state_obj.testObj = yourFunctionThatWillReturnTestObjWithID(test_id, state_obj)
        })

        function yourFunctionThatWillReturnTestObjWithID(test_id, state_obj) {
            var testObj;
            //add code here
            return testObj;
        }
        // 2. set state_obj



        return testStateObj;
    }

    function getAllCustomStates(elem) {

    }

    function initAnimToolPlayer(scope, elem) {
        AnimToolService.setStage(scope.stage);
        console.log('setting stage', scope.stage)
        scope.stage.recorder = AnimToolService.initRecorder(scope.stage, scope);
        console.log('recorder initialized', scope.stage.recorder)
        scope.stage.player = AnimToolService.initPlayer(scope.stage);
        scope.stage.recorder.start(scope.stage.recorder);
        console.log('starting..')

        scope.stage = {parentElem: element.parentNode, active: false, toggle: toggleAnimToolPlayer};

        function toggleAnimToolPlayer() {
            var newValue = !scope.parent.stage.active;
            //being hidden
            if (!newValue) {
                document.querySelector('#admin-anim-tools');
                animRecorderContainer.classList.remove('slideInDown');
                $timeout(function() {
                    animRecorderContainer.classList.add('fadeOutUp');
                })
                $timeout(function() {
                    scope.parent.stage.active = newValue;
                }, 1250)
            } else {
                scope.parent.stage.active = newValue;
                $timeout(function() {
                    scope.$apply();
                });
            }
        }
    }

    function getAllOptions() {
        return debug_options
    }

    function processOptions(attr) {
        return {
            readOnly: {
                highlight: 'highlight'in attr,
                showToolbar: 'hide' in attr,
                speed: ('speed' in attr && attr['speed']) || '1x',
                autoplay: 'autoplay' in attr,
                delayBetweenState: ('delayBtwn' in attr && parseInt(attr['delayBtwn'])) || 0,
                autorecord: 'autorecord' in attr,
                pauseAt:'pauseAt' in attr && parseInt(attr['pauseAt']) || 'TBA'
            },
            toggles: {settings: false, play: false, record: false}
        }
    }

    function playState (state, scope, delay) {
        delay = delay || 0;
        options = scope.debug.options;


        var supportedTriggers = ['click', 'hover', 'mouseover', 'mouseleave', 'mouseenter'];
        var specialTriggers = ['hover', 'mouseover', 'mouseenter', 'mouseleave']
        $timeout(function() {
            if ('trigger' in state && supportedTriggers.indexOf(state.trigger) > -1) {
                var elemToTrigger = state.elem;
                if ('select' in state) {

                    elemToTrigger = state.elem.querySelector(state.select);
                    specialTriggerIndex = specialTriggers.indexOf(state.trigger);
                    if (specialTriggerIndex > -1) {

                        var tempNgClick = elemToTrigger.getAttribute('ng-click');
                        if (tempNgClick) {
                            var getSpecialAttr = elemToTrigger.getAttribute('ng-' + specialTriggers[specialTriggerIndex]);
                            elemToTrigger.setAttribute('ng-click',  getSpecialAttr);
                            state.trigger = 'click';
                        }


                    }
                }
                $timeout(function() {
                    angular.element(elemToTrigger).triggerHandler(state.trigger);
                    scope.$apply();
                    state.played = true;
                })
            }
            return;
        }, delay);
    }

    function playAllStates(all_states, options, scope) {
        scope.debug.options.toggles.play = !scope.debug.options.toggles.play;
        var stoppingPoint = options.readOnly.pauseAt;
        console.log(stoppingPoint);
        if (options.readOnly.speed === 'fast') {
            options.readOnly.delayBetweenState = 100;
        }
        for (var i = 0; i < all_states.length; i ++ ) {
            var indexState = all_states[i];
            var indexDelay = options.readOnly.delayBetweenState*i;
            playState(indexState, scope, indexDelay);
            if (stoppingPoint && ((i + 1) === stoppingPoint)) {
                break;
            }

        }
        return;
    }

    function applyHighlight() {

    };

    function getParentScope(elem) {
        var controllerInfo = elem.getAttribute('ng-controller');
        var controllerInfoSplit = controllerInfo.split(' as ');
        if (controllerInfoSplit.length > 1) {
            return controllerInfoSplit[controllerInfoSplit.length - 1]
        }
    }

    function getAllDebugElems(parent_elem) {
        var debugElems = parent_elem.querySelectorAll('[debug-id]');
        var resultArr =[];
        for (var i = 0; i < debugElems.length; i++) {
            var elemIndexArrStates = processDebugElem(debugElems[i]);
            if (elemIndexArrStates.length) {
                for (var j =0 ; j < elemIndexArrStates.length; j++) {
                    resultArr.push(elemIndexArrStates[j]);
                }
            }

        }

        resultArr.sort(function(state_a, state_b) {
            return state_b - state_a;
        })
        return resultArr;
    }

    function processDebugElem(elem, states) {
        var debugInfo = elem.getAttribute('debug-id');
        var elemStates = [];
        var debugStatesElem = debugInfo.split('|');
        for (var i = 0; i < debugStatesElem.length; i++) {
            var indexDebugDetails = debugStatesElem[i];
            var indexDebugDetailsSplit = debugStatesElem[i].split(':');
            if (indexDebugDetailsSplit.length > 1) {
                var debugId = parseInt(indexDebugDetailsSplit[0]);
                var indexState = getStateFromElem(debugId, elem, indexDebugDetailsSplit.splice(1).join(':'));
                if (indexState && indexState.id) {
                    elemStates.push(indexState);
                }
            }
        }
            // var state = getStateFromElem(elem, debugDetails)
        return elemStates;
    }

    function getStateFromElem(id, elem, debug_info) {
        debug_info = UtilitiesService.removeAllOccurrancesArr(debug_info, ['[', ']'])
        debugInfoSplit = debug_info.split(',');
        var supportedPropNames = debug_elem_options;
        var resultDict = {};
        for (var i = 0; i < debugInfoSplit.length; i++) {
            var indexDebugProp = debugInfoSplit[i];
            indexDebugPropSplit = indexDebugProp.split(':');
            if (indexDebugProp.length > 1) {
                var indexName = indexDebugPropSplit[0];
                var indexValue = indexDebugPropSplit[1];
                if (supportedPropNames.indexOf(indexName) > -1) {
                    resultDict['id'] = id;
                    resultDict[indexName] = indexValue;
                    resultDict.elem = elem;
                }
            }
        }

        return resultDict;
    }

}

angular
.module('uguru.admin')
.factory("AdminWorkflowService", [
  '$state',
  '$timeout',
  '$localstorage',
  '$window',
  AdminWorkflowService
  ]);

function AdminWorkflowService($state, $timeout, $localstorage, $window) {


    return {
      getWorkflows: getWorkflows,
      getSingleWorkflow: getSingleWorkflow
    }

    function getSingleWorkflow(arg) {
      var workflows = getWorkflows();
      for (var i = 0; i < workflows.length; i++) {
        if (workflows[i].identifier.toLowerCase() === arg.toLowerCase()) {
          return workflows[i];
        }
      }
      return
    }

    function getWorkflows() {
        var workflows = [
              {
                title: 'App Loader',
                identifier: 'loader',
                reference: {
                    controller: 'SplashLoaderController',
                    templateUrl: 'preapp/templates/loaders/main.html',
                    routeUrl: 'dev/splash/loader',
                    cssUrl: 'preapp/css/scss/loader.scss'
                },
                states: [
                    {title: 'onLoaderSwitch', functional: false, animated: false, tested: false}
                ]
              },
              {
                title: 'Madlib Selection',
                identifier: 'madlib',
                parentId: '#splash-madlib',
                reference: {
                    controller: 'SplashMadlibController',
                    controllerUrl: 'preapp/js/SplashMadlibController.js',
                    templateUrl: 'preapp/templates/splash.madlib.html',
                    routeUrl: 'dev/splash/madlib',
                    cssUrl: 'preapp/css/scss/partials/adlib/_main.scss'
                },
                states: [
                    {title: 'onActivate', functional: true, animated: false, tested: false},
                    {title: 'onTagOneInit', selector: '[blank-num="1"] a', testing: {'css': ['stroke-dasharray']}, functional: true, animated: false, tested: false},
                    {title: 'onTagOneClicked', selector: '[blank-num="1"] a', functional: true, animated: false, tested: false},
                    {title: 'onTagTwoClicked', selector: '[blank-num="2"] a',functional: true, animated: false, tested: false},
                    {title: 'onTagDeselected', selector: '[blank-num="1"] .translate-blank-1', functional: true, animated: false, tested: false},
                    {title: 'onBothBlanksFilled', selector: '[blank-num="2"] .translate-blank-2',  functional: true, animated: false, tested: false},
                    {title: 'onUniversityChanged', functional: false, animated: false, tested: false},
                    {title: 'onCategoryChanged', functional: false, animated: false, tested: false},
                    {title: 'onDeviceButtonSelected', functional: false, animated: false, tested: false},
                    {title: 'onMapFullScreenTransition', functional: false, animated: false, tested: false},
                    {title: 'onExit', functional: false, animated: false, tested: false}
                ]
              },
              {
                title: 'Device States',
                identifier: 'device',
                parentId: '#splash-device-container',
                reference: {
                    controller: 'SplashDeviceController',
                    controllerUrl: 'preapp/js/SplashDeviceController.js',
                    templateUrl: 'preapp/templates/splash.device.html',
                    routeUrl: 'dev/splash/device',
                    cssUrl: 'preapp/css/scss/partials/_device.scss'
                },
                states: [
                  {title: 'drawOnInit', description: 'Should draw itself in while Splash Madlib state is activating', functional:true, animated:false, tested:false},
                  {title: 'onUniversityChange', description: 'Should redraw, burst, maintain indication of university color in some way + return back to original size & position', functional:false, animated:false, tested:false},
                  {title: 'onSearchStart', description: 'Should signal that its searching for tutors', functional:false, animated:false, tested:false},
                  {title: 'onSearchStartPropogateWaves', description: 'As search state conveys something is loading, propogate the circular loader outside the bounds in an incremental fashion until screen is taken over', functional:false, animated:false, tested:false},
                  {title: 'onCounterStart', description: 'Inner device screen should start counting to a particular number', functional:false, animated:false, tested:false},
                  {title: 'onCounterIncrement', description: 'This state occurs each time the number changes in the counter, signaling other animations with the results completed so far', functional:false, animated:false, tested:false},
                  {title: 'onCounterCompleteCounterExit', description: 'Inner device screen should transition from a counter to a state highlighting the gurus available', functional:false, animated:false, tested:false},
                  {title: 'onCounterCompleteGuruEject', description: 'Inner device screen should simultaneous init/prepare to eject gurus as ', functional:false, animated:false, tested:false},
                  {title: 'onSingleGuruEnter', description: 'How an available Guru w/ course enters the device for each number in the counter', functional:false, animated:false, tested:false},
                  {title: 'onSingleGuruEject', description: 'Inner device screen should transition from a counter to a state highlighting the gurus available', functional:false, animated:false, tested:false},
                  {title: 'onGuruProfileEnter', description: 'The transition of a guru profile into the mobile device/laptop', functional:false, animated:false, tested:false},
                  {title: 'onGuruProfileExit', description: 'The exiting transition of a guru profile into the mobile device/laptop', functional:false, animated:false, tested:false},
                  {title: 'onGuruProfileMorph', description: 'The interrim state of a Guru profile given the user selects the morph device icon/button', functional:false, animated:false, tested:false},
                  {title: 'onGuruDeviceMorph', description: 'The transition of a mobile device to laptop or vice versa', functional:false, animated:false, tested:false}
                ]
              },
              {
                title: 'Splash Header Nav',
                identifier: 'nav',
                parentId:'#splash-nav-bar',
                reference: {
                    controller: 'SplashNavController',
                    controllerUrl: 'preapp/js/SplashNavController.js',
                    templateUrl: 'preapp/templates/splash.nav.html',
                    routeUrl: 'dev/splash/nav',
                    cssUrl: 'preapp/css/scss/partials/splash/_headers.scss',
                    parentController: 'SplashController as splash'
                },
                states: [
                  {title: 'onEnterSidebarIcon', description: 'Entrance of sidebar icon', functional:false, animated:false, tested:false},
                  {title: 'onEnterCategoriesDropdown', description: 'Entrance of categories dropdown', functional:false, animated:false, tested:false},
                  {title: 'onEnterUniversitiesDropdown', description: 'Entrance of universities dropdown', functional:false, animated:false, tested:false},
                  {title: 'onClickSideBarIcon', description: 'sidebar icon is clicked', functional:false, animated:false, tested:false},
                  {title: 'onClickPowerupsIcon', description: 'Powerup button is clicked and the view is initialized', functional:false, animated:false, tested:false},
                  {title: 'onClickUniversityDropdown', description: 'Universities dropdown is clicked.', functional:false, animated:false, tested:false},
                  {title: 'onClickCategoriesDropdown', description: 'Categories dropdown is clicked.', functional:false, animated:false, tested:false},
                  {title: 'onHoverSideBarIcon', description: 'Sidebar icon is hovered while in Splash madlib view', functional:false, animated:false, tested:false},
                  {title: 'onHoverPowerupsIcon', description: 'Powerup icon is hovered while in Splash madlib view', functional:false, animated:false, tested:false},
                  {title: 'onHoverUniversityDropdown', description: 'Entire universities dropdown is hovered while in "compressed" mode', functional:false, animated:false, tested:false},
                  {title: 'onHoverCategoriesDropdown', description: 'Entire categories dropdown is hovered while in "compressed" mode', functional:false, animated:false, tested:false},
                  {title: 'onExitPowerupsIcon', description: 'Exit of sidebar icon', functional:false, animated:false, tested:false},
                  {title: 'onExitSidebarIcon', description: 'Exit of sidebar icon', functional:false, animated:false, tested:false},
                ]
              },
              {
                title: 'Splash Maps',
                identifier: 'splash_maps',
                parentId: '#splash-map-view',
                reference: {
                    controller: 'SplashMapsController',
                    controllerUrl: 'preapp/js/SplashMapsController.js',
                    templateUrl: 'preapp/templates/splash.map.html',
                    routeUrl: 'dev/splash/map',
                    cssUrl: 'preapp/css/scss/partials/splash/_maps.scss'
                },
                states: []
              },
              {
                title: 'Splash Sidebar',
                identifier: 'sidebar',
                parentId: '#splash-sidebar',
                reference: {
                    controller: 'SplashSidebarController',
                    controllerUrl: 'preapp/js/SplashSidebarController.js',
                    templateUrl: 'preapp/templates/splash.sidebar.html',
                    routeUrl: 'dev/splash/sidebar',
                    cssUrl: 'preapp/css/scss/partials/splash/_sidebar.scss'
                },
                states: []
              },
              {
                title: 'Splash Powerups',
                identifier: 'powerups',
                parentId: '#splash-powerups',
                reference: {
                    controller: 'SplashPowerupsController',
                    controllerUrl: 'preapp/js/SplashPowerupsController.js',
                    templateUrl: 'preapp/templates/splash.powerups.html',
                    routeUrl: 'dev/splash/powerups',
                    cssUrl: 'preapp/css/scss/partials/splash/_powerups.scss'
                },
                states: []
              },
              {
                title: "FAQ",
                identifier: 'faq',
                parentId:'#splash-sidebar-faq',
                reference: {
                    controller: 'SplashFaqController',
                    controllerUrl: 'preapp/js/menu/SplashFaqController.js',
                    templateUrl: 'preapp/templates/sidebar/faq.html',
                    routeUrl: 'dev/splash/faq',
                    cssUrl: null
                },
                states:[]
              },
              {
                title: "Pricing Page",
                identifier: 'pricing',
                parentId: '#splash-sidebar-pricing',
                reference: {
                    controller: 'SplashPricingController',
                    controllerUrl: 'preapp/js/menu/SplashPricingController.js',
                    templateUrl: 'preapp/templates/sidebar/pricing.html',
                    routeUrl: 'dev/splash/pricing',
                    cssUrl: 'preapp/css/scss/partials/pages/_pricing.scss'
                },
                states: [

                ]
              },
              {
                title: "Team Page",
                identifier: 'team',
                parentId: '#splash-sidebar-team',
                reference: {
                    controller: 'SplashTeamController',
                    controllerUrl: 'preapp/js/menu/SplashTeamController.js',
                    templateUrl: 'preapp/templates/sidebar/team.html',
                    routeUrl: 'dev/splash/team'
                },
                states: [

                ]
              },
              {
                title: "About Page",
                identifier: 'about',
                reference: {
                    controller: 'SplashAboutController',
                    templateUrl: 'preapp/templates/sidebar/about.html',
                    routeUrl: 'dev/splash/about'
                },
                states: [

                ]
              },
              {
                title: "How it works",
                identifier: 'hiw',
                reference: {
                    controller: 'SplashHIWController',
                    templateUrl: 'preapp/templates/hiw.html',
                    routeUrl: 'dev/splash/hiw'
                },
                states: [

                ]
              },
              {
                title: "Splash Tour Guide",
                identifier: 'tour',
                reference: {
                    controller: 'SplashTourController',
                    templateUrl: 'preapp/templates/tour.html',
                    routeUrl: 'dev/splash/tour'
                },
                states: [

                ]
              },
              {
                title: "Access",
                identifier: 'access',
                reference: {
                    controller: 'SplashAccessController',
                    templateUrl: 'preapp/templates/started/access.html',
                    routeUrl: 'dev/splash/access'
                },
                states: [

                ]
              },
              {
                title: "Projector-Only Swiper View",
                identifier: 'projector',
                reference: {
                    controller: 'SplashProjectorSwiperView',
                    templateUrl: 'preapp/templates/started/getting-started.html',
                    routeUrl: 'dev/splash/projector'
                },
                states: [

                ]
              },
              {
                title: "Demographics Slide",
                identifier: 'demographics',
                reference: {
                    controller: 'SplashAccessController',
                    templateUrl: 'preapp/templates/started/access.html',
                    routeUrl: 'dev/splash/demographic'
                },
                states: [

                ]
              },
              {
                title: "Account Slide",
                identifier: 'account',
                reference: {
                    controller: 'SplashAccountController',
                    templateUrl: 'preapp/templates/started/account.html',
                    routeUrl: 'dev/splash/account'
                },
                states: [
                  //@gabrielle-note: example of transitions to account for
                  {title: 'beforeAccountProjectorAnimComplete', functional: false, animated: false, tested: false},
                  {title: 'onAccountProjectorAnimComplete', functional: false, animated: false, tested: false},
                  {title: 'onAccountValidateButtonClicked', functional: false, animated: false, tested: false},
                  {title: 'onAccountValidate', functional: false, animated: false, tested: false},
                  {title: 'onAccountSuccess', functional: false, animated: false, tested: false},
                  {title: 'onAccountError', functional: false, animated: false, tested: false}
                ]
              },
              {
                title: "University Search Page",
                identifier: 'u_search',
                reference: {
                    controller: 'SplashSearchUniversityController',
                    templateUrl: 'preapp/templates/started/university-search.html',
                    routeUrl: 'dev/splash/university-search'
                },
                states: [
                  {title: 'onViewInit', functional: false, animated: false, tested: false},
                  {title: 'onViewEnterComplete', functional: false, animated: false, tested: false},
                  {title: 'onInputFocused', functional: false, animated: false, tested: false},
                  {title: 'onSearchResultChange', functional: false, animated: false, tested: false},
                  {title: 'onNoSearchResults', functional: false, animated: false, tested: false},
                  {title: 'onSearchResultClicked', functional: false, animated: false, tested: false}
                ]
              },
              {
                title: "University Courses Slide",
                identifier: 'u_courses',
                reference: {
                    controller: 'SplashUniversityCoursesController',
                    templateUrl: 'preapp/templates/started/university-courses.html',
                    routeUrl: 'dev/splash/university-courses'
                },
                states: [
                  {title: 'onViewInit', functional: false, animated: false, tested: false},
                  {title: 'asSlideEnterTransition', functional: false, animated: false, tested: false},
                  {title: 'onSlideEnterTransitionComplete', functional: false, animated: false, tested: false},
                  {title: 'onSlideExitTransition', functional: false, animated: false, tested: false},
                  {title: 'onCourseSearchInputFocused', functional: false, animated: false, tested: false},
                  {title: 'onCourseSearchKeypress', functional: false, animated: false, tested: false},
                  {title: 'onCourseSearchInputBackspace', functional: false, animated: false, tested: false},
                  {title: 'onCourseSearchInputClear', functional: false, animated: false, tested: false},
                  {title: 'onCourseSearchResultExists', functional: false, animated: false, tested: false},
                  {title: 'onCourseSelected', functional: false, animated: false, tested: false},
                  {title: 'onCourseRemoved', functional: false, animated: false, tested: false},
                ]
              },
              {
                title: 'Guru Profiles',
                identifier: 'profile',
                group: true,
                reference: {
                    controller: 'GuruProfileController',
                    templateUrl: 'shared/templates/guru.profile.html',
                    routeUrl: ['dev/admin/profiles/academic', 'dev/admin/profiles/tech', 'dev/admin/profiles/baking', 'dev/admin/profiles/photography', 'dev/admin/profiles/household']
                },

              },
              {
                title: "Gabrielle's Portfolio",
                identifier: 'gabrielle',
                reference: {
                    controller: 'GabrielleController',
                    templateUrl: 'gabrielle/templates/index.html',
                    routeUrl: 'dev/gabrielle'
                }
              },
              {
                title: "Jeselle's Portfolio",
                identifier: 'jeselle',
                reference: {
                    controller: 'JeselleController',
                    templateUrl: 'gabrielle/templates/index.html',
                    routeUrl: 'dev/jeselle'
                }
              },
              {
                title: 'Base Components',
                identifier: 'base_comp',
                parentId: '#base-components-view',
                reference: {
                    controller: 'AdminComponentController',
                    controllerUrl: 'admin/js/AdminComponentController.js',
                    templateUrl: 'admin/templates/components/base.tpl',
                    routeUrl: 'dev/admin/components/base',
                    cssUrl: 'admin/css/scss/partials/_base_components.scss'
                },
                states: []
              },
              {
                title:'Splash',
                identifier: 'splash',
                parentId: '#splash-view',
                reference: {
                  controller: 'SplashController',
                  controllerUrl: 'preapp/js/SplashController.js',
                  templateUrl: 'preapp/templates/splash.html',
                  routeUrl: 'dev/splash',
                  cssUrl: 'preapp/css/scss/preapp.scss'
                },
                states: [
                  {title: 'onInit', selector:'#splash-madlib', description: 'Activate splash madlib',  functional:false, animated:{micro: false, macro:false}, tested:{init: false, activated: false, properties:false}},
                  {title: 'onEnter', selector:'#splash-madlib', description: 'Check splash madlib is visible',  functional:false, animated:{micro: false, macro:false}, tested:{init: false, activated: false, properties:false}},
                  {title: 'onInit', selector:'#splash-device-container', description: 'Activate splash device',  functional:false, animated:{micro: false, macro:false}, tested:{init: false, activated: false, properties:false}},
                  {title: 'onEnter', selector:'#splash-device-container', description: 'Check splash device is visible',  functional:false, animated:{micro: false, macro:false}, tested:{init: false, activated: false, properties:false}},
                  {title: 'onInit', selector:'#splash-nav-bar', description: 'Activate splash nav',  functional:false, animated:{micro: false, macro:false}, tested:{init: false, activated: false, properties:false}},
                  {title: 'onEnter', selector:'#splash-nav-bar', description: 'Check splash nav is visible',  functional:false, animated:{micro: false, macro:false}, tested:{init: false, activated: false, properties:false}}
                ]
              }
            ]

        for (var i = 0; i < workflows.length; i++) {
            workflows[i]['id'] = i + 1;
            // console.log(workflows[i]['title'],workflows[i]['id']);

        }
        return workflows;
    }


}

angular
.module('uguru.admin')
.factory("SpecService", [
  '$state',
  '$timeout',
  '$localstorage',
  '$window',
  '$compile',
  '$sce',
  'KeyboardService',
  'UtilitiesService',
  'RootService',
  'AdminWorkflowService',
  'DirectiveService',
  SpecService
  ]);

function SpecService($state, $timeout, $localstorage, $window, $compile, $sce, KeyboardService, UtilitiesService, RootService, AdminWorkflowService, DirectiveService) {

    return {
        initSpec: initSpec,
        getSpec: getSpec
    }

    function isParamLastPartUrl(param) {
        var wHref = window.location.href
        var lastUrlParam = wHref.split('/').reverse()[0].toLowerCase();
        return wHref.split('/' + param).length > 1 &&  (lastUrlParam=== param)
    }

    function initSpec(param, real_scope) {
        var extraDelay = 0;
        if (window.location.href.split('codepen').length > 1) {
            extraDelay = 2500;
        }
        //if its not codepen, it doesn't have dev in it
        if (
            window.location.href.split('codepen').length === 1 &&
            (window.location.href.split('/dev/').length === 1)
            ) {
            return;
        }
        $timeout(function() {

            var workflowObj = AdminWorkflowService.getSingleWorkflow(param);

            var scope = real_scope[param];
            var template_path = workflowObj.reference.templateUrl;
            var ctrl_path = workflowObj.reference.controllerUrl;
            var states = workflowObj.states;
            var css_path = workflowObj.reference.cssUrl;
            var parent_controller = workflowObj.reference.parentController;
            var parent_container = workflowObj.parentId;

            if (!scope.spec) {
                scope.spec = {data: {toggleDev:false, toggleSpec:false}};
            }


            //checks codepen environment
            // if (window.location.href.split('codepen.io').length > 1) return;
            var specObj = getSpec(param, template_path, ctrl_path, css_path, parent_controller);
            var callbackFunc = getInstantiateAndInjectFunc(scope, real_scope, specObj, parent_container, param, states)
            getCodepenSpec(specObj.url, callbackFunc)

        }, extraDelay);

    }

    function getAllThirdPartyTools() {
        var thirdPartyTools = [
            {name:'bouncejs', ref:'bouncejs', src:'http://bouncejs.com', show:false},
            {name:'cubic bezier', src: 'http://cubic-bezier.com', ref:'cb', show:false}
        ]
        return thirdPartyTools;
    }

    function showThirdPartyToolIframe(spec) {
        return function(tool) {
            tool.show = !tool.show;
        }
    }

    function toggleDocSearchFunc(_window) {
        return function(spec) {
            spec.toggleDocSearch = !spec.toggleDocSearch;
            if (spec.toggleDocSearch) {
                $timeout(function() {
                    var componentsContainer = document.querySelector('#components-container');
                    componentsContainer.style.top = (_window.height * -1 + 130) + 'px';
                    componentsContainer.style.height = (_window.height - 130) + 'px';
                }, 100)
            }
        }
    }

    function getInstantiateAndInjectFunc(scope, real_scope, specObj, parent_container, param, states) {
        // console.log(states);
        return function(obj) {

            specObj.data = obj;
            calcUseCasesCompletedness(specObj.data.use_cases)
            //@gabrielle note
            specObj.data.toggleDev = true;
            specObj.data.selectedState;
            specObj.data.toggleSpec = false;
            specObj.data.toggleDocs = false;
            specObj.data.toggleDocSearch = false;
            specObj.data.toggleStatus = false;
            specObj.data.toggleDocSearchFunc = toggleDocSearchFunc(real_scope.root.window);
            specObj.data.toggleGoogleDoc = false;
            specObj.data.toggleShortcuts = false;
            specObj.data.toggleAllToolsBar = false;
            specObj.data.tools = getAllThirdPartyTools();
            specObj.data.showThirdPartyToolIframe = showThirdPartyToolIframe(specObj.data);

            specObj.data.toggleSettings = true;
            specObj.data.animTools = {stage: {parentElem: parent_container}, show:false}
            specObj.data.docs = {launch:launchDocs}
            specObj.data.mobile = {toggle:toggleMobileMode, width:400, height:768, show:false, template:specObj.template_path, url:window.location.href}
            specObj.data.open = specObj.open;
            specObj.data.statesDropdown = generateDropdownFromStates(states, parent_container, real_scope, param);
            specObj.data.stateTags = specObj.data.statesDropdown.options;
            specObj.data.stateTagClicked = specObj.data.statesDropdown.onOptionClick;
            specObj.data.initCodepenData = launchNewCodepen(scope);
            specObj.data.shortcuts_list  = getKeyboardShortcuts()
            $timeout(function() {
                specObj.data.codepenData = getCodepenData(scope, specObj.data.title, specObj.template_path, specObj.ctrl_path, specObj.css_path, specObj.parent_controller);
            })
            specObj.data.iframeGDoc = iframeGdocFunc($sce.trustAsResourceUrl(specObj.data.gdoc));
            specObj.data.openGDoc = openGDocSpecFunc($sce.trustAsResourceUrl(specObj.data.gdoc));
            specObj.data.ready = loadLocalStorageSettings(scope);
            for (specProp in specObj) {
                scope.spec[specProp] = specObj[specProp]
            }

            elem = document.querySelector(parent_container);
            specElem = document.createElement('spec');
            specElem.className = 'fixed bottom-0 left-0 full-x';
            specElem.style.zIndex = '100000';
            specObj.data.toggles = {devBar: toggleDev, record:toggleAnimRecorder, spec:toggleSpec, settings:toggleSettings, shortcuts:toggleShortcuts};
            specObj.data.keyboardListeners = initKeyboardFunction();
            // specElem.setAttribute('ng-if', 'spec && spec.data');
            specElem.setAttribute('data', param + '.spec.data');
            if (elem) {
                elem.appendChild(specElem)
                $timeout(function() {
                    $compile(specElem)(real_scope);
                })
            }

            function iframeGdocFunc(url) {
                return function() {

                }
            }

            function openGDocSpecFunc(url) {
                return function() {
                    $window.open(url, '_blank');
                }
            }

            function initKeyboardFunction() {
                KeyboardService.initOptionPressedAndReleasedFunction(toggleDev, null, 68, 'd', true, null);
                KeyboardService.initOptionPressedAndReleasedFunction(toggleSpec, null, 83, 's', true, null);
                KeyboardService.initOptionPressedAndReleasedFunction(toggleSettings, null, 90, 'z', true, null);
                KeyboardService.initOptionPressedAndReleasedFunction(toggleShortcuts, null, 75, 'k', true, null);
                KeyboardService.initOptionPressedAndReleasedFunction(launchDocs, null, 78, 'n', false, 750);
                KeyboardService.initOptionPressedAndReleasedFunction(toggleMobileMode, null, 77, 'm', true, null);
                // KeyboardService.initOptionPressedAndReleasedFunction(function() {toggleDev(true); toggleSpec(true);}, null, 27, 'esc', true, null);
            }

            function getKeyboardShortcuts() {
                return [
                    {key: 'd', action: 'toggle toolbar'},
                    {key: 's', action: 'show pull down spec'},
                    {key: 'z', action: 'toggle settings'},
                    {key: 'k', action: 'show shortcuts'},
                    {key: 'm', action: 'toggle mobile'},
                    {key: 'n', action: 'launch docs'},
                    {key: 'hold gDoc', action: 'launch gdoc external'},
                ]
            }

            function toggleDev(value) {
                var newValue = !scope.spec.data.toggleDev;

              if (newValue) {
                scope.spec.data.toggleDev = newValue;
                return;
              }
              else if (!newValue) {
                var devSpecContainer = document.querySelector('#dev-toolbar');
                devSpecContainer.classList.remove('slideInDown');
                $timeout(function() {
                    devSpecContainer.classList.add('slideOutDown');
                })
                $timeout(function() {
                    scope.spec.data.toggleDev = newValue;
                }, 750);
              }

            }
            function toggleShortcuts() {
                var newValue = !scope.spec.data.showShortcuts;
                if (newValue  && scope.spec.data.toggleDev) {
                    scope.spec.data.showShortcuts = newValue;
                    return;
                }
                else if (newValue && !scope.spec.data.toggleDev) {
                    scope.spec.data.toggleDev = true;
                    $timeout(function() {
                        scope.spec.data.showShortcuts = newValue;
                    }, 750)
                }
                else if (!newValue) {
                    var showShortcutsContainer = document.querySelector('#dev-bar-shortcuts');
                    showShortcutsContainer.classList.remove('lightSpeedIn');
                    $timeout(function() {
                        showShortcutsContainer.classList.add('lightSpeedOut');
                    })
                    $timeout(function() {
                        scope.spec.data.showShortcuts = newValue;
                        showShortcutsContainer.classList.add('lightSpeedOut');
                    }, 750);
                }
            }

            function toggleSettings() {
                var newValue = !scope.spec.data.showSettings;
                if (newValue  && scope.spec.data.toggleDev) {
                    scope.spec.data.showSettings = newValue;
                    return;
                }
                else if (newValue && !scope.spec.data.toggleDev) {
                    scope.spec.data.toggleDev = true;
                    $timeout(function() {
                        scope.spec.data.showSettings = newValue;
                    }, 750)
                }
                else if (!newValue) {
                    var showSettingsContainer = document.querySelector('#dev-bar-settings');
                    showSettingsContainer.classList.remove('lightSpeedIn');
                    $timeout(function() {
                        showSettingsContainer.classList.add('lightSpeedOut');
                    })
                    $timeout(function() {
                        scope.spec.data.showSettings = newValue;
                        showSettingsContainer.classList.add('lightSpeedOut');
                    }, 750);
                }
            }

            function launchDocs() {
                var url = 'http://uguru-rest-test.herokuapp.com/#/admin/docs';
                if (window.location.href.split(':81').length > 1 || window.location.href.split(':5000').length > 1) {
                    url = window.location.href.split('/#/')[0] + '/#/admin/docs';
                }
                $window.open(url, '_blank');
            }

            function toggleMobileMode(value) {
                //flex-center --> ion-nav-view
                //set the width and height to ion-nav-view-first-child

                if (value && typeof(value) === 'boolean') {
                    scope.spec.data.mobile.show = value;
                } else {
                    scope.spec.data.mobile.show = !scope.spec.data.mobile.show;
                }
                var parent_elem = document.querySelector(parent_container);
                var spec_elem = parent_elem.querySelector(parent_container + ' > div[data]');
                var hasFullXy = (' ' + parent_elem.className + ' ').indexOf(' ' + 'full-xy' + ' ') > -1;

                if (scope.spec.data.mobile.show) {
                    if (!scope.spec.data.mobile.initDimensions) {
                        var computedDimensionsView = window.getComputedStyle(parent_elem.parentNode);
                        var computedDimensionsSpec = window.getComputedStyle(spec_elem);
                        scope.spec.data.mobile.initDimensions = {view: {}, devTools: {}};
                        scope.spec.data.mobile.initDimensions.view = {height: computedDimensionsView.height, width: computedDimensionsView.width}
                        scope.spec.data.mobile.initDimensions.devTools = {height: computedDimensionsSpec.height, width: computedDimensionsSpec.width}
                    }
                    parent_elem.parentNode.classList.add('flex-center');
                    parent_elem.style.width = scope.spec.data.mobile.width + 'px';
                    parent_elem.style.height = scope.spec.data.mobile.height + 'px';
                    var parentElemMarginTop = (0 - parent_elem.getBoundingClientRect().top);
                    parent_elem.style.marginTop =  parentElemMarginTop + 'px';
                    spec_elem.style.marginBottom = (parentElemMarginTop - parent_elem.getBoundingClientRect().top ) + 'px';

                    spec_elem.style.width = scope.spec.data.mobile.initDimensions.devTools.width;
                    spec_elem.style.left = (0 - parent_elem.getBoundingClientRect().left) + 'px';

                    spec_elem.classList.remove('full-x', 'left-0', 'top-0');
                    if (hasFullXy) {
                        parent_elem.classList.remove('full-xy');
                    }
                    spec_elem.classList.remove('relative');

                    var mobileSpecOptionsBar = spec_elem.querySelector('#spec-mobile-options');
                    if (mobileSpecOptionsBar) {
                        mobileSpecOptionsBar.classList.add('absolute', 'left-0', 'full-x');
                        mobileSpecOptionsBar.style.top = (0 - spec_elem.getBoundingClientRect().height + mobileSpecOptionsBar.getBoundingClientRect().height * 0.5) + 'px';
                    }
                    // var devToolHeightInt = parseInt(scope.spec.data.mobile.initDimensions.devTools.height.replace('px', ''));
                    // var viewHeightInt = parseInt(scope.spec.data.mobile.initDimensions.view.height.replace('px', ''));
                    // var bottomOffset = 0 - (viewHeightInt - scope.spec.data.mobile.height);

                    // spec_elem.style.bottom =  bottomOffset + 'px';
                    parent_elem.style.overflow = 'visible';
                    $timeout(function() {
                        real_scope.$apply();
                        parent_elem.classList.add('mobile');
                    }, 100)

                } else {
                    parent_elem.parentNode.classList.remove('flex-center');
                    parent_elem.classList.remove('mobile');
                    parent_elem.style.width = scope.spec.data.mobile.initDimensions.view.width;
                    parent_elem.style.height = scope.spec.data.mobile.initDimensions.view.height;
                    spec_elem.style.marginBottom = 'initial';
                    parent_elem.style.marginTop = 'auto';
                    // spec_elem.classList.add('full-x', 'bottom-0');
                    spec_elem.classList.add('full-x', 'left-0', 'bottom-0', 'relative');
                    spec_elem.style.width = '';
                    if (hasFullXy) {
                        parent_elem.classList.add('full-xy');
                    }
                    parent_elem.style.overflow = 'hidden';
                    parent_elem.classList.remove('mobile');
                    var mobileSpecOptionsBar = spec_elem.querySelector('#spec-mobile-options');
                    if (mobileSpecOptionsBar) {
                        mobileSpecOptionsBar.classList.remove('absolute', 'left-0', 'full-x');
                        mobileSpecOptionsBar.style.top = 'initial'
                    }
                }
            }

            function toggleSpec(value) {
              var newValue = !scope.spec.data.toggleSpec;
              if (newValue) {
                scope.spec.data.toggleSpec = newValue;
                scope.spec.data.toggleDocs = false;
                return;
              }
              else if (!newValue) {
                var devSpecContainer = document.querySelector('#dev-spec');
                devSpecContainer.classList.remove('slideInDown');
                $timeout(function() {
                    devSpecContainer.classList.add('fadeOutUp');
                })
                $timeout(function() {
                    scope.spec.data.toggleSpec = newValue;
                }, 750);
              }
            }



            function toggleAnimRecorder(value) {

              var newValue = !scope.spec.data.animTools.show;
              if (newValue) {

                scope.spec.data.animTools.show = newValue;
                scope.spec.data.toggleSpec = false;
                scope.spec.data.toggleDocSearch = false;
                return;
              }
              else if (!newValue) {

                var animRecorderContainer = document.querySelector('#admin-anim-tools');
                animRecorderContainer.classList.remove('slideInDown');
                $timeout(function() {
                    animRecorderContainer.classList.add('fadeOutUp');
                })
                $timeout(function() {
                    scope.spec.data.animTools.show = newValue;
                }, 1000);
              }
            }

        }

    }

    function calcUseCasesCompletedness(use_case_arr) {
        for (var i = 0; i < use_case_arr.length; i++) {
            var indexUseCase = use_case_arr[i];
            if (!indexUseCase.columns) indexUseCase.columns = {};
            var indexUseCaseColumns = indexUseCase.columns
            for (column in indexUseCaseColumns) {
                var indexColumnObj = indexUseCaseColumns[column];
                var columnSumComplete = 0;
                if (indexColumnObj.items && indexColumnObj.items.length) {
                    var columnItems = indexColumnObj.items;
                    for (var j = 0; j < columnItems.length; j++) {
                        var actionItem = indexColumnObj.items[j];
                        if (actionItem.value) columnSumComplete += 1;
                        if (actionItem.sub_items && actionItem.sub_items.length) {
                            var actionSum = 0;
                            var actionSubItemTotal = actionItem.sub_items.length;
                            for (var k = 0; k < actionItem.sub_items.length; k++) {
                                var indexSubItem = actionItem.sub_items[k];
                                if (indexSubItem.value) actionSum += 1;
                            }
                            actionItem.status = {
                                fraction: actionSum + '/' + actionSubItemTotal,
                                remaining: actionSubItemTotal - actionSum,
                                total: actionSubItemTotal,
                                percentage: (100.0 * ((actionSum * 1.0)/indexColumnObj.items.length)).toFixed(1) + '%'
                            }
                        }
                    }
                }
                indexColumnObj.status = {
                    fraction: columnSumComplete+'/'+indexColumnObj.items.length,
                    remaining: indexColumnObj.items.length - columnSumComplete,
                    total: indexColumnObj.items.length,
                    percentage: (100.0 * ((columnSumComplete * 1.0)/indexColumnObj.items.length)).toFixed(1) + '%'
                }
            }
        }
    }

    function launchNewCodepen(scope) {
            var title = 'New Uguru Codepen';
            var base_url = 'http://uguru-rest-test.herokuapp.com/static/remote/min/';
            return {
                title                 : title,
                description           : "Most updated version",
                private               : false, // true || false
                tags                  : [], // an array of strings
                editors               : "101", // Set which editors are open. In this example HTML open, CSS closed, JS open
                layout                : "right", // top | left | right
                html                  : "<body ng-app='uguru' animation='slide-left-right-ios7' > <ui-view id='uguru-view'> <script type='text/ng-template' id='demo.html'><div class='splash-hero-content full-xy z-index-100' ng-controller='NewCodepenController as codepen' id='codepen-view' ng-show='true'> <div class='splash-guru-head' on-activate='pulse:animIn'> <div class='splash-hero-guru splash-logo-guru' ng-include='" + '"shared/templates/components/svg/logo/guru-head.html"' +"'></div> </div> <h1 class='flex-wrap-center full-x'> Aint nothin here to see *yet* </h1> </div></script></ui-view></body>",
                html_pre_processor    : "",
                css                   : "//@import 'mixins' already included within codepen\n\n#codepen-view{@extends .full-xy}",
                css_pre_processor     : "scss",
                css_starter           : "neither",
                css_prefix            : "none",
                js                    : "angular.module('uguru.preApp') .controller('NewCodepenController', ['$scope', '$state', '$timeout', 'SpecService', function($scope, $state, $timeout, SpecService) { var codepen = this; var states = {}; SpecService.initSpec(codepen, $scope, '#codepen-view', 'demo', null, null, states, null);} ])",
                js_pre_processor      : "none",
                html_classes          : null,
                head                  : '<meta charset="utf-8"><meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width"><title></title><script src="http://uguru_admin:wetrackeverything@uguru-rest-test.herokuapp.com/static/remote/min/util/base.js"></script>',
                css_external          : "http://uguru_admin:wetrackeverything@uguru-rest-test.herokuapp.com/static/remote/min/app.css;http://codepen.io/teamuguru/pen/ce57163cc68d7c34cc4bc84c985ed993",
                js_external           : '',
                css_pre_processor_lib : null,
                js_modernizr : null,
                js_library   : null,
        }
    }

    function loadLocalStorageSettings(scope) {
        var localStorageSettings = $localstorage.getObject('adminSpecSettings');
        var recentlySet = false;
        if (!localStorageSettings.toString().length) {
            localStorageSettings = initAdminSpecSettings();
            $localstorage.setObject('adminSpecSettings', localStorageSettings);
            recentlySet = true;
        }
        return function() {
            scope.spec.data.docs = {items: RootService.getDocItems(), searchText: ''};
            scope.spec.data.settings = {cache: localStorageSettings, clear: clearLocalStorage(scope), updateProperty:updateSettingCacheLocalStorage(scope), updateDefaultState:updateDefaultStateLocalStorage(scope)}
            // scope.spec.data.settings.cache.autoApplyState = true;

            if (scope.spec.data.settings.cache.defaultState.index < 0) {
                scope.spec.data.settings.cache.defaultState.index = 1;
                scope.spec.data.settings.cache.defaultState.state = scope.spec.data.stateTags[1];
            }

            if (scope.spec.data.settings.cache.autoShowMobile) {
                scope.spec.data.mobile.toggle();
            }

            if (scope.spec.data.settings.cache.autoApplyState && !recentlySet) {


                var defaultIndex = scope.spec.data.settings.cache.defaultState.index;
                var defaultState = scope.spec.data.stateTags[defaultIndex];
                var delayBeforeActivate = scope.spec.data.settings.cache.autoApplyDelay;
                if (delayBeforeActivate) {
                    scope.spec.data.stateTagClicked(defaultState, defaultIndex);
                } else {

                    $timeout(function() {
                        scope.spec.data.stateTagClicked(defaultState, defaultIndex)
                    }, delayBeforeActivate)
                }
            }

            scope.spec.data.toggleDev = scope.spec.data.settings.cache.autoShowDevBar;

        }
    }

    function updateSettingCacheLocalStorage(scope) {
        return function(value) {

                $timeout(function() {
                    console.log('updating cache', scope.spec.data.settings.cache);
                    scope.spec.data.settings.cache.defaultState.state = null;
                    $localstorage.setObject('adminSpecSettings', scope.spec.data.settings.cache);
                })
        }
    }

    function updateDefaultStateLocalStorage(scope) {
        return function($event, index, state) {
            if (scope.spec.data.settings.cache.defaultState.index >= 0) {
                scope.spec.data.stateTags[scope.spec.data.settings.cache.defaultState.index].default = false;
            }
            state.default = true;
            scope.spec.data.settings.cache.defaultState.index = index;
            scope.spec.data.settings.cache.defaultState.state = null;
            $localstorage.setObject('adminSpecSettings', scope.spec.data.settings.cache);
            $timeout(function() {
                scope.spec.data.settings.cache.defaultState.state = state;
            }, 100)
        }
    }



    function clearLocalStorage(scope) {
        return function() {
            scope.spec.data.settings.cache = initAdminSpecSettings();
            $localstorage.removeObject('adminSpecSettings');
            $timeout(function() {
                localStorageSettings = initAdminSpecSettings();
                $localstorage.setObject('adminSpecSettings', localStorageSettings);
            })
        }
    }

    function initAdminSpecSettings() {
        return {
            autoApplyState: false,
            autoApplyDelay: 1000,
            defaultState: {index: -1, state: null},
            autoShowMobile: false,
            autoShowDevBar: true,
            showStatus: true
        }
    }

    function getCodepenData(scope, title, template_url, ctrl_path, css_path, parent_controller) {
        $timeout(function() {
            if (css_path && css_path.split(',').length > 1) {

            } else {
                template_url && loadHTMLSpec(scope, template_url, ctrl_path, parent_controller);
            }
        })
        $timeout(function() {
            ctrl_path && loadJsSpec(scope, template_url, ctrl_path)
        })
        $timeout(function() {
            css_path && loadCssSpec(scope, css_path);
        })
        var base_url = 'http://uguru-rest-test.herokuapp.com/static/remote/min/';
        return {
            title                 : title,
            description           : "Most updated version",
            private               : false, // true || false
            tags                  : [], // an array of strings
            editors               : "1100", // Set which editors are open. In this example HTML open, CSS closed, JS open
            layout                : "left", // top | left | right
            html                  : '',
            html_pre_processor    : "",
            css                   : "",
            css_pre_processor     : "scss",
            css_starter           : "neither",
            css_prefix            : "none",
            js                    : "",
            js_pre_processor      : "none",
            html_classes          : null,
            head                  : '<meta charset="utf-8"><meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width"><title></title><script src="http://uguru_admin:wetrackeverything@uguru-rest-test.herokuapp.com/static/remote/min/util/base.js"></script>',
            css_external          : "http://uguru_admin:wetrackeverything@uguru-rest-test.herokuapp.com/static/remote/min/app.css;http://codepen.io/teamuguru/pen/ce57163cc68d7c34cc4bc84c985ed993",
            js_external           : '',
            css_pre_processor_lib : null,
            js_modernizr : null,
            js_library   : null,
        }





        function loadHTMLSpec(scope, template_url, controller_url, parent_controller) {

            if (window.location.href.split(':8100').length > 1) {
              template_url = window.location.href.split('#/')[0] + template_url;
            } else {
              template_url = 'http://uguru-rest-test.herokuapp.com/static/remote/min/' + template_url;
            }
            var xhr = new XMLHttpRequest();
            xhr.open( 'GET', template_url, true );

            xhr.onload = function () {
                scope.spec.data.codepenData.html = wrapMinUguruHtml(xhr.responseText, controller_url, parent_controller);
            };
            xhr.send();
        }

        function loadJsSpec(scope, template_url, controller_url) {

            if (window.location.href.split(':8100').length > 1) {
              template_url = window.location.href.split('#/')[0] + controller_url;
            } else {
              template_url = 'http://uguru-rest-test.herokuapp.com/static/remote/min/' + controller_url;
            }
            var xhr = new XMLHttpRequest();
            xhr.open( 'GET', template_url, true );

            xhr.onload = function () {
                scope.spec.data.codepenData.js = xhr.responseText;
            };
            xhr.send();
        }

        function loadCssSpec(scope, css_url) {
            if (!css_url) {
                return '';
            }
            if (window.location.href.split(':8100').length > 1) {
              template_url = window.location.href.split('#/')[0] + css_url;
            } else {
              template_url = 'http://uguru-rest-test.herokuapp.com/static/remote/min/' + css_url;
            }
            var xhr = new XMLHttpRequest();
            xhr.open( 'GET', template_url, true );

            xhr.onload = function () {
                scope.spec.data.codepenData.css += xhr.responseText.replace('@import', '//@import');
            };
            xhr.send();
        }

        function wrapMinUguruHtml(response_html, relative_ctrl_url, parent_controller) {
            if (parent_controller) {
                response_html = '<div class="full-xy" ng-controller="' + parent_controller + '">' + response_html + '</div>'
            }
            var result = '<body ng-app="uguru" animation="slide-left-right-ios7" > <script>var portalElem;</script> <ui-view id="uguru-view"> <script type="text/ng-template" id="demo.html"> ' + response_html +'</script> </ui-view> <script src="http://uguru-rest-test.herokuapp.com/static/remote/min/' + relative_ctrl_url + '"></script> </body>'
            return result;
        }

    }

    function getSpecObj(spec_id, template_url, ctrl_url, css_url, parent_controller) {
        var url = template_url && constructCodepenUrl(spec_id);
        return {
            open: openCodepenSpecFunc(url),
            url: url + '.js',
            ctrl_path: ctrl_url,
            css_path: css_url,
            template_path: template_url,
            parent_controller: parent_controller,
            data: {}
        }

        function openCodepenSpecFunc(url) {
            if (!url) return function() {};
            return function() {
                $window.open(url + '/?editors=0010?layout=top', '_blank');
            }
        }
        function constructCodepenUrl(spec_id) {
            return "http://codepen.io/teamuguru/pen/" + spec_id;
        }


    }

    function parseCustomStates(parent_container) {
        var defaultOnStates = DirectiveService.getSupportedOnStates().slice()
        var defaultAsStates = DirectiveService.getSupportedAsStates().slice();
        var defaultCustomStates = ['when', 'as'];
        var queryStates = defaultOnStates.concat(defaultAsStates);

        var customStatesElem = parent_container.parentNode.querySelectorAll('custom-states');
        for (var i = 0; i < customStatesElem.length; i++) {
            var indexCustomElem = customStatesElem[i];
            for (var j = 0; j < defaultCustomStates.length; j++) {
                    customStateAttr = angular.element(indexCustomElem).attr(defaultCustomStates[j]);
                    if (customStateAttr) {
                        queryStates.push(defaultCustomStates[j] + '-' + customStateAttr);
                    }
            }
        }
        var uniqueElemArr = {};
        var stateDict = {};
        for (var i = 0; i < queryStates.length; i++) {
            var indexQuery = queryStates[i];
            if (indexQuery.split(',').length > 1) {
                indexQuery = '[' + UtilitiesService.replaceAll(indexQuery, ',', '],[') + ']'
            } else {
                indexQuery = '[' + indexQuery + ']'
            }
            var indexDict = {};
            var queryArr = [];
            var elements = parent_container.parentNode.querySelectorAll(indexQuery);
            if (elements && elements.length) {
                stateDict[indexQuery] = [];
                for (var j = 0; j < elements.length; j++) {
                    var indexElement = elements[j];
                    stateDict[indexQuery].push({elem: indexElement, attr: {key: indexQuery, attrValue: indexElement.getAttribute(indexQuery)}})
                }
            }
        }
        return stateDict;
    }

    function generateDropdownFromStates(states, parent_container, scope, param) {
        var dropdownArr = [];
        var elemUniqueStateArr = [];
        var elemStateArr = [];
        var parentContainer = document.querySelector(parent_container);
        if (parentContainer) {
            var elementsWithStates = parseCustomStates(parentContainer)|| [];
            for (state in elementsWithStates) {
                dropdownArr.push({stateName: state, elements: elementsWithStates[state]})
            }

            // for (var i = 0; i < elementsWithStates.length; i++) {
            //     var indexElemWithState = elementsWithStates[i];
            //     var indexElemStates = indexElemWithState.getAttribute('elem-states');
            //     var elemStates = UtilitiesService.removeAllOccurrancesArr(indexElemStates, ['[', ']', ' ', "'", '"']).split(',');
            //     for (var j = 0; j < elemStates.length; j++) {
            //         var indexState = elemStates[j];
            //         var onEnterState = 'on-' + indexState + '-enter';
            //         var onExitState = 'on-' + indexState + '-exit';
            //         var elemHasEnterAttribute = indexElemWithState.getAttribute(onEnterState);
            //         var elemHasExitAttribute = indexElemWithState.getAttribute(onExitState);
            //         if (elemHasEnterAttribute && elemUniqueStateArr.indexOf(UtilitiesService.camelCase(onEnterState)) === -1) {
            //             elemUniqueStateArr.push(UtilitiesService.camelCase(onEnterState));
            //             elemStateArr.push({title: UtilitiesService.camelCase(onEnterState), state: onEnterState})
            //         }
            //         if (elemHasExitAttribute  && elemUniqueStateArr.indexOf(UtilitiesService.camelCase(onExitState)) === -1) {
            //             elemUniqueStateArr.push(UtilitiesService.camelCase(onExitState));
            //             elemStateArr.push({title: UtilitiesService.camelCase(onExitState), state: onExitState})
            //         }
            //     }
            // }
        }
        // for (key in states) {
        //     dropdownArr.push({title:states[key]['title'], state: states[key], selector:states[key]['selector'] || '', testing: states[key]['testing'] || '', parent_elem: parent_container, parent_scope: scope})
        // }
        for (var i = 0; i < elemStateArr.length; i++) {
            elemStateArr[i].parent_elem = parent_container;
            elemStateArr[i].parent_scope = scope;
            elemStateArr[i].is_elem_state = true;
            dropdownArr.push(elemStateArr[i]);
        }
        // dropdownArr.sort(function(state_1, state_2) {
        //     return (state_2.priority) - (state_1.priority || 0)
        // })
        var result = {
            label: 'toggle states',
            options: dropdownArr,
            key: 'title',
            onOptionClick: applyDropdownAction(param),
            selectedIndex: getDefaultSelectedIndex(states)
        }

        return result;

        function getDefaultSelectedIndex(states) {
            return 1;
        }

        function applyDropdownAction(param) {
            return function(option, index) {
                scope[param]['spec'].data.selectedState = option;
                scope[param]['spec'].data.selectedState.active = true;
                console.log(scope[param]['spec'].data.selectedState.elements);
                scope[param]['spec'].data.showStateElememts = true;
                return;
                if (option.title === 'onInit') {
                    window.location.reload(true);
                } else if (option.title.toLowerCase().indexOf('onclick') > -1) {
                    elem = document.querySelector(option.state.selector);
                    $timeout(function() {
                        angular.element(elem).triggerHandler('click');
                        option.parent_scope.$apply();
                    })
                }
                else if (option.title.toLowerCase().indexOf('click') > -1) {
                    elem = document.querySelector(option.state.selector);
                    $timeout(function() {
                        angular.element(elem).triggerHandler('click');
                        option.parent_scope.$apply();
                    })
                } else if (option.title.toLowerCase() === 'onhover') {
                    parent_elem = document.querySelector(option.parent_elem);
                    onHoverElems = parent_elem.querySelectorAll('[on-hover]');
                    for (var i = 0 ; i < onHoverElems.length; i++) {
                        onHoverElems[i].classList.add('activate-hover');
                    }
                }
                else if (option.title.toLowerCase() === 'onactivate' || option.title.toLowerCase().indexOf('onactivate') > -1) {


                    parent_elem = document.querySelector(option.parent_elem);
                    if (option.selector) {
                        onActivateElems = parent_elem.querySelectorAll( option.selector+'[on-activate]');
                    } else {
                        onActivateElems = parent_elem.querySelectorAll('[on-activate]');
                    }
                    for (var i = 0 ; i < onActivateElems.length; i++) {
                        onActivateElems[i].classList.add('activate');
                        onActivateElems[i].classList.remove('invisible');
                    }
                }
                else if (option.is_elem_state) {
                    var stateElems = document.querySelectorAll('[' + option.state.selector + ']')
                    for (var i = 0; i < stateElems.length; i++) {
                        stateElems[i].classList.add(option.state)
                    }
                }
                if (scope[param].spec.data.settings.cache.showStatus) {
                    var statusBarElem = document.querySelector('#spec-status-bar');
                    if (statusBarElem) {
                        statusBarElem.classList.add('animated', 'slideInUp');
                        scope[param].spec.data.status_msg = option.title + ' is running...';
                        $timeout(function() {
                            scope.$apply();
                            scope[param].spec.data.toggleStatus = true;
                        })
                        $timeout(function() {
                            statusBarElem.classList.remove('animated', 'slideInUp');
                        }, 1000)
                        $timeout(function() {
                                statusBarElem.classList.add('animated', 'slideOutDown');
                                $timeout(function() {
                                    scope[param].spec.data.toggleStatus = false;
                                    statusBarElem.classList.remove('animated', 'slideOut');
                                }, 1000);
                        }, 3000);
                    }
                }
            }
        }
    }

    function getCodepenSpec(url, cb) {
      var xhr = new XMLHttpRequest();
      xhr.open( 'GET', url, true );

      xhr.onload = function () {
          var responseDict = JSON.parse(xhr.responseText);
          cb(responseDict);
      };
      xhr.send();
    }

    function getSpec(_id, template_url, ctrl_url, css_path, parent_controller) {
        var specTokens = {'calendar': 'ddd2f97039f2fec817d52499dd3c00ac', 'madlib': '5c0ecd57c10973ddfe65af113522a809', 'jeselle': '98f138f534428eb8af27ea5c2b6944ef', 'gabrie': '9d8ddaef35241c63a3a95032485bf645'};
        if (Object.keys(specTokens).indexOf(_id) > -1) {
            return getSpecObj(specTokens[_id], template_url, ctrl_url, css_path, parent_controller)
        } else {
            return getSpecObj('98f138f534428eb8af27ea5c2b6944ef', template_url, ctrl_url, css_path, parent_controller)
        }
    }


}

angular.module('uguru.admin')
.factory("AdminService", [
    "$timeout",
    "$http",
    AdminService
    ]);

function AdminService($timeout, $http) {

    return {
        getUpcomingCalendar: getUpcomingCalendar,
        getComponents: getComponents
    };

    function getComponents(scope) {
        return $http.get('admin/spec/component.json').success(function(data) {
            scope.admin.gallery.components = data;
            $timeout(function() {
                scope.$apply();
            })
        });
    }
    function getComponents(scope) {
        return $http.get('admin/spec/component.json').success(function(data){
            scope.admin.api = data;
        })
    }

    function getUpcomingCalendar(num_days) {
        var weekdaysShort = ['Sun', 'Mon', 'Tue', "Wed", 'Thur', 'Fri', 'Sat'];
        var monthShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'Jul', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
        var today = new Date();
        var resultArr = [];
        for (var i = 0; i < num_days; i++)  {
            var iDate = new Date();
            iDate.setDate(today.getDate() + i);
            var iDay = iDate.getDay();
            var iMonth = iDate.getMonth();
            resultArr.push({
                date: iDate.getDate(),
                day: {num: iDay, name: weekdaysShort[iDay]},
                month: {num: iMonth, name: monthShort[iMonth]}
            })
        }
        return resultArr
    }
};
angular
.module('uguru.admin')
.factory("AdminInspectService", [
  '$state',
  '$timeout',
  '$localstorage',
  'RootService',
  'UtilitiesService',
  'DirectiveService',
  '$compile',
  AdminInspectService
  ]);

function AdminInspectService($state, $timeout, $localstorage, RootService, UtilitiesService, DirectiveService, $compile) {
    return {
        getPropArr:getPropArr,
        getAttrDict: getAttrDict
    };

    function getAttrDict(scope, element, attr, style) {
        var supportedStates = DirectiveService.getSupportedOnStates()
        supportedStates.forEach(function(state, index) { supportedStates[index] = UtilitiesService.camelCase(state) })

        var resultDict = {};
        var elementKeys = Object.keys(attr).slice();

        for (key in elementKeys) {
            var strKey = elementKeys[key];

            if (supportedStates.indexOf(strKey) > -1 && strKey !== 'initLater') {

                var rawString = attr[strKey].substring();

                var obj = (rawString && rawString.length && DirectiveService.parseArgs(rawString + ''))

                var firstKey = Object.keys(obj)[0]
                var secondKey;
                for (key in obj[firstKey]) {
                    if (key.indexOf(firstKey) > -1) {
                        secondKey = key;
                    }
                }
                console.log(firstKey, secondKey)
                // var secondKey = Object.keys(obj[firstKey])[1];


                if (firstKey === 'transform' || firstKey === 'anim') {
                    resultDict[strKey] = {raw: rawString, type: firstKey, arr:obj[firstKey][secondKey] , activate: getActivateFunc(scope, element, obj)};
                } else {
                    resultDict[strKey] = {raw: rawString, type: firstKey, arr:obj[firstKey] , activate: getActivateFunc(scope, element, obj)};
                }

            }
        }
        resultDict.style = {raw: style, arr: getPropArr(style), type:'css', activate: null}
        console.log(resultDict);
        return resultDict;
    }

    function getPropArr(style_attr) {
        var cssKVSplit = (style_attr + '').split(';')
        var propArr = [];
        cssKVSplit.forEach(
            function(css_pair, index) {
                var cssPairSplit = css_pair.split(':');
                if (cssPairSplit[1]) {
                    propArr.push(
                        {
                            prop: cssPairSplit[0].trim(),
                            value: cssPairSplit[1]
                        }
                    )
                }
            })
        return propArr;
    }

    function getActivateFunc(scope, element, obj) {
        return function() {
            var supportedCommands = DirectiveService.supportedCommands;
            for (key in obj) {
                if (supportedCommands.indexOf(key) > -1) {

                    DirectiveService.activateArg(key, obj[key], scope, element);
                    element.bind('webkitAnimationEnd', function() {
                        console.log('animation ended')
                    })
                    element.bind('webkitTransitionEnd', function() {
                        var cssEditedArr = [];
                        element.css('transition').split(',').forEach(function(str, index) { cssEditedArr.push(str.split(' ')[0]) }) ;
                        for (var i = 0; i < cssEditedArr.length; i++) {
                            var cssPropName = cssEditedArr[i];
                            if (cssPropName.trim() === 'all') {
                                element[0].setAttribute('style', '');
                            } else {
                                element.css(cssPropName, 'initial');
                                element.css(cssPropName, 'unset');
                            }
                        }
                        element.css('webkit-transition', '');
                        element.css('transition', '');

                    })
                }
            }
        }
    }


}

angular
.module('uguru.admin', [])
.factory("AdminSVGRenderService", [
  '$state',
  '$timeout',
  '$localstorage',
  'UtilitiesService',
  AdminSVGRenderService
  ]);

function AdminSVGRenderService($state, $timeout, $localstorage, UtilitiesService) {
    //-- defs related
    // 1. [x] filter at the top
    // 2. [x] sort all the paths based their id name
    //-- end defs related
    // ---
    //-- Def ~ <G>
    //1. [x] Remove the id for page, keep fill/fill-rule
    //2. [x] Remove extraneous groups entirely
    //2.5 [x] // 1. Clarify global attributes + attribute values for the list [stroke-linecap] to applied group after the defs, strip any child that has itbefore tranversing global <g>, apply all necessary attributes clarified
    //3. [x] Go in order sequentially and create a group of the first child's attributes, for all subsequent siblings w/ same attributes, strip
    //4. Replace all <uses> that reference, <path> in defs with
    //5. //3. [ ] Filter & replace all <use> Within the first group, sort all def references aside from filter for all types of elements, look if they exist in the defs, if so, replace.
    //6. Pricing checkout prefixes
    //-- Wrapup
    // -- Export the new svg file
    // 1. Figure out simple exportable means
    // 2. clean up code so they can use it + properly debug
    // 3. clarify your prefix
    // 4. Optimize defs + path repititions based on their D;
    // 5. Element g-global = "stroke-linecap:round"
    // 6. removing the comments
    //sort paths by the id number
    //eliminate un-necessary
    //Any ids with the page in it
    //
    var removeAttrDict = {
        'todo': ['remove xml string text', 'paths '],
        'todoLater': ['initially set all IDs but later trim them once done animating'],
        'keep': {
            'svg': ['width', 'height', 'viewBox', 'xmlns', 'xmlns:xlink', 'version']
        },
        'remove': {
            'elems': ['title', 'desc']
        },
        'cache': {
            'elems': ['filter']
        }
    }

    var globalAttr = {
        'g': [{'stroke-linecap': 'round', 'stroke-linejoin': 'round'}]
    }

    var cache = {
        filter:{
            outerHTML: [],
            elem: []
        }
    }

    return {
        parseRawSVG: parseSVG

    }
    function orderChildrenByType(elem, ordering_arr) {
        var elemChildren = elem.childNodes;
        var elemOrder = ordering_arr[0].split(',');
        var elemDict = {};

        elemOrder.forEach(function(elem_type, i) {
            elemDict[elem_type] = [];
            for (var j = 0; j < elemChildren.length; j++) {
                var iElem = elemChildren[j];

                if (iElem.nodeName && iElem.nodeName.toLowerCase().indexOf(elem_type) > -1) {
                    elemDict[elem_type].push(iElem.cloneNode(true));
                }
            }
        });
        var elemAttrOrder = ordering_arr.length > 1 && ordering_arr[1].split(',') || ['id'];
        elem.innerHTML = '';
        var elemKeysReverse = Object.keys(elemDict)
        elemKeysReverse.forEach(function(key, i) {
            var elemKeyArr = elemDict[key];
            elemKeyArr.forEach(function(key_elem, j) {
                elem.appendChild(key_elem);
            })
        })

    }

    function getElementAttributeNumber(e1, attr) {
        var attrValue = e1 && e1.getAttribute(attr);
        var numArr = UtilitiesService.getArrayOfDecimals(attrValue);
        return (numArr && numArr.length && Math.abs(parseFloat(numArr[0]))) || 0
    }

    function sortElemsByAttr(elem_arr, attr_arr, reverse) {
        reverse = reverse || false;
        attr_arr.forEach(function(attr_name, i) {
            elem_arr.sort(function(e1, e2) {
                var indOne = getElementAttributeNumber(e1, attr_name)
                var indTwo = getElementAttributeNumber(e2, attr_name);
                return indTwo - indOne
            })
        })
        return (reverse && elem_arr.reverse()) || elem_arr;
    }

    function parseSVG(elem) {
        _elem = elem[0];
        _def = _elem.querySelector('defs');
        if (!_def) {

            _elem.appendChild(document.createElementNS('http://www.w3.org/2000/svg',"def"));
        }
        var attr = _elem.attributes;
        var ns = _elem.getAttribute('xmlns');
        var uniqueGIDs = ['white', 'glow'];
        var allFilters = _elem.querySelectorAll('filter');
        // var defParent = allFilters[0].parentNode;
        var allUses = _elem.querySelectorAll('use');
        var allGs = _elem.querySelectorAll('g');

        //parse root svg
        parseRootSvg(_elem, removeAttrDict.keep.svg)

        //remove all titles, defs
        filterChildrenOfType(_elem.childNodes, removeAttrDict.remove.elems);

        //order children by element type clarified






        function parseRootSvg(elem, whitelist_arr) {
            var svgToRemove = [];
            for (var i = 0; i < attr.length; i++) {
                iAttrName = attr[i].name;
                if (whitelist_arr.indexOf(iAttrName) === -1) {
                    svgToRemove.push(iAttrName);
                }
            }
            svgToRemove.forEach(function(attr_name, _) {
                _elem.removeAttributeNS(null, attr_name);
            });
        }



        function filterChildrenOfType(children, blacklist_arr) {
            var svgChildren = children;
            for (var i = 0; i < svgChildren.length; i++) {
                var childName = svgChildren[i].nodeName.toLowerCase();
                if (blacklist_arr.indexOf(childName) > -1) {
                    _elem.removeChild(svgChildren[i]);
                }
            }
        }


        allFilters.forEach(function(filter, i) {
            var filterId = filter.getAttribute('id');
            filter.removeAttribute('id');
            if (cache.filter.outerHTML.indexOf(filter.outerHTML) === -1) {
                cache.filter.outerHTML.push(filter.outerHTML);
                filter.setAttribute('id', 'filter-' + (cache.filter.elem.length + 1));
                cache.filter.elem.push(filter);
            } else {
                _def.removeChild(filter);
            }
        })

        allGs.forEach(function(g, i) {
            if (g.id.indexOf(uniqueGIDs[0]) > -1) {
                var useChild = g.querySelector('use[filter]');
                if (useChild) {
                    useChild.setAttribute('filter', 'url(#filter-1)');
                }
            } else {
                var useChild = g.querySelector('use[filter]');
                if (useChild) {
                    useChild.setAttribute('filter', 'url(#filter-2)');
                }
            }
        })

        var ordering_arr = ['filter,path,circle,rect,text', 'id'];

        _def.childNodes.forEach(function(child, i) {
            var nodeName = child.nodeName.toLowerCase()
            if (ordering_arr[0].split(',').indexOf(nodeName) === -1) {
                ordering_arr[0] = ordering_arr[0] + ',' + nodeName;
            }
        })
        console.log(ordering_arr);
        orderChildrenByType(_def, ordering_arr)

        var firstG = _elem.querySelector('g');
        var firstGKeepOnly = ['fill', 'fill-rule'];

        if (firstG.id && firstG.id.length && firstG.id.toLowerCase().indexOf('page') > -1) {
            firstG.removeAttribute('id');
            var attrToRemove = [];
            for (var i = 0; i < firstG.attributes.length; i++) {
                var attrName = firstG.attributes[i].name
                 if (firstGKeepOnly.indexOf(attrName) === -1) {
                    attrToRemove.push(attrName);
                 };
            }
            attrToRemove.forEach(function(attr_rm, i) {
                firstG.removeAttributeNS(null, attr_rm);
            })
        }
        if (firstG.children.length === 1 && firstG.children[0].attributes.length === 1 && firstG.children[0].nodeName.toLowerCase() === 'g') {
            firstG.innerHTML = firstG.children[0].innerHTML;
        }
        for (elem_type in globalAttr) {
            globalAttr[elem_type].forEach(function(attr_dict, i) {
                for (key in attr_dict) {
                    firstG.setAttribute(key, attr_dict[key]);
                }
            })
        }

        var groupElemToIgnore = ['id', 'class', 'd', 'transform', 'points', 'x', 'y', 'width', 'height', 'cx', 'cy', 'r', 'rx', 'cr'];
        if (firstG.children.length > 1 && elemChildrenHasConsecutiveUniquePatterns(firstG, groupElemToIgnore)) {

            getUniqueChildDict(firstG, groupElemToIgnore);
        } else {
            firstG.children[0].removeAttribute('id')
        }

        function elemChildrenHasConsecutiveUniquePatterns(elem, ignore_attr) {
            for (var i = 0; i < elem.children.length - 1; i++) {
                var uniquePattern = constructUniqueIDString(elem.children[i], ignore_attr);
                var nextUniquePattern = constructUniqueIDString(elem.children[i + 1], ignore_attr);
                if (uniquePattern === nextUniquePattern) {
                    return true;
                }
            }

            return false;
        }

        function getUniqueChildDict(elem, ignore_attr) {
            var children = elem.children;
            var childrenLength = children.length;
            var childDict = {};
            var currentChunkStr = constructUniqueIDString(children[0], ignore_attr);
            var uniqueStr;
            var currentChunkArr = [];
            var groupChunks = [];

            for (var i = 0; i < childrenLength; i++) {
                var iChild = children[i];

                uniqueStr = constructUniqueIDString(iChild, ignore_attr)

                if (uniqueStr.length && uniqueStr !== currentChunkStr) {
                    groupChunks.push({elems: currentChunkArr.slice(), attrStr: currentChunkStr + ""});
                    currentChunkStr = uniqueStr;
                    currentChunkArr = [{elem: iChild, attrStr: currentChunkStr + ""}];
                    continue;
                } else {
                    currentChunkArr.push({elem: iChild, attrStr: currentChunkStr + ""});
                }
            };

            var stripAttr = [];
            globalAttr['g'].forEach(function(kv, i) {for (k in kv) {stripAttr.push(k)}});
            var elemToAppend = [];
            for (var i = 0; i < groupChunks.length; i++) {
                iChunk = groupChunks[i];
                var g = document.createElementNS('http://www.w3.org/2000/svg',"g");
                var attrStrSplit = iChunk.attrStr.split(',');
                attrStrSplit.forEach(function(attr, i) {
                    var attrSplit = attr.split('|');
                    var key = attrSplit[0];
                    if (!key.length) return;
                    if (stripAttr.indexOf(key) > -1) {
                        return;
                    } else {
                        var value = attrSplit[1]
                        if (key && value && key.length && value.length) {
                            g.setAttribute(key, value);
                        }
                    }
                })
                if (iChunk.elems && iChunk.elems.length) {
                    iChunk.elems.forEach(function(e, i) {
                        attrStr = e.attrStr.split(',');
                        attrStr.forEach(function(attr_str, j) {
                            var kv = attr_str.split('|');
                            if (kv.length > 1) {
                                e.elem.removeAttribute(kv[0]);
                            }
                        })
                        g.appendChild(e.elem);
                    })
                }
                elemToAppend.push(g);
            }
            firstG.innerHTML = '';
            elemToAppend.forEach(function(elem, i) {
                firstG.appendChild(elem);
            })
        }
        function constructUniqueIDString(elem, ignore_attr) {

            var attrLength = elem.attributes.length;
            var resultStr = '';
            for (var i = 0; i < attrLength; i++) {
                var attr = elem.attributes[i];
                var attrD = {name: attr.name, value: attr.value};
                if (ignore_attr.indexOf(attrD.name.toLowerCase()) === -1) {
                    resultStr += attrD.name + '|' + attrD.value + ',';
                }
            }
            return resultStr.substring(0, resultStr.length - 1).trim();
        }

        return elem;
    }
}

angular.module('uguru', ['ionic', 'restangular', 'ngAnimate',
  'uguru.shared.services',
  'uguru.shared.controllers', 'uguru.shared.directives',   'uguru.shared.directives.components', 'uguru.shared.directives.base.components', 'uguru.shared.controllers'])

.run(["$ionicPlatform", "$state", "$ionicHistory", "$rootScope", "$templateCache", "$injector", function($ionicPlatform,
  $state, $ionicHistory, $rootScope,
  $templateCache, $injector) {
  $ionicPlatform.ready(function() {
  });
}])

.config(["$stateProvider", "$urlRouterProvider", "RestangularProvider", "$ionicConfigProvider", "$compileProvider", "$provide", "$httpProvider", "$sceDelegateProvider", function($stateProvider, $urlRouterProvider, RestangularProvider,
  $ionicConfigProvider, $compileProvider, $provide, $httpProvider,$sceDelegateProvider) {

   $sceDelegateProvider.resourceUrlWhitelist([
    'self',
    'https://s3-us-west-1.amazonaws.com/**'
  ]);


  $httpProvider.useApplyAsync(true);
  // $urlRouterProvider.when("", "/ui/coach/single");
  // $urlRouterProvider.when("/", "/ui/coach/single");
  // $urlRouterProvider.when("/ui/coach/sample", "/ui/coach/tracy");
  // RestangularProvider.setBaseUrl('http://smsomani.com'+ '/api/v1');

  if ($ionicConfigProvider) $ionicConfigProvider.views.swipeBackEnabled(false);

  $stateProvider
  .state('root', {
        url: '',
        abstract: true,
        template: '<ion-nav-view id="root-nav" animation="slide-left-right"> <!-- Warnings: be careful with spaces, those are treated like characters i.e. opacity: 0 !== opacity:0 (when it comes to shortcuts) --> <!-- <inspector-gadget show-log="false" ball-color="smoke" reverse-speed="10" speed="1x" class="bottom-0 bg-azure" auto-play="true" step-size="16" play-infinite="false" start-at="t:10%" > </inspector-gadget> --> <custom-shortcuts> <!-- check splash.nav.html for shortcut examples --> <!-- for prop, send, anim trigger--> <arg-shortcut replace="prop" with="p"/> <arg-shortcut replace="trigger" with="t"/> <arg-shortcut replace="send" with="s"/> <arg-shortcut replace="class" with="c"/> <arg-shortcut replace="anim" with="a"/> <arg-shortcut replace="eval" with="e"/> <arg-shortcut replace="transform" with="tr"/> <arg-shortcut replace="prop" with="set"/> <!-- @Samir - START: PLZ GET WORKING For css properties only --> <prop-shortcut replace="opacity" with="op"/> <prop-shortcut replace="transform" with="tr"/> <prop-shortcut replace="transform-origin" with="tro"/> <prop-shortcut replace="background" with="bg"/> <prop-shortcut replace="transition" with="t"/> <prop-shortcut replace="fill" with="f"/> <prop-shortcut replace="fill-opacity" with="fop"/> <prop-shortcut replace="stroke" with="s"/> <prop-shortcut replace="stroke-opacity" with="sop"/> <prop-shortcut replace="stroke-dashoffset" with="sdo"/> <prop-shortcut replace="stroke-dasharray" with="sda"/> <!-- @Samir - END For css properties only --> <!-- <prop-shortcut replace="animation-duration" with="ad"/> --> <prop-shortcut replace="animation-duration" with="dur"/> <prop-shortcut replace="animation-timing-function" with="atf"/> <prop-shortcut replace="animation-timing-function" with="func"/> <prop-shortcut replace="animation-iteration-count" with="aic"/> <prop-shortcut replace="animation-iteration-count" with="count"/> <prop-shortcut replace="animation-direction" with="ad"/> <prop-shortcut replace="animation-direction" with="dir"/> <prop-shortcut replace="animation-play-state" with="aps"/> <prop-shortcut replace="animation-play-state" with="play"/> <prop-shortcut replace="animation-fill-mode" with="afm"/> <prop-shortcut replace="animation-fill-mode" with="mode"/> <prop-shortcut replace="animation-delay" with="ade"/> <prop-shortcut replace="animation-delay" with="start"/> <!--Most general--> <!-- Full animation "stream" shortcuts/> --> <anim-prop-shortcut arg="stream" replace="demoOne" with="translateX:-100px:100px:1000:easeInElastic:500:4:ar,translateY:-100px:100px:1000:easeOutElastic:500:4:ar"/> <anim-prop-shortcut arg="stream" replace="demoTwo" with="scaleX:0:1.5:1250:easeOutBounce:0:2plus100:a,scaleY:0:1.5:1250:easeOutBounce:0:2plus100:a,rotate:-360deg:360deg:1250:easeInElastic:0:2plus100:ar"/> <anim-prop-shortcut arg="stream" replace="default-transX" with="translateX:-100px:-50%:1000:bouncePast:0:1:f"/> <anim-prop-shortcut arg="stream" replace="importAnimCSSDemo" with="input-swingUp:1500,linear,0,1,f"/> <!-- THESE NEED WORK -@SAMIR--> <anim-prop-shortcut arg="stream" replace="bounceJSDemo" with="split-button:1500,bouncePast,0,1,f"/> <anim-prop-shortcut arg="stream" replace="shakeOpacity-Reg" with="shake-opacity:1000,easeInOutElastic,0,1,f"/> <!-- Full animation [name, duration, default]/> --> <anim-prop-shortcut arg="duration" replace="fast" with="250"/> <anim-prop-shortcut arg="name" replace="trX" with="translateX"/> <anim-prop-shortcut arg="duration" replace="slow" with="2000"/> <anim-prop-shortcut arg="easingFunc" replace="cbOne" with="(0.075, 0.82, 0.165, 1)"/> <!-- --> <anim-prop-shortcut arg="default" for="translateX" set-default="-100%:100%:1000:bouncePast:0:1:f"/> <anim-prop-shortcut arg="default" for="translateY" set-default="-100%:100%:666:easeInOutElastic:0:10:ar"/> <cmd-shortcut replace="prop:[op:0, z-index:-1000]" with="backstage"/> <cmd-shortcut replace="prop:[op:0]" with="p-op"/> <cmd-shortcut replace="prop:[op:0]" with="p-o-0"/> <cmd-shortcut replace="prop:[op:1]" with="p-o-1"/> <cmd-shortcut replace="trigger:[on-enter:self]" with="t-enter"/> <cmd-shortcut replace="trigger:[on-enter:children]" with="t-enter-child"/> <cmd-shortcut replace="trigger:[on-exit:self]" with="t-exit"/> <cmd-shortcut replace="trigger:[on-exit:children]" with="t-exit-child"/> <cmd-shortcut replace="prop:[op:1, t:all 500ms ease-in-out]" with="p-fadereturn"/> <prop-value-shortcut replace="op:0" with="o-0"/> <prop-value-shortcut replace="op:1" with="o-1"/> <prop-value-shortcut replace="stroke-dashoffset:0" with="sdo-0"/> <prop-value-shortcut replace="t:all 250ms ease-in-out" with="t-250-eio"/> <prop-value-shortcut replace="t:all 250ms ease-in" with="t-250-ei"/> <prop-value-shortcut replace="t:all 250ms ease-out" with="t-250-eo"/> <prop-value-shortcut replace="t:all 150ms ease-in-out" with="t-150-eio"/> <prop-value-shortcut replace="t:all 150ms ease-in" with="t-150-ei"/> <prop-value-shortcut replace="t:all 150ms ease-out" with="t-150-eo"/> </custom-shortcuts> <root-animation off="true"> </root-animation> </ion-nav-view>'
  })
  .state('root.view', {
    name: 'root.view',
    parent: 'root',
    url:'/*path',
    template: "<div ng-include src='src'> </div>",
    controller: ["$scope", "$timeout", "$templateCache", "$stateParams", function($scope, $timeout, $templateCache, $stateParams) {
      if ($stateParams.path && $stateParams.path.length) {
        $scope.src = $stateParams.path;
      } else {
        $scope.src = "view.index.html"
      }

      // $templateCache.put('view2.index.html', '<div ng-include="\'https://s3-us-west-1.amazonaws.com/ui-guru/templates/ihml/compile3.tpl\'"></div>')
      // $timeout(function() {

      // }, 100)
    }]
  })
  $urlRouterProvider.otherwise('/');
}]);
// angular.module('uguru.shared.directives', []);
// angular.module('uguru.shared.directives.components', []);
angular.module('uguru.shared.controllers')
// angular.module('uguru.shared.controllers')
.controller('GuruProfileController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  'CategoryService',
  function($scope, $state, $timeout, SpecService, CategoryService) {
    var guru = this;
    guru.category = ($scope.splash && $scope.splash.category) || CategoryService.getLocalCategories()[0];
    guru.category = guru.category.name;
    guru.section_index = 0;

    // SpecService.initSpec('guru', $scope);

  }
]);


angular.module('uguru.shared.controllers')
// angular.module('uguru.shared.controllers')
.controller('SwiperController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  function($scope, $state, $timeout) {
      var swiper = this;
      console.log('ay');
    //   var swiperBack2 = new Swiper('.header-swiper-back-2', {
    //     slidesPerView: 'auto',
    //     centeredSlides: true,
    //     spaceBetween: 100,
    //     onlyExternal: true,
    //     effect: 'coverflow',
    //     direction: 'vertical',
    //     speed: 600,
    //     coverflow: {
    //       slideShadows: false
    //     }
    //   });
    //   var swiperBack1 = new Swiper('.header-swiper-back-1', {
    //     slidesPerView: 'auto',
    //     centeredSlides: true,
    //     spaceBetween: 300,
    //     effect: 'coverflow',
    //     speed: 600,
    //     coverflow: {
    //       slideShadows: false
    //     }
    //   });
    //   var swiperFront = new Swiper('.header-swiper-front', {
    //     slidesPerView: 'auto',
    //     centeredSlides: true,
    //     spaceBetween: 100,
    //     effect: 'coverflow',
    //     speed: 600,
    //     coverflow: {
    //       slideShadows: false
    //     },
    //     pagination: '.header-swiper-front .swiper-pagination',
    //     paginationClickable: true,
    //     nextButton: '.header-swiper-front .swiper-button-next',
    //     prevButton: '.header-swiper-front .swiper-button-prev',
    //     control: [swiperBack1, swiperBack2],
    //     controlBy: 'container',
    //     keyboardControl: true,
    //     a11y: true,
    //     onSlideChangeStart: function(s) {
    //       if (s.activeIndex === $('.swiper-slide-gallery').index()) {
    //         $(s.container[0]).find('.swiper-pagination').hide();
    //       } else {
    //         $(s.container[0]).find('.swiper-pagination').show();
    //       }
    //     }
    //   });
    //   var galleryTopSwiper = new Swiper('.swiper-gallery-top', {
    //     slidesPerView: 1,
    //     spaceBetween: 10,
    //     nested: true,
    //     resistanceRatio: 0,
    //     preloadImages: false,
    //     lazyLoading: true,
    //   });
    //   var galleryThumbsSwiper = new Swiper('.swiper-gallery-thumbs', {
    //     slidesPerView: 5,
    //     spaceBetween: 10,
    //     centeredSlides: true,
    //     touchRatio: 0.2,
    //     slideToClickedSlide: true,
    //     nested: true,
    //     resistanceRatio: 0,
    //   });
    //   galleryTopSwiper.params.control = galleryThumbsSwiper;
    //   galleryThumbsSwiper.params.control = galleryTopSwiper;


    // })();

    // var mySwiper = new Swiper('#swiper-container', {
    //     speed: 400,
    //     spaceBetween: 100
    // })

// var swiperMainOptions = {
//         slidesPerView:'auto',
//         centeredSlides:true,
//         spaceBetween: 80,
//         effect:'coverflow',
//         speed:250,
//         coverflow:{slideShadows:false},
//         // pagination:'.header-swiper-front .swiper-pagination',
//         paginationClickable:true,
//         nextButton:'.header-swiper-front .swiper-button-next',
//         prevButton:'.header-swiper-front .swiper-button-prev',
//         control:[swiperBack1,swiperBack2],
//         controlBy:'container',
//         keyboardControl:true,
//         a11y:true,
//         onTransitionEnd:onTransitionEndFunc($timeout, $scope),
//         // onSlidePrevStart: onSlidePrevStart($timeout, $scope),
//         parallax: true
//       }

//       if (!desktop_mode) {
//         swiperMainOptions.slidesPerView = args.mobile.slidesPerView;
//         swiperMainOptions.spaceBetween = args.mobile.spaceBetween;
//         swiperMainOptions.breakpoints = args.mobile.breakpoints;
//       }
//       var swiperFront=new Swiper('.header-swiper-front', swiperMainOptions)
//         function onSlideChangeEndMainSwiper($timeout, $scope) {
//             return function(swiper) {
//               $timeout(function(){
//                 $scope.$apply(function() {
//                   swiper.slides[swiper.activeIndex].classList.add('activate');
//                 })
//               })
//             }
//           }
  }

]);


angular.module('uguru.shared.controllers')
// angular.module('uguru.shared.controllers')
.controller('AnimationFrameController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  '$stateParams',
  'UtilitiesService',
  '$compile',
  'AnimationFrameService',
  'RootService',
  'AdminElementService',
  function($scope, $state, $timeout, $stateParams, UtilitiesService, $compile, AnimationFrameService, RootService, AdminElementService) {
    var afc = this;

    afc.service = AnimationFrameService;
    afc.args = {}
    afc.params = {formatted: '', raw: ''}
    afc.params.raw = constructStateStrFromParams($stateParams);


    afc.params.template = afc.element.objUrl;
    afc.params.defaults = {kf: getKFFromParams($stateParams), startAt:$stateParams.startAt && $stateParams.startAt.replace('p', '%'), autoPlay:$stateParams.autoPlay === 'true',  toolbar:{}, hidePlot: $stateParams.hidePlot === "true", stateName: $stateParams.state};
    afc.params.formatted = 'p:[' + afc.params.raw + ']';
    afc.getDebugFormat = AnimationFrameService.getDebugFormat;

    $timeout(function() {
        $scope.$apply();

        var stateName = $stateParams.state || ''
        var animContainer = document.querySelector('#anim-element');
        var navBarElemContainer = document.querySelector('#focused-element');
        animContainer.classList.add('absolute', 'full-xy', 'bottom-0', 'flex-wrap-center')

        afc.element.dom = getDomElementWithBounds(animContainer, $stateParams)


        afc.element.dom = AdminElementService.formatElement(afc.element.dom, 'player', $scope.root.window);

        var domRef = afc.element.dom
        animContainer.innerHTML = '';

        animContainer.appendChild(afc.element.dom);


        if (!$stateParams.state) {
          afc.params.raw =constructStateStrFromParams($stateParams);
        }


        // addBlindToElem(afc.element.dom);

        // append to element container
        // var clonedElem = afc.element.dom.cloneNode(true);
        // clonedElem.classList.add('absolute', 'full-xy');
        // navBarElemContainer.appendChild(clonedElem);
        // clonedElem.style.height = 'calc(100%)';
        // clonedElem.style.width = 'calc(100%)';

        afc.element.dom = domRef;

        afc.stateObj = afc.service.init.state(stateName, afc.params.raw, afc.element.dom, afc.params.defaults);
        afc.player = AnimationFrameService.getPlayer();
        afc.player = afc.player.scheduleStream(afc.player, afc.stateObj, afc.stateObj.offset, afc.params.defaults);

    }, 100)


    function addBlindToElem(elem) {
      AdminElementService.createBlind(elem);

      // animContainer.appendChild()
    }
    function getKFFromParams(params) {
      return params.kf && parseInt(params.kf) || 60
    }

    function appendParentWithComputedHeight(container, element) {

        var _window = $scope.root.window;




      var hasBounds = true;
      var isSvg = AdminElementService.isSVGElement(element.nodeName.toLowerCase());
      if (isSvg) {
        element = AdminElementService.getSVGParent(element)
        element = AdminElementService.scaleSvgCSS(element, _window, true, true);
      }


      while (hasBounds) {
        container.appendChild(element);
        var style = window.getComputedStyle(element);
        if (style.height && style.width) {
          hasBounds = false;

          break;
        } else {
          container.innerHTML = '';
          element = element.parentNode;
        }

      }
      console.log(element)

      element.classList.add('full-xy', 'absolute', 'flex-vertical-center', 'bottom-0')
      var cloneElemContainer = document.querySelector('#focused-element')
      if (cloneElemContainer) {



              var isSvg = AdminElementService.isSVGElement(afc.element.dom.nodeName.toLowerCase());
              if (isSvg) {
                // console.log(clonedElem.paren)
                clonedElem = AdminElementService.getSVGParent(afc.element.dom);
                var clonedElem = clonedElem.cloneNode(true);
              }
              cloneElemContainer.appendChild(clonedElem);
        }
      return element
    }



    function constructStateStrFromParams(params) {
      var animationShortcuts = RootService.customShortcuts.animProps;
        if (params.property) {
          var propArgs = params.property.split('+');
        } else {
          var propArgs = ['transformX:-50p,50p,1000,bouncePast,0,1,f', 'transformY:-50p,50p,1000,bouncePast,0,1,f'];
        }
        var argNames = ['property', 'start', 'end', 'duration', 'easingFunc', 'delay', 'iter', 'direction']
        propArgs.forEach(function(prop_anim, i) {
          propArgs[i] = UtilitiesService.replaceAll(prop_anim, ',', ':');
          if (!i && propArgs[i].split(':').length > 5) {
              propArgs[i].split(':').forEach(function(arg, arg_index) {
                afc.args[argNames[arg_index]] = arg

                if (argNames[arg_index] in animationShortcuts && arg in animationShortcuts[argNames[arg_index]]) {
                    afc.args[argNames[arg_index]] = animationShortcuts[argNames[arg_index]][arg]
                }
              })
          }
        })

        if (params.template) {
          var urlSplit = params.template.split(':');
          var dir = urlSplit[0];

          var isHtml = params.template.indexOf('.html') > -1
          var ext = isHtml && '.html' || '.tpl';
          urlString = dir + '/templates/' + urlSplit[1].split('.').join("/").replace('/html', '').replace('/tpl', '') + ext;
          afc.element = {objUrl:urlString};
        }



        return propArgs.join(',');
    }

    function getDomElementWithBounds(elem, params) {
        var bounds = (params.bounds || '');
        var selector = params.select || ''
        console.log(bounds, selector, elem)
        if (selector.length && bounds.length) {
          elem = elem.querySelector(bounds + ' ' + selector);

        } else if (selector) {
          elem = elem.querySelector(selector);
        } else {
          elem = animContainer.firstChild;
        }
        return elem
      }

  }

]);


angular.module('uguru.shared.controllers')

.controller('SingleViewController', [
  '$scope',
  '$state',
  '$timeout',
  '$filter',
  '$stateParams',
  'XHRService',
  'DataService',
  function($scope,  $state, $timeout, $filter, $stateParams, XHRService, DataService) {
    var pfx = $stateParams.prefix;
    eval('var ' + $stateParams.prefix.split('-').join("_")  + '=this;');
    eval('var pfx=this');


    var listener = $scope.$watch('data', function(value) {
      if (value) {
        pfx.data = value;
        listener();
        DataService.parseAppDataJson(pfx.data);
      }
    })

  }

])


angular.module('uguru.admin')
.controller('AdminController', [

    '$scope',
    '$state',
    '$stateParams',
    '$timeout',
    '$localstorage',
    '$interval',
    'FileService',
    'LoadingService',
    'KeyboardService',
    '$compile',
    'AnimationService',
    function($scope, $state, $stateParams, $timeout, $localstorage, $interval, FileService,
             LoadingService, KeyboardService, $compile, AnimationService) {
        // (!$scope.user || !$scope.user.id) && $state.go('^.desktop-login');

        $timeout(function() {
            $scope.layout = {index:3};
        })
        $scope.$on('$ionicView.enter', function() {
            if (!$scope.user) {
                $scope.user = {name: 'jason', profile_url: 'https://uguru.me/static/web/images/team/jason.png'}
            }
            $scope.adminUser = {name: '', profile_url:''};
            first_name = $scope.user.name.split(' ')[0].toLowerCase();
            profile_url = $scope.user.profile_url;
            $scope.adminUser.name = first_name;
            $scope.adminUser.profile_url = profile_url;
            $timeout(function() {
                if (!$scope.layout.index) {
                    // initAll();
                    //     importLastAnimation();
                    //     importLastStage();
                }
            }, 2000)
        })

        var defaults = {
            KF_COUNT: 100,
            DURATION: 1,
            KF_INTERVALS:100,
            SHAPE_DICT: getShapeDict()
        }

        //@gabrielle
        var ctrlShortcuts = [

            {   letter: 's',
                description: 'Saves animation + stage',
                keyCode: 83,
                func: saveAll
            },
            {   letter: 't',
                description:'Toggles sidebar tab forward',
                keyCode: 84,
                func: toggleTabForward
            },
            {
                letter: 'i',
                description:'Opens import window',
                keyCode: 73,
                func: function() { $scope.root.triggers.runSequence(['click:#import-button:0'], 100) }
            },
            {
                letter: 'd',
                description:'Imports codepen and opens child selector',
                keyCode: 68,
                func: function() { $scope.root.triggers.runSequence(['click:#import-codepen-button:0', 'click:#select-child-button:50'], 100) }
            },
            {
                letter: 'e',
                description:'Opens export window',
                keyCode: 69,
                func: function() { $scope.root.triggers.runSequence(['click:#export-button:0'], 100) }
            },
            {
                letter: 'space',
                description:'Plays stage',
                keyCode: 32,
                func: function() { $scope.root.triggers.runSequence(['click:#play-stage-button:0'], 100) }
            },
            {
                letter: 'p',
                description:'Plays keyframes',
                keyCode: 80,
                func: function() { $scope.root.triggers.runSequence(['click:#play-keyframes-button:0'], 100) }
            },
            {
                letter: 'n',
                description:'Adds new time state',
                keyCode: 78,
                func: function() { $scope.root.triggers.runSequence(['click:#add-time-state-button:0'], 100) }
            },
            {
                letter: '1',
                description:'switches tab on import focus',
                keyCode: 49,
                func: function() { $scope.root.triggers.runSequence(['click:#import-tab-bar a:nth-child(1)'], 100) }
            },
            {
                letter: '2',
                description:'switches tab on import focus',
                keyCode: 50,
                func: function() { $scope.root.triggers.runSequence(['click:#import-tab-bar a:nth-child(2)'], 100) }
            },
            {
                letter: '3',
                description:'switches tab on import focus',
                keyCode: 51,
                func: function() { $scope.root.triggers.runSequence(['click:#import-tab-bar a:nth-child(3)'], 100) }
            },
            {
                letter: '4',
                description:'switches tab on import focus',
                keyCode: 52,
                func: function() { $scope.root.triggers.runSequence(['click:#import-tab-bar a:nth-child(4)'], 100) }
            }
            // {
            //  letter: 'left-arrow',
            //  description: 'shifts keyframe one to the left (if possible)',
            //  keyCode: 188,
            //  func: toggleSelectedKFToLeft
            // },
            // {
            //  letter: 'right-arrow',
            //  description: 'shifts keyframe one to the right (if possible)',
            //  keyCode: 190,
            //  func: toggleSelectedKFToRight
            // }
        ]

        $scope.player = initAnimationPlayer();
        $scope.timer = initAnimationTimer()
        $scope.defaults = {};
        $scope.animationDropdown = {toggleActive:true, options:['No animation selected', 'Import Animation'], selectedIndex: 0, label:'Current Animation', size:'small', onOptionClick:function(option, index) {if (index === 1) {$scope.layout.index = 1; $scope.importLayoutIndex = 1; } else if (index === 2) { ($scope.saveAnimationClass($scope.animation))} $timeout(function() {$scope.animationDropdown.selectedIndex = 0}, 500)}}
        $scope.stageDropdown = {toggleActive: true,options:['No stage selected', 'Import Stage'], selectedIndex: 0, label:'Current Stage', size:'small', onOptionClick: onStageDropdownSelected};
        $scope.keyframeBar = {pointerVal: 0};
        $scope.animationDict = {importTextarea:'', importInput: ''};
        $scope.imports = {animations: [], stages:[]};
        $scope.layout = {index: 0};
        $scope.shapesDropdown = {options: Object.keys(defaults.SHAPE_DICT), label: "Inject Shape", size: "normal", selectedIndex:0, onOptionClick: addSVGPlaceholder}
        $scope.animationDirectionOptions = {options: ["normal", "reverse", "alternate", "alternate-reverse"], selectedIndex: 0, size: "small", onOptionClick: setAnimationDirectionFunc};
        $scope.animationTimingFunc = {options: ["ease", "ease-in", "ease-out", "ease-in-out", "linear", "set-start", "step-end", "cubic"], selectedIndex: 0, size: "small", onOptionClick: setAnimationTimeFunc};
        $scope.animationFillMode = {options: ["none", "forwards", "backwards", "both"], selectedIndex: 0, size:'small', onOptionClick:setAnimationFillMode};
        // $scope.stage = $scope.imports.stages[0];

        function getHIWStage() {
            return {
                owner: 'samir',
                stageHtml: '<span class="initiator"> <svg id="stage-elem" on-double-tap="setAnimatableElement($event)" draggable width="100" height="100" viewBox="0 0 100 100"> <g fill="none"> <polygon stroke="rgba(255,255,255,0.8)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="50 1.5 98.5 25.75 98.5 74.25 50 98.5 1.5 74.25 1.5 25.75 "></polygon> <text font-size="18" font-weight="600" fill="rgba(255,255,255,0.8)" text-anchor="middle"> <tspan x="50" y="55">Library Icon</tspan> </text> </g> </svg><svg on-double-tap="setAnimatableElement($event)" draggable width="100" height="100" viewBox="0 0 100 100"> <g fill="none"> <polygon stroke="rgba(255,255,255,0.8)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="50 1.5 98.5 25.75 98.5 74.25 50 98.5 1.5 74.25 1.5 25.75 "></polygon> <text font-size="18" font-weight="600" fill="rgba(255,255,255,0.8)" text-anchor="middle"> <tspan x="50" y="55">Campus Stadium</tspan> </text> </g> </svg><svg on-double-tap="setAnimatableElement($event)" draggable width="100" height="100" viewBox="0 0 100 100"> <g fill="none"> <polygon stroke="rgba(255,255,255,0.8)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="50 1.5 98.5 25.75 98.5 74.25 50 98.5 1.5 74.25 1.5 25.75 "></polygon> <text font-size="18" font-weight="600" fill="rgba(255,255,255,0.8)" text-anchor="middle"> <tspan x="50" y="55">Campus Tower</tspan> </text> </g> </svg> <svg on-double-tap="setAnimatableElement($event)" draggable width="200" height="100" viewBox="0 0 200 100"> <g fill="none"> <rect stroke="rgba(255,255,255,0.8)" stroke-width="3" x="1.5" y="1.5" width="197" height="97" rx="10"></rect> <text font-size="18" font-weight="600" fill="rgba(255,255,255,0.8)" text-anchor="middle"> <tspan x="100" y="55">Uguru Billboard</tspan> </text> </g> </svg></span>',
                stageName: 'HIW-Stage-1',
                animElemSelector: '#stage-elem',
                stageCss: '',
                time_states: [{time: 1000, actions:[]}]
            }
        }

        function onStageDropdownSelected(option, index) {
            if (index === 1) {
                $scope.layout.index = 1;
                $scope.importLayoutIndex = 2;
            } else
            if (index === 2) {
                $scope.saveStageHtml($scope.animation);
            } else
            if (index === 3) {
                clearStageTemplate($scope.stage);
            }

            $timeout(
                function()
                {
                    $scope.stageDropdown.selectedIndex = 0
                }, 500)
        }

        function initNewStage(stage_name, html, css, anim_selector) {
            var anim_selector = anim_selector || '#stage-elem';
            var firstName = $scope.user && $scope.user.name && $scope.user.name.split(' ')[0].toLowerCase();
            return {
                owner: firstName || 'samir',
                stageHtml: html,
                stageName: stage_name,
                animElemSelector: anim_selector,
                stageCss: css,
                time_states: [{time: 1000, actions: []}]
            }
        }

        var callbackKeyDownFunc;
        var parentViewContainer = document.querySelector('#keys');
        var cmdPressed;
        var ctrlPressed;
        function saveAll(e) {
            // console.log('ctrl', e.keyCode, 'pressed');
            $scope.saveStageHtml();  $scope.saveAnimationClass($scope.animation, $scope.user.name.split(' ')[0].toLowerCase())};
        function toggleTabForward(e) {
            // console.log('right-arrow', e.keyCode, 'pressed');
            $scope.asideTabIndex = Math.abs(($scope.asideTabIndex + 1) % 3)};

        $scope.asideTabIndex = 2;
        $scope.kfTools = {cloneConfirm: false};
        $scope.animationPreview = {collapsed: true};
        $scope.kf_visuals = {arr: [], show: true, cache:true, onChange: triggerGetCSSRulesArr};
        $scope.intervals = {arr: [], enabled: false, count: 5, onCheck: onIntervalCheckbox, onChange: onChangeIntervalState};
        $scope.animationSneakPreview = {show: false, content: ''};
        $scope.showKFBarPercentage = {show: false};
        $scope.keyShortcuts = {
                ctrl: ctrlShortcuts
        }



        function onChangeIntervalState(count) {

            $timeout(function() {
                if ($scope.intervals.enabled) {
                    $scope.intervals.arr = newArrSize($scope.intervals.count);
                }
            })
        }

        function onIntervalCheckbox(value) {
            $timeout(function() {
                if (value) {
                    onChangeIntervalState($scope.intervals.count);
                }
                $scope.$apply();
            }, 100)
        }

        function getCSSRulesArr(css_rules) {
            var resultArr = [];
            for (var i = 0; i < css_rules.length; i++) {
                var indexRule = resultArr[i];
                resultArr.push({
                    keyText: css_rules.item(i).keyText,
                    onNgClick: setKFToActive
                })
            }
            console.log(resultArr);
            return resultArr.slice();

            function setKFToActive(kf_keytext) {
                $scope.setActiveKeyFrame(kf_keytext.replace('%', ''))
            }
        }

        function triggerGetCSSRulesArr(value) {
            $timeout(function () {
                if (value) {
                    $scope.kf_visuals.arr = getCSSRulesArr($scope.animation.obj.cssRules);
                }
                $scope.$apply();
            }, 100)
        }

        function newArrSize(num) {
            var resultArr = [];
            for (var i = 0; i <= num; i++) {
                var indexValue = i * 1.0 * (100.0/num);
                resultArr.push({
                    left: parseFloat(indexValue, 2),
                    value: indexValue,
                    onClick: $scope.setClosestActiveKeyFrame
                })
            }
            return resultArr;
        }
        $scope.newArrSize = newArrSize;
        $scope.getCSSRulesArr = getCSSRulesArr;
        $scope.cssRulesArr = [];

        function initShortCuts() {
            KeyboardService.initOptionPressedAndReleasedFunction(on_pressed_cmd, on_released_cmd, 91, 'metaKey', null, 1000);
            KeyboardService.initOptionPressedAndReleasedFunction(on_pressed_ctrl, on_released_ctrl, 17, 'ctrlKey', null,  100);
            function on_pressed_ctrl(e) {
                ctrlPressed = true;
                for (var i = 0; i < $scope.keyShortcuts.ctrl.length; i++) {
                    var indexKeyshortcut = $scope.keyShortcuts.ctrl[i];
                    initKeyboardFunctionOnce(indexKeyshortcut.letter, indexKeyshortcut.keyCode, indexKeyshortcut.func);
                }
            }

            function on_released_ctrl(e) {
                ctrlPressed = false;
                console.log('ctrl', ctrlPressed)
            }

            function on_pressed_cmd(e) {
                //save all
                //view short cuts
                //import
                //left --> toggle aside
                console.log('cmd pressed');
                cmdPressed = true;
                $timeout(function() {
                    if (cmdPressed) {
                        console.log('should be showing shortcuts');
                        $scope.showShortcuts = true;
                    }
                }, 1000)

            }
            function on_released_cmd(e) {
                cmdPressed = false;
                $scope.showShortcuts = false;
                parentViewContainer.removeEventListener(callbackKeyDownFunc, function(e) {console.log(e, 'keydown event listener removed')});

            }
        }

        function initKeyboardFunctionOnce(key, code, cb_pressed) {
            console.log('initializing', key, code);
            var defaultOnRelease = function(e) {
                console.log(key, e.keyCode, 'released');
                $timeout(function() {
                    document.removeEventListener('keyup', cb_pressed);
                    document.removeEventListener('keydown', defaultOnRelease);
                }, 2500);
            }
            KeyboardService.initOptionPressedAndReleasedFunction(cb_pressed, defaultOnRelease, code, null, true, 100);
        }

        function findStageByName(stage_name) {
            if (!$scope.imports.stages || !$scope.imports.stages.length) {
                console.log('stages from amazon not yet loaded.. trying again in 2seconds')
                // $timeout(function() {
                //  initStageDropdown();
                // }, 2000)
                return;
            }
            for (var i = 0; i < $scope.imports.stages.length; i++) {
                var stageIndex = $scope.imports.stages[i];
                if (stageIndex.stageName === stage_name) {
                    return stageIndex;
                }
            }
        }

        function initStageDropdown() {
            var lastActiveStageName = $localstorage.getObject('last_stage_active');
            if (lastActiveStageName && lastActiveStageName.length) {
                // var lastUsedStage = findStageByName(lastActiveStageName);
                // if (lastUsedStage) {
                //  var stageOptions = [lastActiveStageName, 'save', 'save and import', 'save and clear'];
                //  var stageLabel = 'Active Stage'
                //  $scope.stageDropdown = {options: stageOptions, selectedIndex:0, label: stageLabel, onOptionClick:onStageDropdownClick, stageActive:true, size:'small'};
                //  importPageDom(lastUsedStage);
                //  return;
                // }

            } else {
                var stageOptions = ['none', 'import stage', 'create new stage'];
                var stageLabel = "Current Stage"
                // $scope.stageDropdown = {options: stageOptions, selectedIndex:0, label: stageLabel, onOptionClick:onStageDropdownClick, stageActive:false, size:'small'};
                return {options: stageOptions, selectedIndex:0, label: stageLabel, onOptionClick:onStageDropdownClick, stageActive:false, size:'small'};
            }

            // if (lastActiveStage)
            // var stageInactiveOptions = ['import stage', 'init stage', 'clear stage'];
            //if init stage, ask for name right away
        }

        function onStageDropdownClick(option, index) {
                if ($scope.stageDropdown.stageActive) {
                    switch (index) {
                        case 1:
                            $scope.saveStageHtml();
                            $scope.stageDropdown.selectedIndex = 0;
                            break
                        case 2:
                            $scope.saveStageHtml();
                            $timeout(function() {
                                $scope.layout.index = 1;
                                $scope.importLayoutIndex = 3;
                                $scope.stageDropdown.selectedIndex = 0;
                            }, 1500);
                            break;
                        case 3:
                            $scope.saveStageHtml();
                            $timeout(function() {
                                $scope.stage = null;
                                $scope.resetStageDom();
                                $localstorage.setObject('last_stage_active', null);
                            }, 1500);
                            break;
                    }
                } else {
                    switch (index) {
                        case 1:
                            $scope.layout.index = 1;
                            $scope.importLayoutIndex = 3;
                            $scope.stageDropdown.selectedIndex = 0;
                            return;
                        case 2:
                            $scope.layout.index = 1;
                            $scope.importLayoutIndex = 3;
                            $scope.stageDropdown.selectedIndex = 0;
                            return;
                    }
                }
            }

        $scope.goToEditAnimationClass = function() {
            $scope.layout.index = 1;
            $scope.importLayoutIndex = 1;

            $timeout(function() {
                $scope.animationImportSearchText = $scope.animation.obj.name;
                $timeout(function() {
                    var elemAnimationInput = document.querySelector('#import-animation-input');
                    elemAnimationInput && elemAnimationInput.select();
                }, 500)
            }, 100)
        }
        function saveDropdownOnClick(option, index) {
            if (index === 1) {
                $scope.saveStageHtml()
            } else
            if (index === 2) {
                $scope.saveAnimationClass($scope.animation);
            } else
            if (index === 3) {
                $scope.saveAnimationClass();
                $timeout(function() {
                    $scope.saveStageHtml();
                }, 5000)
            }
        }

        $scope.onTimeStateBlur = function(time_state) {
            time_state.editMode = false;
            $scope.stage.time_states.sort(function(time_state_a, time_state_b) {
                return parseInt(time_state_b.time) - parseInt(time_state_a.time);
            }).reverse();
        }

        $scope.onTimeStateActionComponentInputFocused = function(time_state, action) {
            $scope.cancelTimeStateActionAnimationClassInputFocused();
            $scope.stage.selectComponentMode = true;
            $scope.stage.selectComponentModeTimeState = time_state;
            $scope.stage.selectComponentModeAction = action;
            var stageContainer = document.querySelector('#stage-container');
            var allDraggableElems = stageContainer.querySelectorAll('[draggable]');
            $scope.stage.components = [];
            for (var i = 0; i < allDraggableElems.length; i++) {
                $scope.stage.components.push({selector: '[draggable-clone-' + i + ']'});
            }
            $timeout(function() {
                $scope.$apply();
                $timeout(function() {
                    for (var i = 0; i < allDraggableElems.length; i++) {
                        var indexElem = allDraggableElems[i];
                        $scope.stage.components[i]._class = indexElem.getAttribute('class');
                        indexElem.setAttribute('draggable-' + i, null);
                        var clonedNode = indexElem.cloneNode(true);
                        clonedNode.removeAttribute('draggable');
                        clonedNode.setAttribute('draggable-clone', null);
                        clonedNode.setAttribute('draggable-clone-' + i, null);

                        var allContainers = document.querySelectorAll('.cloned-animatable-elem-container')
                        var indexContainer = allContainers[i];
                        var allShapes = ['path', 'line', 'polygon', 'polyline', 'g', 'rect', 'ellipse', 'circle', 'tspan', 'text'];
                        if (allShapes.indexOf(clonedNode.nodeName) > -1) {
                            var parentSVG = findParentSVG(indexElem);
                            var clonedParentSVG = parentSVG.cloneNode(true);
                            clonedParentSVG.innerHTML = "";
                            clonedParentSVG.appendChild(clonedNode);
                            clonedParentSVG.className += ' absolute';
                            clonedParentSVG.style.minWidth = "100px";
                            clonedParentSVG.style.minHeight = "100px";
                            clonedParentSVG.style.maxWidth = "200px";
                            clonedParentSVG.style.maxHeight = "200px";
                            indexContainer.appendChild(clonedParentSVG);
                            secondClonedParent = clonedParentSVG.cloneNode(true)
                            indexContainer.appendChild(secondClonedParent);
                        } else {
                            clonedNode.className += ' absolute';
                            clonedNode.style.minWidth = "100px";
                            clonedNode.style.minHeight = "100px";
                            clonedNode.style.maxWidth = "200px";
                            clonedNode.style.maxHeight = "200px";
                            indexContainer.appendChild(clonedNode);
                            secondClonedNode = clonedNode.cloneNode(true)
                            indexContainer.appendChild(secondClonedNode);
                        }
                    }
                })
            })
        }

        $scope.onTSActionComponentSelected = function(selector, $event) {
            $scope.stage.selectComponentModeAction.selector = selector;
            $scope.cancelTimeStateActionComponentInputFocused();
        }

        $scope.clearCache = function() {
            window.sessionStorage.clear();
            window.localStorage.clear();
            window.location.reload(true);
        }

        $scope.onTSActionAnimationClassSelected = function(animation) {
            var cssText = animation.cssText;
            var animName = animation.name;
            var animClassText = animation.classText;
            var js_anim_obj = importAnimationFromRawCssText(cssText, animName);
            var final_obj = initAnimationFromAnimObj(js_anim_obj);
            $scope.stage.selectComponentModeAction.animation = final_obj;
            console.log(final_obj);
            // var rawCSSText = indexCssRule.cssText;
            // var animationName = indexCssRule.name;
            // console.log('processing', animationName);
            // $scope.saveAnimationClass(final_obj, styleSheetName);
            // $scope.importFromCSSText(animation.cssText, animation.name, animation.classText);

            // $scope.stage.selectComponentModeAction.selector = selector;
            $scope.cancelTimeStateActionAnimationClassInputFocused();
        }

        $scope.onTimeStateActionAnimationClassInputFocused = function(time_state, action) {
            $scope.cancelTimeStateActionComponentInputFocused();
            $scope.stage.searchAnimationMode = true;
            $scope.stage.searchAnimationModeTimeState = time_state;
            $scope.stage.selectComponentModeAction = action;
        }

        $scope.cancelTimeStateActionAnimationClassInputFocused = function(time_state) {
            $scope.stage.searchAnimationMode = false;
            $scope.stage.searchAnimationModeTimeState = null;
            $scope.stage.selectComponentModeAction = null;
        }

        $scope.cancelTimeStateActionComponentInputFocused = function(time_state) {
            $scope.stage.selectComponentMode = false;
            $scope.selectComponentModeTimeState = null;
            $scope.stage.selectComponentModeAction = null;
        }

        $scope.removeTimeState = function(time_state, index) {
            $scope.stage.time_states.splice(index, 1);
        }

        $scope.initStageTimeState = function() {
            if (!$scope.stage.time_states) {
                $scope.stage.time_states = [];
            }
            for (var i = 0; i < $scope.stage.time_states.length; i++) {
                var indexTimeState = $scope.stage.time_states[i];
                if (!indexTimeState.time) {
                    LoadingService.show('There is already a time state without a time! Please remove or use that one');
                    return;
                }
            }
            $scope.stage.time_states.push({description:null, time:1000, editMode:true, actions:[]});
            $timeout(function() {
                $scope.$apply();
                var allActionInputs = document.querySelectorAll('input.time-input');
                if (allActionInputs && allActionInputs.length) {
                    var timeElem = allActionInputs[allActionInputs.length - 1]
                    timeElem.select();
                }
            })
        }

        $scope.playStageTimeStates = function() {
            var stageElem = document.querySelector('#stage-container');
            var time_states = $scope.stage.time_states;
            if (stageElem) {
                $scope.stage.cache_html = stageElem.innerHTML;
            }

            var maxTimeState = 0;
            for (var i = 0; i < time_states.length; i++) {
                var indexTimeDelay = time_states[i].time;
                playTimeState(time_states[i].time, time_states[i].actions)
                if (parseInt(indexTimeDelay) > maxTimeState) {
                    maxTimeState = indexTimeDelay;
                }
            }
            console.log('max time is', maxTimeState, 'ms');

            $timeout(function() {
                console.log('reinitializing in 5s');
                stageElem.innerHTML = $scope.stage.cache_html;
                $compile(stageElem)($scope);
            }, maxTimeState + 5000);
            $timeout(function() {
                LoadingService.showMsg('Reinitializing stage...', 2500, function() {
                    LoadingService.showSuccess('Stage successfully reset', 2000);
                });
            }, 2500)

            function playTimeState(time_delay, actions) {
                $timeout(function() {
                    for (var j = 0; j < actions.length; j++) {
                        var index_action = actions[j];
                        var indexAnimation = index_action.animation;
                        var indexStageSelector = index_action.selector.replace('-clone', '');
                        var actionElem = document.querySelector(indexStageSelector);

                        actionElem.style[browserPrefix + 'AnimationName'] = indexAnimation.obj.name;
                        actionElem.style['animationName'] = indexAnimation.obj.name;
                        actionElem.style[browserPrefix + 'AnimationDuration'] = indexAnimation.attr.duration;
                        actionElem.style['animationDuration'] = indexAnimation.attr.duration;
                        actionElem.style[browserPrefix + 'AnimationIterationCount'] = indexAnimation.attr.iteration_count;
                        actionElem.style['animationIterationCount'] = indexAnimation.attr.iteration_count;
                        actionElem.style[browserPrefix + 'AnimationTimingFunction'] = indexAnimation.attr.timing_function;
                        actionElem.style['animationTimingFunction'] = indexAnimation.attr.timing_function;
                        actionElem.style[browserPrefix + 'AnimationFillMode'] = indexAnimation.attr.fill_mode;
                        actionElem.style['animationFillMode'] = indexAnimation.attr.fill_mode;
                        actionElem.style[browserPrefix + 'AnimationDirection'] = indexAnimation.attr.direction;
                        actionElem.style['animationDirection'] = indexAnimation.attr.direction;
                        actionElem.style[browserPrefix + 'AnimationDelay'] = indexAnimation.attr.delay;
                        actionElem.style['animationDelay'] = indexAnimation.attr.delay;

                    }
                }, parseInt(time_delay))
            }
        }

        $scope.addActionToTimeState = function(time_state) {
            time_state.actions.push({selector: 'replace with selector', animation: {attr:{name:'replace w/ animation'}}});
            $timeout(function() {
                $scope.$apply();
                var allActionInputs = document.querySelectorAll('input.action-input');
                if (allActionInputs && allActionInputs.length) {
                    var classElem = allActionInputs[allActionInputs.length - 1]
                    var selectorElem = allActionInputs[allActionInputs.length - 2];
                    selectorElem.select();
                }
            })
        }

        $scope.remoteStateTimeStates = function(time_state, index) {
            if (time_state.time_confirmed && time_state.time_approved) {
                $scope.stage.time_state.splice(index, 1);
            }
        }

        function getShapeDict() {
            var shapeDict = {
                circle: '<svg on-double-tap="setAnimatableElement($event)" draggable width="100" height="100" viewBox="0 0 100 100"><g fill="none"><circle stroke="rgba(255,255,255,0.8)" stroke-width="3" cx="50" cy="50" r="48.5"></circle><text font-size="18" font-weight="600" fill="rgba(255,255,255,0.8)" text-anchor="middle"><tspan x="50" y="54">circle</tspan></text></g></svg>',
                square: '<svg on-double-tap="setAnimatableElement($event)" draggable width="100" height="100" viewBox="0 0 100 100"> <g fill="none"> <rect stroke="rgba(255,255,255,0.8)" stroke-width="3" x="1.5" y="1.5" width="97" height="97" rx="10"></rect> <text font-size="18" font-weight="600" fill="rgba(255,255,255,0.8)" text-anchor="middle"> <tspan x="50" y="54">square</tspan> </text> </g> </svg>',
                rect: '<svg on-double-tap="setAnimatableElement($event)" draggable width="200" height="100" viewBox="0 0 200 100"> <g fill="none"> <rect stroke="rgba(255,255,255,0.8)" stroke-width="3" x="1.5" y="1.5" width="197" height="97" rx="10"></rect> <text font-size="18" font-weight="600" fill="rgba(255,255,255,0.8)" text-anchor="middle"> <tspan x="100" y="55">rectangle</tspan> </text> </g> </svg>',
                hexagon: '<svg on-double-tap="setAnimatableElement($event)" draggable width="100" height="100" viewBox="0 0 100 100"> <g fill="none"> <polygon stroke="rgba(255,255,255,0.8)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="50 1.5 98.5 25.75 98.5 74.25 50 98.5 1.5 74.25 1.5 25.75 "></polygon> <text font-size="18" font-weight="600" fill="rgba(255,255,255,0.8)" text-anchor="middle"> <tspan x="50" y="55">hexagon</tspan> </text> </g> </svg>',
                octagon: '<svg on-double-tap="setAnimatableElement($event)" draggable width="100" height="100" viewBox="0 0 100 100"> <g fill="none"> <text font-size="18" font-weight="600" fill="rgba(255,255,255,0.8)" text-anchor="middle"> <tspan x="50" y="55">octagon</tspan> </text> <path d="M70.0893578,1.5 L98.5,29.9106422 L98.5,70.0893578 L70.0893578,98.5 L29.9106422,98.5 L1.5,70.0893578 L1.5,29.9106422 L29.9106422,1.5 L70.0893578,1.5 L70.0893578,1.5 Z" stroke="rgba(255,255,255,0.8)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path> </g> </svg>',
                parallelogram: '<svg on-double-tap="setAnimatableElement($event)" draggable width="200" height="50" viewBox="0 0 200 50"> <g fill="none"> <path d="M23.2259184,5.95340971 C24.481859,3.49385944 27.7347336,1.5 30.4909811,1.5 L188.498497,1.5 C194.022175,1.5 196.747033,5.61947272 194.58442,10.7016135 L180.454099,43.9078668 C179.37488,46.4440319 176.262066,48.5 173.499572,48.5 L11.4913933,48.5 C5.97329914,48.5 3.53587345,44.5130812 6.04949493,39.5905724 L23.2259184,5.95340971 Z" stroke="rgba(255,255,255,0.8)" stroke-width="3"></path> <text font-size="18" font-weight="600" fill="rgba(255,255,255,0.8)" text-anchor="middle"> <tspan x="100" y="30">parallelogram</tspan> </text> </g> </svg>',
                custom: null,
            }
            return shapeDict;
        }

        $scope.pageDom = {stageHtml: "", animElemSelector: "stage-elem", stageCss: ""};
        $scope.goToEditPageDom = function() {
            $scope.pageDom.stageHtml = document.querySelector('#stage-container').innerHTML;
        }

        function addSVGPlaceholder(svg_shape)  {


            if (svg_shape in defaults.SHAPE_DICT) {
                var newDiv = $scope.appendToPageDom(defaults.SHAPE_DICT[svg_shape]);
            }

            var stageElem = document.querySelector('#stage-container');
            var actorElem = stageElem.querySelector('#stage-elem') || stageElem.querySelector('#' + $scope.pageDom.animElemSelector);
            if (!actorElem) {
                $scope.setAnimatableElement({target: newDiv});
            }

        }

        $scope.addSVGPlaceholder = addSVGPlaceholder;

        $scope.resetStageDom = function() {
            var resetHtml = '<span class="initiator"> Html Successfully Reset! <br> Add some svg placeholder elements ! </span>'
            $scope.pageDom.stageHtml = resetHtml;
            $scope.pageDom.stageName = null;
            $scope.pageDom.stageCss = null;
            $scope.pageDom.animElemSelector = null;
            $scope.stageDropdown.options[0] = 'No stage selected';

            LoadingService.showMsg('Resetting', 3000, function() {
                LoadingService.showSuccess('Success!', 2000);
                $scope.updatePageDom();
            })
        }

        $scope.appendToPageDom = function(html_node) {
            var tempWrapper= document.createElement('div');
            tempWrapper.innerHTML= html_node;
            var div= tempWrapper.firstChild;
            $compile(div)($scope);
            var stageElem = document.querySelector('#stage-container');
            var stageContainsInitiator = stageElem.querySelector('.initiator');
            if (stageContainsInitiator) {
                stageElem.removeChild(stageContainsInitiator);
            }
            stageElem.appendChild(div);
            return div;
        }

        $scope.selectComponentElement = function(component, $index, $event) {
            if (!$scope.asideTabIndex) {
                $scope.onTSActionComponentSelected(component.selector)
            } else {
                $scope.addAnimatableElement(component);

            }
        }

        $scope.addAnimatableElement = function(component) {
            if (!$scope.stage.anim_elements) {
                $scope.stage.anim_elements = [{selector: '#stage-elem', type:$scope.actor.nodeName}];
            }
            var stageContainer = document.querySelector('#stage-container');
            var numDraggable = stageContainer.querySelectorAll('[draggable]').length;
            if (component.orig_elem) {
                component.orig_elem.setAttribute("draggable", null);
                component.orig_elem.setAttribute("draggable-" + numDraggable, null);
                component.selector = "[draggable-" + numDraggable + ']';
                $timeout(function() {
                    $compile(component.orig_elem)($scope);
                    $scope.$apply();
                    component.orig_elem = null;
                })
            }
            $scope.stage.anim_elements.push(component);
            $timeout(function() {
                renderAsideAnimatableElems();
                $scope.$apply();
            }, 100)
        }

        $scope.swapFocusedAnimatedElem = function(anim_elem) {
            $scope.actor.id = null;
            $scope.actor = null;
            // $scope.actor.setAttribute(anim_elem.replace('[','').replace(']', ''), null);
            // $scope.actor.setAttribute('draggable', null);
            var newStageElem = document.querySelector(anim_elem.selector);
            $scope.setAnimatableElement({target:newStageElem});
            $timeout(function() {
                updateStageElemCloneAside();
                renderAsideAnimatableElems();
            })

        }

        $scope.setAnimatableElement = function($event) {



            var elem = $event.target;

            var allCurrentStageElems = document.querySelectorAll('#stage-elem');
            for (var i = 0; i < allCurrentStageElems.length; i++) {
                var indexCurrentStageElem = allCurrentStageElems[i];
                console.log('removing id stage-elem for elem', indexCurrentStageElem);
                indexCurrentStageElem.id = null;
            }

            elem.id = $scope.pageDom.animElemSelector || '#stage-elem';
            $scope.actor = elem;
            LoadingService.showMsg('updating...', 1000, function() {
                LoadingService.showSuccess('Complete!', 1000);
            })
            var stageElem = document.querySelector('#stage-container');
            // elem.style.stroke = 'white';
            // if (elem.nodeName === 'svg') {
            //  var allInnerElements = elem.querySelectorAll('polgyon, rect, circle, path, text');
            //  for (var i = 0; i < allInnerElements.length; i++) {
            //      var indexElem = allInnerElements[i];
            //      if (indexElem.nodeName === 'text') {
            //          indexElem.style.fill = 'white';
            //      } else {
            //          indexElem.style.stroke = 'white';
            //      }

            //  }
            // }
            $compile(stageElem)($scope);
            elem.classList.add('animated', 'pulse');
            $timeout(function() {
                elem.classList.remove('animated', 'pulse', 'infinite');
            }, 1000)
        }

        function importPageDom(stage_template) {

            $scope.stage = stage_template;
            $scope.stageDropdown.options[0] = stage_template.stageName;
            if (!$scope.stage.time_states || !$scope.stage.time_states.length) {
                $scope.stage.time_states = [];
            }
            for (var i = 0; i < $scope.stage.time_states.length; i++) {
                var indexTimeState = $scope.stage.time_states[i];
                for (var j = 0; j < indexTimeState.actions.length; j++) {
                    var indexAction = indexTimeState.actions[j];
                    if (indexAction.animation && indexAction.animation.attr && indexAction.animation.attr.name) {
                        var animationObj = findAnimationByName(indexAction.animation.attr.name, $scope.imports.animations)
                        var cssText = animationObj.cssText;
                        var animName = animationObj.name;
                        var animClassText = animationObj.classText;

                        indexAction.animation = importAndProcessAnimationCSSTextByKF(cssText, animName);
                    }
                }
            }
            $localstorage.setObject('last_stage_active', $scope.stage.stageName);

            $scope.updatePageDom(stage_template.stageName, stage_template.stageHtml, stage_template.stageCss, stage_template.animElemSelector.replace('#', ''));
        }
        $scope.importPageDom = importPageDom;

        function findAnimationByName(name, animation_arr) {
            for (var i = 0; i < animation_arr.length; i++) {
                var indexAnimation = animation_arr[i];
                if (indexAnimation.name === name) {
                    return indexAnimation
                }
            }
        }
        function updateStageElemCloneAside(stage_elem) {
            var stageElem = stage_elem || document.querySelector('#stage-elem');
            if (!stageElem) {
                var stageContainer = document.querySelector('#stage-container');
                stageElem = stageContainer.firstChild;
            }


            var allStageElemNodes = document.querySelectorAll('.stage-elem-clone-container')
            for (var i = 0; i < allStageElemNodes.length; i++) {
                var clonedNode = stageElem.cloneNode(true);
                var asideElementContainer = allStageElemNodes[i];

                if (asideElementContainer) {
                    asideElementContainer.innerHTML = '';
                    var allShapes = ['path', 'line', 'polygon', 'polyline', 'g', 'rect', 'ellipse', 'circle', 'tspan', 'text'];
                    if (allShapes.indexOf(clonedNode.nodeName) > -1) {
                        var parentSVG = findParentSVG(stageElem);
                        var clonedParentSVG = parentSVG.cloneNode(true);
                        clonedParentSVG.innerHTML = "";
                        clonedParentSVG.appendChild(clonedNode);
                        clonedParentSVG.id = 'stage-elem-clone-' + i;
                        clonedParentSVG.className += ' absolute';
                        clonedParentSVG.style.minWidth = "150px";
                        clonedParentSVG.style.minHeight = "150px";
                        clonedParentSVG.style.maxWidth = "200px";
                        clonedParentSVG.style.maxHeight = "200px";
                        asideElementContainer.appendChild(clonedParentSVG);
                    }
                    else {
                        clonedNode.id = 'stage-elem-clone-' + i;
                        clonedNode.style.minWidth = "150px";
                        clonedNode.style.minHeight = "150px";
                        clonedNode.className += ' absolute';
                        clonedNode.style.maxWidth = "200px";
                        clonedNode.style.maxHeight = "200px";
                        asideElementContainer.appendChild(clonedNode);
                    }
                }
            }
            $timeout(function() {
                $scope.$apply();
            })
        }

        $scope.updatePageDom = function(stage_name, stage_html, stage_css, anim_selector) {
            $scope.pageDom.stageHtml = stage_html || $scope.pageDom.stageHtml;
            $scope.pageDom.stageCss = stage_css || $scope.pageDom.stageCss;
            $scope.pageDom.stageName = stage_name || $scope.pageDom.stageName;
            $scope.pageDom.animElemSelector = anim_selector || $scope.pageDom.animElemSelector;

            LoadingService.showAmbig(null, 1000);
            if ($scope.pageDom.stageHtml && $scope.pageDom.stageHtml.length) {
                if (!$scope.stage) {
                    $scope.stage = $scope.pageDom;
                }
                var stageContainer = document.querySelector('#stage-container');
                stageContainer.innerHTML = $scope.pageDom.stageHtml;
                if (stageContainer.firstChild) {
                    var stageElem = document.querySelector('#stage-elem');
                    if (stageElem) {
                        $scope.actor = stageElem;
                        stageElem.setAttribute("draggable", true);
                        updateStageElemCloneAside();
                    } else {
                        if (stageContainer && stageContainer.firstChild) {
                            $scope.actor = stageContainer.firstChild;
                            if (stageContainer.firstChild.setAttribute) {
                                stageContainer.firstChild.setAttribute("draggable", true);
                                updateStageElemCloneAside();
                            }
                        } else {
                            $timeout(function() {
                                $scope.updatePageDom(stage_name, stage_html, stage_css, anim_selector);
                            }, 1000)
                        }
                    }
                    if (stageContainer.children && stageContainer.children.length === 1) {
                        var firstChild = stageContainer.children[0];
                        var firstChildDimensions = firstChild.getBoundingClientRect();

                        if (!firstChildDimensions.height || !firstChildDimensions.width) {

                                firstChild.style.height = "50%";
                                firstChild.style.width = "50%";
                                firstChild.style.left = "0";
                                firstChild.style.top = "0";
                        }
                    }
                }
                $compile(stageContainer)($scope);
                // $scope.asideTabIndex = 1;
                if ($scope.pageDom.stageName && $scope.pageDom.stageName.length && $scope.pageDom.stageHtml && $scope.pageDom.stageHtml.length) {
                    $localstorage.setObject('last_stage', $scope.pageDom);
                    $scope.stageDropdown.options[0] = $scope.pageDom.stageName
                    if ($scope.stageDropdown.options.length <= 2 && $scope.pageDom.stageName && $scope.pageDom.stageName.length) {
                        $scope.stageDropdown.options.push('Save');
                        $scope.stageDropdown.options.push('Clear');
                    }
                }
                // var clonedNode = stageElem.cloneNode(true);
                // clonedNode.id = 'stage-elem-clone';
                // clonedNode.style.minWidth = "200px";
                // clonedNode.style.minHeight = "200px";
                // var asideElementContainer = document.querySelector('#stage-elem-clone-container')
                // if (asideElementContainer) {
                //  asideElementContainer.innerHTML = '';
                //  asideElementContainer.appendChild(clonedNode);
                // }
                // $timeout(function() {
                //  $scope.$apply();
                // })
            }

            if ($scope.pageDom.animElemSelector && $scope.pageDom.animElemSelector.length && $scope.pageDom.animElemSelector !== $scope.actor.id) {
                var newAnimationElem = document.querySelector('#' + $scope.pageDom.animElemSelector);
                if (newAnimationElem) {
                    $scope.actor = newAnimationElem;
                }
            }

            if ($scope.pageDom.stageCss && $scope.pageDom.stageCss.length) {
                var previousStyle = document.querySelector('#stage-css');
                var stageElem = document.querySelector('#stage-container');
                if (previousStyle) {
                    previousStyle.parentNode.removeChild(previousStyle);
                }
                var style = document.createElement("style");
                style.setAttribute('id', 'stage-css');
                style.innerHTML = $scope.pageDom.stageCss;
                document.getElementsByTagName("head")[0].appendChild(style);
                $compile(stageElem)($scope);
            } else {
                var previousStyle = document.querySelector('#stage-css');
                if (previousStyle) {
                    previousStyle.parentNode.removeChild(previousStyle);
                }
            }
            // $scope.layout.index = 0;
        }

        function setAnimationFillMode(option, index) {
            $scope.animation.attr.fill_mode = option;
        }

        $scope.updateNumIntervals = function(num_intervals) {
            if (num_keyframes === 'auto') {
                var firstKeyText = Object.keys($scope.animation.properties)[0];
                $scope.setActiveKeyFrame(firstKeyText)
                return;
            }
            defaults.KF_INTERVALS = num_intervals;
            $scope.setActiveKeyFrame(0 + '%');
            $scope.asideTabIndex = 2;
        }

        function setAnimationDirectionFunc(option, index) {
            $scope.animation.attr.direction = option;
        }

        function setAnimationTimeFunc(option, index) {
            if (index === $scope.animationTimingFunc.options.length - 1) {
                option = "cubic-bezier(0.1, 0.7, 1.0, 0.1)";
            }
            $scope.animation.attr.timing_function = option;

        }


        function toggleSelectedKFToRight() {
            var animPropertyPercentages = Object.keys($scope.animation.properties);
            var currentKFIndex = animPropertyPercentages.indexOf($scope.animation.selected_percent);
            if (currentKFIndex > -1) {
                var desiredPercentage =  animPropertyPercentages[(currentKFIndex + 1) % animPropertyPercentages.length];
                var percentValue = desiredPercentage.replace('%', '');
                console.log('current percent', desiredPercentage);
                $scope.setActiveKeyFrame(percentValue, currentKFIndex);
                $scope.asideTabIndex = 2;
            }
            $scope.showKFBarPercentage.show = true;
            $timeout(function() {
                $scope.showKFBarPercentage.show = false;
            }, 5000)
        }

        function toggleSelectedKFToLeft() {
            var animPropertyPercentages = Object.keys($scope.animation.properties);
            var currentKFIndex = animPropertyPercentages.indexOf($scope.animation.selected_percent);
            if (currentKFIndex > -1 && currentKFIndex < animPropertyPercentages.length) {
                if (currentKFIndex === 0) {
                    var desiredPercentage = animPropertyPercentages[animPropertyPercentages.length - 1];
                } else {


                    var desiredPercentage =  animPropertyPercentages[currentKFIndex - 1];
                }
                var percentValue = desiredPercentage.replace('%', '');
                $scope.setActiveKeyFrame(percentValue, currentKFIndex);
                $scope.asideTabIndex = 2;
            }
            $scope.showKFBarPercentage.show = true;
            $timeout(function() {
                $scope.showKFBarPercentage.show = false;
            }, 5000)
        }
        $scope.toggleLeftKFPlayBar = toggleSelectedKFToLeft
        $scope.toggleRightKFPlayBar = toggleSelectedKFToRight;

        $scope.setClosestActiveKeyFrame = function(new_index) {
            var animationPercentages = Object.keys($scope.animation.properties);
            animationPercentages.sort(function(val_a, val_b) {return parseFloat(val_b.replace('%', '')) - parseFloat(val_a.replace('%', ''))}).reverse();
            console.log(new_index, animationPercentages);
            var dMin = 101;
            var resultIndex = 0;
            for (var i = 0 ; i < animationPercentages.length; i++) {
                var indexPercentage = parseFloat(animationPercentages[i].replace('%', ''));
                var dX = Math.abs(new_index - indexPercentage);
                if (dX <= dMin) {
                    dMin = dX;
                    resultIndex = i;
                }
            }
            var closestPercentage = animationPercentages[resultIndex];
            $scope.animation.selected_kf_index = parseFloat(closestPercentage.replace('%', ''));
            $scope.setActiveKeyFrame(closestPercentage.replace('%', ''), resultIndex);
        }


        $scope.setActiveKeyFrame = function(value, index_value) {

            if (!index_value) {
                index_value = Object.keys($scope.animation.properties).indexOf(value + '%');
            }
            var intervalLength = parseInt(100/$scope.animation.attr.kf_intervals);
            var propertyDictCssMap = {'translateX': 'translateX', 'translateY': 'translateY', 'translateZ': 'translateZ', 'scale3DX': 'scaleX', 'scale3DY': 'scaleY', 'skewX':'skewX', 'skewY': 'skewY', 'rotate3DZ':'rotateZ', 'rotate3DY': 'rotateY', 'rotate3DX': 'rotateX', 'rotate3DAngle': 'rotate'};
            var propertyDictCssUnit = {'translateX': '%', 'translateY': '%', 'translateZ': 'px', 'scale3DX': '', 'scale3DY': '', 'skewX':'rad', 'skewY': 'rad', 'rotate3DZ':'rad', 'rotate3DY': 'rad', 'rotate3DX': 'rad', 'rotate3DAngle': 'rad'};



            var oldValue = $scope.animation.selected_index;
            var newPercentValue = value;
            $scope.animation.selected_kf_index = parseInt(value);
            $scope.animation.selected_index = index_value;
            $scope.animation.selected_percent = value + '%';
            $scope.animation.flex_selected_index = value;
            var newValue = value;
            $scope.animation.selected_keyframe = $scope.animation.properties[$scope.animation.selected_percent];
            var propertiesSorted = Object.keys($scope.animation.properties).sort(function(a, b) {
                return parseFloat(b.replace('%', '')) - parseFloat(a.replace('%', ''))
            }).reverse();
            var valueIndex = propertiesSorted.indexOf(value);


            //going backwards
            //for each property, check the last one it was edited, apply it to that
            //

            var currentPropertiesModified = Object.keys($scope.animation.properties[$scope.animation.selected_percent].modified);
            console.log($scope.animation.selected_percent, $scope.animation.properties[$scope.animation.selected_percent], currentPropertiesModified);
            var cssToChange;
            if (true) {
                var transformProperties = Object.keys(propertyDictCssMap);
                var nonTransformProperties = ['opacity', 'fill', 'backgroundColor', 'strokeDashArray', 'strokeOpacity', 'transformOrigin', 'strokeWidth', 'strokeDashOffset','stroke', 'fillOpacity', 'color'];
                var cssToChange = {transform: {}, etc: {}};
                for (var i = 0; i < currentPropertiesModified.length - 1; i++) {
                    var indexPropertyName = currentPropertiesModified[i]
                    for (var j = 0; j < valueIndex - 1; j++) {
                        console.log('checking t=', j, 'for traces of', indexPropertyName);
                        var previousIndexPercentValue = propertiesSorted[j];
                        if (!previousIndexPercentValue) {
                            continue;
                        }
                        var previousIndexProperty = $scope.animation.properties[previousIndexPercentValue];

                        var previousPropertyModifiedKeys = Object.keys(previousIndexProperty.modified);
                        if (previousPropertyModifiedKeys.indexOf(indexPropertyName) > -1) {
                            if (indexPropertyName in propertyDictCssMap) {
                                var cssVar = propertyDictCssMap[indexPropertyName];
                                var cssUnit = propertyDictCssUnit[indexPropertyName];
                                cssToChange.transform[propertyDictCssMap[indexPropertyName]] = '(' + previousIndexProperty[indexPropertyName] + cssUnit + ')';
                            } else {
                                cssVar = indexPropertyName;
                                cssValue = previousIndexProperty[indexPropertyName];
                                var cssUnit = '';
                                cssToChange.etc[cssVar] = cssValue;
                            }

                            console.log('setting', cssVar, 'at t=', j, 'from', $scope.animation.selected_keyframe[indexPropertyName] + cssUnit, 'to', previousIndexProperty[indexPropertyName] + cssUnit);
                        }
                    }

                }
                if (cssToChange && Object.keys(cssToChange.transform).length) {
                    // var transformCSStoChange = cssToChange.transform.join(" ");
                    var transformProperties = Object.keys(cssToChange.transform);
                    var transformCSStoChange ="";
                    for (var i = 0; i < transformProperties.length; i++) {
                        var indexTransformProperty = transformProperties[i];
                        var indexTransformValue = cssToChange.transform[indexTransformProperty];
                        transformCSStoChange += indexTransformProperty  + indexTransformValue;
                    }
                    $scope.actor.style['transform'] = transformCSStoChange;
                    $scope.actor.style[browserPrefix + '-transform'] = transformCSStoChange;
                }
                if (cssToChange && Object.keys(cssToChange.etc).length) {
                    var nonTransformProperties = Object.keys(cssToChange.etc);
                    for (var i = 0 ; i < nonTransformProperties.length; i++) {
                        var indexProperty = nonTransformProperties[i];
                        var indexValue = cssToChange.etc[indexProperty];
                        $scope.actor.style[indexProperty] = indexValue;
                    }
                }
            }

            //leave it & override all the new ones
            //for each property, check the last one it was edited, apply it to that

            //clear all values;
            // var percentValue = getNthSortedKeyText($scope.animation.obj, newValue);
            var proposedKeyframe = $scope.animation.properties[(value) + '%'];
            $scope.animation.selected_keyframe = proposedKeyframe;


            if (true) {
                var transformProperties = Object.keys(propertyDictCssMap);
                var nonTransformProperties = ['opacity', 'fill', 'backgroundColor', 'strokeDashArray', 'strokeOpacity', 'strokeWidth', 'strokeDashOffset','stroke', 'fillOpacity', 'color'];
                var cssToChange = {transform: [], etc: {}};
                var newPropertiesToModify = Object.keys($scope.animation.selected_keyframe.modified);
                // console.log(newPropertiesToModify);
                for(var i = 0; i < newPropertiesToModify.length; i++) {
                    var indexPropertyName = newPropertiesToModify[i];
                    var propertyValue = $scope.animation.selected_keyframe[indexPropertyName]

                    if (indexPropertyName in propertyDictCssMap) {
                        var cssVar = propertyDictCssMap[indexPropertyName];
                        var cssUnit = propertyDictCssUnit[indexPropertyName];
                        cssToChange.transform.push(propertyDictCssMap[indexPropertyName] + '(' + propertyValue + cssUnit + ')');
                    } else {
                        cssVar = indexPropertyName;
                        cssValue = newPropertiesToModify[indexPropertyName];
                        var cssUnit = '';
                        cssToChange.etc[cssVar] = cssValue;
                    }
                }

                if (cssToChange && cssToChange.transform.length) {
                        var transformCSStoChange = cssToChange.transform.join(" ");
                        $scope.actor.style['transform'] = transformCSStoChange;
                        $scope.actor.style[browserPrefix + '-transform'] = transformCSStoChange;
                    }
                if (cssToChange && Object.keys(cssToChange.etc).length) {
                    var nonTransformProperties = Object.keys(cssToChange.etc);
                    for (var i = 0 ; i < nonTransformProperties.length; i++) {
                        var indexProperty = nonTransformProperties[i];
                        var indexValue = cssToChange.etc[indexProperty];
                        $scope.actor.style[indexProperty] = indexValue;
                    }
                }

            }

            $timeout(function() {
                $scope.$apply();
            })
        }

        $scope.movePropertiesToKeyframeIndex = function(index) {
            console.log('proposing to move to keyframe index', index);
        }

        function initAnimationTimer() {


            function timerSetDuration(timer, time) {
                timer.duration = time;
            }

            function startTimer(timer, duration) {
                if (duration && duration.split('s').length) {
                    duration = parseInt(duration.replace('s', ''));
                }
                timer.time = 1;
                timer.duration = duration || 5;
                $scope.player.currentFrame = 0;
                console.log('time', timer.time, 'duration', timer.duration);
                timer.promise = $interval(function() {
                    if (!timer.time) {
                        return;
                    }
                    if (timer.time <= timer.duration) {
                        timer.time += 1
                    }
                }, 1000);
            }

            function resumeTimer(timer) {
                $interval.cancel(timer.promise);
                timer.promise = $interval(function() {
                    console.log('current time into animation is', timer.time);
                    if (timer.time < timer.duration) {
                        timer.time += 1
                        updateFramesIfNecessary(timer.time);
                    } else {
                        resetTimer(timer);
                    }
                }, 1000);
            }

            function updateFramesIfNecessary(time_s, duration, num_keyframes) {
                return;
            }

            function pauseTimer(timer) {

                $interval.cancel(timer.promise);
                timer.paused = true;

            }

            function resetTimer(timer) {
                $timeout(function() {
                    timer.time = 0;
                    timer.paused = null;
                    if (timer.promise) {
                        $interval.cancel(timer.promise);
                        timer.promise = null;

                    }
                }, 2000)
            }

            return {
                setDuration: timerSetDuration,
                promise: null,
                start: startTimer,
                resume: resumeTimer,
                pause: pauseTimer,
                reset: resetTimer,
                time: null,
                duration: 5,
            }

        }

        function initAnimationPlayer() {
            return {
                play: playElemAnimation,
                set: setAnimProperty,
                status: 0,
                settings: false,
                toggleSettings: toggleSettings,
                pause: pauseDanceMoveElem,
                reset: resetDanceMoveElem,
                resume: resumeDanceMoveElem,
                replay: resetDanceMoveElem,
                currentFrame: 0,
                setMode: {
                    options: [{name: "fast", speed: 250}, {name: "medium", speed:1000}, {name: "slow", "speed": 2000}],
                    selectedIndex: 0
                }
            }

            function toggleSettings() {
                $scope.player.settings = !$scope.player.settings;
            }
            function constructAnimationString(animation) {
                var attr = animation.attr;
                if (!attr) {
                    $scope.showStatusMsgForXSec('Current animation with name ' + animation.obj.name||'no_name' + ' does not have any default animation attributes')
                    return;
                }
                var name, duration, time_f, delay, iter, direc, f_mode;
                name = attr.name || 'temp-anim';
                duration = attr.duration || DEFAULTS.duration + 's';
                time_f = attr.timing_function || 'ease';
                delay = attr.delay || '0s';
                iter = attr.iteration_count || 1;
                direc = attr.direction || 'normal';
                f_mode = attr.fill_mode || 'none';

                var full_animation_string = name + " " + duration + " " + time_f + " " + delay + " " + iter + " " + direc + " " + f_mode;

                return full_animation_string
            }

            function numActiveSubAnimations() {
                if (!$scope.animations) {
                    $scope.animations = [];
                }
                var count = 0;
                for (var i = 0; i < $scope.animations.length; i++) {
                    var indexAnimation = $scope.animations[i];
                    if (indexAnimation.active) {
                        count += 1
                    }
                }
                return count;
            }


            function constructAllAnimationStrings(main_anim, anim_arr) {
                var resultString = '';
                for (var i = 0; i < anim_arr.length; i++) {
                    if (i === anim_arr.length - 1) {
                        resultString += (constructAnimationString(anim_arr[i]));
                    } else {
                        resultString += (constructAnimationString(anim_arr[i]) + ', ')
                    }
                }

                return resultString;
            }

            function isElemPaused(elem) {
                return elem.style.animationPlayState === "paused" || elem.style[browserPrefix + "AnimationPlayState"] === 'paused';
            }

            function playElemAnimation(player, elem, anim_name) {



                elem = elem || $scope.actor;
                $scope.actor.cachedStyle = elem.style.cssText;
                player = player || $scope.player;
                anim_name = $scope.animation.attr.name;

                if (isElemPaused(elem)) {
                    elem.style.animationPlayState = "running";
                    elem.style[browserPrefix + "AnimationPlayState"] = "running";
                    player.status = 1;
                    $scope.timer.resume($scope.timer);
                    return;
                }

                $scope.player.reset();
                $scope.animation.selected_keyframe = $scope.animation.properties['0%'];
                $scope.animation.selected_index = 0;
                $scope.animation.flex_selected_index = 0;


                var isMoreThanOneAnimationActive = numActiveSubAnimations();
                var animationString = constructAnimationString($scope.animation);
                if (isMoreThanOneAnimationActive) {
                    animationString += (',' + constructAllAnimationStrings($scope.animation, $scope.animations));
                }

                // $scope.animation.obj.name = $scope.animation.obj.animation = animationString;
                $scope.animation.obj.name = $scope.animation.attr.name;

                elem.style.animation = animationString;
                elem.style[browserPrefix + "Animation"] = animationString;


                console.log('actor', $scope.actor);
                $timeout(function() {
                    console.log('playing this animation string', animationString);
                }, 1000)
                if (!$scope.actor) {
                    var elem = document.querySelector('#stage-elem');
                    if (elem) {
                        $scope.actor = elem;
                    }
                }
                $scope.timer = initAnimationTimer()
                if (!$scope.initAnimationListener)  {
                    initAnimationListener($scope.actor);
                }
                // if (browserPrefix === 'webkit') {
                //  elem.addEventListener( 'webkitAnimationEnd', initAnimationEndListener)
                // } else {
                //  elem.addEventListener( 'animationend', initAnimationEndListener)
                // }


                if (!$scope.timer.paused) {
                    $scope.timer.start($scope.timer, $scope.animation.attr.duration);
                }

                if (!player.status) {
                    player.status = 1;
                }
                else if (player.status === 1) {
                    return
                }
                else if (player.status === 2) {
                    resumeDanceMoveElem(player, elem, browserPrefix);
                }
            }


                // function initAnimationEndListener( event ) {
                //  $timeout(function() {
                //      $scope.player.reset();
                //  }, 2500);
                //  // alert('animation ended')
                // }
            //      // $scope.player.reset();
            //      // var keyPercent = getNthSortedKeyText($scope.animation.obj, 0);
            //      $scope.animation.selected_keyframe = $scope.animation.properties[$scope.animation.selected_percent];
            //      $scope.animation.selected_index = Object.keys($scope.animation.properties).indexOf($scope.animation.selected_percent);
            //      $scope.setActiveKeyFrame($scope.animation.selected_percent)
            //      console.log($scope.animation.selected_index);

            //      // $scope.animation.selected_percent = keyPercent + '%';
            //      $timeout(function(){$scope.$apply();})
            //  }, false );
            // } else {
            //  elem.addEventListener( 'animationend',
            //  function( event ) {
            //      $scope.player.reset();
            //      // var keyPercent = getNthSortedKeyText($scope.animation.obj, 0);
            //      $scope.animation.selected_keyframe = $scope.animation.properties[$scope.animation.selected_percent];
            //      $scope.animation.selected_index = Object.keys($scope.animation.properties).indexOf($scope.animation.selected_percent);
            //      $scope.setActiveKeyFrame($scope.animation.selected_percent);
            //      alert('animation ended');
            //      // $scope.setActiveKeyFrame($scope.animation.selected_index)
            //      // $scope.animation.selected_keyframe = $scope.animation.properties[keyPercent + '%'];
            //      // $scope.animation.selected_percent = keyPercent + '%';
            //      $timeout(function(){$scope.$apply();})
            //  }, false );

            function pauseDanceMoveElem(player, elem) {
                elem = elem || $scope.actor;
                player = player || $scope.player;
                $scope.timer.pause($scope.timer);
                player.status = 2;
                player.state = 'paused';
                anim_name = $scope.animation.attr.name;
                elem.style.animationPlayState = "paused";
                elem.style[browserPrefix + "AnimationPlayState"]="paused";
            }


            function resumeDanceMoveElem(player, elem) {
                elem = elem || $scope.actor;
                player.status = 1;
                $scope.timer.resume($scope.timer);
                elem.style[browserPrefix + "AnimationPlayState"] ="running";
            }

            function resetDanceMoveElem(player, elem, replay) {
                elem = elem || $scope.actor;
                player = player || $scope.player;
                player.status = 0;
                anim_name = $scope.animation.attr.name;
                elem.style[browserPrefix + "AnimationName"] = null;
                elem.offsetWidth = elem.offsetWidth;
                $scope.timer.reset($scope.timer);

            }
        }

        function playDanceMoves(elem, dance_moves) {
            for (var i = 0; i < dance_moves.length; i++) {
                console.log('playing dance move #', i + 1);
                var indexDanceMove = dance_moves[i]
                execDanceMove(elem, indexDanceMove);
            }
        }

        function setAnimProperty(elem, property, val) {

        }

        function execDanceMove(elem, dance_obj) {
            var animKeys = Object.keys(dance_obj);
            for (var i = 0; i < animKeys.length; i++) {
                var indexProperty = animKeys[i];
                if (browserPrefix && browserPrefix.length) {
                    indexProperty = indexProperty[0].toUpperCase() + indexProperty.slice(1);
                }
                var elemStyleProperty = browserPrefix + indexProperty;
                var perspective = "perspective("+dance_obj.transformPerspective +"%) ";
                var translate = "translate3d("+dance_obj.translateX+"%, "+dance_obj.translateY+"%, "+dance_obj.translateZ+"%) ";
                var scale = "scale3d("+dance_obj.scale3DX+", "+dance_obj.scale3DY+", "+dance_obj.scale3DZ+") ";
                var rotate = "rotate3d("+dance_obj.rotate3DX+", "+dance_obj.rotate3DY+", "+dance_obj.rotate3DZ+", "+dance_obj.rotate3DAngle+"deg)";
                var origin = dance_obj.originX+"% "+dance_obj.originY+"%"+" "+dance_obj.originZ+"%";
                var csstext = browserPrefix + "transform: "+perspective+translate +scale + rotate + "; "
                    + browserPrefix + "transform-origin: " + origin + "; "
                    + browserPrefix + "transform-style: " + dance_obj.transformStyle+";"
                    + "transform: "+perspective+translate +scale + rotate + "; "
                    + "transform-origin: " + origin + "; ";
                    + "transform-style: " + dance_obj.transformStyle+";";

                elem.style.cssText = elem.style.cssText + csstext;
            }
        }

        $scope.swapAnimationWithActive = function(animation, index) {
                var newActiveAnimation = $scope.animations.splice(index, 1);
                $scope.animation.active = false;
                var newSubAnimation = $scope.animation;
                $scope.animation = null;
                $timeout(function() {
                    $scope.animation = newActiveAnimation[0];
                    $scope.animation.active = true;
                    $scope.animations.unshift(newSubAnimation);
                }, 1000)

            }

        var transformObjToCssText = function(dance_obj, property) {
            var unit ='%';
            var perspective = "perspective("+dance_obj.transformPerspective +"%) ";
            var translate = "translate3d("+dance_obj.translateX+"%, "+dance_obj.translateY+"%, "+dance_obj.translateZ+"%) ";
            var scale = "scale3d("+dance_obj.scale3DX+", "+dance_obj.scale3DY+", "+dance_obj.scale3DZ+") ";
            var rotate = "rotate3d("+dance_obj.rotate3DX+", "+dance_obj.rotate3DY+", "+dance_obj.rotate3DZ+", "+dance_obj.rotate3DAngle+"deg)";
            var origin = dance_obj.originX+"% "+dance_obj.originY+"%"+" "+dance_obj.originZ+"%";

            var backgroundColor = dance_obj.backgroundColor || '#ffffff';
            var color = dance_obj.color || "#ffffff";
            var fill = dance_obj.fill || '#ffffff';
            var opacity = dance_obj.opacity || 1.0;
            var strokeOpacity = dance_obj.strokeOpacity || 1.0;
            var strokeWidth = dance_obj.strokeWidth || 1.0;
            var strokeDashArray = dance_obj.strokeDashArray || 1.0;
            var strokeDashOffset = dance_obj.strokeDashOffset || 1.0;

            // property = "skewY";
            // dance_obj.skewY = 10;
            if (property) {
                dance_obj.modified[property] = dance_obj[property];
            }

            // var _csstext =  'transform: skew(' + (dance_obj.skewX || 0)+ 'rad, ' + (dance_obj.skewY || 0) +'rad) rotate3d(' + dance_obj.rotate3DX +', ' + dance_obj.rotate3DY + ', ' + dance_obj.rotate3DZ + ', ' + (dance_obj.rotate3DAngle || 30) + 'rad) scale(' + (dance_obj.scale3DX || 1.0 )  + ', ' + (dance_obj.scale3DY || 1.0) + ')  translate3d(' + (dance_obj.translateX || 0) + unit + ', ' + (dance_obj.translateY || 0) +unit + ', ' + (dance_obj.translateZ || 0) + 'px);'
            csstext ="";
            // console.log(Object.keys(dance_obj.modified));
            var modifiedPropertyKeys = Object.keys(dance_obj.modified);
            for (var i = 0; i < modifiedPropertyKeys.length; i++) {

                var indexProperty = modifiedPropertyKeys[i];
                var transformProperties = ["translateX", "translateY", "translateZ", "scale3DX", "scale3DY", "scale3DZ", "rotate3DAngle", "rotate3DX", "rotate3DY", "rotate3DZ", "skewX",  "rotate", "skewY"]
                if (transformProperties.indexOf(indexProperty) > -1) {
                    switch(indexProperty) {
                        case "translateX":
                            csstext += 'translateX(' + dance_obj.translateX  + unit + ') '
                            break;
                        case "translateY":
                            csstext += 'translateY(' + dance_obj.translateY  + unit + ') '
                            break;
                        case "translateZ":
                            csstext += 'translateZ(' + dance_obj.translateZ  + 'px' + ') '
                            break;
                        case "scale3DX":
                            csstext += 'scaleX(' + dance_obj.scale3DX  + ') '
                            break
                        case "scale3DY":
                            csstext += 'scaleY(' + dance_obj.scale3DY  + ') '
                            break
                        case "scale3DZ":
                            csstext += 'scaleZ(' + dance_obj.scale3DZ   + ') '
                            break;
                        case "skewX":
                            csstext += 'skewX(' + dance_obj.skewX   + 'rad) '
                            break;
                        case "skewY":
                            csstext += 'skewX(' + dance_obj.skewY   + 'rad) '
                            break;
                        case "rotate3DX":
                            csstext += 'rotateX(' + dance_obj.rotate3DX  + 'rad) '
                            break;
                        case "rotate3DY":
                            csstext += 'rotateY(' + dance_obj.rotate3DY  + 'rad) '
                            break;
                        case "rotate":
                            csstext += 'rotateZ(' + dance_obj.rotate  + 'rad) '
                            break;
                        case "rotate3DZ":
                            csstext += 'rotateZ(' + dance_obj.rotate3DZ  + 'rad) '
                            break;
                        case "rotate3DAngle":
                            csstext += 'rotate3d(' +(dance_obj.rotate3DX || 0) + ", "+ (dance_obj.rotate3DY||0)+", "+(dance_obj.rotate3DZ ||0)+", "+dance_obj.rotate3DAngle+"deg) "
                            break;
                    }
                }

            }
            if (csstext.length) {
                csstext = "transform: " + csstext + ';'
            }

            var nonTransformProperties = ['opacity', 'fill', 'backgroundColor', 'transformOriginX', 'transformOrigin', 'transformOriginY', 'transformOriginZ', 'strokeDashArray', 'strokeOpacity', 'strokeWidth', 'strokeDashOffset','stroke', 'fillOpacity', 'color']
            for (var i = 0; i < modifiedPropertyKeys.length; i++) {
                var indexProperty = modifiedPropertyKeys[i];
                // var indexProperty = nonTransformProperties[i];
                if (nonTransformProperties.indexOf(indexProperty) > -1) {
                    if (['transformOriginX', 'transformOriginY', 'transformOriginZ'].indexOf(indexProperty) > -1) {
                        csstext += ('transform-origin:' + (dance_obj.transformOriginX || '50%') + ' ' + (dance_obj.transformOriginY || '50%') + ' ' + (dance_obj.transformOriginZ || '0px') + ';');
                        csstext += ('-' + browserPrefix + '-transform-origin:') + (dance_obj.transformOriginX || '50%') + ' ' + (dance_obj.transformOriginY || '50%') + ' ' + (dance_obj.transformOriginZ || '0px') + ';';
                    }
                    if (indexProperty === 'opacity' && typeof(dance_obj.opacity) === "number") {
                        csstext += ('opacity:' + dance_obj.opacity + ';')
                    }
                    if (indexProperty === 'fill') {
                        csstext += ('fill:' + dance_obj.fill + ';');
                    }
                    if (indexProperty === 'backgroundColor') {
                        csstext += ('background-color:' + dance_obj.backgroundColor + ';');
                    }
                    if (indexProperty === 'strokeDashOffset') {
                        csstext += ('stroke-dashoffset:' + dance_obj.strokeDashOffset + ';');
                    }
                    if (indexProperty === 'strokeDashArray') {
                        csstext += ('stroke-dasharray:' + dance_obj.strokeDashArray + ';');
                    }
                    if (indexProperty === 'strokeWidth') {
                        csstext += ('stroke-width:' + dance_obj.strokeWidth + ';');
                    }
                    if (indexProperty === 'strokeOpacity') {
                        csstext += ('stroke-opacity:' + dance_obj.strokeOpacity + ';');
                    }
                    if (indexProperty === 'color') {
                        csstext += ('color:' + dance_obj.color + ';');
                    }
                    if (indexProperty === 'stroke') {
                        csstext += ('stroke:' + dance_obj.stroke + ';');
                    }
                    if (indexProperty === 'fillOpacity') {
                        csstext += ('fill-opacity:' + dance_obj.fillOpacity + ';');
                    }
                }
            }

            //@gabrielle-note
            // csstext = 'color:' + (color) + '; fill: ' + (fill) + '; stroke-width: ' + (strokeWidth) + ';stroke-dasharray:' + (strokeDashArray) + '; stroke-opacity:' + (strokeOpacity)+ '; stroke-dashoffset:' + (strokeDashOffset) + ';background-color:' + (backgroundColor) + ';' + csstext;
            // var csstext = browserPrefix + "-transform: "+perspective+translate +scale + rotate + "; "
            //  + browserPrefix + "-transform-origin: " + origin + "; "
            //  + browserPrefix + "-transform-style: " + dance_obj.transformStyle+";"
            //  + "transform: "+perspective+translate +scale + rotate + "; "
            //  + "transform-origin: " + origin + "; ";
            //  + "transform-style: " + dance_obj.transformStyle+";";
            return csstext
        }

        //key spec
        //space - play
        //ctrl + left, go back a time state
        //ctrl + right arrow
        // NOTE: The change to red signifies the start of

        //todo apply a matrix transform

        function injectStyleSheet() {
            var link = document.createElement("link");
            link.href = "https://s3.amazonaws.com/uguru-admin/master/animate.css";
            link.type = "text/css";
            link.rel = "stylesheet";
            document.getElementsByTagName("head")[0].appendChild(link);
        }

        //TODO import all webkit related animation results
        //TODO -->
        function findKeyframesRule(rule) {
            var ss = document.styleSheets;

            for (var i = 0; i < ss.length; ++i) {
                if (!ss[i].cssRules) {
                    continue;
                }
                for (var j = 0; j < ss[i].cssRules.length; ++j) {
                    if (ss[i].cssRules[j].type == window.CSSRule.WEBKIT_KEYFRAMES_RULE && ss[i].cssRules[j].name == rule) { return ss[i].cssRules[j]; }
                }
            }
            return null;
        }

        function exportExternalCSSKeyFrameFiles(css_file_names, external_css) {
            var ss = document.styleSheets;

            var allRuleObjs = [];
            var allRuleDict = {};
            var count = 0;
            for (var i = 0; i < ss.length; ++i) {
                var styleSheetName;
                if (ss[i].href) {
                    var styleSheetName = ss[i].href.split('/').reverse()[0].replace('.css', '');
                    console.log('adding to css rule dict', styleSheetName);
                    if ((css_file_names.length && css_file_names.indexOf(styleSheetName) > -1)) {
                        allRuleDict[styleSheetName] = [];
                    }
                }
                if (ss[i].cssRules && ss[i].cssRules.length) {
                    for (var j = 0; j < ss[i].cssRules.length; ++j) {
                        if (ss[i].cssRules[j].type == window.CSSRule.WEBKIT_KEYFRAMES_RULE) {
                            allRuleObjs.push(ss[i].cssRules[j]);
                            if (styleSheetName in allRuleDict) {
                                var indexCssRule = ss[i].cssRules[j];
                                var rawCSSText = indexCssRule.cssText;
                                var animationName = indexCssRule.name;
                                console.log('processing', animationName);
                                var js_anim_obj = importAnimationFromRawCssText(rawCSSText, animationName);
                                var final_obj = initAnimationFromAnimObj(js_anim_obj);
                                $scope.saveAnimationClass(final_obj, styleSheetName);
                                console.log(final_obj.attr.name, 'processed');
              //                var js_anim_obj = importAnimationFromRawCssText(indexCssRule.css_text, name);


                            }
                        }
                    }
                }
            }
            $timeout(function() {
                $scope.$apply()
            })
            return allRuleObjs
        }

        $scope.confirmStatusMsgAction = function(bool) {
            $scope.showStatusMsg = null;
            $scope.showStatusMsgConfirmAction = null;
            $timeout(function() {
                $scope.showStatusMsgConfirmActionCb(bool);
            }, 250);
        }

        $scope.showStatusMsgForXSec = function(message, time_ms, action_type, cb) {
            time_ms = time_ms || 2500;
            $scope.showStatusMsg = message;
            if (action_type && action_type === 'confirm') {
                $scope.showStatusMsgConfirmAction = true;
                $timeout(function() {$scope.$apply()});
                if (cb) {
                    $scope.showStatusMsgConfirmActionCb = cb;
                }
            } else {
                $timeout(function() {
                    $scope.showStatusMsg = null;
                }, time_ms)
                // $scope.animation.edit = false;
            }
        }

        $scope.updateAnimationName = function(animation) {
            animation.obj.name = animation.attr.name;
            $scope.animationDropdown.options[0] = $scope.animation.obj.name;
            $scope.animationDropdown.options.push('Save');
            $scope.showStatusMsgForXSec('Updated Animation Name!', 2500);
            $timeout(function() {
                $scope.$apply();
            })
            $timeout(function() {
                $scope.animation.edit = false;
            }, 500);
        }

        $scope.switchLayoutTabToImportAnimation = function() {
            $scope.importLayoutIndex = 0;
        }

        function initAnimationFromCSSText(anim_name, browserPrefix, css_text) {
            var lastSheet = document.styleSheets[document.styleSheets.length - 1];
            var indexOfRuleInSheet = lastSheet.insertRule("@-" + browserPrefix + "-keyframes " + anim_name + " { } ");
            var anim = lastSheet.cssRules[indexOfRuleInSheet];

            anim.cssText = css_text;
            return anim
        }

        function initAnimationFromAnimObj(anim_obj, options) {
            options = options || {};
            var properties = initDictWithXProperties(anim_obj);
            var attr = {
                name: options.name || anim_obj.name,
                play_state: "running",
                delay: options.delay || '0s',
                delayVal: 0,
                direction: options.direction || "normal",
                iteration_count: options.iteration_count || 1,
                timing_function: options.timing_function || "ease",
                duration: options.duration || defaults.DURATION + 's',
                durationVal: defaults.DURATION,
                fill_mode: options.fill_mode ||  "none",
                kf_intervals: defaults.KF_INTERVALS
            }
            return {obj: anim_obj, active:options.active, selected_keyframe:properties['0%'], selected_kf_index:0, selected_percent:'0%', selected_index: 0, flex_selected_index:0, properties: properties, kf_count: defaults.KF_COUNT, attr:attr};
        }

        function initAnimation(anim_name, browserPrefix, num_keyframes, duration, active) {
            active = active || false;
            num_keyframes = num_keyframes || 100;
            duration = (duration || 5) + 's';

            var lastSheet = document.styleSheets[document.styleSheets.length - 1];
            if (!lastSheet.cssRules) {
                var lastSheet = document.styleSheets[document.styleSheets.length - 2];
            }
            var indexOfRuleInSheet = lastSheet.insertRule("@-" + browserPrefix + "-keyframes " + anim_name + " { } ", 0);
            var anim = lastSheet.cssRules[indexOfRuleInSheet];
            initKFWithXInterval(anim, num_keyframes);
            var properties = initDictWithXProperties(anim)
            var attr = {
                name: anim_name,
                play_state: "running",
                delay: '0s',
                delayVal: 0,
                direction: "normal",
                iteration_count: 1,
                timing_function: "ease",
                duration: duration,
                durationVal: parseInt(duration.replace('s')),
                fill_mode: "none",
                kf_intervals: defaults.KF_INTERVALS
            }
            return {obj: anim, active: active, selected_keyframe:properties['0%'], selected_kf_index:0, selected_percent:'0%', selected_index: 0, flex_selected_index:0, properties: properties, kf_count: num_keyframes, attr:attr};
        }



        function initArrWithXProperties(num_frames) {
            var result_arr = [];
            for (var i = 0; i < num_frames; i++) {
                result_arr.push(transformPropertiesObj())
            }
            return result_arr
        }

        function initDictWithXProperties(anim) {
            var resultDict = {};
            var keyTextPercentArray = [];
            for (var i = 0; i < anim.cssRules.length; i++) {
                var indexRule = anim.cssRules.item(i);
                if (indexRule && indexRule.keyText) {
                    keyTextPercentArray.push(indexRule.keyText);
                }
            }
            for (var i = 0; i < keyTextPercentArray.length; i++) {
                var currentFramePercent = keyTextPercentArray[i];
                resultDict[currentFramePercent]  =  transformPropertiesObj()
            }
            return resultDict
        }

        function initKFWithXInterval(anim, max_bound) {
            var scaling_value = 100.0 / max_bound;
            for (var i = 0; i < max_bound + 1; i++) {
                addKFRule(anim,  (i*1.0 * scaling_value), {}, browserPrefix, i);
            }
        }

        function insertPropertiesAtXKF(anim, property_dict, browserPrefix) {
            return;
        }

        function getNthSortedKeyText(anim, index) {
                console.log(anim, index);
                var position;
                var keyTexts = [];
                for (var i = 0; i < anim.cssRules.length; i++) {
                    var cssIndexKFRule = anim.cssRules.item(i);

                    if (cssIndexKFRule) {
                        if (index === cssIndexKFRule.keyText) {
                            position = i;
                        }
                        var keyText = cssIndexKFRule.keyText;
                        keyTexts.push(parseFloat(keyText.replace('%', '')));
                    }
                }
                console.log(position, 'is the nth selected keyframe');
                keyTexts.sort(function(a, b) {
                    return b - a;
                }).reverse();
                // console.log(keyTexts.slice(), index, keyTexts.reverse(), keyTexts.reverse())
                return keyTexts[keyTexts.indexOf(index)];
                // anim.cssRules.item(index)
            }


        function reconstructAnimationFromProperties(attr, properties, kf_count, callback) {
            var lastSheet = document.styleSheets[document.styleSheets.length - 1];
            var indexOfRuleInSheet = lastSheet.insertRule("@-" + browserPrefix + "-keyframes " + attr.name + " { } ");
            var anim = lastSheet.cssRules[indexOfRuleInSheet];
            // initKFWithXInterval(anim, kf_count);
            $timeout(function() {
                var propertyKeys = Object.keys(properties);
                for (var j = 0; j < propertyKeys.length; j++) {
                    var propertyPercent = parseFloat(propertyKeys[j].replace('%', ''));
                    console.log('adding', propertyPercent);
                    // appendRule(percentage + '{' + css_text +  '}', keyframe_percent);
                    anim.appendRule(propertyKeys[j] + ' {}', j)
                }

                var attributes = {
                    name: attr.name,
                    play_state: attr.play_state,
                    delay: attr.delay + 's',
                    delayVal: attr.delay,
                    direction: attr.direction,
                    iteration_count: attr.iteration_count,
                    timing_function: attr.timing_function,
                    duration: attr.duration,
                    durationVal: parseInt(attr.duration.replace('s')),
                    fill_mode: attr.fill_mode,
                    kf_intervals: defaults.KF_INTERVALS
                }

                var propertyKeys = Object.keys(properties);


                $scope.animation = {obj: anim, selected_index:0, flex_selected_index:0, selected_kf_index:0,   properties: properties, kf_count: kf_count, attr:attributes, kf_intervals: defaults.KF_INTERVALS};

                $scope.animation.selected_percent = propertyKeys[0];
                $scope.animation.selected_keyframe = $scope.animation.properties[$scope.animation.selected_percent]
                console.log($scope.animation);
                for (var i = 0; i < propertyKeys.length; i++) {
                    var indexPropertyKeyPercent = propertyKeys[i];
                    var modifiedDict = properties[indexPropertyKeyPercent].modified;
                    var modifiedDictKeys = Object.keys(modifiedDict);

                    if (modifiedDictKeys.length) {
                        for (var j = 0; j < modifiedDictKeys.length; j++) {
                            var indexModifiedKey = modifiedDictKeys[j];
                            var indexModifiedValue = modifiedDict[indexModifiedKey];
                            console.log($scope.animation.obj, indexModifiedKey, indexModifiedValue);
                            editKeyframeAtX($scope.animation, indexPropertyKeyPercent.replace('%',''), indexModifiedKey, indexModifiedValue);
                        }
                    }
                }
                // $scope.animation = animation;
                callback && callback();
                console.log($scope.animation);
            })



            return;
        }

        function addKFRule(anim, percentage, property_dict, browserPrefix, index) {
            var property_keys = Object.keys(property_dict);
            var result_property_str = '';
            for (var i = 0; i < property_keys.length; i++) {
                var indexProperty = property_keys[i];
                var indexValue = property_dict[indexProperty];
                result_property_str += indexProperty + ":" + indexValue + ";";

            }

            anim.appendRule(percentage + "% {" + result_property_str + " }", index);
        }

        function getS3Animations() {

            var first_name = $scope.user.name.split(' ')[0].toLowerCase();
            if (first_name === 'asif') {
                first_name = 'samir';
            }
            var animation_url = 'https://s3.amazonaws.com/uguru-admin/master/animations.json';
            getS3JsonFile(first_name, animation_url, s3_callback);

            function s3_callback(first_name, _dict) {
                $scope.animationDict = _dict;
                $scope.my_animations = $scope.animationDict[first_name];
                if ($scope.my_animations.last_edited) {
                    var serverAnimation = $scope.my_animations.last_edited;
                    $scope.animation = reconstructAnimationFromProperties(serverAnimation.attr, serverAnimation.properties, serverAnimation.kf_count);
                    $scope.animation.selected_keyframe = $scope.animation.properties['0%'];
                    $scope.animation.selected_index = 0;
                    $scope.animation.flex_selected_index = 0;
                    $timeout(function() {
                        $scope.$apply();
                    })
                }

                $scope.myAnimationDropdown = initMyAnimationDropdown($scope.my_animations);
                LoadingService.hide();
                // saveS3Animations();
            }

            function initMyAnimationDropdown(my_animations) {

                var animationNameArr = Object.keys(my_animations.animations);
                if (!animationNameArr.length) {
                    animationNameArr.push($scope.my_animations.last_edited.attr.name);
                }
                animationNameArr.push('+');
                return {
                    options: animationNameArr,
                    onOptionClick: savePreviousAndSelectAnimation,
                    size: 'small',
                    label: 'my animations',
                    selectedIndex: 0
                }

                function savePreviousAndSelectAnimation(option, index) {
                    $scope.saveAnimationsToServer($scope.animation);;
                    if (option === '+') {
                        $scope.animation = initAnimation('new', browserPrefix, 100, 5);
                        $scope.animation.selected_keyframe = $scope.animation.properties['0%'];
                        $scope.animation.selected_index = 0;
                        $scope.animation.flex_selected_index = 0;
                        $scope.myAnimationDropdown.options.push('new');
                        $scope.myAnimationDropdown.selectedIndex = $scope.myAnimationDropdown.options.length - 1;
                        $scope.player.toggleSettings();
                    } else {
                        var serverAnimation = $scope.my_animations.animations[option];
                        $scope.animation = reconstructAnimationFromProperties(serverAnimation.attr, serverAnimation.properties, serverAnimation.kf_count);
                        $scope.animation.selected_keyframe = $scope.animation.properties['0%'];
                        $scope.animation.selected_index = 0;
                        $scope.animation.flex_selected_index = 0;
                    }
                    $timeout(function() {
                        $scope.$apply();
                    })
                }

            }

            function getS3JsonFile(first_name, url, cb) {
                var xhr = new XMLHttpRequest();
                xhr.open( 'GET', url, true );

                xhr.onload = function () {
                    console.log(xhr);
                    var resp = JSON.parse( xhr.responseText );
                    cb && cb(first_name, resp);
                };
                xhr.send();
            }
        }



        $scope.saveAnimationsToServer = function(animation) {
            $scope.my_animations.last_edited = animation;
            var animationName = $scope.animation.attr.name;
            LoadingService.showMsg('Saving....');
            if ($scope.my_animations.last_edited) {
                $scope.my_animations.animations[animationName] = animation;
            }


            var first_name = $scope.user.name.split(' ')[0].toLowerCase();
            if (first_name === 'asif') {
                first_name = 'samir';
            }
            console.log($scope.animationDict);
            // $scope.animationDict[first_name]['animations'][fileName] = $scope.animation;

            saveS3Animations();
        }


        function saveS3Animations() {

            var animation_url = 'https://s3.amazonaws.com/uguru-admin/master/animations.json';
            var first_name = $scope.user.name.split(' ')[0].toLowerCase();
            if (first_name === 'asif') {
                first_name = 'samir';
            }
            function post_callback(first_name, resp) {
                console.log('file successfully saved', resp);
                LoadingService.hide();
                $timeout(function() {
                    LoadingService.showSuccess('Saved!', 1000);
                })
            }
            FileService.postS3JsonFile(JSON.stringify($scope.animationDict), first_name, animation_url, post_callback);
        }

        $scope.rad2degree = function(rad) {
            return rad * (180/Math.PI);
        }



        $scope.applyPropertyChange = function(value, property) {
            //set
            // $timeout(function() {
            deg2radProperties = ['skewXdeg', 'skewYdeg', 'rotate3DXdeg', 'rotate3DYdeg', 'rotate3DZdeg'];


            if (property.indexOf('transformOrigin') > -1) {
                $scope.showStatusMsgForXSec('updating ' + property + ' to ' + value);
            }

            if (deg2radProperties.indexOf(property) > -1) {
                radians = value * (Math.PI/180);
                $scope.animation.selected_keyframe[property] = value;
                value = parseFloat(radians, 10);
                property = property.replace('deg', '');
            }
            var convertToIntProperties = ['opacity'];

            if (convertToIntProperties.indexOf(property) > -1) {
                value = parseFloat(value);
            }




            var desiredIndex = $scope.animation.selected_percent;
            console.log('about to apply property change', property, 'to', value, 'in kf', desiredIndex);

            editKeyframeAtX($scope.animation, desiredIndex.replace('%', ''), property, value);

            $timeout(function() {
                console.log($scope.animation.selected_keyframe);
                $scope.renderAnimationCSSText($scope.animation, true);
            })
            // console.log($scope.animation.obj.cssText);
            // }, 500)
            // var cssRuleAtKeyFrameX = findCSSRuleByIndex($scope.animation.obj, value);
            // var transformObjAtX = $scope.animation.selected_keyframe;
            // console.log('value of ' + property, 'set to', parseInt(value));
            // transformObjAtX[property] = value;

            // cssRuleAtKeyFrameX.style[browserPrefix + 'Transform'] = transformObjToCssText(transformObjAtX);
            // cssRuleAtKeyFrameX.style['transform'] = transformObjToCssText(transformObjAtX);


            // $scope.animation.obj.deleteRule(parseInt(value) + '%');
            // $scope.animation.obj.appendRule(parseInt(value) + '% {' + transformObjToCssText(transformObjAtX) + '}');
            // console.log($scope.animation.obj.cssRules);
            // console.log('exact rule', $scope.animation.obj.findRule(value), value, property);

        }

        function findCSSRuleByIndex(anim, index) {
            console.log('attempt 1', anim.cssRules.item(index));
            return anim.cssRules[index];
        }

        function readAndInjectKeyFrames(anim, keyframe_rules) {

        }

        function getBaseTransformDict() {
            return {

            }
        }

        function sampleStrobeKFObj() {
            var anim = initAnimation("strobe", browserPrefix, $scope.animationKeyFrames);
            var property_dict_1 = transformPropertiesObj();
            var property_dict_2 = transformPropertiesObj();


            //dictionary 1
            property_dict_1.opacity = 0;


            //dictionary 2
            property_dict_2.opacity = 1;
            property_dict_1["background-color"] = '#ffffff'
            property_dict_2["background-color"] = '#FF0000'



            var rulesLength = anim.cssRules.length;
            var properties = [];


            for (var i = 0 ; i < rulesLength + 1; i++) {
                var indexProperty = (i % 2)  ? property_dict_1 : property_dict_2 ;



                if (i === 50) {
                    property_dict_2["transform"] = 'translateX(100px)'
                }


                addKFRule(anim, i, indexProperty, browserPrefix, i);

                properties.push(indexProperty);
            }

            return {obj: anim, properties: properties};
        }


        //guis to create
        // slider - num animation keyframes
        $scope.animationCache = $localstorage.getObject('saved_animations') || [];

        $scope.animDurationChange = function(value) {
            $scope.animation.attr.duration = value + 's';
        }

        $scope.selectAnimation = function(animation) {
            $scope.animation.obj = findKeyframesRule(animation);
            console.log($scope.animation.obj.cssText);
        }

        function getDefaultValue(property) {
            if (['translateX', 'translateY', 'translateZ', 'rotate', 'rotate3DX', 'rotate3DZ', 'rotate3DAngle' ,'skewX', 'skewY', 'rotate3DY'].indexOf(property) > -1) {
                return 0;
            } else {
                return 1;
            }
        }

        $scope.clearAllFrames = function() {
            var propertiesDict = $scope.animation.properties;
            var propertiesDictKeys = Object.keys(propertiesDict);
            LoadingService.showMsg('Clearing all animations....', 2500);
            for (var i = 0; i < propertiesDictKeys.length; i++) {
                var indexPropertyPercentage = propertiesDictKeys[i];
                var kfProperty = propertiesDict[indexPropertyPercentage];
                $scope.clearAllProperties(kfProperty, true);
            }
            $timeout(function() {

                var firstPercentage = getNthSortedKeyText($scope.animation.obj, 0);
                $scope.animation.selected_keyframe = $scope.animation.properties[firstPercentage + '%'];
                $scope.animation.selected_percent = firstPercentage + '%';
                $scope.animation.selected_index = 0;
                $timeout(function() {
                    LoadingService.showSuccess('All properties across all keyframes cleared!', 2000);
                }, 500)
                $scope.$apply()
            });
        }

        $scope.clearAllProperties = function(kf_obj, skip_confirm) {
            if (skip_confirm) {
                kf_obj.confirmed = true;
            } else if (!skip_confirm && !kf_obj.confirmed) {
                kf_obj.confirmed = true;
            } else {
                kf_obj.confirmed = false;
            }
            if (kf_obj.confirmed) {
                kf_obj.confirmed = false;
                kf_obj = kf_obj || $scope.animation.selected_keyframe;
                selected_kf_properties = Object.keys(kf_obj.modified);
                for (var i = 0; i < selected_kf_properties.length; i++) {
                    var indexProperty = selected_kf_properties[i];

                    $scope.clearProperty(kf_obj, indexProperty);
                }
            }
        }

        $scope.clearProperty = function(kf, property) {
            // percent_value = $scope.animation
            // var percent_value =
            var percent_value = $scope.animation.selected_percent;
            console.log(kf, property, percent_value);
            console.log('modified dict', kf.modified);
            if (property in kf.modified) {
                kf.modified[property] = 0;
            }
            var defaultValue = getDefaultValue(property);
            editKeyframeAtX($scope.animation, percent_value.replace('%', ''), property, defaultValue);

            editKeyframeAtX($scope.animation, percent_value.replace('%', ''), property, null);
            kf[property] = defaultValue;




            $timeout(function() {
                $scope.setActiveKeyFrame($scope.animation.selected_percent)
                $scope.$apply();
            }, 500);
        }


        function editKeyframeAtX(anim, keyframe_percent, property, value, clear_css_text) {
            // console.log(keyframe_percent);
            // console.log(keyframe_percent, property, value)
            var percentage = keyframe_percent;
            anim.obj.deleteRule(percentage + '%');

            // console.log('properties', anim.properties, keyframe_percent);
            transformObj = anim.properties[percentage + '%'];
            transformObj.edited = true;
            transformObj[property] = value;



            console.log('setting', property, value);

            if (!clear_css_text) {
                var css_text = transformObjToCssText(transformObj, property);
                console.log('transforming...', css_text, percentage);
                anim.obj.appendRule(percentage + '% ' + '{' +  css_text + '}', keyframe_percent);

            } else {
                var css_text = transformObjToCssText(transformObj, property);
                var css_text = " ";
                anim.obj.appendRule(percentage + '% ' + '{' + css_text +  '}', keyframe_percent);
            }

            // css_text = css_text.replace('transform:', '').replace(';', '');
            // $scope.actor.style[browserPrefix + 'Transform'] = css_text;
            // $scope.actor.style['transform'] = css_text;
            // $scope.animation.obj.appendRule('0% {transform: translate(10px, 10px);}', 1);
            // $scope.animation.obj.appendRule('0% {transform: translate(10px, 10px);}', 1);
            var propertyDictCssMap = {'translateX': 'translateX', 'translateY': 'translateY', 'rotate':'rotateZ', 'translateZ': 'translateZ', 'scale3DX': 'scaleX', 'scale3DY': 'scaleY', 'skewX':'skewX', 'skewY': 'skewY', 'rotate3DZ':'rotateZ', 'rotate3DY': 'rotateY', 'rotate3DX': 'rotateX'};
            var propertyDictCssUnit = {'translateX': '%', 'translateY': '%', 'translateZ': 'px', 'scale3DX': '', 'scale3DY': '', 'skewX':'rad', 'skewY': 'rad', 'rotate': 'rad', 'rotate3DZ':'rad', 'rotate3DY': 'rad', 'rotate3DX': 'rad', 'rotate3DAngle': 'rad'};
            var transformProperties = Object.keys(propertyDictCssMap);
            var nonTransformProperties = ['opacity', 'fill', 'backgroundColor', 'strokeDashArray', 'strokeOpacity', 'transformOrigin', 'transformOrigin', 'strokeWidth', 'strokeDashOffset','stroke', 'fillOpacity', 'color'];
            var cssToChange = {transform: {}, etc: {}};
            var newPropertiesToModify = Object.keys(anim.selected_keyframe.modified);

            for(var i = 0; i < newPropertiesToModify.length; i++) {
                var indexPropertyName = newPropertiesToModify[i];


                var propertyValue = anim.selected_keyframe[indexPropertyName]

                if (indexPropertyName in propertyDictCssMap) {
                    var cssVar = propertyDictCssMap[indexPropertyName];
                    var cssUnit = propertyDictCssUnit[indexPropertyName];
                    cssToChange.transform[propertyDictCssMap[indexPropertyName]] = '(' + propertyValue + cssUnit + ')';
                } else {
                    cssVar = indexPropertyName;
                    cssValue = propertyValue
                    console.log(cssVar, cssValue);
                    var cssUnit = '';
                    cssToChange.etc[cssVar] = cssValue;
                }
            }
            if (cssToChange && Object.keys(cssToChange.transform).length) {
                // var transformCSStoChange = cssToChange.transform.join(" ");
                var transformProperties = Object.keys(cssToChange.transform);
                var transformCSStoChange ="";
                for (var i = 0; i < transformProperties.length; i++) {
                    var indexTransformProperty = transformProperties[i];
                    var indexTransformValue = cssToChange.transform[indexTransformProperty];
                    transformCSStoChange += indexTransformProperty  + indexTransformValue;
                }
                $scope.actor.style['transform'] = transformCSStoChange;
                $scope.actor.style[browserPrefix + '-transform'] = transformCSStoChange;
            }
            // if (cssToChange && cssToChange.transform.length) {
            //      var transformCSStoChange = cssToChange.transform.join(" ");
            //      console.log('transform css to change', transformCSStoChange);
            //      $scope.actor.style['transform'] = transformCSStoChange;
            //      $scope.actor.style[browserPrefix + '-transform'] = transformCSStoChange;
            //  }
            if (cssToChange && Object.keys(cssToChange.etc).length) {
                var nonTransformProperties = Object.keys(cssToChange.etc);
                for (var i = 0 ; i < nonTransformProperties.length; i++) {
                    var indexProperty = nonTransformProperties[i];
                    var indexValue = cssToChange.etc[indexProperty];
                    console.log('setting', indexProperty, 'to', indexValue);
                    $scope.actor.style[indexProperty] = indexValue;
                }
            }

            return;
        }


        $scope.actor = document.querySelector('#stage-elem');

        //todo find all keyframes
        // var keyFrameRule = findKeyframesRule('bounceInUp');




        function getBrowserPrefix() {
            var browserPrefix;
            navigator.sayswho= (function(){
              var N = navigator.appName, ua = navigator.userAgent, tem;
              var M = ua.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);
              if(M && (tem = ua.match(/version\/([\.\d]+)/i))!= null) M[2] = tem[1];
              M = M? [M[1], M[2]]: [N, navigator.appVersion,'-?'];
              M = M[0];
              if(M == "Chrome") { browserPrefix = "webkit"; }
              if(M == "Firefox") { browserPrefix = "moz"; }
              if(M == "Safari") { browserPrefix = "webkit"; }
              if(M == "MSIE") { browserPrefix = "ms"; }
            })();
            return browserPrefix;


            }

        function cloneTransformPropertiesObj(anim_obj) {
            var emptyTransformObj = transformPropertiesObj();
            var transformObjCloneKeys = Object.keys(anim_obj);
            for (var i = 0; i < transformObjCloneKeys.length; i++) {
                var propertyIndex = transformObjCloneKeys[i];
                emptyTransformObj[propertyIndex] = anim_obj[propertyIndex];
                console.log('copying', propertyIndex);
            }
            return emptyTransformObj;
        }




        function transformPropertiesObj(actor) {
            var transformObj = function()
            {
                this.propertyMappings = {
                    'scaleX': 'scale3DX',
                    'scaleY': 'scale3DY',
                    'scaleZ': 'scale3DZ',
                    'rotateX': 'rotate3DX',
                    'rotateY': 'rotate3DY',
                    'rotateZ': 'rotate3DZ',
                    'rotate': 'rotate3DZ',
                    'translateX': 'translateX',
                    'translateY': 'translateY',
                    'translateZ': 'translateZ',
                    'skewX': 'skewX',
                    'skewY': 'skewY',
                    'background-color': 'backgroundColor',
                    'fill-opacity': 'fillOpacity',
                    'transform-origin': 'transformOrigin',
                    'transform-style': 'transformStyle',
                    'stroke-dasharray': 'strokeDashArray',
                    'stroke-dashoffset': 'strokeDashOffset',
                    'stroke-opacity': 'strokeOpacity',
                    'stroke-width': 'strokeWidth',
                    'transform-perspective': 'transformPerspective',
                    'animation-timing-function': 'animationTimingFunction',
                    '-webkit-animation-timing-function': 'animationTimingFunction'
                }
                this.transformPerspective = 0;
                this.transformOrigin = "50% 50% 0px";
                this.transformOriginX = "50%";
                this.transformOriginY = "50%";
                this.transformOriginZ = "0px";
                this.translateX = 0;
                this.translateY = 0;
                this.translateZ = 0;
                this.scale3DX = 1;
                this.scale3DY = 1;
                this.scale3DZ = 1;
                this.skewXdeg = 0;
                this.skewYdeg = 0;
                this.rotate3DXdeg = 0;
                this.rotate3DYdeg = 0;
                this.rotate3DZdeg = 0;

                this.skewX = 0;
                this.skewY = 0;
                this.rotate3DX = 0;
                this.rotate3DY = 0;
                this.rotate3DZ = 0;
                this.rotate3DAngle = 0;
                this.originX = 50;
                this.originY = 50;
                this.originZ = 50;
                this.visibility = "initial";
                this.animationTimingFunction = "ease";
                this.opacity = 1;
                this.edited = false;
                this.modified = {};
                this.backgroundColor = '#FFFFFF';
                this.color = '#FFFFFF';
                this.fill = '#FFFFFF';
                this.fillOpacity = 1;
                this.stroke = 1;
                this.strokeWidth = 1;
                this.strokeDashArray = "5";
                this.strokeDashOffset = 1;
                this.strokeOpacity = 1;
                this.transformStyle = "preserve-3d";

            };
            return new transformObj();
        }





        $scope.resetKFByIndex = function(kf_index, show_confirm) {
            if (show_confirm || confirm('are you sure? all current properties will be wiped out')) {
                var newTransformObj = transformPropertiesObj();
                var percentIndex = getNthSortedKeyText($scope.animation.obj, parseInt(kf_index));

                var propertiesModified = $scope.animation.selected_keyframe.modified;
                $scope.animation.selected_keyframe = newTransformObj;
                $scope.animation.properties[percentIndex + '%'] = $scope.animation.selected_keyframe;


                var propertiesInitiallyModified = Object.keys(propertiesModified);

                for(var i = 0; i < propertiesInitiallyModified.length; i++) {
                    var indexProperty = propertiesInitiallyModified[i];
                    editKeyframeAtX($scope.animation, percentIndex, indexProperty, $scope.animation.selected_keyframe[indexProperty]);
                }
                $scope.animation.selected_keyframe.modified = {};

            }
        }

        $scope.applyCurrentKFtoAnother = function(kf_index) {
            if (parseInt(kf_index) !== $scope.animation.selected_index) {
                if (confirm('are you sure? any properties @ T = ' + kf_index + ' will be overridden')) {
                    var clonedTransformObj = cloneTransformPropertiesObj($scope.animation.selected_keyframe);
                    var percentIndex = getNthSortedKeyText($scope.animation.obj, parseInt(kf_index));
                    $scope.animation.properties[percentIndex + '%'] = clonedTransformObj;
                    var propertiesModified = $scope.animation.properties[percentIndex + '%'].modified;
                    var propertiesModifiedList = Object.keys(propertiesModified);
                    if (propertiesModifiedList && propertiesModifiedList.length) {
                        console.log('applying properties from t=', $scope.animation.selected_index, 'to kf percentage:', percentIndex, propertiesModifiedList)
                        for(var i = 0; i < propertiesModifiedList.length; i++) {
                            var indexProperty = propertiesModifiedList[i];
                            editKeyframeAtX($scope.animation, percentIndex, indexProperty, propertiesModified[indexProperty]);
                        }
                    }
                }
            }
        }

        function initDanceMove(actor) {
            var defaultDanceMove = function()
            {
                this.domElem = actor || "";
                this.transformPerspective = 0;
                this.translateX = 0;
                this.translateY = 0;
                this.translateZ = 0;
                this.transformOriginX = '50%';
                this.transformOriginY = '50%';
                this.transformOriginZ = 0;
                this.scale3DX = 1;
                this.scale3DY = 1;
                this.scale3DZ = 1;
                this.rotate3DX = 0;
                this.rotate3DY = 0;
                this.rotate3DZ = 0;
                this.rotate3DAngle = 0;
                this.originX = 50;
                this.originY = 50;
                this.originZ = 50;
                this.transformStyle = "preserve-3d";
                this.kf_obj = null;
                this.kf_rules = [];
                this.kf_rule_cache = {};
            };
            return new defaultDanceMove();
        }

        function initKeyboardListeners() {
            document.addEventListener('keydown', danceShortCutKeys);

            function danceShortCutKeys(e) {
                if (e.keyCode === 32)  {
                    playDanceMoves($scope.actor, $scope.danceMoves);
                }

                if (e.keyCode === 82)  {
                    $scope.actor.style[browserPrefix + 'Transform'] = '';
                }
            }
        }

        //TODO
        // - previous transform state should be detected

        // - show the 50px
        // - when it goes to the next move, how do I see
        // - i cant see where i'm at

        function initAll() {

            initView()
            initKeyboardListeners();
        }

        function initAnimationListener(elem) {
            $scope.initListenerAnimation = true;
            if (browserPrefix === 'webkit') {

                elem.addEventListener( 'webkitAnimationEnd',
                function( event ) {
                    $scope.showStatusMsgForXSec('Resetting....')
                    $timeout(function() {
                    $scope.animation.selected_keyframe = $scope.animation.properties[$scope.animation.selected_percent];
                    $scope.animation.selected_index = Object.keys($scope.animation.properties).indexOf($scope.animation.selected_percent);
                    $scope.setActiveKeyFrame($scope.animation.selected_percent.replace('%', ''));
                    console.log($scope.animation.selected_index);
                    if ($scope.actor.cachedStyle) {
                            $scope.actor.style.cssText = $scope.actor.cachedStyle;
                        }
                    // $scope.animation.selected_percent = keyPercent + '%';
                    $timeout(function(){$scope.$apply();})
                    $scope.player.reset();
                    }, 750)
                    // var keyPercent = getNthSortedKeyText($scope.animation.obj, 0);
                }, false );
            } else {
                elem.addEventListener( 'animationend',
                function( event ) {
                    $scope.showStatusMsgForXSec('Resetting....')
                    $timeout(function() {
                        $scope.player.pause();
                        $scope.player.reset();
                        $scope.animation.selected_keyframe = $scope.animation.properties[$scope.animation.selected_percent];
                        $scope.animation.selected_index = Object.keys($scope.animation.properties).indexOf($scope.animation.selected_percent);
                        $scope.setActiveKeyFrame($scope.animation.selected_percent.replace('%', ''));
                        $timeout(function(){$scope.$apply();})
                        if ($scope.actor.cachedStyle) {
                            $scope.actor.style.cssText = $scope.actor.cachedStyle;
                        }
                    }, 750);
                    // var keyPercent = getNthSortedKeyText($scope.animation.obj, 0);

                    // $scope.setActiveKeyFrame($scope.animation.selected_index)
                    // $scope.animation.selected_keyframe = $scope.animation.properties[keyPercent + '%'];
                    // $scope.animation.selected_percent = keyPercent + '%';
                }, false );
            }
        }

        function loadAllS3Files() {

            $timeout(function(){
                getS3Animations()
            },1000);
        }

        $scope.updateDefaults = function(value, property) {

            if (property in $scope.defaults.properties && property in $scope.defaults.units) {
                $scope.defaults.properties[property] = parseInt(value);
                $localstorage.setObject('defaults', $scope.defaults);
                LoadingService.showSuccess(property + ' with value of ' + value + $scope.defaults.units[property].default + ' saved as default & cached', 2500);
                console.log($localstorage.getObject('defaults'));
            }
        }

        function getDefaults () {

            var defaults =  {
                units: {
                    translateX: { options: ['px', '%'], selected: '%', default: '%'},
                    translateY: { options: ['px', '%'], selected: '%', default: '%'},
                    translateZ: { options: ['px', '%'], selected: '%', default: '%'},
                    transformOriginX: { options: ['px', '%'], selected: '%', default: '%'},
                    transformOriginY: { options: ['px', '%'], selected: '%', default: '%'},
                    transformOriginZ: { options: ['px'], selected: 'px', default: 'px'},
                },
                properties: {
                    transformOriginX: 50,
                    transformOriginY: 50,
                    transformOriginZ: 0,
                    translateX: 0,
                    translateY: 0,
                    translateZ: 0,
                    scaleX: 1,
                    scaleY: 1,
                    rotate: '0deg',
                    rotateX: '0deg',
                    rotateY: '0deg',
                    rotateZ: '0deg',
                    skewX: '0deg',
                    skewY: '0deg',
                    opacity: 1,
                    backgroundColor: '#FFFFFF',
                    color: '#FFFFFF',
                    fill: '#FFFFFF',
                    fillOpacity: 1,
                    strokeWidth: 1,
                    strokeDasharray: 5,
                    strokeDashoffset: 1
                }
            }
            if (!$localstorage.getObject('defaults') || ($localstorage.getObject('defaults') === [] && !$localstorage.getObject('defaults').length)) {

                $localstorage.setObject('defaults', defaults)
                defaults = $localstorage.getObject('defaults');
                return defaults;

            } else {
                defaults = $localstorage.getObject('defaults');
                return defaults;
            }
            $timeout(function() {
                $scope.$apply();
            })

        }

        function applyDefaultProperties(defaults) {
            var properties = defaults.properties;
            var units = defaults.units;
            if (units && properties) {
                var propertyNames = Object.keys(properties);
                var currentlySupported = ['transformOriginX', 'transformOriginY', 'transformOriginZ'];
                for (var i = 0; i < propertyNames.length; i++) {
                    var indexProperty = propertyNames[i];
                    if (currentlySupported.indexOf(indexProperty) > -1 && indexProperty.indexOf("transformOrigin") > -1) {
                        var transformOriginValue = properties['transformOriginX'] + units['transformOriginX'].default + " " + properties['transformOriginY'] + units['transformOriginY'].default + " " + properties['transformOriginZ'] + units['transformOriginZ'].default;
                        console.log('transform origin set to', transformOriginValue);
                        $scope.actor.style.transformOrigin = transformOriginValue;
                        $scope.actor.style[browserPrefix + 'TransformOrigin'] = transformOriginValue;
                    }
                }
            }
        }

        function hardCodeStageDimensions() {
            $timeout(function() {
                var stageContainer = document.querySelector('#stage-container');
                var stageDimensions = stageContainer.getBoundingClientRect();
                console.log(stageDimensions);
                var height = stageDimensions.height;
                var width = stageDimensions.width;
                stageContainer.style.height = height + 'px;'
                stageContainer.style.width = width + 'px;'
                console.log(stageContainer);
            }, 3000)

        }

        function convertDecomposeToDistinctProps(js_obj) {
            resultTransformObj = new transformPropertiesObj();
            resultTransformObj.skewX = js_obj.skew[0];
            resultTransformObj.skewY = js_obj.skew[1];
            resultTransformObj.skewXdeg = $scope.rad2degree(js_obj.skew[0]);
            resultTransformObj.skewYdeg = $scope.rad2degree(js_obj.skew[1]);
            resultTransformObj.scale3DX = js_obj.scale[0]; //m11
            resultTransformObj.scale3DY = js_obj.scale[1]; //m22
            resultTransformObj.scale3DZ = js_obj.scale[2]; //m33
            resultTransformObj.translateX = js_obj.translate[0]; //m21
            resultTransformObj.translateY = js_obj.translate[1]; //
            resultTransformObj.translateZ = js_obj.translate[2];
            resultTransformObj.rotate3DX = js_obj.rotate[0];
            resultTransformObj.rotate3DY = js_obj.rotate[1];
            resultTransformObj.rotate3DZ = js_obj.rotate[2];
            resultTransformObj.rotate3DXdeg = $scope.rad2degree(js_obj.rotate[0]);
            resultTransformObj.rotate3DYdeg = $scope.rad2degree(js_obj.rotate[1]);
            resultTransformObj.rotate3DZdeg = $scope.rad2degree(js_obj.rotate[2]);

            if (resultTransformObj.skewX) {
                resultTransformObj.modified['skewX'] = true;
            }
            if (resultTransformObj.skewY) {
                resultTransformObj.modified['skewY'] = true;
            }
            if (resultTransformObj.scale3DX) {
                resultTransformObj.modified['scale3DX'] = true;
            }
            if (resultTransformObj.scale3DY) {
                resultTransformObj.modified['scale3DY'] = true;
            }
            if (resultTransformObj.scale3DZ) {
                resultTransformObj.modified['scale3DZ'] = true;
            }
            if (resultTransformObj.translateX) {
                resultTransformObj.modified['translateX'] = true;
            }
            if (resultTransformObj.translateY) {
                resultTransformObj.modified['translateY'] = true;
            }
            if (resultTransformObj.translateZ) {
                resultTransformObj.modified['translateZ'] = true;
            }
            if (resultTransformObj.translateZ) {
                resultTransformObj.modified['translateZ'] = true;
            }

            return resultTransformObj;
        }


        function convertMatrixIntoTransformProperties(js_obj) {
            console.log('processing', js_obj.cssRules.length, 'items');
            for (var i = 0; i < js_obj.cssRules.length; i++) {
                var indexRule = js_obj.cssRules[i];
                var matrixTransform = indexRule.style.transform || indexRule.style.WebkitTransform || indexRule.style.MozTransform || indexRule.style.msTransform || indexRule.style.OTransform;
                if (matrixTransform) {
                    dMatrix = dynamics.initMatrixFromTransform(matrixTransform)
                    // var originalMatrix = new WebKitCSSMatrix(matrixTransform);
                    // // console.log(matrixTransform, '--->', decomposedMatrix.format(), '\n');
                    // var transformDict = convertDecomposeToDistinctProps(decomposedMatrix);

                }
            }
        }

        function getDMatrixString(d_matrix, transform_str, perspective) {
            console.log(d_matrix)
            transform_str = transform_str + " ";
            var result = "";

            var defaults = {"scaleX": 1, "scaleY": 1, "scaleZ": 1};
            var count =0;

            if (d_matrix.skew[0] || transform_str.split('skewX').length > 1) {
                result += "skewX(" + parseFloat(d_matrix.skew[0], 10) + 'rad) '
                count++;
            }
            if (d_matrix.skew[1] || transform_str.split('skewY').length > 1) {
                result += "skewY(" + parseFloat(d_matrix.skew[1], 10) + 'rad) ';
                count++;
            }
            if (d_matrix.rotate[0] || transform_str.split('rotateX').length > 1) {
                result += "rotateX(" + parseFloat(d_matrix.rotate[0], 10) + 'rad) ';
                count++;
            }

            if (d_matrix.rotate[1] || transform_str.split('rotateY').length > 1) {
                result += "rotateY(" + parseFloat(d_matrix.rotate[1], 10) + "rad) ";
                count++;
            }
            if (d_matrix.rotate[2] || transform_str.split('rotateZ').length > 1) {
                result += "rotateZ(" + parseFloat(d_matrix.rotate[2], 10) + "rad) ";
                count++;
            }
            if (d_matrix.translate[0] || transform_str.split('translateX').length > 1) {
                result += "translateX(" + parseFloat(d_matrix.translate[0], 10) + "%) ";
                count++;
            }
            if (d_matrix.translate[1] || transform_str.split('translateY').length > 1) {
                result += "translateY(" + parseFloat(d_matrix.translate[1], 10) + "%) ";
                count++;
            }
            if (d_matrix.translate[2] || transform_str.split('translateZ').length > 1) {
                result += "translateZ(" + parseFloat(d_matrix.translate[2], 10) + "px) ";
                count++;
            }
            if (d_matrix.scale[0] !== 1 && transform_str.split('scaleX').length > 1) {
                result += "scaleX(" + parseFloat(d_matrix.scale[0], 10) + ") ";
                count++;
            }
            if (d_matrix.scale[1] !== 1 && transform_str.split('scaleY').length > 1) {
                result += "scaleY(" + parseFloat(d_matrix.scale[1], 10) + ") ";
                count++;
            }
            if (d_matrix.scale[2] !== 1 &&  transform_str.split('scaleZ').length > 1) {
                result += "scaleZ(" + parseFloat(d_matrix.scale[1], 10) + ") ";
                count++;
            }
            if (transform_str.split('scale(').length > 1) {
                result += "scaleX(" + parseFloat(d_matrix.scale[0], 10) + ") scaleY(" + parseFloat(d_matrix.scale[1], 10) + ") ";
                count++;
            }
            if (transform_str.split('scale3d(').length > 1) {
                result += "scale3d(" + parseFloat(d_matrix.scale[0], 10) + ", " + parseFloat(d_matrix.scale[1], 10) + ", " + parseFloat(d_matrix.scale[1], 10) +  ") ";
                count++;
            }
            if (perspective && perspective.length) {
                result += "perspective(" + perspective + ') '
                count++;
            }
            if (transform_str.split('rotate(').length > 1) {
                var rotateValue = transform_str.split('rotate(')[1].split(')')[0];
                console.log('rotateValue discovered... hacking..');
                result += "rotate(" + rotateValue +") ";
                count++;
            }
            if (count) {
                result = "transform:" + result + ";" //+ '-' + browserPrefix + "Transform:" + result;
                return result
            }

        }

        function doesPropertyExistInsideTransformString(prop, transform_value) {
            return (transform_value.split(prop).length > 1) || (transform_value === prop && transform_value.length === prop.length);
        }

        function updateDropdown(uguru_anim_obj) {


            // var elem = document.querySelector('#animation-name-dropdown');
            uguru_anim_obj.selected_keyframe = uguru_anim_obj.obj.cssRules.item(0);
            uguru_anim_obj.selected_kf_index = 0;
            uguru_anim_obj.selected_percent = uguru_anim_obj.selected_keyframe.keyText;
            uguru_anim_obj.selected_index = 0;
            uguru_anim_obj.num_keyframes = uguru_anim_obj.obj.cssRules.length;
            // $scope.setActiveKeyFrame
            // $compile(elem)($scope);
            $scope.asideTabIndex = 1;
            $scope.actor = document.querySelector('#stage-elem');
        }

        function importLastAnimation() {
            var lastAnimation = $localstorage.getObject('last_animation');

            // lastAnimation.attr.name.replace('-edit-edit', '-edit');
            if (lastAnimation && (!lastAnimation.attr || !lastAnimation.attr.name || !lastAnimation.attr.name.length)) {

                $scope.animation = initAnimation('base-animation', browserPrefix, defaults.KF_COUNT, defaults.DURATION, true);
                if ($scope.animation.obj.name.indexOf('-edit') === -1) {
                    $scope.animation.obj.name = $scope.animation.obj.name + '-edit';
                    $scope.animation.attr.name = $scope.animation.obj.name + '-edit';
                    $timeout(function() {
                        $scope.kf_visuals.show = true;
                        $scope.kf_visuals.onChange(true);
                        $scope.$apply();
                    }, 500)
                }
                $scope.animationDropdown.options[0] = $scope.animation.obj.name;
                $scope.animationDropdown.options.push('Save');
                if ($scope.stage && $scope.stage.stageName) {
                    $scope.updatePageDom($scope.stage.stageName, $scope.stage.stageHtml, $scope.stage.stageCss);
                }
            } else {
                // reconstructAnimationFromProperties(serverAnimation.attr, serverAnimation.properties, serverAnimation.kf_count);

                var callback = function() {
                    if ($scope.animation.obj.name.indexOf('-edit') === -1) {
                        $scope.animation.obj.name = $scope.animation.obj.name + '-edit';
                        $scope.animation.attr.name = $scope.animation.obj.name + '-edit';
                    }
                    $scope.animationDropdown.options[0] = $scope.animation.obj.name;
                    $scope.animationDropdown.options.push('Save');
                    if ($scope.stage && $scope.stage.stageName) {
                        $scope.updatePageDom($scope.stage.stageName, $scope.stage.stageHtml, $scope.stage.stageCss);
                    }
                }
                reconstructAnimationFromProperties(lastAnimation.attr, lastAnimation.properties, lastAnimation.kf_count, callback)
            }

            return;
        }

        function clearStageTemplate() {
            $scope.stageDropdown.options = $scope.stageDropdown.options.slice(0, $scope.stageDropdown.options.length - 2);
            $scope.saveStageHtml(true, true);
            $localstorage.removeObject('last_stage');
            $timeout(function() {
                $scope.resetStageDom();
                $localstorage.removeObject('last_stage');
                $scope.stageDropdown = {toggleActive: true,options:['No stage selected', 'Import Stage'], selectedIndex: 0, label:'Current Stage', size:'small', onOptionClick: onStageDropdownSelected};
            }, 1500)
        }


        function importLastStage() {
            var lastStage = $localstorage.getObject('last_stage');

            if (lastStage  && !lastStage.length && !lastStage.stageHtml) {
                console.log('no stage', lastStage);
                lastStage = {stageName: 'defaultGuru', stageCss:'height:100px !important;width:100px !important;', stageHtml:'<svg viewBox="0 0 150 150" id="stage-elem" draggable="true" class="size-150 radius-4" style="cursor: pointer; position: relative; min-width: 100px; min-height: 100px; animation-duration: 0.25s; animation-iteration-count: 4; animation-timing-function: ease; animation-fill-mode: forwards; animation-direction: normal; animation-delay: 0s; height: 100%; width: 100%; left: 0px; top: 0px;">                     <g fill="none" fill-rule="evenodd">                         <path id="svg-path-line" d="M36,89 C36,89 32,89 30,93 C28,97 28.9750979,103.312012 32.970215,105.79248 C36.9653322,108.272949 40.0000002,105 40,105 C43.9716799,112.0625 51.4101584,131.488446 84.5060264,129.99722 C110.625974,128.820313 122.641113,110.905274 122,95 C122,95 126.995605,97.3076173 129.519043,93.7084962 C132.04248,90.1093751 133,85.9999999 131,82.0000002 C129,78.0000005 126,77 122,79 C125,66.0000006 107,53 107,53 C95,57 83,49 72,49 C61,49 32,55 36,89" stroke="#33534D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="#F9ECE5"></path>                         <path d="M86,115 C91,116 101,114 101,108" stroke="#33534D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>                         <path d="M30,71 C19.8095703,72.2685547 11.9628907,58 21.0712891,47.8300781 C21.0712892,53 25.0009767,58 30.9999994,58 C18.9804688,50.9570312 24.8095704,23.3339844 42.3525396,19.9365234 C38.5996099,27.453125 49.4423812,31 53,31 C53,31 54,23 61,21 C55,37 97,22 109,42 C109,42 110,49 107,53 C95,57 83,49 72,49 C61,49 32,55 36,89 C36,89 26,85 30,71 Z M107,53 C107,53 125,66.0000006 122,79 C138,61.9999994 115.78,39 109,42 C109,42 110,49 107,53 Z" stroke="#33534D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="#69B3A5"></path>                         <path d="M78.5746668,76.3474511 C74.5891604,76.700595 73.2136606,78.9335687 73.3857487,79.1764552 C74.4389701,80.6560625 75.2624913,82.3360577 75.7916306,84.1810433 C78.2951471,92.9132364 73.2459966,102.022376 64.5138811,104.526779 C55.7808023,107.030373 46.6716623,101.981222 44.1672601,93.2491065 C42.5744394,87.6932015 37.199641,88.0099196 37.199641,88.0099196 L37.0757398,84.6451964 C37.0757398,84.6451964 39.3423669,84.0488221 41.9589013,82.3204481 C44.7727831,80.4605641 47.9707958,77.4415877 48.5525427,76.878377 C50.4279684,75.0648959 52.7624199,73.6726953 55.4458954,72.9032938 C61.1323387,71.2722764 66.978569,72.8448642 71.0568783,76.5517651 C71.234315,76.7129631 72.5871447,74.2208686 78.3445462,73.7171612 C83.6590708,73.2522005 85.4240955,75.4715182 85.5708448,75.2819576 C88.9434989,70.9231818 94.4278349,68.359298 100.311111,68.978096 C103.087424,69.2698279 105.628163,70.2355046 107.790005,71.6957706 C108.460714,72.1494056 112.134381,74.5671879 115.228479,75.9101906 C118.105392,77.1579503 120.441143,77.3516687 120.441143,77.3516687 L120.903402,80.6867894 C120.903402,80.6867894 115.555262,81.3082069 114.951412,87.0562956 C114.001374,96.0906356 105.907398,102.644864 96.8722494,101.695788 C87.8379094,100.745749 81.2836814,92.6517735 82.2328344,83.617511 C82.4335564,81.7086708 82.9528384,79.9111955 83.7331279,78.2711769 C83.8604248,78.0020975 82.1180701,76.0419007 78.1317897,76.3861978 L78.5746668,76.3474511 Z M61.70313,102.841647 C69.0409571,102.19967 74.4690164,95.7307611 73.8270397,88.392934 C73.185063,81.0551069 66.7161539,75.6270476 59.3783268,76.2690243 C52.0404997,76.911001 46.6124404,83.3799101 47.2544171,90.7177372 C47.8963938,98.0555643 54.3653029,103.483624 61.70313,102.841647 Z M99.3476788,99.5481757 C92.0098516,100.190152 85.5409425,94.7620931 84.8989658,87.424266 C84.2569891,80.0864388 89.6850484,73.6175297 97.0228755,72.975553 C104.360703,72.3335763 110.829612,77.7616356 111.471588,85.0994627 C112.113565,92.4372898 106.685506,98.906199 99.3476788,99.5481757 Z" stroke="#33534D" stroke-linecap="round" stroke-linejoin="round" fill="#33534D"></path>                         <path d="M65.5288326,95.1640534 C67.7258698,94.9331355 69.3197243,92.9648891 69.0888064,90.767852 C68.8578885,88.5708149 66.7417349,86.6882461 64.5880769,86.2133563 C61.4999827,85.5324198 59.5109385,85.7414768 56.6319013,87.0495841 C53.7528641,88.3576913 51.1874123,92.6493644 51.1874123,92.6493644 L53.2593359,93.2288569 C57.7309517,87.9395775 60.9235743,89.6150359 61.1326312,91.6040797 C61.3635491,93.8011168 63.3317955,95.3949713 65.5288326,95.1640534 L65.5288326,95.1640534 Z M103.289054,90.8388129 C105.486092,90.607895 107.079946,88.6396486 106.849028,86.4426115 C106.61811,84.2455744 104.501957,82.3630056 102.348299,81.8881158 C99.2602046,81.2071793 97.2711603,81.4162363 94.3921231,82.7243435 C91.5130859,84.0324508 88.9476341,88.3241239 88.9476341,88.3241239 L91.0195577,88.9036164 C95.4911735,83.614337 98.6837961,85.2897954 98.892853,87.2788392 C99.123771,89.4758763 101.092017,91.0697308 103.289054,90.8388129 L103.289054,90.8388129 Z" fill="#33534D"></path>                         <path d="M45,70 L67,71 L67,68 L47,64 L45,70 L45,70 Z M109.752203,65.6040853 L87.9230753,68.5177063 L87.6616081,65.5291222 L107.236879,59.8012286 L109.752203,65.6040853 L109.752203,65.6040853 Z" stroke="#33534D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="#69B3A5"></path>                         <path d="M35.5,105 C36.3284271,105 37,104.328427 37,103.5 C37,102.671573 36.3284271,102 35.5,102 C34.6715729,102 34,102.671573 34,103.5 C34,104.328427 34.6715729,105 35.5,105 L35.5,105 Z M126.223145,93.7663574 C127.051572,93.7663574 127.723145,93.0947845 127.723145,92.2663574 C127.723145,91.4379303 127.051572,90.7663574 126.223145,90.7663574 C125.394717,90.7663574 124.723145,91.4379303 124.723145,92.2663574 C124.723145,93.0947845 125.394717,93.7663574 126.223145,93.7663574 L126.223145,93.7663574 Z" stroke="#33534D" stroke-linecap="round" stroke-linejoin="round" fill="#33534D"></path><path d="M29.8920408,92.4285792 C28.8157813,92.1801051 27.7418726,92.8511578 27.4933985,93.9274172 C27.2449245,95.0036767 27.9159771,96.0775854 28.9922366,96.3260595 C30.068496,96.5745335 31.1424047,95.9034809 31.3908788,94.8272214 M129.716513,89.0236025 C129.449293,90.0953616 130.101502,91.1808182 131.173261,91.4480377 C132.24502,91.7152573 133.330476,91.0630491 133.597696,89.9912901 C133.864915,88.919531 133.212707,87.8340744 132.140948,87.5668548" stroke="#33534D" stroke-linecap="round" stroke-linejoin="round"></path></g></svg>'}
                $scope.stage = lastStage;
                $scope.updatePageDom(lastStage.stageName, lastStage.stageHtml, lastStage.stageCss, 'stage-elem');
            } else {

                $timeout(function() {
                    lastStage = {stageName: 'defaultGuru', stageCss:'height:100px !important;width:100px !important;', stageHtml:'<svg viewBox="0 0 150 150" id="stage-elem" draggable="true" class="size-150 radius-4" style="cursor: pointer; position: relative; min-width: 100px; min-height: 100px; animation-duration: 0.25s; animation-iteration-count: 4; animation-timing-function: ease; animation-fill-mode: forwards; animation-direction: normal; animation-delay: 0s; height: 100%; width: 100%; left: 0px; top: 0px;">                     <g fill="none" fill-rule="evenodd">                         <path id="svg-path-line" d="M36,89 C36,89 32,89 30,93 C28,97 28.9750979,103.312012 32.970215,105.79248 C36.9653322,108.272949 40.0000002,105 40,105 C43.9716799,112.0625 51.4101584,131.488446 84.5060264,129.99722 C110.625974,128.820313 122.641113,110.905274 122,95 C122,95 126.995605,97.3076173 129.519043,93.7084962 C132.04248,90.1093751 133,85.9999999 131,82.0000002 C129,78.0000005 126,77 122,79 C125,66.0000006 107,53 107,53 C95,57 83,49 72,49 C61,49 32,55 36,89" stroke="#33534D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="#F9ECE5"></path>                         <path d="M86,115 C91,116 101,114 101,108" stroke="#33534D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>                         <path d="M30,71 C19.8095703,72.2685547 11.9628907,58 21.0712891,47.8300781 C21.0712892,53 25.0009767,58 30.9999994,58 C18.9804688,50.9570312 24.8095704,23.3339844 42.3525396,19.9365234 C38.5996099,27.453125 49.4423812,31 53,31 C53,31 54,23 61,21 C55,37 97,22 109,42 C109,42 110,49 107,53 C95,57 83,49 72,49 C61,49 32,55 36,89 C36,89 26,85 30,71 Z M107,53 C107,53 125,66.0000006 122,79 C138,61.9999994 115.78,39 109,42 C109,42 110,49 107,53 Z" stroke="#33534D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="#69B3A5"></path>                         <path d="M78.5746668,76.3474511 C74.5891604,76.700595 73.2136606,78.9335687 73.3857487,79.1764552 C74.4389701,80.6560625 75.2624913,82.3360577 75.7916306,84.1810433 C78.2951471,92.9132364 73.2459966,102.022376 64.5138811,104.526779 C55.7808023,107.030373 46.6716623,101.981222 44.1672601,93.2491065 C42.5744394,87.6932015 37.199641,88.0099196 37.199641,88.0099196 L37.0757398,84.6451964 C37.0757398,84.6451964 39.3423669,84.0488221 41.9589013,82.3204481 C44.7727831,80.4605641 47.9707958,77.4415877 48.5525427,76.878377 C50.4279684,75.0648959 52.7624199,73.6726953 55.4458954,72.9032938 C61.1323387,71.2722764 66.978569,72.8448642 71.0568783,76.5517651 C71.234315,76.7129631 72.5871447,74.2208686 78.3445462,73.7171612 C83.6590708,73.2522005 85.4240955,75.4715182 85.5708448,75.2819576 C88.9434989,70.9231818 94.4278349,68.359298 100.311111,68.978096 C103.087424,69.2698279 105.628163,70.2355046 107.790005,71.6957706 C108.460714,72.1494056 112.134381,74.5671879 115.228479,75.9101906 C118.105392,77.1579503 120.441143,77.3516687 120.441143,77.3516687 L120.903402,80.6867894 C120.903402,80.6867894 115.555262,81.3082069 114.951412,87.0562956 C114.001374,96.0906356 105.907398,102.644864 96.8722494,101.695788 C87.8379094,100.745749 81.2836814,92.6517735 82.2328344,83.617511 C82.4335564,81.7086708 82.9528384,79.9111955 83.7331279,78.2711769 C83.8604248,78.0020975 82.1180701,76.0419007 78.1317897,76.3861978 L78.5746668,76.3474511 Z M61.70313,102.841647 C69.0409571,102.19967 74.4690164,95.7307611 73.8270397,88.392934 C73.185063,81.0551069 66.7161539,75.6270476 59.3783268,76.2690243 C52.0404997,76.911001 46.6124404,83.3799101 47.2544171,90.7177372 C47.8963938,98.0555643 54.3653029,103.483624 61.70313,102.841647 Z M99.3476788,99.5481757 C92.0098516,100.190152 85.5409425,94.7620931 84.8989658,87.424266 C84.2569891,80.0864388 89.6850484,73.6175297 97.0228755,72.975553 C104.360703,72.3335763 110.829612,77.7616356 111.471588,85.0994627 C112.113565,92.4372898 106.685506,98.906199 99.3476788,99.5481757 Z" stroke="#33534D" stroke-linecap="round" stroke-linejoin="round" fill="#33534D"></path>                         <path d="M65.5288326,95.1640534 C67.7258698,94.9331355 69.3197243,92.9648891 69.0888064,90.767852 C68.8578885,88.5708149 66.7417349,86.6882461 64.5880769,86.2133563 C61.4999827,85.5324198 59.5109385,85.7414768 56.6319013,87.0495841 C53.7528641,88.3576913 51.1874123,92.6493644 51.1874123,92.6493644 L53.2593359,93.2288569 C57.7309517,87.9395775 60.9235743,89.6150359 61.1326312,91.6040797 C61.3635491,93.8011168 63.3317955,95.3949713 65.5288326,95.1640534 L65.5288326,95.1640534 Z M103.289054,90.8388129 C105.486092,90.607895 107.079946,88.6396486 106.849028,86.4426115 C106.61811,84.2455744 104.501957,82.3630056 102.348299,81.8881158 C99.2602046,81.2071793 97.2711603,81.4162363 94.3921231,82.7243435 C91.5130859,84.0324508 88.9476341,88.3241239 88.9476341,88.3241239 L91.0195577,88.9036164 C95.4911735,83.614337 98.6837961,85.2897954 98.892853,87.2788392 C99.123771,89.4758763 101.092017,91.0697308 103.289054,90.8388129 L103.289054,90.8388129 Z" fill="#33534D"></path>                         <path d="M45,70 L67,71 L67,68 L47,64 L45,70 L45,70 Z M109.752203,65.6040853 L87.9230753,68.5177063 L87.6616081,65.5291222 L107.236879,59.8012286 L109.752203,65.6040853 L109.752203,65.6040853 Z" stroke="#33534D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="#69B3A5"></path>                         <path d="M35.5,105 C36.3284271,105 37,104.328427 37,103.5 C37,102.671573 36.3284271,102 35.5,102 C34.6715729,102 34,102.671573 34,103.5 C34,104.328427 34.6715729,105 35.5,105 L35.5,105 Z M126.223145,93.7663574 C127.051572,93.7663574 127.723145,93.0947845 127.723145,92.2663574 C127.723145,91.4379303 127.051572,90.7663574 126.223145,90.7663574 C125.394717,90.7663574 124.723145,91.4379303 124.723145,92.2663574 C124.723145,93.0947845 125.394717,93.7663574 126.223145,93.7663574 L126.223145,93.7663574 Z" stroke="#33534D" stroke-linecap="round" stroke-linejoin="round" fill="#33534D"></path><path d="M29.8920408,92.4285792 C28.8157813,92.1801051 27.7418726,92.8511578 27.4933985,93.9274172 C27.2449245,95.0036767 27.9159771,96.0775854 28.9922366,96.3260595 C30.068496,96.5745335 31.1424047,95.9034809 31.3908788,94.8272214 M129.716513,89.0236025 C129.449293,90.0953616 130.101502,91.1808182 131.173261,91.4480377 C132.24502,91.7152573 133.330476,91.0630491 133.597696,89.9912901 C133.864915,88.919531 133.212707,87.8340744 132.140948,87.5668548" stroke="#33534D" stroke-linecap="round" stroke-linejoin="round"></path></g></svg>'}
                    $scope.stage = lastStage;
                    $scope.updatePageDom(lastStage.stageName, lastStage.stageHtml, lastStage.stageCss, 'stage-elem');
                })
            }
            return;
        }

        function initView() {
            browserPrefix = getBrowserPrefix();


                // var bounceJS = "@-webkit-keyframes animation { 0% { -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -300, 0, 0, 1); transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -300, 0, 0, 1); }0.22% { -webkit-transform: matrix3d(3.676, 0.337, 0, 0, -1.316, 0.942, 0, 0, 0, 0, 1, 0, -237.02, 0, 0, 1); transform: matrix3d(3.676, 0.337, 0, 0, -1.316, 0.942, 0, 0, 0, 0, 1, 0, -237.02, 0, 0, 1); }0.43% { -webkit-transform: matrix3d(3.527, 0.633, 0, 0, -2.881, 0.774, 0, 0, 0, 0, 1, 0, -182.798, 0, 0, 1); transform: matrix3d(3.527, 0.633, 0, 0, -2.881, 0.774, 0, 0, 0, 0, 1, 0, -182.798, 0, 0, 1); }0.68% { -webkit-transform: matrix3d(1.816, 0.892, 0, 0, -3.592, 0.451, 0, 0, 0, 0, 1, 0, -125.912, 0, 0, 1); transform: matrix3d(1.816, 0.892, 0, 0, -3.592, 0.451, 0, 0, 0, 0, 1, 0, -125.912, 0, 0, 1); }0.72% { -webkit-transform: matrix3d(1.578, 0.915, 0, 0, -3.577, 0.404, 0, 0, 0, 0, 1, 0, -119.441, 0, 0, 1); transform: matrix3d(1.578, 0.915, 0, 0, -3.577, 0.404, 0, 0, 0, 0, 1, 0, -119.441, 0, 0, 1); }0.95% { -webkit-transform: matrix3d(0.183, 0.998, 0, 0, -3.034, 0.06, 0, 0, 0, 0, 1, 0, -79.596, 0, 0, 1); transform: matrix3d(0.183, 0.998, 0, 0, -3.034, 0.06, 0, 0, 0, 0, 1, 0, -79.596, 0, 0, 1); }1.35% { -webkit-transform: matrix3d(-0.843, 0.886, 0, 0, -1.613, -0.463, 0, 0, 0, 0, 1, 0, -31.647, 0, 0, 1); transform: matrix3d(-0.843, 0.886, 0, 0, -1.613, -0.463, 0, 0, 0, 0, 1, 0, -31.647, 0, 0, 1); }1.43% { -webkit-transform: matrix3d(-0.904, 0.835, 0, 0, -1.373, -0.55, 0, 0, 0, 0, 1, 0, -24.472, 0, 0, 1); transform: matrix3d(-0.904, 0.835, 0, 0, -1.373, -0.55, 0, 0, 0, 0, 1, 0, -24.472, 0, 0, 1); }1.47% { -webkit-transform: matrix3d(-0.92, 0.813, 0, 0, -1.285, -0.582, 0, 0, 0, 0, 1, 0, -21.84, 0, 0, 1); transform: matrix3d(-0.92, 0.813, 0, 0, -1.285, -0.582, 0, 0, 0, 0, 1, 0, -21.84, 0, 0, 1); }1.99% { -webkit-transform: matrix3d(-0.942, 0.412, 0, 0, -0.426, -0.911, 0, 0, 0, 0, 1, 0, 4.825, 0, 0, 1); transform: matrix3d(-0.942, 0.412, 0, 0, -0.426, -0.911, 0, 0, 0, 0, 1, 0, 4.825, 0, 0, 1); }2.02% { -webkit-transform: matrix3d(-0.941, 0.393, 0, 0, -0.402, -0.92, 0, 0, 0, 0, 1, 0, 5.53, 0, 0, 1); transform: matrix3d(-0.941, 0.393, 0, 0, -0.402, -0.92, 0, 0, 0, 0, 1, 0, 5.53, 0, 0, 1); }2.15% { -webkit-transform: matrix3d(-0.938, 0.294, 0, 0, -0.288, -0.956, 0, 0, 0, 0, 1, 0, 8.637, 0, 0, 1); transform: matrix3d(-0.938, 0.294, 0, 0, -0.288, -0.956, 0, 0, 0, 0, 1, 0, 8.637, 0, 0, 1); }2.51% { -webkit-transform: matrix3d(-0.945, 0.061, 0, 0, -0.058, -0.998, 0, 0, 0, 0, 1, 0, 12.662, 0, 0, 1); transform: matrix3d(-0.945, 0.061, 0, 0, -0.058, -0.998, 0, 0, 0, 0, 1, 0, 12.662, 0, 0, 1); }2.55% { -webkit-transform: matrix3d(-0.946, 0.038, 0, 0, -0.036, -0.999, 0, 0, 0, 0, 1, 0, 12.819, 0, 0, 1); transform: matrix3d(-0.946, 0.038, 0, 0, -0.036, -0.999, 0, 0, 0, 0, 1, 0, 12.819, 0, 0, 1); }2.69% { -webkit-transform: matrix3d(-0.95, -0.032, 0, 0, 0.031, -0.999, 0, 0, 0, 0, 1, 0, 13.007, 0, 0, 1); transform: matrix3d(-0.95, -0.032, 0, 0, 0.031, -0.999, 0, 0, 0, 0, 1, 0, 13.007, 0, 0, 1); }2.87% { -webkit-transform: matrix3d(-0.954, -0.116, 0, 0, 0.112, -0.993, 0, 0, 0, 0, 1, 0, 12.639, 0, 0, 1); transform: matrix3d(-0.954, -0.116, 0, 0, 0.112, -0.993, 0, 0, 0, 0, 1, 0, 12.639, 0, 0, 1); }3.85% { -webkit-transform: matrix3d(-0.926, -0.372, 0, 0, 0.371, -0.928, 0, 0, 0, 0, 1, 0, 6.116, 0, 0, 1); transform: matrix3d(-0.926, -0.372, 0, 0, 0.371, -0.928, 0, 0, 0, 0, 1, 0, 6.116, 0, 0, 1); }4.54% { -webkit-transform: matrix3d(-0.908, -0.421, 0, 0, 0.422, -0.907, 0, 0, 0, 0, 1, 0, 2.352, 0, 0, 1); transform: matrix3d(-0.908, -0.421, 0, 0, 0.422, -0.907, 0, 0, 0, 0, 1, 0, 2.352, 0, 0, 1); }4.6% { -webkit-transform: matrix3d(-0.907, -0.422, 0, 0, 0.423, -0.906, 0, 0, 0, 0, 1, 0, 2.121, 0, 0, 1); transform: matrix3d(-0.907, -0.422, 0, 0, 0.423, -0.906, 0, 0, 0, 0, 1, 0, 2.121, 0, 0, 1); }4.72% { -webkit-transform: matrix3d(-0.907, -0.423, 0, 0, 0.424, -0.906, 0, 0, 0, 0, 1, 0, 1.672, 0, 0, 1); transform: matrix3d(-0.907, -0.423, 0, 0, 0.424, -0.906, 0, 0, 0, 0, 1, 0, 1.672, 0, 0, 1); }5.11% { -webkit-transform: matrix3d(-0.91, -0.416, 0, 0, 0.416, -0.91, 0, 0, 0, 0, 1, 0, 0.651, 0, 0, 1); transform: matrix3d(-0.91, -0.416, 0, 0, 0.416, -0.91, 0, 0, 0, 0, 1, 0, 0.651, 0, 0, 1); }6.39% { -webkit-transform: matrix3d(-0.952, -0.305, 0, 0, 0.305, -0.952, 0, 0, 0, 0, 1, 0, -0.311, 0, 0, 1); transform: matrix3d(-0.952, -0.305, 0, 0, 0.305, -0.952, 0, 0, 0, 0, 1, 0, -0.311, 0, 0, 1); }6.57% { -webkit-transform: matrix3d(-0.959, -0.282, 0, 0, 0.282, -0.959, 0, 0, 0, 0, 1, 0, -0.302, 0, 0, 1); transform: matrix3d(-0.959, -0.282, 0, 0, 0.282, -0.959, 0, 0, 0, 0, 1, 0, -0.302, 0, 0, 1); }6.61% { -webkit-transform: matrix3d(-0.961, -0.277, 0, 0, 0.277, -0.961, 0, 0, 0, 0, 1, 0, -0.299, 0, 0, 1); transform: matrix3d(-0.961, -0.277, 0, 0, 0.277, -0.961, 0, 0, 0, 0, 1, 0, -0.299, 0, 0, 1); }6.68% { -webkit-transform: matrix3d(-0.963, -0.268, 0, 0, 0.268, -0.963, 0, 0, 0, 0, 1, 0, -0.291, 0, 0, 1); transform: matrix3d(-0.963, -0.268, 0, 0, 0.268, -0.963, 0, 0, 0, 0, 1, 0, -0.291, 0, 0, 1); }8.06% { -webkit-transform: matrix3d(-0.996, -0.084, 0, 0, 0.084, -0.996, 0, 0, 0, 0, 1, 0, -0.076, 0, 0, 1); transform: matrix3d(-0.996, -0.084, 0, 0, 0.084, -0.996, 0, 0, 0, 0, 1, 0, -0.076, 0, 0, 1); }8.33% { -webkit-transform: matrix3d(-0.999, -0.051, 0, 0, 0.051, -0.999, 0, 0, 0, 0, 1, 0, -0.048, 0, 0, 1); transform: matrix3d(-0.999, -0.051, 0, 0, 0.051, -0.999, 0, 0, 0, 0, 1, 0, -0.048, 0, 0, 1); }9.51% { -webkit-transform: matrix3d(-0.998, 0.055, 0, 0, -0.055, -0.998, 0, 0, 0, 0, 1, 0, 0.004, 0, 0, 1); transform: matrix3d(-0.998, 0.055, 0, 0, -0.055, -0.998, 0, 0, 0, 0, 1, 0, 0.004, 0, 0, 1); }10.09% { -webkit-transform: matrix3d(-0.997, 0.084, 0, 0, -0.084, -0.997, 0, 0, 0, 0, 1, 0, 0.007, 0, 0, 1); transform: matrix3d(-0.997, 0.084, 0, 0, -0.084, -0.997, 0, 0, 0, 0, 1, 0, 0.007, 0, 0, 1); }10.28% { -webkit-transform: matrix3d(-0.996, 0.089, 0, 0, -0.089, -0.996, 0, 0, 0, 0, 1, 0, 0.007, 0, 0, 1); transform: matrix3d(-0.996, 0.089, 0, 0, -0.089, -0.996, 0, 0, 0, 0, 1, 0, 0.007, 0, 0, 1); }10.96% { -webkit-transform: matrix3d(-0.995, 0.098, 0, 0, -0.098, -0.995, 0, 0, 0, 0, 1, 0, 0.005, 0, 0, 1); transform: matrix3d(-0.995, 0.098, 0, 0, -0.098, -0.995, 0, 0, 0, 0, 1, 0, 0.005, 0, 0, 1); }13.8% { -webkit-transform: matrix3d(-1, 0.025, 0, 0, -0.025, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0.025, 0, 0, -0.025, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }14% { -webkit-transform: matrix3d(-1, 0.019, 0, 0, -0.019, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0.019, 0, 0, -0.019, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }16.57% { -webkit-transform: matrix3d(-1, -0.023, 0, 0, 0.023, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, -0.023, 0, 0, 0.023, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }16.67% { -webkit-transform: matrix3d(-1, -0.023, 0, 0, 0.023, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, -0.023, 0, 0, 0.023, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }16.87% { -webkit-transform: matrix3d(-1, -0.024, 0, 0, 0.013, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, -0.024, 0, 0, 0.013, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }20.92% { -webkit-transform: matrix3d(-1, 0.002, 0, 0, -0.323, -0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0.002, 0, 0, -0.323, -0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }22.77% { -webkit-transform: matrix3d(-1, 0.006, 0, 0, -0.432, -0.998, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0.006, 0, 0, -0.432, -0.998, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }23.09% { -webkit-transform: matrix3d(-1, 0.006, 0, 0, -0.444, -0.998, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0.006, 0, 0, -0.444, -0.998, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }25.18% { -webkit-transform: matrix3d(-1, 0.002, 0, 0, -0.474, -0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0.002, 0, 0, -0.474, -0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }27.68% { -webkit-transform: matrix3d(-1, -0.001, 0, 0, -0.438, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, -0.001, 0, 0, -0.438, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }28.63% { -webkit-transform: matrix3d(-1, -0.001, 0, 0, -0.417, -1.001, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, -0.001, 0, 0, -0.417, -1.001, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }30.1% { -webkit-transform: matrix3d(-1, -0.001, 0, 0, -0.385, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, -0.001, 0, 0, -0.385, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }32.52% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.35, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.35, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }34.53% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.34, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.34, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }34.93% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.34, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.34, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }40.44% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.361, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.361, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }44.78% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.37, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.37, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }46.3% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.369, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.369, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }50% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.365, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.365, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }54.62% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.363, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.363, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }64.38% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }74.22% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }84.07% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }93.83% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }100% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }";
                // bounceJS += "@keyframes animation { 0% { -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -300, 0, 0, 1); transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -300, 0, 0, 1); }0.22% { -webkit-transform: matrix3d(3.676, 0.337, 0, 0, -1.316, 0.942, 0, 0, 0, 0, 1, 0, -237.02, 0, 0, 1); transform: matrix3d(3.676, 0.337, 0, 0, -1.316, 0.942, 0, 0, 0, 0, 1, 0, -237.02, 0, 0, 1); }0.43% { -webkit-transform: matrix3d(3.527, 0.633, 0, 0, -2.881, 0.774, 0, 0, 0, 0, 1, 0, -182.798, 0, 0, 1); transform: matrix3d(3.527, 0.633, 0, 0, -2.881, 0.774, 0, 0, 0, 0, 1, 0, -182.798, 0, 0, 1); }0.68% { -webkit-transform: matrix3d(1.816, 0.892, 0, 0, -3.592, 0.451, 0, 0, 0, 0, 1, 0, -125.912, 0, 0, 1); transform: matrix3d(1.816, 0.892, 0, 0, -3.592, 0.451, 0, 0, 0, 0, 1, 0, -125.912, 0, 0, 1); }0.72% { -webkit-transform: matrix3d(1.578, 0.915, 0, 0, -3.577, 0.404, 0, 0, 0, 0, 1, 0, -119.441, 0, 0, 1); transform: matrix3d(1.578, 0.915, 0, 0, -3.577, 0.404, 0, 0, 0, 0, 1, 0, -119.441, 0, 0, 1); }0.95% { -webkit-transform: matrix3d(0.183, 0.998, 0, 0, -3.034, 0.06, 0, 0, 0, 0, 1, 0, -79.596, 0, 0, 1); transform: matrix3d(0.183, 0.998, 0, 0, -3.034, 0.06, 0, 0, 0, 0, 1, 0, -79.596, 0, 0, 1); }1.35% { -webkit-transform: matrix3d(-0.843, 0.886, 0, 0, -1.613, -0.463, 0, 0, 0, 0, 1, 0, -31.647, 0, 0, 1); transform: matrix3d(-0.843, 0.886, 0, 0, -1.613, -0.463, 0, 0, 0, 0, 1, 0, -31.647, 0, 0, 1); }1.43% { -webkit-transform: matrix3d(-0.904, 0.835, 0, 0, -1.373, -0.55, 0, 0, 0, 0, 1, 0, -24.472, 0, 0, 1); transform: matrix3d(-0.904, 0.835, 0, 0, -1.373, -0.55, 0, 0, 0, 0, 1, 0, -24.472, 0, 0, 1); }1.47% { -webkit-transform: matrix3d(-0.92, 0.813, 0, 0, -1.285, -0.582, 0, 0, 0, 0, 1, 0, -21.84, 0, 0, 1); transform: matrix3d(-0.92, 0.813, 0, 0, -1.285, -0.582, 0, 0, 0, 0, 1, 0, -21.84, 0, 0, 1); }1.99% { -webkit-transform: matrix3d(-0.942, 0.412, 0, 0, -0.426, -0.911, 0, 0, 0, 0, 1, 0, 4.825, 0, 0, 1); transform: matrix3d(-0.942, 0.412, 0, 0, -0.426, -0.911, 0, 0, 0, 0, 1, 0, 4.825, 0, 0, 1); }2.02% { -webkit-transform: matrix3d(-0.941, 0.393, 0, 0, -0.402, -0.92, 0, 0, 0, 0, 1, 0, 5.53, 0, 0, 1); transform: matrix3d(-0.941, 0.393, 0, 0, -0.402, -0.92, 0, 0, 0, 0, 1, 0, 5.53, 0, 0, 1); }2.15% { -webkit-transform: matrix3d(-0.938, 0.294, 0, 0, -0.288, -0.956, 0, 0, 0, 0, 1, 0, 8.637, 0, 0, 1); transform: matrix3d(-0.938, 0.294, 0, 0, -0.288, -0.956, 0, 0, 0, 0, 1, 0, 8.637, 0, 0, 1); }2.51% { -webkit-transform: matrix3d(-0.945, 0.061, 0, 0, -0.058, -0.998, 0, 0, 0, 0, 1, 0, 12.662, 0, 0, 1); transform: matrix3d(-0.945, 0.061, 0, 0, -0.058, -0.998, 0, 0, 0, 0, 1, 0, 12.662, 0, 0, 1); }2.55% { -webkit-transform: matrix3d(-0.946, 0.038, 0, 0, -0.036, -0.999, 0, 0, 0, 0, 1, 0, 12.819, 0, 0, 1); transform: matrix3d(-0.946, 0.038, 0, 0, -0.036, -0.999, 0, 0, 0, 0, 1, 0, 12.819, 0, 0, 1); }2.69% { -webkit-transform: matrix3d(-0.95, -0.032, 0, 0, 0.031, -0.999, 0, 0, 0, 0, 1, 0, 13.007, 0, 0, 1); transform: matrix3d(-0.95, -0.032, 0, 0, 0.031, -0.999, 0, 0, 0, 0, 1, 0, 13.007, 0, 0, 1); }2.87% { -webkit-transform: matrix3d(-0.954, -0.116, 0, 0, 0.112, -0.993, 0, 0, 0, 0, 1, 0, 12.639, 0, 0, 1); transform: matrix3d(-0.954, -0.116, 0, 0, 0.112, -0.993, 0, 0, 0, 0, 1, 0, 12.639, 0, 0, 1); }3.85% { -webkit-transform: matrix3d(-0.926, -0.372, 0, 0, 0.371, -0.928, 0, 0, 0, 0, 1, 0, 6.116, 0, 0, 1); transform: matrix3d(-0.926, -0.372, 0, 0, 0.371, -0.928, 0, 0, 0, 0, 1, 0, 6.116, 0, 0, 1); }4.54% { -webkit-transform: matrix3d(-0.908, -0.421, 0, 0, 0.422, -0.907, 0, 0, 0, 0, 1, 0, 2.352, 0, 0, 1); transform: matrix3d(-0.908, -0.421, 0, 0, 0.422, -0.907, 0, 0, 0, 0, 1, 0, 2.352, 0, 0, 1); }4.6% { -webkit-transform: matrix3d(-0.907, -0.422, 0, 0, 0.423, -0.906, 0, 0, 0, 0, 1, 0, 2.121, 0, 0, 1); transform: matrix3d(-0.907, -0.422, 0, 0, 0.423, -0.906, 0, 0, 0, 0, 1, 0, 2.121, 0, 0, 1); }4.72% { -webkit-transform: matrix3d(-0.907, -0.423, 0, 0, 0.424, -0.906, 0, 0, 0, 0, 1, 0, 1.672, 0, 0, 1); transform: matrix3d(-0.907, -0.423, 0, 0, 0.424, -0.906, 0, 0, 0, 0, 1, 0, 1.672, 0, 0, 1); }5.11% { -webkit-transform: matrix3d(-0.91, -0.416, 0, 0, 0.416, -0.91, 0, 0, 0, 0, 1, 0, 0.651, 0, 0, 1); transform: matrix3d(-0.91, -0.416, 0, 0, 0.416, -0.91, 0, 0, 0, 0, 1, 0, 0.651, 0, 0, 1); }6.39% { -webkit-transform: matrix3d(-0.952, -0.305, 0, 0, 0.305, -0.952, 0, 0, 0, 0, 1, 0, -0.311, 0, 0, 1); transform: matrix3d(-0.952, -0.305, 0, 0, 0.305, -0.952, 0, 0, 0, 0, 1, 0, -0.311, 0, 0, 1); }6.57% { -webkit-transform: matrix3d(-0.959, -0.282, 0, 0, 0.282, -0.959, 0, 0, 0, 0, 1, 0, -0.302, 0, 0, 1); transform: matrix3d(-0.959, -0.282, 0, 0, 0.282, -0.959, 0, 0, 0, 0, 1, 0, -0.302, 0, 0, 1); }6.61% { -webkit-transform: matrix3d(-0.961, -0.277, 0, 0, 0.277, -0.961, 0, 0, 0, 0, 1, 0, -0.299, 0, 0, 1); transform: matrix3d(-0.961, -0.277, 0, 0, 0.277, -0.961, 0, 0, 0, 0, 1, 0, -0.299, 0, 0, 1); }6.68% { -webkit-transform: matrix3d(-0.963, -0.268, 0, 0, 0.268, -0.963, 0, 0, 0, 0, 1, 0, -0.291, 0, 0, 1); transform: matrix3d(-0.963, -0.268, 0, 0, 0.268, -0.963, 0, 0, 0, 0, 1, 0, -0.291, 0, 0, 1); }8.06% { -webkit-transform: matrix3d(-0.996, -0.084, 0, 0, 0.084, -0.996, 0, 0, 0, 0, 1, 0, -0.076, 0, 0, 1); transform: matrix3d(-0.996, -0.084, 0, 0, 0.084, -0.996, 0, 0, 0, 0, 1, 0, -0.076, 0, 0, 1); }8.33% { -webkit-transform: matrix3d(-0.999, -0.051, 0, 0, 0.051, -0.999, 0, 0, 0, 0, 1, 0, -0.048, 0, 0, 1); transform: matrix3d(-0.999, -0.051, 0, 0, 0.051, -0.999, 0, 0, 0, 0, 1, 0, -0.048, 0, 0, 1); }9.51% { -webkit-transform: matrix3d(-0.998, 0.055, 0, 0, -0.055, -0.998, 0, 0, 0, 0, 1, 0, 0.004, 0, 0, 1); transform: matrix3d(-0.998, 0.055, 0, 0, -0.055, -0.998, 0, 0, 0, 0, 1, 0, 0.004, 0, 0, 1); }10.09% { -webkit-transform: matrix3d(-0.997, 0.084, 0, 0, -0.084, -0.997, 0, 0, 0, 0, 1, 0, 0.007, 0, 0, 1); transform: matrix3d(-0.997, 0.084, 0, 0, -0.084, -0.997, 0, 0, 0, 0, 1, 0, 0.007, 0, 0, 1); }10.28% { -webkit-transform: matrix3d(-0.996, 0.089, 0, 0, -0.089, -0.996, 0, 0, 0, 0, 1, 0, 0.007, 0, 0, 1); transform: matrix3d(-0.996, 0.089, 0, 0, -0.089, -0.996, 0, 0, 0, 0, 1, 0, 0.007, 0, 0, 1); }10.96% { -webkit-transform: matrix3d(-0.995, 0.098, 0, 0, -0.098, -0.995, 0, 0, 0, 0, 1, 0, 0.005, 0, 0, 1); transform: matrix3d(-0.995, 0.098, 0, 0, -0.098, -0.995, 0, 0, 0, 0, 1, 0, 0.005, 0, 0, 1); }13.8% { -webkit-transform: matrix3d(-1, 0.025, 0, 0, -0.025, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0.025, 0, 0, -0.025, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }14% { -webkit-transform: matrix3d(-1, 0.019, 0, 0, -0.019, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0.019, 0, 0, -0.019, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }16.57% { -webkit-transform: matrix3d(-1, -0.023, 0, 0, 0.023, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, -0.023, 0, 0, 0.023, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }16.67% { -webkit-transform: matrix3d(-1, -0.023, 0, 0, 0.023, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, -0.023, 0, 0, 0.023, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }16.87% { -webkit-transform: matrix3d(-1, -0.024, 0, 0, 0.013, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, -0.024, 0, 0, 0.013, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }20.92% { -webkit-transform: matrix3d(-1, 0.002, 0, 0, -0.323, -0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0.002, 0, 0, -0.323, -0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }22.77% { -webkit-transform: matrix3d(-1, 0.006, 0, 0, -0.432, -0.998, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0.006, 0, 0, -0.432, -0.998, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }23.09% { -webkit-transform: matrix3d(-1, 0.006, 0, 0, -0.444, -0.998, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0.006, 0, 0, -0.444, -0.998, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }25.18% { -webkit-transform: matrix3d(-1, 0.002, 0, 0, -0.474, -0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0.002, 0, 0, -0.474, -0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }27.68% { -webkit-transform: matrix3d(-1, -0.001, 0, 0, -0.438, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, -0.001, 0, 0, -0.438, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }28.63% { -webkit-transform: matrix3d(-1, -0.001, 0, 0, -0.417, -1.001, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, -0.001, 0, 0, -0.417, -1.001, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }30.1% { -webkit-transform: matrix3d(-1, -0.001, 0, 0, -0.385, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, -0.001, 0, 0, -0.385, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }32.52% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.35, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.35, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }34.53% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.34, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.34, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }34.93% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.34, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.34, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }40.44% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.361, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.361, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }44.78% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.37, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.37, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }46.3% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.369, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.369, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }50% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.365, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.365, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }54.62% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.363, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.363, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }64.38% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }74.22% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }84.07% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }93.83% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }100% { -webkit-transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(-1, 0, 0, 0, -0.364, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }";
                // var animationName = 'bounce-js-complex';
                // $scope.animation = importAndProcessAnimationCSSTextByKF(bounceJS, animationName, updateDropdown);

            // console.log($scope.animation.properties);
            // var tempKeyFrame = $scope.animation.obj.cssRules.item(2);
            // console.log('setting to ', tempKeyFrame.keyText)
            // $scope.setActiveKeyFrame(tempKeyFrame.keyText);
            // console.log($scope.animation.selected_keyframe);
            // $scope.animation = matrix3DKeyframesToDecomposedKF(bounceJS, 'bounce-js', updateDropdown);
            // importAndProcessAnimationCSSTextByKF(bounceJS, 'bounce-js');



            //turn off for now
            false && loadAllS3Files();
            importAnimations();
            importStageHtml();
            initShortCuts();
            hardCodeStageDimensions();

            $scope.defaults = getDefaults();
            applyDefaultProperties($scope.defaults);
            $scope.actor = document.querySelector('#stage-elem');



            // $scope.resetStageDom();
            // $scope.addSVGPlaceholder('circle');
            // $scope.addSVGPlaceholder('square');
            // $scope.addSVGPlaceholder('octagon');
            // $scope.addSVGPlaceholder('hexagon');
            // $scope.addSVGPlaceholder('rect');
            // $scope.addSVGPlaceholder('parallelogram');
            // editKeyframeAtX($scope.animation, 0, 'translateX', 10)


        }



        $scope.setActiveKeyFrameFromPointer = function($event) {
            var kfBarContainerElem = document.querySelector('#keyframe-bar')
            var barLeftPx = kfBarContainerElem.getBoundingClientRect().left;
            var totalBarWidth = kfBarContainerElem.getBoundingClientRect().width;
            var percentFromBeginning = Math.abs($event.offsetX)/(totalBarWidth*1.0) * 100
            var propertyKeys = Object.keys($scope.animation.properties);
            var min = 101;
            var closedIndex = -1;
            for (var i = 0; i < propertyKeys.length; i++) {
                var indexKey = parseFloat(propertyKeys[i].replace('%'));
                var dx = Math.abs(indexKey - percentFromBeginning);
                if (dx < min) {
                    min = dx;
                    closedIndex = i;
                }
            }
            $scope.setActiveKeyFrame(propertyKeys[closedIndex]);

            // console.log(kfBarContainerElemWidth, kfBarContainerElemLeft);
            // console.log($event);
        }


        $scope.stageElemDefaults = {
            draggable:true
        }

        $scope.toggleStageElemDraggable = function() {
            var elem = document.querySelector('#stage-container [draggable]');
            if (elem && elem.id && elem.hasAttribute('draggable')) {
                console.log($scope.actor, 'has attribute');
                    elem.removeAttribute('draggable');
                    elem.setAttribute('no-draggable', '');
                    $compile(elem)($scope);
                    $timeout(function() {
                        $scope.$apply();
                    })
            }
            else {
                var elem = document.querySelector('#stage-container [no-draggable]');
                elem.removeAttribute('no-draggable');
                elem.setAttribute('draggable', '');
                $compile(elem)($scope);
                    $timeout(function() {
                        $scope.$apply();
                    })
            }
            $scope.stageElemDefaults.draggable = !$scope.stageElemDefaults.draggable;
        }

        function cleanupAnimation(animation, is_orig_css) {
            if (is_orig_css) {
                var tempAnim = initAnimationFromCSSText(animation.obj.name, browserPrefix, animation.obj.origCSSText);
            } else {
                var tempAnim = initAnimationFromCSSText(animation.obj.name, browserPrefix, animation.obj.cssText);
            }
            var cssRulesLength = animation.obj.cssRules.length;
            var animDictToSort = {};
            for (var i = 0; i < cssRulesLength; i++) {
                var indexKFRule = animation.obj.cssRules.item(i);
                var indexKeyText = indexKFRule.keyText;
                var indexKeyStyle = indexKFRule.cssText;
                if (!(indexKeyStyle.indexOf('{ }') > -1)) {
                    animDictToSort[indexKeyText] = indexKeyStyle;
                    tempAnim.deleteRule(indexKeyStyle, i);
                }
            }

            var animDictKeysSorted = Object.keys(animDictToSort).sort(function(val_a, val_b) {return parseFloat(val_b.replace('%', '')) - parseFloat(val_a.replace('%', ''))}).reverse();
            for (var i = 0; i < animDictKeysSorted.length; i++) {
                var indexKey = animDictKeysSorted[i];
                var cssValueText = animDictToSort[indexKey];
                tempAnim.appendRule(cssValueText, i);
            }
            return tempAnim;
        }

        $scope.renderAnimationCSSText = function(animation, skip_tab_switch) {
            if (!skip_tab_switch) {
                $scope.layout.index = 2;
            }

            // var tempOGAnim = cleanupAnimation(animation, true);
            var tempAnim = cleanupAnimation(animation);
            // $scope.animation.obj.origCSSText = tempOGAnim.cssText;


            var animClassText = generateClassText(animation);
            animation.exportable_kf = {obj: tempAnim, className: tempAnim.name, classText: animClassText, fullText: animClassText + tempAnim.cssText, cssText: tempAnim.cssText};

            $timeout(function() {
                // angular.element(document.querySelector('#export-textarea')).select()
                document.querySelector('#export-textarea').select();
                // window.prompt("Copy to clipboard: Ctrl+C, Enter", $scope.animation.exportable_kf.fullText);
                document.execCommand('copy')
            }, 1000)
            function generateClassText(anim) {
                 return "." + anim.obj.name + "\n{\n   " + ' animation:  ' + anim.obj.name + ' ' + anim.attr.duration  + ' ' + anim.attr.timing_function + ' ' + anim.attr.delay + ' ' + anim.attr.iteration_count + ' ' + anim.attr.direction + ';\n    ' + '-' + browserPrefix + '-' + 'animation:  ' + anim.obj.name + ' ' + anim.attr.duration  + ' ' + anim.attr.timing_function + ' ' + anim.attr.delay + ' ' + anim.attr.iteration_count + ' ' + anim.attr.direction + ';\n}\n\n'
            }
        }

        $scope.editAnimationName = false;
        $scope.exports = {animations: []};

        $scope.addNewAnimation = function(animation) {
            if (!$scope.animation || !$scope.animation.obj || !$scope.animation.obj.name) {
                initNewAnimation();
            }
            $scope.showStatusMsgForXSec('Save ' + animation.obj.name + '?', 5000 , 'confirm', callback);
            function callback(bool) {
                if (bool) {
                    $scope.saveAnimationClass($scope.animation);
                    $scope.showStatusMsgForXSec('Saving ' + $scope.animation.obj.name + '...', 2000);
                    $timeout(function() {
                        initNewAnimation();
                    }, 2000);
                } else {
                    $scope.showStatusMsgForXSec('Canceling...', 2000);
                }

            }

            function initNewAnimation() {
                $scope.animation = initAnimation('nameless-anim', browserPrefix, defaults.KF_COUNT, defaults.DURATION, true);
                $timeout(function() {
                    $scope.animation.edit = true;
                }, 500)
                $timeout(function() {
                    var elem = document.querySelector('#anim-name-input');
                    elem && elem.select();
                    $scope.animationDropdown.options[0] = $scope.animation.obj.name;
                    $scope.animationDropdown.options.push('Save');
                }, 1000);

                return;
            }

        }

        $scope.saveAnimationClass = function(animation, owner) {
            console.log('rendering', animation);
            if (!animation.exportable_kf) {
                $scope.renderAnimationCSSText(animation, true);
            }
            if (animation.exportable_kf.className.length && animation.exportable_kf.classText.length) {
                var payloadDict = {
                    name: animation.exportable_kf.className,
                    owner: owner || $scope.user.name.split(' ')[0].toLowerCase(),
                    lastUpdated: (new Date()).getTime(),
                    classText: animation.exportable_kf.classText,
                    cssText: animation.exportable_kf.cssText
                }

                var animationIndex = checkIfAnimationAlreadyExists(payloadDict, $scope.imports.animations)

                if (animationIndex < 0) {
                    $scope.showStatusMsgForXSec('Adding ' + payloadDict.name + ' animation to server', 2500);
                    $scope.imports.animations.push(payloadDict);
                } else {
                    $scope.showStatusMsgForXSec('Updating ' + payloadDict.name + ' animation to server', 2500);
                    var removedElem = $scope.imports.animations.splice(animationIndex, 1);
                    console.log('removed', removedElem && removedElem.name);
                    $scope.imports.animations.push(payloadDict);
                    console.log('re added', payloadDict.name);
                }
                $localstorage.setObject('imports', $scope.imports);

                $timeout(function() {
                    var animation_url = 'https://s3.amazonaws.com/uguru-admin/master/';
                    saveToMasterS3('animations.json', animation_url, $scope.imports.animations);
                })

                $localstorage.setObject('last_animation', $scope.animation);
                return payloadDict;
            }

            function checkIfAnimationAlreadyExists(obj, arr_obj) {
                for (var i = 0; i < arr_obj.length; i++) {
                    var indexAnimObj = arr_obj[i];
                    if (indexAnimObj.name === obj.name) {
                        return i;
                    }
                }
                return -1;
            }
        }
        $scope.saveStageHtml = function(ignore_loader, is_clear) {

            if ($scope.stage && $scope.stage.stageName) {
                $scope.stage.stageHtml = document.querySelector('#stage-container').innerHTML;
                var stageIndex = checkIfStageAlreadyExists($scope.stage, $scope.imports.stages)

                if (stageIndex < 0) {
                    $scope.showStatusMsgForXSec('adding ' + $scope.stage.stageName + ' animation to server', 2500);
                    $scope.imports.stages.push($scope.stage);
                } else {
                    $scope.showStatusMsgForXSec('Updating ' + $scope.stage.stageName + ' animation to server', 2500);
                    var removedElem = $scope.imports.stages.splice(stageIndex, 1);

                    console.log('removed', removedElem && removedElem.stageName);
                    $scope.imports.stages.push($scope.stage);
                    console.log('re added', $scope.stage.stageName);
                }
            }

            $localstorage.setObject('imports', $scope.imports);

            $timeout(function() {
                var animation_url = 'https://s3.amazonaws.com/uguru-admin/master/';
                saveToMasterS3('stages.json', animation_url, $scope.imports.stages);
            })
            if (!is_clear && $scope.stage && $scope.stageDropdown.options.length > 2) {
                $localstorage.setObject('last_stage', $scope.stage);
            }
            return $scope.stage;

            function checkIfStageAlreadyExists(obj, arr_obj) {
                for (var i = 0; i < arr_obj.length; i++) {
                    var indexStageObj = arr_obj[i];
                    if (indexStageObj.stageName === obj.stageName) {
                        return i;
                    }
                }
                return -1;
            }
            $scope.layout.index = 0;
        }

        function chooseXRandomAnimations(x, animations_arr) {
            var randAnimations = [];
            for (var i = 0; i < x; i++) {
                var indexRandomInteger = Math.floor(Math.random() * (animations_arr.length - 1) + 1);
                var indexAnimation = animations_arr[indexRandomInteger];
                var processedIndexAnimation = $scope.importFromCSSText(indexAnimation.cssText, indexAnimation.name, indexAnimation.classText, {skip_local:true});
                processedIndexAnimation.attr.name.replace('-edit', '');
                processedIndexAnimation.obj.name.replace('-edit', '');
                randAnimations.push(processedIndexAnimation);
            }
            return randAnimations;
        }

        function processAnimations(animation_arr) {

            for (var i = 0; i < animation_arr.length; i++) {
                var indexAnimation = animation_arr[i];
                if (indexAnimation.owner === 'asif') {
                    indexAnimation.owner = 'samir';
                }
            }
            // $scope.animations = chooseXRandomAnimations(5, animation_arr);

            // $timeout(function() {
            //  console.log('random 5 animations', $scope.animations);
            // }, 1000);
            for (var i = 0; i < animation_arr.length; i++) {
                if (animation_arr[i].name === 'magic') {
                    // importAnimation(animation_arr[i], i * 50);
                }
            }

            function importAnimation(animation, delay) {
                $timeout(function() {
                    var lastAnimation = animation;

                    $scope.importFromCSSText(lastAnimation.cssText, lastAnimation.name, lastAnimation.classText, {skip_local:true});

                    $timeout(function() {
                        console.log('recently imported nim', $scope.animation);
                        $scope.renderAnimationCSSText($scope.animation);
                    }, 1500)

                }, delay || 0)
            }

            return animation_arr
        }
        var tempStage = {};
        $scope.importCodepenTemplate = function(url, name) {
            tempState = {};
            if (!url || !name) {
                LoadingService.showMsg('Please add a name to the template so we can save it!', 2000);
                return;
            }


            $timeout(function() {
                FileService.getCodepenAssets('html', url + '.html', htmlCallback);
            })
            $timeout(function() {
                FileService.getCodepenAssets('css', url + '.css', cssCallback);
            })

            $timeout(function() {
                LoadingService.hide();
                tempStage.name = name;
                $scope.stage = initNewStage(tempStage.name, tempStage.html, tempStage.css);

                $scope.pageDom.stageName = $scope.stage.stageName;
                $scope.pageDom.stageCss = $scope.stage.stageCss;
                $scope.pageDom.stageHtml = $scope.stage.stageHtml;
                $scope.updatePageDom($scope.stage.stageName, $scope.stage.stageHtml, $scope.stage.stageCss);

                $scope.saveStageHtml();

            }, 3000);
            function cssCallback(resp) {
                tempStage.css = resp;
            }
            function htmlCallback(resp) {
                tempStage.html = resp;
            }
        }

        function saveToMasterS3(filename, url, obj, cb) {
            console.log('about to save to master with url', url + filename, obj);
            FileService.postS3JsonFile(JSON.stringify(obj), null, url + filename, function(name, resp) { cb && cb()});
        }

        function importAnimations() {
            $scope.imports = $localstorage.getObject('imports');
            var animation_url = 'https://s3.amazonaws.com/uguru-admin/master/animations.json';
            FileService.getS3JsonFile(null, animation_url, function(name, resp) {$scope.imports.animations = processAnimations(resp); });
        }

        function defaultStates() {
            var preAppStates = {

                'templates/splash.html':'SplashController',
                'templates/elements/layouts/powerups.html': 'PowerupController',
                'templates/maps.html': 'GMapController',
                'templates/splash/swiper/splash.hiw.container.html': 'HowItWorksController',
                'templates/splash/swiper/splash.account.container.html': 'SignupController',
                'templates/splash/swiper/splash.demographics.container.html': 'DemographicController',
                'templates/splash/swiper/splash.courses.container.html': 'CoursesController',
                'templates/splash/swiper/splash.access.container.html': 'AccessController',
                'templates/splash/layout/university.search.html': 'UniversitySearchController',
                'templates/splash/layout/splash.sidebar.html': 'SidebarController',
            }
            allTemplates = Object.keys(preAppStates);
            for (var i = 0; i < allTemplates.length; i++) {
                var html = '<div ng-include="root.base_url + ' + "'" + allTemplates[i] + "'" + '" ng-controller="' + preAppStates[allTemplates[i]] + '"> </div>'
                preAppStates[allTemplates[i]] = {controller: preAppStates[allTemplates[i]], owner: 'samir', url: allTemplates[i] + "", html:html};
            }
            preAppStates[allTemplates[0]].name = 'Splash';
            preAppStates[allTemplates[1]].name = 'Splash Powerups';
            preAppStates[allTemplates[2]].name = 'Splash Maps';
            preAppStates[allTemplates[3]].name = 'Splash Hiw';
            preAppStates[allTemplates[4]].name = 'Splash Account';
            preAppStates[allTemplates[5]].name = 'Splash Demographics';
            preAppStates[allTemplates[6]].name = 'Splash Courses';
            preAppStates[allTemplates[7]].name = 'Splash Access';
            preAppStates[allTemplates[8]].name = 'Splash Search University';
            preAppStates[allTemplates[9]].name = 'Splash Sidebar';
            for (var i = 0; i < allTemplates.length; i++) {
                var template = preAppStates[allTemplates[i]];
                $scope.imports.stages.push(initNewStage(template.name, template.html, ''));
            }
            // $scope.saveStageHtml();
        }

        function processStages(stages) {
            for (var i = 0; i < stages.length; i++) {
                var indexStage = stages[i];
                indexStage.owner = 'samir';
            }
            return stages;
        }

        function importStageHtml() {

            $scope.imports = $localstorage.getObject('imports');
            if (!$scope.imports.stages) {
                $scope.imports.stages = [];
                $localstorage.setObject('imports', $scope.imports);
            }
            var animation_url = 'https://s3.amazonaws.com/uguru-admin/master/stages.json';
            FileService.getS3JsonFile(null, animation_url, function(name, resp) { $scope.imports.stages = resp; processStages($scope.imports.stages);});
        }


        var browserPrefix;
        $timeout(function() {
            injectStyleSheet();
        })

        // $localstorage.removeObject('last_animation');
        //start core functions
        //core #1
        function importAnimationFromRawCssText(css_text, name) {
            var style = document.createElement("style");
            style.setAttribute('id', name);
            style.innerHTML = css_text;
            var newAnim;
            document.getElementsByTagName("head")[0].appendChild(style);
            for (var i = 0; i < document.styleSheets.length; i++) {
                var indexStyleSheet = document.styleSheets[i];
                if (indexStyleSheet.ownerNode && indexStyleSheet.ownerNode.id === name) {

                    var animToClone = indexStyleSheet.cssRules[0];
                    var lastSheet = document.styleSheets[document.styleSheets.length - 1];
                    var indexOfRuleInSheet = lastSheet.insertRule("@-" + browserPrefix + "-keyframes " + animToClone.name + " { } ");
                    var newAnim = lastSheet.cssRules[indexOfRuleInSheet];
                    var cssRulesToClone = animToClone.cssRules;
                    for (var j = 0;j < cssRulesToClone.length; j++) {
                        var indexKeyFrame = cssRulesToClone.item(j);
                        newAnim.appendRule(indexKeyFrame.cssText, j);
                    }
                }
            }
            if (name) {
                newAnim.name = name;
            }
            return newAnim;
        }

        //core 2
        function importAndProcessAnimationCSSTextByKF(css_text, name, cb, is_active) {
            var jsAnimCssObj = importAnimationFromRawCssText(css_text, name);
            var uguruAnimObj = initAnimationFromAnimObj(jsAnimCssObj, {name: jsAnimCssObj.name, active:is_active || false});

            var all_properties = Object.keys(uguruAnimObj);
            var transformPropertyVariants = ['transform', 'WebkitTransform', 'MozTransform',  'msTransform' , 'OTransform'];
            var mod_arr = [];
            var multiKFStyle = {};
            // console.log('\n\n\n\n\nKeyframes before\n-----\n\n', css_text);
            for (var i = 0; i < all_properties.length; i++) {
                var propertyKey = all_properties[i];
                // console.log(css_text);
                for (var j = 0; j < uguruAnimObj.obj.cssRules.length; j++) {
                    var indexRule = uguruAnimObj.obj.cssRules.item(j);
                    var keyText = indexRule.keyText;
                    var cssText = indexRule.cssText;
                    var processedCSSText = "";
                    multiKFStyle[keyText] = indexRule.style;
                    //case: keytext
                    console.log(multiKFStyle);
                    for (var i = 0; i < indexRule.style.length; i++)  {
                        var indexStyleProperty = indexRule.style.item(i);
                        var dMatrix;
                        if (transformPropertyVariants.indexOf(indexStyleProperty) > -1) {

                            var transformString = indexRule.style[indexStyleProperty];

                            var matrixTransform = transformString;
                                if (matrixTransform === 'matrix3d(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)') {
                                    continue;
                                }
                                matrixTransform = replaceAll(matrixTransform, '%', 'px');

                            // if (indexStyleProperty.indexOf('matrix') > -1) {
                                var m = new WebKitCSSMatrix(replaceAll(matrixTransform, '%', 'px'));
                                matrixTransform = "matrix3d(" + [m.m11, m.m12, m.m13, m.m14, m.m21, m.m22, m.m23, m.m24, m.m31, m.m32, m.m33, m.m34, m.m41, m.m42, m.m43, m.m44].join(", ") + ")";
                                dMatrix = dynamics.initMatrixFromTransform(matrixTransform);
                                var perspective = null;
                                if (m.m34 && m.m34 !== 1) {
                                    perspective = Math.abs(parseFloat(1/m.m34, 5) * -1) + 'px';
                                }
                                console.log('toparse:' + matrixTransform, m.m34, perspective, dMatrix);
                                var decomposedCSSText = getDMatrixString(dMatrix, transformString, perspective);

                            // } else {
                            //  var decomposedCSSText = matrixTransform;
                            // }


                            if (decomposedCSSText) {
                                processedCSSText += decomposedCSSText;
                            }
                            console.log(indexStyleProperty, indexRule.style[indexStyleProperty], decomposedCSSText);
                        } else {
                            processedCSSText += (indexStyleProperty + ":" + indexRule.style[indexStyleProperty] + ";");
                        }
                    }

                    console.log('pushing', keyText, processedCSSText, dMatrix);
                    mod_arr.push({key: keyText, css: processedCSSText, d_matrix: dMatrix});
                    uguruAnimObj.obj.deleteRule(keyText);
                }
            }
            mod_arr.sort(function(val_a, val_b) {
                if (val_a.key.split('%,').length > 1) {
                    return 1000
                }
                val_a_int = parseInt(val_a.key.replace('%', ''))
                val_b_int = parseInt(val_b.key.replace('%', ''))
                return val_b_int - val_a_int;
            }).reverse();
            console.log('precleanup', uguruAnimObj);
            for (var i = 0; i < mod_arr.length; i++) {
                console.log('appending...', mod_arr[i].key, mod_arr[i].css);
                uguruAnimObj.obj.appendRule(mod_arr[i].key + " {" + mod_arr[i].css + " }", i);
            }
            console.log(uguruAnimObj.obj.cssText);
            var styleKeys = Object.keys(multiKFStyle);

            //replace all previous style keys with updated transform value

            // for (var i = 0; i < styleKeys.length; i++) {
            //  var styleKeyPercent = styleKeys[i];
            //  var styleKeyValue = multiKFStyle[styleKeyPercent];

            // }

            var originalMultiKFTextsToRemove = [];
            for (var i = 0; i < styleKeys.length; i++) {
                var indexKFStyle = styleKeys[i];
                var indexKFValue = multiKFStyle[indexKFStyle];
                var numPercentages = indexKFStyle.split('%,');
                console.log(numPercentages, indexKFStyle);
                if (numPercentages.length> 1) {
                    var parsedPercentages = indexKFStyle.split(',');
                    for (var j = 0; j < parsedPercentages.length; j++) {
                        var indexPercent = parsedPercentages[j].trim();
                        console.log(indexPercent);
                        var intOfIndexPercent = parseInt(indexPercent.replace('%', ''));
                        var kfIndex = findKFByPercentage(uguruAnimObj.obj.cssRules, intOfIndexPercent);
                        var kf = uguruAnimObj.obj.cssRules.item(kfIndex);
                        console.log('cssRules #', kfIndex, kf, intOfIndexPercent);
                        if (kf) {
                            var resultAddOnCSS = "";
                            for (var k = 0; k < kf.style.length; k++) {
                                var indexStyle = kf.style[k];
                                var indexValue = kf.style[indexStyle];
                                resultAddOnCSS += indexStyle + ":" +  indexValue + '; ';
                                if (indexStyle.indexOf('animation') > -1) {
                                    console.log(browserPrefix)
                                    resultAddOnCSS += ('-' +browserPrefix + '-' + indexStyle + ":" +  indexValue + '; ');
                                }
                            }

                            for (var k = 0; k < indexKFValue.length; k++) {
                                var indexStyle = indexKFValue[k];
                                var indexValue = indexKFValue[indexStyle];
                                if (indexStyle.indexOf('transform') > -1) {
                                    for (var l = 0; l < uguruAnimObj.obj.cssRules.length; l++) {
                                        var indexRule = uguruAnimObj.obj.cssRules.item(l);
                                        if (indexRule.keyText.indexOf(indexPercent) > -1) {
                                            if (indexRule.style['transform'] !== indexValue)  {
                                                indexValue = indexRule.style['transform'];
                                            }
                                        }
                                    }
                                }
                                resultAddOnCSS += indexStyle + ":" +  indexValue + '; ';
                                if (indexStyle.indexOf('animation') > -1) {
                                    resultAddOnCSS += ('-' +browserPrefix + '-' + indexStyle + ":" +  indexValue + '; ');
                                }
                            }
                            uguruAnimObj.obj.deleteRule(indexPercent);
                            uguruAnimObj.obj.appendRule(indexPercent + " { " + resultAddOnCSS  + " }"  ,kfIndex);
                            var originalKF = uguruAnimObj.obj.cssRules.item(i);
                            var originalKFKeyText = originalKF.keyText;
                            if (originalKFKeyText.split(',').length >= 2) {
                                originalMultiKFTextsToRemove.push(originalKFKeyText);
                            }
                        } else {
                            console.log('error!');
                        }
                    }
                }

            }
            console.log('multi-kfs to remove', originalMultiKFTextsToRemove, uguruAnimObj.obj.cssText)


            for (var i = 0; i < originalMultiKFTextsToRemove.length; i++) {
                var kfTextToRemove = originalMultiKFTextsToRemove[i];
                uguruAnimObj.obj.deleteRule(kfTextToRemove);
                delete uguruAnimObj.properties[kfTextToRemove];
            }
            console.log('should be removed', originalMultiKFTextsToRemove);

            function findKFByPercentage(css_rules, percent_val) {
                var percentValStr = percent_val + '%';
                for (var i = 0; i < css_rules.length; i++) {
                    var indexCSSRule = css_rules.item(i);
                    if (indexCSSRule && indexCSSRule.keyText === percentValStr) {
                        return i;
                    }
                }
            }

            uguruAnimObj.obj = cleanupAnimation(uguruAnimObj);

            refreshTransformPropertyObjFromAnim(uguruAnimObj);
            // console.log('\n\n\n\n\nKeyframes after\n-----\n\n', uguruAnimObj.obj.cssText);
            cb && cb(uguruAnimObj);
            var percentageKeys = Object.keys(uguruAnimObj.properties);
            percentageKeys.sort(function(val_a, val_b) {

                val_a_int = parseInt(val_a.replace('%', ''))
                val_b_int = parseInt(val_b.replace('%', ''))
                return val_b_int - val_a_int;

            }).reverse();
            console.log('percentage keys', percentageKeys);
            uguruAnimObj.selected_percent = percentageKeys[0];
            uguruAnimObj.selected_keyframe = uguruAnimObj.properties[uguruAnimObj.selected_percent]
            uguruAnimObj.selected_kf_index = 0;
            uguruAnimObj.flex_selected_index = 0;
            uguruAnimObj.selected_index = 0;
            uguruAnimObj.kf_count = percentageKeys.length;

            // , selected_percent:'0%', selected_index: 0, flex_selected_index:0, properties: properties, kf_count: num_keyframes, attr:attr}
            console.log(uguruAnimObj);
            return uguruAnimObj;

        }
        $localstorage.removeObject('last_animation');

        function refreshTransformPropertyObjFromAnim(anim) {
            console.log(anim.properties)
            anim.properties = {}
            for (var i = 0; i < anim.obj.cssRules.length; i++) {
                var indexKFRule = anim.obj.cssRules.item(i);
                var keyText = indexKFRule.keyText;
                var transformKFObj = initTransformObjFromKF(indexKFRule);
                console.log(transformKFObj, indexKFRule);
                anim.properties[keyText] = transformKFObj;
            }
        }

        function replaceAll(str, find, replace) {
          return str.replace(new RegExp(escapeRegExp(find), 'g'), replace);

          function escapeRegExp(str) {
                return str.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1");
          }

        }

        function processAllTransformValues(transform_str) {
            transform_str = replaceAll(transform_str, ', ', ',').split(' ');
            return transform_str;
        }

        function initTransformObjFromKF(kf) {
            var transformObj = new transformPropertiesObj();
            for (var i = 0; i < kf.style.length; i++) {
                var indexStyle = kf.style[i];
                var indexValue = kf.style[indexStyle];
                if (indexStyle.indexOf('transform') > -1 && indexStyle.indexOf('transform-origin') === -1) {

                    var separateTransformValues = processAllTransformValues(indexValue);

                    for (var j = 0; j < separateTransformValues.length; j++) {
                        var indexTransformPropSplit = separateTransformValues[j].replace(')', '').split('(');
                        var transformPropertyName = indexTransformPropSplit[0];
                        var transformPropertyValue = indexTransformPropSplit[1];
                        if (!(transformPropertyName in transformObj)) {
                            var mappedIndexStyle = transformObj.propertyMappings[transformPropertyName];
                            console.log(mappedIndexStyle, transformPropertyValue);
                            transformObj[mappedIndexStyle] = transformPropertyValue.replace('%', '').replace('rad', '');
                            console.log('checking for', transformPropertyName, mappedIndexStyle);
                            if (['skewX', 'skewY', 'rotateX', 'rotateY', 'rotateZ'].indexOf(mappedIndexStyle) > -1) {
                                transformObj[mappedIndexStyle + 'deg'] = $scope.rad2degree(parseFloat(transformPropertyValue.replace('%', '').replace('rad', '')));
                            }
                            transformObj['modified'][mappedIndexStyle] = transformPropertyValue.replace('%', '').replace('rad', '');
                            if (!mappedIndexStyle) {
                                console.log('could not find', transformPropertyName, 'in transform obj');
                            }
                        } else {
                            console.log('checking for', transformPropertyName);
                            if (['skewX', 'skewY', 'rotateX', 'rotateY', 'rotateZ'].indexOf(transformPropertyName) > -1) {
                                transformObj[transformPropertyName + 'deg'] = parseInt($scope.rad2degree(parseFloat(transformPropertyValue.replace('%', '').replace('rad', ''))));
                            }
                            transformObj[transformPropertyName] = transformPropertyValue.replace('%', '').replace('rad', '');
                            transformObj['modified'][transformPropertyName] = transformPropertyValue.replace('%', '').replace('rad', '');
                        }
                    }
                } else {
                    if (!(indexStyle in transformObj)) {
                        var mappedIndexStyle = transformObj.propertyMappings[indexStyle];
                        transformObj[mappedIndexStyle] = indexValue;
                        transformObj['modified'][mappedIndexStyle] = indexValue;
                        if (!mappedIndexStyle) {
                            console.log('could not find', indexStyle, 'in transform obj');
                        }
                    } else {
                        transformObj[transformPropertyName] = transformPropertyValue;
                        transformObj['modified'][transformPropertyName] = transformPropertyValue;
                    }
                }
            }
            // console.log(transformObj);
            return transformObj;
        }

        function matrix3DKeyframesToDecomposedKF(css_text, name, cb) {
            var jsAnimCssObj = importAnimationFromRawCssText(css_text, name);
            var uguruAnimObj = initAnimationFromAnimObj(jsAnimCssObj, {name: jsAnimCssObj.name});
            // var decomposedUguruAnimObj =
            var decomposedUguruAnimObj = decomposeMatrix3DKeyFrameArr(uguruAnimObj);
            cb && cb(decomposedUguruAnimObj);
            return uguruAnimObj;


            function decomposeMatrix3DKeyFrameArr(uguru_anim_obj) {
                var all_properties = Object.keys(uguru_anim_obj);
                var mod_arr = [];
                for (var i = 0; i < all_properties.length; i++) {
                    var propertyKey = all_properties[i];
                    for (var j = 0; j < uguru_anim_obj.obj.cssRules.length; j++) {
                        var indexRule = uguru_anim_obj.obj.cssRules.item(j);
                        var keyText = indexRule.keyText;
                        if (indexRule.keyText === propertyKey) {
                            var matrixTransform = indexRule.style.transform || indexRule.style.WebkitTransform || indexRule.style.MozTransform || indexRule.style.msTransform || indexRule.style.OTransform;
                            if (matrixTransform) {
                                dMatrix = dynamics.initMatrixFromTransform(matrixTransform);
                                var decomposedCSSText = getDMatrixString(dMatrix);
                                uguru_anim_obj.obj.deleteRule(keyText);
                                mod_arr.push({key: keyText, css: decomposedCSSText});
                            }
                        }
                    }
                }
                for (var i = 0; i < mod_arr.length; i++) {
                    uguru_anim_obj.obj.appendRule(mod_arr[i].key + " {" + mod_arr[i].css + " }", 0);
                }
                return uguru_anim_obj;
            }

        }


        $scope.asideTabIndex = 2;
        $scope.importLayoutIndex = 3;
        $scope.showChildrenOfParentElemOnClick = function() {
            $scope.stage.selectComponentMode = true;
            var allShapes = ['path', 'line', 'polygon', 'polyline', 'g', 'rect', 'ellipse', 'circle', 'tspan', 'text'];
            allChildActorElems = $scope.actor.querySelectorAll('*');
            $scope.stage.components = [];
            for (var i = 0; i < allChildActorElems.length; i++) {
                $scope.stage.components.push({selector: '[draggable-clone-' + i + ']'});
            }
            $timeout(function() {
                var allContainers = document.querySelectorAll('.cloned-animatable-elem-container')
                for (var i = 0; i < allChildActorElems.length; i++) {
                    var indexElem = allChildActorElems[i];
                    var clonedNode = indexElem.cloneNode(true);
                    // clonedNode.setAttribute('draggable-clone', null);
                    // clonedNode.setAttribute('draggable-clone-' + i, null);
                    var indexContainer = allContainers[i];
                    $scope.stage.components[i].type = indexElem.nodeName;
                    $scope.stage.components[i].orig_elem = indexElem;
                    $scope.stage.components[i]._class = indexElem.getAttribute('class');
                    if (allShapes.indexOf(clonedNode.nodeName) > - 1) {
                        var parentSVG = findParentSVG(indexElem);
                        var clonedParentSVG = parentSVG.cloneNode(true);
                        clonedParentSVG.innerHTML = "";
                        clonedParentSVG.style.minWidth = '100px';
                        clonedParentSVG.style.minHeight = '100px';
                        clonedParentSVG.className += " absolute flex-wrap-center full-xy"
                        clonedParentSVG.appendChild(clonedNode);
                        indexContainer.appendChild(clonedParentSVG);
                        secondClonedParent = clonedParentSVG.cloneNode(true);
                        indexContainer.appendChild(secondClonedParent);
                    } else {
                        clonedNode.style.minWidth = '100px';
                        clonedNode.style.minHeight = '100px';
                        clonedNode.className += " absolute flex-wrap-center full-xy"
                        indexContainer.appendChild(clonedNode);
                        secondClonedNode = clonedNode.cloneNode(true);
                        indexContainer.appendChild(secondClonedNode);

                    }
                }
            }, 100)

            $timeout(function() {
                $scope.$apply();
            })
        }

        function findParentSVG(elem) {
            return (elem.nodeName === 'svg' && elem) || findParentSVG(elem.parentNode);
        }

        $scope.asideTabIndexwatcher = $scope.$watch('asideTabIndex', function(new_val, old_val) {
            switch (new_val) {

            case 2:
              //init map
                updateStageElemCloneAside();
                renderAsideAnimatableElems();


         }
        });

        function renderAsideAnimatableElems() {
            if (!$scope.stage) {
                return;
            }
            if (!$scope.stage.anim_elements) {
                $scope.stage.anim_elements = [];
            }
            var allShapes = ['path', 'line', 'polygon', 'polyline', 'g', 'rect', 'ellipse', 'circle', 'tspan', 'text'];
            var allAnimElemItemContainers = document.querySelectorAll('.aside-anim-element-item');
            for (var i = 0; i < $scope.stage.anim_elements.length; i++) {
                var indexAnimElem = $scope.stage.anim_elements[i];
                if(indexAnimElem.selector) {
                    console.log('searching for...', indexAnimElem.selector);
                    var stageContainer = document.querySelector('#stage-container');
                    var dragAttribute = indexAnimElem.selector.replace('[', '').replace('', ']') + "";
                    var elem = stageContainer.querySelector(indexAnimElem.selector)
                    if (elem) {
                        var clonedElem = elem.cloneNode(true);
                        clonedElem.removeAttribute('draggable');
                        clonedElem.removeAttribute(dragAttribute);
                        clonedElem.style.maxHeight = "50px;"
                        clonedElem.style.maxWidth = "50px;"
                        clonedElem.style.minHeight = "50px;"
                        clonedElem.style.minWidth = "50px;"
                        clonedElem.className += ""
                        allAnimElemItemContainers[i].innerHTML = "";
                        if (allShapes.indexOf(clonedElem.nodeName) > -1) {
                            var parentSVG = findParentSVG(elem);
                            var clonedParentSVG = parentSVG.cloneNode(true);
                            clonedParentSVG.innerHTML = "";
                            clonedParentSVG.appendChild(clonedElem);
                            allAnimElemItemContainers[i].appendChild(clonedParentSVG);
                        } else {
                            allAnimElemItemContainers[i].appendChild(clonedElem);
                        }





                    }
                }

            }
        }



        $scope.importFromCSSText = function(css_text, name, class_text, options) {

            options = options || {active:false};
            if (!$scope.animations || !$scope.animations.length) {
                options.active = false;
            }
            if (!options.callback) {
                options.callback = null;
            }
            // var css_text = "@keyframes animation { 0% { -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -300, 0, 0, 1); transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -300, 0, 0, 1); } 2.92% { -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -135.218, 0, 0, 1); transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -135.218, 0, 0, 1); } 3.37% { -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -114.871, 0, 0, 1); transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -114.871, 0, 0, 1); } 3.47% { -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -110.596, 0, 0, 1); transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -110.596, 0, 0, 1); } 4.58% { -webkit-transform: matrix3d(2.061, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -68.65, 0, 0, 1); transform: matrix3d(2.061, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -68.65, 0, 0, 1); } 5.69% { -webkit-transform: matrix3d(2.321, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -36.551, 0, 0, 1); transform: matrix3d(2.321, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -36.551, 0, 0, 1); } 5.76% { -webkit-transform: matrix3d(2.32, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -34.768, 0, 0, 1); transform: matrix3d(2.32, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -34.768, 0, 0, 1); } 7.41% { -webkit-transform: matrix3d(1.99, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -3.804, 0, 0, 1); transform: matrix3d(1.99, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -3.804, 0, 0, 1); } 7.51% { -webkit-transform: matrix3d(1.961, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -2.454, 0, 0, 1); transform: matrix3d(1.961, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -2.454, 0, 0, 1); } 7.88% { -webkit-transform: matrix3d(1.771, 0, 0, 0, 0, 1.062, 0, 0, 0, 0, 1, 0, 2.008, 0, 0, 1); transform: matrix3d(1.771, 0, 0, 0, 0, 1.062, 0, 0, 0, 0, 1, 0, 2.008, 0, 0, 1); } 8.68% { -webkit-transform: matrix3d(1.408, 0, 0, 0, 0, 1.181, 0, 0, 0, 0, 1, 0, 9.646, 0, 0, 1); transform: matrix3d(1.408, 0, 0, 0, 0, 1.181, 0, 0, 0, 0, 1, 0, 9.646, 0, 0, 1); } 10.03% { -webkit-transform: matrix3d(0.982, 0, 0, 0, 0, 1.333, 0, 0, 0, 0, 1, 0, 16.853, 0, 0, 1); transform: matrix3d(0.982, 0, 0, 0, 0, 1.333, 0, 0, 0, 0, 1, 0, 16.853, 0, 0, 1); } 10.85% { -webkit-transform: matrix3d(0.822, 0, 0, 0, 0, 1.398, 0, 0, 0, 0, 1, 0, 18.613, 0, 0, 1); transform: matrix3d(0.822, 0, 0, 0, 0, 1.398, 0, 0, 0, 0, 1, 0, 18.613, 0, 0, 1); } 11.53% { -webkit-transform: matrix3d(0.732, 0, 0, 0, 0, 1.439, 0, 0, 0, 0, 1, 0, 18.992, 0, 0, 1); transform: matrix3d(0.732, 0, 0, 0, 0, 1.439, 0, 0, 0, 0, 1, 0, 18.992, 0, 0, 1); } 12.22% { -webkit-transform: matrix3d(0.672, 0, 0, 0, 0, 1.469, 0, 0, 0, 0, 1, 0, 18.618, 0, 0, 1); transform: matrix3d(0.672, 0, 0, 0, 0, 1.469, 0, 0, 0, 0, 1, 0, 18.618, 0, 0, 1); } 14.18% { -webkit-transform: matrix3d(0.612, 0, 0, 0, 0, 1.501, 0, 0, 0, 0, 1, 0, 15.054, 0, 0, 1); transform: matrix3d(0.612, 0, 0, 0, 0, 1.501, 0, 0, 0, 0, 1, 0, 15.054, 0, 0, 1); } 14.37% { -webkit-transform: matrix3d(0.612, 0, 0, 0, 0, 1.501, 0, 0, 0, 0, 1, 0, 14.604, 0, 0, 1); transform: matrix3d(0.612, 0, 0, 0, 0, 1.501, 0, 0, 0, 0, 1, 0, 14.604, 0, 0, 1); } 19.23% { -webkit-transform: matrix3d(0.737, 0, 0, 0, 0, 1.371, 0, 0, 0, 0, 1, 0, 3.855, 0, 0, 1); transform: matrix3d(0.737, 0, 0, 0, 0, 1.371, 0, 0, 0, 0, 1, 0, 3.855, 0, 0, 1); } 20.01% { -webkit-transform: matrix3d(0.763, 0, 0, 0, 0, 1.338, 0, 0, 0, 0, 1, 0, 2.724, 0, 0, 1); transform: matrix3d(0.763, 0, 0, 0, 0, 1.338, 0, 0, 0, 0, 1, 0, 2.724, 0, 0, 1); } 23.05% { -webkit-transform: matrix3d(0.856, 0, 0, 0, 0, 1.211, 0, 0, 0, 0, 1, 0, 0.036, 0, 0, 1); transform: matrix3d(0.856, 0, 0, 0, 0, 1.211, 0, 0, 0, 0, 1, 0, 0.036, 0, 0, 1); } 25.75% { -webkit-transform: matrix3d(0.923, 0, 0, 0, 0, 1.114, 0, 0, 0, 0, 1, 0, -0.709, 0, 0, 1); transform: matrix3d(0.923, 0, 0, 0, 0, 1.114, 0, 0, 0, 0, 1, 0, -0.709, 0, 0, 1); } 26.94% { -webkit-transform: matrix3d(0.947, 0, 0, 0, 0, 1.078, 0, 0, 0, 0, 1, 0, -0.76, 0, 0, 1); transform: matrix3d(0.947, 0, 0, 0, 0, 1.078, 0, 0, 0, 0, 1, 0, -0.76, 0, 0, 1); } 31.58% { -webkit-transform: matrix3d(1.009, 0, 0, 0, 0, 0.987, 0, 0, 0, 0, 1, 0, -0.406, 0, 0, 1); transform: matrix3d(1.009, 0, 0, 0, 0, 0.987, 0, 0, 0, 0, 1, 0, -0.406, 0, 0, 1); } 31.73% { -webkit-transform: matrix3d(1.01, 0, 0, 0, 0, 0.986, 0, 0, 0, 0, 1, 0, -0.392, 0, 0, 1); transform: matrix3d(1.01, 0, 0, 0, 0, 0.986, 0, 0, 0, 0, 1, 0, -0.392, 0, 0, 1); } 37.32% { -webkit-transform: matrix3d(1.029, 0, 0, 0, 0, 0.958, 0, 0, 0, 0, 1, 0, -0.03, 0, 0, 1); transform: matrix3d(1.029, 0, 0, 0, 0, 0.958, 0, 0, 0, 0, 1, 0, -0.03, 0, 0, 1); } 38.15% { -webkit-transform: matrix3d(1.029, 0, 0, 0, 0, 0.958, 0, 0, 0, 0, 1, 0, -0.008, 0, 0, 1); transform: matrix3d(1.029, 0, 0, 0, 0, 0.958, 0, 0, 0, 0, 1, 0, -0.008, 0, 0, 1); } 42.35% { -webkit-transform: matrix3d(1.022, 0, 0, 0, 0, 0.969, 0, 0, 0, 0, 1, 0, 0.03, 0, 0, 1); transform: matrix3d(1.022, 0, 0, 0, 0, 0.969, 0, 0, 0, 0, 1, 0, 0.03, 0, 0, 1); } 48.9% { -webkit-transform: matrix3d(1.007, 0, 0, 0, 0, 0.99, 0, 0, 0, 0, 1, 0, 0.009, 0, 0, 1); transform: matrix3d(1.007, 0, 0, 0, 0, 0.99, 0, 0, 0, 0, 1, 0, 0.009, 0, 0, 1); } 57.77% { -webkit-transform: matrix3d(0.998, 0, 0, 0, 0, 1.003, 0, 0, 0, 0, 1, 0, -0.001, 0, 0, 1); transform: matrix3d(0.998, 0, 0, 0, 0, 1.003, 0, 0, 0, 0, 1, 0, -0.001, 0, 0, 1); } 60.47% { -webkit-transform: matrix3d(0.998, 0, 0, 0, 0, 1.004, 0, 0, 0, 0, 1, 0, -0.001, 0, 0, 1); transform: matrix3d(0.998, 0, 0, 0, 0, 1.004, 0, 0, 0, 0, 1, 0, -0.001, 0, 0, 1); } 69.36% { -webkit-transform: matrix3d(0.999, 0, 0, 0, 0, 1.001, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(0.999, 0, 0, 0, 0, 1.001, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); } 83.61% { -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); } 100% { -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); } ";
            // var js_anim_obj = importAnimationFromRawCssText(css_text, name);

            // var final_obj = initAnimationFromAnimObj(js_anim_obj);
            $scope.kf_visuals.cache = $scope.kf_visuals.show;
            $scope.kf_visuals.show = false;
            var originAnimCSSText = css_text;
            $scope.animationDropdown.options[0] = name;
            $scope.showStatusMsgForXSec('Importing ' + name + ' ....', 2500);
            $scope.animation = importAndProcessAnimationCSSTextByKF(css_text, name, options.callback, options.active);
            if ($scope.animation.attr.name.indexOf('-edit') === -1 || $scope.animation.obj.name.indexOf('-edit') > -1)   {
                $scope.animation.attr.name += '-edit';
                $scope.animation.obj.name += '-edit';
            }

            $scope.animationDict.importClassText = class_text;
            $scope.animationDict.importTextarea = css_text;
            $scope.animationDict.importInput = $scope.animation.attr.name;
            $scope.animation.attr.kf_intervals = 100;




            var kfIntervalInput = document.querySelector('#kt-intervals-input');
            $timeout(function() {
                kfIntervalInput && kfIntervalInput.classList.remove('animated', 'wobble');
            }, 1000)
            kfIntervalInput && kfIntervalInput.classList.add('animated', 'wobble');
            if (!options.skip_local) {
                $localstorage.setObject('last_animation',$scope.animation);
            }
            // $scope.layout.index = 0;
            $scope.animation.obj.origCSSText = originAnimCSSText;
            $timeout(function(){
                if ($scope.kf_visuals.cache) {
                    $scope.kf_visuals.onChange($scope.kf_visuals.cache);
                }
                $scope.kf_visuals.show = $scope.kf_visuals.cache;
                $scope.kf_visuals.cache = null;
                $scope.$apply();
            }, 100)
            return $scope.animation;
        }


         function tadaToolElement(selector) {
            var focusedElement = document.querySelector(selector);
            focusedElement.classList.add('animated', 'tada');
            $timeout(function() {
                focusedElement.classList.add('animated', 'tada');
            }, 1000)
        }


    }

]);


angular.module('uguru.admin')
.controller('AdminAnimationController', [
    '$scope',
    '$state',
    '$stateParams',
    '$timeout',
    'RootService',
    '$window',
    'TweenService',
    function($scope, $state, $stateParams, $timeout, RootService, $window, TweenService) {
        var aa = this;
        aa.customAnimations = processCustomAnimations(RootService.getCustomAnimations()).customNameOnly;
        aa.customAnimations.sort()
        aa.easingFunctions = TweenService.getAllEasing();
        aa.animShortcuts = [];
        aa.animatableProps = TweenService.animatableProps;
        aa.clickableKeys = ['custom easing', 'animatable properties'];
        aa.hiddenKeys = ['defaults']
        aa.launchWindow = function(key, param, type) {

            var propParsed = formatAnimShortcuts(key, param, type).trim().split('%').join('p');

            if (aa.customAnimations.indexOf(propParsed.split(':')[0]) > -1) {
                $window.open('#/admin/api/animations/custom/'  + param + '?template=shared:components.svg.logo.guru-head.html&select=svg&hidePlot=true');
            } else {
                if (!param) {
                    param = key
                }
                if (!type) {
                    type = 'name'
                }


                var url = '#/admin/api/animations/prop/' + propParsed + '?template=shared:components.svg.logo.guru-head.html&select=svg';

                $window.open(url);
            }
        }

        function formatAnimShortcuts(key, param, type) {
            console.log(key, param, type)
            var animArgs = ['name', 'start', 'end', 'duration', 'easingFunc', 'delay', 'iter', 'direction'];
            var defaults = ['opacity', '0', '1', 1000, 'easeOutCirc', 0, 1, 'f'];
            var animArgIndex = animArgs.indexOf(type);
            if (animArgIndex > -1 && type === 'name' && key in aa.animShortcutsDict[type]) {
                type = 'default';
                key = param;
                animArgIndex = -1;
            }
            if (animArgIndex > -1) {
                var startSlice = defaults.slice(0, animArgIndex);
                var endSlice = defaults.slice(animArgIndex + 1, defaults.length);
                var resultStr = '';
                if (startSlice.length) {
                    resultStr += startSlice.join(":");
                }
                resultStr += ':' + param + ':';

                if (endSlice.length) {
                    resultStr += endSlice.join(":");
                }
                console.log(resultStr)
                if ([':', ','].indexOf(resultStr.charAt(0)) > -1) {
                    resultStr = resultStr.substring(1)
                }
                resultStr = resultStr.split(':').join(',').replace(',', ':');
                return resultStr
            }
            else if (type === 'stream') {
                var resultArr = [];
                var paramSplit = param.split(',');
                paramSplit.forEach(function(_param, i) {
                    var strSplit = _param.split(':');
                     resultArr.push(strSplit.slice(0,1) + ':' + strSplit.slice(1).join(','));
                });
                return resultArr.join('+');

            }
            else if (type === 'default') {
                return key + ':' + aa.animShortcutsDict[type][key].split(':').join(',');
            }
        }

        function constructAnimUrlPortion(dict) {
            return dict.name + ':' + dict.start +
                    ',' + dict.end + ',' + dict.duration + ',' + dict.easingFunc + ',' +
                    dict.delay + ',' + dict.iter + ',' + dict.direction;
        }


        function getShortcuts(param) {
            var paramDict = {name:param};
            var requiredArgs = Object.keys(aa.animShortcuts.defaults);

            if (param in aa.animShortcuts) {
                for (arg_type in aa.animShortcuts[param]) {
                    paramDict[arg_type] = aa.animShortcuts[param][arg_type];
                }

            }
            requiredArgs.forEach(function(arg_name, i) {
                if (!(arg_name in paramDict)) {
                    paramDict[arg_name] = aa.animShortcuts.defaults[arg_name]

                }
            })


            return paramDict
        }

        function parseShortcuts(shct_dict) {
            var result_dict = {defaults:{}};

            for (type in shct_dict.types) {
                for (arg_shortcut in shct_dict.types[type]) {
                    var argShortcutVals = shct_dict.types[type][arg_shortcut];
                    for (supported_arg in argShortcutVals) {
                        if (supported_arg === 'default') {
                            result_dict.defaults[arg_shortcut] = argShortcutVals[supported_arg];
                            continue;
                        }
                        var propNames = argShortcutVals[supported_arg]

                        for (var i = 0; i < propNames.length; i++) {
                            var iPropName = propNames[i];
                            if (!(iPropName in result_dict)) {
                                result_dict[iPropName] = {};
                            }
                            result_dict[iPropName][arg_shortcut] = supported_arg;
                        }
                    }
                }
            }

            return result_dict;
        }

        $timeout(function() {
            aa.dataAnim = $scope.$parent.animations;
            aa.animShortcutsDict = $scope.root.public.customShortcuts.animProps
            var animShortcuts = [];
            animShortcuts.push({name: 'stream', values:aa.animShortcutsDict.stream});

            for (shct_type in aa.animShortcutsDict) {
                if (shct_type !== 'stream') {
                    animShortcuts.push({
                        name: shct_type,
                        values: aa.animShortcutsDict[shct_type]
                    })
                }
            }


            if (Object.keys(aa.dataAnim) && aa.dataAnim.sections.shortcuts) {
                aa.animShortcuts = parseShortcuts(aa.dataAnim.sections.shortcuts);
                delete aa.dataAnim.sections.shortcuts
            }
            aa.animShortcuts = animShortcuts
            $timeout(function() {$scope.$apply()});
        }, 500)

        function processCustomAnimations(animations) {
            return animations
            anitmations.custom.forEach(
            function(c, i) {
                if (c.cssText && c.cssText.indexOf('from') > -1) {
                    console.log(c.cssText);
                }
            })
            return animations;
        }
    }

]);

angular.module('uguru.admin')
.controller('AdminDevController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'UtilitiesService',
  'AdminService',
  'XHRService',
  function($scope, $state, $timeout, UtilitiesService, AdminService, XHRService) {
    var admin = this;

    admin.releases = ['preapp', 'become-guru', 'gpa', 'sound', 'focus'];
    admin.gallery = {components: []}
    $timeout(function() {
      loadAdminSpec(admin.releases[0]);
      var today = new Date();
      loadCalendar({month: today.getUTCMonth() + 1, date: today.getUTCDate()});
    })

    AdminService.getComponents($scope)

    // console.log(promise)

    admin.calendarDates = AdminService.getUpcomingCalendar(14);
    // admin.today = getDetailedDayEvent(0, admin.calendarDates);


    admin.remote = {
      nextModule: function() {admin.releases = admin.releases.indexOf(admin.iSpec.name) + 1}
    }

    function loadAdminSpec(r_name) {
        var callback = function(r_dict) {
          admin.iSpec = r_dict;
        }
        XHRService.getJSONFile('get', 'admin/spec/' + r_name + '/' + r_name  + '.spec.json', callback);
    }

    function loadCalendar(d_obj){
      var strDate = d_obj.month +'/' + d_obj.date;
      var callback = function(c_dict) {
        admin.fullcalendar = c_dict;
        admin.today = c_dict[strDate];
      }
      XHRService.getJSONFile('get', 'admin/spec/calendar.json', callback);
    }

  }
]);
angular.module('uguru.admin')

.controller('AdminActionController', [
  '$scope',
  '$state',
  '$timeout',
  '$localstorage',
  '$window',
  'SpecContentService',
  'ReportService',
  '$interval',
  function($scope, $state, $timeout, $localstorage, $window, SpecContentService,ReportService,$interval) {
    //spec service get all


    $scope.search = {text: ''};

    $scope.team_members = SpecContentService.getTeamMembers();

    $timeout(function() {console.log($scope.team_members)});


    $scope.user_workflows = [];
    $scope.user_workflows = SpecContentService.getContentSpec('preApp');
    $scope.admin_tasks = SpecContentService.getContentSpecAdmin('preApp');


    $interval(initBugs, 5000);

    if (window.location.href.split(':8100').length > 1) {
      $timeout(function() {
        initBugs();
      }, 500);
    }

    function countFailt(eachState)
    {
      var count = 0;
      for (var i = 0; i < eachState.platforms.length; ++i){
        if (eachState.platforms[i].isPassed === 1){
           ++ count;
        }
      }
      return count;
    }

    function initBugs () {
      ReportService.getBug().then(function(result){
       if(!$scope.bugReport){
          $scope.bugReport = result['workflows'];
          $scope.lastReportUpdate = result['lastUpdate'];
       }
       else {
          // console.log("check", $scope.lastReportUpdate , result['lastUpdate'])
          classList = document.querySelector('#cta-modal-action-platforms').classList
          if (result['lastUpdate'] > $scope.lastReportUpdate && !classList.contains('show')){
            console.log("UPDATED")
            $scope.bugReport = result['workflows'];
            $scope.lastReportUpdate = result['lastUpdate'];
          }
          // else
          // {
          //   console.log("No data need to updated");
          // }
       }

      }, function(reason) {
        // console.log(reason);
      });
    }

    $scope.$watchCollection('bugReport', function(newNames, oldNames) {
      if (!oldNames && newNames){
        console.log('bugReport is load',$scope.lastReportUpdate);

      }
      if(oldNames && newNames){
        console.log('bugReport is Updated');
      }
    });


    $scope.updateStatus = function(index){
        switch( $scope.statePlatforms[$scope.availableState.selectedIndex].platforms[index].isPassed){
          case 1:
            $scope.statePlatforms[$scope.availableState.selectedIndex].platforms[index].isPassed = -1;
            break;
          case -1:
            $scope.statePlatforms[$scope.availableState.selectedIndex].platforms[index].isPassed = 0;
            break;
          case 0:
            $scope.statePlatforms[$scope.availableState.selectedIndex].platforms[index].isPassed = 1;
            break;
        }
        var report = {
           'workflows': $scope.bugReport,
           'lastUpdate': new Date().getTime()
         }
        ReportService.syncReport(report);
    };
    $scope.closePlatform = function(){
      var targetElem = document.querySelector('#cta-box-selected-bug');
      var modalElem = document.querySelector('#cta-modal-action-platforms');
      modalElem.classList.remove('show');
    };


    $scope.openPlatform = function(workFlowID,key){
        var targetElem = document.querySelector('#cta-box-selected-bug');
        var modalElem = document.querySelector('#cta-modal-action-platforms');
        modalElem.classList.add('show');
        if (key === 'states'){
          $scope.isAutoState = true;
        }
        else{
          $scope.isAutoState = false;
        }
        for(var i = 0; i < $scope.bugReport.length ; ++i)
        {
          if ($scope.bugReport[i].workFlowID === workFlowID){
            // $scope.statePlatforms = $scope.bugReport[i][key];
            $scope.autoReport =  $scope.bugReport[i][key];
            if(key === 'manualState'){
              $scope.manualFound = $scope.bugReport[i]['manualBugs'];
              // console.log('CHECK RESULT',$scope.manualFound);
            }

            // var options = [];

            // for (var j = 0; j <  $scope.statePlatforms.length; ++j ){
            //   options.push( $scope.statePlatforms[j].title);
            // }
            // for (var j = 0; j <  $scope.manualFound.length; ++j ){
            //   options.push( $scope.manualFound[j].title);
            // }
            $scope.statePlatforms = $scope.autoReport;
            setOptions($scope.statePlatforms)
            console.log($scope.statePlatforms,$scope.availableState)
            // $scope.availableState = {
            //   'selectedIndex': 0,
            //   'options': options
            // };
            return;
          }
        }
    };
    $scope.switchSates = function(obj){
      $scope.statePlatforms = obj;
      setOptions($scope.statePlatforms);
    }

    function setOptions(object){
      var options = [];
      for (var j = 0; j <  object.length; ++j ){
        options.push( object[j].title);
      }
      $scope.availableState = {
        'selectedIndex': 0,
        'options': options
      };
    }

    $scope.availableOptions = {
        'selectedIndex': 0,
        'options': ['All Bugs','Prioritized Bugs','Recently Complete']
    };

    // $scope.calState = function(title,key){
    $scope.calState = function(id,key){

      // console.log('check', stateID)
      function convertTitle(str){
          var id = 0;
          for (var i = 0; i < str.length ; ++ i) {
            id += str.charCodeAt(i);
          }
          return id;
      }
      var workFlowID = id;
      // console.log("CHECK",$scope.bugReport)
      for(var i = 0; i < $scope.bugReport.length ; ++i)
      {
        if ($scope.bugReport[i].workFlowID === workFlowID){
          var totalPass = 0;
          for (var j = 0; j < $scope.bugReport[i][key].length; ++j)
          {
            totalPass += countFailt($scope.bugReport[i][key][j]);
          }
          if (key ==='manualState'){
            for (var k = 0; k < $scope.bugReport[i]['manualBugs'].length; ++k)
            {
              totalPass += countFailt($scope.bugReport[i]['manualBugs'][k]);
            }
            var digit = totalPass/($scope.bugReport[i][key].length * 25 +
              $scope.bugReport[i]['manualBugs'].length*25)* 100;
          }
          else{
            var digit = totalPass/($scope.bugReport[i][key].length * 25)* 100;
          };
          return parseFloat(digit.toFixed(2));
        }
      }
      return ' - ';
    };


    $scope.getBug  = function(id){
      var counts;
      if(id && $scope.bugReport){
        for(var i = 0; i < $scope.bugReport.length ; ++i)
        {
          if ($scope.bugReport[i].bugID === id){
            return $scope.bugReport[i].bugs.length;
          }
        }
      }

      return 0;
    };

    function getUserFirstName(user) {
      return (user && user.name.split(' ')[0].toLowerCase()) || {name: 'jason'};
    }

    $scope.parseMember = function(member_name) {
      if (!member_name) {
        return {
          first_name: 'plz login',
          name: 'plz-login',
          profile_url: '',
          priority: true
        }
      }
      var first_name = member_name.split(':')[0];
      var member = JSON.parse(JSON.stringify(getMemberFromFirstName(first_name)));

      var args = null;
      if (member_name.split(':').length > 1) {
        args = member_name.split(':')[1];
        if (args === 'priority') {
          member.priority = true;
          member.value = 0;
        }
        else if (args === 'complete') {
          member.complete = true;
          member.value = 2;
        }
      } else {
        member.value = 1;
      }
      return member;

      function getMemberFromFirstName(name) {
        for (var i = 0; i < $scope.team_members.length; i++) {
          if ($scope.team_members[i].first_name.toLowerCase() === name.toLowerCase()) {
            return $scope.team_members[i];
          }
        }
      }
    }

    for (var i = 0; i < $scope.user_workflows.length; i++) {
      var indexWF = $scope.user_workflows[i];
      if (indexWF.members && indexWF.members.length) {
        for (var j =0; j < indexWF.members.length; j++) {
          var indexMember = indexWF.members[j];
          var memberString = indexWF.members.splice(j, 1)[0];
          indexWF.members.unshift($scope.parseMember(memberString));
        }
      }
    }


  }

])
angular.module('uguru.admin')

.controller('AdminChartController', [
  '$scope',
  '$element',
  '$attrs',
  '$transclude',
  '$compile',
  '$timeout',
  'ElementService',
  'ChartService',
  function($scope, $element, $attrs, $transclude, $compile, $timeout, ElementService, ChartService) {
    var attr = $attrs;
    var context = {type: 'on', name: 'init'};



    // $compile(animElem)($scope);


    var chart = this;


    $transclude($scope, function(clone, innerScope) {
      chart.elemDir = ElementService.initGraphicElement($attrs.src)
      chart.elemDir.attr('id', 'chart-elem')
      chart.elemDir.attr('chart', 'chart')
      $element.append(clone)
      $element.append(chart.elemDir)
      $compile($element)(innerScope)

    })

    $scope.$watch('chart.elem', function(element) {
        if (element) {
          chart.anim = $scope.renderAnimationStr(chart.elem, null, attr.state, chart.context, true);
          $scope.chart.player = chart.anim.player;
          $scope.chart.player.play($scope.chart.player);
          $scope.chart.player.pause();
        }
    })



    chart.context = context;

    $scope.renderAnimationStr = function(elem, scope, animations, context, debug) {
      return ElementService.renderAnimationStr(elem, scope, animations, context, debug)
    }


  }

])
angular.module('uguru.admin')

.controller('AdminDemosController', [
  '$scope',
  '$state',
  '$timeout',
  '$interval',
  '$localstorage',
  '$window',
  'AnimationService',
  '$compile',
  function($scope, $state, $timeout, $interval, $localstorage, $window, AnimationService, $compile) {
    var demo = this;
    demo.showTextArgument = function($event) {
      var strArgs = $event.target.getAttribute('on-click');
      demo.lastSelectedText = strArgs;
      console.log(demo.lastSelectedText)
    }

    $timeout(function() {

      var buttons = document.querySelectorAll('.guru-switch-container .button');

        for (var i = 0; i < buttons.length; i++) {
            var iButton = angular.element(buttons[i]);
            var moveClass = iButton[0]

            iButton[0].addEventListener('click', function($event) {
              var iButton = angular.element($event.target);
              var moveClass = iButton[0];
              var moving = iButton[0].getBoundingClientRect().width;
              console.log(moveClass, moving)
                var moveIndex = parseInt(moveClass.getAttribute("data-index")) + 1;
                var moveAmt = parseInt(moveClass.getAttribute("data-move")) - moving;
                setTimeout(function() {
                  var glasses = document.querySelector('.glasses');
                    if (moveIndex == (glasses.children.length + 1)) {
                        moveClass.getAttribute('data-move', 0);
                        moveClass.getAttribute('data-index', 1);
                        iButton.css("transform", "translateX(" + 0 + "px)")
                    } else {
                        moveClass.setAttribute('data-move', moveAmt);
                        moveClass.setAttribute('data-index', moveIndex);
                        iButton.css("transform", "translateX(" + moveAmt + "px)")
                    }
                }, 50);
            });
            $compile(iButton)($scope)
        }

    }, 1000)
  }
])
angular.module('uguru.admin')

.controller('AdminPlaygroundController', [
  '$scope',
  '$state',
  '$timeout',
  '$interval',
  '$localstorage',
  '$window',
  'AnimationService',
  'SpecService',
  '$compile',
  'DirectiveService',
  function($scope, $state, $timeout, $interval, $localstorage, $window, AnimationService, SpecService, $compile, DirectiveService) {
    var apc = this;
    apc.options = {
      animation: {
        args: [
          {name: 'template'},
          {name: 'name', default: 'bounceInUp'},
          {name: 'duration', default: '1500ms'},
          {name: 'func', default: 'func'}
        ]
      },
      transform: {
        args: [
          {name: 'scale[XYZ]'},
          {name: 'translate[XYZ]'},
          {name: 'rotate[XYZ]', shortNames:['r[xyz]', 'r-[xyz]', 'ro-[xyz]']},
          {name: 'skew[XY]', value: 'coord'},
          // {name: 'origin', value:'coord'},
          {name: 'perspective(VAL)'},
          {name: 'to(#select)', value: 'selector'},
          {name: 'backface-visibility', shortNames: ['b-v'], valueType: 'string', animatable:false, default:'visible', range: {values: ['visible', 'hidden']}},
          {name: 'perspective-origin', shortNames: ['p-o'], valueType: 'string', animatable:true, default:'50% 50%', range: {values:['*-x-position', '*-y-position'], description: 'one-value, two-value syntax of x/y position'}},
          {name: 'transform-style', shortNames: ['t-s'], valueType: 'string', animatable:false, default:'flat', range: {values:['flat', 'preserve-3d', 'initial', 'inherit'], description: 'let the transformed child preserve the 3d transformation'}},
          {name: 'transform-origin', shortNames: ['t-o'], valueType: 'string', animatable:true, default:'50% 50% 0', range: {values:['*-x-position', '*-y-position', 'z|length|!%'], description: "Set a rotated element's base placement"}},

          // {name: 'clear', value: ['arg', 'all']},
        ],
        options: {
          coords: ['px', 'vp', '%', 'deg'],
          time: ['s'],
          func: ['timing func']
        },
        clear: getClearingFunction,
        examples: [
          {
            args: ['rotate-z', 'translate-x', 'scale-y'],
            str: 'transform:[rotatez:-0.75turn, tx:100%, sc-y:2.0, t-o:75% 25% -125px, duration:20000, p:500px, tf:cb(0.230,1.000, 0.320,1.000)]'
          },
          {
            args: ['sk-z', 'sk-x', 'ro-z', 't-o'],
            str: 'transform:[ro-z:-0.75turn, sk-x:100deg, sk-y:-100deg, t-o:75% 25% 125px, duration:1000, p:500px]'
          },
          {
            args: ['backface-visibility'],
            str: 'transform:[b-v:visible, t-o:50% 50% 0, t-s:preserve-3d, p-o:50% 50%]'
          },
          {
            args: ['skewX', 'skewY'],
            str: 'transform:[skew:(0.5rad, 30deg), duration:1000]'
          },
          {
            args: ['to', 'duration', 'delay'],
            str: 'transform:[to:(#title), duration:250, delay:500]'
          },
          {
            args: ['rotateX', 'rotateY', 'rotateZ'],
            str: 'transform:[rotate:(45deg,50deg,0.75turn), p:500px, duration:500]'
          },
          {
            args: ['translate3d'],
            str: 'transform:[translate:(20%,20%,100px), p:500px, duration:500]'
          },
          {
            args: ['scale', 'scaleZ', 'scaleY', 'scaleX'],
            str: 'transform:[scale:(1.5,1.9,1.9), p:500px, duration:500]'
          },

        ]
      }
    }

    // $timeout(function() {
      initPlaygroundVars($scope.name, apc);
    // }, 1000)
      $timeout(function() {
        apc.example && apc.example.play();
      })
      $scope.$watch('apc.exampleIndex', function(value) {
        var elem = document.querySelector('svg rect');
        var player = document.querySelector('#transition-player');
        if (player) {

          player.parentNode.removeChild(player);
          $timeout(function() {
            apc.example.play();
            elem.parentNode.classList.remove('inspect');
            elem.parentNode.classList.add('inspect');
            $compile(elem)($scope);
            $scope.$apply();

          })
        }
      })

    function initPlaygroundVars(name, index) {
      apc.type = name;

      if (name in apc.options) {
        var examples = apc.options[name]['examples'];
        var element = document.querySelector('#playground-view rect');

        if (!element || !examples) return;
        for (var i = 0; i < examples.length; i++) {
          if (i === 0) {
            apc.example =  apc.options[name]['examples'][0];
            apc.exampleIndex = 0;
          }

            examples[i].id = i;
            examples[i].play = getPlayingFunction(examples[i], element.parentNode);
            examples[i].clear = apc.options[name].clear(name, examples[i], element.parentNode)
        }
      }
    }

    function getPlayingFunction(example_obj, element) {
      return function() {
        var args = DirectiveService.parseArgs(example_obj.str);
        for (key in args) {
          DirectiveService.activateArg(key, args[key], $scope, angular.element(element));
        }
        example_obj.showReset = true;
        // for (arg in args) {
        //   arg && DirectiveService.activateArg(arg);
        // }
        // console.log(element, example_obj);
      }
    }

    function getClearingFunction(name, example_obj, element) {
      if (name === 'transform') {
        return function() {
          element.style['transform'] = '';
          element.style['transition'] = '';
          element.style['webkitTransform'] = '';
          element.style['webkitTransition'] = '';
          example_obj.showReset = false;
        }
      }
    }

    apc.updateElement = function(str, example_obj) {
      element = document.querySelector('#playground-view svg rect');
      element.parentNode.setAttribute('init-with', str);
      // element.parentNode.removeAttribute('init-later');
      // element.parentNode.setAttribute('init-later', null);
      $compile(angular.element(element.parentNode))($scope);
      element.classList.add('init-with')
      example_obj.play = getPlayingFunction(example_obj, element.parentNode);
      example_obj.clear = getClearingFunction($scope.name, example_obj, element.parentNode);

    }

    console.log('name', $scope.name)
    // playground.sections = processPlaygrounds(playgroundDict);
    // playground.activeSection = playground.sections[0];
    // playground.updateActiveSection = updateActiveSection

    function updateActiveSection(section) {
      playground.activeSection = section;
      $timeout(function() {
        $scope.$apply()
      });
    }
    function processPlaygrounds(_dict) {
      var result_arr = [];
      var index =0;
      for (key in _dict) {
        var sectionDict = _dict[key];
        sectionDict.id = index;
        sectionDict.title = key;
        result_arr.push(sectionDict);
        index ++;
      }
      return result_arr;
    };

  }

])


angular.module('uguru.admin')

.controller('AdminPropertyController', [
'$scope',
'$state',
'$timeout',
'$localstorage',
'$compile',
'AnimationService',
'UtilitiesService',
'TweenService',
'RootService',
'DirectiveService',
function($scope, $state, $timeout, $localstorage, $compile, AnimationService, UtilitiesService, TweenService, RootService, DirectiveService) {
  var apc = this;

  function parsePropertiesAndPlay(properties, i_elem) {
	properties.forEach(function(property, i) {
	  var transformProp = {start: '', end: '', ease: ''};
	  var transformProperties = ['scale', 'translateX', 'translateY', 'scale', 'rotate', 'perspective'];
	  if (typeof(property.start) === 'string' && transformProperties.indexOf(property.start.split('(')[0]) > -1) {
		transformProp.start += property.start + ' ';
		transformProp.end += property.end + ' ';
	  }
	  properties[i].element = i_elem;
	  if (i === 0 && properties[i].element) {
		apc.gPlayer.element = i_elem;
	  }

	  properties[i].animation = initAnimationWithEase(property, i);
	  properties[i].player = {offset:0, play: playOne, resetAnim: resetOne, resume: playOne, stepBack: stepOne, step: stepForward(apc.gPlayer.element, properties[i]), pause: pauseOne};

	  properties[i].player.element = document.querySelector('.property-playbar-' + i);


	  properties[i].keyframes = convertAnimObjToKF(property.animation.obj);
	  properties[i].player.update = getUpdatePropertyAnimationFunc(i);
	  properties[i].defaults = {stepTime: 100};
	  properties[i].settings = initSettingsWithCurrentAnimationValues(properties[i]);
	  properties[i].player.timer = getTimer(property);

	  //player specific
	  if (properties[i].player.element) {
		var playballDict = initPlayerBallAnimation(property);
		properties[i].player.animation = initAnimationWithEase(playballDict, 'Player');
		properties[i].player.playElement = document.querySelector('.property-playball-' + i);
		properties[i].player.playKeyframes = convertAnimObjToKF(property.player.animation.obj);
	  }
	})
  }

  apc.player = {};

  function stepForward(elem, properties) {
	return function() {
	  for (var i = 0 ; i < properties.length; i++) {
		ball = properties[i].player.playElement;
		var iProp= apc.properties[0];
		var options = iProp.settings;
		var tween = new Tweenable();
		var s_dict = {};
		s_dict[iProp.propName] = iProp.start
		e_dict[iProp.propName] = iProp.end;
		tween.setConfig({
		  from: s_dict,
		  end: e_dict,
		  duration: iProp.duration,
		  easing: iProp.ease
		})
		tween.tween();
		tween.pause();
		tween.seek(iProp.timer.value - 250);
		tween.resume();
		$timeout(function() {
		  tween.pause();
		}, 250)

	  }
	}
  }

  // function stepBackwards(elem, properties) {
  //   for (var i = 0 ; i < properties.length; i++) {

  //   }
  // }

  // $timeout(function() {

  //   var inspectElemId = '#svg-square-rect';



  //   var property = apc.properties[0]
  // // parsePropertiesAndPlay(apc.properties, elem);
  //   var startDict = {};
  //   var endDict = {};
  //   startDict[apc.properties[0].propName] = apc.properties[0].start;

  //   var property = apc.properties[0];
  //   var tweenable = new Tweenable();
  //   $timeout(function() {


  //     endDict[apc.properties[0].animation.propName]  = property.end;
  //     tweenable.setConfig({
  //       from: startDict,
  //       to:   endDict,
  //       duration: property.duration,
  //       easing: property.ease,
  //       start: function() {tweenable.pause()},
  //       step: function () {
  //         elem.style[property.animation.propName] = tweenable.get()[property.animation.propName]
  //       },
  //       finish: function() {console.log('finished')}
  //     });
  //   }, 250)
  // });

  function initPlayerBallAnimation(property, reverse) {

	var width = property.player.element.getBoundingClientRect().width;
	if (!reverse) {
	  return {name: 'transform',  start: 'translateX(0px)',  end: 'translateX(' +  (width * 0.11) + 'px)',  duration:property.duration,  timingFunction:property.timingFunction, ease: 'linear',  unit: 0}
	} else {

	  // property.player.playElement.parentNode.style['transform'] = 'translateX(' +  (width * 0.11) + 'px)';

	  // property.player.playElement.setAttribute('x', '95%');
	  return {name: 'transform',  start: 'translateX(0px)',  end: 'translateX(' +  (width * 0.11) + 'px)',  duration:property.duration,  timingFunction:property.timingFunction, fillMode:'forwards', direction:'reverse', ease: 'linear',  unit: 0}
	}
  }

  function getTimer(property, precision) {
	if (!precision) precision = 1
	var intervalLength = 100;//ms
	var timer = {
	  value: 0,
	  startRef: null,
	  interval: null,
	  display: {s: 0, ms: 0},
	  duration: property.settings.duration.val
	};
	timer.start = startTimer(timer);
	timer.pause = pauseTimer(timer);
	timer.resume = resumeTimer(timer);
	timer.reset = resetTimer(timer);
	timer.durationDisplay = {s: (timer.duration/1000).toFixed(precision) + 's', ms: (timer.duration) + 'ms'};
	return timer;
	function resumeTimer(timer) {
	  return function() {
		// timer.start();
		// var current = new Date().getTime();
		// timer.startRef = current;
		// timer.interval = setInterval(function() {
		//   timer.value += intervalLength;
		//   timer.startRef = new Date().getTime();
		//   timer.display.ms = timer.value;
		//   timer.display.s = (parseFloat(timer.value)/1000).toFixed(1);
		//   $timeout(function() {$scope.$apply()});
		// }, intervalLength)
	  }
	}
	function startTimer(timer) {
	  return function() {
		timer.startRef = new Date().getTime();

		clearInterval(timer.interval);
		timer.interval = null;
		timer.interval = setInterval(function() {
		  timer.value += intervalLength;
		  timer.startRef = new Date().getTime();
		  timer.display.ms = timer.value;
		  timer.display.s = (parseFloat(timer.value)/1000).toFixed(precision);
		  $timeout(function() {$scope.$apply()});
		}, intervalLength)
	  }
	}
	function resetTimer(timer) {
	  return function() {
		timer.pause();
		clearInterval(timer.interval);
		timer.interval = null;
		timer.startRef = null;
		timer.value = 0;
		timer.interval = null;
		timer.display.s = 0;
		timer.display.ms = 0
		timer.durationDisplay = {s: (timer.duration/1000).toFixed(precision) + 's', ms: (timer.duration) + 'ms'};
	  }

	}
	function pauseTimer(timer) {
	  return function() {
		clearInterval(timer.interval);
		timer.interval = null;
		var current = new Date().getTime();
		timer.value +=  current - timer.startRef;
		timer.startRef = new Date().getTime();
		timer.display.ms = timer.value;
		timer.display.s = (parseFloat(timer.value)/1000).toFixed(1);

	  }
	}
  }

  function getUpdatePropertyAnimationFunc(index) {
	return function(property, prop_name) {

	  if (prop_name in property.animation)  {
		console.log('changing', prop_name, property.animation[prop_name]);

		// property.animation = initAnimationWithEase(property);
		if (prop_name in property) {
		  property.animation = initAnimationWithEase(property, index);
		} else {
		  property.animation = initAnimationWithEase(property, index);
		}
		property.keyframes = convertAnimObjToKF(property.animation.obj);
		property.settings = initSettingsWithCurrentAnimationValues(property);
		property.player.timer = getTimer(property);

		var playballDict = initPlayerBallAnimation(property, property.animation.direction === 'reverse');
		property.player.animation = initAnimationWithEase(playballDict, 'Player');
		// console.log(property.player.animation)
		// property.player.playElement = document.querySelector('.property-playball-' + i);
		property.player.playKeyframes = convertAnimObjToKF(property.player.animation.obj);

	  }
	}
  }

  function initSettingsWithCurrentAnimationValues(property) {
	var animation = property.animation;
	var durationVal =  parseFloat(property.animation.duration.replace('ms', ''))
	var delayVal =  parseFloat(property.animation.delay.replace('ms', ''))
	var settingsDict = {
	  duration : {
				range: {max: durationVal + durationVal * 1.5, min:(durationVal - (durationVal * 1.5)), step: 100 },
				val:durationVal , display: animation.duration + ''},
	  delay : {
		  range: {max: 3000, min:0, step: 100 },
			val:delayVal , display: animation.delay + ''
	  },
	  resetAtEnd: true,
	  stepSpeed: {
		fast: 250,
		slow:50,
		slowRange: {
		  max: 250,
		  min:16
		},
		fastRange: {
		  min: 250,
		  max: durationVal/2
		}
	  },
	  iterationCount: {val: property.animation.duration || 1, str: animation.iterationCount + ''},
	  update: onSettingChange(property),
	};


	return settingsDict;

	function onSettingChange(property) {
	  return function (prop_name, value) {
		console.log('updating', prop_name, value)
		// property[prop_name] = parseFloat(value.replace('ms', ''));
		property.player.update(property, prop_name)
		$timeout(function() {
		  $scope.$apply();
		})
	  }
	}
  }

  function calculateFPS() {

	window.requestAnimFrame = (function(){
	return  window.requestAnimationFrame       ||
			window.webkitRequestAnimationFrame ||
			window.mozRequestAnimationFrame    ||
			function( callback ){
			  window.setTimeout(callback, 1000 / 60);
			};
	})();

	var requestAnimFram = window.requestAnimationFrame;
	apc.count = 0;
	var timeStart = new Date().getTime();
	function animate() {
	  var currentTime = new Date().getTime();
	  if (currentTime - timeStart < 1000) {
		apc.count += 1
		requestAnimFrame( animate );
	  } else {
		$timeout(function() {
		  $scope.$apply();
		  console.log(apc.count);
		})
	  }
	}
	animate();

  }

  function initAnimationWithEase(options, index) {
	options.easeName = options.ease[0].toUpperCase() + options.ease.substring(1);

	var anim =  {
	  name: (options.name) + options.easeName + index,
	  propName: (options.name) || 'opacity',
	  ease: options.ease || 'bounce',
	  start: options.start || 0,
	  end: options.end || 100,
	  duration: options.duration || 1000,
	  timingFunction: options.tf || 'linear',
	  delay: formatDelay(options.delay || 0),
	  iterationCount: 1,
	  direction: options.direction || 'normal',
	  fillMode:  options.fillMode || 'forwards',
	  cb: [],
	  playState: 'running',
	}


	var anim_obj = AnimationService.initCSSAnimation(anim.name);
	var startDict = {};
	var endDict = {};
	startDict[anim.propName] = options.start;
	endDict[anim.propName]  = options.end;
	anim.keyframes = [];
	kf_arr = TweenService.getKeyframeValues(startDict, endDict, anim.duration, anim.ease, anim.keyframes);
	anim.duration = formatDuration(anim.duration);
	for (var i = 0; i < kf_arr.length; i++) {
	  createFrameWithPropValue(anim_obj, options.name, kf_arr[i][options.name], kf_arr[i].percentage);
	}

	function createFrameWithPropValue(anim_obj, prop, value, percent) {
	  console.log()
	  anim_obj.appendRule(percent + '% ' + '{' + prop + ':' + value + ';' + '}', percent);
	}
	anim.keyframes = convertAnimObjToKF(anim_obj);
	anim.obj = anim_obj;
	return anim

	function formatDelay(num) {
	  return num + 's';
	}

	function formatDuration(num) {
	  return num + 'ms';
	}
  }

  function initializeAnimation(property_name, start, end) {
	var anim_obj = AnimationService.initCSSAnimation(property_name + 'Animation');
	anim_obj.appendRule(start + '% ' + '{' + property_name + ':' + start + ';' + '}', 0);
	anim_obj.appendRule(end + '% ' + '{' + property_name + ':' + end + ';' + '}', 1);
	apc.property.animation = anim_obj;
	apc.property.keyframes = convertAnimObjToKF(anim_obj);
	return anim_obj
  }

  function initAndSetPlayerAnimation(property, element) {

  }

  function getDefaultAnimationProperties(name, element) {
	var prefix = 'webkitAnimation';
	var animPropStr = element[prefix]

	var animPropObj = convertAnimStringToObj(animPropStr);
	animPropObj[prefix + 'Name'] = name;
	if (animPropObj[prefix + 'Duration'] === '0s') {
	  animPropObj[prefix + 'Duration'] = '1s';
	}

	if (name.toLowerCase.indexOf('player') > -1) {
	  animPropObj[prefix + 'TimingFunction'] = 'linear';
	}

	return animPropObj
  }

  function convertAnimStringToObj(str) {
	var properties = ['Name', 'Duration',  'TimingFunction', 'Delay', 'IterationCount',  'Direction', 'FillMode', 'PlayState'];
	var strProperties = str.split(' ')
	var resultDict = {};
	for (var i = 0; i < properties.length; i++) {
	  resultDict['webkitAnimation' + properties[i]] = strProperties[i];
	}
	return resultDict;
  }

  function convertAnimObjToKF(anim_obj) {
	var resultKF = [];
	for (var i = 0; i < anim_obj.cssRules.length; i++) {
	  var iRule = anim_obj.cssRules[i];
	  resultKF.push({
		percent: {str: iRule.keyText, value: parseFloat(iRule.keyText.replace('%'))},
		properties: parseKFCSSText(iRule.style, iRule.cssText)
	  })
	}
	return resultKF;
  }

  function parseKFCSSText(styleDict, cssText) {
	var resultArr = [];
	for (var i = 0; i < styleDict.length; i++) {
	  var propName = styleDict[i];
	  var value = cssText.split(propName + ':')[1].split(';')[0];
	  resultArr.push({name: propName, value: value.trim()});
	}
	return resultArr;
  }

  apc.addKF = function(animation, percent, property, value) {
	  animation.appendRule(percent + '% ' + '{' + property + ':' + value + ';' + '}');
  }

  apc.removeKF = function(property, kf_rule) {
	property.animation.deleteRule(kf_rule);
	property.keyframes = convertAnimObjToKF(property.animation);
  }
  function updateKeyFrameArr() {

  }

  function pauseAll() {
	try {
	  var style = window.getComputedStyle(apc.gPlayer.element)['webkitAnimation'];
	  apc.gPlayer.element.style['webkitAnimation'] = UtilitiesService.replaceAll(style, 'running', 'paused');
	  apc.gPlayer.paused = true;
	  apc.gPlayer.reset = true;
	  apc.gPlayer.active = false;

	} catch(e) {
	  console.log('BS Ionic error - please tell samir if the pause is funky')
	  $timeout(function() {
		pauseAll();
		$scope.$apply();
		console.log('If you see this multiple times in the console.log -- tell Samir')
	  })
	}

  }

  function resetAll() {
	var tempoOffsetWidth = apc.gPlayer.element.style['offsetWidth']
	var style = window.getComputedStyle(apc.gPlayer.element)['webkitAnimation'];
	var newPausedStyle = UtilitiesService.replaceAll(style, 'running', 'paused');
	apc.gPlayer.element.style['webkitAnimation'] = newPausedStyle;
	apc.gPlayer.element.style['webkitAnimation'] = '';
	apc.gPlayer.element.style['offsetWidth'] = null;
	apc.gPlayer.reset = false;
	apc.gPlayer.active = false;
	apc.gPlayer.paused = false;
	apc.gPlayer.timer.reset;
	apc.gPlayer.element.style['webkitAnimation'] = window.getComputedStyle(apc.gPlayer.element)['webkitAnimation'];

	// var style = window.getComputedStyle(apc.gPlayer.element)['webkitAnimation'];
	//pause.
	//set direction to reverse
	//pause
	//set fillMode to backwards
	//pause
	//set duration to 0.01; store currentDuration in Arr;
	//fire timeout
	//fire start listener
	//play
	//onEndListener --> ste back to original
	// apc.gPlayer.element.style['webkitAnimation'] = UtilitiesService.replaceAll(style, 'paused', 'running');
	// apc.gPlayer.element.style['webkitAnimation'] = UtilitiesService.replaceAll(style, 'running', 'paused');
	// apc.gPlayer.pause = true;
	// apc.gPlayer.reset = true;
  }



  function resumeAll() {
	var style = window.getComputedStyle(apc.gPlayer.element)['webkitAnimation'];
	apc.gPlayer.element.style['webkitAnimation'] = UtilitiesService.replaceAll(style, 'paused', 'running');
	apc.gPlayer.paused = false;
	apc.gPlayer.reset = false;
  }

  function playAll(property_arr, start_cb, end_cb) {
	apc.gPlayer.active = true;
	if (apc.gPlayer.paused) {
	  apc.gPlayer.paused = false;
	  apc.gPlayer.resume();
	  return;
	}

	if (apc.settings.showFPS) {
	  apc.showFPS;
	}
	var animStr = ''
	var maxDuration = 0;
	var maxDurationProp = null;
	for (var i = 0; i < property_arr.length; i++) {
	  if (property_arr[i].duration > maxDuration) {
		maxDuration = property_arr[i].duration;
		maxDurationProp = property_arr[i];
	  }
	}

	for (var i = 0; i < property_arr.length; i++) {

	  property_arr[i].animation.str = convertAnimPropObjToString(property_arr[i].animation);
	  animStr += property_arr[i].animation.str;
	  if (i === property_arr.length-1) {
		var endCallback = function(player) {
		  return function(e) {
			console.log('animation has ended');
			apc.gPlayer.element.removeEventListener('webkitAnimationEnd', endCallback);
			player.paused = false;
			player.reset = false;
			player.active = false;
			$timeout(function() {
			  $scope.$apply();
			})
		  }
		}
		maxDurationProp.animation.listeners && maxDurationProp.animation.listeners.start && maxDurationProp.element.removeEventListener('webkitAnimationStart', maxDurationProp.animation.listeners.start);
		maxDurationProp.animation.listeners && maxDurationProp.animation.listeners.end && maxDurationProp.element.removeEventListener('webkitAnimationEnd', maxDurationProp.animation.listeners.end);
		maxDurationProp.animation.listeners = {
		  start: getStartListener(maxDurationProp.element),
		  end: getEndListener(maxDurationProp.element, endCallback(apc.gPlayer), property_arr[i])
		}
		property_arr[i].element.style['webkitAnimation'] =  animStr;

	  } else {
		animStr += ', '
	  }
	}
  }

  function insertElementsInPlayer(elements, main_elem) {
	elements.sort(function(e1, e2) { return e2.attrs.length - e1.attrs.length});
	var elementContainers = document.querySelectorAll('.element-wrapper');
	if (!elementContainers) {
	  return;
	}
	var elemContainerIds = [];
	elementContainers.forEach(
	  function(e, i) {
		if (!elements[i]) return;
		if (elements[i].element === main_elem) return;
		console.log(elements[i].element);
		var clonedNode = elements[i].element.cloneNode(true);

		$compile(clonedNode)($scope);
		clonedNode.id = elements[i].element.id;
		clonedNode.setAttribute('style', '');
		clonedNode.style.transform += " scale(0.4)";
	  //   clonedNode.classList.add('absolute', 'full-xy');
		clonedNode.style['webkitAnimation'] = '';

		clonedNode.style.opacity = 1;
		e.appendChild(clonedNode);

		console.log(elements[i])
		for (key in elements[i].parsedArgs) {
		  if (key.indexOf('init') > -1) {
			activateArg(key, elements[i].parsedArgs[key], $scope, clonedNode);
		  }
		}
	  }
	)
  }

  apc.getAnimatableElements = function(elem) {
	var browserPrefix = RootService.getBrowserPrefix();
	var parentContainer = elem.cloneNode(true);
	// parentContainer = parentContainer.childNodes[0]
	var prefix = 'animation';
	if (browserPrefix && browserPrefix.length)  {
	  prefix = browserPrefix + 'Animation'
	}
	var stateFilters = [];
	var supportedStates = DirectiveService.getSupportedOnStates();
	supportedStates = '[' + supportedStates.join(' [').split(' ').join('] ') + ']';
	var elements = parentContainer.querySelectorAll('*');
	var arrElems = [];
	for (var i = 0; i < elements.length; i++) {
	  arrElems.push(elements[i]);
	}
	var filteredElements = [];
	apc.elements = [];
	arrElems.forEach(function(e, i) {
	  var cmdAttrArr = [];
	  for (var j = 0; j < e.attributes.length; j++) {
		var indexAttr = e.attributes[j];
		if (supportedStates.indexOf('[' + indexAttr.name) > -1 || indexAttr.name.indexOf('when-') > -1) {
		  cmdAttrArr.push({name: indexAttr.name, value: indexAttr.value, parsedArgs: DirectiveService.parseArgs(indexAttr.value)})
		  e.setAttribute(indexAttr.name, '')
		}
	  }
	  if (cmdAttrArr.length) {
		  eStyle = window.getComputedStyle(e);
		  var animStr = eStyle['webkitAnimation'].replace('running', 'paused');
		  e.style['webkitAnimation'] = animStr;
		  apc.elements.push({id: apc.elements.length + 1, element: e, attrs: cmdAttrArr, animStr: eStyle['webkitAnimation']})
	  }
	})

	$timeout(function() {
	  insertElementsInPlayer(apc.elements, parentContainer);
	}, 500)
	apc.activeElement = apc.elem;
	apc.gPlayer.states = [];
	for (var j = 0; j < elem.attributes.length; j++) {
		var indexAttr = elem.attributes[j];
		if (supportedStates.indexOf('[' + indexAttr.name) > -1 || indexAttr.name.indexOf('when-') > -1) {
		  apc.gPlayer.states.push({name: indexAttr.name, value: indexAttr.value, parsedArgs: DirectiveService.parseArgs(indexAttr.value)})
		  elem.setAttribute(indexAttr.name, '')
		}
	  }
	if (!apc.gPlayer.states.length) {
	  apc.gPlayer.states = apc.elements[0].attrs;
	}

	// apc.gPlayer.states = apc.activeElement.attrs;
	return apc.elements;

	// var timelineDict = {transitions: [], animations:[]};
	// var classDict = {};
	// var animations = [];
	// var elementsWithAnimations = [];
	// var count = 0;
	// var maxDict = {duration: 0, delay:0, animation: null};;
	// for (var i = -1; i < allElements.length; i++) {
	//   var indexChild = ((i >= 0) && allElements[i]) ||element[0];
	//   var indexChildClass = indexChild.classList;
	//   var animationProps = getAnimationObj(browserPrefix, indexChild);
	//   if (animationProps) {
	//     elementsWithAnimations.push(indexChild);
	//     var firstKey = Object.keys(animationProps)[0];
	//     var animationSplit = UtilitiesService.replaceAll(animationProps[firstKey], ', ', ',').split(',');
	//     for (var j = 0; j < animationSplit.length; j++) {
	//       var animDict = [];
	//       for (key in animationProps) {
	//         animDict[key] = UtilitiesService.replaceAll(animationProps[key], ', ', ',').split(',')[j];
	//         var animObj = initAnimationObj(animDict, indexChild, browserPrefix)
	//         if (animObj.duration && animObj.name && animObj.delay) {
	//           var durationParsed = parseFloat(parseDuration(animObj.duration));
	//           var delayParsed = parseFloat(parseDuration(animObj.delay));
	//           if ((delayParsed + durationParsed) > (maxDict.delay + maxDict.duration)) {
	//             maxDict.delay = delayParsed;
	//             maxDict.duration = durationParsed;
	//             maxDict.animation = animObj;
	//           }
	//           if (!(animObj.name in scope.animLookupDict) || scope.animLookupDict[animObj.name].indexOf(indexChild) === -1) {
	//               if (!(animObj.name in scope.animLookupDict)) {
	//                 scope.animLookupDict[animObj.name] = [indexChild];
	//               } else {
	//                 scope.animLookupDict[animObj.name].push(indexChild);
	//               }

	//               animations.push(animObj)
	//           }
	//         }
	//       }
	//     }
	//   }
	// }
  }

  var propertyOne = {name: 'transform', start: 'translateX(-1000%) rotate(-360deg) scale(0.1)', end: 'translateX(10%) rotate(720deg) scale(1.25)', duration:1000, timingFunction:'linear', ease: 'easeOutQuad', playbar:null, unit: 0}
  var propertyTwo = {name: 'fill', start: 'rgb(0,0,0)', end: 'rgb(101,21,255)', duration:2000, timingFunction:'linear', ease: 'easeInOutExpo', playbar:null, unit: 0}

//   var propertyOne = {name: 'font-size', start: '16px', end: '12px', duration:1000, timingFunction:'linear', ease: 'easeOutExpo', playbar:null, unit: 0}
   // var propertyTwo = {name: 'transform', start: 'translate3d(0px,0px,0px)', end: 'translate3d(0px,-36px,0px)', duration:1000, timingFunction:'linear', ease: 'easeOutBounce', playbar:null, unit: 0}
  // var propertyTwo = {name: 'opacity', start: '0.5', end: '1', duration:200, timingFunction:'ease-out', ease: 'easeInExpo', playbar:null, unit: 0}
  // var propertyThree = {name: 'fill', start: 'rgb(0,0,0)', end: 'rgb(101,21,255)', duration:2000, timingFunction:'linear', ease: 'easeInOutExpo', playbar:null, unit: 0}

  apc.properties = [propertyOne, propertyTwo];
  apc.showAllComponents = true;

  function endAnimationAndReverse(elem, post_style, callback) {

	  var endAnimCallback = function(e) {
		elem.style['webkitAnimation'] = post_style;
		if (callback) {
		  console.log('playing callback')
		  callback(window.getComputedStyle(elem)['webkitAnimation']);
		}
		elem.removeEventListener('webkitAnimationEnd', endAnimCallback);
	  }

	  elem.addEventListener('webkitAnimationEnd', endAnimCallback);

	  endAnimationAbrupt(elem, post_style)
  }

  function endAnimationAbrupt(elem, post_style) {
	var style = window.getComputedStyle(elem)['webkitAnimation'];
	var animationStr = style.split(', ');
	console.log(animationStr);
	animationStr.forEach(function(anim_str, i) {
	  var animStrSplit = anim_str.split(' ');
	  animStrSplit[3] = '-' + animStrSplit[1];
	  animationStr[i] = animStrSplit;
	})
	console.log(animationStr);
	if (animationStr.length === 8) {
	  elem.style['webkitAnimation'] = animationStr
	} else {
	  elem.style['webkitAnimation'] = animationStr.join(", ")
	}

	return style;
  }


  function pauseOne(property, cb) {
	property.player.timer.pause();
	var style = window.getComputedStyle(apc.gPlayer.element)['webkitAnimation'];
	var playerStyle =window.getComputedStyle(property.player.playElement)['webkitAnimation'];
	apc.gPlayer.element.style['webkitAnimation'] = style.replace('running', 'paused');
	property.player.playElement.style['webkitAnimation'] = playerStyle.replace('running', 'paused');
	property.player.paused = true;
	property.player.reset = true;
	property.player.active = false;
  }


  function changeDirectionOne(property, direction) {
	var style = window.getComputedStyle(property.element)['webkitAnimation'];
	var playerStyle =window.getComputedStyle(property.player.playElement)['webkitAnimation'];
	var direction = direction || property.animation.direction;
	if (direction === 'normal') {
	  direction = 'reverse'
	} else {
	  direction = 'normal';
	}

	// var duration = durationMS * scale_by;
	// property.duration = duration;
	property.animation.direction = direction;
	if (! ('direction' in property)) {
	  property.direction = direction;
	}




	property.player.update(property, 'direction');
	var newAnimStr = recomputeGPlayerAnimation([property]);
	newAnimStr = UtilitiesService.replaceAll(newAnimStr, 'running', 'paused');
	property.element.style['webkitAnimation'] = newAnimStr;
	property.player.animation.str = UtilitiesService.replaceAll(property.player.animation.str, 'running', 'paused');
	property.player.playElement.style['webkitAnimation'] = property.player.animation.str;
	// console.log(recomputeGPlayerAnimation([property.player]))

  }

  function stepBackOne(property) {
  }

  function setSpeedAll(properties, scale_by) {
	properties.forEach(function(prop, i) {
	  setSpeedOne(prop, scale_by);
	})


	$timeout(function() {
	  var newAnimStr = recomputeGPlayerAnimation(apc.properties);
	  console.log(newAnimStr)
	  newAnimStr = UtilitiesService.replaceAll(newAnimStr, 'running', 'paused');

	  // pauseAll();
	  // resetAll();
	  var style = window.getComputedStyle(apc.gPlayer.element)['webkitAnimation']
	  apc.gPlayer.element.style['webkitAnimation'] = style;

	})

  }


  function recomputeGPlayerAnimation(properties) {
	var animStrArr = [];
	for (var i = 0; i < properties.length; i++) {
	  var iProp = properties[i];
	  properties[i].animation.str = convertAnimPropObjToString(properties[i].animation);
	  properties[i].player.animation.str = convertAnimPropObjToString(properties[i].player.animation);
	  animStrArr.push(properties[i].animation.str)
	}
	return animStrArr.join(', ');

  }

  function setSpeedOne(property, scale_by) {

	var style = window.getComputedStyle(property.element)['webkitAnimation'];
	var playerStyle =window.getComputedStyle(property.player.playElement)['webkitAnimation'];
	var durationMS = property.duration;


	var duration = durationMS * scale_by;
	property.duration = duration;
	property.animation.duration = duration + 'ms';
	property.player.update(property, 'duration');


	apc.gPlayer.element.style['webkitAnimation'] = style.replace('paused', 'running');
	property.player.playElement.style['webkitAnimation'] = playerStyle.replace('paused', 'running');
	property.player.timer.resume()

  }

  function resetOne(property, cb) {
	// var tempoOffsetWidth = apc.gPlayer.element.style['offsetWidth']
	// var playerTempOffsetWidth = property.player.playElement.style['offsetWidth'];
	var style = window.getComputedStyle(apc.gPlayer.element)['webkitAnimation'];
	var playerStyle = window.getComputedStyle(property.player.element)['webkitAnimation'];
	property.player.timer.reset();

	var newPausedStyle = UtilitiesService.replaceAll(style, 'running', 'paused');
	var newPausedPlayerStyle = UtilitiesService.replaceAll(playerStyle, 'running', 'paused');
	console.log('current:', style, 'reset:', newPausedStyle);

	apc.gPlayer.element.style['webkitAnimation'] = '';
	property.player.playElement.style['webkitAnimation'] = '';

	apc.gPlayer.element.style['offsetWidth'] = null;
	property.player.playElement.style['offsetWidth'] = null;

	property.player.element.style['webkitAnimation'] = newPausedStyle;
	property.player.playElement.style['webkitAnimation'] = newPausedPlayerStyle;


	cb && cb();
  }

  function resumeOne(property, cb) {
	var style = window.getComputedStyle(apc.gPlayer.element)['webkitAnimation'];
	var playerStyle =window.getComputedStyle(property.player.playElement)['webkitAnimation'];
	apc.gPlayer.element.style['webkitAnimation'] = style.replace('paused', 'running');
	property.player.playElement.style['webkitAnimation'] = playerStyle.replace('paused', 'running');
	property.player.timer.resume();
  }



  function stepAll(properties, direction, cb) {
	var time = apc.gPlayer.defaults.stepTime;
	if (!direction) direction = '+';
	if (direction === '+') {
	  apc.gPlayer.play(properties);


	  // apc.gPlayer.element.style['webkitAnimation'] = style;
	  // property.player.playElement.style['webkitAnimation'] = animPlayerStr;
	  $timeout(function() {
		apc.gPlayer.pause(properties);
	  }, time)
	}

  }

  function stepOne(property, time, direction, cb) {
	if (!time) {
	  time = property.defaults.stepTime;
	} else {
	  time = parseInt(time);
	}
	if (!direction) direction = '+';
	var animationName = property.animation.name;

	var style = window.getComputedStyle(apc.gPlayer.element)['webkitAnimation'];
	var playerStyle = window.getComputedStyle(apc.gPlayer.element)['webkitAnimation'];
	var isAnimationInStyle = style.indexOf(animationName);
	var animStr;


	// its starting
	animPlayerStr = convertAnimPropObjToString(property.player.animation);
	if (isAnimationInStyle === -1) {
	  style = convertAnimPropObjToString(property.animation);
	}

	if (direction === '-') {
	  // apc.gPlayer.element.style['webkitAnimation'] = style.replace('normal', 'reverse');
	  // var originalTimer = property.player.timer.value;
	  // var delay = (property.duration - property.player.timer.value) * -1/1000

	  // var styleSplit = style.split('0s');
	  // var newStyle = styleSplit[0] + delay + 'ms' + styleSplit[1];
	  // newStyle = newStyle.replace('normal', 'reverse').replace('paused', 'running');
	  // console.log(apc.gPlayer.element.style['transform'])

	  var tweenable = new Tweenable();
	  var startDict = {};
	  var endDict = {};
	  startDict[property.animation.propName] = property.start;
	  endDict[property.animation.propName]  = property.end;
	  tweenable.tween({
		from: startDict,
		to:   endDict,
		duration: property.duration,
		easing: property.ease,
	  })

	  var tweenable = new Tweenable();
	  startDict[property.animation.propName] = property.start;
	  endDict[property.animation.propName]  = property.end;
	  tweenable.tween({
		from: startDict,
		to:   endDict,
		duration: property.duration,
		easing: property.ease,
		step: function () {property.element.style['webkitAnimation'] = '';property.element.style[property.animation.propName] = tweenable.get()[property.animation.propName] }
	  });

	  $timeout(function() {
		Tweenable.prototype.pause();
	  }, time);

	  // tweenable.resume()
	  // tweenable.seek(100);
	  // property.element.style['webkitAnimation'] = '';

	  // tweenable.resume()
	  // property.element.style.webkitTransition = 'transform 250ms linear'
	  // property.element.style.transform = tweenable.get().transform;
	  // apc.gPlayer.element.style['webkitAnimation'] = newStyle;
	  // $timeout(function() {
	  //   property.player.pause(property);
	  //   property.player.resetAnim(property, function() {

	  //     console.log('after resetting... setting animation to', style.replace('0s', '-' + (originalTimer - 100) + 'ms'))
	  //     $timeout(function() {
	  //       $scope.$apply();

	  //       apc.gPlayer.element.style['webkitAnimation'] = style.replace('0s', '-' + (originalTimer - 100) + 'ms').replace('running', 'paused');;
	  //     })
	  //   });

	  //   // var newStyle = styleSplit[0] + + updated_delay + 'ms' + styleSplit[1];
	  //   // console.log(newStyle);
	  //   // apc.gPlayer.element.style['webkitAnimation'] = newStyle.replace('running', 'paused').replace('reverse', 'normal')
	  // }, time);
	  // console.log(newStyle);


	  // property.
	  // changeDirectionOne(property, 'normal');
	  // $timeout(function() {
	  //   changeDirectionOne(property, 'normal');
	  // }, 100)


	} else {

	  UtilitiesService.replaceAll(style, 'paused', 'running');
	  UtilitiesService.replaceAll(animPlayerStr, 'paused', 'running');
	  property.player.play(property);
	  // apc.gPlayer.element.style['webkitAnimation'] = style;
	  // property.player.playElement.style['webkitAnimation'] = animPlayerStr;
	  $timeout(function() {
		property.player.pause(property);
	  }, time)

	}

  }

  function jumpAll() {

	// console.log(animStr);

	var styleSplit = style.split(animationName)
	var previousAnim = styleSplit[0] || '';
	var thisAnimSplit = styleSplit[1].split(', ');
	var remainingAnim = thisAnimSplit[1] && thisAnimSplit[1].join(", ") || '';
	console.log('previous:', previousAnim, '\n' + 'targetted:', thisAnimSplit, '\n' + 'remaining:', remainingAnim);
  }

  function changeDirection(property, direction) {
	var cb = function(current_str) {
	  current_str = current_str.split(property.direction).join(direction);
	  current_str.replace('paused', 'running');
	}
	return pauseOne(property, cb);
  }

  function jumpToForOne(property) {
	property.element['webkitAnimation'];
	var properties = ['Name', 'Duration',  'TimingFunction', 'Delay', 'IterationCount',  'Direction', 'FillMode', 'PlayState'];
	var animStr = convertAnimPropObjToString(property.animation);
  }

  function playOne(property, cb_start, cb_end) {
	// property.player.startTime();
	property.player.timer.start();
	property.player.active = true;
	if (property.player.paused) {
	  property.player.paused = false;
	  property.player.reset = false;
	  resumeOne(property, cb_start);
	}
	var properties = ['Name', 'Duration',  'TimingFunction', 'Delay', 'IterationCount',  'Direction', 'FillMode', 'PlayState'];
	var animStrArr = [];
	var animStr = convertAnimPropObjToString(property.animation);
	var animPlayerStr = convertAnimPropObjToString(property.player.animation);


	if (!property.animation.listeners) property.animation.listeners = {};
	if (!property.animation.listeners.start) property.animation.listeners.start = getStartListener(property.element,cb_start);
	if (!property.animation.listeners.end) property.animation.listeners.end = getEndListener(property.element,cb_end, property);
	var endCallback = function(property) {
	  return function(e) {
		property.player.paused = false;
		property.player.reset = false;
		property.player.active = false;
		property.player.timer.reset();
		clearInterval(property.player.timer.interval);
		$timeout(function() {
		  $scope.$apply();
		})
	  }
	}

	property.animation.listeners = {
	  start: getStartListener(property.element),
	  end: getEndListener(property.element, endCallback(property), property)
	}

	property.player.animation.listeners = {
	  start: getStartListener(property.player.playElement, cb_end),
	  end: getEndListener(property.player.playElement, cb_end,property)
	}
	property.element.style['webkitAnimation'] =  animStr;

	property.player.playElement.style['webkitAnimation'] = animPlayerStr;

  }




  function play(property, cb_start, cb_end, override) {
	animation = property.animation;
	element = property.element;
	if (!animation || !element) {
	  console.log('ERROR', 'missing animation or element for property', property.name);
	  return;
	}
	return function(cb_start, cb_end) {

		var properties = ['Name', 'Duration',  'TimingFunction', 'Delay', 'IterationCount',  'Direction', 'FillMode', 'PlayState'];
		  var animStrArr = [];
		  var animStr = convertAnimPropObjToString(animation);

		  if (!animation.listeners) animation.listeners = {};
		  if (animation.listeners && animation.listeners.start) element.removeEventListener('webkitAnimationStart', animation.listeners.start)
		  if (animation.listeners && animation.listeners.end) element.removeEventListener('webkitAnimationEnd', animation.listeners.end)
		  animation.listeners = {
			start: getStartListener(element),
			end: getEndListener(element, cb_end, property)
		  }
		  console.log(animation, animStr);
		  if (override) {
			element.style['webkitAnimation'] =  animStr;
		  } else {
			var currentStyle = window.getComputedStyle(element)['webkitAnimation'];
			if (currentStyle.split(' ').length === 8 && currentStyle.split(' ')[1] === '0s') {
			  element.style['webkitAnimation'] =  animStr;
			} else if (currentStyle.split(' ').length >= 8){
			  element.style['webkitAnimation'] +=  ', ' + animStr;
			}
		  }

		};



  }

  function resetAnimation(element) {
	return function(property) {
	  var style = window.getComputedStyle(element)['webkitAnimation'];
	  var newPausedStyle = UtilitiesService.replaceAll(style, 'running', 'paused');
	  var tempoOffsetWidth = element.style['offsetWidth'] = null;
	  element.style['webkitAnimation'] = newPausedStyle;
	  element.style['webkitAnimation'] = '';
	  element.style['offsetWidth'] = null;
	  element.style['webkitAnimation'] = window.getComputedStyle(element)['webkitAnimation'];
	}
  }

   function getEndListener(element, cb, property) {
		  return element.addEventListener('webkitAnimationEnd', function(e) {
			cb && cb(e)
			if (property.fillMode === 'backwards') {
			  resetAnimation(element)();
			}
		  })
	}
	function getStartListener(element, cb) {
		return element.addEventListener('webkitAnimationStart', function(e) {
		  cb && cb(e)
		})
	}


  function playAllElementAnimations(animation) {
	// var defaultAnimation = ['webkitAnimation'];
	var properties = ['Name', 'Duration',  'TimingFunction', 'Delay', 'IterationCount',  'Direction', 'FillMode', 'PlayState'];
	var iAnimStrArr = [];
	var numAnimations = apc.property.playbar.animations.length;
	var numCompleted = 0;
	for (var i = 0; i < apc.property.playbar.animations.length; i++) {
	  var iAnim = apc.property.playbar.animations[i];
	  var iAnimStr = convertAnimPropObjToString(iAnim);
	  iAnimStrArr.push(iAnimStr);
	};
	apc.element.addEventListener('webkitAnimationStart', function(e) {

	})
	apc.element.addEventListener('webkitAnimationEnd', function(e) {
	  numCompleted += 1;
	  if (numCompleted === numAnimations && numCompleted > 0) {
		var style = window.getComputedStyle(apc.element)['webkitAnimation'];
		var newPausedStyle = UtilitiesService.replaceAll(style, 'running', 'paused');
		apc.element.style['webkitAnimation'] = newPausedStyle;
		apc.element.style['webkitAnimation'] = '';
		apc.element.style['offsetWidth'] = apc.element.style['offsetWidth'];
		apc.element.style['webkitAnimation'] = window.getComputedStyle(apc.element)['webkitAnimation'];
	  }

	})
	apc.element.style['webkitAnimation'] = iAnimStrArr.join(', ');
  }
  // $timeout(function() {
  //   playAnimation();
  //   apc.property.keyframes = convertAnimObjToKF(apc.property.animation);
  // })

  function convertAnimPropObjToString(anim) {
	var properties = ['Name', 'Duration',  'TimingFunction', 'Delay', 'IterationCount',  'Direction', 'FillMode', 'PlayState'];
	properties.forEach(function(p, i) {properties[i] = p.toLowerCase()})
	allAnimPropertyStr = properties.join('|')
	var anim_properties = [];
	for (key in anim) {
	  if (allAnimPropertyStr.toLowerCase().indexOf(key.toLowerCase()) > -1)  {
		anim_properties.push(key);
	  }
	}

	var resultStr = ''

	for (key in anim_properties) {

	  var animValue = anim[anim_properties[key]]
	  if (!anim_properties[key]) continue;

	  if (typeof(animValue) === 'object' || (typeof animValue === 'string' && animValue.indexOf('object:') > -1)) {
		continue
	  }

	  resultStr += animValue + ' ';
	}
	return resultStr.trim();
  }

  function getAllCSSAnimation(anim_name) {
	var resultArr = [];
	var ss = document.styleSheets;
	for (var i = 0; i < ss.length; ++i) {
	  if (!ss[i] || !ss[i].cssRules) {
		continue;
	  }
	  for (var j = 0; j < ss[i].cssRules.length; ++j) {
		  if (ss[i].cssRules[j].type == window.CSSRule.WEBKIT_KEYFRAMES_RULE) {
			resultArr.push(ss[i].cssRules[j]);
		  }
		}
	}
	return resultArr;
  }

  function getCSSAnimationMetrics(animation_arr) {
	var resultDict = {};
	animation_arr.forEach(function(a, i) {
	  rules = a.cssRules;
	  for (var j = 0; j < rules.length; j++) {
		// if (rules[j].cssText.split('{')[1].indexOf(';') === -1) continue;
		rules[j].cssText.split('{')[1].split(';').forEach(
		  function(prop_str, k) {

			if (prop_str.split(':').length > 1) {
			  var prop = prop_str.split(':')[0].trim();
			  if (!(prop in resultDict)) {
				resultDict[UtilitiesService.camelCase(prop)] = 0;
			  }
			  resultDict[UtilitiesService.camelCase(prop)] += 1;
			}
		  }
		);
	  }
	})
	resultArr = [];
	for (key in resultDict) {
	  resultArr.push({prop: key, value: resultDict[key]})
	}
	resultArr.sort(function(p, p2) {return p2.value - p.value})
	return {
	  dict: resultDict,
	  total: animation_arr.length,
	  sorted: resultArr
	}

  }

  function flattenResponseDict(_dict) {
	var result_arr = [];
	for (key in _dict.dir) {
	  for (childKey in _dict.dir[key]) {
		result_arr.push({url:
		  _dict.base_url + '/' + key  + '/' + _dict.dir[key][childKey].filename,
		  name: UtilitiesService.camelCase(childKey),
		  active: false
		});
	  }
	}
	return result_arr;
  }

  $timeout(function() {
	if ($state.current.name === 'root.dev.inspector') {



	  apc.components = flattenResponseDict($scope.templates.components);

	  $timeout(function() {


		$timeout(function() {
		  var elem = document.querySelector('.component-container');
		  if (elem && elem.children && elem.children.length) {
			for (var i = 0; i < elem.children.length; i++) {
			  var iElem = elem.children[i];
			  var eRect = iElem.getBoundingClientRect();
			  var scaleX = 150/eRect.width
			  var scaleY = scaleX * (75/eRect.height)
			  iElem.children[iElem.children.length - 1].style.transform = 'scale(' + scaleX + ',' + scaleY + ')';

			}
		  }

		}, 500);
		$timeout(function() {
		  initInspector();
		}, 1000)
	  })
	}

  }, 750)


  function initGlobalPlayer() {
	var gPlayerDefaults = {stepTime: 100};
	return {play: playAll, stepBack: stepAll, stepForward: stepAll, defaults: gPlayerDefaults,  pause: pauseAll, paused: false, resetAll: resetAll, element: null, resume: resumeAll};
  }



  function parseInspectorArgs(inspector) {
	var selector = inspector.select// || '[inspector-elem]'
	var preLoadElem = inspector.load;
	var activeIndex = 0;
	var loadType = 'components'
	if (preLoadElem) {
	  loadType = preLoadElem.split('|')[0];
	  elemName = preLoadElem.split('|')[1];
	} else {
	  elemName = ''
	}
	return {
	  selector: selector,
	  name: elemName,
	  nameCamel: elemName && UtilitiesService.camelCase(elemName)
	}
  }

  apc.switchComponent = function(index, comp) {
	apc.activeComponent.parentContainer.appendChild(apc.gPlayer.element);
	apc.inspector.name = comp.name
	 var className = apc.inspector.name + '-component';
	elem = document.querySelector('.'  + apc.inspector.name + '-component').firstChild;
	$compile(elem)($scope);
	var index = elem.className.split(className + '-').length > 1 &&  parseFloat(elem.className.split(className + '-')[1]);
	apc.components[index].active = true;
	apc.activeComponent = apc.components[index];
	apc.components[index].parentContainer = elem.parentNode
	var stage = document.querySelector('#player-stage')
	  stage.appendChild(elem);


	  apc.gPlayer.element = elem;

	  apc.showAllElems = true;
	  apc.showAllChildren = true;
	  apc.children = apc.getAnimatableElements(elem);
	  parsePropertiesAndPlay(apc.properties, elem);
	  apc.properties.forEach(function(p, i) {
		p.element = elem
	  })
	$timeout(function() {
	  $scope.$apply();

	})
  }


  apc.activeIndex = 0;
  function initInspector() {
	  apc.playAll = playAll;
	  apc.pauseAll = pauseAll;
	  apc.addProp = {searchText: '', propName: '', start: '', end: '', ease: '', duration: ''};
	  apc.gPlayer = initGlobalPlayer()
	  apc.settings = {showFPS:apc.fps, showKFBar: true}
	  apc.animationArr = getAllCSSAnimation();
	  apc.animProperties = TweenService.getAllAnimatable()
	  apc.stats = getCSSAnimationMetrics(apc.animationArr);


	  apc.inspector = parseInspectorArgs($scope.root.inspector)
	  if (apc.inspector.name && apc.inspector.name.length) {
		var className = apc.inspector.name + '-component';

		elem = document.querySelector('.'  + apc.inspector.name + '-component');
		var index = elem.className.split(className + '-').length > 1 &&  parseFloat(elem.className.split(className + '-')[1]);
		apc.components[index].active = true;
		apc.activeComponent = apc.components[index];
		apc.components[index].parentContainer = elem.parentNode
	  } else {
		elem = initElement(apc.inspector.selector || '[inspector-elem]');
	  }
	  // var selectedElem =

	  clonedElem = elem.cloneNode(true);
	  var stage = document.querySelector('#player-stage')
	  var globalElemContainer = document.querySelector('#global-player-elem-container');



	  stage && stage.appendChild(elem)
	  globalElemContainer && globalElemContainer.appendChild(clonedElem)
	  // elem.style.transform = '';
	  apc.gPlayer.element = elem;
	  apc.showAllElems = true;
	  apc.showAllChildren = true;
	  apc.children = apc.getAnimatableElements(elem);

	  if (apc.gPlayer.states && apc.gPlayer.states.length) {

		apc.gPlayer.activeState = apc.gPlayer.states[0];
		apc.activateState(apc.gPlayer.activeState, apc.gPlayer.element);
	  }


  }

  apc.activateState  = function(state, elem) {
	// if (!elem) {
	//   elem = apc.gPlayer.element;
	// }
	// apc.properties = [];
	// apc.gPlayer.activeState = state;

	// var propArr = [];

	// for (key in state.parsedArgs) {
	//   var iArg = key;

	//   if (iArg === 'prop' && state.parsedArgs[iArg].properties) {


	// 	for (key in state.parsedArgs[iArg].properties) {
	// 	  var propDict = {timingFunction:'linear', ease: 'easeOutQuad'};
	// 	  var obj = state.parsedArgs[iArg].properties[key];
	// 	  var extraArgs = obj.custom + ''
	// 	  // if ('custom' in obj) {
	// 	  //   delete obj['custom']
	// 	  // }

	// 	  var firstKey = Object.keys(obj)[0];
	// 	  var firstValue = obj[firstKey];

	// 	  if (firstKey.length && (firstValue + "").length && extraArgs.split(':').length > 0) {

	// 		// var iargPropSplit = state.parsedArgs[iArg].properties[key].split(':')
	// 		propDict['name'] = firstKey;
	// 		propDict['start'] = firstValue + "";
	// 		propDict['end'] = extraArgs.split(':')[0] + ""

	// 		propDict['duration'] = parseFloat(extraArgs.split(':')[1].replace('ms', ''));
	// 		if (extraArgs.length > 2) {
	// 		  propDict['ease'] = extraArgs.split(':')[2]
	// 		}
	// 		if (extraArgs.length > 3) {
	// 		  propDict['delay'] = extraArgs.split(':')[3];
	// 		}
	// 	  }
	// 	  propArr.push(propDict);
	// 	}

	//   }
	// }
	// apc.properties = propArr;
	// apc.properties.forEach(function(p, i) {
	// 	p.element = elem
	// })
	// $timeout(function() {

	//   parsePropertiesAndPlay(apc.properties, elem);
	// }, 750)

	// return apc.properties
  }

  function initElement(selector) {
	var elem = document.querySelector(selector);
	return elem
  }

  $timeout(function() {

	// initInspector()

  }, 1000)


}

])

angular.module('uguru.admin')

.controller('AdminStaggerController', [
'$scope',
'$state',
'$timeout',
'$localstorage',
'$compile',
'$http',
'DirectiveService',
function($scope, $state, $timeout, $localstorage, $compile, $http, DirectiveService) {

	var stagger = this;
	stagger.examples = getStaggerExamples();
	stagger.activeIndex = 0;
    stagger.data = {use_cases:[], activeIndex: -1}

    $timeout(function() {
        init($scope);
    }, 500)

    stagger.updateActiveIndex = function(index) {

        var elem = document.querySelector('#demo-controller')
        elem.style.opacity = 0;
        stagger.data.activeIndex = index;
        $scope.stagger.data.activeExample = updateExampleGUI($scope.stagger.data.activeIndex, $scope.stagger.data.use_cases);
        // console.log($scope.stagger.data.activeExample);
        var getValuesFunc = DirectiveService.applyMappingDelayFuncToFutureChildren('onEnter', $scope.stagger.data.activeExample.time);

        getValuesFunc(angular.element(elem).children(), $scope.stagger.data.activeExample.time, $scope.stagger.data.activeExample.selector[0])
        console.log($scope.stagger.data.activeExample)

    }
    function init(scope) {
        var elem = document.querySelector('#demo-controller')
        elem.style.opacity = 0;
        getStaggerDocs(scope);
        scope.$watch('stagger.data.use_cases', function(_new) {
            $timeout(function(){
                scope.$apply();
            })
        })


        scope.$watch('stagger.data.activeIndex', function(_new) {

            if (_new === -1 || !scope.stagger.data) return;






            var elem = document.querySelector('#demo-controller')
            var staggerStr = '<stagger-children>' + elem.innerHTML + '</stagger-children>'
            // var elemDisplayTemp = window.getComputedStyle(elem)['display']

            // elem.style.display = 'none';
            elem.innerHTML = staggerStr;
            $timeout(function() {
                // $scope.stagger.data.activeIndex = _new;
                var elem = document.querySelector('#demo-controller > stagger-children')

                elem.setAttribute('on-enter', scope.stagger.data.use_cases[scope.stagger.data.activeIndex].example)
                if ($scope.stagger.data && !$scope.stagger.data.activeExample) {
                            $scope.stagger.data.activeExample = updateExampleGUI($scope.stagger.data.activeIndex, $scope.stagger.data.use_cases);
                            // console.log($scope.stagger.data.activeExample);
                            var getValuesFunc = DirectiveService.applyMappingDelayFuncToFutureChildren('onEnter', $scope.stagger.data.activeExample.time);

                            getValuesFunc(angular.element(elem).children(), $scope.stagger.data.activeExample.time, $scope.stagger.data.activeExample.selector[0])
                        }
                $timeout(function() {
                    elem.parentNode.style.opacity = 1;
                    $compile(elem)($scope);
                    $timeout(function() {


                         // stagger.updateActiveIndex
                         // if ( !$scope.stagger.data.activeExample) {
                         //    stagger.updateActiveIndex(_new)
                            // $scope.stagger.data.activeExample
                            // $scope.stagger.data.activeExample = updateExampleGUI($scope.stagger.data.activeIndex, $scope.stagger.data.use_cases);
                            // // console.log($scope.stagger.data.activeExample);
                            // var getValuesFunc = DirectiveService.applyMappingDelayFuncToFutureChildren('onEnter', $scope.stagger.data.activeExample.time.options);

                            // getValuesFunc(angular.element(elem).children(), $scope.stagger.data.activeExample.time, $scope.stagger.data.activeExample.selector)
                         // }
                    })

                }, 500)


                // elem.style.display = elemDisplayTemp;
            })


            // stagElem.setAttribute('on-enter', scope.stagger.data.use_cases[_new].example)
            // console.log()
            // if ()
            // var elem = document.querySelector('#player-stage');
            // $compile(angular.element(elem))(scope)
            // console.log(re)

            // stagger.data.activeExample = parseExample(stagger.data.use_cases[_new].example)
        })
    }

    function parseExample(example) {
        if (!example) return;
        var resultDict = {};
        var staggerArgs = example.split(':');
        resultDict.selector = staggerArgs.shift();
        resultDict.state = 'on-enter'
        var nextArg = staggerArgs.shift();
        if (nextArg.indexOf('[') > -1 &&  nextArg.indexOf(']') > -1) {
            resultDict.time = nextArg;
            resultDict.easing = 'linear';
        }
        return resultDict

    }

	function getStaggerExamples() {
		return [
			{name: 'simple'},
			{name: 'easing'}
		]
	}

    function updateExampleGUI(index, use_cases) {
        var result = DirectiveService.processStaggerArgs({onEnter: use_cases[index].example});
        console.log(result);
        return result.onEnter
    }

    function getStaggerDocs(scope) {
        return $http.get('admin/spec/api/stagger.json').success(function(data) {
            scope.stagger.data.use_cases = data.use_cases;
            scope.stagger.data.activeIndex = data.activeIndex;
            // scope.stagger.renderExample = true;
            // var elem = document.querySelector('#player-stage');



            // var args = DirectiveService.processStaggerArgs({onEnter: })
            console.log(scope.stagger.data.activeExample)

            // var elem = document.querySelector('#player-stage');
            // $compile(angular.element(elem))(scope)

            // // elem
            // $timeout(function() {
            //     scope.$apply();
            // }, 100)
        });
    }

}

])

angular.module('uguru.admin')

.controller('AdminDocsController', [
  '$scope',
  '$state',
  '$timeout',
  '$filter',
  '$stateParams',
  'XHRService',
  'DataService',
  function($scope,  $state, $timeout, $filter, $stateParams, XHRService, DataService) {
    var docs = this;
    var listener = $scope.$watch('data', function(value) {
      if (value) {
        docs.data = value;
        listener();
        DataService.parseAppDataJson(docs.data);
      }
    })


    // if (!$scope.root||!$scope.root.docs) {
    //   $scope.root = {};
    //   $scope.root.docs = {items: RootService.getDocItems(), searchText:'', resultIds: [], resultItems:[]};
    // }

    // docs.items = [];

    // docs.main  = {index: 0, options: ["Notes", "Utility", "Components", "Directives", "Status/Tools", "Research"]};

    // docs.search = function(letters) {
    //     console.log(letters);
    // }

    // docs.debugDirectives = {};
    // docs.debugDirectives.debug_args = [
    //   {name: 'highlight'},
    //   {name: 'hide'},
    //   {name: 'pause-at'},
    //   {name: 'speed'}
    // ]

    // docs.directives = AdminDirectiveService.getAllDirectives()
    // docs.stateDirectives = {
    //   states: [
    //     {name: 'init-later', tags: ['internal'], syntax:'<ELEM init-later>', description: 'Dont even bother rendering it until later, treat it like a comment or a display:none'},
    //     {name: 'init-with', tags: ['internal']},
    //     {name: 'on-init', tags: ['internal']},
    //     {name: 'on-click', type: ['internal', 'default']},
    //     {name: 'on-hover', type: ['internal', 'default'], syntax:'<button on-hover="...." on-hover-delay="1000"/>', description: 'A <b>on-hover-delay</b> directive extension (extension is when the original directive, i.e. on-hover, must also be present for the extension to function.'},
    //     {name: 'on-mouse-enter', type: ['internal', ]},
    //     {name: 'on-mouse-leave', type: ['internal', 'default']},
    //     {name: 'on-exit', type: external},
    //     {name: 'on-enter', type: external}
    //   ],
    //   arg_options: [
    //     {name: 'set', cases: ['Only applies to states that change (or could change) property over a period of time (class, anim).<br><br> Must be within parentheticals, multiple properties separated with "#", and property values that contain commas (such as "Cubic-bezier") should replace each comma with "##" (2nd layer of nesting)'], syntax:'<ELEM on-init="anim:[bounceInUp:set(opacity:0#animation-timing-function:cubic-bezier(1.0##0.0##0.5))]"'},
    //     {name: 'send', cases: ['For now everything is public. Might as well clarify with public when you are not sure since at least one scope is required'], syntax: '<ELEM on-init="anim:[bounceInUp:set(opacity:0#animation-timing-function:cubic-bezier(1.0##0.0##0.5))]'}
    //   ],
    //   shortcuts: [
    //     {name: 'arg-shortcut', options: ['replace', 'with'], description: 'Enables shortcut creation for state arguments such as [anim, trigger, send, class, prop], with a word or letter of your choice.', syntax: '<arg-shortcut replace="prop" with="p"/>'},
    //     {name: 'prop-shortcut', options: ['replace', 'with'], description: 'Enables shortcut creation for CSS property names, such as [opacity-0, animation-timing-function, background-color], with a word or letter of your choice.', syntax: '<prop-shortcut replace="opacity" with="o"/>'},
    //     {name: 'prop-value-shortcut', options: ['replace', 'with'], description: 'Enables shortcut creation for <b>ONE</b> {property:value} CSS pairing', syntax: '<prop-value-shortcut replace="op:0" with="o-0"/>'},
    //     {name: 'cmd-shortcut', options: ['replace', 'with'], description: 'Enables shortcut creation for enter state values, such as anything in quotations after the default applicable states.', syntax: '<cmd-shortcut replace="prop:[opacity:0, z-index:-1000]" with="backstage"/>'}
    //   ],
    //   state_args: [
    //     {
    //       name: 'prop',
    //       full_name: 'Properties',
    //       description:'setting 1 to several properties when a state occurs',
    //       syntax: '<div on-init="prop:[opacity:1:delay-100, opacity:0.5:delay-500, ...]:delay-1000"><div>',
    //       options: ['delay'],
    //       special_notes: ['For situations where there is an extra comma within the VALUE of the CSS property, use a <b>"#"</b>']
    //     },
    //     {
    //       name: 'class',
    //       full_name: 'Class',
    //       description:'adding/removing a class and (optionally) overriding specific properties for that class',
    //       syntax: '<div on-init="class:[opacity-0:add:delay-500, bounceInUp:add:set:(animation-timing-function:linear)]"></div>',
    //       options: ['add', 'remove', 'set','delay']
    //     },
    //     {
    //       name: 'anim',
    //       full_name: 'Animations',
    //       description: "Applying 1 to several pre-defined animations at a particular state, with the option to set overrideable properties before[default] or after, animate in/0 (set opacity = 1/0)",
    //       syntax: '<div on-enter="anim:[bounceInUp:set:(animation-duration:5s), scaleOutX:out:set:(animation-timing-function:ease):delay-2500]">',
    //       options: ['set', 'in', 'out', 'after', 'before', 'delay'],
    //       upcoming: ['[send]ing a message before/after/@T= for an animation']
    //     },
    //     {
    //       name: 'send',
    //       full_name: 'send',
    //       description: 'The communication protocol between two html elements. Sends a message to 1 to several elements of a particular scope (optional to clarify, public for now).',
    //       syntax: '<div on-enter="send:[div-has-entered:children:delay-500, div-has-entered:parent:delay-1000]"></div>',
    //       options: ['public', 'delay', 'children', 'parent', 'siblings'],
    //       special_notes: ['Must include <i>at least</i> one <b>SCOPE-SPECIFIC</b> (either children, parent, siblings, parent) option'],
    //       upcoming: ['send to multiple scoped audiences with () syntax vs repeating', 'left neighbor', 'right neighbor', 'stagger-ed sending', 'N-th levels up', 'public']
    //     },
    //     {
    //       name: 'trigger',
    //       full_name: 'Trigger',
    //       description: 'Trigger any already-available HTML event on any INTERNAL state such as click, hover, mouse-enter, mouse-leave',
    //       syntax: '<div on-init="trigger:[on-enter:delay-250]">',
    //       options: ['children', 'parent', 'siblings']
    //     }
    //   ]
    // }

    // docs.getSearchTerms = function() {
    //   docs.items = RootService.getDocItems();
    // }

    // docs.searchText = '';

    // $scope.$watch('root.docs.searchText', function(value) {
    //   $timeout(function() {
    //     $scope.root.docs.resultItems = $filter('filter')($scope.root.docs.items, {keywords: value}, true);
    //       $scope.root.docs.resultIds = $scope.root.docs.resultItems.map(function(item, index) { return item.id});
    //       var docItemElems = document.querySelectorAll('[doc-item-id]');
    //       for (var i = 0; i < docItemElems.length; i++) {
    //         var elemId = parseInt(docItemElems[i].getAttribute('doc-item-id'));
    //         if (!($scope.root.docs.resultIds.indexOf(elemId) > -1)) {
    //            docItemElems[i].classList.add('hide-doc-item');
    //         } else {
    //           docItemElems[i].classList.add('show-doc-item');
    //         }
    //       }
    //   })
                // for (var i = 0; i < results.length; i++) {
                //   $scope.root.docs.items
                // }

  //   })

  }

])

angular.module('uguru.admin')

.controller('AdminDocItemController', [
  '$scope',
  '$state',
  'RootService',
  '$timeout',
  function($scope, $state, RootService, $timeout) {

    var docItem = this;
    this.onSnippetClicked = onSnippetClicked(docItem);
    this.onStateClicked = onStateClicked(docItem);
    this.keywords = [];
    this.states = [];
    this.snippets = [];
    this.stateIndex = 0;
    this.snippetIndex = 0;
    RootService.appendDocItem(docItem);
    this.id = RootService.getDocItems().length;

    function onSnippetClicked(scope) {
        return function(index, event) {
            docItem.snippetIndex = index;
        }
    }
    function onStateClicked(scope) {
        return function(index, event) {
            var nextState = docItem.states[index];
            if (!docItem.states[index].inherit) {
                docItem.stateIndex = index;
                docItem.inheritedIndex = false;
                console.log(docItem.stateIndex, 'state index clicked');
            } else {
                // docItem.stateIndex = index;
                docItem.states[docItem.stateIndex].inheritedIndex = true;
                var dashedAttribute = nextState.title.replace(/([A-Z])/g, function($1){return "-"+$1.toLowerCase();});
                var selectedAttrElems = this.element[0].querySelectorAll('[' + dashedAttribute + ']');
                if (selectedAttrElems.length) {
                    for (var i = 0; i < selectedAttrElems.length; i++) {
                        if (dashedAttribute.split('activate').length > 1) {
                            selectedAttrElems[i].classList.add('activate');
                        } else {
                            selectedAttrElems[i].classList.add(dashedAttribute);
                        }
                    }
                }
                docItem.stateIndex = index;
            }
        }

    }

  }

])

angular.module('uguru.admin')

.controller('AdminMilestoneController', [
  '$scope',
  '$state',
  '$timeout',
  '$window',
  'SpecService',
  '$stateParams',
  'UtilitiesService',
  function($scope, $state, $timeout, $window, SpecService, $stateParams, UtilitiesService) {

    var ms = this;
    var allowed_params = ['initial', 'filter', 'type']
    var teamDefaultDict = {JH: 'testReady', GW: 'states', SM:'stories', JO:'states'};
    var teamDefaultFilter = {JH: 'func', GW: 'func', SM:'func', JO:'func'};
    ms.types = ['ugh']//, 'eh', 'ah', 'aha'];
    ms.typeIndex = 0;
    ms.modules = [];
    ms.toggleAll = toggleAll;
    ms.setActivePerson = setActivePerson;
    ms.parseStateParamFilters = parseStateParamFilters;
    $timeout(function() {
      ms.parseStateParamFilters($stateParams);
    }, 500)


    // $scope.$watch('root.milestones', function(new_val) {
    //   for (type in ms.types) {
    //     var indexType = ms.types[type];
    //     ms[indexType] = getAllMilestonesOfType(new_val, indexType)
    //     console.log(ms[indexType]);
    //     $timeout(function() {
    //       $scope.$apply();
    //     })
    //   }
    // })
    // ms.minimal = getAllMilestonesOfType($scope.root.milestones);
    //- list out all the workflows
    //- templates
    //- how to calculate progress


    // --> roles involved
    function parseDimensions(dimen_str) {
      return dimen_str
    }



    function toggleAll(module) {
      for (var i = 0; i < module.workflows.length; i++) {
        module.workflows[i].active = false;
      }
    }

    function parseStateParamFilters(params, workflow) {
      var allowed = allowed_params
      for (key in params) {
        if (allowed.indexOf(key) > -1) {
          var value = params[key].toUpperCase();
          if (ms.activeModule.teamArr.indexOf(value) > -1) {
            ms.activeModule.activePerson = value;
            $timeout(function() {$scope.$apply();})

          } else {
            var workflows = ms.activeModule.workflows;
            var value = value.toLowerCase();
            if (value.indexOf('-') > -1) {
              var value = UtilitiesService.camelCase(value);
            }
            if (workflow) {
              var workflows = [workflow];
            }
            for (var i = 0; i < workflows.length; i++) {
              var iWorkflow = workflows[i];
              var activeIndex = iWorkflow.filter.options.indexOf(value);
              // if ('type' in params && key === 'type' &&  (!(key in iWorkflow) || iWorkflow[key] !== params['type'])) {
              //   iWorkflow.enabled = false;
              // }
              if (activeIndex > -1) {
                iWorkflow.filter.activeIndex = activeIndex;
                ms.activeFilter = iWorkflow.filter.options[activeIndex];
                ms.activeFilterFormatted = UtilitiesService.camelToDash(ms.activeFilter).split('-')
                ms.activeFilterFormatted.forEach(function(word, index) {return word.substring(0,1).toUpperCase() + word[index].substring(1)})
                ms.activeFilterFormatted = ms.activeFilterFormatted.join(" ");
                workflows[i].active = false;
              }
            }
            workflows.filter(function(w, i) {return !w.complete})[0].active = true;
          }

        }
      }
    }

    function setActivePerson(initial) {
      ms.activeModule.activePerson = initial;
      // $timeout(function() {$scope.$apply()})
      $state.go('^.milestones', {initial: initial, filter: teamDefaultDict[initial]})
    }

    ms.open = function(url) {
      var base = window.location.href.split('/#/');
      $window.open(base + url, '_blank');
    }

    function getAllMilestonesOfType(ms_arr, type) {
        var resultArr = [];
        for (var i = 0; i < ms_arr.length; i++) {
          var indexMS = ms_arr[i];
          if (indexMS.type === type) {
            indexMS = parseActionObjProperties(indexMS)
            resultArr.push(indexMS)
          }
        }
        return resultArr
    }

    function parseActionObjProperties(action_obj) {
      action_obj.time = action_obj.time && parseTime(action_obj.time)
      action_obj.items = action_obj.items && parseItems(action_obj.items);
      action_obj.collapsed = false;
      return action_obj;

      function parseTime(time_str) {
        if (time_str.indexOf('h') > -1) {
          return {hours: parseFloat(time_str)}
        }
        if (time_str.indexOf('d') > -1) {
          return {days: parseFloat(time_str)}
        }
      }
      function parseItems(items) {

        return items.split(',')
      }

    }

  }
])
angular.module('uguru.preApp', ['ionic'])
.controller('SplashController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  '$rootScope',
  'CategoryService',
  'UniversityService',
  'ContentService',
  function($scope, $state, $timeout, $rootScope, CategoryService, UniversityService, ContentService) {
    // Listen for the event.
    var splash = this;
    splash.state = {};
    splash.nav = {};
    splash.activate = {};
    splash.categories = CategoryService.getLocalCategories();
    splash.category = splash.categories[0];
    splash.universities = UniversityService.getTargetted().splice(0, 10);
    splash.university = splash.universities[0];



    // $scope.$watchCollection(angular.bind(this, function () {
    //   return this; // `this` IS the `this` above!!
    // }), function (newVal, oldVal) {

    //   // now we will pickup changes to newVal and oldVal
    // });

    splash.activate = splashActivateFunction


    splash.state.madlib = true;


    $scope.$watch('splash.category.update', function(category, old_category) {
      console.log('received update');
      splash.category.tags_data = ContentService.splashCategoryOptions[splash.category.name].madlib;
      splash.category.options = {one: splash.category.tags_data.blank_one_options, two: splash.category.tags_data.blank_two_options};
    });

    $timeout(function() {
      activateSidebar();
      splash.state.nav = true;
    })


    function activateSidebar() {
      splash.nav.activateSidebar = navActivateSidebarFunc;
      splash.nav.categoriesDropdown = {selectedIndex: 0, key:'name', options: splash.categories, onOptionClick: updateSelectedCategory};
      splash.nav.universitiesDropdown = {selectedIndex: 0, key:'name', options: processUniversityNames(splash.universities), onOptionClick: updateSelectedUniversity};
    }


    function navActivateSidebarFunc() {
        var splashSidebarParent = document.querySelector('#splash-sidebar')
        splashSidebarParent.classList.add('on-sidebar-enter');
    }

    function updateSelectedCategory(option, index) {
      if (option.name !== splash.category.name) {
        splash.category.update = true;
        $timeout(function() {
          splash.category.update = false;
        })
      }
      splash.category = option;
    }

    function updateSelectedUniversity(option, index) {
      if (index === nav.universitiesDropdown.options.length - 1) {
        $scope.root.public.customStates.when.whenSearchUniversityClicked = true;

      } else {
        $scope.splash.university = option;
      }
    }

    function processUniversityNames(uni_arr) {
      for (var i = 0; i < uni_arr.length; i++) {
        if (uni_arr[i].short_name && uni_arr[i].short_name) {
          uni_arr[i].name = uni_arr[i].short_name;
        }
        else if (uni_arr[i].name.length > 20 && !uni_arr[i].short_name) {
          uni_arr[i].name = uni_arr[i].school_casual_name || uni_arr[i].name.substring(0, 17) + '...';
        }
      }
      uni_arr.push({name: 'Search your school', skip:true})
      return uni_arr
    }

    function splashActivateFunction() {

      // if ($scope.root.devMode) {
          splash.state.nav = true;
          splash.state.madlib = true;
          splash.state.sidebar = true;
          splash.state.device = true;
          splash.state.powerups = true;
          splash.state.universitySearch = true;
      //     // SpecService.initSpec('splash', $scope);
      //     return;
      // }

    //   portalElem && portalElem.addEventListener('splashMainLoadingComplete', function (e) {


    //     var loaderPortal = document.querySelector('.loader-portal');
    //     if (loaderPortal) {
    //       loaderPortal.style.display = 'none';
    //       loaderPortal.parentNode.removeChild(loaderPortal);
    //     }

    //     document.querySelector('#loader-wrapper .pageload-overlay svg.transition').style.visibility = "hidden";
    //     document.querySelector('#loader-wrapper').style.visibility = "hidden"
    //     $scope.showScaleOutLoader = true;

    //     globalLoader.hide();
    //     splash.renderView = true;
    //     // $timeout(function() {
    //       splash.state.madlib = true;
    //     // }, 2500)
    //     // $timeout(function() {
    //       splash.state.nav = true;
    //     // }, 1000)
    //     splash.state.sidebar = true;
    //     splash.state.device = true;
    //     splash.state.powerups = true;
    //     splash.state.universitySearch = true;
    //     $timeout(function() {

    //       $scope.$apply();
    //     }, 100)
    //   }, false);

    // }
    }



  }
]);

angular.module('uguru.preApp')
.controller('SplashMadlibController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'CategoryService',
  'UniversityService',
  'ContentService',
  'RootService',
  'UtilitiesService',
  function($scope, $state, $timeout, CategoryService, UniversityService, ContentService, RootService, UtilitiesService) {
    var madlib = this;


    madlib.category = ($scope.splash && $scope.splash.category) || CategoryService.getLocalCategories()[0];
    madlib.category.tags_data = ContentService.splashCategoryOptions[madlib.category.name].madlib;
    madlib.options = {one: madlib.category.tags_data.blank_one_options, two: madlib.category.tags_data.blank_two_options}

    madlib.university = UniversityService.getBerkeleyLocal();

    // $scope.$watch('splash.category', function(category)
    //   {
    //     madlib.category.tags_data = ContentService.splashCategoryOptions[category.name].madlib;
    //     madlib.options = {one: madlib.category.tags_data.blank_one_options, two: madlib.category.tags_data.blank_two_options}
    //     console.log(madlib.options.two[0])
    //   }
    // );


    var rowOneElems = document.querySelectorAll('a.adlib-1');
    var rowTwoElems = document.querySelectorAll('a.adlib-2');

    madlib.tagClicked = function(i_row, i_index, $event) {
      var grandParent = $event.target.parentNode.parentNode;
      var parent = $event.target.parentNode;
      var numWordIndice = ['One', 'Two', 'Three', 'Four']
      var rowWordIndice = numWordIndice[parseInt(i_row)];
      var wordIndice = numWordIndice[parseInt(i_index)];
        delay = 0;

          if (grandParent.className.indexOf('active') > -1 || parent.className.indexOf('active') > -1) {

            grandParent.classList.remove('active');
            parent.classList.remove('active');
            $timeout(function() {
              if (grandParent.className.indexOf('active') > -1 || parent.className.indexOf('active') > -1) {
                grandParent.classList.remove('active');
                parent.classList.remove('active');
              }

            });
          }

          for (var i = 0; i < 4; i++) {
            if (i !== parseInt(i_index)) {
                if (parseInt(i_row) === 0) {
                    rowOneElems[i].style['webkitTransform'] = '';
                    rowOneElems[i].style['transform'] = '';
                    rowOneElems[i].classList.remove('active');
                } else if (parseInt(i_row) === 1) {
                  rowTwoElems[i].style['webkitTransform'] = '';
                    rowTwoElems[i].style['transform'] = '';
                  rowTwoElems[i].classList.remove('active');
                }
            }
          }



          if (madlib.rowOneActive || madlib.rowTwoActive) {
            delay = 250;
          } else {
            if (!madlib.rowOneActive && parseInt(i_index) === 0) {
              madlib.rowOneActive = true;
            }
            if (!madlib.rowTwoActive && parseInt(i_index) === 1) {
              madlib.rowTwoActive = true;
            }
          }
        $timeout(function() {

          $scope.root.public.customStates.when['whenSplash' + rowWordIndice + wordIndice + 'ClickActive'] = true;
        })
      return;
    }

    madlib.updateOptionByIndex = function(category, index, cb) {
      index = (index && parseInt(index)) || 0
      var blankNum = 'one';
      if (index > 3) {
        blankNum = 'two';
        index = index - 4
      }
      var newElem = ContentService.splashCategoryOptions[category.name].madlib['blank_' + blankNum + '_options'][index];
      madlib.options[blankNum][index] = newElem;
    }


  }
])

angular.module('uguru.preApp')
.controller('SplashDeviceController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  function($scope, $state, $timeout, SpecService) {
    var device = this;




    // $scope.$watch('splash.state.device', function(newVal, oldVal) {
    //   if (newVal) {
    //     var parentViewElement = document.querySelector('#splash-madlib');
    //     var allActivateElements = parentViewElement.querySelectorAll('[on-activate]');
    //     for (var i = 0; i < allActivateElements.length; i++) {
    //       allActivateElements[i].classList.add('activate');
    //     }
    //   }
    //   $timeout(function() {
    //     $scope.$apply();
    //   })
    // })

    // SpecService.initSpec('device', $scope);
  }
])



angular.module('uguru.preApp')
.controller('SplashSidebarController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  function($scope, $state, $timeout) {
    var sidebar = this;

    sidebar.close = sidebarCloseFunc;
    sidebar.activate = true;


    function sidebarCloseFunc() {
        var splashSidebarParent = document.querySelector('#splash-sidebar')
        var elemStatesAttr = splashSidebarParent.classList.add('on-sidebar-exit');
    }
  }
])



angular.module('uguru.preApp')
.controller('SplashHiwController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  function($scope, $state, $timeout, SpecService) {
    var device = this;

    SpecService.initSpec('hiw', $scope);
  }
])



angular.module('uguru.preApp')
.controller('SplashPowerupsController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  function($scope, $state, $timeout, SpecService) {
    var powerups = this;
    // SpecService.initSpec('powerups', $scope);

  }
])



angular.module('uguru.preApp')
.controller('SplashMapsController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  function($scope, $state, $timeout, SpecService) {
    var device = this;

    SpecService.initSpec('splash_maps', $scope);
  }
])



angular.module('uguru.preApp')
.controller('SplashTransitionsController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  function($scope, $state, $timeout, SpecService) {
    var device = this;

    SpecService.initSpec('transitions', $scope);
  }
])



angular.module('uguru.preApp')
.controller('SplashFaqController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  function($scope, $state, $timeout, SpecService) {
    var device = this;

    SpecService.initSpec('faq', $scope);
  }
])



angular.module('uguru.preApp')
.controller('SplashPricingController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  function($scope, $state, $timeout, SpecService) {
    var device = this;

    SpecService.initSpec('pricing', $scope);
  }
])



angular.module('uguru.preApp')
.controller('SplashTeamController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  function($scope, $state, $timeout, SpecService) {
    var device = this;

    SpecService.initSpec('team', $scope);
  }
])



angular.module('uguru.preApp')
.controller('SplashAccountController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  function($scope, $state, $timeout, SpecService) {
    var access = this;

    // var account.activate = AccountService.active();

    SpecService.initSpec('access', $scope);

  }
])



angular.module('uguru.preApp')
.controller('SplashAccountController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  function($scope, $state, $timeout, SpecService) {
    var account = this;

    // var account.activate = AccountService.active();

    SpecService.initSpec('account', $scope);

  }
])



angular.module('uguru.preApp')
.controller('SplashAccountController', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  function($scope, $state, $timeout, SpecService) {
    var course = this;

    // var account.activate = AccountService.active();

    SpecService.initSpec('course', $scope);

  }
])



angular.module('uguru.preApp')
.controller('SplashDemographics', [

  //All imported packages go here
  '$scope',
  '$state',
  '$timeout',
  'SpecService',
  function($scope, $state, $timeout, SpecService) {

    var demographic = this;

    // var account.activate = AccountService.active();

    SpecService.initSpec('account', $scope);

  }
])


